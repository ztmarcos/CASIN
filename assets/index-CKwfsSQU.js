var so=Object.defineProperty;var ni=E=>{throw TypeError(E)};var no=(E,r,v)=>r in E?so(E,r,{enumerable:!0,configurable:!0,writable:!0,value:v}):E[r]=v;var cs=(E,r,v)=>no(E,typeof r!="symbol"?r+"":r,v),Wn=(E,r,v)=>r.has(E)||ni("Cannot "+v);var Ye=(E,r,v)=>(Wn(E,r,"read from private field"),v?v.call(E):r.get(E)),Tr=(E,r,v)=>r.has(E)?ni("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(E):r.set(E,v),Ar=(E,r,v,T)=>(Wn(E,r,"write to private field"),T?T.call(E,v):r.set(E,v),v),fr=(E,r,v)=>(Wn(E,r,"access private method"),v);var Ks=(E,r,v,T)=>({set _(w){Ar(E,r,w,v)},get _(){return Ye(E,r,T)}});import{r as reactExports,a as reactDomExports,b as React,g as getAugmentedNamespace,c as getDefaultExportFromCjs}from"./vendor-BjtAxaL3.js";import{N as NavLink,L as Link,B as BrowserRouter,R as Routes,a as Route,b as Navigate}from"./router-RN0vsji8.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const w of document.querySelectorAll('link[rel="modulepreload"]'))T(w);new MutationObserver(w=>{for(const S of w)if(S.type==="childList")for(const I of S.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&T(I)}).observe(document,{childList:!0,subtree:!0});function v(w){const S={};return w.integrity&&(S.integrity=w.integrity),w.referrerPolicy&&(S.referrerPolicy=w.referrerPolicy),w.crossOrigin==="use-credentials"?S.credentials="include":w.crossOrigin==="anonymous"?S.credentials="omit":S.credentials="same-origin",S}function T(w){if(w.ep)return;w.ep=!0;const S=v(w);fetch(w.href,S)}})();var jsxRuntime={exports:{}},reactJsxRuntime_production_min={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f$2=reactExports,k$2=Symbol.for("react.element"),l$1=Symbol.for("react.fragment"),m$2=Object.prototype.hasOwnProperty,n$1=f$2.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q$2(E,r,v){var T,w={},S=null,I=null;v!==void 0&&(S=""+v),r.key!==void 0&&(S=""+r.key),r.ref!==void 0&&(I=r.ref);for(T in r)m$2.call(r,T)&&!p$1.hasOwnProperty(T)&&(w[T]=r[T]);if(E&&E.defaultProps)for(T in r=E.defaultProps,r)w[T]===void 0&&(w[T]=r[T]);return{$$typeof:k$2,type:E,key:S,ref:I,props:w,_owner:n$1.current}}reactJsxRuntime_production_min.Fragment=l$1;reactJsxRuntime_production_min.jsx=q$2;reactJsxRuntime_production_min.jsxs=q$2;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},m$1=reactDomExports;client.createRoot=m$1.createRoot,client.hydrateRoot=m$1.hydrateRoot;const ThemeContext=reactExports.createContext(),ThemeProvider=({children:E})=>{const[r,v]=reactExports.useState("light");reactExports.useEffect(()=>{document.documentElement.setAttribute("data-theme",r)},[r]);const T=()=>{v(w=>w==="light"?"dark":"light")};return jsxRuntimeExports.jsx(ThemeContext.Provider,{value:{theme:r,toggleTheme:T},children:E})},useTheme=()=>{const E=reactExports.useContext(ThemeContext);if(!E)throw new Error("useTheme must be used within a ThemeProvider");return E},AuthContext=reactExports.createContext(null),AuthProvider=({children:E})=>{const[r,v]=reactExports.useState(null),[T,w]=reactExports.useState(!0);reactExports.useEffect(()=>{const H=localStorage.getItem("token"),te=localStorage.getItem("userEmail");H&&te&&v({email:te,token:H}),w(!1)},[]);const S=H=>{v(H)},I=()=>{localStorage.removeItem("token"),localStorage.removeItem("userEmail"),v(null)};return jsxRuntimeExports.jsx(AuthContext.Provider,{value:{user:r,login:S,logout:I,loading:T},children:!T&&E})},useAuth=()=>{const E=reactExports.useContext(AuthContext);if(!E)throw new Error("useAuth debe ser usado dentro de un AuthProvider");return E};class NotionErrorBoundary extends React.Component{constructor(r){super(r),this.state={hasError:!1,error:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,v){console.error("Notion component error:",r,v)}render(){return this.state.hasError?jsxRuntimeExports.jsxs("div",{className:"notion-error-boundary",children:[jsxRuntimeExports.jsx("h3",{children:"Something went wrong with the Notion component"}),jsxRuntimeExports.jsx("button",{onClick:()=>{this.setState({hasError:!1,error:null}),window.location.reload()},className:"notion-button refresh",children:"Try Again"})]}):this.props.children}}const TASK_STATUS_OPTIONS=[{value:"Por iniciar",label:"Por iniciar"},{value:"En progreso",label:"En progreso"},{value:"Listo",label:"Listo"}],PROPERTY_CONFIGS={title:{type:"title",formatValue:E=>({title:[{text:{content:E||""}}]})},Status:{type:"status",formatValue:E=>({status:{name:E||"Por iniciar"}})},"Fecha límite":{type:"date",formatValue:E=>({date:E?{start:E,time_zone:null}:null})},Descripción:{type:"rich_text",formatValue:E=>({rich_text:[{text:{content:E||""}}]})},Encargado:{type:"people",formatValue:E=>({people:E?[{id:E}]:[]})}},TaskModal=({task:E,isOpen:r,onClose:v,onSave:T,notionUsers:w})=>{const[S,I]=reactExports.useState({}),[H,te]=reactExports.useState({}),[ae,ie]=reactExports.useState(!1);reactExports.useEffect(()=>{var _e;if(E){const Re={id:E.id,title:E.title||"",Encargado:Array.isArray(E.Encargado)&&E.Encargado.length>0?E.Encargado[0].id:((_e=E.Encargado)==null?void 0:_e.id)||E.Encargado||"",Status:E.Status||"Por iniciar","Fecha límite":E["Fecha límite"]||"",Descripción:E.Descripción||""};I(Re),te({})}else I({title:"",Encargado:"",Status:"Por iniciar","Fecha límite":"",Descripción:""})},[E]);const ce=()=>{var Re;const _e={};return(Re=S.title)!=null&&Re.trim()||(_e.title="El título es requerido"),S.Status||(_e.Status="El estado es requerido"),S["Fecha límite"]&&new Date(S["Fecha límite"])<new Date&&(_e["Fecha límite"]="La fecha límite no puede ser en el pasado"),te(_e),Object.keys(_e).length===0},me=async()=>{if(ce())try{ie(!0),console.log("Preparing task data from:",S);const _e={title:{title:[{text:{content:S.title}}]},Encargado:{people:S.Encargado?[{object:"user",id:S.Encargado}]:[]},Status:{status:{name:S.Status||"Por iniciar"}},"Fecha límite":S["Fecha límite"]?{date:{start:S["Fecha límite"]}}:null,Descripción:{rich_text:[{text:{content:S.Descripción||""}}]}};if(!S.id)await T({isNew:!0,properties:_e});else{const Re=Object.entries(S).filter(([Pe,Ce])=>Pe!=="id"&&Ce!==void 0).map(([Pe,Ce])=>{const Fe=PROPERTY_CONFIGS[Pe];return Fe?{taskId:S.id,column:Pe,value:Ce,propertyType:Fe.type}:(console.warn(`No config found for column: ${Pe}`),null)}).filter(Boolean);await T({isNew:!1,updates:Re,properties:S})}v()}catch(_e){console.error("Error saving task:",_e),te({submit:"Error al guardar la tarea. Por favor, intente nuevamente."})}finally{ie(!1)}};return r?jsxRuntimeExports.jsx("div",{className:"notion-modal-overlay",onClick:v,children:jsxRuntimeExports.jsxs("div",{className:"notion-modal",onClick:_e=>_e.stopPropagation(),children:[jsxRuntimeExports.jsx("h3",{children:E?"Editar Tarea":"Nueva Tarea"}),jsxRuntimeExports.jsxs("div",{className:"notion-modal-content",children:[jsxRuntimeExports.jsxs("div",{className:"notion-form-group",children:[jsxRuntimeExports.jsx("input",{type:"text",className:`notion-input ${H.title?"notion-input-error":""}`,placeholder:"Título",value:S.title||"",onChange:_e=>{I({...S,title:_e.target.value}),H.title&&te({...H,title:void 0})}}),H.title&&jsxRuntimeExports.jsx("div",{className:"notion-error-message",children:H.title})]}),jsxRuntimeExports.jsxs("div",{className:"notion-form-group",children:[jsxRuntimeExports.jsxs("select",{className:`notion-select ${H.Encargado?"notion-input-error":""}`,value:S.Encargado||"",onChange:_e=>{I({...S,Encargado:_e.target.value}),H.Encargado&&te({...H,Encargado:void 0})},children:[jsxRuntimeExports.jsx("option",{value:"",children:"Seleccionar encargado..."}),w.map(_e=>{var Re;return jsxRuntimeExports.jsx("option",{value:_e.id,children:_e.name||((Re=_e.person)==null?void 0:Re.email)||_e.email||_e.id},_e.id)})]}),H.Encargado&&jsxRuntimeExports.jsx("div",{className:"notion-error-message",children:H.Encargado})]}),jsxRuntimeExports.jsxs("div",{className:"notion-form-group",children:[jsxRuntimeExports.jsxs("select",{className:`notion-select ${H.Status?"notion-input-error":""}`,value:S.Status||"",onChange:_e=>{I({...S,Status:_e.target.value}),H.Status&&te({...H,Status:void 0})},children:[jsxRuntimeExports.jsx("option",{value:"",children:"Seleccionar estado..."}),TASK_STATUS_OPTIONS.map(_e=>jsxRuntimeExports.jsx("option",{value:_e.value,children:_e.label},_e.value))]}),H.Status&&jsxRuntimeExports.jsx("div",{className:"notion-error-message",children:H.Status})]}),jsxRuntimeExports.jsxs("div",{className:"notion-form-group",children:[jsxRuntimeExports.jsx("input",{type:"date",className:`notion-input ${H["Fecha límite"]?"notion-input-error":""}`,value:S["Fecha límite"]||"",onChange:_e=>{I({...S,"Fecha límite":_e.target.value}),H["Fecha límite"]&&te({...H,"Fecha límite":void 0})}}),H["Fecha límite"]&&jsxRuntimeExports.jsx("div",{className:"notion-error-message",children:H["Fecha límite"]})]}),jsxRuntimeExports.jsxs("div",{className:"notion-form-group",children:[jsxRuntimeExports.jsx("textarea",{className:`notion-textarea ${H.Descripción?"notion-input-error":""}`,placeholder:"Descripción",value:S.Descripción||"",onChange:_e=>{I({...S,Descripción:_e.target.value}),H.Descripción&&te({...H,Descripción:void 0})}}),H.Descripción&&jsxRuntimeExports.jsx("div",{className:"notion-error-message",children:H.Descripción})]}),H.submit&&jsxRuntimeExports.jsx("div",{className:"notion-error-message notion-submit-error",children:H.submit}),jsxRuntimeExports.jsxs("div",{className:"notion-modal-actions",children:[jsxRuntimeExports.jsx("button",{onClick:v,className:"notion-button cancel",disabled:ae,children:"Cancelar"}),jsxRuntimeExports.jsx("button",{onClick:me,className:"notion-button create",disabled:ae,children:ae?"Guardando...":"Guardar"})]})]})]})}):null},ITEMS_PER_PAGE=10,API_BASE_URL$6="/api",formatDate$1=E=>E?new Date(E).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"",TABLE_COLUMNS=[{key:"title",label:"Title"},{key:"Encargado",label:"Encargado"},{key:"Status",label:"Status"},{key:"Fecha límite",label:"Fecha límite"},{key:"Descripción",label:"Descripción"}],NotionComponent=()=>{const[E,r]=reactExports.useState([]),[v,T]=reactExports.useState([]),[w,S]=reactExports.useState(!1),[I,H]=reactExports.useState(null),[te,ae]=reactExports.useState({key:null,direction:"asc"}),[ie,ce]=reactExports.useState({}),[me,_e]=reactExports.useState(1),[Re,Pe]=reactExports.useState(null),[Ce,Fe]=reactExports.useState(""),[Me,Ve]=reactExports.useState(!1),[We,ze]=reactExports.useState({title:"",Encargado:"",Status:"","Fecha límite":"",Descripción:""}),[Ue,je]=reactExports.useState(!1),[ke,Ne]=reactExports.useState(null),[Ge,Ie]=reactExports.useState(!1),Le="https://www.notion.so/1f7385297f9a80a3bc5bcec8a3c2debb?v=1f7385297f9a80de9d66000cfeaf4e83",He=async()=>{try{S(!0);const $e=await fetch(`${API_BASE_URL$6}/notion/users`);if(!$e.ok)throw new Error("Failed to fetch Notion users");const Be=await $e.json();console.log("Fetched Notion users:",Be),T(Be)}catch($e){console.error("Error fetching Notion users:",$e),H("Failed to load Notion users")}finally{S(!1)}},Ct=async()=>{try{S(!0);const $e=await fetch(`${API_BASE_URL$6}/notion/raw-table`);if(!$e.ok)throw new Error("Failed to fetch tasks");const Be=await $e.json();console.log("Fetched tasks:",Be),r(Be)}catch($e){console.error("Error fetching tasks:",$e),H("Failed to load tasks")}finally{S(!1)}},Ze=($e,Be)=>{var rt;const Xe=$e[Be];if(Xe==null)return jsxRuntimeExports.jsx("div",{className:"notion-td-content",children:"-"});if(Be==="Status")return jsxRuntimeExports.jsx("div",{className:`notion-status ${Wt(Xe)}`,children:Xe||"Sin iniciar"});if(Be==="Encargado"){if(Array.isArray(Xe)&&Xe.length>0){const Qe=Xe[0];return jsxRuntimeExports.jsx("div",{className:"notion-td-content",children:Qe.name||((rt=Qe.person)==null?void 0:rt.email)||"Sin asignar"})}return Xe.person?jsxRuntimeExports.jsx("div",{className:"notion-td-content",children:Xe.name||Xe.person.email||"Sin asignar"}):typeof Xe=="string"?jsxRuntimeExports.jsx("div",{className:"notion-td-content",children:Xe}):jsxRuntimeExports.jsx("div",{className:"notion-td-content",children:"Sin asignar"})}return Be==="Fecha límite"?jsxRuntimeExports.jsx("div",{className:"notion-td-content",children:formatDate$1(Xe)}):typeof Xe=="string"?jsxRuntimeExports.jsx("div",{className:"notion-td-content",children:Xe}):jsxRuntimeExports.jsx("div",{className:"notion-td-content",children:String(Xe)})};reactExports.useEffect(()=>{Ct(),He()},[]);const Rt=$e=>{let Be="asc";te.key===$e&&te.direction==="asc"&&(Be="desc"),ae({key:$e,direction:Be})};reactExports.useCallback(($e,Be)=>{const Xe=setTimeout(()=>{ce(rt=>({...rt,[$e]:Be})),_e(1)},300);return()=>clearTimeout(Xe)},[]);const nt=reactExports.useMemo(()=>{let $e=[...E];return Object.keys(ie).forEach(Be=>{var rt;const Xe=(rt=ie[Be])==null?void 0:rt.toLowerCase();Xe&&($e=$e.filter(Qe=>String(Qe[Be]||"").toLowerCase().includes(Xe)))}),te.key&&$e.sort((Be,Xe)=>{const rt=(Be[te.key]||"").toString().toLowerCase(),Qe=(Xe[te.key]||"").toString().toLowerCase();return rt<Qe?te.direction==="asc"?-1:1:rt>Qe?te.direction==="asc"?1:-1:0}),$e},[E,te,ie]),nr=reactExports.useMemo(()=>{const $e=(me-1)*ITEMS_PER_PAGE;return nt.slice($e,$e+ITEMS_PER_PAGE)},[nt,me]),Je=Math.ceil(nt.length/ITEMS_PER_PAGE),Wt=$e=>{if(!$e)return"status-sin-iniciar";const Be=$e.trim().toLowerCase();return{listo:"status-listo","en progreso":"status-en-progreso","sin iniciar":"status-sin-iniciar"}[Be]||"status-sin-iniciar"},Lt=async $e=>{if(window.confirm("Are you sure you want to delete this task?"))try{console.log("Deleting task:",$e),je(!0);const Be=await fetch(`${API_BASE_URL$6}/notion/delete-task/${$e}`,{method:"DELETE",headers:{Accept:"application/json"}});let Xe;try{Xe=await Be.json()}catch(rt){throw console.error("Failed to parse response:",rt),new Error("Server returned invalid response")}if(!Be.ok)throw new Error(Xe.error||Xe.message||"Failed to delete task");console.log("Delete successful:",Xe),await Ct()}catch(Be){console.error("Error deleting task:",Be),H(Be.message||"Failed to delete task")}finally{je(!1)}},qe=async $e=>{try{if($e.isNew){console.log("Creating new task with properties:",$e.properties);const Be=await fetch(`${API_BASE_URL$6}/notion/create-task`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({properties:$e.properties})});if(!Be.ok){const Xe=await Be.json();throw new Error(Xe.message||Xe.error||"Failed to create task")}await Ct(),Ie(!1),Ne(null)}else{console.log("Updating existing task with data:",$e);for(const Be of $e.updates){const Xe=PROPERTY_CONFIGS[Be.column];if(!Xe){console.warn("No config found for column:",Be.column);continue}console.log("Processing update:",{column:Be.column,value:Be.value,config:Xe});const rt={taskId:Be.taskId,column:Be.column,value:Be.value,propertyType:Xe.type};console.log("Sending request to update-cell:",rt);const Qe=await fetch(`${API_BASE_URL$6}/notion/update-cell`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(rt)}),vt=await Qe.json();if(console.log("Update response:",vt),!Qe.ok)throw console.error("Update failed:",{request:rt,response:vt}),new Error(vt.message||vt.error||"Failed to update task")}await Ct(),Ie(!1),Ne(null)}}catch(Be){throw console.error("Error saving task:",Be),Be}};return w?jsxRuntimeExports.jsx("div",{className:"notion-loading",children:"Loading..."}):I?jsxRuntimeExports.jsx("div",{className:"notion-error",children:I}):jsxRuntimeExports.jsx(NotionErrorBoundary,{children:jsxRuntimeExports.jsxs("div",{className:"notion-container",children:[jsxRuntimeExports.jsx("div",{className:"notion-header",children:jsxRuntimeExports.jsx("div",{className:"notion-controls",children:jsxRuntimeExports.jsxs("div",{className:"notion-actions",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{Ne(null),Ie(!0)},className:"notion-button create",children:"+ Nueva Tarea"}),jsxRuntimeExports.jsx("button",{onClick:Ct,className:"notion-button refresh",disabled:w,children:w?"Actualizando...":"↻ Actualizar"}),jsxRuntimeExports.jsx("a",{href:Le,target:"_blank",rel:"noopener noreferrer",className:"notion-database-link",children:"Ver en Notion"})]})})}),jsxRuntimeExports.jsx("div",{className:"notion-table-container",children:jsxRuntimeExports.jsxs("table",{className:"notion-table",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{children:[TABLE_COLUMNS.map($e=>jsxRuntimeExports.jsx("th",{className:"notion-th",onClick:()=>Rt($e.key),children:jsxRuntimeExports.jsxs("div",{className:"notion-th-content",children:[jsxRuntimeExports.jsx("span",{children:$e.label}),te.key===$e.key&&jsxRuntimeExports.jsx("span",{className:"notion-sort-indicator",children:te.direction==="asc"?"↑":"↓"})]})},$e.key)),jsxRuntimeExports.jsx("th",{className:"notion-th",children:"Actions"})]})}),jsxRuntimeExports.jsx("tbody",{children:nr.map(($e,Be)=>jsxRuntimeExports.jsxs("tr",{className:"notion-tr",onClick:()=>{Ne($e),Ie(!0)},children:[TABLE_COLUMNS.map((Xe,rt)=>jsxRuntimeExports.jsx("td",{className:`notion-td ${Xe.key==="Status"?Wt($e[Xe.key]):""} ${rt===0?"titlecolumn":""}`,children:Ze($e,Xe.key)},`${$e.id}-${Xe.key}`)),jsxRuntimeExports.jsx("td",{className:"notion-td notion-actions-cell",children:jsxRuntimeExports.jsx("button",{onClick:Xe=>{Xe.stopPropagation(),Lt($e.id)},className:"notion-button delete",disabled:Ue,title:"Delete task",children:Ue?"...":"✕"})})]},$e.id||Be))})]})}),Je>1&&jsxRuntimeExports.jsxs("div",{className:"notion-pagination",children:[jsxRuntimeExports.jsx("button",{onClick:()=>_e($e=>Math.max(1,$e-1)),disabled:me===1,className:"notion-button",children:"Anterior"}),jsxRuntimeExports.jsxs("span",{className:"notion-page-info",children:["Página ",me," de ",Je]}),jsxRuntimeExports.jsx("button",{onClick:()=>_e($e=>Math.min(Je,$e+1)),disabled:me===Je,className:"notion-button",children:"Siguiente"})]}),jsxRuntimeExports.jsx(TaskModal,{task:ke,isOpen:Ge,onClose:()=>{Ie(!1),Ne(null)},onSave:qe,notionUsers:v})]})})};function bind(E,r){return function(){return E.apply(r,arguments)}}const{toString}=Object.prototype,{getPrototypeOf}=Object,{iterator,toStringTag}=Symbol,kindOf=(E=>r=>{const v=toString.call(r);return E[v]||(E[v]=v.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=E=>(E=E.toLowerCase(),r=>kindOf(r)===E),typeOfTest=E=>r=>typeof r===E,{isArray:isArray$1}=Array,isUndefined=typeOfTest("undefined");function isBuffer(E){return E!==null&&!isUndefined(E)&&E.constructor!==null&&!isUndefined(E.constructor)&&isFunction(E.constructor.isBuffer)&&E.constructor.isBuffer(E)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(E){let r;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?r=ArrayBuffer.isView(E):r=E&&E.buffer&&isArrayBuffer(E.buffer),r}const isString=typeOfTest("string"),isFunction=typeOfTest("function"),isNumber=typeOfTest("number"),isObject$1=E=>E!==null&&typeof E=="object",isBoolean=E=>E===!0||E===!1,isPlainObject=E=>{if(kindOf(E)!=="object")return!1;const r=getPrototypeOf(E);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(toStringTag in E)&&!(iterator in E)},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=E=>isObject$1(E)&&isFunction(E.pipe),isFormData=E=>{let r;return E&&(typeof FormData=="function"&&E instanceof FormData||isFunction(E.append)&&((r=kindOf(E))==="formdata"||r==="object"&&isFunction(E.toString)&&E.toString()==="[object FormData]"))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=E=>E.trim?E.trim():E.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach$1(E,r,{allOwnKeys:v=!1}={}){if(E===null||typeof E>"u")return;let T,w;if(typeof E!="object"&&(E=[E]),isArray$1(E))for(T=0,w=E.length;T<w;T++)r.call(null,E[T],T,E);else{const S=v?Object.getOwnPropertyNames(E):Object.keys(E),I=S.length;let H;for(T=0;T<I;T++)H=S[T],r.call(null,E[H],H,E)}}function findKey(E,r){r=r.toLowerCase();const v=Object.keys(E);let T=v.length,w;for(;T-- >0;)if(w=v[T],r===w.toLowerCase())return w;return null}const _global=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:globalThis,isContextDefined=E=>!isUndefined(E)&&E!==_global;function merge(){const{caseless:E}=isContextDefined(this)&&this||{},r={},v=(T,w)=>{const S=E&&findKey(r,w)||w;isPlainObject(r[S])&&isPlainObject(T)?r[S]=merge(r[S],T):isPlainObject(T)?r[S]=merge({},T):isArray$1(T)?r[S]=T.slice():r[S]=T};for(let T=0,w=arguments.length;T<w;T++)arguments[T]&&forEach$1(arguments[T],v);return r}const extend=(E,r,v,{allOwnKeys:T}={})=>(forEach$1(r,(w,S)=>{v&&isFunction(w)?E[S]=bind(w,v):E[S]=w},{allOwnKeys:T}),E),stripBOM=E=>(E.charCodeAt(0)===65279&&(E=E.slice(1)),E),inherits=(E,r,v,T)=>{E.prototype=Object.create(r.prototype,T),E.prototype.constructor=E,Object.defineProperty(E,"super",{value:r.prototype}),v&&Object.assign(E.prototype,v)},toFlatObject=(E,r,v,T)=>{let w,S,I;const H={};if(r=r||{},E==null)return r;do{for(w=Object.getOwnPropertyNames(E),S=w.length;S-- >0;)I=w[S],(!T||T(I,E,r))&&!H[I]&&(r[I]=E[I],H[I]=!0);E=v!==!1&&getPrototypeOf(E)}while(E&&(!v||v(E,r))&&E!==Object.prototype);return r},endsWith=(E,r,v)=>{E=String(E),(v===void 0||v>E.length)&&(v=E.length),v-=r.length;const T=E.indexOf(r,v);return T!==-1&&T===v},toArray=E=>{if(!E)return null;if(isArray$1(E))return E;let r=E.length;if(!isNumber(r))return null;const v=new Array(r);for(;r-- >0;)v[r]=E[r];return v},isTypedArray=(E=>r=>E&&r instanceof E)(typeof Uint8Array<"u"&&getPrototypeOf(Uint8Array)),forEachEntry=(E,r)=>{const T=(E&&E[iterator]).call(E);let w;for(;(w=T.next())&&!w.done;){const S=w.value;r.call(E,S[0],S[1])}},matchAll=(E,r)=>{let v;const T=[];for(;(v=E.exec(r))!==null;)T.push(v);return T},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=E=>E.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(v,T,w){return T.toUpperCase()+w}),hasOwnProperty=(({hasOwnProperty:E})=>(r,v)=>E.call(r,v))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(E,r)=>{const v=Object.getOwnPropertyDescriptors(E),T={};forEach$1(v,(w,S)=>{let I;(I=r(w,S,E))!==!1&&(T[S]=I||w)}),Object.defineProperties(E,T)},freezeMethods=E=>{reduceDescriptors(E,(r,v)=>{if(isFunction(E)&&["arguments","caller","callee"].indexOf(v)!==-1)return!1;const T=E[v];if(isFunction(T)){if(r.enumerable=!1,"writable"in r){r.writable=!1;return}r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+v+"'")})}})},toObjectSet=(E,r)=>{const v={},T=w=>{w.forEach(S=>{v[S]=!0})};return isArray$1(E)?T(E):T(String(E).split(r)),v},noop$1=()=>{},toFiniteNumber=(E,r)=>E!=null&&Number.isFinite(E=+E)?E:r;function isSpecCompliantForm(E){return!!(E&&isFunction(E.append)&&E[toStringTag]==="FormData"&&E[iterator])}const toJSONObject=E=>{const r=new Array(10),v=(T,w)=>{if(isObject$1(T)){if(r.indexOf(T)>=0)return;if(!("toJSON"in T)){r[w]=T;const S=isArray$1(T)?[]:{};return forEach$1(T,(I,H)=>{const te=v(I,w+1);!isUndefined(te)&&(S[H]=te)}),r[w]=void 0,S}}return T};return v(E,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=E=>E&&(isObject$1(E)||isFunction(E))&&isFunction(E.then)&&isFunction(E.catch),_setImmediate=((E,r)=>E?setImmediate:r?((v,T)=>(_global.addEventListener("message",({source:w,data:S})=>{w===_global&&S===v&&T.length&&T.shift()()},!1),w=>{T.push(w),_global.postMessage(v,"*")}))(`axios@${Math.random()}`,[]):v=>setTimeout(v))(typeof setImmediate=="function",isFunction(_global.postMessage)),asap=typeof queueMicrotask<"u"?queueMicrotask.bind(_global):typeof process<"u"&&process.nextTick||_setImmediate,isIterable=E=>E!=null&&isFunction(E[iterator]),utils$2={isArray:isArray$1,isArrayBuffer,isBuffer,isFormData,isArrayBufferView,isString,isNumber,isBoolean,isObject:isObject$1,isPlainObject,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp,isFunction,isStream,isURLSearchParams,isTypedArray,isFileList,forEach:forEach$1,merge,extend,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray,forEachEntry,matchAll,isHTMLForm,hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop:noop$1,toFiniteNumber,findKey,global:_global,isContextDefined,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable,setImmediate:_setImmediate,asap,isIterable};function AxiosError$1(E,r,v,T,w){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=E,this.name="AxiosError",r&&(this.code=r),v&&(this.config=v),T&&(this.request=T),w&&(this.response=w,this.status=w.status?w.status:null)}utils$2.inherits(AxiosError$1,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$2.toJSONObject(this.config),code:this.code,status:this.status}}});const prototype$1=AxiosError$1.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(E=>{descriptors[E]={value:E}});Object.defineProperties(AxiosError$1,descriptors);Object.defineProperty(prototype$1,"isAxiosError",{value:!0});AxiosError$1.from=(E,r,v,T,w,S)=>{const I=Object.create(prototype$1);return utils$2.toFlatObject(E,I,function(te){return te!==Error.prototype},H=>H!=="isAxiosError"),AxiosError$1.call(I,E.message,r,v,T,w),I.cause=E,I.name=E.name,S&&Object.assign(I,S),I};const httpAdapter=null;function isVisitable(E){return utils$2.isPlainObject(E)||utils$2.isArray(E)}function removeBrackets(E){return utils$2.endsWith(E,"[]")?E.slice(0,-2):E}function renderKey(E,r,v){return E?E.concat(r).map(function(w,S){return w=removeBrackets(w),!v&&S?"["+w+"]":w}).join(v?".":""):r}function isFlatArray(E){return utils$2.isArray(E)&&!E.some(isVisitable)}const predicates=utils$2.toFlatObject(utils$2,{},null,function(r){return/^is[A-Z]/.test(r)});function toFormData$1(E,r,v){if(!utils$2.isObject(E))throw new TypeError("target must be an object");r=r||new FormData,v=utils$2.toFlatObject(v,{metaTokens:!0,dots:!1,indexes:!1},!1,function(Pe,Ce){return!utils$2.isUndefined(Ce[Pe])});const T=v.metaTokens,w=v.visitor||ie,S=v.dots,I=v.indexes,te=(v.Blob||typeof Blob<"u"&&Blob)&&utils$2.isSpecCompliantForm(r);if(!utils$2.isFunction(w))throw new TypeError("visitor must be a function");function ae(Re){if(Re===null)return"";if(utils$2.isDate(Re))return Re.toISOString();if(!te&&utils$2.isBlob(Re))throw new AxiosError$1("Blob is not supported. Use a Buffer instead.");return utils$2.isArrayBuffer(Re)||utils$2.isTypedArray(Re)?te&&typeof Blob=="function"?new Blob([Re]):Buffer.from(Re):Re}function ie(Re,Pe,Ce){let Fe=Re;if(Re&&!Ce&&typeof Re=="object"){if(utils$2.endsWith(Pe,"{}"))Pe=T?Pe:Pe.slice(0,-2),Re=JSON.stringify(Re);else if(utils$2.isArray(Re)&&isFlatArray(Re)||(utils$2.isFileList(Re)||utils$2.endsWith(Pe,"[]"))&&(Fe=utils$2.toArray(Re)))return Pe=removeBrackets(Pe),Fe.forEach(function(Ve,We){!(utils$2.isUndefined(Ve)||Ve===null)&&r.append(I===!0?renderKey([Pe],We,S):I===null?Pe:Pe+"[]",ae(Ve))}),!1}return isVisitable(Re)?!0:(r.append(renderKey(Ce,Pe,S),ae(Re)),!1)}const ce=[],me=Object.assign(predicates,{defaultVisitor:ie,convertValue:ae,isVisitable});function _e(Re,Pe){if(!utils$2.isUndefined(Re)){if(ce.indexOf(Re)!==-1)throw Error("Circular reference detected in "+Pe.join("."));ce.push(Re),utils$2.forEach(Re,function(Fe,Me){(!(utils$2.isUndefined(Fe)||Fe===null)&&w.call(r,Fe,utils$2.isString(Me)?Me.trim():Me,Pe,me))===!0&&_e(Fe,Pe?Pe.concat(Me):[Me])}),ce.pop()}}if(!utils$2.isObject(E))throw new TypeError("data must be an object");return _e(E),r}function encode$1(E){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(E).replace(/[!'()~]|%20|%00/g,function(T){return r[T]})}function AxiosURLSearchParams(E,r){this._pairs=[],E&&toFormData$1(E,this,r)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function(r,v){this._pairs.push([r,v])};prototype.toString=function(r){const v=r?function(T){return r.call(this,T,encode$1)}:encode$1;return this._pairs.map(function(w){return v(w[0])+"="+v(w[1])},"").join("&")};function encode(E){return encodeURIComponent(E).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function buildURL(E,r,v){if(!r)return E;const T=v&&v.encode||encode;utils$2.isFunction(v)&&(v={serialize:v});const w=v&&v.serialize;let S;if(w?S=w(r,v):S=utils$2.isURLSearchParams(r)?r.toString():new AxiosURLSearchParams(r,v).toString(T),S){const I=E.indexOf("#");I!==-1&&(E=E.slice(0,I)),E+=(E.indexOf("?")===-1?"?":"&")+S}return E}class InterceptorManager{constructor(){this.handlers=[]}use(r,v,T){return this.handlers.push({fulfilled:r,rejected:v,synchronous:T?T.synchronous:!1,runWhen:T?T.runWhen:null}),this.handlers.length-1}eject(r){this.handlers[r]&&(this.handlers[r]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(r){utils$2.forEach(this.handlers,function(T){T!==null&&r(T)})}}const transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv=typeof window<"u"&&typeof document<"u",_navigator=typeof navigator=="object"&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",origin=hasBrowserEnv&&window.location.href||"http://localhost",utils$1=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv,hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin},Symbol.toStringTag,{value:"Module"})),platform={...utils$1,...platform$1};function toURLEncodedForm(E,r){return toFormData$1(E,new platform.classes.URLSearchParams,Object.assign({visitor:function(v,T,w,S){return platform.isNode&&utils$2.isBuffer(v)?(this.append(T,v.toString("base64")),!1):S.defaultVisitor.apply(this,arguments)}},r))}function parsePropPath(E){return utils$2.matchAll(/\w+|\[(\w*)]/g,E).map(r=>r[0]==="[]"?"":r[1]||r[0])}function arrayToObject(E){const r={},v=Object.keys(E);let T;const w=v.length;let S;for(T=0;T<w;T++)S=v[T],r[S]=E[S];return r}function formDataToJSON(E){function r(v,T,w,S){let I=v[S++];if(I==="__proto__")return!0;const H=Number.isFinite(+I),te=S>=v.length;return I=!I&&utils$2.isArray(w)?w.length:I,te?(utils$2.hasOwnProp(w,I)?w[I]=[w[I],T]:w[I]=T,!H):((!w[I]||!utils$2.isObject(w[I]))&&(w[I]=[]),r(v,T,w[I],S)&&utils$2.isArray(w[I])&&(w[I]=arrayToObject(w[I])),!H)}if(utils$2.isFormData(E)&&utils$2.isFunction(E.entries)){const v={};return utils$2.forEachEntry(E,(T,w)=>{r(parsePropPath(T),w,v,0)}),v}return null}function stringifySafely(E,r,v){if(utils$2.isString(E))try{return(r||JSON.parse)(E),utils$2.trim(E)}catch(T){if(T.name!=="SyntaxError")throw T}return(v||JSON.stringify)(E)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function(r,v){const T=v.getContentType()||"",w=T.indexOf("application/json")>-1,S=utils$2.isObject(r);if(S&&utils$2.isHTMLForm(r)&&(r=new FormData(r)),utils$2.isFormData(r))return w?JSON.stringify(formDataToJSON(r)):r;if(utils$2.isArrayBuffer(r)||utils$2.isBuffer(r)||utils$2.isStream(r)||utils$2.isFile(r)||utils$2.isBlob(r)||utils$2.isReadableStream(r))return r;if(utils$2.isArrayBufferView(r))return r.buffer;if(utils$2.isURLSearchParams(r))return v.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),r.toString();let H;if(S){if(T.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(r,this.formSerializer).toString();if((H=utils$2.isFileList(r))||T.indexOf("multipart/form-data")>-1){const te=this.env&&this.env.FormData;return toFormData$1(H?{"files[]":r}:r,te&&new te,this.formSerializer)}}return S||w?(v.setContentType("application/json",!1),stringifySafely(r)):r}],transformResponse:[function(r){const v=this.transitional||defaults.transitional,T=v&&v.forcedJSONParsing,w=this.responseType==="json";if(utils$2.isResponse(r)||utils$2.isReadableStream(r))return r;if(r&&utils$2.isString(r)&&(T&&!this.responseType||w)){const I=!(v&&v.silentJSONParsing)&&w;try{return JSON.parse(r)}catch(H){if(I)throw H.name==="SyntaxError"?AxiosError$1.from(H,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response):H}}return r}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function(r){return r>=200&&r<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$2.forEach(["delete","get","head","post","put","patch"],E=>{defaults.headers[E]={}});const ignoreDuplicateOf=utils$2.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=E=>{const r={};let v,T,w;return E&&E.split(`
`).forEach(function(I){w=I.indexOf(":"),v=I.substring(0,w).trim().toLowerCase(),T=I.substring(w+1).trim(),!(!v||r[v]&&ignoreDuplicateOf[v])&&(v==="set-cookie"?r[v]?r[v].push(T):r[v]=[T]:r[v]=r[v]?r[v]+", "+T:T)}),r},$internals=Symbol("internals");function normalizeHeader(E){return E&&String(E).trim().toLowerCase()}function normalizeValue(E){return E===!1||E==null?E:utils$2.isArray(E)?E.map(normalizeValue):String(E)}function parseTokens(E){const r=Object.create(null),v=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let T;for(;T=v.exec(E);)r[T[1]]=T[2];return r}const isValidHeaderName=E=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(E.trim());function matchHeaderValue(E,r,v,T,w){if(utils$2.isFunction(T))return T.call(this,r,v);if(w&&(r=v),!!utils$2.isString(r)){if(utils$2.isString(T))return r.indexOf(T)!==-1;if(utils$2.isRegExp(T))return T.test(r)}}function formatHeader(E){return E.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(r,v,T)=>v.toUpperCase()+T)}function buildAccessors(E,r){const v=utils$2.toCamelCase(" "+r);["get","set","has"].forEach(T=>{Object.defineProperty(E,T+v,{value:function(w,S,I){return this[T].call(this,r,w,S,I)},configurable:!0})})}let AxiosHeaders$1=class{constructor(r){r&&this.set(r)}set(r,v,T){const w=this;function S(H,te,ae){const ie=normalizeHeader(te);if(!ie)throw new Error("header name must be a non-empty string");const ce=utils$2.findKey(w,ie);(!ce||w[ce]===void 0||ae===!0||ae===void 0&&w[ce]!==!1)&&(w[ce||te]=normalizeValue(H))}const I=(H,te)=>utils$2.forEach(H,(ae,ie)=>S(ae,ie,te));if(utils$2.isPlainObject(r)||r instanceof this.constructor)I(r,v);else if(utils$2.isString(r)&&(r=r.trim())&&!isValidHeaderName(r))I(parseHeaders(r),v);else if(utils$2.isObject(r)&&utils$2.isIterable(r)){let H={},te,ae;for(const ie of r){if(!utils$2.isArray(ie))throw TypeError("Object iterator must return a key-value pair");H[ae=ie[0]]=(te=H[ae])?utils$2.isArray(te)?[...te,ie[1]]:[te,ie[1]]:ie[1]}I(H,v)}else r!=null&&S(v,r,T);return this}get(r,v){if(r=normalizeHeader(r),r){const T=utils$2.findKey(this,r);if(T){const w=this[T];if(!v)return w;if(v===!0)return parseTokens(w);if(utils$2.isFunction(v))return v.call(this,w,T);if(utils$2.isRegExp(v))return v.exec(w);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,v){if(r=normalizeHeader(r),r){const T=utils$2.findKey(this,r);return!!(T&&this[T]!==void 0&&(!v||matchHeaderValue(this,this[T],T,v)))}return!1}delete(r,v){const T=this;let w=!1;function S(I){if(I=normalizeHeader(I),I){const H=utils$2.findKey(T,I);H&&(!v||matchHeaderValue(T,T[H],H,v))&&(delete T[H],w=!0)}}return utils$2.isArray(r)?r.forEach(S):S(r),w}clear(r){const v=Object.keys(this);let T=v.length,w=!1;for(;T--;){const S=v[T];(!r||matchHeaderValue(this,this[S],S,r,!0))&&(delete this[S],w=!0)}return w}normalize(r){const v=this,T={};return utils$2.forEach(this,(w,S)=>{const I=utils$2.findKey(T,S);if(I){v[I]=normalizeValue(w),delete v[S];return}const H=r?formatHeader(S):String(S).trim();H!==S&&delete v[S],v[H]=normalizeValue(w),T[H]=!0}),this}concat(...r){return this.constructor.concat(this,...r)}toJSON(r){const v=Object.create(null);return utils$2.forEach(this,(T,w)=>{T!=null&&T!==!1&&(v[w]=r&&utils$2.isArray(T)?T.join(", "):T)}),v}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([r,v])=>r+": "+v).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r,...v){const T=new this(r);return v.forEach(w=>T.set(w)),T}static accessor(r){const T=(this[$internals]=this[$internals]={accessors:{}}).accessors,w=this.prototype;function S(I){const H=normalizeHeader(I);T[H]||(buildAccessors(w,I),T[H]=!0)}return utils$2.isArray(r)?r.forEach(S):S(r),this}};AxiosHeaders$1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);utils$2.reduceDescriptors(AxiosHeaders$1.prototype,({value:E},r)=>{let v=r[0].toUpperCase()+r.slice(1);return{get:()=>E,set(T){this[v]=T}}});utils$2.freezeMethods(AxiosHeaders$1);function transformData(E,r){const v=this||defaults,T=r||v,w=AxiosHeaders$1.from(T.headers);let S=T.data;return utils$2.forEach(E,function(H){S=H.call(v,S,w.normalize(),r?r.status:void 0)}),w.normalize(),S}function isCancel$1(E){return!!(E&&E.__CANCEL__)}function CanceledError$1(E,r,v){AxiosError$1.call(this,E??"canceled",AxiosError$1.ERR_CANCELED,r,v),this.name="CanceledError"}utils$2.inherits(CanceledError$1,AxiosError$1,{__CANCEL__:!0});function settle(E,r,v){const T=v.config.validateStatus;!v.status||!T||T(v.status)?E(v):r(new AxiosError$1("Request failed with status code "+v.status,[AxiosError$1.ERR_BAD_REQUEST,AxiosError$1.ERR_BAD_RESPONSE][Math.floor(v.status/100)-4],v.config,v.request,v))}function parseProtocol(E){const r=/^([-+\w]{1,25})(:?\/\/|:)/.exec(E);return r&&r[1]||""}function speedometer(E,r){E=E||10;const v=new Array(E),T=new Array(E);let w=0,S=0,I;return r=r!==void 0?r:1e3,function(te){const ae=Date.now(),ie=T[S];I||(I=ae),v[w]=te,T[w]=ae;let ce=S,me=0;for(;ce!==w;)me+=v[ce++],ce=ce%E;if(w=(w+1)%E,w===S&&(S=(S+1)%E),ae-I<r)return;const _e=ie&&ae-ie;return _e?Math.round(me*1e3/_e):void 0}}function throttle(E,r){let v=0,T=1e3/r,w,S;const I=(ae,ie=Date.now())=>{v=ie,w=null,S&&(clearTimeout(S),S=null),E.apply(null,ae)};return[(...ae)=>{const ie=Date.now(),ce=ie-v;ce>=T?I(ae,ie):(w=ae,S||(S=setTimeout(()=>{S=null,I(w)},T-ce)))},()=>w&&I(w)]}const progressEventReducer=(E,r,v=3)=>{let T=0;const w=speedometer(50,250);return throttle(S=>{const I=S.loaded,H=S.lengthComputable?S.total:void 0,te=I-T,ae=w(te),ie=I<=H;T=I;const ce={loaded:I,total:H,progress:H?I/H:void 0,bytes:te,rate:ae||void 0,estimated:ae&&H&&ie?(H-I)/ae:void 0,event:S,lengthComputable:H!=null,[r?"download":"upload"]:!0};E(ce)},v)},progressEventDecorator=(E,r)=>{const v=E!=null;return[T=>r[0]({lengthComputable:v,total:E,loaded:T}),r[1]]},asyncDecorator=E=>(...r)=>utils$2.asap(()=>E(...r)),isURLSameOrigin=platform.hasStandardBrowserEnv?((E,r)=>v=>(v=new URL(v,platform.origin),E.protocol===v.protocol&&E.host===v.host&&(r||E.port===v.port)))(new URL(platform.origin),platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent)):()=>!0,cookies=platform.hasStandardBrowserEnv?{write(E,r,v,T,w,S){const I=[E+"="+encodeURIComponent(r)];utils$2.isNumber(v)&&I.push("expires="+new Date(v).toGMTString()),utils$2.isString(T)&&I.push("path="+T),utils$2.isString(w)&&I.push("domain="+w),S===!0&&I.push("secure"),document.cookie=I.join("; ")},read(E){const r=document.cookie.match(new RegExp("(^|;\\s*)("+E+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(E){this.write(E,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function isAbsoluteURL(E){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(E)}function combineURLs(E,r){return r?E.replace(/\/?\/$/,"")+"/"+r.replace(/^\/+/,""):E}function buildFullPath(E,r,v){let T=!isAbsoluteURL(r);return E&&(T||v==!1)?combineURLs(E,r):r}const headersToObject=E=>E instanceof AxiosHeaders$1?{...E}:E;function mergeConfig$1(E,r){r=r||{};const v={};function T(ae,ie,ce,me){return utils$2.isPlainObject(ae)&&utils$2.isPlainObject(ie)?utils$2.merge.call({caseless:me},ae,ie):utils$2.isPlainObject(ie)?utils$2.merge({},ie):utils$2.isArray(ie)?ie.slice():ie}function w(ae,ie,ce,me){if(utils$2.isUndefined(ie)){if(!utils$2.isUndefined(ae))return T(void 0,ae,ce,me)}else return T(ae,ie,ce,me)}function S(ae,ie){if(!utils$2.isUndefined(ie))return T(void 0,ie)}function I(ae,ie){if(utils$2.isUndefined(ie)){if(!utils$2.isUndefined(ae))return T(void 0,ae)}else return T(void 0,ie)}function H(ae,ie,ce){if(ce in r)return T(ae,ie);if(ce in E)return T(void 0,ae)}const te={url:S,method:S,data:S,baseURL:I,transformRequest:I,transformResponse:I,paramsSerializer:I,timeout:I,timeoutMessage:I,withCredentials:I,withXSRFToken:I,adapter:I,responseType:I,xsrfCookieName:I,xsrfHeaderName:I,onUploadProgress:I,onDownloadProgress:I,decompress:I,maxContentLength:I,maxBodyLength:I,beforeRedirect:I,transport:I,httpAgent:I,httpsAgent:I,cancelToken:I,socketPath:I,responseEncoding:I,validateStatus:H,headers:(ae,ie,ce)=>w(headersToObject(ae),headersToObject(ie),ce,!0)};return utils$2.forEach(Object.keys(Object.assign({},E,r)),function(ie){const ce=te[ie]||w,me=ce(E[ie],r[ie],ie);utils$2.isUndefined(me)&&ce!==H||(v[ie]=me)}),v}const resolveConfig=E=>{const r=mergeConfig$1({},E);let{data:v,withXSRFToken:T,xsrfHeaderName:w,xsrfCookieName:S,headers:I,auth:H}=r;r.headers=I=AxiosHeaders$1.from(I),r.url=buildURL(buildFullPath(r.baseURL,r.url,r.allowAbsoluteUrls),E.params,E.paramsSerializer),H&&I.set("Authorization","Basic "+btoa((H.username||"")+":"+(H.password?unescape(encodeURIComponent(H.password)):"")));let te;if(utils$2.isFormData(v)){if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)I.setContentType(void 0);else if((te=I.getContentType())!==!1){const[ae,...ie]=te?te.split(";").map(ce=>ce.trim()).filter(Boolean):[];I.setContentType([ae||"multipart/form-data",...ie].join("; "))}}if(platform.hasStandardBrowserEnv&&(T&&utils$2.isFunction(T)&&(T=T(r)),T||T!==!1&&isURLSameOrigin(r.url))){const ae=w&&S&&cookies.read(S);ae&&I.set(w,ae)}return r},isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(E){return new Promise(function(v,T){const w=resolveConfig(E);let S=w.data;const I=AxiosHeaders$1.from(w.headers).normalize();let{responseType:H,onUploadProgress:te,onDownloadProgress:ae}=w,ie,ce,me,_e,Re;function Pe(){_e&&_e(),Re&&Re(),w.cancelToken&&w.cancelToken.unsubscribe(ie),w.signal&&w.signal.removeEventListener("abort",ie)}let Ce=new XMLHttpRequest;Ce.open(w.method.toUpperCase(),w.url,!0),Ce.timeout=w.timeout;function Fe(){if(!Ce)return;const Ve=AxiosHeaders$1.from("getAllResponseHeaders"in Ce&&Ce.getAllResponseHeaders()),ze={data:!H||H==="text"||H==="json"?Ce.responseText:Ce.response,status:Ce.status,statusText:Ce.statusText,headers:Ve,config:E,request:Ce};settle(function(je){v(je),Pe()},function(je){T(je),Pe()},ze),Ce=null}"onloadend"in Ce?Ce.onloadend=Fe:Ce.onreadystatechange=function(){!Ce||Ce.readyState!==4||Ce.status===0&&!(Ce.responseURL&&Ce.responseURL.indexOf("file:")===0)||setTimeout(Fe)},Ce.onabort=function(){Ce&&(T(new AxiosError$1("Request aborted",AxiosError$1.ECONNABORTED,E,Ce)),Ce=null)},Ce.onerror=function(){T(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,E,Ce)),Ce=null},Ce.ontimeout=function(){let We=w.timeout?"timeout of "+w.timeout+"ms exceeded":"timeout exceeded";const ze=w.transitional||transitionalDefaults;w.timeoutErrorMessage&&(We=w.timeoutErrorMessage),T(new AxiosError$1(We,ze.clarifyTimeoutError?AxiosError$1.ETIMEDOUT:AxiosError$1.ECONNABORTED,E,Ce)),Ce=null},S===void 0&&I.setContentType(null),"setRequestHeader"in Ce&&utils$2.forEach(I.toJSON(),function(We,ze){Ce.setRequestHeader(ze,We)}),utils$2.isUndefined(w.withCredentials)||(Ce.withCredentials=!!w.withCredentials),H&&H!=="json"&&(Ce.responseType=w.responseType),ae&&([me,Re]=progressEventReducer(ae,!0),Ce.addEventListener("progress",me)),te&&Ce.upload&&([ce,_e]=progressEventReducer(te),Ce.upload.addEventListener("progress",ce),Ce.upload.addEventListener("loadend",_e)),(w.cancelToken||w.signal)&&(ie=Ve=>{Ce&&(T(!Ve||Ve.type?new CanceledError$1(null,E,Ce):Ve),Ce.abort(),Ce=null)},w.cancelToken&&w.cancelToken.subscribe(ie),w.signal&&(w.signal.aborted?ie():w.signal.addEventListener("abort",ie)));const Me=parseProtocol(w.url);if(Me&&platform.protocols.indexOf(Me)===-1){T(new AxiosError$1("Unsupported protocol "+Me+":",AxiosError$1.ERR_BAD_REQUEST,E));return}Ce.send(S||null)})},composeSignals=(E,r)=>{const{length:v}=E=E?E.filter(Boolean):[];if(r||v){let T=new AbortController,w;const S=function(ae){if(!w){w=!0,H();const ie=ae instanceof Error?ae:this.reason;T.abort(ie instanceof AxiosError$1?ie:new CanceledError$1(ie instanceof Error?ie.message:ie))}};let I=r&&setTimeout(()=>{I=null,S(new AxiosError$1(`timeout ${r} of ms exceeded`,AxiosError$1.ETIMEDOUT))},r);const H=()=>{E&&(I&&clearTimeout(I),I=null,E.forEach(ae=>{ae.unsubscribe?ae.unsubscribe(S):ae.removeEventListener("abort",S)}),E=null)};E.forEach(ae=>ae.addEventListener("abort",S));const{signal:te}=T;return te.unsubscribe=()=>utils$2.asap(H),te}},streamChunk=function*(E,r){let v=E.byteLength;if(v<r){yield E;return}let T=0,w;for(;T<v;)w=T+r,yield E.slice(T,w),T=w},readBytes=async function*(E,r){for await(const v of readStream(E))yield*streamChunk(v,r)},readStream=async function*(E){if(E[Symbol.asyncIterator]){yield*E;return}const r=E.getReader();try{for(;;){const{done:v,value:T}=await r.read();if(v)break;yield T}}finally{await r.cancel()}},trackStream=(E,r,v,T)=>{const w=readBytes(E,r);let S=0,I,H=te=>{I||(I=!0,T&&T(te))};return new ReadableStream({async pull(te){try{const{done:ae,value:ie}=await w.next();if(ae){H(),te.close();return}let ce=ie.byteLength;if(v){let me=S+=ce;v(me)}te.enqueue(new Uint8Array(ie))}catch(ae){throw H(ae),ae}},cancel(te){return H(te),w.return()}},{highWaterMark:2})},isFetchSupported=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",isReadableStreamSupported=isFetchSupported&&typeof ReadableStream=="function",encodeText=isFetchSupported&&(typeof TextEncoder=="function"?(E=>r=>E.encode(r))(new TextEncoder):async E=>new Uint8Array(await new Response(E).arrayBuffer())),test=(E,...r)=>{try{return!!E(...r)}catch{return!1}},supportsRequestStream=isReadableStreamSupported&&test(()=>{let E=!1;const r=new Request(platform.origin,{body:new ReadableStream,method:"POST",get duplex(){return E=!0,"half"}}).headers.has("Content-Type");return E&&!r}),DEFAULT_CHUNK_SIZE=64*1024,supportsResponseStream=isReadableStreamSupported&&test(()=>utils$2.isReadableStream(new Response("").body)),resolvers={stream:supportsResponseStream&&(E=>E.body)};isFetchSupported&&(E=>{["text","arrayBuffer","blob","formData","stream"].forEach(r=>{!resolvers[r]&&(resolvers[r]=utils$2.isFunction(E[r])?v=>v[r]():(v,T)=>{throw new AxiosError$1(`Response type '${r}' is not supported`,AxiosError$1.ERR_NOT_SUPPORT,T)})})})(new Response);const getBodyLength=async E=>{if(E==null)return 0;if(utils$2.isBlob(E))return E.size;if(utils$2.isSpecCompliantForm(E))return(await new Request(platform.origin,{method:"POST",body:E}).arrayBuffer()).byteLength;if(utils$2.isArrayBufferView(E)||utils$2.isArrayBuffer(E))return E.byteLength;if(utils$2.isURLSearchParams(E)&&(E=E+""),utils$2.isString(E))return(await encodeText(E)).byteLength},resolveBodyLength=async(E,r)=>{const v=utils$2.toFiniteNumber(E.getContentLength());return v??getBodyLength(r)},fetchAdapter=isFetchSupported&&(async E=>{let{url:r,method:v,data:T,signal:w,cancelToken:S,timeout:I,onDownloadProgress:H,onUploadProgress:te,responseType:ae,headers:ie,withCredentials:ce="same-origin",fetchOptions:me}=resolveConfig(E);ae=ae?(ae+"").toLowerCase():"text";let _e=composeSignals([w,S&&S.toAbortSignal()],I),Re;const Pe=_e&&_e.unsubscribe&&(()=>{_e.unsubscribe()});let Ce;try{if(te&&supportsRequestStream&&v!=="get"&&v!=="head"&&(Ce=await resolveBodyLength(ie,T))!==0){let ze=new Request(r,{method:"POST",body:T,duplex:"half"}),Ue;if(utils$2.isFormData(T)&&(Ue=ze.headers.get("content-type"))&&ie.setContentType(Ue),ze.body){const[je,ke]=progressEventDecorator(Ce,progressEventReducer(asyncDecorator(te)));T=trackStream(ze.body,DEFAULT_CHUNK_SIZE,je,ke)}}utils$2.isString(ce)||(ce=ce?"include":"omit");const Fe="credentials"in Request.prototype;Re=new Request(r,{...me,signal:_e,method:v.toUpperCase(),headers:ie.normalize().toJSON(),body:T,duplex:"half",credentials:Fe?ce:void 0});let Me=await fetch(Re);const Ve=supportsResponseStream&&(ae==="stream"||ae==="response");if(supportsResponseStream&&(H||Ve&&Pe)){const ze={};["status","statusText","headers"].forEach(Ne=>{ze[Ne]=Me[Ne]});const Ue=utils$2.toFiniteNumber(Me.headers.get("content-length")),[je,ke]=H&&progressEventDecorator(Ue,progressEventReducer(asyncDecorator(H),!0))||[];Me=new Response(trackStream(Me.body,DEFAULT_CHUNK_SIZE,je,()=>{ke&&ke(),Pe&&Pe()}),ze)}ae=ae||"text";let We=await resolvers[utils$2.findKey(resolvers,ae)||"text"](Me,E);return!Ve&&Pe&&Pe(),await new Promise((ze,Ue)=>{settle(ze,Ue,{data:We,headers:AxiosHeaders$1.from(Me.headers),status:Me.status,statusText:Me.statusText,config:E,request:Re})})}catch(Fe){throw Pe&&Pe(),Fe&&Fe.name==="TypeError"&&/Load failed|fetch/i.test(Fe.message)?Object.assign(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,E,Re),{cause:Fe.cause||Fe}):AxiosError$1.from(Fe,Fe&&Fe.code,E,Re)}}),knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:fetchAdapter};utils$2.forEach(knownAdapters,(E,r)=>{if(E){try{Object.defineProperty(E,"name",{value:r})}catch{}Object.defineProperty(E,"adapterName",{value:r})}});const renderReason=E=>`- ${E}`,isResolvedHandle=E=>utils$2.isFunction(E)||E===null||E===!1,adapters={getAdapter:E=>{E=utils$2.isArray(E)?E:[E];const{length:r}=E;let v,T;const w={};for(let S=0;S<r;S++){v=E[S];let I;if(T=v,!isResolvedHandle(v)&&(T=knownAdapters[(I=String(v)).toLowerCase()],T===void 0))throw new AxiosError$1(`Unknown adapter '${I}'`);if(T)break;w[I||"#"+S]=T}if(!T){const S=Object.entries(w).map(([H,te])=>`adapter ${H} `+(te===!1?"is not supported by the environment":"is not available in the build"));let I=r?S.length>1?`since :
`+S.map(renderReason).join(`
`):" "+renderReason(S[0]):"as no adapter specified";throw new AxiosError$1("There is no suitable adapter to dispatch the request "+I,"ERR_NOT_SUPPORT")}return T},adapters:knownAdapters};function throwIfCancellationRequested(E){if(E.cancelToken&&E.cancelToken.throwIfRequested(),E.signal&&E.signal.aborted)throw new CanceledError$1(null,E)}function dispatchRequest(E){return throwIfCancellationRequested(E),E.headers=AxiosHeaders$1.from(E.headers),E.data=transformData.call(E,E.transformRequest),["post","put","patch"].indexOf(E.method)!==-1&&E.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(E.adapter||defaults.adapter)(E).then(function(T){return throwIfCancellationRequested(E),T.data=transformData.call(E,E.transformResponse,T),T.headers=AxiosHeaders$1.from(T.headers),T},function(T){return isCancel$1(T)||(throwIfCancellationRequested(E),T&&T.response&&(T.response.data=transformData.call(E,E.transformResponse,T.response),T.response.headers=AxiosHeaders$1.from(T.response.headers))),Promise.reject(T)})}const VERSION$1="1.9.0",validators$1={};["object","boolean","number","function","string","symbol"].forEach((E,r)=>{validators$1[E]=function(T){return typeof T===E||"a"+(r<1?"n ":" ")+E}});const deprecatedWarnings={};validators$1.transitional=function(r,v,T){function w(S,I){return"[Axios v"+VERSION$1+"] Transitional option '"+S+"'"+I+(T?". "+T:"")}return(S,I,H)=>{if(r===!1)throw new AxiosError$1(w(I," has been removed"+(v?" in "+v:"")),AxiosError$1.ERR_DEPRECATED);return v&&!deprecatedWarnings[I]&&(deprecatedWarnings[I]=!0,console.warn(w(I," has been deprecated since v"+v+" and will be removed in the near future"))),r?r(S,I,H):!0}};validators$1.spelling=function(r){return(v,T)=>(console.warn(`${T} is likely a misspelling of ${r}`),!0)};function assertOptions(E,r,v){if(typeof E!="object")throw new AxiosError$1("options must be an object",AxiosError$1.ERR_BAD_OPTION_VALUE);const T=Object.keys(E);let w=T.length;for(;w-- >0;){const S=T[w],I=r[S];if(I){const H=E[S],te=H===void 0||I(H,S,E);if(te!==!0)throw new AxiosError$1("option "+S+" must be "+te,AxiosError$1.ERR_BAD_OPTION_VALUE);continue}if(v!==!0)throw new AxiosError$1("Unknown option "+S,AxiosError$1.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$1},validators=validator.validators;let Axios$1=class{constructor(r){this.defaults=r||{},this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}async request(r,v){try{return await this._request(r,v)}catch(T){if(T instanceof Error){let w={};Error.captureStackTrace?Error.captureStackTrace(w):w=new Error;const S=w.stack?w.stack.replace(/^.+\n/,""):"";try{T.stack?S&&!String(T.stack).endsWith(S.replace(/^.+\n.+\n/,""))&&(T.stack+=`
`+S):T.stack=S}catch{}}throw T}}_request(r,v){typeof r=="string"?(v=v||{},v.url=r):v=r||{},v=mergeConfig$1(this.defaults,v);const{transitional:T,paramsSerializer:w,headers:S}=v;T!==void 0&&validator.assertOptions(T,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),w!=null&&(utils$2.isFunction(w)?v.paramsSerializer={serialize:w}:validator.assertOptions(w,{encode:validators.function,serialize:validators.function},!0)),v.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?v.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:v.allowAbsoluteUrls=!0),validator.assertOptions(v,{baseUrl:validators.spelling("baseURL"),withXsrfToken:validators.spelling("withXSRFToken")},!0),v.method=(v.method||this.defaults.method||"get").toLowerCase();let I=S&&utils$2.merge(S.common,S[v.method]);S&&utils$2.forEach(["delete","get","head","post","put","patch","common"],Re=>{delete S[Re]}),v.headers=AxiosHeaders$1.concat(I,S);const H=[];let te=!0;this.interceptors.request.forEach(function(Pe){typeof Pe.runWhen=="function"&&Pe.runWhen(v)===!1||(te=te&&Pe.synchronous,H.unshift(Pe.fulfilled,Pe.rejected))});const ae=[];this.interceptors.response.forEach(function(Pe){ae.push(Pe.fulfilled,Pe.rejected)});let ie,ce=0,me;if(!te){const Re=[dispatchRequest.bind(this),void 0];for(Re.unshift.apply(Re,H),Re.push.apply(Re,ae),me=Re.length,ie=Promise.resolve(v);ce<me;)ie=ie.then(Re[ce++],Re[ce++]);return ie}me=H.length;let _e=v;for(ce=0;ce<me;){const Re=H[ce++],Pe=H[ce++];try{_e=Re(_e)}catch(Ce){Pe.call(this,Ce);break}}try{ie=dispatchRequest.call(this,_e)}catch(Re){return Promise.reject(Re)}for(ce=0,me=ae.length;ce<me;)ie=ie.then(ae[ce++],ae[ce++]);return ie}getUri(r){r=mergeConfig$1(this.defaults,r);const v=buildFullPath(r.baseURL,r.url,r.allowAbsoluteUrls);return buildURL(v,r.params,r.paramsSerializer)}};utils$2.forEach(["delete","get","head","options"],function(r){Axios$1.prototype[r]=function(v,T){return this.request(mergeConfig$1(T||{},{method:r,url:v,data:(T||{}).data}))}});utils$2.forEach(["post","put","patch"],function(r){function v(T){return function(S,I,H){return this.request(mergeConfig$1(H||{},{method:r,headers:T?{"Content-Type":"multipart/form-data"}:{},url:S,data:I}))}}Axios$1.prototype[r]=v(),Axios$1.prototype[r+"Form"]=v(!0)});let CancelToken$1=class ai{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let v;this.promise=new Promise(function(S){v=S});const T=this;this.promise.then(w=>{if(!T._listeners)return;let S=T._listeners.length;for(;S-- >0;)T._listeners[S](w);T._listeners=null}),this.promise.then=w=>{let S;const I=new Promise(H=>{T.subscribe(H),S=H}).then(w);return I.cancel=function(){T.unsubscribe(S)},I},r(function(S,I,H){T.reason||(T.reason=new CanceledError$1(S,I,H),v(T.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){if(this.reason){r(this.reason);return}this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const v=this._listeners.indexOf(r);v!==-1&&this._listeners.splice(v,1)}toAbortSignal(){const r=new AbortController,v=T=>{r.abort(T)};return this.subscribe(v),r.signal.unsubscribe=()=>this.unsubscribe(v),r.signal}static source(){let r;return{token:new ai(function(w){r=w}),cancel:r}}};function spread$1(E){return function(v){return E.apply(null,v)}}function isAxiosError$1(E){return utils$2.isObject(E)&&E.isAxiosError===!0}const HttpStatusCode$1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(HttpStatusCode$1).forEach(([E,r])=>{HttpStatusCode$1[r]=E});function createInstance(E){const r=new Axios$1(E),v=bind(Axios$1.prototype.request,r);return utils$2.extend(v,Axios$1.prototype,r,{allOwnKeys:!0}),utils$2.extend(v,r,null,{allOwnKeys:!0}),v.create=function(w){return createInstance(mergeConfig$1(E,w))},v}const axios=createInstance(defaults);axios.Axios=Axios$1;axios.CanceledError=CanceledError$1;axios.CancelToken=CancelToken$1;axios.isCancel=isCancel$1;axios.VERSION=VERSION$1;axios.toFormData=toFormData$1;axios.AxiosError=AxiosError$1;axios.Cancel=axios.CanceledError;axios.all=function(r){return Promise.all(r)};axios.spread=spread$1;axios.isAxiosError=isAxiosError$1;axios.mergeConfig=mergeConfig$1;axios.AxiosHeaders=AxiosHeaders$1;axios.formToJSON=E=>formDataToJSON(utils$2.isHTMLForm(E)?new FormData(E):E);axios.getAdapter=adapters.getAdapter;axios.HttpStatusCode=HttpStatusCode$1;axios.default=axios;const{Axios,AxiosError,CanceledError,isCancel,CancelToken,VERSION,all,Cancel,isAxiosError,spread,toFormData,AxiosHeaders,HttpStatusCode,formToJSON,getAdapter,mergeConfig}=axios,API_BASE_URL$5="https://backend-production-d401.up.railway.app",API_URL=`${API_BASE_URL$5}/api`;var wa,Sa;class TableService{constructor(){Tr(this,wa,new Map);Tr(this,Sa,5e3);this.apiUrl=API_URL,this.currentTableName=null,this.currentTableTitle=null}setCurrentTable(r){this.currentTableName=r,this.currentTableTitle=this.formatTableTitle(r)}getCurrentTableTitle(){return this.currentTableTitle||this.formatTableTitle(this.currentTableName)}formatTableTitle(r){if(!r)return"";if(r.includes("→")){const[v,T]=r.split("→").map(w=>w.trim());return`${this.formatSingleTableName(v)} → ${this.formatSingleTableName(T)}`}return this.formatSingleTableName(r)}formatSingleTableName(r){return!r||typeof r!="string"?"":r.split("_").map(v=>v.charAt(0).toUpperCase()+v.slice(1).toLowerCase()).join(" ")}async getTables(){try{const r=await fetch(`${this.apiUrl}/data/tables`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return(await r.json()).map(w=>({...w,title:this.formatTableTitle(w.name)})).map(w=>(!w.isMainTable&&!w.isSecondaryTable&&w.columns&&(w.columns=w.columns.filter(S=>S.name!=="status")),w))}catch(r){throw console.error("Error fetching tables:",r),r}}async getData(r,v={}){try{if(this.setCurrentTable(r),r.includes("→")){const[S,I]=r.split("→").map(ce=>ce.trim());console.log("Loading combined table data:",{parentTable:S,childTable:I});const H=await fetch(`${this.apiUrl}/data/${S}`);if(!H.ok)throw new Error(`HTTP error getting parent table! status: ${H.status}`);const te=await H.json(),ae=await fetch(`${this.apiUrl}/data/${I}`);if(!ae.ok)throw new Error(`HTTP error getting child table! status: ${ae.status}`);const ie=await ae.json();return{table:r,data:ie.data||[],parentData:te.data||[],timestamp:new Date().toISOString()}}const T=await fetch(`${this.apiUrl}/data/${r}`);if(!T.ok)throw new Error(`HTTP error! status: ${T.status}`);return await T.json()}catch(T){throw console.error("Error getting data:",T),T}}async createTable(r,v){try{if(!r||!v||!v.length)throw new Error("Table name and data are required");let T=v[0];typeof T=="object"&&Object.keys(T).length===1&&typeof Object.values(T)[0]=="object"&&(T=Object.values(T)[0]);const w=Object.entries(T).filter(([H])=>!H.startsWith("__EMPTY")).map(([H,te])=>({name:H.trim().replace(/^["']|["']$/g,"").replace(/\s+/g,"_").replace(/[^a-zA-Z0-9_]/g,"").toLowerCase(),type:this.inferColumnType(te)})),S={name:r.toLowerCase().trim(),columns:w};console.log("Creating table with definition:",S);const I=await fetch(`${this.apiUrl}/tables`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(S)});if(!I.ok){const H=await I.json();throw new Error(H.error||"Error creating table")}return await I.json()}catch(T){throw console.error("Error creating table:",T),T}}inferColumnType(r){return typeof r=="number"?r%1===0?"INT":"DECIMAL(10,2)":r instanceof Date?"DATETIME":"VARCHAR(255)"}async insertData(r,v){try{console.log("Raw data received:",v),console.log("Target table name:",r);const w=(await this.getTables()).find(me=>me.name===r);if(!w)throw new Error(`Table '${r}' does not exist`);const S=w.columns.filter(me=>me.name!=="id").map(me=>me.name),I=Array.isArray(v),H=me=>{const _e={...me};delete _e.id;const Re={};for(const Pe in _e)if(S.includes(Pe)){let Ce=_e[Pe];if(Ce==null)Ce=null;else if(typeof Ce=="object"&&!(Ce instanceof Date))Ce=JSON.stringify(Ce);else if(Ce instanceof Date)Ce=Ce.toISOString().split("T")[0];else if(typeof Ce=="string"&&Ce.trim()!==""){console.log(`🔄 Auto-normalizing field "${Pe}" with value: "${Ce}"`);const Fe=Pe.toLowerCase();Fe.includes("rfc")?Ce=this.normalizeText(Ce,"rfc"):Fe.includes("nombre")||Fe.includes("contratante")||Fe.includes("propietario")||Fe.includes("agente")||Fe.includes("responsable")||Fe.includes("beneficiario")?Ce=this.normalizeText(Ce,"name"):Fe.includes("direccion")||Fe.includes("domicilio")||Fe.includes("ubicacion")||Fe.includes("origen")||Fe.includes("destino")?Ce=this.normalizeText(Ce,"address"):Fe.includes("aseguradora")||Fe.includes("compania")||Fe.includes("empresa")?Ce=this.normalizeText(Ce,"general"):Ce=this.normalizeText(Ce,"general"),console.log(`✅ Normalized "${Pe}": "${_e[Pe]}" → "${Ce}"`)}Re[Pe]=Ce}return Re},te=I?v.map(H):H(v);if(!I&&Object.keys(te).length===0)throw new Error("No valid data to insert");const ae=`${this.apiUrl}/data/${r}`;console.log("Request payload:",te);const ie=await fetch(ae,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(te)});if(console.log("Response status:",ie.status),!ie.ok){const me=await ie.json();throw console.log("Server error response:",me),new Error(me.error||"Failed to insert data")}const ce=await ie.json();return console.log("Insert result:",ce),ce}catch(T){throw console.error("Error inserting data:",T),T}}async getTableStructure(r){try{const v=await fetch(`${this.apiUrl}/data/tables/${r}/structure`);if(!v.ok)throw new Error(`Failed to get table structure: ${v.statusText}`);const T=await v.json();if(Array.isArray(T)&&T.length>0&&"Field"in T[0])return{columns:T.map(I=>({name:I.Field,type:this.mapDatabaseTypeToFrontend(I.Type)}))};if(T&&T.columns)return T;const S=(await this.getTables()).find(I=>I.name===r);if(S&&S.columns)return{columns:S.columns};throw new Error("Could not retrieve table structure")}catch(v){throw console.error("Error fetching table structure:",v),v}}inferColumnTypeFromValue(r){return r==null?"TEXT":typeof r=="number"?Number.isInteger(r)?"INT":"DECIMAL":r instanceof Date||typeof r=="string"&&!isNaN(Date.parse(r))?"DATE":typeof r=="boolean"?"BOOLEAN":"TEXT"}async updateColumnOrder(r,v){try{const T=await fetch(`${this.apiUrl}/tables/${r}/columns/order`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({columnOrder:v})});if(!T.ok)throw new Error(`HTTP error! status: ${T.status}`);return await T.json()}catch(T){throw console.error("Error updating column order:",T),T}}async updateData(r,v,T,w){try{let S=r;if(r.includes("→")){const[ae,ie]=r.split("→").map(ce=>ce.trim());S=ie,console.log("Combined table update - using child table:",ie)}const I=S.trim().toLowerCase();console.log("Attempting to update:",{originalTableName:r,actualTableName:I,id:v,column:T,value:w});const H=await fetch(`${this.apiUrl}/data/${I}/${v}`,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({column:T,value:w})});let te;try{te=await H.json()}catch(ae){throw console.error("Failed to parse response as JSON:",ae),new Error("Server returned invalid JSON response")}if(!H.ok)throw new Error(te.error||te.message||"Failed to update data");return{success:!0,message:te.message,updatedData:te.updatedData}}catch(S){throw console.error("Error updating data:",S),S}}async addColumn(r,v){try{const T=r.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase().replace(/_+/g,"_").replace(/^_|_$/g,""),w=await fetch(`${this.apiUrl}/tables/${T}/columns/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:v.name.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase().replace(/_+/g,"_").replace(/^_|_$/g,""),type:v.type})});if(!w.ok){const S=await w.text();throw new Error(S||`Failed to add column ${v.name} to ${r}`)}return await w.json()}catch(T){throw console.error("Error adding column:",T),T}}async deleteColumn(r,v){try{const T=await fetch(`${this.apiUrl}/tables/${r}/columns/${v}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!T.ok){const w=await T.json();throw new Error(w.message||"Failed to delete column")}return await T.json()}catch(T){throw console.error("Error deleting column:",T),T}}async renameColumn(r,v,T){try{const w=v.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),S=T.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),I=await fetch(`${this.apiUrl}/data/tables/${r}/columns/${w}/rename`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({newName:S})});if(!I.ok){const te=await I.json().catch(()=>({message:`Failed to rename column: ${I.statusText}`}));throw new Error(te.message||"Failed to rename column")}const H=new CustomEvent("tableStructureUpdated",{detail:{tableName:r,oldName:w,newName:S}});return window.dispatchEvent(H),await I.json()}catch(w){throw console.error("Error renaming column:",w),w}}async setColumnTag(r,v,T){try{const w=await fetch(`${this.apiUrl}/tables/${r}/columns/${v}/tag`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tag:T})});if(!w.ok){const S=await w.json();throw new Error(S.message||"Failed to set column tag")}return await w.json()}catch(w){throw console.error("Error setting column tag:",w),w}}async deleteTable(r){try{const v=r.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),T=await fetch(`${this.apiUrl}/tables/${v}`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!T.ok){const w=T.headers.get("content-type");let S;if(w&&w.includes("application/json")){const I=await T.json();S=I.message||I.error}else S=await T.text(),S.includes("<!DOCTYPE")&&(S=`Failed to delete table ${r}`);throw new Error(S)}return{success:!0,message:`Table ${r} deleted successfully`}}catch(v){throw console.error("Error deleting table:",v),v}}async deleteRow(r,v){try{const T=r.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase().replace(/_+/g,"_").replace(/^_|_$/g,""),w=await fetch(`${this.apiUrl}/data/${T}/${v}`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}});if(!w.ok){const I=w.headers.get("content-type");let H;throw I&&I.includes("application/json")?H=(await w.json()).message:H=await w.text(),new Error(H||`Failed to delete row ${v} from ${r}`)}const S=w.headers.get("content-type");return S&&S.includes("application/json")?await w.json():{message:`Row ${v} deleted successfully from ${r}`}}catch(T){throw console.error("Error deleting row:",T),T}}async searchAllTables(r){try{return(await axios.get(`${this.apiUrl}/search`,{params:{query:r}})).data}catch(v){throw console.error("Error searching tables:",v),v}}async importCSV(r,v){var T,w;try{if(!v||v.length===0)throw new Error("No data to import");const S=v[0],I=Object.keys(S).filter(ae=>ae.toLowerCase()!=="id").map(ae=>{const ie=v.map(_e=>_e[ae]).filter(_e=>_e!=null&&_e!=="");let ce="VARCHAR(255)";if(ie.length>0){const _e=ie.every(Fe=>!isNaN(Fe)&&!isNaN(parseFloat(Fe))),Re=_e&&ie.every(Fe=>Number.isInteger(parseFloat(Fe))),Pe=ie.every(Fe=>!isNaN(Date.parse(Fe))),Ce=Math.max(...ie.map(Fe=>String(Fe).length));Re?ce="INT":_e?ce="DECIMAL(12,2)":Pe?ce="DATE":Ce>255?ce="TEXT":ce=`VARCHAR(${Math.min(Ce+50,255)})`}return{name:ae.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9_]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,""),type:ce,nullable:!0}}),H=r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9_]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"");try{const ae=await axios.post(`${this.apiUrl}/tables`,{name:H,columns:I,options:{addIdColumn:!0}});if(!ae.data.success)throw new Error(ae.data.error||"Failed to create table")}catch{console.log("First approach failed, trying alternative...");const ie={name:H,sql:`CREATE TABLE IF NOT EXISTS \`${H}\` (
            id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
            ${I.map(me=>`\`${me.name}\` ${me.type}${me.nullable?"":" NOT NULL"}`).join(`,
`)}
          ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;`},ce=await axios.post(`${this.apiUrl}/tables/raw`,ie);if(!ce.data.success)throw new Error(ce.data.error||"Failed to create table")}const te=50;for(let ae=0;ae<v.length;ae+=te){const ie=v.slice(ae,ae+te);await Promise.all(ie.map(ce=>{const me={};return I.forEach(({name:_e,type:Re})=>{let Pe=ce[Object.keys(ce).find(Ce=>Ce.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9_]/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,"")===_e)];if(Pe!=null&&Pe!==""){if(Re==="INT")Pe=parseInt(Pe,10),isNaN(Pe)&&(Pe=null);else if(Re==="DECIMAL(12,2)")Pe=parseFloat(Pe),isNaN(Pe)&&(Pe=null);else if(Re==="DATE"){const Ce=new Date(Pe);isNaN(Ce)?Pe=null:Pe=Ce.toISOString().split("T")[0]}}else Pe=null;me[_e]=Pe}),this.insertData(H,me)}))}return{success:!0,message:`Table ${H} created and ${v.length} rows imported successfully`,tableName:H,rowCount:v.length,columns:I}}catch(S){throw console.error("Error importing CSV:",S),new Error(((w=(T=S.response)==null?void 0:T.data)==null?void 0:w.error)||S.message||"Error importing CSV data")}}async renameTable(r,v){try{const T=r.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),w=v.trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9_]/g,"_").toLowerCase(),S=await fetch(`${this.apiUrl}/data/tables/${T}/rename`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({newName:w})});if(!S.ok){const H=S.headers.get("content-type");let te;if(H&&H.includes("application/json")){const ae=await S.json();te=ae.error||ae.message}else te=await S.text(),te.includes("<!DOCTYPE")&&(te="Server error occurred while renaming table");throw new Error(te||"Error renaming table")}const I=S.headers.get("content-type");return I&&I.includes("application/json")?await S.json():{message:`Table renamed from ${r} to ${v} successfully`}}catch(T){throw console.error("Error renaming table:",T),T}}async createTableGroup(r,v,T="default"){try{const w=await fetch(`${this.apiUrl}/tables/group`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({mainTableName:r,secondaryTableName:v,groupType:T})}),S=w.headers.get("content-type");if(!S||!S.includes("application/json"))throw new Error("Server response was not JSON");const I=await w.json();if(!w.ok)throw new Error(I.error||I.details||"Error al crear el grupo de tablas");return I}catch(w){throw console.error("Error creating table group:",w),w.name==="SyntaxError"?new Error("Error en la respuesta del servidor"):new Error(w.message||"Error al crear el grupo de tablas")}}async getAllTables(){try{const r=await fetch(`${this.apiUrl}/tables`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return(await r.json()).filter(T=>T.name.toLowerCase().includes("gmm")||T.name.toLowerCase().includes("auto")).map(T=>T.name)}catch(r){throw console.error("Error getting tables:",r),r}}async executeTableOperation(r,v){try{const T=await fetch(`${this.apiUrl}/tables/${r}/update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!T.ok){const w=await T.json().catch(()=>({message:`Operation failed: ${T.statusText}`}));throw new Error(w.message||"Operation failed")}return await T.json()}catch(T){throw console.error("Error executing table operation:",T),T}}async executeQuery(r,v=[]){try{const T=await fetch(`${this.apiUrl}/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:r,values:v})});if(!T.ok){const w=await T.json().catch(()=>({message:`Query failed: ${T.statusText}`}));throw new Error(w.message||"Query failed")}return await T.json()}catch(T){throw console.error("Error executing query:",T),T}}mapDatabaseTypeToFrontend(r){return r?(r=r.toLowerCase(),r.includes("int")?"INT":r.includes("decimal")||r.includes("numeric")||r.includes("float")||r.includes("double")?"DECIMAL":r.includes("date")||r.includes("time")?"DATE":r==="tinyint(1)"||r==="boolean"?"BOOLEAN":(r.includes("varchar")||r.includes("text")||r.includes("char"),"TEXT")):"TEXT"}async getTableTypes(){try{const r=await fetch(`${this.apiUrl}/data/table-types`);if(!r.ok){const T=await r.json().catch(()=>({error:"Unknown error occurred"}));throw new Error(T.error||`HTTP error! status: ${r.status}`)}const v=await r.json();if(!v||typeof v!="object")throw new Error("Invalid table types data received");return v}catch(r){throw console.error("Error getting table types:",r),r}}async updateTableOrder(r){try{const v=await fetch(`${this.apiUrl}/data/tables/order`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({tableOrder:r})});if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return await v.json()}catch(v){throw console.error("Error updating table order:",v),v}}async getChildTables(r){try{const v=await fetch(`${this.apiUrl}/data/tables/${r}/children`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return(await v.json()).map(w=>w.name||w)}catch(v){return console.error("Error getting child tables:",v),[]}}normalizeText(r,v="general"){if(!r||typeof r!="string")return r;if(v==="rfc")return r.toUpperCase().trim();let T=r.trim();return[/grupo\s+nacional\s+provincial\s*,?\s*s\.a\.b\.?/gi,/grupo\s+naci[oó]n\s+aprovincial/gi,/grupo\s+nacional\s+aprovincial/gi,/gnp\s+seguros/gi,/g\.n\.p\.?/gi,/grupo\s+nacion\s+aprovincial/gi].forEach(S=>{T=T.replace(S,"GNP")}),(v==="name"||v==="contratante")&&(T=T.toLowerCase().split(" ").map(S=>["de","del","la","las","los","el","y","e"].includes(S)?S:S.charAt(0).toUpperCase()+S.slice(1)).join(" "),T=T.replace(/\bDe\b/g,"de"),T=T.replace(/\bDel\b/g,"del"),T=T.replace(/\bLa\b/g,"la"),T=T.replace(/\bY\b/g,"y")),(v==="address"||v==="direccion")&&(Object.entries({"av\\.?":"Avenida","ave\\.?":"Avenida","blvd\\.?":"Boulevard","c\\.?":"Calle","col\\.?":"Colonia","fracc\\.?":"Fraccionamiento","no\\.?":"Número","num\\.?":"Número","#":"Número","int\\.?":"Interior","ext\\.?":"Exterior","depto\\.?":"Departamento","dept\\.?":"Departamento","piso\\.?":"Piso","mz\\.?":"Manzana","lt\\.?":"Lote","km\\.?":"Kilómetro","cp\\.?":"C.P.","c\\.p\\.?":"C.P."}).forEach(([I,H])=>{const te=new RegExp(`\\b${I}\\b`,"gi");T=T.replace(te,H)}),T=T.toLowerCase().split(" ").map(I=>["de","del","la","las","los","el","y","e","con"].includes(I)?I:I.charAt(0).toUpperCase()+I.slice(1)).join(" ")),T=T.replace(/\s+/g," ").replace(/[""]/g,'"').replace(/['']/g,"'").trim(),T}async normalizeAllNamesAndAddresses(){try{console.log("🔄 Starting database normalization...");const r=await this.getTables();console.log(`Found ${r.length} tables to process`);let v=0;const T=[];for(const w of r){console.log(`
📋 Processing table: ${w.name}`);try{const I=(await this.getData(w.name)).data||[];if(!I.length){console.log(`  ⚠️  No data found in ${w.name}`);continue}const H=w.columns.filter(ce=>ce.name.includes("nombre")||ce.name.includes("contratante")||ce.name.includes("propietario")||ce.name.includes("agente")||ce.name.includes("responsable")||ce.name.includes("beneficiario")).map(ce=>ce.name),te=w.columns.filter(ce=>ce.name.includes("direccion")||ce.name.includes("domicilio")||ce.name.includes("ubicacion")||ce.name.includes("origen")||ce.name.includes("destino")).map(ce=>ce.name),ae=w.columns.filter(ce=>ce.name.includes("aseguradora")||ce.name.includes("compania")||ce.name.includes("empresa")).map(ce=>ce.name);console.log(`  📝 Name columns: ${H.join(", ")||"none"}`),console.log(`  🏠 Address columns: ${te.join(", ")||"none"}`),console.log(`  🏢 Company columns: ${ae.join(", ")||"none"}`);let ie=0;for(const ce of I){let me=!1;const _e={};if(H.forEach(Re=>{if(ce[Re]&&typeof ce[Re]=="string"){const Pe=this.normalizeText(ce[Re],"name");Pe!==ce[Re]&&(_e[Re]=Pe,me=!0)}}),te.forEach(Re=>{if(ce[Re]&&typeof ce[Re]=="string"){const Pe=this.normalizeText(ce[Re],"address");Pe!==ce[Re]&&(_e[Re]=Pe,me=!0)}}),ae.forEach(Re=>{if(ce[Re]&&typeof ce[Re]=="string"){const Pe=this.normalizeText(ce[Re],"general");Pe!==ce[Re]&&(_e[Re]=Pe,me=!0)}}),me)try{for(const[Re,Pe]of Object.entries(_e))await this.updateData(w.name,ce.id,Re,Pe);ie++,v++,ie%10===0&&console.log(`    ✅ Updated ${ie} records so far...`)}catch(Re){console.error(`    ❌ Error updating record ${ce.id}:`,Re.message)}}T.push({table:w.name,totalRecords:I.length,updatedRecords:ie,nameColumns:H,addressColumns:te,companyColumns:ae}),console.log(`  ✅ Completed ${w.name}: ${ie}/${I.length} records updated`)}catch(S){console.error(`  ❌ Error processing table ${w.name}:`,S.message),T.push({table:w.name,error:S.message})}}return console.log(`
🎉 Database normalization completed!`),console.log(`📊 Summary: ${v} total records updated across ${r.length} tables`),{success:!0,totalUpdated:v,tablesProcessed:r.length,results:T}}catch(r){throw console.error("❌ Error during database normalization:",r),r}}async normalizeTable(r){try{console.log(`🔄 Starting normalization for table: ${r}`);const T=(await this.getTables()).find(ie=>ie.name===r);if(!T)throw new Error(`Table ${r} not found`);const S=(await this.getData(r)).data||[];if(!S.length)return console.log(`⚠️  No data found in ${r}`),{success:!0,updatedRecords:0,totalRecords:0};const I=T.columns.filter(ie=>ie.name.includes("nombre")||ie.name.includes("contratante")||ie.name.includes("propietario")||ie.name.includes("agente")||ie.name.includes("responsable")||ie.name.includes("beneficiario")).map(ie=>ie.name),H=T.columns.filter(ie=>ie.name.includes("direccion")||ie.name.includes("domicilio")||ie.name.includes("ubicacion")||ie.name.includes("origen")||ie.name.includes("destino")).map(ie=>ie.name),te=T.columns.filter(ie=>ie.name.includes("aseguradora")||ie.name.includes("compania")||ie.name.includes("empresa")).map(ie=>ie.name);console.log(`📝 Name columns: ${I.join(", ")||"none"}`),console.log(`🏠 Address columns: ${H.join(", ")||"none"}`),console.log(`🏢 Company columns: ${te.join(", ")||"none"}`);let ae=0;for(const ie of S){let ce=!1;const me={};if(I.forEach(_e=>{if(ie[_e]&&typeof ie[_e]=="string"){const Re=this.normalizeText(ie[_e],"name");Re!==ie[_e]&&(me[_e]=Re,ce=!0)}}),H.forEach(_e=>{if(ie[_e]&&typeof ie[_e]=="string"){const Re=this.normalizeText(ie[_e],"address");Re!==ie[_e]&&(me[_e]=Re,ce=!0)}}),te.forEach(_e=>{if(ie[_e]&&typeof ie[_e]=="string"){const Re=this.normalizeText(ie[_e],"general");Re!==ie[_e]&&(me[_e]=Re,ce=!0)}}),ce)try{for(const[_e,Re]of Object.entries(me))await this.updateData(r,ie.id,_e,Re);ae++,ae%10===0&&console.log(`✅ Updated ${ae} records so far...`)}catch(_e){console.error(`❌ Error updating record ${ie.id}:`,_e.message)}}return console.log(`✅ Completed ${r}: ${ae}/${S.length} records updated`),{success:!0,tableName:r,totalRecords:S.length,updatedRecords:ae,nameColumns:I,addressColumns:H,companyColumns:te}}catch(v){throw console.error(`❌ Error normalizing table ${r}:`,v),v}}}wa=new WeakMap,Sa=new WeakMap;const tableService=new TableService,usePolicyCount=()=>{const[E,r]=reactExports.useState(0),[v,T]=reactExports.useState(!0),[w,S]=reactExports.useState(null),I=async()=>{T(!0),S(null);try{const te=(await tableService.getTables()).filter(ce=>!ce.isSecondaryTable&&ce.name!=="directorio_contactos");console.log("Fetching policy count from main tables only:",te.map(ce=>ce.name));const ie=(await Promise.all(te.map(async ce=>{var me;try{const Re=((me=(await tableService.getData(ce.name)).data)==null?void 0:me.length)||0;return console.log(`Table ${ce.name}: ${Re} records`),Re}catch(_e){return console.error(`Error fetching from ${ce.name}:`,_e),0}}))).reduce((ce,me)=>ce+me,0);console.log("Total policy count (excluding child tables and directorio):",ie),r(ie)}catch(H){console.error("Error fetching policy count:",H),S("Error al cargar el conteo de pólizas")}finally{T(!1)}};return reactExports.useEffect(()=>{I();const H=()=>{console.log("Policy update detected, refreshing count..."),I()};return window.addEventListener("policyDataUpdated",H),()=>window.removeEventListener("policyDataUpdated",H)},[]),{totalPolicies:E,isLoading:v,error:w,refetch:I}},PolicyCounter=()=>{const{totalPolicies:E,isLoading:r,error:v}=usePolicyCount();return v?jsxRuntimeExports.jsxs("div",{className:"policy-counter error",title:v,children:[jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",stroke:"currentColor",strokeWidth:"2",fill:"none",children:jsxRuntimeExports.jsx("path",{d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.464 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"})}),jsxRuntimeExports.jsx("span",{children:"Error"})]}):jsxRuntimeExports.jsxs("div",{className:"policy-counter",title:"Total de pólizas en todas las tablas",children:[jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",stroke:"currentColor",strokeWidth:"2",fill:"none",children:jsxRuntimeExports.jsx("path",{d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V19.5a2.25 2.25 0 002.25 2.25h5.25a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25h1.5a2.251 2.251 0 012.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V19.5a2.25 2.25 0 002.25 2.25h5.25a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08"})}),jsxRuntimeExports.jsx("span",{className:"counter-label",children:"Total Pólizas:"}),jsxRuntimeExports.jsx("span",{className:"counter-value",children:r?jsxRuntimeExports.jsx("span",{className:"loading-dots",children:"..."}):E.toLocaleString()})]})},SupportChat=()=>{const[E,r]=reactExports.useState(!1),[v,T]=reactExports.useState([{id:1,type:"bot",content:"¡Hola! Soy tu asistente de soporte para el CRM CASIN Seguros. Puedo ayudarte con cualquier pregunta sobre navegación, funcionalidades y uso del sistema. ¿En qué puedo ayudarte?",timestamp:new Date}]),[w,S]=reactExports.useState(""),[I,H]=reactExports.useState(!1),te=reactExports.useRef(null),ae=reactExports.useRef(null),ie=()=>{var Me;(Me=te.current)==null||Me.scrollIntoView({behavior:"smooth"})};reactExports.useEffect(()=>{ie()},[v]),reactExports.useEffect(()=>{E&&ae.current&&ae.current.focus()},[E]);const ce=async()=>{if(!w.trim()||I)return;const Me={id:Date.now(),type:"user",content:w.trim(),timestamp:new Date};T(Ve=>[...Ve,Me]),S(""),H(!0);try{const Ve=await fetch("/api/support-chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:Me.content,conversationHistory:v.slice(-10)})});if(!Ve.ok)throw new Error("Error en la respuesta del servidor");const We=await Ve.json(),ze={id:Date.now()+1,type:"bot",content:We.response,timestamp:new Date};T(Ue=>[...Ue,ze])}catch(Ve){console.error("Error sending message:",Ve);const We={id:Date.now()+1,type:"bot",content:"Lo siento, hubo un error al procesar tu mensaje. Por favor, intenta de nuevo o contacta al equipo de soporte técnico.",timestamp:new Date};T(ze=>[...ze,We])}finally{H(!1)}},me=Me=>{Me.key==="Enter"&&!Me.shiftKey&&(Me.preventDefault(),ce())},_e=()=>{r(!E)},Re=()=>{T([{id:1,type:"bot",content:"¡Hola! Soy tu asistente de soporte para el CRM CASIN Seguros. Puedo ayudarte con cualquier pregunta sobre navegación, funcionalidades y uso del sistema. ¿En qué puedo ayudarte?",timestamp:new Date}])},Pe=Me=>Me.toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),Ce=["¿Cómo navegar al módulo de Directorio?","¿Cómo filtrar contactos por estado?","¿Cómo ver las pólizas de un cliente?","¿Cómo usar la paginación avanzada?","¿Qué hacer si no aparecen datos?"],Fe=Me=>{S(Me),ae.current&&ae.current.focus()};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:`support-chat-toggle ${E?"open":""}`,onClick:_e,children:[E?jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})}):jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h4l4 4 4-4h4c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"})}),jsxRuntimeExports.jsx("span",{className:"chat-badge",children:"Soporte"})]}),E&&jsxRuntimeExports.jsxs("div",{className:"support-chat-window",children:[jsxRuntimeExports.jsxs("div",{className:"chat-header",children:[jsxRuntimeExports.jsxs("div",{className:"chat-header-info",children:[jsxRuntimeExports.jsx("div",{className:"chat-avatar",children:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})})}),jsxRuntimeExports.jsxs("div",{className:"chat-title",children:[jsxRuntimeExports.jsx("h4",{children:"Soporte CRM"}),jsxRuntimeExports.jsx("span",{className:"chat-status",children:"En línea"})]})]}),jsxRuntimeExports.jsxs("div",{className:"chat-actions",children:[jsxRuntimeExports.jsx("button",{onClick:Re,className:"chat-action-btn",title:"Limpiar chat",children:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})})}),jsxRuntimeExports.jsx("button",{onClick:_e,className:"chat-action-btn",title:"Cerrar chat",children:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})})})]})]}),jsxRuntimeExports.jsxs("div",{className:"chat-messages",children:[v.map(Me=>jsxRuntimeExports.jsx("div",{className:`message ${Me.type}`,children:jsxRuntimeExports.jsxs("div",{className:"message-content",children:[jsxRuntimeExports.jsx("p",{children:Me.content}),jsxRuntimeExports.jsx("span",{className:"message-time",children:Pe(Me.timestamp)})]})},Me.id)),I&&jsxRuntimeExports.jsx("div",{className:"message bot",children:jsxRuntimeExports.jsx("div",{className:"message-content",children:jsxRuntimeExports.jsxs("div",{className:"typing-indicator",children:[jsxRuntimeExports.jsx("span",{}),jsxRuntimeExports.jsx("span",{}),jsxRuntimeExports.jsx("span",{})]})})}),jsxRuntimeExports.jsx("div",{ref:te})]}),v.length===1&&jsxRuntimeExports.jsxs("div",{className:"quick-questions",children:[jsxRuntimeExports.jsx("p",{className:"quick-questions-title",children:"Preguntas frecuentes:"}),Ce.map((Me,Ve)=>jsxRuntimeExports.jsx("button",{className:"quick-question-btn",onClick:()=>Fe(Me),children:Me},Ve))]}),jsxRuntimeExports.jsxs("div",{className:"chat-input",children:[jsxRuntimeExports.jsxs("div",{className:"input-container",children:[jsxRuntimeExports.jsx("textarea",{ref:ae,value:w,onChange:Me=>S(Me.target.value),onKeyPress:me,placeholder:"Escribe tu pregunta sobre el CRM...",rows:"1",disabled:I}),jsxRuntimeExports.jsx("button",{onClick:ce,disabled:!w.trim()||I,className:"send-button",children:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})})})]}),jsxRuntimeExports.jsx("div",{className:"chat-footer",children:jsxRuntimeExports.jsx("span",{children:"Powered by GPT-4o-mini • Soporte CRM CASIN"})})]})]})]})},logoImage="/logo.png",Layout=({children:E})=>{const{theme:r,toggleTheme:v}=useTheme(),{user:T,logout:w}=useAuth();return jsxRuntimeExports.jsxs("div",{className:"layout",children:[jsxRuntimeExports.jsxs("header",{className:"top-bar",children:[jsxRuntimeExports.jsxs("div",{className:"left-section",children:[jsxRuntimeExports.jsxs(NavLink,{to:"/",className:"logo",children:[jsxRuntimeExports.jsx("img",{src:logoImage,alt:"CASIN Seguros Logo",className:"logo-image"}),jsxRuntimeExports.jsxs("div",{className:"logo-content",children:[jsxRuntimeExports.jsx("span",{className:"logo-text",children:"CASIN"})," ",jsxRuntimeExports.jsx("span",{className:"logo-version",children:"Seguros"})]})]}),jsxRuntimeExports.jsxs("nav",{className:"top-nav",children:[jsxRuntimeExports.jsxs(NavLink,{to:"/",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"nav-icon",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"})}),jsxRuntimeExports.jsx("span",{children:"Dashboard"})]}),jsxRuntimeExports.jsxs(NavLink,{to:"/tasks",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"nav-icon",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V19.5a2.25 2.25 0 002.25 2.25h5.25a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25h1.5a2.251 2.251 0 012.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V19.5a2.25 2.25 0 002.25 2.25h5.25a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25h1.5a2.251 2.251 0 012.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V19.5a2.25 2.25 0 002.25 2.25h5.25a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08"})}),jsxRuntimeExports.jsx("span",{children:"Tareas"})]}),jsxRuntimeExports.jsxs(NavLink,{to:"/data",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"nav-icon",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125"})}),jsxRuntimeExports.jsx("span",{children:"Data"})]}),jsxRuntimeExports.jsxs(NavLink,{to:"/reports",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"nav-icon",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.5 14.25v2.25m3-4.5v4.5m3-6.75v6.75m3-9v9M6 20.25h12A2.25 2.25 0 0020.25 18V6A2.25 2.25 0 0018 3.75H6A2.25 2.25 0 003.75 6v12A2.25 2.25 0 006 20.25z"})}),jsxRuntimeExports.jsx("span",{children:"Reportes"})]}),jsxRuntimeExports.jsxs(NavLink,{to:"/drive",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"nav-icon",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 12.75V12A2.25 2.25 0 014.5 9.75h15A2.25 2.25 0 0121.75 12v.75m-8.69-6.44l-2.12-2.12a1.5 1.5 0 00-1.061-.44H4.5A2.25 2.25 0 002.25 6v12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9a2.25 2.25 0 00-2.25-2.25h-5.379a1.5 1.5 0 01-1.06-.44z"})}),jsxRuntimeExports.jsx("span",{children:"Drive"})]}),jsxRuntimeExports.jsxs(NavLink,{to:"/birthdays",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"nav-icon",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 8.25v-1.5m0 1.5c-1.355 0-2.697.056-4.024.166C6.845 8.51 6 9.473 6 10.608v2.513m6-4.87c1.355 0 2.697.055 4.024.165C17.155 8.51 18 9.473 18 10.608v2.513m-3-4.87v-1.5m-6 1.5v-1.5m12 9.75l-1.5.75a3.354 3.354 0 01-3 0 3.354 3.354 0 00-3 0 3.354 3.354 0 01-3 0 3.354 3.354 0 00-3 0 3.354 3.354 0 01-3 0L3 16.5m15-3.38a48.474 48.474 0 00-6-.37c-2.032 0-4.034.125-6 .37m12 0c.39.049.777.102 1.163.16 1.07.16 1.837 1.094 1.837 2.175v5.17c0 .62-.504 1.124-1.125 1.124H4.125A1.125 1.125 0 013 20.625v-5.17c0-1.08.768-2.014 1.837-2.174A47.78 47.78 0 016 13.12M12.265 3.11a.375.375 0 11-.53 0L12 2.845l.265.265zm-3 0a.375.375 0 11-.53 0L9 2.845l.265.265zm6 0a.375.375 0 11-.53 0L15 2.845l.265.265z"})}),jsxRuntimeExports.jsx("span",{children:"Cumpleaños"})]}),jsxRuntimeExports.jsxs(NavLink,{to:"/directorio",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"nav-icon",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"})}),jsxRuntimeExports.jsx("span",{children:"Directorio"})]})]})]}),jsxRuntimeExports.jsx("div",{className:"right-section",children:jsxRuntimeExports.jsxs("div",{className:"user-section",children:[jsxRuntimeExports.jsx(PolicyCounter,{}),jsxRuntimeExports.jsx("span",{className:"user-email",children:T==null?void 0:T.email}),jsxRuntimeExports.jsx("button",{className:"logout-button",onClick:w,children:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",stroke:"currentColor",strokeWidth:"2",fill:"none",children:jsxRuntimeExports.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9"})})}),jsxRuntimeExports.jsx("button",{className:"theme-toggle",onClick:v,title:"Toggle theme",children:r==="dark"?jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",stroke:"currentColor",strokeWidth:"2",fill:"none",children:jsxRuntimeExports.jsx("path",{d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})}):jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",width:"24",height:"24",stroke:"currentColor",strokeWidth:"2",fill:"none",children:jsxRuntimeExports.jsx("path",{d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})})]})})]}),jsxRuntimeExports.jsx("main",{className:"main-content",children:E}),jsxRuntimeExports.jsx(SupportChat,{})]})},Weather=()=>{const[E,r]=reactExports.useState(null),[v,T]=reactExports.useState(!0),[w,S]=reactExports.useState(null),[I,H]=reactExports.useState(null),[te,ae]=reactExports.useState("Cargando ubicación...");return reactExports.useEffect(()=>{const ie=()=>{if(console.log("Obteniendo ubicación..."),!navigator.geolocation){S("Tu navegador no soporta geolocalización"),T(!1);return}navigator.geolocation.getCurrentPosition(me=>{console.log("Ubicación recibida:",me.coords),H({lat:me.coords.latitude,lon:me.coords.longitude}),ce(me.coords.latitude,me.coords.longitude)},me=>{console.error("Error de geolocalización:",me),S("No se pudo obtener tu ubicación. Usando ubicación predeterminada."),H({lat:19.4326,lon:-99.1332}),ae("Ciudad de México")},{timeout:5e3,maximumAge:0})},ce=async(me,_e)=>{try{const Pe=await(await fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${me}&longitude=${_e}&localityLanguage=es`)).json(),Ce=Pe.city||Pe.locality||Pe.principalSubdivision;ae(Ce||"Ubicación desconocida")}catch(Re){console.error("Error getting city name:",Re),ae("Ubicación no disponible")}};ie()},[]),reactExports.useEffect(()=>{(async()=>{if(!I){console.log("Ubicación no disponible aún");return}console.log("Obteniendo clima para:",I);try{T(!0);const ce=`https://api.open-meteo.com/v1/forecast?latitude=${I.lat}&longitude=${I.lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,wind_speed_10m`;console.log("Consultando URL:",ce);const me=await fetch(ce);if(console.log("Estado de respuesta:",me.status),!me.ok)throw new Error(`Datos del clima no disponibles (${me.status})`);const _e=await me.json();if(console.log("Datos del clima recibidos:",_e),!_e.current)throw new Error("Formato de datos del clima inválido");r({temp:Math.round(_e.current.temperature_2m),humidity:_e.current.relative_humidity_2m,windSpeed:Math.round(_e.current.wind_speed_10m),feelsLike:Math.round(_e.current.apparent_temperature)}),S(null)}catch(ce){console.error("Error en API del clima:",ce),S("No se pudo obtener el clima: "+ce.message)}finally{T(!1)}})()},[I]),console.log("Estado del renderizado:",{loading:v,error:w,weather:E,location:I,cityName:te}),v?jsxRuntimeExports.jsxs("div",{className:"weather-widget loading",children:[jsxRuntimeExports.jsx("div",{className:"loading-spinner"}),jsxRuntimeExports.jsx("p",{className:"loading-text",children:"Cargando datos del clima..."})]}):w?jsxRuntimeExports.jsxs("div",{className:"weather-widget error",children:[jsxRuntimeExports.jsx("p",{children:w}),jsxRuntimeExports.jsx("button",{onClick:()=>window.location.reload(),className:"retry-button",children:"Reintentar"})]}):jsxRuntimeExports.jsxs("div",{className:"weather-widget",children:[jsxRuntimeExports.jsxs("div",{className:"weather-main",children:[jsxRuntimeExports.jsx("div",{className:"location",children:te}),jsxRuntimeExports.jsxs("div",{className:"weather-info",children:[jsxRuntimeExports.jsxs("div",{className:"temperature",children:[E==null?void 0:E.temp,"°C"]}),jsxRuntimeExports.jsxs("div",{className:"feels-like",children:["Sensación térmica: ",E==null?void 0:E.feelsLike,"°C"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"weather-details",children:[jsxRuntimeExports.jsxs("div",{className:"detail",children:[jsxRuntimeExports.jsx("span",{className:"label",children:"Humedad"}),jsxRuntimeExports.jsxs("span",{className:"value",children:[E==null?void 0:E.humidity,"%"]})]}),jsxRuntimeExports.jsxs("div",{className:"detail",children:[jsxRuntimeExports.jsx("span",{className:"label",children:"Viento"}),jsxRuntimeExports.jsxs("span",{className:"value",children:[E==null?void 0:E.windSpeed," km/h"]})]})]})]})},API_BASE_URL$4=API_URL,fetchBirthdays=async()=>{try{const E=await fetch(`${API_BASE_URL$4}/birthday`);if(!E.ok)throw new Error("Failed to fetch birthdays");return await E.json()}catch(E){return console.error("Error fetching birthdays:",E),[]}},triggerBirthdayEmails=async()=>{try{console.log("Triggering birthday emails check...");const E=await fetch(`${API_BASE_URL$4}/birthday/check-and-send`,{method:"POST"}),r=await E.json();if(!E.ok)throw console.error("Server error details:",r),new Error(r.error||"Failed to trigger birthday emails");return console.log("Birthday emails triggered successfully:",r),r}catch(E){throw console.error("Error triggering birthday emails:",E),E}},MESES=["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],MONTHS$1=["January","February","March","April","May","June","July","August","September","October","November","December"],parseDate$1=E=>{if(!E)return null;let r=new Date(E);if(!isNaN(r.getTime()))return r;if(typeof E=="string"){const v=E.split("/").map(T=>T.trim());if(v.length===3){const[T,w,S]=v.map(I=>parseInt(I,10));if(!isNaN(T)&&!isNaN(w)&&!isNaN(S)&&(r=new Date(S,w-1,T),!isNaN(r.getTime())))return r}}return null},formatDate=(E,r="long-es")=>{if(!E)return"Sin fecha";const v=typeof E=="string"?parseDate$1(E):new Date(E);if(!v||isNaN(v.getTime()))return"Fecha inválida";const T=v.getDate(),w=v.getMonth(),S=v.getFullYear(),I=S.toString().slice(-2);switch(r){case"long-es":return`${T} de ${MESES[w]} ${S}`;case"long-en":return`${T} ${MONTHS$1[w]} ${S}`;case"short":return`${T}/${w+1}/${I}`;case"medium":return`${T}/${w+1}/${S}`;case"iso":const H=(w+1).toString().padStart(2,"0"),te=T.toString().padStart(2,"0");return`${S}-${H}-${te}`;default:return`${T}/${w+1}/${S}`}},Dashboard=()=>{const[E,r]=reactExports.useState([]),[v,T]=reactExports.useState([]),[w,S]=reactExports.useState({birthdays:!0,expirations:!0}),[I,H]=reactExports.useState({birthdays:null,expirations:null}),[te,ae]=reactExports.useState(!1);reactExports.useEffect(()=>{ie(),ce()},[]);const ie=async()=>{try{S(Fe=>({...Fe,birthdays:!0}));const me=new Date,_e=me.getMonth(),Re=me.getDate(),Pe=await fetchBirthdays();if(!Array.isArray(Pe))throw new Error("Invalid birthday data received");const Ce=Pe.filter(Fe=>{if(!(Fe!=null&&Fe.date))return!1;const Me=new Date(Fe.date);return Me.getTime()?Me.getMonth()===_e&&Me.getDate()===Re:!1}).sort((Fe,Me)=>{const Ve=new Date(Fe.date),We=new Date(Me.date);return Ve.getDate()-We.getDate()});r(Ce),H(Fe=>({...Fe,birthdays:null}))}catch(me){console.error("Error loading birthdays:",me),H(_e=>({..._e,birthdays:"Error al cargar los cumpleaños"})),r([])}finally{S(me=>({...me,birthdays:!1}))}},ce=async()=>{try{S(ze=>({...ze,expirations:!0}));const[me,_e]=await Promise.all([tableService.getData("gmm").catch(ze=>({data:[]})),tableService.getData("autos").catch(ze=>({data:[]}))]),Re=(me.data||[]).map(ze=>({numero_poliza:ze.n__mero_de_p__liza,contratante:ze.contratante,fecha_fin:ze.vigencia__fin_,aseguradora:ze.aseguradora,tipo:"GMM"})),Pe=(_e.data||[]).map(ze=>({numero_poliza:ze.numero_de_poliza,contratante:ze.nombre_contratante,fecha_fin:ze.vigencia_fin,aseguradora:ze.aseguradora,tipo:"Auto"})),Ce=new Date,Fe=Ce.getMonth(),Me=Ce.getFullYear(),We=[...Re,...Pe].filter(ze=>{if(!(ze!=null&&ze.fecha_fin))return!1;const Ue=new Date(ze.fecha_fin);return Ue.getTime()?Ue.getMonth()===Fe&&Ue.getFullYear()===Me:!1}).sort((ze,Ue)=>{const je=new Date(ze.fecha_fin),ke=new Date(Ue.fecha_fin);return je-ke});console.log("Vencimientos encontrados:",We.map(ze=>({poliza:ze.numero_poliza,fecha:ze.fecha_fin,contratante:ze.contratante}))),T(We),H(ze=>({...ze,expirations:null}))}catch(me){console.error("Error loading expirations:",me),H(_e=>({..._e,expirations:"Error al cargar los vencimientos"})),T([])}finally{S(me=>({...me,expirations:!1}))}};return jsxRuntimeExports.jsxs("div",{className:"dashboard",children:[jsxRuntimeExports.jsx("h1",{className:"dashboard-title",children:"Dashboard"}),jsxRuntimeExports.jsxs("div",{className:"dashboard-grid",children:[jsxRuntimeExports.jsxs("div",{className:"dashboard-card",children:[jsxRuntimeExports.jsx("div",{className:"card-header",children:jsxRuntimeExports.jsx("h3",{children:"Clima"})}),jsxRuntimeExports.jsx("div",{className:"card-content",children:jsxRuntimeExports.jsx(Weather,{})})]}),jsxRuntimeExports.jsxs("div",{className:"dashboard-card",children:[jsxRuntimeExports.jsx("div",{className:"card-header",children:jsxRuntimeExports.jsx("h3",{children:"Cumpleaños de la Semana"})}),jsxRuntimeExports.jsx("div",{className:"card-content",children:w.birthdays?jsxRuntimeExports.jsx("div",{className:"loading-spinner"}):I.birthdays?jsxRuntimeExports.jsx("div",{className:"error-message",children:I.birthdays}):E.length===0?jsxRuntimeExports.jsx("p",{className:"no-birthdays",children:"No hay cumpleaños esta semana"}):jsxRuntimeExports.jsxs("div",{className:"birthday-list",children:[E.slice(0,3).map(me=>{const _e=new Date(me.date),Pe=new Date(new Date().getFullYear(),_e.getMonth(),_e.getDate()).toLocaleDateString("es-ES",{weekday:"long"});return jsxRuntimeExports.jsxs("div",{className:"birthday-item",children:[jsxRuntimeExports.jsxs("div",{className:"birthday-info",children:[jsxRuntimeExports.jsx("span",{className:"birthday-name",children:me.name}),jsxRuntimeExports.jsx("span",{className:"birthday-date",children:Pe.charAt(0).toUpperCase()+Pe.slice(1)}),jsxRuntimeExports.jsxs("span",{className:"birthday-age",children:["Cumple: ",me.age+1," años"]})]}),me.email&&jsxRuntimeExports.jsxs("div",{className:"birthday-email",children:[jsxRuntimeExports.jsx("span",{className:"email-icon",children:"📧"}),me.email]})]},me.id||me.rfc)}),E.length>3&&jsxRuntimeExports.jsxs(Link,{to:"/birthdays",className:"view-more-link",children:["Ver más (",E.length-3," más)"]})]})})]}),jsxRuntimeExports.jsxs("div",{className:"dashboard-card",children:[jsxRuntimeExports.jsx("div",{className:"card-header",children:jsxRuntimeExports.jsx("h3",{children:"Vencimientos del mes"})}),jsxRuntimeExports.jsx("div",{className:"card-content",children:w.expirations?jsxRuntimeExports.jsx("div",{className:"loading-spinner"}):I.expirations?jsxRuntimeExports.jsx("div",{className:"error-message",children:I.expirations}):v.length===0?jsxRuntimeExports.jsx("p",{className:"no-expirations",children:"No hay vencimientos este mes"}):jsxRuntimeExports.jsxs("div",{className:"expiration-list",children:[(te?v:v.slice(0,2)).map(me=>jsxRuntimeExports.jsxs("div",{className:"expiration-item",children:[jsxRuntimeExports.jsxs("div",{className:"expiration-info",children:[jsxRuntimeExports.jsx("span",{className:"expiration-type",children:me.tipo}),jsxRuntimeExports.jsx("span",{className:"expiration-policy",children:me.numero_poliza})]}),jsxRuntimeExports.jsxs("div",{className:"expiration-details",children:[jsxRuntimeExports.jsx("span",{className:"expiration-name",children:me.contratante}),jsxRuntimeExports.jsxs("span",{className:"expiration-date",children:["Vence: ",formatDate(me.fecha_fin,"long-es")]})]})]},`${me.tipo}-${me.numero_poliza}`)),v.length>2&&jsxRuntimeExports.jsx("button",{onClick:()=>ae(!te),className:"toggle-view-btn",children:te?"Ver menos":`Ver más (${v.length-2} más)`})]})})]}),jsxRuntimeExports.jsxs("div",{className:"dashboard-card",children:[jsxRuntimeExports.jsx("div",{className:"card-header",children:jsxRuntimeExports.jsx("h3",{children:"Actividad Reciente"})}),jsxRuntimeExports.jsx("div",{className:"card-content",children:jsxRuntimeExports.jsxs("div",{className:"activity-list",children:[jsxRuntimeExports.jsxs("div",{className:"activity-item",children:[jsxRuntimeExports.jsx("span",{className:"activity-time",children:"2m atrás"}),jsxRuntimeExports.jsx("span",{className:"activity-text",children:"Nuevo registro añadido"})]}),jsxRuntimeExports.jsxs("div",{className:"activity-item",children:[jsxRuntimeExports.jsx("span",{className:"activity-time",children:"1h atrás"}),jsxRuntimeExports.jsx("span",{className:"activity-text",children:"Datos actualizados"})]}),jsxRuntimeExports.jsxs("div",{className:"activity-item",children:[jsxRuntimeExports.jsx("span",{className:"activity-time",children:"3h atrás"}),jsxRuntimeExports.jsx("span",{className:"activity-text",children:"Respaldo del sistema"})]})]})})]})]})]})};function useCombinedRefs(){for(var E=arguments.length,r=new Array(E),v=0;v<E;v++)r[v]=arguments[v];return reactExports.useMemo(()=>T=>{r.forEach(w=>w(T))},r)}const canUseDOM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function isWindow(E){const r=Object.prototype.toString.call(E);return r==="[object Window]"||r==="[object global]"}function isNode$1(E){return"nodeType"in E}function getWindow(E){var r,v;return E?isWindow(E)?E:isNode$1(E)&&(r=(v=E.ownerDocument)==null?void 0:v.defaultView)!=null?r:window:window}function isDocument(E){const{Document:r}=getWindow(E);return E instanceof r}function isHTMLElement(E){return isWindow(E)?!1:E instanceof getWindow(E).HTMLElement}function isSVGElement(E){return E instanceof getWindow(E).SVGElement}function getOwnerDocument(E){return E?isWindow(E)?E.document:isNode$1(E)?isDocument(E)?E:isHTMLElement(E)||isSVGElement(E)?E.ownerDocument:document:document:document}const useIsomorphicLayoutEffect=canUseDOM?reactExports.useLayoutEffect:reactExports.useEffect;function useEvent(E){const r=reactExports.useRef(E);return useIsomorphicLayoutEffect(()=>{r.current=E}),reactExports.useCallback(function(){for(var v=arguments.length,T=new Array(v),w=0;w<v;w++)T[w]=arguments[w];return r.current==null?void 0:r.current(...T)},[])}function useInterval(){const E=reactExports.useRef(null),r=reactExports.useCallback((T,w)=>{E.current=setInterval(T,w)},[]),v=reactExports.useCallback(()=>{E.current!==null&&(clearInterval(E.current),E.current=null)},[]);return[r,v]}function useLatestValue(E,r){r===void 0&&(r=[E]);const v=reactExports.useRef(E);return useIsomorphicLayoutEffect(()=>{v.current!==E&&(v.current=E)},r),v}function useLazyMemo(E,r){const v=reactExports.useRef();return reactExports.useMemo(()=>{const T=E(v.current);return v.current=T,T},[...r])}function useNodeRef(E){const r=useEvent(E),v=reactExports.useRef(null),T=reactExports.useCallback(w=>{w!==v.current&&(r==null||r(w,v.current)),v.current=w},[]);return[v,T]}function usePrevious(E){const r=reactExports.useRef();return reactExports.useEffect(()=>{r.current=E},[E]),r.current}let ids={};function useUniqueId(E,r){return reactExports.useMemo(()=>{if(r)return r;const v=ids[E]==null?0:ids[E]+1;return ids[E]=v,E+"-"+v},[E,r])}function createAdjustmentFn(E){return function(r){for(var v=arguments.length,T=new Array(v>1?v-1:0),w=1;w<v;w++)T[w-1]=arguments[w];return T.reduce((S,I)=>{const H=Object.entries(I);for(const[te,ae]of H){const ie=S[te];ie!=null&&(S[te]=ie+E*ae)}return S},{...r})}}const add=createAdjustmentFn(1),subtract=createAdjustmentFn(-1);function hasViewportRelativeCoordinates(E){return"clientX"in E&&"clientY"in E}function isKeyboardEvent(E){if(!E)return!1;const{KeyboardEvent:r}=getWindow(E.target);return r&&E instanceof r}function isTouchEvent(E){if(!E)return!1;const{TouchEvent:r}=getWindow(E.target);return r&&E instanceof r}function getEventCoordinates(E){if(isTouchEvent(E)){if(E.touches&&E.touches.length){const{clientX:r,clientY:v}=E.touches[0];return{x:r,y:v}}else if(E.changedTouches&&E.changedTouches.length){const{clientX:r,clientY:v}=E.changedTouches[0];return{x:r,y:v}}}return hasViewportRelativeCoordinates(E)?{x:E.clientX,y:E.clientY}:null}const CSS$1=Object.freeze({Translate:{toString(E){if(!E)return;const{x:r,y:v}=E;return"translate3d("+(r?Math.round(r):0)+"px, "+(v?Math.round(v):0)+"px, 0)"}},Scale:{toString(E){if(!E)return;const{scaleX:r,scaleY:v}=E;return"scaleX("+r+") scaleY("+v+")"}},Transform:{toString(E){if(E)return[CSS$1.Translate.toString(E),CSS$1.Scale.toString(E)].join(" ")}},Transition:{toString(E){let{property:r,duration:v,easing:T}=E;return r+" "+v+"ms "+T}}}),SELECTOR="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function findFirstFocusableNode(E){return E.matches(SELECTOR)?E:E.querySelector(SELECTOR)}const hiddenStyles={display:"none"};function HiddenText(E){let{id:r,value:v}=E;return React.createElement("div",{id:r,style:hiddenStyles},v)}function LiveRegion(E){let{id:r,announcement:v,ariaLiveType:T="assertive"}=E;const w={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return React.createElement("div",{id:r,style:w,role:"status","aria-live":T,"aria-atomic":!0},v)}function useAnnouncement(){const[E,r]=reactExports.useState("");return{announce:reactExports.useCallback(T=>{T!=null&&r(T)},[]),announcement:E}}const DndMonitorContext=reactExports.createContext(null);function useDndMonitor(E){const r=reactExports.useContext(DndMonitorContext);reactExports.useEffect(()=>{if(!r)throw new Error("useDndMonitor must be used within a children of <DndContext>");return r(E)},[E,r])}function useDndMonitorProvider(){const[E]=reactExports.useState(()=>new Set),r=reactExports.useCallback(T=>(E.add(T),()=>E.delete(T)),[E]);return[reactExports.useCallback(T=>{let{type:w,event:S}=T;E.forEach(I=>{var H;return(H=I[w])==null?void 0:H.call(I,S)})},[E]),r]}const defaultScreenReaderInstructions={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},defaultAnnouncements={onDragStart(E){let{active:r}=E;return"Picked up draggable item "+r.id+"."},onDragOver(E){let{active:r,over:v}=E;return v?"Draggable item "+r.id+" was moved over droppable area "+v.id+".":"Draggable item "+r.id+" is no longer over a droppable area."},onDragEnd(E){let{active:r,over:v}=E;return v?"Draggable item "+r.id+" was dropped over droppable area "+v.id:"Draggable item "+r.id+" was dropped."},onDragCancel(E){let{active:r}=E;return"Dragging was cancelled. Draggable item "+r.id+" was dropped."}};function Accessibility(E){let{announcements:r=defaultAnnouncements,container:v,hiddenTextDescribedById:T,screenReaderInstructions:w=defaultScreenReaderInstructions}=E;const{announce:S,announcement:I}=useAnnouncement(),H=useUniqueId("DndLiveRegion"),[te,ae]=reactExports.useState(!1);if(reactExports.useEffect(()=>{ae(!0)},[]),useDndMonitor(reactExports.useMemo(()=>({onDragStart(ce){let{active:me}=ce;S(r.onDragStart({active:me}))},onDragMove(ce){let{active:me,over:_e}=ce;r.onDragMove&&S(r.onDragMove({active:me,over:_e}))},onDragOver(ce){let{active:me,over:_e}=ce;S(r.onDragOver({active:me,over:_e}))},onDragEnd(ce){let{active:me,over:_e}=ce;S(r.onDragEnd({active:me,over:_e}))},onDragCancel(ce){let{active:me,over:_e}=ce;S(r.onDragCancel({active:me,over:_e}))}}),[S,r])),!te)return null;const ie=React.createElement(React.Fragment,null,React.createElement(HiddenText,{id:T,value:w.draggable}),React.createElement(LiveRegion,{id:H,announcement:I}));return v?reactDomExports.createPortal(ie,v):ie}var Action;(function(E){E.DragStart="dragStart",E.DragMove="dragMove",E.DragEnd="dragEnd",E.DragCancel="dragCancel",E.DragOver="dragOver",E.RegisterDroppable="registerDroppable",E.SetDroppableDisabled="setDroppableDisabled",E.UnregisterDroppable="unregisterDroppable"})(Action||(Action={}));function noop(){}function useSensor(E,r){return reactExports.useMemo(()=>({sensor:E,options:r??{}}),[E,r])}function useSensors(){for(var E=arguments.length,r=new Array(E),v=0;v<E;v++)r[v]=arguments[v];return reactExports.useMemo(()=>[...r].filter(T=>T!=null),[...r])}const defaultCoordinates=Object.freeze({x:0,y:0});function distanceBetween(E,r){return Math.sqrt(Math.pow(E.x-r.x,2)+Math.pow(E.y-r.y,2))}function sortCollisionsAsc(E,r){let{data:{value:v}}=E,{data:{value:T}}=r;return v-T}function sortCollisionsDesc(E,r){let{data:{value:v}}=E,{data:{value:T}}=r;return T-v}function cornersOfRectangle(E){let{left:r,top:v,height:T,width:w}=E;return[{x:r,y:v},{x:r+w,y:v},{x:r,y:v+T},{x:r+w,y:v+T}]}function getFirstCollision(E,r){if(!E||E.length===0)return null;const[v]=E;return v[r]}function centerOfRectangle(E,r,v){return r===void 0&&(r=E.left),v===void 0&&(v=E.top),{x:r+E.width*.5,y:v+E.height*.5}}const closestCenter=E=>{let{collisionRect:r,droppableRects:v,droppableContainers:T}=E;const w=centerOfRectangle(r,r.left,r.top),S=[];for(const I of T){const{id:H}=I,te=v.get(H);if(te){const ae=distanceBetween(centerOfRectangle(te),w);S.push({id:H,data:{droppableContainer:I,value:ae}})}}return S.sort(sortCollisionsAsc)},closestCorners=E=>{let{collisionRect:r,droppableRects:v,droppableContainers:T}=E;const w=cornersOfRectangle(r),S=[];for(const I of T){const{id:H}=I,te=v.get(H);if(te){const ae=cornersOfRectangle(te),ie=w.reduce((me,_e,Re)=>me+distanceBetween(ae[Re],_e),0),ce=Number((ie/4).toFixed(4));S.push({id:H,data:{droppableContainer:I,value:ce}})}}return S.sort(sortCollisionsAsc)};function getIntersectionRatio(E,r){const v=Math.max(r.top,E.top),T=Math.max(r.left,E.left),w=Math.min(r.left+r.width,E.left+E.width),S=Math.min(r.top+r.height,E.top+E.height),I=w-T,H=S-v;if(T<w&&v<S){const te=r.width*r.height,ae=E.width*E.height,ie=I*H,ce=ie/(te+ae-ie);return Number(ce.toFixed(4))}return 0}const rectIntersection=E=>{let{collisionRect:r,droppableRects:v,droppableContainers:T}=E;const w=[];for(const S of T){const{id:I}=S,H=v.get(I);if(H){const te=getIntersectionRatio(H,r);te>0&&w.push({id:I,data:{droppableContainer:S,value:te}})}}return w.sort(sortCollisionsDesc)};function adjustScale(E,r,v){return{...E,scaleX:r&&v?r.width/v.width:1,scaleY:r&&v?r.height/v.height:1}}function getRectDelta(E,r){return E&&r?{x:E.left-r.left,y:E.top-r.top}:defaultCoordinates}function createRectAdjustmentFn(E){return function(v){for(var T=arguments.length,w=new Array(T>1?T-1:0),S=1;S<T;S++)w[S-1]=arguments[S];return w.reduce((I,H)=>({...I,top:I.top+E*H.y,bottom:I.bottom+E*H.y,left:I.left+E*H.x,right:I.right+E*H.x}),{...v})}}const getAdjustedRect=createRectAdjustmentFn(1);function parseTransform(E){if(E.startsWith("matrix3d(")){const r=E.slice(9,-1).split(/, /);return{x:+r[12],y:+r[13],scaleX:+r[0],scaleY:+r[5]}}else if(E.startsWith("matrix(")){const r=E.slice(7,-1).split(/, /);return{x:+r[4],y:+r[5],scaleX:+r[0],scaleY:+r[3]}}return null}function inverseTransform(E,r,v){const T=parseTransform(r);if(!T)return E;const{scaleX:w,scaleY:S,x:I,y:H}=T,te=E.left-I-(1-w)*parseFloat(v),ae=E.top-H-(1-S)*parseFloat(v.slice(v.indexOf(" ")+1)),ie=w?E.width/w:E.width,ce=S?E.height/S:E.height;return{width:ie,height:ce,top:ae,right:te+ie,bottom:ae+ce,left:te}}const defaultOptions={ignoreTransform:!1};function getClientRect(E,r){r===void 0&&(r=defaultOptions);let v=E.getBoundingClientRect();if(r.ignoreTransform){const{transform:ae,transformOrigin:ie}=getWindow(E).getComputedStyle(E);ae&&(v=inverseTransform(v,ae,ie))}const{top:T,left:w,width:S,height:I,bottom:H,right:te}=v;return{top:T,left:w,width:S,height:I,bottom:H,right:te}}function getTransformAgnosticClientRect(E){return getClientRect(E,{ignoreTransform:!0})}function getWindowClientRect(E){const r=E.innerWidth,v=E.innerHeight;return{top:0,left:0,right:r,bottom:v,width:r,height:v}}function isFixed(E,r){return r===void 0&&(r=getWindow(E).getComputedStyle(E)),r.position==="fixed"}function isScrollable(E,r){r===void 0&&(r=getWindow(E).getComputedStyle(E));const v=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(w=>{const S=r[w];return typeof S=="string"?v.test(S):!1})}function getScrollableAncestors(E,r){const v=[];function T(w){if(r!=null&&v.length>=r||!w)return v;if(isDocument(w)&&w.scrollingElement!=null&&!v.includes(w.scrollingElement))return v.push(w.scrollingElement),v;if(!isHTMLElement(w)||isSVGElement(w)||v.includes(w))return v;const S=getWindow(E).getComputedStyle(w);return w!==E&&isScrollable(w,S)&&v.push(w),isFixed(w,S)?v:T(w.parentNode)}return E?T(E):v}function getFirstScrollableAncestor(E){const[r]=getScrollableAncestors(E,1);return r??null}function getScrollableElement(E){return!canUseDOM||!E?null:isWindow(E)?E:isNode$1(E)?isDocument(E)||E===getOwnerDocument(E).scrollingElement?window:isHTMLElement(E)?E:null:null}function getScrollXCoordinate(E){return isWindow(E)?E.scrollX:E.scrollLeft}function getScrollYCoordinate(E){return isWindow(E)?E.scrollY:E.scrollTop}function getScrollCoordinates(E){return{x:getScrollXCoordinate(E),y:getScrollYCoordinate(E)}}var Direction;(function(E){E[E.Forward=1]="Forward",E[E.Backward=-1]="Backward"})(Direction||(Direction={}));function isDocumentScrollingElement(E){return!canUseDOM||!E?!1:E===document.scrollingElement}function getScrollPosition(E){const r={x:0,y:0},v=isDocumentScrollingElement(E)?{height:window.innerHeight,width:window.innerWidth}:{height:E.clientHeight,width:E.clientWidth},T={x:E.scrollWidth-v.width,y:E.scrollHeight-v.height},w=E.scrollTop<=r.y,S=E.scrollLeft<=r.x,I=E.scrollTop>=T.y,H=E.scrollLeft>=T.x;return{isTop:w,isLeft:S,isBottom:I,isRight:H,maxScroll:T,minScroll:r}}const defaultThreshold={x:.2,y:.2};function getScrollDirectionAndSpeed(E,r,v,T,w){let{top:S,left:I,right:H,bottom:te}=v;T===void 0&&(T=10),w===void 0&&(w=defaultThreshold);const{isTop:ae,isBottom:ie,isLeft:ce,isRight:me}=getScrollPosition(E),_e={x:0,y:0},Re={x:0,y:0},Pe={height:r.height*w.y,width:r.width*w.x};return!ae&&S<=r.top+Pe.height?(_e.y=Direction.Backward,Re.y=T*Math.abs((r.top+Pe.height-S)/Pe.height)):!ie&&te>=r.bottom-Pe.height&&(_e.y=Direction.Forward,Re.y=T*Math.abs((r.bottom-Pe.height-te)/Pe.height)),!me&&H>=r.right-Pe.width?(_e.x=Direction.Forward,Re.x=T*Math.abs((r.right-Pe.width-H)/Pe.width)):!ce&&I<=r.left+Pe.width&&(_e.x=Direction.Backward,Re.x=T*Math.abs((r.left+Pe.width-I)/Pe.width)),{direction:_e,speed:Re}}function getScrollElementRect(E){if(E===document.scrollingElement){const{innerWidth:S,innerHeight:I}=window;return{top:0,left:0,right:S,bottom:I,width:S,height:I}}const{top:r,left:v,right:T,bottom:w}=E.getBoundingClientRect();return{top:r,left:v,right:T,bottom:w,width:E.clientWidth,height:E.clientHeight}}function getScrollOffsets(E){return E.reduce((r,v)=>add(r,getScrollCoordinates(v)),defaultCoordinates)}function getScrollXOffset(E){return E.reduce((r,v)=>r+getScrollXCoordinate(v),0)}function getScrollYOffset(E){return E.reduce((r,v)=>r+getScrollYCoordinate(v),0)}function scrollIntoViewIfNeeded(E,r){if(r===void 0&&(r=getClientRect),!E)return;const{top:v,left:T,bottom:w,right:S}=r(E);getFirstScrollableAncestor(E)&&(w<=0||S<=0||v>=window.innerHeight||T>=window.innerWidth)&&E.scrollIntoView({block:"center",inline:"center"})}const properties=[["x",["left","right"],getScrollXOffset],["y",["top","bottom"],getScrollYOffset]];class Rect{constructor(r,v){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const T=getScrollableAncestors(v),w=getScrollOffsets(T);this.rect={...r},this.width=r.width,this.height=r.height;for(const[S,I,H]of properties)for(const te of I)Object.defineProperty(this,te,{get:()=>{const ae=H(T),ie=w[S]-ae;return this.rect[te]+ie},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Listeners{constructor(r){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(v=>{var T;return(T=this.target)==null?void 0:T.removeEventListener(...v)})},this.target=r}add(r,v,T){var w;(w=this.target)==null||w.addEventListener(r,v,T),this.listeners.push([r,v,T])}}function getEventListenerTarget(E){const{EventTarget:r}=getWindow(E);return E instanceof r?E:getOwnerDocument(E)}function hasExceededDistance(E,r){const v=Math.abs(E.x),T=Math.abs(E.y);return typeof r=="number"?Math.sqrt(v**2+T**2)>r:"x"in r&&"y"in r?v>r.x&&T>r.y:"x"in r?v>r.x:"y"in r?T>r.y:!1}var EventName;(function(E){E.Click="click",E.DragStart="dragstart",E.Keydown="keydown",E.ContextMenu="contextmenu",E.Resize="resize",E.SelectionChange="selectionchange",E.VisibilityChange="visibilitychange"})(EventName||(EventName={}));function preventDefault(E){E.preventDefault()}function stopPropagation(E){E.stopPropagation()}var KeyboardCode;(function(E){E.Space="Space",E.Down="ArrowDown",E.Right="ArrowRight",E.Left="ArrowLeft",E.Up="ArrowUp",E.Esc="Escape",E.Enter="Enter",E.Tab="Tab"})(KeyboardCode||(KeyboardCode={}));const defaultKeyboardCodes={start:[KeyboardCode.Space,KeyboardCode.Enter],cancel:[KeyboardCode.Esc],end:[KeyboardCode.Space,KeyboardCode.Enter,KeyboardCode.Tab]},defaultKeyboardCoordinateGetter=(E,r)=>{let{currentCoordinates:v}=r;switch(E.code){case KeyboardCode.Right:return{...v,x:v.x+25};case KeyboardCode.Left:return{...v,x:v.x-25};case KeyboardCode.Down:return{...v,y:v.y+25};case KeyboardCode.Up:return{...v,y:v.y-25}}};class KeyboardSensor{constructor(r){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=r;const{event:{target:v}}=r;this.props=r,this.listeners=new Listeners(getOwnerDocument(v)),this.windowListeners=new Listeners(getWindow(v)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(EventName.Resize,this.handleCancel),this.windowListeners.add(EventName.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(EventName.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:r,onStart:v}=this.props,T=r.node.current;T&&scrollIntoViewIfNeeded(T),v(defaultCoordinates)}handleKeyDown(r){if(isKeyboardEvent(r)){const{active:v,context:T,options:w}=this.props,{keyboardCodes:S=defaultKeyboardCodes,coordinateGetter:I=defaultKeyboardCoordinateGetter,scrollBehavior:H="smooth"}=w,{code:te}=r;if(S.end.includes(te)){this.handleEnd(r);return}if(S.cancel.includes(te)){this.handleCancel(r);return}const{collisionRect:ae}=T.current,ie=ae?{x:ae.left,y:ae.top}:defaultCoordinates;this.referenceCoordinates||(this.referenceCoordinates=ie);const ce=I(r,{active:v,context:T.current,currentCoordinates:ie});if(ce){const me=subtract(ce,ie),_e={x:0,y:0},{scrollableAncestors:Re}=T.current;for(const Pe of Re){const Ce=r.code,{isTop:Fe,isRight:Me,isLeft:Ve,isBottom:We,maxScroll:ze,minScroll:Ue}=getScrollPosition(Pe),je=getScrollElementRect(Pe),ke={x:Math.min(Ce===KeyboardCode.Right?je.right-je.width/2:je.right,Math.max(Ce===KeyboardCode.Right?je.left:je.left+je.width/2,ce.x)),y:Math.min(Ce===KeyboardCode.Down?je.bottom-je.height/2:je.bottom,Math.max(Ce===KeyboardCode.Down?je.top:je.top+je.height/2,ce.y))},Ne=Ce===KeyboardCode.Right&&!Me||Ce===KeyboardCode.Left&&!Ve,Ge=Ce===KeyboardCode.Down&&!We||Ce===KeyboardCode.Up&&!Fe;if(Ne&&ke.x!==ce.x){const Ie=Pe.scrollLeft+me.x,Le=Ce===KeyboardCode.Right&&Ie<=ze.x||Ce===KeyboardCode.Left&&Ie>=Ue.x;if(Le&&!me.y){Pe.scrollTo({left:Ie,behavior:H});return}Le?_e.x=Pe.scrollLeft-Ie:_e.x=Ce===KeyboardCode.Right?Pe.scrollLeft-ze.x:Pe.scrollLeft-Ue.x,_e.x&&Pe.scrollBy({left:-_e.x,behavior:H});break}else if(Ge&&ke.y!==ce.y){const Ie=Pe.scrollTop+me.y,Le=Ce===KeyboardCode.Down&&Ie<=ze.y||Ce===KeyboardCode.Up&&Ie>=Ue.y;if(Le&&!me.x){Pe.scrollTo({top:Ie,behavior:H});return}Le?_e.y=Pe.scrollTop-Ie:_e.y=Ce===KeyboardCode.Down?Pe.scrollTop-ze.y:Pe.scrollTop-Ue.y,_e.y&&Pe.scrollBy({top:-_e.y,behavior:H});break}}this.handleMove(r,add(subtract(ce,this.referenceCoordinates),_e))}}}handleMove(r,v){const{onMove:T}=this.props;r.preventDefault(),T(v)}handleEnd(r){const{onEnd:v}=this.props;r.preventDefault(),this.detach(),v()}handleCancel(r){const{onCancel:v}=this.props;r.preventDefault(),this.detach(),v()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}KeyboardSensor.activators=[{eventName:"onKeyDown",handler:(E,r,v)=>{let{keyboardCodes:T=defaultKeyboardCodes,onActivation:w}=r,{active:S}=v;const{code:I}=E.nativeEvent;if(T.start.includes(I)){const H=S.activatorNode.current;return H&&E.target!==H?!1:(E.preventDefault(),w==null||w({event:E.nativeEvent}),!0)}return!1}}];function isDistanceConstraint(E){return!!(E&&"distance"in E)}function isDelayConstraint(E){return!!(E&&"delay"in E)}class AbstractPointerSensor{constructor(r,v,T){var w;T===void 0&&(T=getEventListenerTarget(r.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=r,this.events=v;const{event:S}=r,{target:I}=S;this.props=r,this.events=v,this.document=getOwnerDocument(I),this.documentListeners=new Listeners(this.document),this.listeners=new Listeners(T),this.windowListeners=new Listeners(getWindow(I)),this.initialCoordinates=(w=getEventCoordinates(S))!=null?w:defaultCoordinates,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:r,props:{options:{activationConstraint:v,bypassActivationConstraint:T}}}=this;if(this.listeners.add(r.move.name,this.handleMove,{passive:!1}),this.listeners.add(r.end.name,this.handleEnd),r.cancel&&this.listeners.add(r.cancel.name,this.handleCancel),this.windowListeners.add(EventName.Resize,this.handleCancel),this.windowListeners.add(EventName.DragStart,preventDefault),this.windowListeners.add(EventName.VisibilityChange,this.handleCancel),this.windowListeners.add(EventName.ContextMenu,preventDefault),this.documentListeners.add(EventName.Keydown,this.handleKeydown),v){if(T!=null&&T({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(isDelayConstraint(v)){this.timeoutId=setTimeout(this.handleStart,v.delay),this.handlePending(v);return}if(isDistanceConstraint(v)){this.handlePending(v);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(r,v){const{active:T,onPending:w}=this.props;w(T,r,this.initialCoordinates,v)}handleStart(){const{initialCoordinates:r}=this,{onStart:v}=this.props;r&&(this.activated=!0,this.documentListeners.add(EventName.Click,stopPropagation,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(EventName.SelectionChange,this.removeTextSelection),v(r))}handleMove(r){var v;const{activated:T,initialCoordinates:w,props:S}=this,{onMove:I,options:{activationConstraint:H}}=S;if(!w)return;const te=(v=getEventCoordinates(r))!=null?v:defaultCoordinates,ae=subtract(w,te);if(!T&&H){if(isDistanceConstraint(H)){if(H.tolerance!=null&&hasExceededDistance(ae,H.tolerance))return this.handleCancel();if(hasExceededDistance(ae,H.distance))return this.handleStart()}if(isDelayConstraint(H)&&hasExceededDistance(ae,H.tolerance))return this.handleCancel();this.handlePending(H,ae);return}r.cancelable&&r.preventDefault(),I(te)}handleEnd(){const{onAbort:r,onEnd:v}=this.props;this.detach(),this.activated||r(this.props.active),v()}handleCancel(){const{onAbort:r,onCancel:v}=this.props;this.detach(),this.activated||r(this.props.active),v()}handleKeydown(r){r.code===KeyboardCode.Esc&&this.handleCancel()}removeTextSelection(){var r;(r=this.document.getSelection())==null||r.removeAllRanges()}}const events={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class PointerSensor extends AbstractPointerSensor{constructor(r){const{event:v}=r,T=getOwnerDocument(v.target);super(r,events,T)}}PointerSensor.activators=[{eventName:"onPointerDown",handler:(E,r)=>{let{nativeEvent:v}=E,{onActivation:T}=r;return!v.isPrimary||v.button!==0?!1:(T==null||T({event:v}),!0)}}];const events$1={move:{name:"mousemove"},end:{name:"mouseup"}};var MouseButton;(function(E){E[E.RightClick=2]="RightClick"})(MouseButton||(MouseButton={}));class MouseSensor extends AbstractPointerSensor{constructor(r){super(r,events$1,getOwnerDocument(r.event.target))}}MouseSensor.activators=[{eventName:"onMouseDown",handler:(E,r)=>{let{nativeEvent:v}=E,{onActivation:T}=r;return v.button===MouseButton.RightClick?!1:(T==null||T({event:v}),!0)}}];const events$2={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class TouchSensor extends AbstractPointerSensor{constructor(r){super(r,events$2)}static setup(){return window.addEventListener(events$2.move.name,r,{capture:!1,passive:!1}),function(){window.removeEventListener(events$2.move.name,r)};function r(){}}}TouchSensor.activators=[{eventName:"onTouchStart",handler:(E,r)=>{let{nativeEvent:v}=E,{onActivation:T}=r;const{touches:w}=v;return w.length>1?!1:(T==null||T({event:v}),!0)}}];var AutoScrollActivator;(function(E){E[E.Pointer=0]="Pointer",E[E.DraggableRect=1]="DraggableRect"})(AutoScrollActivator||(AutoScrollActivator={}));var TraversalOrder;(function(E){E[E.TreeOrder=0]="TreeOrder",E[E.ReversedTreeOrder=1]="ReversedTreeOrder"})(TraversalOrder||(TraversalOrder={}));function useAutoScroller(E){let{acceleration:r,activator:v=AutoScrollActivator.Pointer,canScroll:T,draggingRect:w,enabled:S,interval:I=5,order:H=TraversalOrder.TreeOrder,pointerCoordinates:te,scrollableAncestors:ae,scrollableAncestorRects:ie,delta:ce,threshold:me}=E;const _e=useScrollIntent({delta:ce,disabled:!S}),[Re,Pe]=useInterval(),Ce=reactExports.useRef({x:0,y:0}),Fe=reactExports.useRef({x:0,y:0}),Me=reactExports.useMemo(()=>{switch(v){case AutoScrollActivator.Pointer:return te?{top:te.y,bottom:te.y,left:te.x,right:te.x}:null;case AutoScrollActivator.DraggableRect:return w}},[v,w,te]),Ve=reactExports.useRef(null),We=reactExports.useCallback(()=>{const Ue=Ve.current;if(!Ue)return;const je=Ce.current.x*Fe.current.x,ke=Ce.current.y*Fe.current.y;Ue.scrollBy(je,ke)},[]),ze=reactExports.useMemo(()=>H===TraversalOrder.TreeOrder?[...ae].reverse():ae,[H,ae]);reactExports.useEffect(()=>{if(!S||!ae.length||!Me){Pe();return}for(const Ue of ze){if((T==null?void 0:T(Ue))===!1)continue;const je=ae.indexOf(Ue),ke=ie[je];if(!ke)continue;const{direction:Ne,speed:Ge}=getScrollDirectionAndSpeed(Ue,ke,Me,r,me);for(const Ie of["x","y"])_e[Ie][Ne[Ie]]||(Ge[Ie]=0,Ne[Ie]=0);if(Ge.x>0||Ge.y>0){Pe(),Ve.current=Ue,Re(We,I),Ce.current=Ge,Fe.current=Ne;return}}Ce.current={x:0,y:0},Fe.current={x:0,y:0},Pe()},[r,We,T,Pe,S,I,JSON.stringify(Me),JSON.stringify(_e),Re,ae,ze,ie,JSON.stringify(me)])}const defaultScrollIntent={x:{[Direction.Backward]:!1,[Direction.Forward]:!1},y:{[Direction.Backward]:!1,[Direction.Forward]:!1}};function useScrollIntent(E){let{delta:r,disabled:v}=E;const T=usePrevious(r);return useLazyMemo(w=>{if(v||!T||!w)return defaultScrollIntent;const S={x:Math.sign(r.x-T.x),y:Math.sign(r.y-T.y)};return{x:{[Direction.Backward]:w.x[Direction.Backward]||S.x===-1,[Direction.Forward]:w.x[Direction.Forward]||S.x===1},y:{[Direction.Backward]:w.y[Direction.Backward]||S.y===-1,[Direction.Forward]:w.y[Direction.Forward]||S.y===1}}},[v,r,T])}function useCachedNode(E,r){const v=r!=null?E.get(r):void 0,T=v?v.node.current:null;return useLazyMemo(w=>{var S;return r==null?null:(S=T??w)!=null?S:null},[T,r])}function useCombineActivators(E,r){return reactExports.useMemo(()=>E.reduce((v,T)=>{const{sensor:w}=T,S=w.activators.map(I=>({eventName:I.eventName,handler:r(I.handler,T)}));return[...v,...S]},[]),[E,r])}var MeasuringStrategy;(function(E){E[E.Always=0]="Always",E[E.BeforeDragging=1]="BeforeDragging",E[E.WhileDragging=2]="WhileDragging"})(MeasuringStrategy||(MeasuringStrategy={}));var MeasuringFrequency;(function(E){E.Optimized="optimized"})(MeasuringFrequency||(MeasuringFrequency={}));const defaultValue=new Map;function useDroppableMeasuring(E,r){let{dragging:v,dependencies:T,config:w}=r;const[S,I]=reactExports.useState(null),{frequency:H,measure:te,strategy:ae}=w,ie=reactExports.useRef(E),ce=Ce(),me=useLatestValue(ce),_e=reactExports.useCallback(function(Fe){Fe===void 0&&(Fe=[]),!me.current&&I(Me=>Me===null?Fe:Me.concat(Fe.filter(Ve=>!Me.includes(Ve))))},[me]),Re=reactExports.useRef(null),Pe=useLazyMemo(Fe=>{if(ce&&!v)return defaultValue;if(!Fe||Fe===defaultValue||ie.current!==E||S!=null){const Me=new Map;for(let Ve of E){if(!Ve)continue;if(S&&S.length>0&&!S.includes(Ve.id)&&Ve.rect.current){Me.set(Ve.id,Ve.rect.current);continue}const We=Ve.node.current,ze=We?new Rect(te(We),We):null;Ve.rect.current=ze,ze&&Me.set(Ve.id,ze)}return Me}return Fe},[E,S,v,ce,te]);return reactExports.useEffect(()=>{ie.current=E},[E]),reactExports.useEffect(()=>{ce||_e()},[v,ce]),reactExports.useEffect(()=>{S&&S.length>0&&I(null)},[JSON.stringify(S)]),reactExports.useEffect(()=>{ce||typeof H!="number"||Re.current!==null||(Re.current=setTimeout(()=>{_e(),Re.current=null},H))},[H,ce,_e,...T]),{droppableRects:Pe,measureDroppableContainers:_e,measuringScheduled:S!=null};function Ce(){switch(ae){case MeasuringStrategy.Always:return!1;case MeasuringStrategy.BeforeDragging:return v;default:return!v}}}function useInitialValue(E,r){return useLazyMemo(v=>E?v||(typeof r=="function"?r(E):E):null,[r,E])}function useInitialRect(E,r){return useInitialValue(E,r)}function useMutationObserver(E){let{callback:r,disabled:v}=E;const T=useEvent(r),w=reactExports.useMemo(()=>{if(v||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:S}=window;return new S(T)},[T,v]);return reactExports.useEffect(()=>()=>w==null?void 0:w.disconnect(),[w]),w}function useResizeObserver(E){let{callback:r,disabled:v}=E;const T=useEvent(r),w=reactExports.useMemo(()=>{if(v||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:S}=window;return new S(T)},[v]);return reactExports.useEffect(()=>()=>w==null?void 0:w.disconnect(),[w]),w}function defaultMeasure(E){return new Rect(getClientRect(E),E)}function useRect(E,r,v){r===void 0&&(r=defaultMeasure);const[T,w]=reactExports.useState(null);function S(){w(te=>{if(!E)return null;if(E.isConnected===!1){var ae;return(ae=te??v)!=null?ae:null}const ie=r(E);return JSON.stringify(te)===JSON.stringify(ie)?te:ie})}const I=useMutationObserver({callback(te){if(E)for(const ae of te){const{type:ie,target:ce}=ae;if(ie==="childList"&&ce instanceof HTMLElement&&ce.contains(E)){S();break}}}}),H=useResizeObserver({callback:S});return useIsomorphicLayoutEffect(()=>{S(),E?(H==null||H.observe(E),I==null||I.observe(document.body,{childList:!0,subtree:!0})):(H==null||H.disconnect(),I==null||I.disconnect())},[E]),T}function useRectDelta(E){const r=useInitialValue(E);return getRectDelta(E,r)}const defaultValue$1=[];function useScrollableAncestors(E){const r=reactExports.useRef(E),v=useLazyMemo(T=>E?T&&T!==defaultValue$1&&E&&r.current&&E.parentNode===r.current.parentNode?T:getScrollableAncestors(E):defaultValue$1,[E]);return reactExports.useEffect(()=>{r.current=E},[E]),v}function useScrollOffsets(E){const[r,v]=reactExports.useState(null),T=reactExports.useRef(E),w=reactExports.useCallback(S=>{const I=getScrollableElement(S.target);I&&v(H=>H?(H.set(I,getScrollCoordinates(I)),new Map(H)):null)},[]);return reactExports.useEffect(()=>{const S=T.current;if(E!==S){I(S);const H=E.map(te=>{const ae=getScrollableElement(te);return ae?(ae.addEventListener("scroll",w,{passive:!0}),[ae,getScrollCoordinates(ae)]):null}).filter(te=>te!=null);v(H.length?new Map(H):null),T.current=E}return()=>{I(E),I(S)};function I(H){H.forEach(te=>{const ae=getScrollableElement(te);ae==null||ae.removeEventListener("scroll",w)})}},[w,E]),reactExports.useMemo(()=>E.length?r?Array.from(r.values()).reduce((S,I)=>add(S,I),defaultCoordinates):getScrollOffsets(E):defaultCoordinates,[E,r])}function useScrollOffsetsDelta(E,r){r===void 0&&(r=[]);const v=reactExports.useRef(null);return reactExports.useEffect(()=>{v.current=null},r),reactExports.useEffect(()=>{const T=E!==defaultCoordinates;T&&!v.current&&(v.current=E),!T&&v.current&&(v.current=null)},[E]),v.current?subtract(E,v.current):defaultCoordinates}function useSensorSetup(E){reactExports.useEffect(()=>{if(!canUseDOM)return;const r=E.map(v=>{let{sensor:T}=v;return T.setup==null?void 0:T.setup()});return()=>{for(const v of r)v==null||v()}},E.map(r=>{let{sensor:v}=r;return v}))}function useSyntheticListeners(E,r){return reactExports.useMemo(()=>E.reduce((v,T)=>{let{eventName:w,handler:S}=T;return v[w]=I=>{S(I,r)},v},{}),[E,r])}function useWindowRect(E){return reactExports.useMemo(()=>E?getWindowClientRect(E):null,[E])}const defaultValue$2=[];function useRects(E,r){r===void 0&&(r=getClientRect);const[v]=E,T=useWindowRect(v?getWindow(v):null),[w,S]=reactExports.useState(defaultValue$2);function I(){S(()=>E.length?E.map(te=>isDocumentScrollingElement(te)?T:new Rect(r(te),te)):defaultValue$2)}const H=useResizeObserver({callback:I});return useIsomorphicLayoutEffect(()=>{H==null||H.disconnect(),I(),E.forEach(te=>H==null?void 0:H.observe(te))},[E]),w}function getMeasurableNode(E){if(!E)return null;if(E.children.length>1)return E;const r=E.children[0];return isHTMLElement(r)?r:E}function useDragOverlayMeasuring(E){let{measure:r}=E;const[v,T]=reactExports.useState(null),w=reactExports.useCallback(ae=>{for(const{target:ie}of ae)if(isHTMLElement(ie)){T(ce=>{const me=r(ie);return ce?{...ce,width:me.width,height:me.height}:me});break}},[r]),S=useResizeObserver({callback:w}),I=reactExports.useCallback(ae=>{const ie=getMeasurableNode(ae);S==null||S.disconnect(),ie&&(S==null||S.observe(ie)),T(ie?r(ie):null)},[r,S]),[H,te]=useNodeRef(I);return reactExports.useMemo(()=>({nodeRef:H,rect:v,setRef:te}),[v,H,te])}const defaultSensors=[{sensor:PointerSensor,options:{}},{sensor:KeyboardSensor,options:{}}],defaultData={current:{}},defaultMeasuringConfiguration={draggable:{measure:getTransformAgnosticClientRect},droppable:{measure:getTransformAgnosticClientRect,strategy:MeasuringStrategy.WhileDragging,frequency:MeasuringFrequency.Optimized},dragOverlay:{measure:getClientRect}};class DroppableContainersMap extends Map{get(r){var v;return r!=null&&(v=super.get(r))!=null?v:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(r=>{let{disabled:v}=r;return!v})}getNodeFor(r){var v,T;return(v=(T=this.get(r))==null?void 0:T.node.current)!=null?v:void 0}}const defaultPublicContext={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new DroppableContainersMap,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:noop},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:defaultMeasuringConfiguration,measureDroppableContainers:noop,windowRect:null,measuringScheduled:!1},defaultInternalContext={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:noop,draggableNodes:new Map,over:null,measureDroppableContainers:noop},InternalContext=reactExports.createContext(defaultInternalContext),PublicContext=reactExports.createContext(defaultPublicContext);function getInitialState(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new DroppableContainersMap}}}function reducer(E,r){switch(r.type){case Action.DragStart:return{...E,draggable:{...E.draggable,initialCoordinates:r.initialCoordinates,active:r.active}};case Action.DragMove:return E.draggable.active==null?E:{...E,draggable:{...E.draggable,translate:{x:r.coordinates.x-E.draggable.initialCoordinates.x,y:r.coordinates.y-E.draggable.initialCoordinates.y}}};case Action.DragEnd:case Action.DragCancel:return{...E,draggable:{...E.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case Action.RegisterDroppable:{const{element:v}=r,{id:T}=v,w=new DroppableContainersMap(E.droppable.containers);return w.set(T,v),{...E,droppable:{...E.droppable,containers:w}}}case Action.SetDroppableDisabled:{const{id:v,key:T,disabled:w}=r,S=E.droppable.containers.get(v);if(!S||T!==S.key)return E;const I=new DroppableContainersMap(E.droppable.containers);return I.set(v,{...S,disabled:w}),{...E,droppable:{...E.droppable,containers:I}}}case Action.UnregisterDroppable:{const{id:v,key:T}=r,w=E.droppable.containers.get(v);if(!w||T!==w.key)return E;const S=new DroppableContainersMap(E.droppable.containers);return S.delete(v),{...E,droppable:{...E.droppable,containers:S}}}default:return E}}function RestoreFocus(E){let{disabled:r}=E;const{active:v,activatorEvent:T,draggableNodes:w}=reactExports.useContext(InternalContext),S=usePrevious(T),I=usePrevious(v==null?void 0:v.id);return reactExports.useEffect(()=>{if(!r&&!T&&S&&I!=null){if(!isKeyboardEvent(S)||document.activeElement===S.target)return;const H=w.get(I);if(!H)return;const{activatorNode:te,node:ae}=H;if(!te.current&&!ae.current)return;requestAnimationFrame(()=>{for(const ie of[te.current,ae.current]){if(!ie)continue;const ce=findFirstFocusableNode(ie);if(ce){ce.focus();break}}})}},[T,r,w,I,S]),null}function applyModifiers(E,r){let{transform:v,...T}=r;return E!=null&&E.length?E.reduce((w,S)=>S({transform:w,...T}),v):v}function useMeasuringConfiguration(E){return reactExports.useMemo(()=>({draggable:{...defaultMeasuringConfiguration.draggable,...E==null?void 0:E.draggable},droppable:{...defaultMeasuringConfiguration.droppable,...E==null?void 0:E.droppable},dragOverlay:{...defaultMeasuringConfiguration.dragOverlay,...E==null?void 0:E.dragOverlay}}),[E==null?void 0:E.draggable,E==null?void 0:E.droppable,E==null?void 0:E.dragOverlay])}function useLayoutShiftScrollCompensation(E){let{activeNode:r,measure:v,initialRect:T,config:w=!0}=E;const S=reactExports.useRef(!1),{x:I,y:H}=typeof w=="boolean"?{x:w,y:w}:w;useIsomorphicLayoutEffect(()=>{if(!I&&!H||!r){S.current=!1;return}if(S.current||!T)return;const ae=r==null?void 0:r.node.current;if(!ae||ae.isConnected===!1)return;const ie=v(ae),ce=getRectDelta(ie,T);if(I||(ce.x=0),H||(ce.y=0),S.current=!0,Math.abs(ce.x)>0||Math.abs(ce.y)>0){const me=getFirstScrollableAncestor(ae);me&&me.scrollBy({top:ce.y,left:ce.x})}},[r,I,H,T,v])}const ActiveDraggableContext=reactExports.createContext({...defaultCoordinates,scaleX:1,scaleY:1});var Status;(function(E){E[E.Uninitialized=0]="Uninitialized",E[E.Initializing=1]="Initializing",E[E.Initialized=2]="Initialized"})(Status||(Status={}));const DndContext=reactExports.memo(function(r){var v,T,w,S;let{id:I,accessibility:H,autoScroll:te=!0,children:ae,sensors:ie=defaultSensors,collisionDetection:ce=rectIntersection,measuring:me,modifiers:_e,...Re}=r;const Pe=reactExports.useReducer(reducer,void 0,getInitialState),[Ce,Fe]=Pe,[Me,Ve]=useDndMonitorProvider(),[We,ze]=reactExports.useState(Status.Uninitialized),Ue=We===Status.Initialized,{draggable:{active:je,nodes:ke,translate:Ne},droppable:{containers:Ge}}=Ce,Ie=je!=null?ke.get(je):null,Le=reactExports.useRef({initial:null,translated:null}),He=reactExports.useMemo(()=>{var Sr;return je!=null?{id:je,data:(Sr=Ie==null?void 0:Ie.data)!=null?Sr:defaultData,rect:Le}:null},[je,Ie]),Ct=reactExports.useRef(null),[Ze,Rt]=reactExports.useState(null),[nt,nr]=reactExports.useState(null),Je=useLatestValue(Re,Object.values(Re)),Wt=useUniqueId("DndDescribedBy",I),Lt=reactExports.useMemo(()=>Ge.getEnabled(),[Ge]),qe=useMeasuringConfiguration(me),{droppableRects:$e,measureDroppableContainers:Be,measuringScheduled:Xe}=useDroppableMeasuring(Lt,{dragging:Ue,dependencies:[Ne.x,Ne.y],config:qe.droppable}),rt=useCachedNode(ke,je),Qe=reactExports.useMemo(()=>nt?getEventCoordinates(nt):null,[nt]),vt=ar(),Dt=useInitialRect(rt,qe.draggable.measure);useLayoutShiftScrollCompensation({activeNode:je!=null?ke.get(je):null,config:vt.layoutShiftCompensation,initialRect:Dt,measure:qe.draggable.measure});const Ut=useRect(rt,qe.draggable.measure,Dt),hr=useRect(rt?rt.parentElement:null),pt=reactExports.useRef({activatorEvent:null,active:null,activeNode:rt,collisionRect:null,collisions:null,droppableRects:$e,draggableNodes:ke,draggingNode:null,draggingNodeRect:null,droppableContainers:Ge,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),yr=Ge.getNodeFor((v=pt.current.over)==null?void 0:v.id),vr=useDragOverlayMeasuring({measure:qe.dragOverlay.measure}),wr=(T=vr.nodeRef.current)!=null?T:rt,ir=Ue?(w=vr.rect)!=null?w:Ut:null,sr=!!(vr.nodeRef.current&&vr.rect),kt=useRectDelta(sr?null:Ut),rr=useWindowRect(wr?getWindow(wr):null),lr=useScrollableAncestors(Ue?yr??rt:null),mr=useRects(lr),Ir=applyModifiers(_e,{transform:{x:Ne.x-kt.x,y:Ne.y-kt.y,scaleX:1,scaleY:1},activatorEvent:nt,active:He,activeNodeRect:Ut,containerNodeRect:hr,draggingNodeRect:ir,over:pt.current.over,overlayNodeRect:vr.rect,scrollableAncestors:lr,scrollableAncestorRects:mr,windowRect:rr}),Or=Qe?add(Qe,Ne):null,Fr=useScrollOffsets(lr),Et=useScrollOffsetsDelta(Fr),dr=useScrollOffsetsDelta(Fr,[Ut]),br=add(Ir,Et),Br=ir?getAdjustedRect(ir,Ir):null,Lr=He&&Br?ce({active:He,collisionRect:Br,droppableRects:$e,droppableContainers:Lt,pointerCoordinates:Or}):null,or=getFirstCollision(Lr,"id"),[ur,gr]=reactExports.useState(null),$r=sr?Ir:add(Ir,dr),Xr=adjustScale($r,(S=ur==null?void 0:ur.rect)!=null?S:null,Ut),Rr=reactExports.useRef(null),pr=reactExports.useCallback((Sr,zr)=>{let{sensor:Gr,options:Qr}=zr;if(Ct.current==null)return;const Wr=ke.get(Ct.current);if(!Wr)return;const er=Sr.nativeEvent,Bt=new Gr({active:Ct.current,activeNode:Wr,event:er,options:Qr,context:pt,onAbort(_r){if(!ke.get(_r))return;const{onDragAbort:Mr}=Je.current,Vr={id:_r};Mr==null||Mr(Vr),Me({type:"onDragAbort",event:Vr})},onPending(_r,jr,Mr,Vr){if(!ke.get(_r))return;const{onDragPending:Jr}=Je.current,et={id:_r,constraint:jr,initialCoordinates:Mr,offset:Vr};Jr==null||Jr(et),Me({type:"onDragPending",event:et})},onStart(_r){const jr=Ct.current;if(jr==null)return;const Mr=ke.get(jr);if(!Mr)return;const{onDragStart:Vr}=Je.current,Zr={activatorEvent:er,active:{id:jr,data:Mr.data,rect:Le}};reactDomExports.unstable_batchedUpdates(()=>{Vr==null||Vr(Zr),ze(Status.Initializing),Fe({type:Action.DragStart,initialCoordinates:_r,active:jr}),Me({type:"onDragStart",event:Zr}),Rt(Rr.current),nr(er)})},onMove(_r){Fe({type:Action.DragMove,coordinates:_r})},onEnd:cr(Action.DragEnd),onCancel:cr(Action.DragCancel)});Rr.current=Bt;function cr(_r){return async function(){const{active:Mr,collisions:Vr,over:Zr,scrollAdjustedTranslate:Jr}=pt.current;let et=null;if(Mr&&Jr){const{cancelDrop:Gt}=Je.current;et={activatorEvent:er,active:Mr,collisions:Vr,delta:Jr,over:Zr},_r===Action.DragEnd&&typeof Gt=="function"&&await Promise.resolve(Gt(et))&&(_r=Action.DragCancel)}Ct.current=null,reactDomExports.unstable_batchedUpdates(()=>{Fe({type:_r}),ze(Status.Uninitialized),gr(null),Rt(null),nr(null),Rr.current=null;const Gt=_r===Action.DragEnd?"onDragEnd":"onDragCancel";if(et){const It=Je.current[Gt];It==null||It(et),Me({type:Gt,event:et})}})}}},[ke]),xr=reactExports.useCallback((Sr,zr)=>(Gr,Qr)=>{const Wr=Gr.nativeEvent,er=ke.get(Qr);if(Ct.current!==null||!er||Wr.dndKit||Wr.defaultPrevented)return;const Bt={active:er};Sr(Gr,zr.options,Bt)===!0&&(Wr.dndKit={capturedBy:zr.sensor},Ct.current=Qr,pr(Gr,zr))},[ke,pr]),qr=useCombineActivators(ie,xr);useSensorSetup(ie),useIsomorphicLayoutEffect(()=>{Ut&&We===Status.Initializing&&ze(Status.Initialized)},[Ut,We]),reactExports.useEffect(()=>{const{onDragMove:Sr}=Je.current,{active:zr,activatorEvent:Gr,collisions:Qr,over:Wr}=pt.current;if(!zr||!Gr)return;const er={active:zr,activatorEvent:Gr,collisions:Qr,delta:{x:br.x,y:br.y},over:Wr};reactDomExports.unstable_batchedUpdates(()=>{Sr==null||Sr(er),Me({type:"onDragMove",event:er})})},[br.x,br.y]),reactExports.useEffect(()=>{const{active:Sr,activatorEvent:zr,collisions:Gr,droppableContainers:Qr,scrollAdjustedTranslate:Wr}=pt.current;if(!Sr||Ct.current==null||!zr||!Wr)return;const{onDragOver:er}=Je.current,Bt=Qr.get(or),cr=Bt&&Bt.rect.current?{id:Bt.id,rect:Bt.rect.current,data:Bt.data,disabled:Bt.disabled}:null,_r={active:Sr,activatorEvent:zr,collisions:Gr,delta:{x:Wr.x,y:Wr.y},over:cr};reactDomExports.unstable_batchedUpdates(()=>{gr(cr),er==null||er(_r),Me({type:"onDragOver",event:_r})})},[or]),useIsomorphicLayoutEffect(()=>{pt.current={activatorEvent:nt,active:He,activeNode:rt,collisionRect:Br,collisions:Lr,droppableRects:$e,draggableNodes:ke,draggingNode:wr,draggingNodeRect:ir,droppableContainers:Ge,over:ur,scrollableAncestors:lr,scrollAdjustedTranslate:br},Le.current={initial:ir,translated:Br}},[He,rt,Lr,Br,ke,wr,ir,$e,Ge,ur,lr,br]),useAutoScroller({...vt,delta:Ne,draggingRect:Br,pointerCoordinates:Or,scrollableAncestors:lr,scrollableAncestorRects:mr});const ns=reactExports.useMemo(()=>({active:He,activeNode:rt,activeNodeRect:Ut,activatorEvent:nt,collisions:Lr,containerNodeRect:hr,dragOverlay:vr,draggableNodes:ke,droppableContainers:Ge,droppableRects:$e,over:ur,measureDroppableContainers:Be,scrollableAncestors:lr,scrollableAncestorRects:mr,measuringConfiguration:qe,measuringScheduled:Xe,windowRect:rr}),[He,rt,Ut,nt,Lr,hr,vr,ke,Ge,$e,ur,Be,lr,mr,qe,Xe,rr]),ss=reactExports.useMemo(()=>({activatorEvent:nt,activators:qr,active:He,activeNodeRect:Ut,ariaDescribedById:{draggable:Wt},dispatch:Fe,draggableNodes:ke,over:ur,measureDroppableContainers:Be}),[nt,qr,He,Ut,Fe,Wt,ke,ur,Be]);return React.createElement(DndMonitorContext.Provider,{value:Ve},React.createElement(InternalContext.Provider,{value:ss},React.createElement(PublicContext.Provider,{value:ns},React.createElement(ActiveDraggableContext.Provider,{value:Xr},ae)),React.createElement(RestoreFocus,{disabled:(H==null?void 0:H.restoreFocus)===!1})),React.createElement(Accessibility,{...H,hiddenTextDescribedById:Wt}));function ar(){const Sr=(Ze==null?void 0:Ze.autoScrollEnabled)===!1,zr=typeof te=="object"?te.enabled===!1:te===!1,Gr=Ue&&!Sr&&!zr;return typeof te=="object"?{...te,enabled:Gr}:{enabled:Gr}}}),NullContext=reactExports.createContext(null),defaultRole="button",ID_PREFIX$1="Draggable";function useDraggable(E){let{id:r,data:v,disabled:T=!1,attributes:w}=E;const S=useUniqueId(ID_PREFIX$1),{activators:I,activatorEvent:H,active:te,activeNodeRect:ae,ariaDescribedById:ie,draggableNodes:ce,over:me}=reactExports.useContext(InternalContext),{role:_e=defaultRole,roleDescription:Re="draggable",tabIndex:Pe=0}=w??{},Ce=(te==null?void 0:te.id)===r,Fe=reactExports.useContext(Ce?ActiveDraggableContext:NullContext),[Me,Ve]=useNodeRef(),[We,ze]=useNodeRef(),Ue=useSyntheticListeners(I,r),je=useLatestValue(v);useIsomorphicLayoutEffect(()=>(ce.set(r,{id:r,key:S,node:Me,activatorNode:We,data:je}),()=>{const Ne=ce.get(r);Ne&&Ne.key===S&&ce.delete(r)}),[ce,r]);const ke=reactExports.useMemo(()=>({role:_e,tabIndex:Pe,"aria-disabled":T,"aria-pressed":Ce&&_e===defaultRole?!0:void 0,"aria-roledescription":Re,"aria-describedby":ie.draggable}),[T,_e,Pe,Ce,Re,ie.draggable]);return{active:te,activatorEvent:H,activeNodeRect:ae,attributes:ke,isDragging:Ce,listeners:T?void 0:Ue,node:Me,over:me,setNodeRef:Ve,setActivatorNodeRef:ze,transform:Fe}}function useDndContext(){return reactExports.useContext(PublicContext)}const ID_PREFIX$1$1="Droppable",defaultResizeObserverConfig={timeout:25};function useDroppable(E){let{data:r,disabled:v=!1,id:T,resizeObserverConfig:w}=E;const S=useUniqueId(ID_PREFIX$1$1),{active:I,dispatch:H,over:te,measureDroppableContainers:ae}=reactExports.useContext(InternalContext),ie=reactExports.useRef({disabled:v}),ce=reactExports.useRef(!1),me=reactExports.useRef(null),_e=reactExports.useRef(null),{disabled:Re,updateMeasurementsFor:Pe,timeout:Ce}={...defaultResizeObserverConfig,...w},Fe=useLatestValue(Pe??T),Me=reactExports.useCallback(()=>{if(!ce.current){ce.current=!0;return}_e.current!=null&&clearTimeout(_e.current),_e.current=setTimeout(()=>{ae(Array.isArray(Fe.current)?Fe.current:[Fe.current]),_e.current=null},Ce)},[Ce]),Ve=useResizeObserver({callback:Me,disabled:Re||!I}),We=reactExports.useCallback((ke,Ne)=>{Ve&&(Ne&&(Ve.unobserve(Ne),ce.current=!1),ke&&Ve.observe(ke))},[Ve]),[ze,Ue]=useNodeRef(We),je=useLatestValue(r);return reactExports.useEffect(()=>{!Ve||!ze.current||(Ve.disconnect(),ce.current=!1,Ve.observe(ze.current))},[ze,Ve]),reactExports.useEffect(()=>(H({type:Action.RegisterDroppable,element:{id:T,key:S,disabled:v,node:ze,rect:me,data:je}}),()=>H({type:Action.UnregisterDroppable,key:S,id:T})),[T]),reactExports.useEffect(()=>{v!==ie.current.disabled&&(H({type:Action.SetDroppableDisabled,id:T,key:S,disabled:v}),ie.current.disabled=v)},[T,S,v,H]),{active:I,rect:me,isOver:(te==null?void 0:te.id)===T,node:ze,over:te,setNodeRef:Ue}}function arrayMove(E,r,v){const T=E.slice();return T.splice(v<0?T.length+v:v,0,T.splice(r,1)[0]),T}function getSortedRects(E,r){return E.reduce((v,T,w)=>{const S=r.get(T);return S&&(v[w]=S),v},Array(E.length))}function isValidIndex(E){return E!==null&&E>=0}function itemsEqual(E,r){if(E===r)return!0;if(E.length!==r.length)return!1;for(let v=0;v<E.length;v++)if(E[v]!==r[v])return!1;return!0}function normalizeDisabled(E){return typeof E=="boolean"?{draggable:E,droppable:E}:E}const defaultScale={scaleX:1,scaleY:1},horizontalListSortingStrategy=E=>{var r;let{rects:v,activeNodeRect:T,activeIndex:w,overIndex:S,index:I}=E;const H=(r=v[w])!=null?r:T;if(!H)return null;const te=getItemGap(v,I,w);if(I===w){const ae=v[S];return ae?{x:w<S?ae.left+ae.width-(H.left+H.width):ae.left-H.left,y:0,...defaultScale}:null}return I>w&&I<=S?{x:-H.width-te,y:0,...defaultScale}:I<w&&I>=S?{x:H.width+te,y:0,...defaultScale}:{x:0,y:0,...defaultScale}};function getItemGap(E,r,v){const T=E[r],w=E[r-1],S=E[r+1];return!T||!w&&!S?0:v<r?w?T.left-(w.left+w.width):S.left-(T.left+T.width):S?S.left-(T.left+T.width):T.left-(w.left+w.width)}const rectSortingStrategy=E=>{let{rects:r,activeIndex:v,overIndex:T,index:w}=E;const S=arrayMove(r,T,v),I=r[w],H=S[w];return!H||!I?null:{x:H.left-I.left,y:H.top-I.top,scaleX:H.width/I.width,scaleY:H.height/I.height}},defaultScale$1={scaleX:1,scaleY:1},verticalListSortingStrategy=E=>{var r;let{activeIndex:v,activeNodeRect:T,index:w,rects:S,overIndex:I}=E;const H=(r=S[v])!=null?r:T;if(!H)return null;if(w===v){const ae=S[I];return ae?{x:0,y:v<I?ae.top+ae.height-(H.top+H.height):ae.top-H.top,...defaultScale$1}:null}const te=getItemGap$1(S,w,v);return w>v&&w<=I?{x:0,y:-H.height-te,...defaultScale$1}:w<v&&w>=I?{x:0,y:H.height+te,...defaultScale$1}:{x:0,y:0,...defaultScale$1}};function getItemGap$1(E,r,v){const T=E[r],w=E[r-1],S=E[r+1];return T?v<r?w?T.top-(w.top+w.height):S?S.top-(T.top+T.height):0:S?S.top-(T.top+T.height):w?T.top-(w.top+w.height):0:0}const ID_PREFIX="Sortable",Context=React.createContext({activeIndex:-1,containerId:ID_PREFIX,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:rectSortingStrategy,disabled:{draggable:!1,droppable:!1}});function SortableContext(E){let{children:r,id:v,items:T,strategy:w=rectSortingStrategy,disabled:S=!1}=E;const{active:I,dragOverlay:H,droppableRects:te,over:ae,measureDroppableContainers:ie}=useDndContext(),ce=useUniqueId(ID_PREFIX,v),me=H.rect!==null,_e=reactExports.useMemo(()=>T.map(Ue=>typeof Ue=="object"&&"id"in Ue?Ue.id:Ue),[T]),Re=I!=null,Pe=I?_e.indexOf(I.id):-1,Ce=ae?_e.indexOf(ae.id):-1,Fe=reactExports.useRef(_e),Me=!itemsEqual(_e,Fe.current),Ve=Ce!==-1&&Pe===-1||Me,We=normalizeDisabled(S);useIsomorphicLayoutEffect(()=>{Me&&Re&&ie(_e)},[Me,_e,Re,ie]),reactExports.useEffect(()=>{Fe.current=_e},[_e]);const ze=reactExports.useMemo(()=>({activeIndex:Pe,containerId:ce,disabled:We,disableTransforms:Ve,items:_e,overIndex:Ce,useDragOverlay:me,sortedRects:getSortedRects(_e,te),strategy:w}),[Pe,ce,We.draggable,We.droppable,Ve,_e,Ce,te,me,w]);return React.createElement(Context.Provider,{value:ze},r)}const defaultNewIndexGetter=E=>{let{id:r,items:v,activeIndex:T,overIndex:w}=E;return arrayMove(v,T,w).indexOf(r)},defaultAnimateLayoutChanges=E=>{let{containerId:r,isSorting:v,wasDragging:T,index:w,items:S,newIndex:I,previousItems:H,previousContainerId:te,transition:ae}=E;return!ae||!T||H!==S&&w===I?!1:v?!0:I!==w&&r===te},defaultTransition={duration:200,easing:"ease"},transitionProperty="transform",disabledTransition=CSS$1.Transition.toString({property:transitionProperty,duration:0,easing:"linear"}),defaultAttributes={roleDescription:"sortable"};function useDerivedTransform(E){let{disabled:r,index:v,node:T,rect:w}=E;const[S,I]=reactExports.useState(null),H=reactExports.useRef(v);return useIsomorphicLayoutEffect(()=>{if(!r&&v!==H.current&&T.current){const te=w.current;if(te){const ae=getClientRect(T.current,{ignoreTransform:!0}),ie={x:te.left-ae.left,y:te.top-ae.top,scaleX:te.width/ae.width,scaleY:te.height/ae.height};(ie.x||ie.y)&&I(ie)}}v!==H.current&&(H.current=v)},[r,v,T,w]),reactExports.useEffect(()=>{S&&I(null)},[S]),S}function useSortable(E){let{animateLayoutChanges:r=defaultAnimateLayoutChanges,attributes:v,disabled:T,data:w,getNewIndex:S=defaultNewIndexGetter,id:I,strategy:H,resizeObserverConfig:te,transition:ae=defaultTransition}=E;const{items:ie,containerId:ce,activeIndex:me,disabled:_e,disableTransforms:Re,sortedRects:Pe,overIndex:Ce,useDragOverlay:Fe,strategy:Me}=reactExports.useContext(Context),Ve=normalizeLocalDisabled(T,_e),We=ie.indexOf(I),ze=reactExports.useMemo(()=>({sortable:{containerId:ce,index:We,items:ie},...w}),[ce,w,We,ie]),Ue=reactExports.useMemo(()=>ie.slice(ie.indexOf(I)),[ie,I]),{rect:je,node:ke,isOver:Ne,setNodeRef:Ge}=useDroppable({id:I,data:ze,disabled:Ve.droppable,resizeObserverConfig:{updateMeasurementsFor:Ue,...te}}),{active:Ie,activatorEvent:Le,activeNodeRect:He,attributes:Ct,setNodeRef:Ze,listeners:Rt,isDragging:nt,over:nr,setActivatorNodeRef:Je,transform:Wt}=useDraggable({id:I,data:ze,attributes:{...defaultAttributes,...v},disabled:Ve.draggable}),Lt=useCombinedRefs(Ge,Ze),qe=!!Ie,$e=qe&&!Re&&isValidIndex(me)&&isValidIndex(Ce),Be=!Fe&&nt,Xe=Be&&$e?Wt:null,Qe=$e?Xe??(H??Me)({rects:Pe,activeNodeRect:He,activeIndex:me,overIndex:Ce,index:We}):null,vt=isValidIndex(me)&&isValidIndex(Ce)?S({id:I,items:ie,activeIndex:me,overIndex:Ce}):We,Dt=Ie==null?void 0:Ie.id,Ut=reactExports.useRef({activeId:Dt,items:ie,newIndex:vt,containerId:ce}),hr=ie!==Ut.current.items,pt=r({active:Ie,containerId:ce,isDragging:nt,isSorting:qe,id:I,index:We,items:ie,newIndex:Ut.current.newIndex,previousItems:Ut.current.items,previousContainerId:Ut.current.containerId,transition:ae,wasDragging:Ut.current.activeId!=null}),yr=useDerivedTransform({disabled:!pt,index:We,node:ke,rect:je});return reactExports.useEffect(()=>{qe&&Ut.current.newIndex!==vt&&(Ut.current.newIndex=vt),ce!==Ut.current.containerId&&(Ut.current.containerId=ce),ie!==Ut.current.items&&(Ut.current.items=ie)},[qe,vt,ce,ie]),reactExports.useEffect(()=>{if(Dt===Ut.current.activeId)return;if(Dt!=null&&Ut.current.activeId==null){Ut.current.activeId=Dt;return}const wr=setTimeout(()=>{Ut.current.activeId=Dt},50);return()=>clearTimeout(wr)},[Dt]),{active:Ie,activeIndex:me,attributes:Ct,data:ze,rect:je,index:We,newIndex:vt,items:ie,isOver:Ne,isSorting:qe,isDragging:nt,listeners:Rt,node:ke,overIndex:Ce,over:nr,setNodeRef:Lt,setActivatorNodeRef:Je,setDroppableNodeRef:Ge,setDraggableNodeRef:Ze,transform:yr??Qe,transition:vr()};function vr(){if(yr||hr&&Ut.current.newIndex===We)return disabledTransition;if(!(Be&&!isKeyboardEvent(Le)||!ae)&&(qe||pt))return CSS$1.Transition.toString({...ae,property:transitionProperty})}}function normalizeLocalDisabled(E,r){var v,T;return typeof E=="boolean"?{draggable:E,droppable:!1}:{draggable:(v=E==null?void 0:E.draggable)!=null?v:r.draggable,droppable:(T=E==null?void 0:E.droppable)!=null?T:r.droppable}}function hasSortableData(E){if(!E)return!1;const r=E.data.current;return!!(r&&"sortable"in r&&typeof r.sortable=="object"&&"containerId"in r.sortable&&"items"in r.sortable&&"index"in r.sortable)}const directions=[KeyboardCode.Down,KeyboardCode.Right,KeyboardCode.Up,KeyboardCode.Left],sortableKeyboardCoordinates=(E,r)=>{let{context:{active:v,collisionRect:T,droppableRects:w,droppableContainers:S,over:I,scrollableAncestors:H}}=r;if(directions.includes(E.code)){if(E.preventDefault(),!v||!T)return;const te=[];S.getEnabled().forEach(ce=>{if(!ce||ce!=null&&ce.disabled)return;const me=w.get(ce.id);if(me)switch(E.code){case KeyboardCode.Down:T.top<me.top&&te.push(ce);break;case KeyboardCode.Up:T.top>me.top&&te.push(ce);break;case KeyboardCode.Left:T.left>me.left&&te.push(ce);break;case KeyboardCode.Right:T.left<me.left&&te.push(ce);break}});const ae=closestCorners({collisionRect:T,droppableRects:w,droppableContainers:te});let ie=getFirstCollision(ae,"id");if(ie===(I==null?void 0:I.id)&&ae.length>1&&(ie=ae[1].id),ie!=null){const ce=S.get(v.id),me=S.get(ie),_e=me?w.get(me.id):null,Re=me==null?void 0:me.node.current;if(Re&&_e&&ce&&me){const Ce=getScrollableAncestors(Re).some((Ue,je)=>H[je]!==Ue),Fe=isSameContainer(ce,me),Me=isAfter(ce,me),Ve=Ce||!Fe?{x:0,y:0}:{x:Me?T.width-_e.width:0,y:Me?T.height-_e.height:0},We={x:_e.left,y:_e.top};return Ve.x&&Ve.y?We:subtract(We,Ve)}}}};function isSameContainer(E,r){return!hasSortableData(E)||!hasSortableData(r)?!1:E.data.current.sortable.containerId===r.data.current.sortable.containerId}function isAfter(E,r){return!hasSortableData(E)||!hasSortableData(r)||!isSameContainer(E,r)?!1:E.data.current.sortable.index<r.data.current.sortable.index}let e={data:""},t=E=>typeof window=="object"?((E?E.querySelector("#_goober"):window._goober)||Object.assign((E||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:E||e,l=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,a=/\/\*[^]*?\*\/|  +/g,n=/\n+/g,o=(E,r)=>{let v="",T="",w="";for(let S in E){let I=E[S];S[0]=="@"?S[1]=="i"?v=S+" "+I+";":T+=S[1]=="f"?o(I,S):S+"{"+o(I,S[1]=="k"?"":r)+"}":typeof I=="object"?T+=o(I,r?r.replace(/([^,])+/g,H=>S.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,te=>/&/.test(te)?te.replace(/&/g,H):H?H+" "+te:te)):S):I!=null&&(S=/^--/.test(S)?S:S.replace(/[A-Z]/g,"-$&").toLowerCase(),w+=o.p?o.p(S,I):S+":"+I+";")}return v+(r&&w?r+"{"+w+"}":w)+T},c$1={},s=E=>{if(typeof E=="object"){let r="";for(let v in E)r+=v+s(E[v]);return r}return E},i=(E,r,v,T,w)=>{let S=s(E),I=c$1[S]||(c$1[S]=(te=>{let ae=0,ie=11;for(;ae<te.length;)ie=101*ie+te.charCodeAt(ae++)>>>0;return"go"+ie})(S));if(!c$1[I]){let te=S!==E?E:(ae=>{let ie,ce,me=[{}];for(;ie=l.exec(ae.replace(a,""));)ie[4]?me.shift():ie[3]?(ce=ie[3].replace(n," ").trim(),me.unshift(me[0][ce]=me[0][ce]||{})):me[0][ie[1]]=ie[2].replace(n," ").trim();return me[0]})(E);c$1[I]=o(w?{["@keyframes "+I]:te}:te,v?"":"."+I)}let H=v&&c$1.g?c$1.g:null;return v&&(c$1.g=c$1[I]),((te,ae,ie,ce)=>{ce?ae.data=ae.data.replace(ce,te):ae.data.indexOf(te)===-1&&(ae.data=ie?te+ae.data:ae.data+te)})(c$1[I],r,T,H),I},p=(E,r,v)=>E.reduce((T,w,S)=>{let I=r[S];if(I&&I.call){let H=I(v),te=H&&H.props&&H.props.className||/^go/.test(H)&&H;I=te?"."+te:H&&typeof H=="object"?H.props?"":o(H,""):H===!1?"":H}return T+w+(I??"")},"");function u$1(E){let r=this||{},v=E.call?E(r.p):E;return i(v.unshift?v.raw?p(v,[].slice.call(arguments,1),r.p):v.reduce((T,w)=>Object.assign(T,w&&w.call?w(r.p):w),{}):v,t(r.target),r.g,r.o,r.k)}let d,f$1,g;u$1.bind({g:1});let h=u$1.bind({k:1});function m(E,r,v,T){o.p=r,d=E,f$1=v,g=T}function j(E,r){let v=this||{};return function(){let T=arguments;function w(S,I){let H=Object.assign({},S),te=H.className||w.className;v.p=Object.assign({theme:f$1&&f$1()},H),v.o=/ *go\d+/.test(te),H.className=u$1.apply(v,T)+(te?" "+te:"");let ae=E;return E[0]&&(ae=H.as||E,delete H.as),g&&ae[0]&&g(H),d(ae,H)}return w}}var W=E=>typeof E=="function",f=(E,r)=>W(E)?E(r):E,F$1=(()=>{let E=0;return()=>(++E).toString()})(),A=(()=>{let E;return()=>{if(E===void 0&&typeof window<"u"){let r=matchMedia("(prefers-reduced-motion: reduce)");E=!r||r.matches}return E}})(),Y=20,U=(E,r)=>{switch(r.type){case 0:return{...E,toasts:[r.toast,...E.toasts].slice(0,Y)};case 1:return{...E,toasts:E.toasts.map(S=>S.id===r.toast.id?{...S,...r.toast}:S)};case 2:let{toast:v}=r;return U(E,{type:E.toasts.find(S=>S.id===v.id)?1:0,toast:v});case 3:let{toastId:T}=r;return{...E,toasts:E.toasts.map(S=>S.id===T||T===void 0?{...S,dismissed:!0,visible:!1}:S)};case 4:return r.toastId===void 0?{...E,toasts:[]}:{...E,toasts:E.toasts.filter(S=>S.id!==r.toastId)};case 5:return{...E,pausedAt:r.time};case 6:let w=r.time-(E.pausedAt||0);return{...E,pausedAt:void 0,toasts:E.toasts.map(S=>({...S,pauseDuration:S.pauseDuration+w}))}}},P=[],y={toasts:[],pausedAt:void 0},u=E=>{y=U(y,E),P.forEach(r=>{r(y)})},q$1={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},D=(E={})=>{let[r,v]=reactExports.useState(y),T=reactExports.useRef(y);reactExports.useEffect(()=>(T.current!==y&&v(y),P.push(v),()=>{let S=P.indexOf(v);S>-1&&P.splice(S,1)}),[]);let w=r.toasts.map(S=>{var I,H,te;return{...E,...E[S.type],...S,removeDelay:S.removeDelay||((I=E[S.type])==null?void 0:I.removeDelay)||(E==null?void 0:E.removeDelay),duration:S.duration||((H=E[S.type])==null?void 0:H.duration)||(E==null?void 0:E.duration)||q$1[S.type],style:{...E.style,...(te=E[S.type])==null?void 0:te.style,...S.style}}});return{...r,toasts:w}},J=(E,r="blank",v)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:r,ariaProps:{role:"status","aria-live":"polite"},message:E,pauseDuration:0,...v,id:(v==null?void 0:v.id)||F$1()}),x$1=E=>(r,v)=>{let T=J(r,E,v);return u({type:2,toast:T}),T.id},c=(E,r)=>x$1("blank")(E,r);c.error=x$1("error");c.success=x$1("success");c.loading=x$1("loading");c.custom=x$1("custom");c.dismiss=E=>{u({type:3,toastId:E})};c.remove=E=>u({type:4,toastId:E});c.promise=(E,r,v)=>{let T=c.loading(r.loading,{...v,...v==null?void 0:v.loading});return typeof E=="function"&&(E=E()),E.then(w=>{let S=r.success?f(r.success,w):void 0;return S?c.success(S,{id:T,...v,...v==null?void 0:v.success}):c.dismiss(T),w}).catch(w=>{let S=r.error?f(r.error,w):void 0;S?c.error(S,{id:T,...v,...v==null?void 0:v.error}):c.dismiss(T)}),E};var K=(E,r)=>{u({type:1,toast:{id:E,height:r}})},X=()=>{u({type:5,time:Date.now()})},b=new Map,Z=1e3,ee=(E,r=Z)=>{if(b.has(E))return;let v=setTimeout(()=>{b.delete(E),u({type:4,toastId:E})},r);b.set(E,v)},O$1=E=>{let{toasts:r,pausedAt:v}=D(E);reactExports.useEffect(()=>{if(v)return;let S=Date.now(),I=r.map(H=>{if(H.duration===1/0)return;let te=(H.duration||0)+H.pauseDuration-(S-H.createdAt);if(te<0){H.visible&&c.dismiss(H.id);return}return setTimeout(()=>c.dismiss(H.id),te)});return()=>{I.forEach(H=>H&&clearTimeout(H))}},[r,v]);let T=reactExports.useCallback(()=>{v&&u({type:6,time:Date.now()})},[v]),w=reactExports.useCallback((S,I)=>{let{reverseOrder:H=!1,gutter:te=8,defaultPosition:ae}=I||{},ie=r.filter(_e=>(_e.position||ae)===(S.position||ae)&&_e.height),ce=ie.findIndex(_e=>_e.id===S.id),me=ie.filter((_e,Re)=>Re<ce&&_e.visible).length;return ie.filter(_e=>_e.visible).slice(...H?[me+1]:[0,me]).reduce((_e,Re)=>_e+(Re.height||0)+te,0)},[r]);return reactExports.useEffect(()=>{r.forEach(S=>{if(S.dismissed)ee(S.id,S.removeDelay);else{let I=b.get(S.id);I&&(clearTimeout(I),b.delete(S.id))}})},[r]),{toasts:r,handlers:{updateHeight:K,startPause:X,endPause:T,calculateOffset:w}}},oe=h`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,re=h`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,se=h`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,k$1=j("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${E=>E.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${oe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${re} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${E=>E.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${se} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,ne=h`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,V=j("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${E=>E.secondary||"#e0e0e0"};
  border-right-color: ${E=>E.primary||"#616161"};
  animation: ${ne} 1s linear infinite;
`,pe=h`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,de=h`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,_=j("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${E=>E.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${pe} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${de} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${E=>E.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,ue=j("div")`
  position: absolute;
`,le=j("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,fe=h`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,Te=j("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${fe} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,M$1=({toast:E})=>{let{icon:r,type:v,iconTheme:T}=E;return r!==void 0?typeof r=="string"?reactExports.createElement(Te,null,r):r:v==="blank"?null:reactExports.createElement(le,null,reactExports.createElement(V,{...T}),v!=="loading"&&reactExports.createElement(ue,null,v==="error"?reactExports.createElement(k$1,{...T}):reactExports.createElement(_,{...T})))},ye=E=>`
0% {transform: translate3d(0,${E*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,ge=E=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${E*-150}%,-1px) scale(.6); opacity:0;}
`,he="0%{opacity:0;} 100%{opacity:1;}",xe="0%{opacity:1;} 100%{opacity:0;}",be=j("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Se=j("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Ae=(E,r)=>{let v=E.includes("top")?1:-1,[T,w]=A()?[he,xe]:[ye(v),ge(v)];return{animation:r?`${h(T)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${h(w)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},C=reactExports.memo(({toast:E,position:r,style:v,children:T})=>{let w=E.height?Ae(E.position||r||"top-center",E.visible):{opacity:0},S=reactExports.createElement(M$1,{toast:E}),I=reactExports.createElement(Se,{...E.ariaProps},f(E.message,E));return reactExports.createElement(be,{className:E.className,style:{...w,...v,...E.style}},typeof T=="function"?T({icon:S,message:I}):reactExports.createElement(reactExports.Fragment,null,S,I))});m(reactExports.createElement);var ve=({id:E,className:r,style:v,onHeightUpdate:T,children:w})=>{let S=reactExports.useCallback(I=>{if(I){let H=()=>{let te=I.getBoundingClientRect().height;T(E,te)};H(),new MutationObserver(H).observe(I,{subtree:!0,childList:!0,characterData:!0})}},[E,T]);return reactExports.createElement("div",{ref:S,className:r,style:v},w)},Ee=(E,r)=>{let v=E.includes("top"),T=v?{top:0}:{bottom:0},w=E.includes("center")?{justifyContent:"center"}:E.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:A()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${r*(v?1:-1)}px)`,...T,...w}},De=u$1`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,R=16,Oe=({reverseOrder:E,position:r="top-center",toastOptions:v,gutter:T,children:w,containerStyle:S,containerClassName:I})=>{let{toasts:H,handlers:te}=O$1(v);return reactExports.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:R,left:R,right:R,bottom:R,pointerEvents:"none",...S},className:I,onMouseEnter:te.startPause,onMouseLeave:te.endPause},H.map(ae=>{let ie=ae.position||r,ce=te.calculateOffset(ae,{reverseOrder:E,gutter:T,defaultPosition:r}),me=Ee(ie,ce);return reactExports.createElement(ve,{id:ae.id,key:ae.id,onHeightUpdate:te.updateHeight,className:ae.visible?De:"",style:me},ae.type==="custom"?f(ae.message,ae):w?w(ae):reactExports.createElement(C,{toast:ae,position:ie}))}))};const Modal$1=({isOpen:E,onClose:r,children:v,size:T="md"})=>(reactExports.useEffect(()=>{const w=S=>{S.key==="Escape"&&r()};return E&&(document.addEventListener("keydown",w),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",w),document.body.style.overflow="unset"}},[E,r]),E?jsxRuntimeExports.jsx("div",{className:"modal-overlay",onClick:r,children:jsxRuntimeExports.jsx("div",{className:`modal-container modal-${T}`,onClick:w=>w.stopPropagation(),children:v})}):null),SortableTableItem=({table:E,isSecondary:r,onTableClick:v,onTableDoubleClick:T,onDeleteTable:w,isSelected:S,isEditing:I,editingName:H,onNameChange:te,onNameSubmit:ae,expandedTables:ie,toggleTableExpand:ce})=>{const{attributes:me,listeners:_e,setNodeRef:Re,transform:Pe,transition:Ce}=useSortable({id:E.name}),Fe={transform:CSS$1.Transform.toString(Pe),transition:Ce},Me=We=>{We.target.closest(".table-actions")||We.target.closest(".table-name-input")||We.target.closest(".drag-handle")||v(E,r)},Ve=()=>E.name;return jsxRuntimeExports.jsxs("div",{ref:Re,style:Fe,className:`table-item ${S?"selected":""} ${E.secondaryTable&&!r?"has-secondary":""} ${r?"secondary":""}`,onClick:Me,onDoubleClick:We=>T(We,E),children:[jsxRuntimeExports.jsx("div",{className:"drag-handle",...me,..._e,children:jsxRuntimeExports.jsx("span",{className:"drag-icon",children:"⋮"})}),jsxRuntimeExports.jsx("div",{className:"table-content",children:jsxRuntimeExports.jsx("div",{className:"table-info",children:I?jsxRuntimeExports.jsx("input",{type:"text",value:H,onChange:te,onKeyDown:ae,onBlur:We=>{ae({key:"Escape"})},autoFocus:!0,onClick:We=>We.stopPropagation(),className:"table-name-input"}):jsxRuntimeExports.jsxs("div",{className:"table-name-container",children:[E.secondaryTable&&!r&&jsxRuntimeExports.jsx("span",{className:"relationship-icon",title:"Has Secondary Table",children:"🔗"}),jsxRuntimeExports.jsx("span",{className:"table-name",title:Ve(),children:Ve()})]})})}),jsxRuntimeExports.jsxs("div",{className:"table-actions",children:[jsxRuntimeExports.jsx("button",{className:"action-btn edit-btn",onClick:We=>{We.stopPropagation(),T(We,E)},title:`Edit ${r?"child":""} table "${E.name}"`,children:"✏️"}),jsxRuntimeExports.jsx("button",{className:"action-btn delete-btn",onClick:We=>{We.stopPropagation(),w(We,E)},title:`Delete ${r?"child":""} table "${E.name}"`,children:"×"})]})]})},TableManager=({onTableSelect:E,selectedTableProp:r})=>{const[v,T]=reactExports.useState([]),[w,S]=reactExports.useState(null),[I,H]=reactExports.useState(!0),[te,ae]=reactExports.useState(new Set),[ie,ce]=reactExports.useState(!1),[me,_e]=reactExports.useState(null),[Re,Pe]=reactExports.useState(""),[Ce,Fe]=reactExports.useState(!1),[Me,Ve]=reactExports.useState({mainTableName:"",secondaryTableName:"",groupType:"GRUPAL"}),We=useSensors(useSensor(PointerSensor),useSensor(KeyboardSensor,{coordinateGetter:sortableKeyboardCoordinates})),ze={INDIVIDUAL:"Individual",GRUPAL:"Grupal"};reactExports.useEffect(()=>{Ue()},[]);const Ue=async()=>{try{H(!0);const Ze=await tableService.getTables(),Rt=Ze.reduce((nt,nr)=>{if(nr.isSecondaryTable&&Ze.some(Je=>{var Wt;return Je.isMainTable&&((Wt=Je.relatedTableName)==null?void 0:Wt.toLowerCase())===nr.name.toLowerCase()}))return nt;if(nr.isMainTable){const Je=Ze.find(Wt=>{var Lt;return Wt.name.toLowerCase()===((Lt=nr.relatedTableName)==null?void 0:Lt.toLowerCase())&&Wt.isSecondaryTable});Je?nt.push({...nr,secondaryTable:Je,relationshipType:nr.relationshipType||"grupal_policy",isGrouped:!0}):nt.push(nr)}else nr.isSecondaryTable||nt.push({...nr,isGrouped:!1});return nt},[]);console.log("Grouped tables:",Rt),T(Rt)}catch(Ze){console.error("Error loading tables:",Ze),S("Failed to load tables")}finally{H(!1)}},je=async()=>{try{(await tableService.createTableGroup(Me.mainTableName,Me.secondaryTableName,Me.groupType)).success&&(c.success("Table group created successfully"),Ue(),ce(!1),Ve({mainTableName:"",secondaryTableName:"",groupType:"GRUPAL"}))}catch(Ze){console.error("Error creating table group:",Ze),c.error(Ze.message||"Error creating table group")}},ke=Ze=>{ae(Rt=>{const nt=new Set(Rt);return nt.has(Ze)?nt.delete(Ze):nt.add(Ze),nt})},Ne=(Ze,Rt=!1)=>{E&&E(Ze),Fe(!0)},Ge=(Ze,Rt)=>{Ze.stopPropagation(),_e(Rt),Pe(Rt.name)},Ie=Ze=>{Pe(Ze.target.value)},Le=async Ze=>{if(Ze.key==="Enter"){if(!Re.trim()||Re.trim()===me.name){_e(null),Pe("");return}try{H(!0),await tableService.renameTable(me.name,Re.trim()),c.success("Table renamed successfully"),await Ue()}catch(Rt){console.error("Error renaming table:",Rt),c.error(Rt.message||"Error renaming table"),Pe(me.name);return}finally{H(!1)}_e(null),Pe("")}else Ze.key==="Escape"&&(_e(null),Pe(""))},He=async(Ze,Rt)=>{Ze.stopPropagation();const nr=Rt.isSecondaryTable?`Are you sure you want to delete the child table "${Rt.name}"?`:`Are you sure you want to delete table "${Rt.name}"?${Rt.secondaryTable?" This will also delete its child table.":""}`;if(window.confirm(nr))try{H(!0),Rt.secondaryTable&&(await tableService.deleteTable(Rt.secondaryTable.name),await new Promise(Je=>setTimeout(Je,500))),await tableService.deleteTable(Rt.name),c.success(`Table ${Rt.name} deleted successfully`),await Ue(),r===Rt.name&&E(null)}catch(Je){console.error("Error deleting table:",Je),c.error(Je.message||"Error deleting table")}finally{H(!1)}},Ct=async Ze=>{const{active:Rt,over:nt}=Ze;if(nt&&Rt.id!==nt.id)try{const nr=v.findIndex(Lt=>Lt.name===Rt.id),Je=v.findIndex(Lt=>Lt.name===nt.id);T(Lt=>arrayMove(Lt,nr,Je));const Wt=v.map(Lt=>Lt.name);Wt.splice(Je,0,Wt.splice(nr,1)[0]),await tableService.updateTableOrder(Wt),c.success("Table order updated successfully")}catch(nr){console.error("Error updating table order:",nr),c.error("Failed to update table order"),await Ue()}};return jsxRuntimeExports.jsxs("div",{className:"table-manager",children:[jsxRuntimeExports.jsxs("div",{className:"section-header",children:[jsxRuntimeExports.jsxs("h3",{children:["Tables ",v.length>0&&`(${v.length})`]}),jsxRuntimeExports.jsx("div",{className:"header-actions",children:jsxRuntimeExports.jsxs("button",{onClick:()=>ce(!0),className:"create-group-btn",children:[jsxRuntimeExports.jsx("span",{children:"🔗"})," New Table"]})}),I&&jsxRuntimeExports.jsx("div",{className:"loading-spinner",children:"Loading..."})]}),jsxRuntimeExports.jsx(DndContext,{sensors:We,collisionDetection:closestCenter,onDragEnd:Ct,children:jsxRuntimeExports.jsx("div",{className:"tables-list",children:jsxRuntimeExports.jsx(SortableContext,{items:v.map(Ze=>Ze.name),strategy:rectSortingStrategy,children:v.map(Ze=>jsxRuntimeExports.jsxs(React.Fragment,{children:[jsxRuntimeExports.jsx(SortableTableItem,{table:Ze,isSecondary:!1,onTableClick:Ne,onTableDoubleClick:Ge,onDeleteTable:He,isSelected:r===Ze.name,isEditing:me===Ze,editingName:Re,onNameChange:Ie,onNameSubmit:Le,expandedTables:te,toggleTableExpand:ke}),Ze.secondaryTable&&jsxRuntimeExports.jsx(SortableTableItem,{table:Ze.secondaryTable,isSecondary:!0,onTableClick:Ne,onTableDoubleClick:Ge,onDeleteTable:He,isSelected:r===Ze.secondaryTable.name,isEditing:me===Ze.secondaryTable,editingName:Re,onNameChange:Ie,onNameSubmit:Le,expandedTables:te,toggleTableExpand:ke},`${Ze.name}-secondary`)]},Ze.name))})})}),jsxRuntimeExports.jsxs(Modal$1,{isOpen:ie,onClose:()=>ce(!1),size:"md",children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsx("h2",{children:"Crear Nueva Tabla"}),jsxRuntimeExports.jsx("button",{onClick:()=>ce(!1),children:"×"})]}),jsxRuntimeExports.jsxs("div",{className:"modal-content",children:[jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Tipo de Tabla:"}),jsxRuntimeExports.jsx("select",{value:Me.groupType,onChange:Ze=>Ve(Rt=>({...Rt,groupType:Ze.target.value,mainTableName:Ze.target.value==="GRUPAL"?"Grupos":"Individual",secondaryTableName:Ze.target.value==="GRUPAL"?"Listado":""})),className:"form-select",children:Object.entries(ze).map(([Ze,Rt])=>jsxRuntimeExports.jsx("option",{value:Ze,children:Rt},Ze))}),jsxRuntimeExports.jsxs("small",{className:"help-text",children:[Me.groupType==="GRUPAL"&&"Tabla para pólizas grupales con listado de asegurados",Me.groupType==="INDIVIDUAL"&&"Tabla para pólizas individuales"]})]}),Me.groupType==="GRUPAL"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Nombre de Tabla Principal:"}),jsxRuntimeExports.jsx("input",{type:"text",value:Me.mainTableName,onChange:Ze=>Ve(Rt=>({...Rt,mainTableName:Ze.target.value})),placeholder:"Nombre de la tabla principal",className:"form-input"})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Nombre de Tabla Secundaria:"}),jsxRuntimeExports.jsx("input",{type:"text",value:Me.secondaryTableName,onChange:Ze=>Ve(Rt=>({...Rt,secondaryTableName:Ze.target.value})),placeholder:"Nombre de la tabla secundaria",className:"form-input"})]})]}):jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Nombre de Tabla:"}),jsxRuntimeExports.jsx("input",{type:"text",value:Me.mainTableName,onChange:Ze=>Ve(Rt=>({...Rt,mainTableName:Ze.target.value})),placeholder:"Nombre de la tabla",className:"form-input"})]}),jsxRuntimeExports.jsx("div",{className:"modal-actions",children:jsxRuntimeExports.jsx("button",{onClick:je,className:"btn btn-primary",disabled:!Me.mainTableName||Me.groupType==="GRUPAL"&&!Me.secondaryTableName,children:"Crear Tabla"})})]})]})]})},SortableItem$1=({id:E,column:r,onDelete:v,onEdit:T})=>{var We;const[w,S]=reactExports.useState(!1),[I,H]=reactExports.useState(r.name),[te,ae]=reactExports.useState(r.type||"TEXT"),[ie,ce]=reactExports.useState(!1),{attributes:me,listeners:_e,setNodeRef:Re,transform:Pe,transition:Ce}=useSortable({id:E}),Fe={transform:CSS$1.Transform.toString(Pe),transition:Ce},Me=ze=>{ze.preventDefault(),I.trim()&&(T(r.name,{...r,name:I.trim(),type:te}),S(!1))},Ve=[{value:"TEXT",label:"Text"},{value:"VARCHAR",label:"Short Text"},{value:"INT",label:"Integer"},{value:"DECIMAL",label:"Decimal"},{value:"DATE",label:"Date"},{value:"BOOLEAN",label:"Boolean"},{value:"TIMESTAMP",label:"Timestamp"}];return w?jsxRuntimeExports.jsx("div",{ref:Re,style:Fe,className:"column-item",children:jsxRuntimeExports.jsxs("form",{onSubmit:Me,className:"column-edit-form",children:[jsxRuntimeExports.jsx("span",{className:"drag-handle",...me,..._e,children:"⋮⋮"}),jsxRuntimeExports.jsx("input",{type:"text",className:"column-input name-input",value:I,onChange:ze=>H(ze.target.value),disabled:r.isPrimary,autoFocus:!0,placeholder:"Column name"}),jsxRuntimeExports.jsx("select",{className:"column-input type-select",value:te,onChange:ze=>ae(ze.target.value),disabled:r.isPrimary,children:Ve.map(ze=>jsxRuntimeExports.jsx("option",{value:ze.value,children:ze.label},ze.value))}),jsxRuntimeExports.jsxs("div",{className:"column-edit-actions",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>S(!1),className:"cancel-btn",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"save-btn",children:"Save"})]})]})}):jsxRuntimeExports.jsxs("div",{ref:Re,style:Fe,className:`column-item${r.isPrimary?" primary":""}`,...me,children:[jsxRuntimeExports.jsx("span",{className:"drag-handle",..._e,children:"⋮⋮"}),jsxRuntimeExports.jsx("span",{className:"column-name",onClick:()=>!r.isPrimary&&S(!0),children:r.name}),jsxRuntimeExports.jsx("span",{className:"column-type",onClick:()=>!r.isPrimary&&S(!0),children:((We=Ve.find(ze=>ze.value===r.type))==null?void 0:We.label)||r.type}),r.isPrimary?jsxRuntimeExports.jsx("span",{className:"primary-badge",children:"Primary Key"}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:ie?jsxRuntimeExports.jsxs("div",{className:"delete-confirm",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ce(!1),className:"cancel-btn",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:()=>{v(r.name),ce(!1)},className:"confirm-btn",children:"Confirm"})]}):jsxRuntimeExports.jsx("button",{className:"delete-btn",onClick:()=>ce(!0),title:"Delete column",children:"×"})})]})},EditColumn=({columns:E,tableName:r,onSave:v,onCancel:T})=>{const[w,S]=reactExports.useState(E),[I,H]=reactExports.useState(!1),te=useSensors(useSensor(PointerSensor),useSensor(KeyboardSensor,{coordinateGetter:sortableKeyboardCoordinates})),ae=async _e=>{const{active:Re,over:Pe}=_e;if(Re.id!==Pe.id)try{const Ce=w.findIndex(Ve=>`col-${Ve.name}`===Re.id),Fe=w.findIndex(Ve=>`col-${Ve.name}`===Pe.id),Me=arrayMove(w,Ce,Fe);S(Me),await tableService.updateColumnOrder(r,Me.map(Ve=>Ve.name)),c.success("Column order updated")}catch(Ce){console.error("Failed to update column order:",Ce),c.error("Failed to update column order")}},ie=async _e=>{try{H(!0),await tableService.deleteColumn(r,_e),S(Re=>Re.filter(Pe=>Pe.name!==_e)),c.success(`Column ${_e} deleted`)}catch(Re){console.error("Failed to delete column:",Re),c.error(`Failed to delete column ${_e}`)}finally{H(!1)}},ce=async(_e,Re)=>{try{H(!0),_e!==Re.name&&await tableService.renameColumn(r,_e,Re.name),S(Pe=>Pe.map(Ce=>Ce.name===_e?Re:Ce)),c.success(`Column ${_e} updated`)}catch(Pe){console.error("Failed to update column:",Pe),c.error(`Failed to update column ${_e}`),S(Ce=>Ce.map(Fe=>Fe.name===_e?{...Fe,name:_e}:Fe))}finally{H(!1)}},me=async()=>{try{H(!0),v(w)}catch(_e){console.error("Failed to save changes:",_e),c.error("Failed to save changes")}finally{H(!1)}};return jsxRuntimeExports.jsxs("div",{className:"edit-column-container",children:[jsxRuntimeExports.jsxs("div",{className:"edit-column-header",children:[jsxRuntimeExports.jsx("h3",{children:"Edit Columns"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("button",{className:"btn-secondary",onClick:T,disabled:I,children:"Cancel"}),jsxRuntimeExports.jsx("button",{className:"btn-primary",onClick:me,disabled:I,children:I?"Saving...":"Save"})]})]}),jsxRuntimeExports.jsx(DndContext,{sensors:te,collisionDetection:closestCenter,onDragEnd:ae,children:jsxRuntimeExports.jsx(SortableContext,{items:w.map(_e=>`col-${_e.name}`),strategy:verticalListSortingStrategy,children:jsxRuntimeExports.jsx("div",{className:"columns-list",children:w.map(_e=>jsxRuntimeExports.jsx(SortableItem$1,{id:`col-${_e.name}`,column:_e,onDelete:ie,onEdit:ce},`col-${_e.name}`))})})})]})},SortableItem=({id:E,column:r,onDelete:v,onEdit:T,onTagChange:w,onPdfToggle:S,isPdfEnabled:I})=>{const[H,te]=reactExports.useState(!1),[ae,ie]=reactExports.useState(r),[ce,me]=reactExports.useState(!1),[_e,Re]=reactExports.useState(""),[Pe,Ce]=reactExports.useState(!1),[Fe,Me]=reactExports.useState("TEXT"),{attributes:Ve,listeners:We,setNodeRef:ze,transform:Ue,transition:je}=useSortable({id:E}),ke={transform:CSS$1.Transform.toString(Ue),transition:je},Ne=Le=>{Le.preventDefault(),ae.trim()&&Ge()},Ge=()=>{var Le;(ae.trim()!==r||Fe!==(((Le=columns.find(He=>He.name===r))==null?void 0:Le.type)||"TEXT"))&&T(r,ae.trim(),Fe),te(!1)},Ie=Le=>{Le.preventDefault(),_e.trim()&&(w(r,_e.trim()),me(!1),Re(""))};return H?jsxRuntimeExports.jsx("div",{ref:ze,style:ke,className:"column-edit-container",children:jsxRuntimeExports.jsxs("form",{onSubmit:Ne,className:"column-edit-form",children:[jsxRuntimeExports.jsx("input",{type:"text",value:ae,onChange:Le=>ie(Le.target.value),autoFocus:!0,className:"column-edit-input",placeholder:"Column name"}),jsxRuntimeExports.jsxs("select",{value:Fe,onChange:Le=>Me(Le.target.value),className:"column-type-select",children:[jsxRuntimeExports.jsx("option",{value:"TEXT",children:"Text"}),jsxRuntimeExports.jsx("option",{value:"INT",children:"Integer"}),jsxRuntimeExports.jsx("option",{value:"DECIMAL",children:"Decimal"}),jsxRuntimeExports.jsx("option",{value:"DATE",children:"Date"}),jsxRuntimeExports.jsx("option",{value:"BOOLEAN",children:"Boolean"})]}),jsxRuntimeExports.jsxs("div",{className:"column-edit-actions",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>te(!1),className:"cancel-btn",children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"save-btn",children:"Save"})]})]})}):jsxRuntimeExports.jsxs("div",{ref:ze,style:ke,className:"column-tag-container",children:[jsxRuntimeExports.jsxs("span",{className:"column-tag",...Ve,...We,children:[E==="col-id"?"•":"",r,_e&&jsxRuntimeExports.jsx("span",{className:"column-tag-label",children:_e})]}),jsxRuntimeExports.jsx("div",{className:"column-actions",children:ce?jsxRuntimeExports.jsx("form",{onSubmit:Ie,className:"tag-input-form",children:jsxRuntimeExports.jsx("input",{type:"text",value:_e,onChange:Le=>Re(Le.target.value),autoFocus:!0,onBlur:()=>me(!1),placeholder:"Add tag"})}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:()=>{te(!0),ie(r)},className:"action-btn edit-btn",children:"✎"}),E!=="col-id"&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:()=>Ce(!0),className:"action-btn delete-btn",children:"×"}),Pe&&jsxRuntimeExports.jsxs("div",{className:"confirmation-dialog",children:[jsxRuntimeExports.jsx("p",{children:"Delete this column?"}),jsxRuntimeExports.jsxs("div",{className:"confirmation-actions",children:[jsxRuntimeExports.jsx("button",{className:"cancel-btn",onClick:()=>Ce(!1),children:"Cancel"}),jsxRuntimeExports.jsx("button",{className:"confirm-btn",onClick:()=>{v(r),Ce(!1)},children:"Delete"})]})]})]})]})})]})},ColumnManager=({selectedTable:E,onOrderChange:r})=>{const[v,T]=reactExports.useState([]),[w,S]=reactExports.useState({}),[I,H]=reactExports.useState(!1),[te,ae]=reactExports.useState(null),[ie,ce]=reactExports.useState(!1),[me,_e]=reactExports.useState(""),[Re,Pe]=reactExports.useState("TEXT"),[Ce,Fe]=reactExports.useState(!1),[Me,Ve]=reactExports.useState({}),We=useSensors(useSensor(PointerSensor),useSensor(KeyboardSensor,{coordinateGetter:sortableKeyboardCoordinates})),ze=async()=>{try{if(!(E!=null&&E.name)){console.log("No table selected, skipping column load"),T([]);return}if(E.name.includes("→")){console.log("Combined table detected, skipping column structure load"),T([]);return}console.log("Loading columns for table:",E.name),H(!0),ae(null);const Ze=await tableService.getTableStructure(E.name);if(console.log("Received table structure:",Ze),Ze&&Array.isArray(Ze.columns)){const Rt=Ze.columns.map(nt=>({name:nt.name,type:nt.type||"TEXT"}));console.log("Setting columns state:",Rt),T(Rt)}else console.warn("Invalid structure received:",Ze),T([]),ae("Invalid table structure received")}catch(Ze){console.error("Error loading columns:",Ze),ae(Ze.message||"Failed to load columns"),T([])}finally{H(!1)}};reactExports.useEffect(()=>{E!=null&&E.name?(console.log("Table changed, loading columns for:",E.name),ze()):(console.log("No table selected, clearing columns"),T([]))},[E]);const Ue=async Ze=>{const{active:Rt,over:nt}=Ze;if(!nt||Rt.id===nt.id)return;const nr=v.findIndex(Lt=>`col-${Lt.name}`===Rt.id),Je=v.findIndex(Lt=>`col-${Lt.name}`===nt.id),Wt=arrayMove(v,nr,Je);try{T(Wt),await tableService.updateColumnOrder(E.name,Wt.map(Lt=>Lt.name)),await ze(),r&&r()}catch(Lt){console.error("Failed to update column order:",Lt),T(v)}},je=async Ze=>{if(Ze.preventDefault(),!!me.trim())try{H(!0),ae(null),await tableService.addColumn(E.name,{name:me.trim(),type:Re}),_e(""),Pe("TEXT"),ce(!1),c.success("Column created successfully"),await ze(),r&&r()}catch(Rt){console.error("Failed to create column:",Rt),ae(Rt.message||"Failed to create column"),c.error(Rt.message||"Failed to create column")}finally{H(!1)}},ke=async Ze=>{if(window.confirm(`Are you sure you want to delete the column "${Ze}"?`))try{H(!0),console.log(`Deleting column: ${Ze}`),T(Rt=>Rt.filter(nt=>nt.name!==Ze)),await tableService.deleteColumn(E.name,Ze),await ze(),r&&r()}catch(Rt){console.error("Failed to delete column:",Rt),ae("Failed to delete column"),await ze()}finally{H(!1)}},Ne=async(Ze,Rt,nt)=>{try{if(H(!0),ae(null),!(E!=null&&E.name))throw new Error("No table selected");Ze!==Rt&&await tableService.renameColumn(E.name,Ze,Rt);const nr=v.find(Je=>Je.name===Ze);nr&&nr.type!==nt&&console.log("Type change requested:",{oldType:nr.type,newType:nt}),await ze(),c.success("Column updated successfully"),r&&r()}catch(nr){console.error("Failed to update column:",nr),ae(nr.message||"Failed to update column"),c.error(nr.message||"Failed to update column"),await ze()}finally{H(!1)}},Ge=async(Ze,Rt)=>{try{H(!0),await tableService.setColumnTag(E.name,Ze,Rt),S(nt=>({...nt,[Ze]:Rt}))}catch(nt){console.error("Failed to set column tag:",nt),ae("Failed to set column tag")}finally{H(!1)}},Ie=async Ze=>{try{H(!0),await tableService.updateColumnPdfStatus(E.name,Ze,!Me[Ze])}catch(Rt){console.error("Failed to toggle PDF status:",Rt),ae("Failed to toggle PDF status")}finally{H(!1)}},Le=async()=>{E!=null&&E.name&&(await ze(),r&&r())};reactExports.useEffect(()=>{const Ze=()=>{console.log("Table structure updated, refreshing..."),Le()};return window.addEventListener("tableStructureUpdated",Ze),()=>window.removeEventListener("tableStructureUpdated",Ze)},[E]);const He=()=>{Fe(!0)},Ct=async Ze=>{try{H(!0),await ze(),r&&r(),Fe(!1),c.success("Columns updated successfully")}catch(Rt){console.error("Failed to save column changes:",Rt),c.error("Failed to save changes")}finally{H(!1)}};return jsxRuntimeExports.jsxs("div",{className:"column-manager",children:[jsxRuntimeExports.jsxs("div",{className:"section-header",children:[jsxRuntimeExports.jsxs("h3",{children:["Columnas ",v.length>0&&`(${v.length})`]}),jsxRuntimeExports.jsxs("div",{className:"header-buttons",children:[jsxRuntimeExports.jsx("button",{className:"create-btn",onClick:()=>ce(!ie),children:ie?"—":"+"}),jsxRuntimeExports.jsx("button",{className:"edit-btn",onClick:He,children:"Edit"})]})]}),jsxRuntimeExports.jsx(Modal$1,{isOpen:Ce,onClose:()=>Fe(!1),size:"large",children:jsxRuntimeExports.jsx(EditColumn,{columns:v,tableName:E==null?void 0:E.name,onSave:Ct,onCancel:()=>Fe(!1)})}),ie&&jsxRuntimeExports.jsxs("form",{onSubmit:je,className:"create-column-form",children:[jsxRuntimeExports.jsx("input",{type:"text",value:me,onChange:Ze=>_e(Ze.target.value),placeholder:"Column name",required:!0}),jsxRuntimeExports.jsxs("select",{value:Re,onChange:Ze=>Pe(Ze.target.value),children:[jsxRuntimeExports.jsx("option",{value:"TEXT",children:"Text"}),jsxRuntimeExports.jsx("option",{value:"INT",children:"Integer"}),jsxRuntimeExports.jsx("option",{value:"DECIMAL",children:"Decimal"}),jsxRuntimeExports.jsx("option",{value:"DATE",children:"Date"}),jsxRuntimeExports.jsx("option",{value:"BOOLEAN",children:"Boolean"})]}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:I,children:I?"Creating...":"Add Column"})]}),te&&jsxRuntimeExports.jsxs("div",{className:"error-message",children:[te,jsxRuntimeExports.jsx("button",{onClick:Le,className:"refresh-btn",children:"Retry"})]}),jsxRuntimeExports.jsx("div",{className:"columns-list",children:E!=null&&E.name?v.length===0?jsxRuntimeExports.jsx("div",{className:"no-columns-message",children:"No columns"}):jsxRuntimeExports.jsx(DndContext,{sensors:We,collisionDetection:closestCenter,onDragEnd:Ue,children:jsxRuntimeExports.jsx(SortableContext,{items:v.map(Ze=>`col-${Ze.name}`),strategy:horizontalListSortingStrategy,children:jsxRuntimeExports.jsx("div",{className:"columns-tags",children:v.map(Ze=>jsxRuntimeExports.jsx(SortableItem,{id:`col-${Ze.name}`,column:Ze.name,onDelete:ke,onEdit:Ne,onTagChange:Ge,onPdfToggle:Ie,isPdfEnabled:Me[Ze.name]},`col-${Ze.name}`))})})}):jsxRuntimeExports.jsx("div",{className:"no-table-message",children:"Select a table"})})]})};function commonjsRequire(E){throw new Error('Could not dynamically require "'+E+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(r,v){module.exports=r.pdfjsLib=v()})(globalThis,()=>(()=>{var __webpack_modules__=[,(E,r)=>{var Xr;Object.defineProperty(r,"__esModule",{value:!0}),r.VerbosityLevel=r.Util=r.UnknownErrorException=r.UnexpectedResponseException=r.TextRenderingMode=r.RenderingIntentFlag=r.PromiseCapability=r.PermissionFlag=r.PasswordResponses=r.PasswordException=r.PageActionEventType=r.OPS=r.MissingPDFException=r.MAX_IMAGE_SIZE_TO_CACHE=r.LINE_FACTOR=r.LINE_DESCENT_FACTOR=r.InvalidPDFException=r.ImageKind=r.IDENTITY_MATRIX=r.FormatError=r.FeatureTest=r.FONT_IDENTITY_MATRIX=r.DocumentActionEventType=r.CMapCompressionType=r.BaseException=r.BASELINE_FACTOR=r.AnnotationType=r.AnnotationReplyType=r.AnnotationPrefix=r.AnnotationMode=r.AnnotationFlag=r.AnnotationFieldFlag=r.AnnotationEditorType=r.AnnotationEditorPrefix=r.AnnotationEditorParamsType=r.AnnotationBorderStyleType=r.AnnotationActionEventType=r.AbortException=void 0,r.assert=Je,r.bytesToString=hr,r.createValidAbsoluteUrl=Lt,r.getModificationDate=br,r.getUuid=gr,r.getVerbosityLevel=Ze,r.info=Rt,r.isArrayBuffer=Et,r.isArrayEqual=dr,r.isNodeJS=void 0,r.normalizeUnicode=ur,r.objectFromMap=wr,r.objectSize=vr,r.setVerbosityLevel=Ct,r.shadow=qe,r.string32=yr,r.stringToBytes=pt,r.stringToPDFString=Ir,r.stringToUTF8String=Or,r.unreachable=nr,r.utf8StringToString=Fr,r.warn=nt;const v=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");r.isNodeJS=v;const T=[1,0,0,1,0,0];r.IDENTITY_MATRIX=T;const w=[.001,0,0,.001,0,0];r.FONT_IDENTITY_MATRIX=w;const S=1e7;r.MAX_IMAGE_SIZE_TO_CACHE=S;const I=1.35;r.LINE_FACTOR=I;const H=.35;r.LINE_DESCENT_FACTOR=H;const te=H/I;r.BASELINE_FACTOR=te;const ae={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};r.RenderingIntentFlag=ae;const ie={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};r.AnnotationMode=ie;const ce="pdfjs_internal_editor_";r.AnnotationEditorPrefix=ce;const me={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};r.AnnotationEditorType=me;const _e={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};r.AnnotationEditorParamsType=_e;const Re={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};r.PermissionFlag=Re;const Pe={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};r.TextRenderingMode=Pe;const Ce={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};r.ImageKind=Ce;const Fe={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};r.AnnotationType=Fe;const Me={GROUP:"Group",REPLY:"R"};r.AnnotationReplyType=Me;const Ve={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};r.AnnotationFlag=Ve;const We={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};r.AnnotationFieldFlag=We;const ze={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};r.AnnotationBorderStyleType=ze;const Ue={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};r.AnnotationActionEventType=Ue;const je={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};r.DocumentActionEventType=je;const ke={O:"PageOpen",C:"PageClose"};r.PageActionEventType=ke;const Ne={ERRORS:0,WARNINGS:1,INFOS:5};r.VerbosityLevel=Ne;const Ge={NONE:0,BINARY:1};r.CMapCompressionType=Ge;const Ie={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};r.OPS=Ie;const Le={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};r.PasswordResponses=Le;let He=Ne.WARNINGS;function Ct(Rr){Number.isInteger(Rr)&&(He=Rr)}function Ze(){return He}function Rt(Rr){He>=Ne.INFOS&&console.log(`Info: ${Rr}`)}function nt(Rr){He>=Ne.WARNINGS&&console.log(`Warning: ${Rr}`)}function nr(Rr){throw new Error(Rr)}function Je(Rr,pr){Rr||nr(pr)}function Wt(Rr){switch(Rr==null?void 0:Rr.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Lt(Rr,pr=null,xr=null){if(!Rr)return null;try{if(xr&&typeof Rr=="string"){if(xr.addDefaultProtocol&&Rr.startsWith("www.")){const ns=Rr.match(/\./g);(ns==null?void 0:ns.length)>=2&&(Rr=`http://${Rr}`)}if(xr.tryConvertEncoding)try{Rr=Or(Rr)}catch{}}const qr=pr?new URL(Rr,pr):new URL(Rr);if(Wt(qr))return qr}catch{}return null}function qe(Rr,pr,xr,qr=!1){return Object.defineProperty(Rr,pr,{value:xr,enumerable:!qr,configurable:!0,writable:!1}),xr}const $e=function(){function pr(xr,qr){this.constructor===pr&&nr("Cannot initialize BaseException."),this.message=xr,this.name=qr}return pr.prototype=new Error,pr.constructor=pr,pr}();r.BaseException=$e;class Be extends $e{constructor(pr,xr){super(pr,"PasswordException"),this.code=xr}}r.PasswordException=Be;class Xe extends $e{constructor(pr,xr){super(pr,"UnknownErrorException"),this.details=xr}}r.UnknownErrorException=Xe;class rt extends $e{constructor(pr){super(pr,"InvalidPDFException")}}r.InvalidPDFException=rt;class Qe extends $e{constructor(pr){super(pr,"MissingPDFException")}}r.MissingPDFException=Qe;class vt extends $e{constructor(pr,xr){super(pr,"UnexpectedResponseException"),this.status=xr}}r.UnexpectedResponseException=vt;class Dt extends $e{constructor(pr){super(pr,"FormatError")}}r.FormatError=Dt;class Ut extends $e{constructor(pr){super(pr,"AbortException")}}r.AbortException=Ut;function hr(Rr){(typeof Rr!="object"||(Rr==null?void 0:Rr.length)===void 0)&&nr("Invalid argument for bytesToString");const pr=Rr.length,xr=8192;if(pr<xr)return String.fromCharCode.apply(null,Rr);const qr=[];for(let ns=0;ns<pr;ns+=xr){const ss=Math.min(ns+xr,pr),ar=Rr.subarray(ns,ss);qr.push(String.fromCharCode.apply(null,ar))}return qr.join("")}function pt(Rr){typeof Rr!="string"&&nr("Invalid argument for stringToBytes");const pr=Rr.length,xr=new Uint8Array(pr);for(let qr=0;qr<pr;++qr)xr[qr]=Rr.charCodeAt(qr)&255;return xr}function yr(Rr){return String.fromCharCode(Rr>>24&255,Rr>>16&255,Rr>>8&255,Rr&255)}function vr(Rr){return Object.keys(Rr).length}function wr(Rr){const pr=Object.create(null);for(const[xr,qr]of Rr)pr[xr]=qr;return pr}function ir(){const Rr=new Uint8Array(4);return Rr[0]=1,new Uint32Array(Rr.buffer,0,1)[0]===1}function sr(){try{return new Function(""),!0}catch{return!1}}class kt{static get isLittleEndian(){return qe(this,"isLittleEndian",ir())}static get isEvalSupported(){return qe(this,"isEvalSupported",sr())}static get isOffscreenCanvasSupported(){return qe(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?qe(this,"platform",{isWin:!1,isMac:!1}):qe(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var pr,xr;return qe(this,"isCSSRoundSupported",(xr=(pr=globalThis.CSS)==null?void 0:pr.supports)==null?void 0:xr.call(pr,"width: round(1.5px, 1px)"))}}r.FeatureTest=kt;const rr=[...Array(256).keys()].map(Rr=>Rr.toString(16).padStart(2,"0"));class lr{static makeHexColor(pr,xr,qr){return`#${rr[pr]}${rr[xr]}${rr[qr]}`}static scaleMinMax(pr,xr){let qr;pr[0]?(pr[0]<0&&(qr=xr[0],xr[0]=xr[1],xr[1]=qr),xr[0]*=pr[0],xr[1]*=pr[0],pr[3]<0&&(qr=xr[2],xr[2]=xr[3],xr[3]=qr),xr[2]*=pr[3],xr[3]*=pr[3]):(qr=xr[0],xr[0]=xr[2],xr[2]=qr,qr=xr[1],xr[1]=xr[3],xr[3]=qr,pr[1]<0&&(qr=xr[2],xr[2]=xr[3],xr[3]=qr),xr[2]*=pr[1],xr[3]*=pr[1],pr[2]<0&&(qr=xr[0],xr[0]=xr[1],xr[1]=qr),xr[0]*=pr[2],xr[1]*=pr[2]),xr[0]+=pr[4],xr[1]+=pr[4],xr[2]+=pr[5],xr[3]+=pr[5]}static transform(pr,xr){return[pr[0]*xr[0]+pr[2]*xr[1],pr[1]*xr[0]+pr[3]*xr[1],pr[0]*xr[2]+pr[2]*xr[3],pr[1]*xr[2]+pr[3]*xr[3],pr[0]*xr[4]+pr[2]*xr[5]+pr[4],pr[1]*xr[4]+pr[3]*xr[5]+pr[5]]}static applyTransform(pr,xr){const qr=pr[0]*xr[0]+pr[1]*xr[2]+xr[4],ns=pr[0]*xr[1]+pr[1]*xr[3]+xr[5];return[qr,ns]}static applyInverseTransform(pr,xr){const qr=xr[0]*xr[3]-xr[1]*xr[2],ns=(pr[0]*xr[3]-pr[1]*xr[2]+xr[2]*xr[5]-xr[4]*xr[3])/qr,ss=(-pr[0]*xr[1]+pr[1]*xr[0]+xr[4]*xr[1]-xr[5]*xr[0])/qr;return[ns,ss]}static getAxialAlignedBoundingBox(pr,xr){const qr=this.applyTransform(pr,xr),ns=this.applyTransform(pr.slice(2,4),xr),ss=this.applyTransform([pr[0],pr[3]],xr),ar=this.applyTransform([pr[2],pr[1]],xr);return[Math.min(qr[0],ns[0],ss[0],ar[0]),Math.min(qr[1],ns[1],ss[1],ar[1]),Math.max(qr[0],ns[0],ss[0],ar[0]),Math.max(qr[1],ns[1],ss[1],ar[1])]}static inverseTransform(pr){const xr=pr[0]*pr[3]-pr[1]*pr[2];return[pr[3]/xr,-pr[1]/xr,-pr[2]/xr,pr[0]/xr,(pr[2]*pr[5]-pr[4]*pr[3])/xr,(pr[4]*pr[1]-pr[5]*pr[0])/xr]}static singularValueDecompose2dScale(pr){const xr=[pr[0],pr[2],pr[1],pr[3]],qr=pr[0]*xr[0]+pr[1]*xr[2],ns=pr[0]*xr[1]+pr[1]*xr[3],ss=pr[2]*xr[0]+pr[3]*xr[2],ar=pr[2]*xr[1]+pr[3]*xr[3],Sr=(qr+ar)/2,zr=Math.sqrt((qr+ar)**2-4*(qr*ar-ss*ns))/2,Gr=Sr+zr||1,Qr=Sr-zr||1;return[Math.sqrt(Gr),Math.sqrt(Qr)]}static normalizeRect(pr){const xr=pr.slice(0);return pr[0]>pr[2]&&(xr[0]=pr[2],xr[2]=pr[0]),pr[1]>pr[3]&&(xr[1]=pr[3],xr[3]=pr[1]),xr}static intersect(pr,xr){const qr=Math.max(Math.min(pr[0],pr[2]),Math.min(xr[0],xr[2])),ns=Math.min(Math.max(pr[0],pr[2]),Math.max(xr[0],xr[2]));if(qr>ns)return null;const ss=Math.max(Math.min(pr[1],pr[3]),Math.min(xr[1],xr[3])),ar=Math.min(Math.max(pr[1],pr[3]),Math.max(xr[1],xr[3]));return ss>ar?null:[qr,ss,ns,ar]}static bezierBoundingBox(pr,xr,qr,ns,ss,ar,Sr,zr){const Gr=[],Qr=[[],[]];let Wr,er,Bt,cr,_r,jr,Mr,Vr;for(let Gt=0;Gt<2;++Gt){if(Gt===0?(er=6*pr-12*qr+6*ss,Wr=-3*pr+9*qr-9*ss+3*Sr,Bt=3*qr-3*pr):(er=6*xr-12*ns+6*ar,Wr=-3*xr+9*ns-9*ar+3*zr,Bt=3*ns-3*xr),Math.abs(Wr)<1e-12){if(Math.abs(er)<1e-12)continue;cr=-Bt/er,0<cr&&cr<1&&Gr.push(cr);continue}Mr=er*er-4*Bt*Wr,Vr=Math.sqrt(Mr),!(Mr<0)&&(_r=(-er+Vr)/(2*Wr),0<_r&&_r<1&&Gr.push(_r),jr=(-er-Vr)/(2*Wr),0<jr&&jr<1&&Gr.push(jr))}let Zr=Gr.length,Jr;const et=Zr;for(;Zr--;)cr=Gr[Zr],Jr=1-cr,Qr[0][Zr]=Jr*Jr*Jr*pr+3*Jr*Jr*cr*qr+3*Jr*cr*cr*ss+cr*cr*cr*Sr,Qr[1][Zr]=Jr*Jr*Jr*xr+3*Jr*Jr*cr*ns+3*Jr*cr*cr*ar+cr*cr*cr*zr;return Qr[0][et]=pr,Qr[1][et]=xr,Qr[0][et+1]=Sr,Qr[1][et+1]=zr,Qr[0].length=Qr[1].length=et+2,[Math.min(...Qr[0]),Math.min(...Qr[1]),Math.max(...Qr[0]),Math.max(...Qr[1])]}}r.Util=lr;const mr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function Ir(Rr){if(Rr[0]>="ï"){let xr;if(Rr[0]==="þ"&&Rr[1]==="ÿ"?xr="utf-16be":Rr[0]==="ÿ"&&Rr[1]==="þ"?xr="utf-16le":Rr[0]==="ï"&&Rr[1]==="»"&&Rr[2]==="¿"&&(xr="utf-8"),xr)try{const qr=new TextDecoder(xr,{fatal:!0}),ns=pt(Rr);return qr.decode(ns)}catch(qr){nt(`stringToPDFString: "${qr}".`)}}const pr=[];for(let xr=0,qr=Rr.length;xr<qr;xr++){const ns=mr[Rr.charCodeAt(xr)];pr.push(ns?String.fromCharCode(ns):Rr.charAt(xr))}return pr.join("")}function Or(Rr){return decodeURIComponent(escape(Rr))}function Fr(Rr){return unescape(encodeURIComponent(Rr))}function Et(Rr){return typeof Rr=="object"&&(Rr==null?void 0:Rr.byteLength)!==void 0}function dr(Rr,pr){if(Rr.length!==pr.length)return!1;for(let xr=0,qr=Rr.length;xr<qr;xr++)if(Rr[xr]!==pr[xr])return!1;return!0}function br(Rr=new Date){return[Rr.getUTCFullYear().toString(),(Rr.getUTCMonth()+1).toString().padStart(2,"0"),Rr.getUTCDate().toString().padStart(2,"0"),Rr.getUTCHours().toString().padStart(2,"0"),Rr.getUTCMinutes().toString().padStart(2,"0"),Rr.getUTCSeconds().toString().padStart(2,"0")].join("")}class Br{constructor(){Tr(this,Xr,!1);this.promise=new Promise((pr,xr)=>{this.resolve=qr=>{Ar(this,Xr,!0),pr(qr)},this.reject=qr=>{Ar(this,Xr,!0),xr(qr)}})}get settled(){return Ye(this,Xr)}}Xr=new WeakMap,r.PromiseCapability=Br;let Lr=null,or=null;function ur(Rr){return Lr||(Lr=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,or=new Map([["ﬅ","ſt"]])),Rr.replaceAll(Lr,(pr,xr,qr)=>xr?xr.normalize("NFKC"):or.get(qr))}function gr(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const Rr=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(Rr);else for(let pr=0;pr<32;pr++)Rr[pr]=Math.floor(Math.random()*255);return hr(Rr)}const $r="pdfjs_internal_id_";r.AnnotationPrefix=$r},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var E,v,T,w,Ms,An,H,te,ae,ie,ce,me,_e,Re,Pe,wn,Fe,Me,Gn,We,ze;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(je){if(typeof je=="string"||je instanceof URL?je={url:je}:(0,_util.isArrayBuffer)(je)&&(je={data:je}),typeof je!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!je.url&&!je.data&&!je.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const ke=new PDFDocumentLoadingTask,{docId:Ne}=ke,Ge=je.url?getUrlProp(je.url):null,Ie=je.data?getDataProp(je.data):null,Le=je.httpHeaders||null,He=je.withCredentials===!0,Ct=je.password??null,Ze=je.range instanceof PDFDataRangeTransport?je.range:null,Rt=Number.isInteger(je.rangeChunkSize)&&je.rangeChunkSize>0?je.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let nt=je.worker instanceof PDFWorker?je.worker:null;const nr=je.verbosity,Je=typeof je.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(je.docBaseUrl)?je.docBaseUrl:null,Wt=typeof je.cMapUrl=="string"?je.cMapUrl:null,Lt=je.cMapPacked!==!1,qe=je.CMapReaderFactory||DefaultCMapReaderFactory,$e=typeof je.standardFontDataUrl=="string"?je.standardFontDataUrl:null,Be=je.StandardFontDataFactory||DefaultStandardFontDataFactory,Xe=je.stopAtErrors!==!0,rt=Number.isInteger(je.maxImageSize)&&je.maxImageSize>-1?je.maxImageSize:-1,Qe=je.isEvalSupported!==!1,vt=typeof je.isOffscreenCanvasSupported=="boolean"?je.isOffscreenCanvasSupported:!_util.isNodeJS,Dt=Number.isInteger(je.canvasMaxAreaInBytes)?je.canvasMaxAreaInBytes:-1,Ut=typeof je.disableFontFace=="boolean"?je.disableFontFace:_util.isNodeJS,hr=je.fontExtraProperties===!0,pt=je.enableXfa===!0,yr=je.ownerDocument||globalThis.document,vr=je.disableRange===!0,wr=je.disableStream===!0,ir=je.disableAutoFetch===!0,sr=je.pdfBug===!0,kt=Ze?Ze.length:je.length??NaN,rr=typeof je.useSystemFonts=="boolean"?je.useSystemFonts:!_util.isNodeJS&&!Ut,lr=typeof je.useWorkerFetch=="boolean"?je.useWorkerFetch:qe===_display_utils.DOMCMapReaderFactory&&Be===_display_utils.DOMStandardFontDataFactory&&Wt&&$e&&(0,_display_utils.isValidFetchUrl)(Wt,document.baseURI)&&(0,_display_utils.isValidFetchUrl)($e,document.baseURI),mr=je.canvasFactory||new DefaultCanvasFactory({ownerDocument:yr}),Ir=je.filterFactory||new DefaultFilterFactory({docId:Ne,ownerDocument:yr}),Or=null;(0,_util.setVerbosityLevel)(nr);const Fr={canvasFactory:mr,filterFactory:Ir};if(lr||(Fr.cMapReaderFactory=new qe({baseUrl:Wt,isCompressed:Lt}),Fr.standardFontDataFactory=new Be({baseUrl:$e})),!nt){const br={verbosity:nr,port:_worker_options.GlobalWorkerOptions.workerPort};nt=br.port?PDFWorker.fromPort(br):new PDFWorker(br),ke._worker=nt}const Et={docId:Ne,apiVersion:"3.11.174",data:Ie,password:Ct,disableAutoFetch:ir,rangeChunkSize:Rt,length:kt,docBaseUrl:Je,enableXfa:pt,evaluatorOptions:{maxImageSize:rt,disableFontFace:Ut,ignoreErrors:Xe,isEvalSupported:Qe,isOffscreenCanvasSupported:vt,canvasMaxAreaInBytes:Dt,fontExtraProperties:hr,useSystemFonts:rr,cMapUrl:lr?Wt:null,standardFontDataUrl:lr?$e:null}},dr={ignoreErrors:Xe,isEvalSupported:Qe,disableFontFace:Ut,fontExtraProperties:hr,enableXfa:pt,ownerDocument:yr,disableAutoFetch:ir,pdfBug:sr,styleElement:Or};return nt.promise.then(function(){if(ke.destroyed)throw new Error("Loading aborted");const br=_fetchDocument(nt,Et),Br=new Promise(function(Lr){let or;Ze?or=new _transport_stream.PDFDataTransportStream({length:kt,initialData:Ze.initialData,progressiveDone:Ze.progressiveDone,contentDispositionFilename:Ze.contentDispositionFilename,disableRange:vr,disableStream:wr},Ze):Ie||(or=(gr=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(gr):(0,_display_utils.isValidFetchUrl)(gr.url)?new _displayFetch_stream.PDFFetchStream(gr):new _displayNetwork.PDFNetworkStream(gr))({url:Ge,length:kt,httpHeaders:Le,withCredentials:He,rangeChunkSize:Rt,disableRange:vr,disableStream:wr})),Lr(or)});return Promise.all([br,Br]).then(function([Lr,or]){if(ke.destroyed)throw new Error("Loading aborted");const ur=new _message_handler.MessageHandler(Ne,Lr,nt.port),gr=new WorkerTransport(ur,ke,or,dr,Fr);ke._transport=gr,ur.send("Ready",null)})}).catch(ke._capability.reject),ke}async function _fetchDocument(je,ke){if(je.destroyed)throw new Error("Worker was destroyed");const Ne=await je.messageHandler.sendWithPromise("GetDocRequest",ke,ke.data?[ke.data.buffer]:null);if(je.destroyed)throw new Error("Worker was destroyed");return Ne}function getUrlProp(je){if(je instanceof URL)return je.href;try{return new URL(je,window.location).href}catch{if(_util.isNodeJS&&typeof je=="string")return je}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(je){if(_util.isNodeJS&&typeof Buffer<"u"&&je instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(je instanceof Uint8Array&&je.byteLength===je.buffer.byteLength)return je;if(typeof je=="string")return(0,_util.stringToBytes)(je);if(typeof je=="object"&&!isNaN(je==null?void 0:je.length)||(0,_util.isArrayBuffer)(je))return new Uint8Array(je);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const r=class r{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${Ks(r,E)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var ke,Ne,Ge;this.destroyed=!0;try{(ke=this._worker)!=null&&ke.port&&(this._worker._pendingDestroy=!0),await((Ne=this._transport)==null?void 0:Ne.destroy())}catch(Ie){throw(Ge=this._worker)!=null&&Ge.port&&delete this._worker._pendingDestroy,Ie}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};E=new WeakMap,Tr(r,E,0);let PDFDocumentLoadingTask=r;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(ke,Ne,Ge=!1,Ie=null){this.length=ke,this.initialData=Ne,this.progressiveDone=Ge,this.contentDispositionFilename=Ie,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(ke){this._rangeListeners.push(ke)}addProgressListener(ke){this._progressListeners.push(ke)}addProgressiveReadListener(ke){this._progressiveReadListeners.push(ke)}addProgressiveDoneListener(ke){this._progressiveDoneListeners.push(ke)}onDataRange(ke,Ne){for(const Ge of this._rangeListeners)Ge(ke,Ne)}onDataProgress(ke,Ne){this._readyCapability.promise.then(()=>{for(const Ge of this._progressListeners)Ge(ke,Ne)})}onDataProgressiveRead(ke){this._readyCapability.promise.then(()=>{for(const Ne of this._progressiveReadListeners)Ne(ke)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const ke of this._progressiveDoneListeners)ke()})}transportReady(){this._readyCapability.resolve()}requestDataRange(ke,Ne){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(ke,Ne){this._pdfInfo=ke,this._transport=Ne,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(Ge=>{if(!Ge)return Ge;const Ie=[];for(const Le in Ge)Ie.push(...Ge[Le]);return Ie}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(ke){return this._transport.getPage(ke)}getPageIndex(ke){return this._transport.getPageIndex(ke)}getDestinations(){return this._transport.getDestinations()}getDestination(ke){return this._transport.getDestination(ke)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(ke=!1){return this._transport.startCleanup(ke||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(ke,Ne,Ge,Ie=!1){Tr(this,w);Tr(this,v,null);Tr(this,T,!1);this._pageIndex=ke,this._pageInfo=Ne,this._transport=Ge,this._stats=Ie?new _display_utils.StatTimer:null,this._pdfBug=Ie,this.commonObjs=Ge.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:ke,rotation:Ne=this.rotate,offsetX:Ge=0,offsetY:Ie=0,dontFlip:Le=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:ke,rotation:Ne,offsetX:Ge,offsetY:Ie,dontFlip:Le})}getAnnotations({intent:ke="display"}={}){const Ne=this._transport.getRenderingIntent(ke);return this._transport.getAnnotations(this._pageIndex,Ne.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var ke;return((ke=this._transport._htmlForXfa)==null?void 0:ke.children[this._pageIndex])||null}render({canvasContext:ke,viewport:Ne,intent:Ge="display",annotationMode:Ie=_util.AnnotationMode.ENABLE,transform:Le=null,background:He=null,optionalContentConfigPromise:Ct=null,annotationCanvasMap:Ze=null,pageColors:Rt=null,printAnnotationStorage:nt=null}){var Be,Xe;(Be=this._stats)==null||Be.time("Overall");const nr=this._transport.getRenderingIntent(Ge,Ie,nt);Ar(this,T,!1),fr(this,w,An).call(this),Ct||(Ct=this._transport.getOptionalContentConfig());let Je=this._intentStates.get(nr.cacheKey);Je||(Je=Object.create(null),this._intentStates.set(nr.cacheKey,Je)),Je.streamReaderCancelTimeout&&(clearTimeout(Je.streamReaderCancelTimeout),Je.streamReaderCancelTimeout=null);const Wt=!!(nr.renderingIntent&_util.RenderingIntentFlag.PRINT);Je.displayReadyCapability||(Je.displayReadyCapability=new _util.PromiseCapability,Je.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(Xe=this._stats)==null||Xe.time("Page Request"),this._pumpOperatorList(nr));const Lt=rt=>{var Qe,vt;Je.renderTasks.delete(qe),(this._maybeCleanupAfterRender||Wt)&&Ar(this,T,!0),fr(this,w,Ms).call(this,!Wt),rt?(qe.capability.reject(rt),this._abortOperatorList({intentState:Je,reason:rt instanceof Error?rt:new Error(rt)})):qe.capability.resolve(),(Qe=this._stats)==null||Qe.timeEnd("Rendering"),(vt=this._stats)==null||vt.timeEnd("Overall")},qe=new InternalRenderTask({callback:Lt,params:{canvasContext:ke,viewport:Ne,transform:Le,background:He},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:Ze,operatorList:Je.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!Wt,pdfBug:this._pdfBug,pageColors:Rt});(Je.renderTasks||(Je.renderTasks=new Set)).add(qe);const $e=qe.task;return Promise.all([Je.displayReadyCapability.promise,Ct]).then(([rt,Qe])=>{var vt;if(this.destroyed){Lt();return}(vt=this._stats)==null||vt.time("Rendering"),qe.initializeGraphics({transparency:rt,optionalContentConfig:Qe}),qe.operatorListChanged()}).catch(Lt),$e}getOperatorList({intent:ke="display",annotationMode:Ne=_util.AnnotationMode.ENABLE,printAnnotationStorage:Ge=null}={}){var Ze;function Ie(){He.operatorList.lastChunk&&(He.opListReadCapability.resolve(He.operatorList),He.renderTasks.delete(Ct))}const Le=this._transport.getRenderingIntent(ke,Ne,Ge,!0);let He=this._intentStates.get(Le.cacheKey);He||(He=Object.create(null),this._intentStates.set(Le.cacheKey,He));let Ct;return He.opListReadCapability||(Ct=Object.create(null),Ct.operatorListChanged=Ie,He.opListReadCapability=new _util.PromiseCapability,(He.renderTasks||(He.renderTasks=new Set)).add(Ct),He.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(Ze=this._stats)==null||Ze.time("Page Request"),this._pumpOperatorList(Le)),He.opListReadCapability.promise}streamTextContent({includeMarkedContent:ke=!1,disableNormalization:Ne=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:ke===!0,disableNormalization:Ne===!0},{highWaterMark:100,size(Ie){return Ie.items.length}})}getTextContent(ke={}){if(this._transport._htmlForXfa)return this.getXfa().then(Ge=>_xfa_text.XfaText.textContent(Ge));const Ne=this.streamTextContent(ke);return new Promise(function(Ge,Ie){function Le(){He.read().then(function({value:Ze,done:Rt}){if(Rt){Ge(Ct);return}Object.assign(Ct.styles,Ze.styles),Ct.items.push(...Ze.items),Le()},Ie)}const He=Ne.getReader(),Ct={items:[],styles:Object.create(null)};Le()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const ke=[];for(const Ne of this._intentStates.values())if(this._abortOperatorList({intentState:Ne,reason:new Error("Page was destroyed."),force:!0}),!Ne.opListReadCapability)for(const Ge of Ne.renderTasks)ke.push(Ge.completed),Ge.cancel();return this.objs.clear(),Ar(this,T,!1),fr(this,w,An).call(this),Promise.all(ke)}cleanup(ke=!1){Ar(this,T,!0);const Ne=fr(this,w,Ms).call(this,!1);return ke&&Ne&&this._stats&&(this._stats=new _display_utils.StatTimer),Ne}_startRenderPage(ke,Ne){var Ie,Le;const Ge=this._intentStates.get(Ne);Ge&&((Ie=this._stats)==null||Ie.timeEnd("Page Request"),(Le=Ge.displayReadyCapability)==null||Le.resolve(ke))}_renderPageChunk(ke,Ne){for(let Ge=0,Ie=ke.length;Ge<Ie;Ge++)Ne.operatorList.fnArray.push(ke.fnArray[Ge]),Ne.operatorList.argsArray.push(ke.argsArray[Ge]);Ne.operatorList.lastChunk=ke.lastChunk,Ne.operatorList.separateAnnots=ke.separateAnnots;for(const Ge of Ne.renderTasks)Ge.operatorListChanged();ke.lastChunk&&fr(this,w,Ms).call(this,!0)}_pumpOperatorList({renderingIntent:ke,cacheKey:Ne,annotationStorageSerializable:Ge}){const{map:Ie,transfers:Le}=Ge,Ct=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:ke,cacheKey:Ne,annotationStorage:Ie},Le).getReader(),Ze=this._intentStates.get(Ne);Ze.streamReader=Ct;const Rt=()=>{Ct.read().then(({value:nt,done:nr})=>{if(nr){Ze.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(nt,Ze),Rt())},nt=>{if(Ze.streamReader=null,!this._transport.destroyed){if(Ze.operatorList){Ze.operatorList.lastChunk=!0;for(const nr of Ze.renderTasks)nr.operatorListChanged();fr(this,w,Ms).call(this,!0)}if(Ze.displayReadyCapability)Ze.displayReadyCapability.reject(nt);else if(Ze.opListReadCapability)Ze.opListReadCapability.reject(nt);else throw nt}})};Rt()}_abortOperatorList({intentState:ke,reason:Ne,force:Ge=!1}){if(ke.streamReader){if(ke.streamReaderCancelTimeout&&(clearTimeout(ke.streamReaderCancelTimeout),ke.streamReaderCancelTimeout=null),!Ge){if(ke.renderTasks.size>0)return;if(Ne instanceof _display_utils.RenderingCancelledException){let Ie=RENDERING_CANCELLED_TIMEOUT;Ne.extraDelay>0&&Ne.extraDelay<1e3&&(Ie+=Ne.extraDelay),ke.streamReaderCancelTimeout=setTimeout(()=>{ke.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:ke,reason:Ne,force:!0})},Ie);return}}if(ke.streamReader.cancel(new _util.AbortException(Ne.message)).catch(()=>{}),ke.streamReader=null,!this._transport.destroyed){for(const[Ie,Le]of this._intentStates)if(Le===ke){this._intentStates.delete(Ie);break}this.cleanup()}}}get stats(){return this._stats}}v=new WeakMap,T=new WeakMap,w=new WeakSet,Ms=function(ke=!1){if(fr(this,w,An).call(this),!Ye(this,T)||this.destroyed)return!1;if(ke)return Ar(this,v,setTimeout(()=>{Ar(this,v,null),fr(this,w,Ms).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:Ne,operatorList:Ge}of this._intentStates.values())if(Ne.size>0||!Ge.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),Ar(this,T,!1),!0},An=function(){Ye(this,v)&&(clearTimeout(Ye(this,v)),Ar(this,v,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){Tr(this,H,new Set);Tr(this,te,Promise.resolve())}postMessage(ke,Ne){const Ge={data:structuredClone(ke,Ne?{transfer:Ne}:null)};Ye(this,te).then(()=>{for(const Ie of Ye(this,H))Ie.call(this,Ge)})}addEventListener(ke,Ne){Ye(this,H).add(Ne)}removeEventListener(ke,Ne){Ye(this,H).delete(Ne)}terminate(){Ye(this,H).clear()}}H=new WeakMap,te=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const je=(ae=document==null?void 0:document.currentScript)==null?void 0:ae.src;je&&(PDFWorkerUtil.fallbackWorkerSrc=je.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(je,ke){let Ne;try{if(Ne=new URL(je),!Ne.origin||Ne.origin==="null")return!1}catch{return!1}const Ge=new URL(ke,Ne);return Ne.origin===Ge.origin},PDFWorkerUtil.createCDNWrapper=function(je){const ke=`importScripts("${je}");`;return URL.createObjectURL(new Blob([ke]))}}const _PDFWorker=class _PDFWorker{constructor({name:je=null,port:ke=null,verbosity:Ne=(0,_util.getVerbosityLevel)()}={}){var Ge;if(this.name=je,this.destroyed=!1,this.verbosity=Ne,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,ke){if((Ge=Ye(_PDFWorker,ie))!=null&&Ge.has(ke))throw new Error("Cannot use more than one PDFWorker per port.");(Ye(_PDFWorker,ie)||Ar(_PDFWorker,ie,new WeakMap)).set(ke,this),this._initializeFromPort(ke);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(je){this._port=je,this._messageHandler=new _message_handler.MessageHandler("main","worker",je),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:je}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,je)||(je=PDFWorkerUtil.createCDNWrapper(new URL(je,window.location).href));const ke=new Worker(je),Ne=new _message_handler.MessageHandler("main","worker",ke),Ge=()=>{ke.removeEventListener("error",Ie),Ne.destroy(),ke.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},Ie=()=>{this._webWorker||Ge()};ke.addEventListener("error",Ie),Ne.on("test",He=>{if(ke.removeEventListener("error",Ie),this.destroyed){Ge();return}He?(this._messageHandler=Ne,this._port=ke,this._webWorker=ke,this._readyCapability.resolve(),Ne.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),Ne.destroy(),ke.terminate())}),Ne.on("ready",He=>{if(ke.removeEventListener("error",Ie),this.destroyed){Ge();return}try{Le()}catch{this._setupFakeWorker()}});const Le=()=>{const He=new Uint8Array;Ne.send("test",He,[He.buffer])};Le();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(je=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const ke=new LoopbackPort;this._port=ke;const Ne=`fake${PDFWorkerUtil.fakeWorkerId++}`,Ge=new _message_handler.MessageHandler(Ne+"_worker",Ne,ke);je.setup(Ge,ke);const Ie=new _message_handler.MessageHandler(Ne,Ne+"_worker",ke);this._messageHandler=Ie,this._readyCapability.resolve(),Ie.send("configure",{verbosity:this.verbosity})}).catch(je=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${je.message}".`))})}destroy(){var je;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(je=Ye(_PDFWorker,ie))==null||je.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(je){var Ne;if(!(je!=null&&je.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const ke=(Ne=Ye(this,ie))==null?void 0:Ne.get(je.port);if(ke){if(ke._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return ke}return new _PDFWorker(je)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var je;try{return((je=globalThis.pdfjsWorker)==null?void 0:je.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};ie=new WeakMap,Tr(_PDFWorker,ie);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(ke,Ne,Ge,Ie,Le){Tr(this,Pe);Tr(this,ce,new Map);Tr(this,me,new Map);Tr(this,_e,new Map);Tr(this,Re,null);this.messageHandler=ke,this.loadingTask=Ne,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:Ie.ownerDocument,styleElement:Ie.styleElement}),this._params=Ie,this.canvasFactory=Le.canvasFactory,this.filterFactory=Le.filterFactory,this.cMapReaderFactory=Le.cMapReaderFactory,this.standardFontDataFactory=Le.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=Ge,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(ke,Ne=_util.AnnotationMode.ENABLE,Ge=null,Ie=!1){let Le=_util.RenderingIntentFlag.DISPLAY,He=_annotation_storage.SerializableEmpty;switch(ke){case"any":Le=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":Le=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${ke}`)}switch(Ne){case _util.AnnotationMode.DISABLE:Le+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:Le+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:Le+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,He=(Le&_util.RenderingIntentFlag.PRINT&&Ge instanceof _annotation_storage.PrintAnnotationStorage?Ge:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${Ne}`)}return Ie&&(Le+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:Le,cacheKey:`${Le}_${He.hash}`,annotationStorageSerializable:He}}destroy(){var Ge;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(Ge=Ye(this,Re))==null||Ge.reject(new Error("Worker was destroyed during onPassword callback"));const ke=[];for(const Ie of Ye(this,me).values())ke.push(Ie._destroy());Ye(this,me).clear(),Ye(this,_e).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const Ne=this.messageHandler.sendWithPromise("Terminate",null);return ke.push(Ne),Promise.all(ke).then(()=>{var Ie;this.commonObjs.clear(),this.fontLoader.clear(),Ye(this,ce).clear(),this.filterFactory.destroy(),(Ie=this._networkStream)==null||Ie.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:ke,loadingTask:Ne}=this;ke.on("GetReader",(Ge,Ie)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=Le=>{this._lastProgress={loaded:Le.loaded,total:Le.total}},Ie.onPull=()=>{this._fullReader.read().then(function({value:Le,done:He}){if(He){Ie.close();return}(0,_util.assert)(Le instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),Ie.enqueue(new Uint8Array(Le),1,[Le])}).catch(Le=>{Ie.error(Le)})},Ie.onCancel=Le=>{this._fullReader.cancel(Le),Ie.ready.catch(He=>{if(!this.destroyed)throw He})}}),ke.on("ReaderHeadersReady",Ge=>{const Ie=new _util.PromiseCapability,Le=this._fullReader;return Le.headersReady.then(()=>{var He;(!Le.isStreamingSupported||!Le.isRangeSupported)&&(this._lastProgress&&((He=Ne.onProgress)==null||He.call(Ne,this._lastProgress)),Le.onProgress=Ct=>{var Ze;(Ze=Ne.onProgress)==null||Ze.call(Ne,{loaded:Ct.loaded,total:Ct.total})}),Ie.resolve({isStreamingSupported:Le.isStreamingSupported,isRangeSupported:Le.isRangeSupported,contentLength:Le.contentLength})},Ie.reject),Ie.promise}),ke.on("GetRangeReader",(Ge,Ie)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const Le=this._networkStream.getRangeReader(Ge.begin,Ge.end);if(!Le){Ie.close();return}Ie.onPull=()=>{Le.read().then(function({value:He,done:Ct}){if(Ct){Ie.close();return}(0,_util.assert)(He instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),Ie.enqueue(new Uint8Array(He),1,[He])}).catch(He=>{Ie.error(He)})},Ie.onCancel=He=>{Le.cancel(He),Ie.ready.catch(Ct=>{if(!this.destroyed)throw Ct})}}),ke.on("GetDoc",({pdfInfo:Ge})=>{this._numPages=Ge.numPages,this._htmlForXfa=Ge.htmlForXfa,delete Ge.htmlForXfa,Ne._capability.resolve(new PDFDocumentProxy(Ge,this))}),ke.on("DocException",function(Ge){let Ie;switch(Ge.name){case"PasswordException":Ie=new _util.PasswordException(Ge.message,Ge.code);break;case"InvalidPDFException":Ie=new _util.InvalidPDFException(Ge.message);break;case"MissingPDFException":Ie=new _util.MissingPDFException(Ge.message);break;case"UnexpectedResponseException":Ie=new _util.UnexpectedResponseException(Ge.message,Ge.status);break;case"UnknownErrorException":Ie=new _util.UnknownErrorException(Ge.message,Ge.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}Ne._capability.reject(Ie)}),ke.on("PasswordRequest",Ge=>{if(Ar(this,Re,new _util.PromiseCapability),Ne.onPassword){const Ie=Le=>{Le instanceof Error?Ye(this,Re).reject(Le):Ye(this,Re).resolve({password:Le})};try{Ne.onPassword(Ie,Ge.code)}catch(Le){Ye(this,Re).reject(Le)}}else Ye(this,Re).reject(new _util.PasswordException(Ge.message,Ge.code));return Ye(this,Re).promise}),ke.on("DataLoaded",Ge=>{var Ie;(Ie=Ne.onProgress)==null||Ie.call(Ne,{loaded:Ge.length,total:Ge.length}),this.downloadInfoCapability.resolve(Ge)}),ke.on("StartRenderPage",Ge=>{if(this.destroyed)return;Ye(this,me).get(Ge.pageIndex)._startRenderPage(Ge.transparency,Ge.cacheKey)}),ke.on("commonobj",([Ge,Ie,Le])=>{var He;if(!this.destroyed&&!this.commonObjs.has(Ge))switch(Ie){case"Font":const Ct=this._params;if("error"in Le){const nt=Le.error;(0,_util.warn)(`Error during font loading: ${nt}`),this.commonObjs.resolve(Ge,nt);break}const Ze=Ct.pdfBug&&((He=globalThis.FontInspector)!=null&&He.enabled)?(nt,nr)=>globalThis.FontInspector.fontAdded(nt,nr):null,Rt=new _font_loader.FontFaceObject(Le,{isEvalSupported:Ct.isEvalSupported,disableFontFace:Ct.disableFontFace,ignoreErrors:Ct.ignoreErrors,inspectFont:Ze});this.fontLoader.bind(Rt).catch(nt=>ke.sendWithPromise("FontFallback",{id:Ge})).finally(()=>{!Ct.fontExtraProperties&&Rt.data&&(Rt.data=null),this.commonObjs.resolve(Ge,Rt)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(Ge,Le);break;default:throw new Error(`Got unknown common object type ${Ie}`)}}),ke.on("obj",([Ge,Ie,Le,He])=>{var Ze;if(this.destroyed)return;const Ct=Ye(this,me).get(Ie);if(!Ct.objs.has(Ge))switch(Le){case"Image":if(Ct.objs.resolve(Ge,He),He){let Rt;if(He.bitmap){const{width:nt,height:nr}=He;Rt=nt*nr*4}else Rt=((Ze=He.data)==null?void 0:Ze.length)||0;Rt>_util.MAX_IMAGE_SIZE_TO_CACHE&&(Ct._maybeCleanupAfterRender=!0)}break;case"Pattern":Ct.objs.resolve(Ge,He);break;default:throw new Error(`Got unknown object type ${Le}`)}}),ke.on("DocProgress",Ge=>{var Ie;this.destroyed||(Ie=Ne.onProgress)==null||Ie.call(Ne,{loaded:Ge.loaded,total:Ge.total})}),ke.on("FetchBuiltInCMap",Ge=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(Ge):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),ke.on("FetchStandardFontData",Ge=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(Ge):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var Ge;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:ke,transfers:Ne}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:ke,filename:((Ge=this._fullReader)==null?void 0:Ge.filename)??null},Ne).finally(()=>{this.annotationStorage.resetModified()})}getPage(ke){if(!Number.isInteger(ke)||ke<=0||ke>this._numPages)return Promise.reject(new Error("Invalid page request."));const Ne=ke-1,Ge=Ye(this,_e).get(Ne);if(Ge)return Ge;const Ie=this.messageHandler.sendWithPromise("GetPage",{pageIndex:Ne}).then(Le=>{if(this.destroyed)throw new Error("Transport destroyed");const He=new PDFPageProxy(Ne,Le,this,this._params.pdfBug);return Ye(this,me).set(Ne,He),He});return Ye(this,_e).set(Ne,Ie),Ie}getPageIndex(ke){return typeof ke!="object"||ke===null||!Number.isInteger(ke.num)||ke.num<0||!Number.isInteger(ke.gen)||ke.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:ke.num,gen:ke.gen})}getAnnotations(ke,Ne){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:ke,intent:Ne})}getFieldObjects(){return fr(this,Pe,wn).call(this,"GetFieldObjects")}hasJSActions(){return fr(this,Pe,wn).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(ke){return typeof ke!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:ke})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return fr(this,Pe,wn).call(this,"GetDocJSActions")}getPageJSActions(ke){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:ke})}getStructTree(ke){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:ke})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(ke=>new _optional_content_config.OptionalContentConfig(ke))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const ke="GetMetadata",Ne=Ye(this,ce).get(ke);if(Ne)return Ne;const Ge=this.messageHandler.sendWithPromise(ke,null).then(Ie=>{var Le,He;return{info:Ie[0],metadata:Ie[1]?new _metadata.Metadata(Ie[1]):null,contentDispositionFilename:((Le=this._fullReader)==null?void 0:Le.filename)??null,contentLength:((He=this._fullReader)==null?void 0:He.contentLength)??null}});return Ye(this,ce).set(ke,Ge),Ge}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(ke=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const Ne of Ye(this,me).values())if(!Ne.cleanup())throw new Error(`startCleanup: Page ${Ne.pageNumber} is currently rendering.`);this.commonObjs.clear(),ke||this.fontLoader.clear(),Ye(this,ce).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:ke,enableXfa:Ne}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:ke,enableXfa:Ne})}}ce=new WeakMap,me=new WeakMap,_e=new WeakMap,Re=new WeakMap,Pe=new WeakSet,wn=function(ke,Ne=null){const Ge=Ye(this,ce).get(ke);if(Ge)return Ge;const Ie=this.messageHandler.sendWithPromise(ke,Ne);return Ye(this,ce).set(ke,Ie),Ie};class PDFObjects{constructor(){Tr(this,Me);Tr(this,Fe,Object.create(null))}get(ke,Ne=null){if(Ne){const Ie=fr(this,Me,Gn).call(this,ke);return Ie.capability.promise.then(()=>Ne(Ie.data)),null}const Ge=Ye(this,Fe)[ke];if(!(Ge!=null&&Ge.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${ke}.`);return Ge.data}has(ke){const Ne=Ye(this,Fe)[ke];return(Ne==null?void 0:Ne.capability.settled)||!1}resolve(ke,Ne=null){const Ge=fr(this,Me,Gn).call(this,ke);Ge.data=Ne,Ge.capability.resolve()}clear(){var ke;for(const Ne in Ye(this,Fe)){const{data:Ge}=Ye(this,Fe)[Ne];(ke=Ge==null?void 0:Ge.bitmap)==null||ke.close()}Ar(this,Fe,Object.create(null))}}Fe=new WeakMap,Me=new WeakSet,Gn=function(ke){var Ne;return(Ne=Ye(this,Fe))[ke]||(Ne[ke]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(ke){Tr(this,We,null);Ar(this,We,ke),this.onContinue=null}get promise(){return Ye(this,We).capability.promise}cancel(ke=0){Ye(this,We).cancel(null,ke)}get separateAnnots(){const{separateAnnots:ke}=Ye(this,We).operatorList;if(!ke)return!1;const{annotationCanvasMap:Ne}=Ye(this,We);return ke.form||ke.canvas&&(Ne==null?void 0:Ne.size)>0}}We=new WeakMap,exports.RenderTask=RenderTask;const Ue=class Ue{constructor({callback:ke,params:Ne,objs:Ge,commonObjs:Ie,annotationCanvasMap:Le,operatorList:He,pageIndex:Ct,canvasFactory:Ze,filterFactory:Rt,useRequestAnimationFrame:nt=!1,pdfBug:nr=!1,pageColors:Je=null}){this.callback=ke,this.params=Ne,this.objs=Ge,this.commonObjs=Ie,this.annotationCanvasMap=Le,this.operatorListIdx=null,this.operatorList=He,this._pageIndex=Ct,this.canvasFactory=Ze,this.filterFactory=Rt,this._pdfBug=nr,this.pageColors=Je,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=nt===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=Ne.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:ke=!1,optionalContentConfig:Ne}){var Ct,Ze;if(this.cancelled)return;if(this._canvas){if(Ye(Ue,ze).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Ye(Ue,ze).add(this._canvas)}this._pdfBug&&((Ct=globalThis.StepperManager)!=null&&Ct.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:Ge,viewport:Ie,transform:Le,background:He}=this.params;this.gfx=new _canvas.CanvasGraphics(Ge,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:Ne},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:Le,viewport:Ie,transparency:ke,background:He}),this.operatorListIdx=0,this.graphicsReady=!0,(Ze=this.graphicsReadyCallback)==null||Ze.call(this)}cancel(ke=null,Ne=0){var Ge;this.running=!1,this.cancelled=!0,(Ge=this.gfx)==null||Ge.endDrawing(),Ye(Ue,ze).delete(this._canvas),this.callback(ke||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,Ne))}operatorListChanged(){var ke;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(ke=this.stepper)==null||ke.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Ye(Ue,ze).delete(this._canvas),this.callback())))}};ze=new WeakMap,Tr(Ue,ze,new WeakSet);let InternalRenderTask=Ue;const version="3.11.174";exports.version=version;const build="ce8716743";exports.build=build},(E,r,v)=>{var ae,ie,ce,ii,_e;Object.defineProperty(r,"__esModule",{value:!0}),r.SerializableEmpty=r.PrintAnnotationStorage=r.AnnotationStorage=void 0;var T=v(1),w=v(4),S=v(8);const I=Object.freeze({map:null,hash:"",transfers:void 0});r.SerializableEmpty=I;class H{constructor(){Tr(this,ce);Tr(this,ae,!1);Tr(this,ie,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(Pe,Ce){const Fe=Ye(this,ie).get(Pe);return Fe===void 0?Ce:Object.assign(Ce,Fe)}getRawValue(Pe){return Ye(this,ie).get(Pe)}remove(Pe){if(Ye(this,ie).delete(Pe),Ye(this,ie).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const Ce of Ye(this,ie).values())if(Ce instanceof w.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(Pe,Ce){const Fe=Ye(this,ie).get(Pe);let Me=!1;if(Fe!==void 0)for(const[Ve,We]of Object.entries(Ce))Fe[Ve]!==We&&(Me=!0,Fe[Ve]=We);else Me=!0,Ye(this,ie).set(Pe,Ce);Me&&fr(this,ce,ii).call(this),Ce instanceof w.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(Ce.constructor._type)}has(Pe){return Ye(this,ie).has(Pe)}getAll(){return Ye(this,ie).size>0?(0,T.objectFromMap)(Ye(this,ie)):null}setAll(Pe){for(const[Ce,Fe]of Object.entries(Pe))this.setValue(Ce,Fe)}get size(){return Ye(this,ie).size}resetModified(){Ye(this,ae)&&(Ar(this,ae,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new te(this)}get serializable(){if(Ye(this,ie).size===0)return I;const Pe=new Map,Ce=new S.MurmurHash3_64,Fe=[],Me=Object.create(null);let Ve=!1;for(const[We,ze]of Ye(this,ie)){const Ue=ze instanceof w.AnnotationEditor?ze.serialize(!1,Me):ze;Ue&&(Pe.set(We,Ue),Ce.update(`${We}:${JSON.stringify(Ue)}`),Ve||(Ve=!!Ue.bitmap))}if(Ve)for(const We of Pe.values())We.bitmap&&Fe.push(We.bitmap);return Pe.size>0?{map:Pe,hash:Ce.hexdigest(),transfers:Fe}:I}}ae=new WeakMap,ie=new WeakMap,ce=new WeakSet,ii=function(){Ye(this,ae)||(Ar(this,ae,!0),typeof this.onSetModified=="function"&&this.onSetModified())},r.AnnotationStorage=H;class te extends H{constructor(Ce){super();Tr(this,_e);const{map:Fe,hash:Me,transfers:Ve}=Ce.serializable,We=structuredClone(Fe,Ve?{transfer:Ve}:null);Ar(this,_e,{map:We,hash:Me,transfers:Ve})}get print(){(0,T.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return Ye(this,_e)}}_e=new WeakMap,r.PrintAnnotationStorage=te},(E,r,v)=>{var te,ae,ie,ce,me,_e,Re,Pe,Ce,Fe,Me,Ve,We,ze,Ue,qn,Xn,Ne,Kn,Yn,oi,ci,li,Jn,ui;Object.defineProperty(r,"__esModule",{value:!0}),r.AnnotationEditor=void 0;var T=v(5),w=v(1),S=v(6);const nt=class nt{constructor(Je){Tr(this,Ue);Tr(this,te,"");Tr(this,ae,!1);Tr(this,ie,null);Tr(this,ce,null);Tr(this,me,null);Tr(this,_e,!1);Tr(this,Re,null);Tr(this,Pe,this.focusin.bind(this));Tr(this,Ce,this.focusout.bind(this));Tr(this,Fe,!1);Tr(this,Me,!1);Tr(this,Ve,!1);cs(this,"_initialOptions",Object.create(null));cs(this,"_uiManager",null);cs(this,"_focusEventsAllowed",!0);cs(this,"_l10nPromise",null);Tr(this,We,!1);Tr(this,ze,nt._zIndex++);this.constructor===nt&&(0,w.unreachable)("Cannot initialize AnnotationEditor."),this.parent=Je.parent,this.id=Je.id,this.width=this.height=null,this.pageIndex=Je.parent.pageIndex,this.name=Je.name,this.div=null,this._uiManager=Je.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=Je.isCentered,this._structTreeParentId=null;const{rotation:Wt,rawDims:{pageWidth:Lt,pageHeight:qe,pageX:$e,pageY:Be}}=this.parent.viewport;this.rotation=Wt,this.pageRotation=(360+Wt-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[Lt,qe],this.pageTranslation=[$e,Be];const[Xe,rt]=this.parentDimensions;this.x=Je.x/Xe,this.y=Je.y/rt,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,w.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(Je){const Wt=new H({id:Je.parent.getNextId(),parent:Je.parent,uiManager:Je._uiManager});Wt.annotationElementId=Je.annotationElementId,Wt.deleted=!0,Wt._uiManager.addToAnnotationStorage(Wt)}static initialize(Je,Wt=null){if(nt._l10nPromise||(nt._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(qe=>[qe,Je.get(qe)]))),Wt!=null&&Wt.strings)for(const qe of Wt.strings)nt._l10nPromise.set(qe,Je.get(qe));if(nt._borderLineWidth!==-1)return;const Lt=getComputedStyle(document.documentElement);nt._borderLineWidth=parseFloat(Lt.getPropertyValue("--outline-width"))||0}static updateDefaultParams(Je,Wt){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(Je){return!1}static paste(Je,Wt){(0,w.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return Ye(this,We)}set _isDraggable(Je){var Wt;Ar(this,We,Je),(Wt=this.div)==null||Wt.classList.toggle("draggable",Je)}center(){const[Je,Wt]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*Wt/(Je*2),this.y+=this.width*Je/(Wt*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*Wt/(Je*2),this.y-=this.width*Je/(Wt*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(Je){this._uiManager.addCommands(Je)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=Ye(this,ze)}setParent(Je){Je!==null&&(this.pageIndex=Je.pageIndex,this.pageDimensions=Je.pageDimensions),this.parent=Je}focusin(Je){this._focusEventsAllowed&&(Ye(this,Fe)?Ar(this,Fe,!1):this.parent.setSelected(this))}focusout(Je){var Lt;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const Wt=Je.relatedTarget;Wt!=null&&Wt.closest(`#${this.id}`)||(Je.preventDefault(),(Lt=this.parent)!=null&&Lt.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(Je,Wt,Lt,qe){const[$e,Be]=this.parentDimensions;[Lt,qe]=this.screenToPageTranslation(Lt,qe),this.x=(Je+Lt)/$e,this.y=(Wt+qe)/Be,this.fixAndSetPosition()}translate(Je,Wt){fr(this,Ue,qn).call(this,this.parentDimensions,Je,Wt)}translateInPage(Je,Wt){fr(this,Ue,qn).call(this,this.pageDimensions,Je,Wt),this.div.scrollIntoView({block:"nearest"})}drag(Je,Wt){const[Lt,qe]=this.parentDimensions;if(this.x+=Je/Lt,this.y+=Wt/qe,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:Qe,y:vt}=this.div.getBoundingClientRect();this.parent.findNewParent(this,Qe,vt)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:$e,y:Be}=this;const[Xe,rt]=fr(this,Ue,Xn).call(this);$e+=Xe,Be+=rt,this.div.style.left=`${(100*$e).toFixed(2)}%`,this.div.style.top=`${(100*Be).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[Je,Wt]=this.pageDimensions;let{x:Lt,y:qe,width:$e,height:Be}=this;switch($e*=Je,Be*=Wt,Lt*=Je,qe*=Wt,this.rotation){case 0:Lt=Math.max(0,Math.min(Je-$e,Lt)),qe=Math.max(0,Math.min(Wt-Be,qe));break;case 90:Lt=Math.max(0,Math.min(Je-Be,Lt)),qe=Math.min(Wt,Math.max($e,qe));break;case 180:Lt=Math.min(Je,Math.max($e,Lt)),qe=Math.min(Wt,Math.max(Be,qe));break;case 270:Lt=Math.min(Je,Math.max(Be,Lt)),qe=Math.max(0,Math.min(Wt-$e,qe));break}this.x=Lt/=Je,this.y=qe/=Wt;const[Xe,rt]=fr(this,Ue,Xn).call(this);Lt+=Xe,qe+=rt;const{style:Qe}=this.div;Qe.left=`${(100*Lt).toFixed(2)}%`,Qe.top=`${(100*qe).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(Je,Wt){var Lt;return fr(Lt=nt,Ne,Kn).call(Lt,Je,Wt,this.parentRotation)}pageTranslationToScreen(Je,Wt){var Lt;return fr(Lt=nt,Ne,Kn).call(Lt,Je,Wt,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:Je,pageDimensions:[Wt,Lt]}=this,qe=Wt*Je,$e=Lt*Je;return w.FeatureTest.isCSSRoundSupported?[Math.round(qe),Math.round($e)]:[qe,$e]}setDims(Je,Wt){var $e;const[Lt,qe]=this.parentDimensions;this.div.style.width=`${(100*Je/Lt).toFixed(2)}%`,Ye(this,_e)||(this.div.style.height=`${(100*Wt/qe).toFixed(2)}%`),($e=Ye(this,ie))==null||$e.classList.toggle("small",Je<nt.SMALL_EDITOR_SIZE||Wt<nt.SMALL_EDITOR_SIZE)}fixDims(){const{style:Je}=this.div,{height:Wt,width:Lt}=Je,qe=Lt.endsWith("%"),$e=!Ye(this,_e)&&Wt.endsWith("%");if(qe&&$e)return;const[Be,Xe]=this.parentDimensions;qe||(Je.width=`${(100*parseFloat(Lt)/Be).toFixed(2)}%`),!Ye(this,_e)&&!$e&&(Je.height=`${(100*parseFloat(Wt)/Xe).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(Ye(this,ie))return;const Je=Ar(this,ie,document.createElement("button"));Je.className="altText";const Wt=await nt._l10nPromise.get("editor_alt_text_button_label");Je.textContent=Wt,Je.setAttribute("aria-label",Wt),Je.tabIndex="0",Je.addEventListener("contextmenu",S.noContextMenu),Je.addEventListener("pointerdown",Lt=>Lt.stopPropagation()),Je.addEventListener("click",Lt=>{Lt.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),Je.addEventListener("keydown",Lt=>{Lt.target===Je&&Lt.key==="Enter"&&(Lt.preventDefault(),this._uiManager.editAltText(this))}),fr(this,Ue,Jn).call(this),this.div.append(Je),nt.SMALL_EDITOR_SIZE||(nt.SMALL_EDITOR_SIZE=Math.min(128,Math.round(Je.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:Ye(this,te),decorative:Ye(this,ae)}}set altTextData({altText:Je,decorative:Wt}){Ye(this,te)===Je&&Ye(this,ae)===Wt||(Ar(this,te,Je),Ar(this,ae,Wt),fr(this,Ue,Jn).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",Ye(this,Pe)),this.div.addEventListener("focusout",Ye(this,Ce));const[Je,Wt]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*Wt/Je).toFixed(2)}%`,this.div.style.maxHeight=`${(100*Je/Wt).toFixed(2)}%`);const[Lt,qe]=this.getInitialTranslation();return this.translate(Lt,qe),(0,T.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(Je){const{isMac:Wt}=w.FeatureTest.platform;if(Je.button!==0||Je.ctrlKey&&Wt){Je.preventDefault();return}Ar(this,Fe,!0),fr(this,Ue,ui).call(this,Je)}moveInDOM(){var Je;(Je=this.parent)==null||Je.moveEditorInDOM(this)}_setParentAndPosition(Je,Wt,Lt){Je.changeParent(this),this.x=Wt,this.y=Lt,this.fixAndSetPosition()}getRect(Je,Wt){const Lt=this.parentScale,[qe,$e]=this.pageDimensions,[Be,Xe]=this.pageTranslation,rt=Je/Lt,Qe=Wt/Lt,vt=this.x*qe,Dt=this.y*$e,Ut=this.width*qe,hr=this.height*$e;switch(this.rotation){case 0:return[vt+rt+Be,$e-Dt-Qe-hr+Xe,vt+rt+Ut+Be,$e-Dt-Qe+Xe];case 90:return[vt+Qe+Be,$e-Dt+rt+Xe,vt+Qe+hr+Be,$e-Dt+rt+Ut+Xe];case 180:return[vt-rt-Ut+Be,$e-Dt+Qe+Xe,vt-rt+Be,$e-Dt+Qe+hr+Xe];case 270:return[vt-Qe-hr+Be,$e-Dt-rt-Ut+Xe,vt-Qe+Be,$e-Dt-rt+Xe];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(Je,Wt){const[Lt,qe,$e,Be]=Je,Xe=$e-Lt,rt=Be-qe;switch(this.rotation){case 0:return[Lt,Wt-Be,Xe,rt];case 90:return[Lt,Wt-qe,rt,Xe];case 180:return[$e,Wt-qe,Xe,rt];case 270:return[$e,Wt-Be,rt,Xe];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){Ar(this,Ve,!0)}disableEditMode(){Ar(this,Ve,!1)}isInEditMode(){return Ye(this,Ve)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var Je,Wt;(Je=this.div)==null||Je.addEventListener("focusin",Ye(this,Pe)),(Wt=this.div)==null||Wt.addEventListener("focusout",Ye(this,Ce))}serialize(Je=!1,Wt=null){(0,w.unreachable)("An editor must be serializable")}static deserialize(Je,Wt,Lt){const qe=new this.prototype.constructor({parent:Wt,id:Wt.getNextId(),uiManager:Lt});qe.rotation=Je.rotation;const[$e,Be]=qe.pageDimensions,[Xe,rt,Qe,vt]=qe.getRectInCurrentCoords(Je.rect,Be);return qe.x=Xe/$e,qe.y=rt/Be,qe.width=Qe/$e,qe.height=vt/Be,qe}remove(){var Je;this.div.removeEventListener("focusin",Ye(this,Pe)),this.div.removeEventListener("focusout",Ye(this,Ce)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(Je=Ye(this,ie))==null||Je.remove(),Ar(this,ie,null),Ar(this,ce,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(fr(this,Ue,oi).call(this),Ye(this,Re).classList.remove("hidden"))}select(){var Je;this.makeResizable(),(Je=this.div)==null||Je.classList.add("selectedEditor")}unselect(){var Je,Wt,Lt;(Je=Ye(this,Re))==null||Je.classList.add("hidden"),(Wt=this.div)==null||Wt.classList.remove("selectedEditor"),(Lt=this.div)!=null&&Lt.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(Je,Wt){}disableEditing(){Ye(this,ie)&&(Ye(this,ie).hidden=!0)}enableEditing(){Ye(this,ie)&&(Ye(this,ie).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return Ye(this,Me)}set isEditing(Je){Ar(this,Me,Je),this.parent&&(Je?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(Je,Wt){Ar(this,_e,!0);const Lt=Je/Wt,{style:qe}=this.div;qe.aspectRatio=Lt,qe.height="auto"}static get MIN_SIZE(){return 16}};te=new WeakMap,ae=new WeakMap,ie=new WeakMap,ce=new WeakMap,me=new WeakMap,_e=new WeakMap,Re=new WeakMap,Pe=new WeakMap,Ce=new WeakMap,Fe=new WeakMap,Me=new WeakMap,Ve=new WeakMap,We=new WeakMap,ze=new WeakMap,Ue=new WeakSet,qn=function([Je,Wt],Lt,qe){[Lt,qe]=this.screenToPageTranslation(Lt,qe),this.x+=Lt/Je,this.y+=qe/Wt,this.fixAndSetPosition()},Xn=function(){const[Je,Wt]=this.parentDimensions,{_borderLineWidth:Lt}=nt,qe=Lt/Je,$e=Lt/Wt;switch(this.rotation){case 90:return[-qe,$e];case 180:return[qe,$e];case 270:return[qe,-$e];default:return[-qe,-$e]}},Ne=new WeakSet,Kn=function(Je,Wt,Lt){switch(Lt){case 90:return[Wt,-Je];case 180:return[-Je,-Wt];case 270:return[-Wt,Je];default:return[Je,Wt]}},Yn=function(Je){switch(Je){case 90:{const[Wt,Lt]=this.pageDimensions;return[0,-Wt/Lt,Lt/Wt,0]}case 180:return[-1,0,0,-1];case 270:{const[Wt,Lt]=this.pageDimensions;return[0,Wt/Lt,-Lt/Wt,0]}default:return[1,0,0,1]}},oi=function(){if(Ye(this,Re))return;Ar(this,Re,document.createElement("div")),Ye(this,Re).classList.add("resizers");const Je=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||Je.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const Wt of Je){const Lt=document.createElement("div");Ye(this,Re).append(Lt),Lt.classList.add("resizer",Wt),Lt.addEventListener("pointerdown",fr(this,Ue,ci).bind(this,Wt)),Lt.addEventListener("contextmenu",S.noContextMenu)}this.div.prepend(Ye(this,Re))},ci=function(Je,Wt){Wt.preventDefault();const{isMac:Lt}=w.FeatureTest.platform;if(Wt.button!==0||Wt.ctrlKey&&Lt)return;const qe=fr(this,Ue,li).bind(this,Je),$e=this._isDraggable;this._isDraggable=!1;const Be={passive:!0,capture:!0};window.addEventListener("pointermove",qe,Be);const Xe=this.x,rt=this.y,Qe=this.width,vt=this.height,Dt=this.parent.div.style.cursor,Ut=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(Wt.target).cursor;const hr=()=>{this._isDraggable=$e,window.removeEventListener("pointerup",hr),window.removeEventListener("blur",hr),window.removeEventListener("pointermove",qe,Be),this.parent.div.style.cursor=Dt,this.div.style.cursor=Ut;const pt=this.x,yr=this.y,vr=this.width,wr=this.height;pt===Xe&&yr===rt&&vr===Qe&&wr===vt||this.addCommands({cmd:()=>{this.width=vr,this.height=wr,this.x=pt,this.y=yr;const[ir,sr]=this.parentDimensions;this.setDims(ir*vr,sr*wr),this.fixAndSetPosition()},undo:()=>{this.width=Qe,this.height=vt,this.x=Xe,this.y=rt;const[ir,sr]=this.parentDimensions;this.setDims(ir*Qe,sr*vt),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",hr),window.addEventListener("blur",hr)},li=function(Je,Wt){const[Lt,qe]=this.parentDimensions,$e=this.x,Be=this.y,Xe=this.width,rt=this.height,Qe=nt.MIN_SIZE/Lt,vt=nt.MIN_SIZE/qe,Dt=ur=>Math.round(ur*1e4)/1e4,Ut=fr(this,Ue,Yn).call(this,this.rotation),hr=(ur,gr)=>[Ut[0]*ur+Ut[2]*gr,Ut[1]*ur+Ut[3]*gr],pt=fr(this,Ue,Yn).call(this,360-this.rotation),yr=(ur,gr)=>[pt[0]*ur+pt[2]*gr,pt[1]*ur+pt[3]*gr];let vr,wr,ir=!1,sr=!1;switch(Je){case"topLeft":ir=!0,vr=(ur,gr)=>[0,0],wr=(ur,gr)=>[ur,gr];break;case"topMiddle":vr=(ur,gr)=>[ur/2,0],wr=(ur,gr)=>[ur/2,gr];break;case"topRight":ir=!0,vr=(ur,gr)=>[ur,0],wr=(ur,gr)=>[0,gr];break;case"middleRight":sr=!0,vr=(ur,gr)=>[ur,gr/2],wr=(ur,gr)=>[0,gr/2];break;case"bottomRight":ir=!0,vr=(ur,gr)=>[ur,gr],wr=(ur,gr)=>[0,0];break;case"bottomMiddle":vr=(ur,gr)=>[ur/2,gr],wr=(ur,gr)=>[ur/2,0];break;case"bottomLeft":ir=!0,vr=(ur,gr)=>[0,gr],wr=(ur,gr)=>[ur,0];break;case"middleLeft":sr=!0,vr=(ur,gr)=>[0,gr/2],wr=(ur,gr)=>[ur,gr/2];break}const kt=vr(Xe,rt),rr=wr(Xe,rt);let lr=hr(...rr);const mr=Dt($e+lr[0]),Ir=Dt(Be+lr[1]);let Or=1,Fr=1,[Et,dr]=this.screenToPageTranslation(Wt.movementX,Wt.movementY);if([Et,dr]=yr(Et/Lt,dr/qe),ir){const ur=Math.hypot(Xe,rt);Or=Fr=Math.max(Math.min(Math.hypot(rr[0]-kt[0]-Et,rr[1]-kt[1]-dr)/ur,1/Xe,1/rt),Qe/Xe,vt/rt)}else sr?Or=Math.max(Qe,Math.min(1,Math.abs(rr[0]-kt[0]-Et)))/Xe:Fr=Math.max(vt,Math.min(1,Math.abs(rr[1]-kt[1]-dr)))/rt;const br=Dt(Xe*Or),Br=Dt(rt*Fr);lr=hr(...wr(br,Br));const Lr=mr-lr[0],or=Ir-lr[1];this.width=br,this.height=Br,this.x=Lr,this.y=or,this.setDims(Lt*br,qe*Br),this.fixAndSetPosition()},Jn=async function(){var Lt;const Je=Ye(this,ie);if(!Je)return;if(!Ye(this,te)&&!Ye(this,ae)){Je.classList.remove("done"),(Lt=Ye(this,ce))==null||Lt.remove();return}nt._l10nPromise.get("editor_alt_text_edit_button_label").then(qe=>{Je.setAttribute("aria-label",qe)});let Wt=Ye(this,ce);if(!Wt){Ar(this,ce,Wt=document.createElement("span")),Wt.className="tooltip",Wt.setAttribute("role","tooltip");const qe=Wt.id=`alt-text-tooltip-${this.id}`;Je.setAttribute("aria-describedby",qe);const $e=100;Je.addEventListener("mouseenter",()=>{Ar(this,me,setTimeout(()=>{Ar(this,me,null),Ye(this,ce).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},$e))}),Je.addEventListener("mouseleave",()=>{var Be;clearTimeout(Ye(this,me)),Ar(this,me,null),(Be=Ye(this,ce))==null||Be.classList.remove("show")})}Je.classList.add("done"),Wt.innerText=Ye(this,ae)?await nt._l10nPromise.get("editor_alt_text_decorative_tooltip"):Ye(this,te),Wt.parentNode||Je.append(Wt)},ui=function(Je){if(!this._isDraggable)return;const Wt=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let Lt,qe;Wt&&(Lt={passive:!0,capture:!0},qe=Be=>{const[Xe,rt]=this.screenToPageTranslation(Be.movementX,Be.movementY);this._uiManager.dragSelectedEditors(Xe,rt)},window.addEventListener("pointermove",qe,Lt));const $e=()=>{if(window.removeEventListener("pointerup",$e),window.removeEventListener("blur",$e),Wt&&window.removeEventListener("pointermove",qe,Lt),Ar(this,Fe,!1),!this._uiManager.endDragSession()){const{isMac:Be}=w.FeatureTest.platform;Je.ctrlKey&&!Be||Je.shiftKey||Je.metaKey&&Be?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",$e),window.addEventListener("blur",$e)},Tr(nt,Ne),cs(nt,"_borderLineWidth",-1),cs(nt,"_colorManager",new T.ColorManager),cs(nt,"_zIndex",1),cs(nt,"SMALL_EDITOR_SIZE",0);let I=nt;r.AnnotationEditor=I;class H extends I{constructor(Je){super(Je),this.annotationElementId=Je.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(E,r,v)=>{var _e,Re,Pe,Ce,Fe,Qn,We,ze,Ue,je,ke,hi,Ie,Le,He,Ct,Ze,Rt,nt,nr,Je,Wt,Lt,qe,$e,Be,Xe,rt,Qe,vt,Dt,Ut,hr,pt,yr,vr,wr,ir,sr,kt,rr,lr,mr,Ir,Or,Fr,Et,di,Zn,ea,Sn,ta,ra,Es,Ys,fi,pi,sa,Js,na;Object.defineProperty(r,"__esModule",{value:!0}),r.KeyboardManager=r.CommandManager=r.ColorManager=r.AnnotationEditorUIManager=void 0,r.bindEvents=S,r.opacityToHex=I;var T=v(1),w=v(6);function S(ss,ar,Sr){for(const zr of Sr)ar.addEventListener(zr,ss[zr].bind(ss))}function I(ss){return Math.round(Math.min(255,Math.max(1,255*ss))).toString(16).padStart(2,"0")}class H{constructor(){Tr(this,_e,0)}getId(){return`${T.AnnotationEditorPrefix}${Ks(this,_e)._++}`}}_e=new WeakMap;const Ve=class Ve{constructor(){Tr(this,Fe);Tr(this,Re,(0,T.getUuid)());Tr(this,Pe,0);Tr(this,Ce,null)}static get _isSVGFittingCanvas(){const ar='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',zr=new OffscreenCanvas(1,3).getContext("2d"),Gr=new Image;Gr.src=ar;const Qr=Gr.decode().then(()=>(zr.drawImage(Gr,0,0,1,1,0,0,1,3),new Uint32Array(zr.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,T.shadow)(this,"_isSVGFittingCanvas",Qr)}async getFromFile(ar){const{lastModified:Sr,name:zr,size:Gr,type:Qr}=ar;return fr(this,Fe,Qn).call(this,`${Sr}_${zr}_${Gr}_${Qr}`,ar)}async getFromUrl(ar){return fr(this,Fe,Qn).call(this,ar,ar)}async getFromId(ar){Ye(this,Ce)||Ar(this,Ce,new Map);const Sr=Ye(this,Ce).get(ar);return Sr?Sr.bitmap?(Sr.refCounter+=1,Sr):Sr.file?this.getFromFile(Sr.file):this.getFromUrl(Sr.url):null}getSvgUrl(ar){const Sr=Ye(this,Ce).get(ar);return Sr!=null&&Sr.isSvg?Sr.svgUrl:null}deleteId(ar){Ye(this,Ce)||Ar(this,Ce,new Map);const Sr=Ye(this,Ce).get(ar);Sr&&(Sr.refCounter-=1,Sr.refCounter===0&&(Sr.bitmap=null))}isValidId(ar){return ar.startsWith(`image_${Ye(this,Re)}_`)}};Re=new WeakMap,Pe=new WeakMap,Ce=new WeakMap,Fe=new WeakSet,Qn=async function(ar,Sr){Ye(this,Ce)||Ar(this,Ce,new Map);let zr=Ye(this,Ce).get(ar);if(zr===null)return null;if(zr!=null&&zr.bitmap)return zr.refCounter+=1,zr;try{zr||(zr={bitmap:null,id:`image_${Ye(this,Re)}_${Ks(this,Pe)._++}`,refCounter:0,isSvg:!1});let Gr;if(typeof Sr=="string"){zr.url=Sr;const Qr=await fetch(Sr);if(!Qr.ok)throw new Error(Qr.statusText);Gr=await Qr.blob()}else Gr=zr.file=Sr;if(Gr.type==="image/svg+xml"){const Qr=Ve._isSVGFittingCanvas,Wr=new FileReader,er=new Image,Bt=new Promise((cr,_r)=>{er.onload=()=>{zr.bitmap=er,zr.isSvg=!0,cr()},Wr.onload=async()=>{const jr=zr.svgUrl=Wr.result;er.src=await Qr?`${jr}#svgView(preserveAspectRatio(none))`:jr},er.onerror=Wr.onerror=_r});Wr.readAsDataURL(Gr),await Bt}else zr.bitmap=await createImageBitmap(Gr);zr.refCounter=1}catch(Gr){console.error(Gr),zr=null}return Ye(this,Ce).set(ar,zr),zr&&Ye(this,Ce).set(zr.id,zr),zr};let te=Ve;class ae{constructor(ar=128){Tr(this,We,[]);Tr(this,ze,!1);Tr(this,Ue);Tr(this,je,-1);Ar(this,Ue,ar)}add({cmd:ar,undo:Sr,mustExec:zr,type:Gr=NaN,overwriteIfSameType:Qr=!1,keepUndo:Wr=!1}){if(zr&&ar(),Ye(this,ze))return;const er={cmd:ar,undo:Sr,type:Gr};if(Ye(this,je)===-1){Ye(this,We).length>0&&(Ye(this,We).length=0),Ar(this,je,0),Ye(this,We).push(er);return}if(Qr&&Ye(this,We)[Ye(this,je)].type===Gr){Wr&&(er.undo=Ye(this,We)[Ye(this,je)].undo),Ye(this,We)[Ye(this,je)]=er;return}const Bt=Ye(this,je)+1;Bt===Ye(this,Ue)?Ye(this,We).splice(0,1):(Ar(this,je,Bt),Bt<Ye(this,We).length&&Ye(this,We).splice(Bt)),Ye(this,We).push(er)}undo(){Ye(this,je)!==-1&&(Ar(this,ze,!0),Ye(this,We)[Ye(this,je)].undo(),Ar(this,ze,!1),Ar(this,je,Ye(this,je)-1))}redo(){Ye(this,je)<Ye(this,We).length-1&&(Ar(this,je,Ye(this,je)+1),Ar(this,ze,!0),Ye(this,We)[Ye(this,je)].cmd(),Ar(this,ze,!1))}hasSomethingToUndo(){return Ye(this,je)!==-1}hasSomethingToRedo(){return Ye(this,je)<Ye(this,We).length-1}destroy(){Ar(this,We,null)}}We=new WeakMap,ze=new WeakMap,Ue=new WeakMap,je=new WeakMap,r.CommandManager=ae;class ie{constructor(ar){Tr(this,ke);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:Sr}=T.FeatureTest.platform;for(const[zr,Gr,Qr={}]of ar)for(const Wr of zr){const er=Wr.startsWith("mac+");Sr&&er?(this.callbacks.set(Wr.slice(4),{callback:Gr,options:Qr}),this.allKeys.add(Wr.split("+").at(-1))):!Sr&&!er&&(this.callbacks.set(Wr,{callback:Gr,options:Qr}),this.allKeys.add(Wr.split("+").at(-1)))}}exec(ar,Sr){if(!this.allKeys.has(Sr.key))return;const zr=this.callbacks.get(fr(this,ke,hi).call(this,Sr));if(!zr)return;const{callback:Gr,options:{bubbles:Qr=!1,args:Wr=[],checker:er=null}}=zr;er&&!er(ar,Sr)||(Gr.bind(ar,...Wr)(),Qr||(Sr.stopPropagation(),Sr.preventDefault()))}}ke=new WeakSet,hi=function(ar){ar.altKey&&this.buffer.push("alt"),ar.ctrlKey&&this.buffer.push("ctrl"),ar.metaKey&&this.buffer.push("meta"),ar.shiftKey&&this.buffer.push("shift"),this.buffer.push(ar.key);const Sr=this.buffer.join("+");return this.buffer.length=0,Sr},r.KeyboardManager=ie;const Ge=class Ge{get _colors(){const ar=new Map([["CanvasText",null],["Canvas",null]]);return(0,w.getColorValues)(ar),(0,T.shadow)(this,"_colors",ar)}convert(ar){const Sr=(0,w.getRGB)(ar);if(!window.matchMedia("(forced-colors: active)").matches)return Sr;for(const[zr,Gr]of this._colors)if(Gr.every((Qr,Wr)=>Qr===Sr[Wr]))return Ge._colorsMapping.get(zr);return Sr}getHexCode(ar){const Sr=this._colors.get(ar);return Sr?T.Util.makeHexColor(...Sr):ar}};cs(Ge,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let ce=Ge;r.ColorManager=ce;const ns=class ns{constructor(ar,Sr,zr,Gr,Qr,Wr){Tr(this,Et);Tr(this,Ie,null);Tr(this,Le,new Map);Tr(this,He,new Map);Tr(this,Ct,null);Tr(this,Ze,null);Tr(this,Rt,new ae);Tr(this,nt,0);Tr(this,nr,new Set);Tr(this,Je,null);Tr(this,Wt,null);Tr(this,Lt,new Set);Tr(this,qe,null);Tr(this,$e,new H);Tr(this,Be,!1);Tr(this,Xe,!1);Tr(this,rt,null);Tr(this,Qe,T.AnnotationEditorType.NONE);Tr(this,vt,new Set);Tr(this,Dt,null);Tr(this,Ut,this.blur.bind(this));Tr(this,hr,this.focus.bind(this));Tr(this,pt,this.copy.bind(this));Tr(this,yr,this.cut.bind(this));Tr(this,vr,this.paste.bind(this));Tr(this,wr,this.keydown.bind(this));Tr(this,ir,this.onEditingAction.bind(this));Tr(this,sr,this.onPageChanging.bind(this));Tr(this,kt,this.onScaleChanging.bind(this));Tr(this,rr,this.onRotationChanging.bind(this));Tr(this,lr,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});Tr(this,mr,[0,0]);Tr(this,Ir,null);Tr(this,Or,null);Tr(this,Fr,null);Ar(this,Or,ar),Ar(this,Fr,Sr),Ar(this,Ct,zr),this._eventBus=Gr,this._eventBus._on("editingaction",Ye(this,ir)),this._eventBus._on("pagechanging",Ye(this,sr)),this._eventBus._on("scalechanging",Ye(this,kt)),this._eventBus._on("rotationchanging",Ye(this,rr)),Ar(this,Ze,Qr.annotationStorage),Ar(this,qe,Qr.filterFactory),Ar(this,Dt,Wr),this.viewParameters={realScale:w.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const ar=ns.prototype,Sr=Qr=>{const{activeElement:Wr}=document;return Wr&&Ye(Qr,Or).contains(Wr)&&Qr.hasSomethingToControl()},zr=this.TRANSLATE_SMALL,Gr=this.TRANSLATE_BIG;return(0,T.shadow)(this,"_keyboardManager",new ie([[["ctrl+a","mac+meta+a"],ar.selectAll],[["ctrl+z","mac+meta+z"],ar.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],ar.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],ar.delete],[["Escape","mac+Escape"],ar.unselectAll],[["ArrowLeft","mac+ArrowLeft"],ar.translateSelectedEditors,{args:[-zr,0],checker:Sr}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],ar.translateSelectedEditors,{args:[-Gr,0],checker:Sr}],[["ArrowRight","mac+ArrowRight"],ar.translateSelectedEditors,{args:[zr,0],checker:Sr}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],ar.translateSelectedEditors,{args:[Gr,0],checker:Sr}],[["ArrowUp","mac+ArrowUp"],ar.translateSelectedEditors,{args:[0,-zr],checker:Sr}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],ar.translateSelectedEditors,{args:[0,-Gr],checker:Sr}],[["ArrowDown","mac+ArrowDown"],ar.translateSelectedEditors,{args:[0,zr],checker:Sr}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],ar.translateSelectedEditors,{args:[0,Gr],checker:Sr}]]))}destroy(){fr(this,Et,Sn).call(this),fr(this,Et,Zn).call(this),this._eventBus._off("editingaction",Ye(this,ir)),this._eventBus._off("pagechanging",Ye(this,sr)),this._eventBus._off("scalechanging",Ye(this,kt)),this._eventBus._off("rotationchanging",Ye(this,rr));for(const ar of Ye(this,He).values())ar.destroy();Ye(this,He).clear(),Ye(this,Le).clear(),Ye(this,Lt).clear(),Ar(this,Ie,null),Ye(this,vt).clear(),Ye(this,Rt).destroy(),Ye(this,Ct).destroy()}get hcmFilter(){return(0,T.shadow)(this,"hcmFilter",Ye(this,Dt)?Ye(this,qe).addHCMFilter(Ye(this,Dt).foreground,Ye(this,Dt).background):"none")}get direction(){return(0,T.shadow)(this,"direction",getComputedStyle(Ye(this,Or)).direction)}editAltText(ar){var Sr;(Sr=Ye(this,Ct))==null||Sr.editAltText(this,ar)}onPageChanging({pageNumber:ar}){Ar(this,nt,ar-1)}focusMainContainer(){Ye(this,Or).focus()}findParent(ar,Sr){for(const zr of Ye(this,He).values()){const{x:Gr,y:Qr,width:Wr,height:er}=zr.div.getBoundingClientRect();if(ar>=Gr&&ar<=Gr+Wr&&Sr>=Qr&&Sr<=Qr+er)return zr}return null}disableUserSelect(ar=!1){Ye(this,Fr).classList.toggle("noUserSelect",ar)}addShouldRescale(ar){Ye(this,Lt).add(ar)}removeShouldRescale(ar){Ye(this,Lt).delete(ar)}onScaleChanging({scale:ar}){this.commitOrRemove(),this.viewParameters.realScale=ar*w.PixelsPerInch.PDF_TO_CSS_UNITS;for(const Sr of Ye(this,Lt))Sr.onScaleChanging()}onRotationChanging({pagesRotation:ar}){this.commitOrRemove(),this.viewParameters.rotation=ar}addToAnnotationStorage(ar){!ar.isEmpty()&&Ye(this,Ze)&&!Ye(this,Ze).has(ar.id)&&Ye(this,Ze).setValue(ar.id,ar)}blur(){if(!this.hasSelection)return;const{activeElement:ar}=document;for(const Sr of Ye(this,vt))if(Sr.div.contains(ar)){Ar(this,rt,[Sr,ar]),Sr._focusEventsAllowed=!1;break}}focus(){if(!Ye(this,rt))return;const[ar,Sr]=Ye(this,rt);Ar(this,rt,null),Sr.addEventListener("focusin",()=>{ar._focusEventsAllowed=!0},{once:!0}),Sr.focus()}addEditListeners(){fr(this,Et,ea).call(this),fr(this,Et,ta).call(this)}removeEditListeners(){fr(this,Et,Sn).call(this),fr(this,Et,ra).call(this)}copy(ar){var zr;if(ar.preventDefault(),(zr=Ye(this,Ie))==null||zr.commitOrRemove(),!this.hasSelection)return;const Sr=[];for(const Gr of Ye(this,vt)){const Qr=Gr.serialize(!0);Qr&&Sr.push(Qr)}Sr.length!==0&&ar.clipboardData.setData("application/pdfjs",JSON.stringify(Sr))}cut(ar){this.copy(ar),this.delete()}paste(ar){ar.preventDefault();const{clipboardData:Sr}=ar;for(const Qr of Sr.items)for(const Wr of Ye(this,Wt))if(Wr.isHandlingMimeForPasting(Qr.type)){Wr.paste(Qr,this.currentLayer);return}let zr=Sr.getData("application/pdfjs");if(!zr)return;try{zr=JSON.parse(zr)}catch(Qr){(0,T.warn)(`paste: "${Qr.message}".`);return}if(!Array.isArray(zr))return;this.unselectAll();const Gr=this.currentLayer;try{const Qr=[];for(const Bt of zr){const cr=Gr.deserialize(Bt);if(!cr)return;Qr.push(cr)}const Wr=()=>{for(const Bt of Qr)fr(this,Et,sa).call(this,Bt);fr(this,Et,na).call(this,Qr)},er=()=>{for(const Bt of Qr)Bt.remove()};this.addCommands({cmd:Wr,undo:er,mustExec:!0})}catch(Qr){(0,T.warn)(`paste: "${Qr.message}".`)}}keydown(ar){var Sr;(Sr=this.getActive())!=null&&Sr.shouldGetKeyboardEvents()||ns._keyboardManager.exec(this,ar)}onEditingAction(ar){["undo","redo","delete","selectAll"].includes(ar.name)&&this[ar.name]()}setEditingState(ar){ar?(fr(this,Et,di).call(this),fr(this,Et,ea).call(this),fr(this,Et,ta).call(this),fr(this,Et,Es).call(this,{isEditing:Ye(this,Qe)!==T.AnnotationEditorType.NONE,isEmpty:fr(this,Et,Js).call(this),hasSomethingToUndo:Ye(this,Rt).hasSomethingToUndo(),hasSomethingToRedo:Ye(this,Rt).hasSomethingToRedo(),hasSelectedEditor:!1})):(fr(this,Et,Zn).call(this),fr(this,Et,Sn).call(this),fr(this,Et,ra).call(this),fr(this,Et,Es).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(ar){if(!Ye(this,Wt)){Ar(this,Wt,ar);for(const Sr of Ye(this,Wt))fr(this,Et,Ys).call(this,Sr.defaultPropertiesToUpdate)}}getId(){return Ye(this,$e).getId()}get currentLayer(){return Ye(this,He).get(Ye(this,nt))}getLayer(ar){return Ye(this,He).get(ar)}get currentPageIndex(){return Ye(this,nt)}addLayer(ar){Ye(this,He).set(ar.pageIndex,ar),Ye(this,Be)?ar.enable():ar.disable()}removeLayer(ar){Ye(this,He).delete(ar.pageIndex)}updateMode(ar,Sr=null){if(Ye(this,Qe)!==ar){if(Ar(this,Qe,ar),ar===T.AnnotationEditorType.NONE){this.setEditingState(!1),fr(this,Et,pi).call(this);return}this.setEditingState(!0),fr(this,Et,fi).call(this),this.unselectAll();for(const zr of Ye(this,He).values())zr.updateMode(ar);if(Sr){for(const zr of Ye(this,Le).values())if(zr.annotationElementId===Sr){this.setSelected(zr),zr.enterInEditMode();break}}}}updateToolbar(ar){ar!==Ye(this,Qe)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:ar})}updateParams(ar,Sr){if(Ye(this,Wt)){if(ar===T.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(ar);return}for(const zr of Ye(this,vt))zr.updateParams(ar,Sr);for(const zr of Ye(this,Wt))zr.updateDefaultParams(ar,Sr)}}enableWaiting(ar=!1){if(Ye(this,Xe)!==ar){Ar(this,Xe,ar);for(const Sr of Ye(this,He).values())ar?Sr.disableClick():Sr.enableClick(),Sr.div.classList.toggle("waiting",ar)}}getEditors(ar){const Sr=[];for(const zr of Ye(this,Le).values())zr.pageIndex===ar&&Sr.push(zr);return Sr}getEditor(ar){return Ye(this,Le).get(ar)}addEditor(ar){Ye(this,Le).set(ar.id,ar)}removeEditor(ar){var Sr;Ye(this,Le).delete(ar.id),this.unselect(ar),(!ar.annotationElementId||!Ye(this,nr).has(ar.annotationElementId))&&((Sr=Ye(this,Ze))==null||Sr.remove(ar.id))}addDeletedAnnotationElement(ar){Ye(this,nr).add(ar.annotationElementId),ar.deleted=!0}isDeletedAnnotationElement(ar){return Ye(this,nr).has(ar)}removeDeletedAnnotationElement(ar){Ye(this,nr).delete(ar.annotationElementId),ar.deleted=!1}setActiveEditor(ar){Ye(this,Ie)!==ar&&(Ar(this,Ie,ar),ar&&fr(this,Et,Ys).call(this,ar.propertiesToUpdate))}toggleSelected(ar){if(Ye(this,vt).has(ar)){Ye(this,vt).delete(ar),ar.unselect(),fr(this,Et,Es).call(this,{hasSelectedEditor:this.hasSelection});return}Ye(this,vt).add(ar),ar.select(),fr(this,Et,Ys).call(this,ar.propertiesToUpdate),fr(this,Et,Es).call(this,{hasSelectedEditor:!0})}setSelected(ar){for(const Sr of Ye(this,vt))Sr!==ar&&Sr.unselect();Ye(this,vt).clear(),Ye(this,vt).add(ar),ar.select(),fr(this,Et,Ys).call(this,ar.propertiesToUpdate),fr(this,Et,Es).call(this,{hasSelectedEditor:!0})}isSelected(ar){return Ye(this,vt).has(ar)}unselect(ar){ar.unselect(),Ye(this,vt).delete(ar),fr(this,Et,Es).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return Ye(this,vt).size!==0}undo(){Ye(this,Rt).undo(),fr(this,Et,Es).call(this,{hasSomethingToUndo:Ye(this,Rt).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:fr(this,Et,Js).call(this)})}redo(){Ye(this,Rt).redo(),fr(this,Et,Es).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:Ye(this,Rt).hasSomethingToRedo(),isEmpty:fr(this,Et,Js).call(this)})}addCommands(ar){Ye(this,Rt).add(ar),fr(this,Et,Es).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:fr(this,Et,Js).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const ar=[...Ye(this,vt)],Sr=()=>{for(const Gr of ar)Gr.remove()},zr=()=>{for(const Gr of ar)fr(this,Et,sa).call(this,Gr)};this.addCommands({cmd:Sr,undo:zr,mustExec:!0})}commitOrRemove(){var ar;(ar=Ye(this,Ie))==null||ar.commitOrRemove()}hasSomethingToControl(){return Ye(this,Ie)||this.hasSelection}selectAll(){for(const ar of Ye(this,vt))ar.commit();fr(this,Et,na).call(this,Ye(this,Le).values())}unselectAll(){if(Ye(this,Ie)){Ye(this,Ie).commitOrRemove();return}if(this.hasSelection){for(const ar of Ye(this,vt))ar.unselect();Ye(this,vt).clear(),fr(this,Et,Es).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(ar,Sr,zr=!1){if(zr||this.commitOrRemove(),!this.hasSelection)return;Ye(this,mr)[0]+=ar,Ye(this,mr)[1]+=Sr;const[Gr,Qr]=Ye(this,mr),Wr=[...Ye(this,vt)],er=1e3;Ye(this,Ir)&&clearTimeout(Ye(this,Ir)),Ar(this,Ir,setTimeout(()=>{Ar(this,Ir,null),Ye(this,mr)[0]=Ye(this,mr)[1]=0,this.addCommands({cmd:()=>{for(const Bt of Wr)Ye(this,Le).has(Bt.id)&&Bt.translateInPage(Gr,Qr)},undo:()=>{for(const Bt of Wr)Ye(this,Le).has(Bt.id)&&Bt.translateInPage(-Gr,-Qr)},mustExec:!1})},er));for(const Bt of Wr)Bt.translateInPage(ar,Sr)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),Ar(this,Je,new Map);for(const ar of Ye(this,vt))Ye(this,Je).set(ar,{savedX:ar.x,savedY:ar.y,savedPageIndex:ar.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!Ye(this,Je))return!1;this.disableUserSelect(!1);const ar=Ye(this,Je);Ar(this,Je,null);let Sr=!1;for(const[{x:Gr,y:Qr,pageIndex:Wr},er]of ar)er.newX=Gr,er.newY=Qr,er.newPageIndex=Wr,Sr||(Sr=Gr!==er.savedX||Qr!==er.savedY||Wr!==er.savedPageIndex);if(!Sr)return!1;const zr=(Gr,Qr,Wr,er)=>{if(Ye(this,Le).has(Gr.id)){const Bt=Ye(this,He).get(er);Bt?Gr._setParentAndPosition(Bt,Qr,Wr):(Gr.pageIndex=er,Gr.x=Qr,Gr.y=Wr)}};return this.addCommands({cmd:()=>{for(const[Gr,{newX:Qr,newY:Wr,newPageIndex:er}]of ar)zr(Gr,Qr,Wr,er)},undo:()=>{for(const[Gr,{savedX:Qr,savedY:Wr,savedPageIndex:er}]of ar)zr(Gr,Qr,Wr,er)},mustExec:!0}),!0}dragSelectedEditors(ar,Sr){if(Ye(this,Je))for(const zr of Ye(this,Je).keys())zr.drag(ar,Sr)}rebuild(ar){if(ar.parent===null){const Sr=this.getLayer(ar.pageIndex);Sr?(Sr.changeParent(ar),Sr.addOrRebuild(ar)):(this.addEditor(ar),this.addToAnnotationStorage(ar),ar.rebuild())}else ar.parent.addOrRebuild(ar)}isActive(ar){return Ye(this,Ie)===ar}getActive(){return Ye(this,Ie)}getMode(){return Ye(this,Qe)}get imageManager(){return(0,T.shadow)(this,"imageManager",new te)}};Ie=new WeakMap,Le=new WeakMap,He=new WeakMap,Ct=new WeakMap,Ze=new WeakMap,Rt=new WeakMap,nt=new WeakMap,nr=new WeakMap,Je=new WeakMap,Wt=new WeakMap,Lt=new WeakMap,qe=new WeakMap,$e=new WeakMap,Be=new WeakMap,Xe=new WeakMap,rt=new WeakMap,Qe=new WeakMap,vt=new WeakMap,Dt=new WeakMap,Ut=new WeakMap,hr=new WeakMap,pt=new WeakMap,yr=new WeakMap,vr=new WeakMap,wr=new WeakMap,ir=new WeakMap,sr=new WeakMap,kt=new WeakMap,rr=new WeakMap,lr=new WeakMap,mr=new WeakMap,Ir=new WeakMap,Or=new WeakMap,Fr=new WeakMap,Et=new WeakSet,di=function(){window.addEventListener("focus",Ye(this,hr)),window.addEventListener("blur",Ye(this,Ut))},Zn=function(){window.removeEventListener("focus",Ye(this,hr)),window.removeEventListener("blur",Ye(this,Ut))},ea=function(){window.addEventListener("keydown",Ye(this,wr),{capture:!0})},Sn=function(){window.removeEventListener("keydown",Ye(this,wr),{capture:!0})},ta=function(){document.addEventListener("copy",Ye(this,pt)),document.addEventListener("cut",Ye(this,yr)),document.addEventListener("paste",Ye(this,vr))},ra=function(){document.removeEventListener("copy",Ye(this,pt)),document.removeEventListener("cut",Ye(this,yr)),document.removeEventListener("paste",Ye(this,vr))},Es=function(ar){Object.entries(ar).some(([zr,Gr])=>Ye(this,lr)[zr]!==Gr)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(Ye(this,lr),ar)})},Ys=function(ar){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:ar})},fi=function(){if(!Ye(this,Be)){Ar(this,Be,!0);for(const ar of Ye(this,He).values())ar.enable()}},pi=function(){if(this.unselectAll(),Ye(this,Be)){Ar(this,Be,!1);for(const ar of Ye(this,He).values())ar.disable()}},sa=function(ar){const Sr=Ye(this,He).get(ar.pageIndex);Sr?Sr.addOrRebuild(ar):this.addEditor(ar)},Js=function(){if(Ye(this,Le).size===0)return!0;if(Ye(this,Le).size===1)for(const ar of Ye(this,Le).values())return ar.isEmpty();return!1},na=function(ar){Ye(this,vt).clear();for(const Sr of ar)Sr.isEmpty()||(Ye(this,vt).add(Sr),Sr.select());fr(this,Et,Es).call(this,{hasSelectedEditor:!0})},cs(ns,"TRANSLATE_SMALL",1),cs(ns,"TRANSLATE_BIG",10);let me=ns;r.AnnotationEditorUIManager=me},(E,r,v)=>{var nt,nr,Je,Wt,Lt,qe,$e,Be,Xe,rt,Qe,vt,Os,Vs,aa,Cn,Pn,Qs,Zs;Object.defineProperty(r,"__esModule",{value:!0}),r.StatTimer=r.RenderingCancelledException=r.PixelsPerInch=r.PageViewport=r.PDFDateString=r.DOMStandardFontDataFactory=r.DOMSVGFactory=r.DOMFilterFactory=r.DOMCanvasFactory=r.DOMCMapReaderFactory=void 0,r.deprecated=je,r.getColorValues=Le,r.getCurrentTransform=He,r.getCurrentTransformInverse=Ct,r.getFilenameFromUrl=Fe,r.getPdfFilenameFromUrl=Me,r.getRGB=Ie,r.getXfaPageViewport=Ge,r.isDataScheme=Pe,r.isPdfFile=Ce,r.isValidFetchUrl=We,r.loadScript=Ue,r.noContextMenu=ze,r.setLayerDimensions=Ze;var T=v(7),w=v(1);const S="http://www.w3.org/2000/svg",Rt=class Rt{};cs(Rt,"CSS",96),cs(Rt,"PDF",72),cs(Rt,"PDF_TO_CSS_UNITS",Rt.CSS/Rt.PDF);let I=Rt;r.PixelsPerInch=I;class H extends T.BaseFilterFactory{constructor({docId:kt,ownerDocument:rr=globalThis.document}={}){super();Tr(this,vt);Tr(this,nt);Tr(this,nr);Tr(this,Je);Tr(this,Wt);Tr(this,Lt);Tr(this,qe);Tr(this,$e);Tr(this,Be);Tr(this,Xe);Tr(this,rt);Tr(this,Qe,0);Ar(this,Je,kt),Ar(this,Wt,rr)}addFilter(kt){if(!kt)return"none";let rr=Ye(this,vt,Os).get(kt);if(rr)return rr;let lr,mr,Ir,Or;if(kt.length===1){const br=kt[0],Br=new Array(256);for(let Lr=0;Lr<256;Lr++)Br[Lr]=br[Lr]/255;Or=lr=mr=Ir=Br.join(",")}else{const[br,Br,Lr]=kt,or=new Array(256),ur=new Array(256),gr=new Array(256);for(let $r=0;$r<256;$r++)or[$r]=br[$r]/255,ur[$r]=Br[$r]/255,gr[$r]=Lr[$r]/255;lr=or.join(","),mr=ur.join(","),Ir=gr.join(","),Or=`${lr}${mr}${Ir}`}if(rr=Ye(this,vt,Os).get(Or),rr)return Ye(this,vt,Os).set(kt,rr),rr;const Fr=`g_${Ye(this,Je)}_transfer_map_${Ks(this,Qe)._++}`,Et=`url(#${Fr})`;Ye(this,vt,Os).set(kt,Et),Ye(this,vt,Os).set(Or,Et);const dr=fr(this,vt,Cn).call(this,Fr);return fr(this,vt,Qs).call(this,lr,mr,Ir,dr),Et}addHCMFilter(kt,rr){var Br;const lr=`${kt}-${rr}`;if(Ye(this,qe)===lr)return Ye(this,$e);if(Ar(this,qe,lr),Ar(this,$e,"none"),(Br=Ye(this,Lt))==null||Br.remove(),!kt||!rr)return Ye(this,$e);const mr=fr(this,vt,Zs).call(this,kt);kt=w.Util.makeHexColor(...mr);const Ir=fr(this,vt,Zs).call(this,rr);if(rr=w.Util.makeHexColor(...Ir),Ye(this,vt,Vs).style.color="",kt==="#000000"&&rr==="#ffffff"||kt===rr)return Ye(this,$e);const Or=new Array(256);for(let Lr=0;Lr<=255;Lr++){const or=Lr/255;Or[Lr]=or<=.03928?or/12.92:((or+.055)/1.055)**2.4}const Fr=Or.join(","),Et=`g_${Ye(this,Je)}_hcm_filter`,dr=Ar(this,Be,fr(this,vt,Cn).call(this,Et));fr(this,vt,Qs).call(this,Fr,Fr,Fr,dr),fr(this,vt,aa).call(this,dr);const br=(Lr,or)=>{const ur=mr[Lr]/255,gr=Ir[Lr]/255,$r=new Array(or+1);for(let Xr=0;Xr<=or;Xr++)$r[Xr]=ur+Xr/or*(gr-ur);return $r.join(",")};return fr(this,vt,Qs).call(this,br(0,5),br(1,5),br(2,5),dr),Ar(this,$e,`url(#${Et})`),Ye(this,$e)}addHighlightHCMFilter(kt,rr,lr,mr){var gr;const Ir=`${kt}-${rr}-${lr}-${mr}`;if(Ye(this,Xe)===Ir)return Ye(this,rt);if(Ar(this,Xe,Ir),Ar(this,rt,"none"),(gr=Ye(this,Be))==null||gr.remove(),!kt||!rr)return Ye(this,rt);const[Or,Fr]=[kt,rr].map(fr(this,vt,Zs).bind(this));let Et=Math.round(.2126*Or[0]+.7152*Or[1]+.0722*Or[2]),dr=Math.round(.2126*Fr[0]+.7152*Fr[1]+.0722*Fr[2]),[br,Br]=[lr,mr].map(fr(this,vt,Zs).bind(this));dr<Et&&([Et,dr,br,Br]=[dr,Et,Br,br]),Ye(this,vt,Vs).style.color="";const Lr=($r,Xr,Rr)=>{const pr=new Array(256),xr=(dr-Et)/Rr,qr=$r/255,ns=(Xr-$r)/(255*Rr);let ss=0;for(let ar=0;ar<=Rr;ar++){const Sr=Math.round(Et+ar*xr),zr=qr+ar*ns;for(let Gr=ss;Gr<=Sr;Gr++)pr[Gr]=zr;ss=Sr+1}for(let ar=ss;ar<256;ar++)pr[ar]=pr[ss-1];return pr.join(",")},or=`g_${Ye(this,Je)}_hcm_highlight_filter`,ur=Ar(this,Be,fr(this,vt,Cn).call(this,or));return fr(this,vt,aa).call(this,ur),fr(this,vt,Qs).call(this,Lr(br[0],Br[0],5),Lr(br[1],Br[1],5),Lr(br[2],Br[2],5),ur),Ar(this,rt,`url(#${or})`),Ye(this,rt)}destroy(kt=!1){kt&&(Ye(this,$e)||Ye(this,rt))||(Ye(this,nr)&&(Ye(this,nr).parentNode.parentNode.remove(),Ar(this,nr,null)),Ye(this,nt)&&(Ye(this,nt).clear(),Ar(this,nt,null)),Ar(this,Qe,0))}}nt=new WeakMap,nr=new WeakMap,Je=new WeakMap,Wt=new WeakMap,Lt=new WeakMap,qe=new WeakMap,$e=new WeakMap,Be=new WeakMap,Xe=new WeakMap,rt=new WeakMap,Qe=new WeakMap,vt=new WeakSet,Os=function(){return Ye(this,nt)||Ar(this,nt,new Map)},Vs=function(){if(!Ye(this,nr)){const kt=Ye(this,Wt).createElement("div"),{style:rr}=kt;rr.visibility="hidden",rr.contain="strict",rr.width=rr.height=0,rr.position="absolute",rr.top=rr.left=0,rr.zIndex=-1;const lr=Ye(this,Wt).createElementNS(S,"svg");lr.setAttribute("width",0),lr.setAttribute("height",0),Ar(this,nr,Ye(this,Wt).createElementNS(S,"defs")),kt.append(lr),lr.append(Ye(this,nr)),Ye(this,Wt).body.append(kt)}return Ye(this,nr)},aa=function(kt){const rr=Ye(this,Wt).createElementNS(S,"feColorMatrix");rr.setAttribute("type","matrix"),rr.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),kt.append(rr)},Cn=function(kt){const rr=Ye(this,Wt).createElementNS(S,"filter");return rr.setAttribute("color-interpolation-filters","sRGB"),rr.setAttribute("id",kt),Ye(this,vt,Vs).append(rr),rr},Pn=function(kt,rr,lr){const mr=Ye(this,Wt).createElementNS(S,rr);mr.setAttribute("type","discrete"),mr.setAttribute("tableValues",lr),kt.append(mr)},Qs=function(kt,rr,lr,mr){const Ir=Ye(this,Wt).createElementNS(S,"feComponentTransfer");mr.append(Ir),fr(this,vt,Pn).call(this,Ir,"feFuncR",kt),fr(this,vt,Pn).call(this,Ir,"feFuncG",rr),fr(this,vt,Pn).call(this,Ir,"feFuncB",lr)},Zs=function(kt){return Ye(this,vt,Vs).style.color=kt,Ie(getComputedStyle(Ye(this,vt,Vs)).getPropertyValue("color"))},r.DOMFilterFactory=H;class te extends T.BaseCanvasFactory{constructor({ownerDocument:sr=globalThis.document}={}){super(),this._document=sr}_createCanvas(sr,kt){const rr=this._document.createElement("canvas");return rr.width=sr,rr.height=kt,rr}}r.DOMCanvasFactory=te;async function ae(ir,sr=!1){if(We(ir,document.baseURI)){const kt=await fetch(ir);if(!kt.ok)throw new Error(kt.statusText);return sr?new Uint8Array(await kt.arrayBuffer()):(0,w.stringToBytes)(await kt.text())}return new Promise((kt,rr)=>{const lr=new XMLHttpRequest;lr.open("GET",ir,!0),sr&&(lr.responseType="arraybuffer"),lr.onreadystatechange=()=>{if(lr.readyState===XMLHttpRequest.DONE){if(lr.status===200||lr.status===0){let mr;if(sr&&lr.response?mr=new Uint8Array(lr.response):!sr&&lr.responseText&&(mr=(0,w.stringToBytes)(lr.responseText)),mr){kt(mr);return}}rr(new Error(lr.statusText))}},lr.send(null)})}class ie extends T.BaseCMapReaderFactory{_fetchData(sr,kt){return ae(sr,this.isCompressed).then(rr=>({cMapData:rr,compressionType:kt}))}}r.DOMCMapReaderFactory=ie;class ce extends T.BaseStandardFontDataFactory{_fetchData(sr){return ae(sr,!0)}}r.DOMStandardFontDataFactory=ce;class me extends T.BaseSVGFactory{_createSVG(sr){return document.createElementNS(S,sr)}}r.DOMSVGFactory=me;class _e{constructor({viewBox:sr,scale:kt,rotation:rr,offsetX:lr=0,offsetY:mr=0,dontFlip:Ir=!1}){this.viewBox=sr,this.scale=kt,this.rotation=rr,this.offsetX=lr,this.offsetY=mr;const Or=(sr[2]+sr[0])/2,Fr=(sr[3]+sr[1])/2;let Et,dr,br,Br;switch(rr%=360,rr<0&&(rr+=360),rr){case 180:Et=-1,dr=0,br=0,Br=1;break;case 90:Et=0,dr=1,br=1,Br=0;break;case 270:Et=0,dr=-1,br=-1,Br=0;break;case 0:Et=1,dr=0,br=0,Br=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}Ir&&(br=-br,Br=-Br);let Lr,or,ur,gr;Et===0?(Lr=Math.abs(Fr-sr[1])*kt+lr,or=Math.abs(Or-sr[0])*kt+mr,ur=(sr[3]-sr[1])*kt,gr=(sr[2]-sr[0])*kt):(Lr=Math.abs(Or-sr[0])*kt+lr,or=Math.abs(Fr-sr[1])*kt+mr,ur=(sr[2]-sr[0])*kt,gr=(sr[3]-sr[1])*kt),this.transform=[Et*kt,dr*kt,br*kt,Br*kt,Lr-Et*kt*Or-br*kt*Fr,or-dr*kt*Or-Br*kt*Fr],this.width=ur,this.height=gr}get rawDims(){const{viewBox:sr}=this;return(0,w.shadow)(this,"rawDims",{pageWidth:sr[2]-sr[0],pageHeight:sr[3]-sr[1],pageX:sr[0],pageY:sr[1]})}clone({scale:sr=this.scale,rotation:kt=this.rotation,offsetX:rr=this.offsetX,offsetY:lr=this.offsetY,dontFlip:mr=!1}={}){return new _e({viewBox:this.viewBox.slice(),scale:sr,rotation:kt,offsetX:rr,offsetY:lr,dontFlip:mr})}convertToViewportPoint(sr,kt){return w.Util.applyTransform([sr,kt],this.transform)}convertToViewportRectangle(sr){const kt=w.Util.applyTransform([sr[0],sr[1]],this.transform),rr=w.Util.applyTransform([sr[2],sr[3]],this.transform);return[kt[0],kt[1],rr[0],rr[1]]}convertToPdfPoint(sr,kt){return w.Util.applyInverseTransform([sr,kt],this.transform)}}r.PageViewport=_e;class Re extends w.BaseException{constructor(sr,kt=0){super(sr,"RenderingCancelledException"),this.extraDelay=kt}}r.RenderingCancelledException=Re;function Pe(ir){const sr=ir.length;let kt=0;for(;kt<sr&&ir[kt].trim()==="";)kt++;return ir.substring(kt,kt+5).toLowerCase()==="data:"}function Ce(ir){return typeof ir=="string"&&/\.pdf$/i.test(ir)}function Fe(ir,sr=!1){return sr||([ir]=ir.split(/[#?]/,1)),ir.substring(ir.lastIndexOf("/")+1)}function Me(ir,sr="document.pdf"){if(typeof ir!="string")return sr;if(Pe(ir))return(0,w.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),sr;const kt=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,rr=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,lr=kt.exec(ir);let mr=rr.exec(lr[1])||rr.exec(lr[2])||rr.exec(lr[3]);if(mr&&(mr=mr[0],mr.includes("%")))try{mr=rr.exec(decodeURIComponent(mr))[0]}catch{}return mr||sr}class Ve{constructor(){cs(this,"started",Object.create(null));cs(this,"times",[])}time(sr){sr in this.started&&(0,w.warn)(`Timer is already running for ${sr}`),this.started[sr]=Date.now()}timeEnd(sr){sr in this.started||(0,w.warn)(`Timer has not been started for ${sr}`),this.times.push({name:sr,start:this.started[sr],end:Date.now()}),delete this.started[sr]}toString(){const sr=[];let kt=0;for(const{name:rr}of this.times)kt=Math.max(rr.length,kt);for(const{name:rr,start:lr,end:mr}of this.times)sr.push(`${rr.padEnd(kt)} ${mr-lr}ms
`);return sr.join("")}}r.StatTimer=Ve;function We(ir,sr){try{const{protocol:kt}=sr?new URL(ir,sr):new URL(ir);return kt==="http:"||kt==="https:"}catch{return!1}}function ze(ir){ir.preventDefault()}function Ue(ir,sr=!1){return new Promise((kt,rr)=>{const lr=document.createElement("script");lr.src=ir,lr.onload=function(mr){sr&&lr.remove(),kt(mr)},lr.onerror=function(){rr(new Error(`Cannot load script at: ${lr.src}`))},(document.head||document.documentElement).append(lr)})}function je(ir){console.log("Deprecated API usage: "+ir)}let ke;class Ne{static toDateObject(sr){if(!sr||typeof sr!="string")return null;ke||(ke=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const kt=ke.exec(sr);if(!kt)return null;const rr=parseInt(kt[1],10);let lr=parseInt(kt[2],10);lr=lr>=1&&lr<=12?lr-1:0;let mr=parseInt(kt[3],10);mr=mr>=1&&mr<=31?mr:1;let Ir=parseInt(kt[4],10);Ir=Ir>=0&&Ir<=23?Ir:0;let Or=parseInt(kt[5],10);Or=Or>=0&&Or<=59?Or:0;let Fr=parseInt(kt[6],10);Fr=Fr>=0&&Fr<=59?Fr:0;const Et=kt[7]||"Z";let dr=parseInt(kt[8],10);dr=dr>=0&&dr<=23?dr:0;let br=parseInt(kt[9],10)||0;return br=br>=0&&br<=59?br:0,Et==="-"?(Ir+=dr,Or+=br):Et==="+"&&(Ir-=dr,Or-=br),new Date(Date.UTC(rr,lr,mr,Ir,Or,Fr))}}r.PDFDateString=Ne;function Ge(ir,{scale:sr=1,rotation:kt=0}){const{width:rr,height:lr}=ir.attributes.style,mr=[0,0,parseInt(rr),parseInt(lr)];return new _e({viewBox:mr,scale:sr,rotation:kt})}function Ie(ir){if(ir.startsWith("#")){const sr=parseInt(ir.slice(1),16);return[(sr&16711680)>>16,(sr&65280)>>8,sr&255]}return ir.startsWith("rgb(")?ir.slice(4,-1).split(",").map(sr=>parseInt(sr)):ir.startsWith("rgba(")?ir.slice(5,-1).split(",").map(sr=>parseInt(sr)).slice(0,3):((0,w.warn)(`Not a valid color format: "${ir}"`),[0,0,0])}function Le(ir){const sr=document.createElement("span");sr.style.visibility="hidden",document.body.append(sr);for(const kt of ir.keys()){sr.style.color=kt;const rr=window.getComputedStyle(sr).color;ir.set(kt,Ie(rr))}sr.remove()}function He(ir){const{a:sr,b:kt,c:rr,d:lr,e:mr,f:Ir}=ir.getTransform();return[sr,kt,rr,lr,mr,Ir]}function Ct(ir){const{a:sr,b:kt,c:rr,d:lr,e:mr,f:Ir}=ir.getTransform().invertSelf();return[sr,kt,rr,lr,mr,Ir]}function Ze(ir,sr,kt=!1,rr=!0){if(sr instanceof _e){const{pageWidth:lr,pageHeight:mr}=sr.rawDims,{style:Ir}=ir,Or=w.FeatureTest.isCSSRoundSupported,Fr=`var(--scale-factor) * ${lr}px`,Et=`var(--scale-factor) * ${mr}px`,dr=Or?`round(${Fr}, 1px)`:`calc(${Fr})`,br=Or?`round(${Et}, 1px)`:`calc(${Et})`;!kt||sr.rotation%180===0?(Ir.width=dr,Ir.height=br):(Ir.width=br,Ir.height=dr)}rr&&ir.setAttribute("data-main-rotation",sr.rotation)}},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BaseStandardFontDataFactory=r.BaseSVGFactory=r.BaseFilterFactory=r.BaseCanvasFactory=r.BaseCMapReaderFactory=void 0;var T=v(1);class w{constructor(){this.constructor===w&&(0,T.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(ie){return"none"}addHCMFilter(ie,ce){return"none"}addHighlightHCMFilter(ie,ce,me,_e){return"none"}destroy(ie=!1){}}r.BaseFilterFactory=w;class S{constructor(){this.constructor===S&&(0,T.unreachable)("Cannot initialize BaseCanvasFactory.")}create(ie,ce){if(ie<=0||ce<=0)throw new Error("Invalid canvas size");const me=this._createCanvas(ie,ce);return{canvas:me,context:me.getContext("2d")}}reset(ie,ce,me){if(!ie.canvas)throw new Error("Canvas is not specified");if(ce<=0||me<=0)throw new Error("Invalid canvas size");ie.canvas.width=ce,ie.canvas.height=me}destroy(ie){if(!ie.canvas)throw new Error("Canvas is not specified");ie.canvas.width=0,ie.canvas.height=0,ie.canvas=null,ie.context=null}_createCanvas(ie,ce){(0,T.unreachable)("Abstract method `_createCanvas` called.")}}r.BaseCanvasFactory=S;class I{constructor({baseUrl:ie=null,isCompressed:ce=!0}){this.constructor===I&&(0,T.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=ie,this.isCompressed=ce}async fetch({name:ie}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!ie)throw new Error("CMap name must be specified.");const ce=this.baseUrl+ie+(this.isCompressed?".bcmap":""),me=this.isCompressed?T.CMapCompressionType.BINARY:T.CMapCompressionType.NONE;return this._fetchData(ce,me).catch(_e=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${ce}`)})}_fetchData(ie,ce){(0,T.unreachable)("Abstract method `_fetchData` called.")}}r.BaseCMapReaderFactory=I;class H{constructor({baseUrl:ie=null}){this.constructor===H&&(0,T.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=ie}async fetch({filename:ie}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!ie)throw new Error("Font filename must be specified.");const ce=`${this.baseUrl}${ie}`;return this._fetchData(ce).catch(me=>{throw new Error(`Unable to load font data at: ${ce}`)})}_fetchData(ie){(0,T.unreachable)("Abstract method `_fetchData` called.")}}r.BaseStandardFontDataFactory=H;class te{constructor(){this.constructor===te&&(0,T.unreachable)("Cannot initialize BaseSVGFactory.")}create(ie,ce,me=!1){if(ie<=0||ce<=0)throw new Error("Invalid SVG dimensions");const _e=this._createSVG("svg:svg");return _e.setAttribute("version","1.1"),me||(_e.setAttribute("width",`${ie}px`),_e.setAttribute("height",`${ce}px`)),_e.setAttribute("preserveAspectRatio","none"),_e.setAttribute("viewBox",`0 0 ${ie} ${ce}`),_e}createElement(ie){if(typeof ie!="string")throw new Error("Invalid SVG element type");return this._createSVG(ie)}_createSVG(ie){(0,T.unreachable)("Abstract method `_createSVG` called.")}}r.BaseSVGFactory=te},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.MurmurHash3_64=void 0;var T=v(1);const w=3285377520,S=4294901760,I=65535;class H{constructor(ae){this.h1=ae?ae&4294967295:w,this.h2=ae?ae&4294967295:w}update(ae){let ie,ce;if(typeof ae=="string"){ie=new Uint8Array(ae.length*2),ce=0;for(let je=0,ke=ae.length;je<ke;je++){const Ne=ae.charCodeAt(je);Ne<=255?ie[ce++]=Ne:(ie[ce++]=Ne>>>8,ie[ce++]=Ne&255)}}else if((0,T.isArrayBuffer)(ae))ie=ae.slice(),ce=ie.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const me=ce>>2,_e=ce-me*4,Re=new Uint32Array(ie.buffer,0,me);let Pe=0,Ce=0,Fe=this.h1,Me=this.h2;const Ve=3432918353,We=461845907,ze=Ve&I,Ue=We&I;for(let je=0;je<me;je++)je&1?(Pe=Re[je],Pe=Pe*Ve&S|Pe*ze&I,Pe=Pe<<15|Pe>>>17,Pe=Pe*We&S|Pe*Ue&I,Fe^=Pe,Fe=Fe<<13|Fe>>>19,Fe=Fe*5+3864292196):(Ce=Re[je],Ce=Ce*Ve&S|Ce*ze&I,Ce=Ce<<15|Ce>>>17,Ce=Ce*We&S|Ce*Ue&I,Me^=Ce,Me=Me<<13|Me>>>19,Me=Me*5+3864292196);switch(Pe=0,_e){case 3:Pe^=ie[me*4+2]<<16;case 2:Pe^=ie[me*4+1]<<8;case 1:Pe^=ie[me*4],Pe=Pe*Ve&S|Pe*ze&I,Pe=Pe<<15|Pe>>>17,Pe=Pe*We&S|Pe*Ue&I,me&1?Fe^=Pe:Me^=Pe}this.h1=Fe,this.h2=Me}hexdigest(){let ae=this.h1,ie=this.h2;return ae^=ie>>>1,ae=ae*3981806797&S|ae*36045&I,ie=ie*4283543511&S|((ie<<16|ae>>>16)*2950163797&S)>>>16,ae^=ie>>>1,ae=ae*444984403&S|ae*60499&I,ie=ie*3301882366&S|((ie<<16|ae>>>16)*3120437893&S)>>>16,ae^=ie>>>1,(ae>>>0).toString(16).padStart(8,"0")+(ie>>>0).toString(16).padStart(8,"0")}}r.MurmurHash3_64=H},(E,r,v)=>{var I;Object.defineProperty(r,"__esModule",{value:!0}),r.FontLoader=r.FontFaceObject=void 0;var T=v(1);class w{constructor({ownerDocument:te=globalThis.document,styleElement:ae=null}){Tr(this,I,new Set);this._document=te,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(te){this.nativeFontFaces.add(te),this._document.fonts.add(te)}removeNativeFontFace(te){this.nativeFontFaces.delete(te),this._document.fonts.delete(te)}insertRule(te){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const ae=this.styleElement.sheet;ae.insertRule(te,ae.cssRules.length)}clear(){for(const te of this.nativeFontFaces)this._document.fonts.delete(te);this.nativeFontFaces.clear(),Ye(this,I).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(te){if(!(!te||Ye(this,I).has(te.loadedName))){if((0,T.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:ae,src:ie,style:ce}=te,me=new FontFace(ae,ie,ce);this.addNativeFontFace(me);try{await me.load(),Ye(this,I).add(ae)}catch{(0,T.warn)(`Cannot load system font: ${te.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(me)}return}(0,T.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(te){if(te.attached||te.missingFile&&!te.systemFontInfo)return;if(te.attached=!0,te.systemFontInfo){await this.loadSystemFont(te.systemFontInfo);return}if(this.isFontLoadingAPISupported){const ie=te.createNativeFontFace();if(ie){this.addNativeFontFace(ie);try{await ie.loaded}catch(ce){throw(0,T.warn)(`Failed to load font '${ie.family}': '${ce}'.`),te.disableFontFace=!0,ce}}return}const ae=te.createFontFaceRule();if(ae){if(this.insertRule(ae),this.isSyncFontLoadingSupported)return;await new Promise(ie=>{const ce=this._queueLoadingCallback(ie);this._prepareFontLoadEvent(te,ce)})}}get isFontLoadingAPISupported(){var ae;const te=!!((ae=this._document)!=null&&ae.fonts);return(0,T.shadow)(this,"isFontLoadingAPISupported",te)}get isSyncFontLoadingSupported(){let te=!1;return(T.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(te=!0),(0,T.shadow)(this,"isSyncFontLoadingSupported",te)}_queueLoadingCallback(te){function ae(){for((0,T.assert)(!ce.done,"completeRequest() cannot be called twice."),ce.done=!0;ie.length>0&&ie[0].done;){const me=ie.shift();setTimeout(me.callback,0)}}const{loadingRequests:ie}=this,ce={done:!1,complete:ae,callback:te};return ie.push(ce),ce}get _loadTestFont(){const te=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,T.shadow)(this,"_loadTestFont",te)}_prepareFontLoadEvent(te,ae){function ie(Ie,Le){return Ie.charCodeAt(Le)<<24|Ie.charCodeAt(Le+1)<<16|Ie.charCodeAt(Le+2)<<8|Ie.charCodeAt(Le+3)&255}function ce(Ie,Le,He,Ct){const Ze=Ie.substring(0,Le),Rt=Ie.substring(Le+He);return Ze+Ct+Rt}let me,_e;const Re=this._document.createElement("canvas");Re.width=1,Re.height=1;const Pe=Re.getContext("2d");let Ce=0;function Fe(Ie,Le){if(++Ce>30){(0,T.warn)("Load test font never loaded."),Le();return}if(Pe.font="30px "+Ie,Pe.fillText(".",0,20),Pe.getImageData(0,0,1,1).data[3]>0){Le();return}setTimeout(Fe.bind(null,Ie,Le))}const Me=`lt${Date.now()}${this.loadTestFontId++}`;let Ve=this._loadTestFont;Ve=ce(Ve,976,Me.length,Me);const ze=16,Ue=1482184792;let je=ie(Ve,ze);for(me=0,_e=Me.length-3;me<_e;me+=4)je=je-Ue+ie(Me,me)|0;me<Me.length&&(je=je-Ue+ie(Me+"XXX",me)|0),Ve=ce(Ve,ze,4,(0,T.string32)(je));const ke=`url(data:font/opentype;base64,${btoa(Ve)});`,Ne=`@font-face {font-family:"${Me}";src:${ke}}`;this.insertRule(Ne);const Ge=this._document.createElement("div");Ge.style.visibility="hidden",Ge.style.width=Ge.style.height="10px",Ge.style.position="absolute",Ge.style.top=Ge.style.left="0px";for(const Ie of[te.loadedName,Me]){const Le=this._document.createElement("span");Le.textContent="Hi",Le.style.fontFamily=Ie,Ge.append(Le)}this._document.body.append(Ge),Fe(Me,()=>{Ge.remove(),ae.complete()})}}I=new WeakMap,r.FontLoader=w;class S{constructor(te,{isEvalSupported:ae=!0,disableFontFace:ie=!1,ignoreErrors:ce=!1,inspectFont:me=null}){this.compiledGlyphs=Object.create(null);for(const _e in te)this[_e]=te[_e];this.isEvalSupported=ae!==!1,this.disableFontFace=ie===!0,this.ignoreErrors=ce===!0,this._inspectFont=me}createNativeFontFace(){var ae;if(!this.data||this.disableFontFace)return null;let te;if(!this.cssFontInfo)te=new FontFace(this.loadedName,this.data,{});else{const ie={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(ie.style=`oblique ${this.cssFontInfo.italicAngle}deg`),te=new FontFace(this.cssFontInfo.fontFamily,this.data,ie)}return(ae=this._inspectFont)==null||ae.call(this,this),te}createFontFaceRule(){var ce;if(!this.data||this.disableFontFace)return null;const te=(0,T.bytesToString)(this.data),ae=`url(data:${this.mimetype};base64,${btoa(te)});`;let ie;if(!this.cssFontInfo)ie=`@font-face {font-family:"${this.loadedName}";src:${ae}}`;else{let me=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(me+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),ie=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${me}src:${ae}}`}return(ce=this._inspectFont)==null||ce.call(this,this,ae),ie}getPathGenerator(te,ae){if(this.compiledGlyphs[ae]!==void 0)return this.compiledGlyphs[ae];let ie;try{ie=te.get(this.loadedName+"_path_"+ae)}catch(ce){if(!this.ignoreErrors)throw ce;return(0,T.warn)(`getPathGenerator - ignoring character: "${ce}".`),this.compiledGlyphs[ae]=function(me,_e){}}if(this.isEvalSupported&&T.FeatureTest.isEvalSupported){const ce=[];for(const me of ie){const _e=me.args!==void 0?me.args.join(","):"";ce.push("c.",me.cmd,"(",_e,`);
`)}return this.compiledGlyphs[ae]=new Function("c","size",ce.join(""))}return this.compiledGlyphs[ae]=function(ce,me){for(const _e of ie)_e.cmd==="scale"&&(_e.args=[me,-me]),ce[_e.cmd].apply(ce,_e.args)}}}r.FontFaceObject=S},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.NodeStandardFontDataFactory=r.NodeFilterFactory=r.NodeCanvasFactory=r.NodeCMapReaderFactory=void 0;var T=v(7);v(1);const w=function(ae){return new Promise((ie,ce)=>{require$$5.readFile(ae,(_e,Re)=>{if(_e||!Re){ce(new Error(_e));return}ie(new Uint8Array(Re))})})};class S extends T.BaseFilterFactory{}r.NodeFilterFactory=S;class I extends T.BaseCanvasFactory{_createCanvas(ie,ce){return require$$5.createCanvas(ie,ce)}}r.NodeCanvasFactory=I;class H extends T.BaseCMapReaderFactory{_fetchData(ie,ce){return w(ie).then(me=>({cMapData:me,compressionType:ce}))}}r.NodeCMapReaderFactory=H;class te extends T.BaseStandardFontDataFactory{_fetchData(ie){return w(ie)}}r.NodeStandardFontDataFactory=te},(E,r,v)=>{var nr,ia,oa;Object.defineProperty(r,"__esModule",{value:!0}),r.CanvasGraphics=void 0;var T=v(1),w=v(6),S=v(12),I=v(13);const H=16,te=100,ae=4096,ie=15,ce=10,me=1e3,_e=16;function Re(qe,$e){if(qe._removeMirroring)throw new Error("Context is already forwarding operations.");qe.__originalSave=qe.save,qe.__originalRestore=qe.restore,qe.__originalRotate=qe.rotate,qe.__originalScale=qe.scale,qe.__originalTranslate=qe.translate,qe.__originalTransform=qe.transform,qe.__originalSetTransform=qe.setTransform,qe.__originalResetTransform=qe.resetTransform,qe.__originalClip=qe.clip,qe.__originalMoveTo=qe.moveTo,qe.__originalLineTo=qe.lineTo,qe.__originalBezierCurveTo=qe.bezierCurveTo,qe.__originalRect=qe.rect,qe.__originalClosePath=qe.closePath,qe.__originalBeginPath=qe.beginPath,qe._removeMirroring=()=>{qe.save=qe.__originalSave,qe.restore=qe.__originalRestore,qe.rotate=qe.__originalRotate,qe.scale=qe.__originalScale,qe.translate=qe.__originalTranslate,qe.transform=qe.__originalTransform,qe.setTransform=qe.__originalSetTransform,qe.resetTransform=qe.__originalResetTransform,qe.clip=qe.__originalClip,qe.moveTo=qe.__originalMoveTo,qe.lineTo=qe.__originalLineTo,qe.bezierCurveTo=qe.__originalBezierCurveTo,qe.rect=qe.__originalRect,qe.closePath=qe.__originalClosePath,qe.beginPath=qe.__originalBeginPath,delete qe._removeMirroring},qe.save=function(){$e.save(),this.__originalSave()},qe.restore=function(){$e.restore(),this.__originalRestore()},qe.translate=function(Xe,rt){$e.translate(Xe,rt),this.__originalTranslate(Xe,rt)},qe.scale=function(Xe,rt){$e.scale(Xe,rt),this.__originalScale(Xe,rt)},qe.transform=function(Xe,rt,Qe,vt,Dt,Ut){$e.transform(Xe,rt,Qe,vt,Dt,Ut),this.__originalTransform(Xe,rt,Qe,vt,Dt,Ut)},qe.setTransform=function(Xe,rt,Qe,vt,Dt,Ut){$e.setTransform(Xe,rt,Qe,vt,Dt,Ut),this.__originalSetTransform(Xe,rt,Qe,vt,Dt,Ut)},qe.resetTransform=function(){$e.resetTransform(),this.__originalResetTransform()},qe.rotate=function(Xe){$e.rotate(Xe),this.__originalRotate(Xe)},qe.clip=function(Xe){$e.clip(Xe),this.__originalClip(Xe)},qe.moveTo=function(Be,Xe){$e.moveTo(Be,Xe),this.__originalMoveTo(Be,Xe)},qe.lineTo=function(Be,Xe){$e.lineTo(Be,Xe),this.__originalLineTo(Be,Xe)},qe.bezierCurveTo=function(Be,Xe,rt,Qe,vt,Dt){$e.bezierCurveTo(Be,Xe,rt,Qe,vt,Dt),this.__originalBezierCurveTo(Be,Xe,rt,Qe,vt,Dt)},qe.rect=function(Be,Xe,rt,Qe){$e.rect(Be,Xe,rt,Qe),this.__originalRect(Be,Xe,rt,Qe)},qe.closePath=function(){$e.closePath(),this.__originalClosePath()},qe.beginPath=function(){$e.beginPath(),this.__originalBeginPath()}}class Pe{constructor($e){this.canvasFactory=$e,this.cache=Object.create(null)}getCanvas($e,Be,Xe){let rt;return this.cache[$e]!==void 0?(rt=this.cache[$e],this.canvasFactory.reset(rt,Be,Xe)):(rt=this.canvasFactory.create(Be,Xe),this.cache[$e]=rt),rt}delete($e){delete this.cache[$e]}clear(){for(const $e in this.cache){const Be=this.cache[$e];this.canvasFactory.destroy(Be),delete this.cache[$e]}}}function Ce(qe,$e,Be,Xe,rt,Qe,vt,Dt,Ut,hr){const[pt,yr,vr,wr,ir,sr]=(0,w.getCurrentTransform)(qe);if(yr===0&&vr===0){const lr=vt*pt+ir,mr=Math.round(lr),Ir=Dt*wr+sr,Or=Math.round(Ir),Fr=(vt+Ut)*pt+ir,Et=Math.abs(Math.round(Fr)-mr)||1,dr=(Dt+hr)*wr+sr,br=Math.abs(Math.round(dr)-Or)||1;return qe.setTransform(Math.sign(pt),0,0,Math.sign(wr),mr,Or),qe.drawImage($e,Be,Xe,rt,Qe,0,0,Et,br),qe.setTransform(pt,yr,vr,wr,ir,sr),[Et,br]}if(pt===0&&wr===0){const lr=Dt*vr+ir,mr=Math.round(lr),Ir=vt*yr+sr,Or=Math.round(Ir),Fr=(Dt+hr)*vr+ir,Et=Math.abs(Math.round(Fr)-mr)||1,dr=(vt+Ut)*yr+sr,br=Math.abs(Math.round(dr)-Or)||1;return qe.setTransform(0,Math.sign(yr),Math.sign(vr),0,mr,Or),qe.drawImage($e,Be,Xe,rt,Qe,0,0,br,Et),qe.setTransform(pt,yr,vr,wr,ir,sr),[br,Et]}qe.drawImage($e,Be,Xe,rt,Qe,vt,Dt,Ut,hr);const kt=Math.hypot(pt,yr),rr=Math.hypot(vr,wr);return[kt*Ut,rr*hr]}function Fe(qe){const{width:$e,height:Be}=qe;if($e>me||Be>me)return null;const Xe=1e3,rt=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),Qe=$e+1;let vt=new Uint8Array(Qe*(Be+1)),Dt,Ut,hr;const pt=$e+7&-8;let yr=new Uint8Array(pt*Be),vr=0;for(const rr of qe.data){let lr=128;for(;lr>0;)yr[vr++]=rr&lr?0:255,lr>>=1}let wr=0;for(vr=0,yr[vr]!==0&&(vt[0]=1,++wr),Ut=1;Ut<$e;Ut++)yr[vr]!==yr[vr+1]&&(vt[Ut]=yr[vr]?2:1,++wr),vr++;for(yr[vr]!==0&&(vt[Ut]=2,++wr),Dt=1;Dt<Be;Dt++){vr=Dt*pt,hr=Dt*Qe,yr[vr-pt]!==yr[vr]&&(vt[hr]=yr[vr]?1:8,++wr);let rr=(yr[vr]?4:0)+(yr[vr-pt]?8:0);for(Ut=1;Ut<$e;Ut++)rr=(rr>>2)+(yr[vr+1]?4:0)+(yr[vr-pt+1]?8:0),rt[rr]&&(vt[hr+Ut]=rt[rr],++wr),vr++;if(yr[vr-pt]!==yr[vr]&&(vt[hr+Ut]=yr[vr]?2:4,++wr),wr>Xe)return null}for(vr=pt*(Be-1),hr=Dt*Qe,yr[vr]!==0&&(vt[hr]=8,++wr),Ut=1;Ut<$e;Ut++)yr[vr]!==yr[vr+1]&&(vt[hr+Ut]=yr[vr]?4:8,++wr),vr++;if(yr[vr]!==0&&(vt[hr+Ut]=4,++wr),wr>Xe)return null;const ir=new Int32Array([0,Qe,-1,0,-Qe,0,0,0,1]),sr=new Path2D;for(Dt=0;wr&&Dt<=Be;Dt++){let rr=Dt*Qe;const lr=rr+$e;for(;rr<lr&&!vt[rr];)rr++;if(rr===lr)continue;sr.moveTo(rr%Qe,Dt);const mr=rr;let Ir=vt[rr];do{const Or=ir[Ir];do rr+=Or;while(!vt[rr]);const Fr=vt[rr];Fr!==5&&Fr!==10?(Ir=Fr,vt[rr]=0):(Ir=Fr&51*Ir>>4,vt[rr]&=Ir>>2|Ir<<2),sr.lineTo(rr%Qe,rr/Qe|0),vt[rr]||--wr}while(mr!==rr);--Dt}return yr=null,vt=null,function(rr){rr.save(),rr.scale(1/$e,-1/Be),rr.translate(0,-Be),rr.fill(sr),rr.beginPath(),rr.restore()}}class Me{constructor($e,Be){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=T.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=T.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=T.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,$e,Be])}clone(){const $e=Object.create(this);return $e.clipBox=this.clipBox.slice(),$e}setCurrentPoint($e,Be){this.x=$e,this.y=Be}updatePathMinMax($e,Be,Xe){[Be,Xe]=T.Util.applyTransform([Be,Xe],$e),this.minX=Math.min(this.minX,Be),this.minY=Math.min(this.minY,Xe),this.maxX=Math.max(this.maxX,Be),this.maxY=Math.max(this.maxY,Xe)}updateRectMinMax($e,Be){const Xe=T.Util.applyTransform(Be,$e),rt=T.Util.applyTransform(Be.slice(2),$e);this.minX=Math.min(this.minX,Xe[0],rt[0]),this.minY=Math.min(this.minY,Xe[1],rt[1]),this.maxX=Math.max(this.maxX,Xe[0],rt[0]),this.maxY=Math.max(this.maxY,Xe[1],rt[1])}updateScalingPathMinMax($e,Be){T.Util.scaleMinMax($e,Be),this.minX=Math.min(this.minX,Be[0]),this.maxX=Math.max(this.maxX,Be[1]),this.minY=Math.min(this.minY,Be[2]),this.maxY=Math.max(this.maxY,Be[3])}updateCurvePathMinMax($e,Be,Xe,rt,Qe,vt,Dt,Ut,hr,pt){const yr=T.Util.bezierBoundingBox(Be,Xe,rt,Qe,vt,Dt,Ut,hr);if(pt){pt[0]=Math.min(pt[0],yr[0],yr[2]),pt[1]=Math.max(pt[1],yr[0],yr[2]),pt[2]=Math.min(pt[2],yr[1],yr[3]),pt[3]=Math.max(pt[3],yr[1],yr[3]);return}this.updateRectMinMax($e,yr)}getPathBoundingBox($e=S.PathType.FILL,Be=null){const Xe=[this.minX,this.minY,this.maxX,this.maxY];if($e===S.PathType.STROKE){Be||(0,T.unreachable)("Stroke bounding box must include transform.");const rt=T.Util.singularValueDecompose2dScale(Be),Qe=rt[0]*this.lineWidth/2,vt=rt[1]*this.lineWidth/2;Xe[0]-=Qe,Xe[1]-=vt,Xe[2]+=Qe,Xe[3]+=vt}return Xe}updateClipFromPath(){const $e=T.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox($e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox($e){this.clipBox=$e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox($e=S.PathType.FILL,Be=null){return T.Util.intersect(this.clipBox,this.getPathBoundingBox($e,Be))}}function Ve(qe,$e){if(typeof ImageData<"u"&&$e instanceof ImageData){qe.putImageData($e,0,0);return}const Be=$e.height,Xe=$e.width,rt=Be%_e,Qe=(Be-rt)/_e,vt=rt===0?Qe:Qe+1,Dt=qe.createImageData(Xe,_e);let Ut=0,hr;const pt=$e.data,yr=Dt.data;let vr,wr,ir,sr;if($e.kind===T.ImageKind.GRAYSCALE_1BPP){const kt=pt.byteLength,rr=new Uint32Array(yr.buffer,0,yr.byteLength>>2),lr=rr.length,mr=Xe+7>>3,Ir=4294967295,Or=T.FeatureTest.isLittleEndian?4278190080:255;for(vr=0;vr<vt;vr++){for(ir=vr<Qe?_e:rt,hr=0,wr=0;wr<ir;wr++){const Fr=kt-Ut;let Et=0;const dr=Fr>mr?Xe:Fr*8-7,br=dr&-8;let Br=0,Lr=0;for(;Et<br;Et+=8)Lr=pt[Ut++],rr[hr++]=Lr&128?Ir:Or,rr[hr++]=Lr&64?Ir:Or,rr[hr++]=Lr&32?Ir:Or,rr[hr++]=Lr&16?Ir:Or,rr[hr++]=Lr&8?Ir:Or,rr[hr++]=Lr&4?Ir:Or,rr[hr++]=Lr&2?Ir:Or,rr[hr++]=Lr&1?Ir:Or;for(;Et<dr;Et++)Br===0&&(Lr=pt[Ut++],Br=128),rr[hr++]=Lr&Br?Ir:Or,Br>>=1}for(;hr<lr;)rr[hr++]=0;qe.putImageData(Dt,0,vr*_e)}}else if($e.kind===T.ImageKind.RGBA_32BPP){for(wr=0,sr=Xe*_e*4,vr=0;vr<Qe;vr++)yr.set(pt.subarray(Ut,Ut+sr)),Ut+=sr,qe.putImageData(Dt,0,wr),wr+=_e;vr<vt&&(sr=Xe*rt*4,yr.set(pt.subarray(Ut,Ut+sr)),qe.putImageData(Dt,0,wr))}else if($e.kind===T.ImageKind.RGB_24BPP)for(ir=_e,sr=Xe*ir,vr=0;vr<vt;vr++){for(vr>=Qe&&(ir=rt,sr=Xe*ir),hr=0,wr=sr;wr--;)yr[hr++]=pt[Ut++],yr[hr++]=pt[Ut++],yr[hr++]=pt[Ut++],yr[hr++]=255;qe.putImageData(Dt,0,vr*_e)}else throw new Error(`bad image kind: ${$e.kind}`)}function We(qe,$e){if($e.bitmap){qe.drawImage($e.bitmap,0,0);return}const Be=$e.height,Xe=$e.width,rt=Be%_e,Qe=(Be-rt)/_e,vt=rt===0?Qe:Qe+1,Dt=qe.createImageData(Xe,_e);let Ut=0;const hr=$e.data,pt=Dt.data;for(let yr=0;yr<vt;yr++){const vr=yr<Qe?_e:rt;({srcPos:Ut}=(0,I.convertBlackAndWhiteToRGBA)({src:hr,srcPos:Ut,dest:pt,width:Xe,height:vr,nonBlackColor:0})),qe.putImageData(Dt,0,yr*_e)}}function ze(qe,$e){const Be=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const Xe of Be)qe[Xe]!==void 0&&($e[Xe]=qe[Xe]);qe.setLineDash!==void 0&&($e.setLineDash(qe.getLineDash()),$e.lineDashOffset=qe.lineDashOffset)}function Ue(qe){if(qe.strokeStyle=qe.fillStyle="#000000",qe.fillRule="nonzero",qe.globalAlpha=1,qe.lineWidth=1,qe.lineCap="butt",qe.lineJoin="miter",qe.miterLimit=10,qe.globalCompositeOperation="source-over",qe.font="10px sans-serif",qe.setLineDash!==void 0&&(qe.setLineDash([]),qe.lineDashOffset=0),!T.isNodeJS){const{filter:$e}=qe;$e!=="none"&&$e!==""&&(qe.filter="none")}}function je(qe,$e,Be,Xe){const rt=qe.length;for(let Qe=3;Qe<rt;Qe+=4){const vt=qe[Qe];if(vt===0)qe[Qe-3]=$e,qe[Qe-2]=Be,qe[Qe-1]=Xe;else if(vt<255){const Dt=255-vt;qe[Qe-3]=qe[Qe-3]*vt+$e*Dt>>8,qe[Qe-2]=qe[Qe-2]*vt+Be*Dt>>8,qe[Qe-1]=qe[Qe-1]*vt+Xe*Dt>>8}}}function ke(qe,$e,Be){const Xe=qe.length,rt=1/255;for(let Qe=3;Qe<Xe;Qe+=4){const vt=Be?Be[qe[Qe]]:qe[Qe];$e[Qe]=$e[Qe]*vt*rt|0}}function Ne(qe,$e,Be){const Xe=qe.length;for(let rt=3;rt<Xe;rt+=4){const Qe=qe[rt-3]*77+qe[rt-2]*152+qe[rt-1]*28;$e[rt]=Be?$e[rt]*Be[Qe>>8]>>8:$e[rt]*Qe>>16}}function Ge(qe,$e,Be,Xe,rt,Qe,vt,Dt,Ut,hr,pt){const yr=!!Qe,vr=yr?Qe[0]:0,wr=yr?Qe[1]:0,ir=yr?Qe[2]:0,sr=rt==="Luminosity"?Ne:ke,rr=Math.min(Xe,Math.ceil(1048576/Be));for(let lr=0;lr<Xe;lr+=rr){const mr=Math.min(rr,Xe-lr),Ir=qe.getImageData(Dt-hr,lr+(Ut-pt),Be,mr),Or=$e.getImageData(Dt,lr+Ut,Be,mr);yr&&je(Ir.data,vr,wr,ir),sr(Ir.data,Or.data,vt),$e.putImageData(Or,Dt,lr+Ut)}}function Ie(qe,$e,Be,Xe){const rt=Xe[0],Qe=Xe[1],vt=Xe[2]-rt,Dt=Xe[3]-Qe;vt===0||Dt===0||(Ge($e.context,Be,vt,Dt,$e.subtype,$e.backdrop,$e.transferMap,rt,Qe,$e.offsetX,$e.offsetY),qe.save(),qe.globalAlpha=1,qe.globalCompositeOperation="source-over",qe.setTransform(1,0,0,1,0,0),qe.drawImage(Be.canvas,0,0),qe.restore())}function Le(qe,$e){const Be=T.Util.singularValueDecompose2dScale(qe);Be[0]=Math.fround(Be[0]),Be[1]=Math.fround(Be[1]);const Xe=Math.fround((globalThis.devicePixelRatio||1)*w.PixelsPerInch.PDF_TO_CSS_UNITS);return $e!==void 0?$e:Be[0]<=Xe||Be[1]<=Xe}const He=["butt","round","square"],Ct=["miter","round","bevel"],Ze={},Rt={},Lt=class Lt{constructor($e,Be,Xe,rt,Qe,{optionalContentConfig:vt,markedContentStack:Dt=null},Ut,hr){Tr(this,nr);this.ctx=$e,this.current=new Me(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=Be,this.objs=Xe,this.canvasFactory=rt,this.filterFactory=Qe,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=Dt||[],this.optionalContentConfig=vt,this.cachedCanvases=new Pe(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=Ut,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=hr,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject($e,Be=null){return typeof $e=="string"?$e.startsWith("g_")?this.commonObjs.get($e):this.objs.get($e):Be}beginDrawing({transform:$e,viewport:Be,transparency:Xe=!1,background:rt=null}){const Qe=this.ctx.canvas.width,vt=this.ctx.canvas.height,Dt=this.ctx.fillStyle;if(this.ctx.fillStyle=rt||"#ffffff",this.ctx.fillRect(0,0,Qe,vt),this.ctx.fillStyle=Dt,Xe){const Ut=this.cachedCanvases.getCanvas("transparent",Qe,vt);this.compositeCtx=this.ctx,this.transparentCanvas=Ut.canvas,this.ctx=Ut.context,this.ctx.save(),this.ctx.transform(...(0,w.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),Ue(this.ctx),$e&&(this.ctx.transform(...$e),this.outputScaleX=$e[0],this.outputScaleY=$e[0]),this.ctx.transform(...Be.transform),this.viewportScale=Be.scale,this.baseTransform=(0,w.getCurrentTransform)(this.ctx)}executeOperatorList($e,Be,Xe,rt){const Qe=$e.argsArray,vt=$e.fnArray;let Dt=Be||0;const Ut=Qe.length;if(Ut===Dt)return Dt;const hr=Ut-Dt>ce&&typeof Xe=="function",pt=hr?Date.now()+ie:0;let yr=0;const vr=this.commonObjs,wr=this.objs;let ir;for(;;){if(rt!==void 0&&Dt===rt.nextBreakPoint)return rt.breakIt(Dt,Xe),Dt;if(ir=vt[Dt],ir!==T.OPS.dependency)this[ir].apply(this,Qe[Dt]);else for(const sr of Qe[Dt]){const kt=sr.startsWith("g_")?vr:wr;if(!kt.has(sr))return kt.get(sr,Xe),Dt}if(Dt++,Dt===Ut)return Dt;if(hr&&++yr>ce){if(Date.now()>pt)return Xe(),Dt;yr=0}}}endDrawing(){fr(this,nr,ia).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const $e of this._cachedBitmapsMap.values()){for(const Be of $e.values())typeof HTMLCanvasElement<"u"&&Be instanceof HTMLCanvasElement&&(Be.width=Be.height=0);$e.clear()}this._cachedBitmapsMap.clear(),fr(this,nr,oa).call(this)}_scaleImage($e,Be){const Xe=$e.width,rt=$e.height;let Qe=Math.max(Math.hypot(Be[0],Be[1]),1),vt=Math.max(Math.hypot(Be[2],Be[3]),1),Dt=Xe,Ut=rt,hr="prescale1",pt,yr;for(;Qe>2&&Dt>1||vt>2&&Ut>1;){let vr=Dt,wr=Ut;Qe>2&&Dt>1&&(vr=Dt>=16384?Math.floor(Dt/2)-1||1:Math.ceil(Dt/2),Qe/=Dt/vr),vt>2&&Ut>1&&(wr=Ut>=16384?Math.floor(Ut/2)-1||1:Math.ceil(Ut)/2,vt/=Ut/wr),pt=this.cachedCanvases.getCanvas(hr,vr,wr),yr=pt.context,yr.clearRect(0,0,vr,wr),yr.drawImage($e,0,0,Dt,Ut,0,0,vr,wr),$e=pt.canvas,Dt=vr,Ut=wr,hr=hr==="prescale1"?"prescale2":"prescale1"}return{img:$e,paintWidth:Dt,paintHeight:Ut}}_createMaskCanvas($e){const Be=this.ctx,{width:Xe,height:rt}=$e,Qe=this.current.fillColor,vt=this.current.patternFill,Dt=(0,w.getCurrentTransform)(Be);let Ut,hr,pt,yr;if(($e.bitmap||$e.data)&&$e.count>1){const Et=$e.bitmap||$e.data.buffer;hr=JSON.stringify(vt?Dt:[Dt.slice(0,4),Qe]),Ut=this._cachedBitmapsMap.get(Et),Ut||(Ut=new Map,this._cachedBitmapsMap.set(Et,Ut));const dr=Ut.get(hr);if(dr&&!vt){const br=Math.round(Math.min(Dt[0],Dt[2])+Dt[4]),Br=Math.round(Math.min(Dt[1],Dt[3])+Dt[5]);return{canvas:dr,offsetX:br,offsetY:Br}}pt=dr}pt||(yr=this.cachedCanvases.getCanvas("maskCanvas",Xe,rt),We(yr.context,$e));let vr=T.Util.transform(Dt,[1/Xe,0,0,-1/rt,0,0]);vr=T.Util.transform(vr,[1,0,0,1,0,-rt]);const wr=T.Util.applyTransform([0,0],vr),ir=T.Util.applyTransform([Xe,rt],vr),sr=T.Util.normalizeRect([wr[0],wr[1],ir[0],ir[1]]),kt=Math.round(sr[2]-sr[0])||1,rr=Math.round(sr[3]-sr[1])||1,lr=this.cachedCanvases.getCanvas("fillCanvas",kt,rr),mr=lr.context,Ir=Math.min(wr[0],ir[0]),Or=Math.min(wr[1],ir[1]);mr.translate(-Ir,-Or),mr.transform(...vr),pt||(pt=this._scaleImage(yr.canvas,(0,w.getCurrentTransformInverse)(mr)),pt=pt.img,Ut&&vt&&Ut.set(hr,pt)),mr.imageSmoothingEnabled=Le((0,w.getCurrentTransform)(mr),$e.interpolate),Ce(mr,pt,0,0,pt.width,pt.height,0,0,Xe,rt),mr.globalCompositeOperation="source-in";const Fr=T.Util.transform((0,w.getCurrentTransformInverse)(mr),[1,0,0,1,-Ir,-Or]);return mr.fillStyle=vt?Qe.getPattern(Be,this,Fr,S.PathType.FILL):Qe,mr.fillRect(0,0,Xe,rt),Ut&&!vt&&(this.cachedCanvases.delete("fillCanvas"),Ut.set(hr,lr.canvas)),{canvas:lr.canvas,offsetX:Math.round(Ir),offsetY:Math.round(Or)}}setLineWidth($e){$e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=$e,this.ctx.lineWidth=$e}setLineCap($e){this.ctx.lineCap=He[$e]}setLineJoin($e){this.ctx.lineJoin=Ct[$e]}setMiterLimit($e){this.ctx.miterLimit=$e}setDash($e,Be){const Xe=this.ctx;Xe.setLineDash!==void 0&&(Xe.setLineDash($e),Xe.lineDashOffset=Be)}setRenderingIntent($e){}setFlatness($e){}setGState($e){for(const[Be,Xe]of $e)switch(Be){case"LW":this.setLineWidth(Xe);break;case"LC":this.setLineCap(Xe);break;case"LJ":this.setLineJoin(Xe);break;case"ML":this.setMiterLimit(Xe);break;case"D":this.setDash(Xe[0],Xe[1]);break;case"RI":this.setRenderingIntent(Xe);break;case"FL":this.setFlatness(Xe);break;case"Font":this.setFont(Xe[0],Xe[1]);break;case"CA":this.current.strokeAlpha=Xe;break;case"ca":this.current.fillAlpha=Xe,this.ctx.globalAlpha=Xe;break;case"BM":this.ctx.globalCompositeOperation=Xe;break;case"SMask":this.current.activeSMask=Xe?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(Xe);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const $e=this.inSMaskMode;this.current.activeSMask&&!$e?this.beginSMaskMode():!this.current.activeSMask&&$e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const $e=this.ctx.canvas.width,Be=this.ctx.canvas.height,Xe="smaskGroupAt"+this.groupLevel,rt=this.cachedCanvases.getCanvas(Xe,$e,Be);this.suspendedCtx=this.ctx,this.ctx=rt.context;const Qe=this.ctx;Qe.setTransform(...(0,w.getCurrentTransform)(this.suspendedCtx)),ze(this.suspendedCtx,Qe),Re(Qe,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ze(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose($e){if(!this.current.activeSMask)return;$e?($e[0]=Math.floor($e[0]),$e[1]=Math.floor($e[1]),$e[2]=Math.ceil($e[2]),$e[3]=Math.ceil($e[3])):$e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const Be=this.current.activeSMask,Xe=this.suspendedCtx;Ie(Xe,Be,this.ctx,$e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(ze(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const $e=this.current;this.stateStack.push($e),this.current=$e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),ze(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform($e,Be,Xe,rt,Qe,vt){this.ctx.transform($e,Be,Xe,rt,Qe,vt),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath($e,Be,Xe){const rt=this.ctx,Qe=this.current;let vt=Qe.x,Dt=Qe.y,Ut,hr;const pt=(0,w.getCurrentTransform)(rt),yr=pt[0]===0&&pt[3]===0||pt[1]===0&&pt[2]===0,vr=yr?Xe.slice(0):null;for(let wr=0,ir=0,sr=$e.length;wr<sr;wr++)switch($e[wr]|0){case T.OPS.rectangle:vt=Be[ir++],Dt=Be[ir++];const kt=Be[ir++],rr=Be[ir++],lr=vt+kt,mr=Dt+rr;rt.moveTo(vt,Dt),kt===0||rr===0?rt.lineTo(lr,mr):(rt.lineTo(lr,Dt),rt.lineTo(lr,mr),rt.lineTo(vt,mr)),yr||Qe.updateRectMinMax(pt,[vt,Dt,lr,mr]),rt.closePath();break;case T.OPS.moveTo:vt=Be[ir++],Dt=Be[ir++],rt.moveTo(vt,Dt),yr||Qe.updatePathMinMax(pt,vt,Dt);break;case T.OPS.lineTo:vt=Be[ir++],Dt=Be[ir++],rt.lineTo(vt,Dt),yr||Qe.updatePathMinMax(pt,vt,Dt);break;case T.OPS.curveTo:Ut=vt,hr=Dt,vt=Be[ir+4],Dt=Be[ir+5],rt.bezierCurveTo(Be[ir],Be[ir+1],Be[ir+2],Be[ir+3],vt,Dt),Qe.updateCurvePathMinMax(pt,Ut,hr,Be[ir],Be[ir+1],Be[ir+2],Be[ir+3],vt,Dt,vr),ir+=6;break;case T.OPS.curveTo2:Ut=vt,hr=Dt,rt.bezierCurveTo(vt,Dt,Be[ir],Be[ir+1],Be[ir+2],Be[ir+3]),Qe.updateCurvePathMinMax(pt,Ut,hr,vt,Dt,Be[ir],Be[ir+1],Be[ir+2],Be[ir+3],vr),vt=Be[ir+2],Dt=Be[ir+3],ir+=4;break;case T.OPS.curveTo3:Ut=vt,hr=Dt,vt=Be[ir+2],Dt=Be[ir+3],rt.bezierCurveTo(Be[ir],Be[ir+1],vt,Dt,vt,Dt),Qe.updateCurvePathMinMax(pt,Ut,hr,Be[ir],Be[ir+1],vt,Dt,vt,Dt,vr),ir+=4;break;case T.OPS.closePath:rt.closePath();break}yr&&Qe.updateScalingPathMinMax(pt,vr),Qe.setCurrentPoint(vt,Dt)}closePath(){this.ctx.closePath()}stroke($e=!0){const Be=this.ctx,Xe=this.current.strokeColor;Be.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof Xe=="object"&&(Xe!=null&&Xe.getPattern)?(Be.save(),Be.strokeStyle=Xe.getPattern(Be,this,(0,w.getCurrentTransformInverse)(Be),S.PathType.STROKE),this.rescaleAndStroke(!1),Be.restore()):this.rescaleAndStroke(!0)),$e&&this.consumePath(this.current.getClippedPathBoundingBox()),Be.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill($e=!0){const Be=this.ctx,Xe=this.current.fillColor,rt=this.current.patternFill;let Qe=!1;rt&&(Be.save(),Be.fillStyle=Xe.getPattern(Be,this,(0,w.getCurrentTransformInverse)(Be),S.PathType.FILL),Qe=!0);const vt=this.current.getClippedPathBoundingBox();this.contentVisible&&vt!==null&&(this.pendingEOFill?(Be.fill("evenodd"),this.pendingEOFill=!1):Be.fill()),Qe&&Be.restore(),$e&&this.consumePath(vt)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=Ze}eoClip(){this.pendingClip=Rt}beginText(){this.current.textMatrix=T.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const $e=this.pendingTextPaths,Be=this.ctx;if($e===void 0){Be.beginPath();return}Be.save(),Be.beginPath();for(const Xe of $e)Be.setTransform(...Xe.transform),Be.translate(Xe.x,Xe.y),Xe.addToPath(Be,Xe.fontSize);Be.restore(),Be.clip(),Be.beginPath(),delete this.pendingTextPaths}setCharSpacing($e){this.current.charSpacing=$e}setWordSpacing($e){this.current.wordSpacing=$e}setHScale($e){this.current.textHScale=$e/100}setLeading($e){this.current.leading=-$e}setFont($e,Be){var pt;const Xe=this.commonObjs.get($e),rt=this.current;if(!Xe)throw new Error(`Can't find font for ${$e}`);if(rt.fontMatrix=Xe.fontMatrix||T.FONT_IDENTITY_MATRIX,(rt.fontMatrix[0]===0||rt.fontMatrix[3]===0)&&(0,T.warn)("Invalid font matrix for font "+$e),Be<0?(Be=-Be,rt.fontDirection=-1):rt.fontDirection=1,this.current.font=Xe,this.current.fontSize=Be,Xe.isType3Font)return;const Qe=Xe.loadedName||"sans-serif",vt=((pt=Xe.systemFontInfo)==null?void 0:pt.css)||`"${Qe}", ${Xe.fallbackName}`;let Dt="normal";Xe.black?Dt="900":Xe.bold&&(Dt="bold");const Ut=Xe.italic?"italic":"normal";let hr=Be;Be<H?hr=H:Be>te&&(hr=te),this.current.fontSizeScale=Be/hr,this.ctx.font=`${Ut} ${Dt} ${hr}px ${vt}`}setTextRenderingMode($e){this.current.textRenderingMode=$e}setTextRise($e){this.current.textRise=$e}moveText($e,Be){this.current.x=this.current.lineX+=$e,this.current.y=this.current.lineY+=Be}setLeadingMoveText($e,Be){this.setLeading(-Be),this.moveText($e,Be)}setTextMatrix($e,Be,Xe,rt,Qe,vt){this.current.textMatrix=[$e,Be,Xe,rt,Qe,vt],this.current.textMatrixScale=Math.hypot($e,Be),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar($e,Be,Xe,rt){const Qe=this.ctx,vt=this.current,Dt=vt.font,Ut=vt.textRenderingMode,hr=vt.fontSize/vt.fontSizeScale,pt=Ut&T.TextRenderingMode.FILL_STROKE_MASK,yr=!!(Ut&T.TextRenderingMode.ADD_TO_PATH_FLAG),vr=vt.patternFill&&!Dt.missingFile;let wr;(Dt.disableFontFace||yr||vr)&&(wr=Dt.getPathGenerator(this.commonObjs,$e)),Dt.disableFontFace||vr?(Qe.save(),Qe.translate(Be,Xe),Qe.beginPath(),wr(Qe,hr),rt&&Qe.setTransform(...rt),(pt===T.TextRenderingMode.FILL||pt===T.TextRenderingMode.FILL_STROKE)&&Qe.fill(),(pt===T.TextRenderingMode.STROKE||pt===T.TextRenderingMode.FILL_STROKE)&&Qe.stroke(),Qe.restore()):((pt===T.TextRenderingMode.FILL||pt===T.TextRenderingMode.FILL_STROKE)&&Qe.fillText($e,Be,Xe),(pt===T.TextRenderingMode.STROKE||pt===T.TextRenderingMode.FILL_STROKE)&&Qe.strokeText($e,Be,Xe)),yr&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,w.getCurrentTransform)(Qe),x:Be,y:Xe,fontSize:hr,addToPath:wr})}get isFontSubpixelAAEnabled(){const{context:$e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);$e.scale(1.5,1),$e.fillText("I",0,10);const Be=$e.getImageData(0,0,10,10).data;let Xe=!1;for(let rt=3;rt<Be.length;rt+=4)if(Be[rt]>0&&Be[rt]<255){Xe=!0;break}return(0,T.shadow)(this,"isFontSubpixelAAEnabled",Xe)}showText($e){const Be=this.current,Xe=Be.font;if(Xe.isType3Font)return this.showType3Text($e);const rt=Be.fontSize;if(rt===0)return;const Qe=this.ctx,vt=Be.fontSizeScale,Dt=Be.charSpacing,Ut=Be.wordSpacing,hr=Be.fontDirection,pt=Be.textHScale*hr,yr=$e.length,vr=Xe.vertical,wr=vr?1:-1,ir=Xe.defaultVMetrics,sr=rt*Be.fontMatrix[0],kt=Be.textRenderingMode===T.TextRenderingMode.FILL&&!Xe.disableFontFace&&!Be.patternFill;Qe.save(),Qe.transform(...Be.textMatrix),Qe.translate(Be.x,Be.y+Be.textRise),hr>0?Qe.scale(pt,-1):Qe.scale(pt,1);let rr;if(Be.patternFill){Qe.save();const Fr=Be.fillColor.getPattern(Qe,this,(0,w.getCurrentTransformInverse)(Qe),S.PathType.FILL);rr=(0,w.getCurrentTransform)(Qe),Qe.restore(),Qe.fillStyle=Fr}let lr=Be.lineWidth;const mr=Be.textMatrixScale;if(mr===0||lr===0){const Fr=Be.textRenderingMode&T.TextRenderingMode.FILL_STROKE_MASK;(Fr===T.TextRenderingMode.STROKE||Fr===T.TextRenderingMode.FILL_STROKE)&&(lr=this.getSinglePixelWidth())}else lr/=mr;if(vt!==1&&(Qe.scale(vt,vt),lr/=vt),Qe.lineWidth=lr,Xe.isInvalidPDFjsFont){const Fr=[];let Et=0;for(const dr of $e)Fr.push(dr.unicode),Et+=dr.width;Qe.fillText(Fr.join(""),0,0),Be.x+=Et*sr*pt,Qe.restore(),this.compose();return}let Ir=0,Or;for(Or=0;Or<yr;++Or){const Fr=$e[Or];if(typeof Fr=="number"){Ir+=wr*Fr*rt/1e3;continue}let Et=!1;const dr=(Fr.isSpace?Ut:0)+Dt,br=Fr.fontChar,Br=Fr.accent;let Lr,or,ur=Fr.width;if(vr){const $r=Fr.vmetric||ir,Xr=-(Fr.vmetric?$r[1]:ur*.5)*sr,Rr=$r[2]*sr;ur=$r?-$r[0]:ur,Lr=Xr/vt,or=(Ir+Rr)/vt}else Lr=Ir/vt,or=0;if(Xe.remeasure&&ur>0){const $r=Qe.measureText(br).width*1e3/rt*vt;if(ur<$r&&this.isFontSubpixelAAEnabled){const Xr=ur/$r;Et=!0,Qe.save(),Qe.scale(Xr,1),Lr/=Xr}else ur!==$r&&(Lr+=(ur-$r)/2e3*rt/vt)}if(this.contentVisible&&(Fr.isInFont||Xe.missingFile)){if(kt&&!Br)Qe.fillText(br,Lr,or);else if(this.paintChar(br,Lr,or,rr),Br){const $r=Lr+rt*Br.offset.x/vt,Xr=or-rt*Br.offset.y/vt;this.paintChar(Br.fontChar,$r,Xr,rr)}}const gr=vr?ur*sr-dr*hr:ur*sr+dr*hr;Ir+=gr,Et&&Qe.restore()}vr?Be.y-=Ir:Be.x+=Ir*pt,Qe.restore(),this.compose()}showType3Text($e){const Be=this.ctx,Xe=this.current,rt=Xe.font,Qe=Xe.fontSize,vt=Xe.fontDirection,Dt=rt.vertical?1:-1,Ut=Xe.charSpacing,hr=Xe.wordSpacing,pt=Xe.textHScale*vt,yr=Xe.fontMatrix||T.FONT_IDENTITY_MATRIX,vr=$e.length,wr=Xe.textRenderingMode===T.TextRenderingMode.INVISIBLE;let ir,sr,kt,rr;if(!(wr||Qe===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,Be.save(),Be.transform(...Xe.textMatrix),Be.translate(Xe.x,Xe.y),Be.scale(pt,vt),ir=0;ir<vr;++ir){if(sr=$e[ir],typeof sr=="number"){rr=Dt*sr*Qe/1e3,this.ctx.translate(rr,0),Xe.x+=rr*pt;continue}const lr=(sr.isSpace?hr:0)+Ut,mr=rt.charProcOperatorList[sr.operatorListId];if(!mr){(0,T.warn)(`Type3 character "${sr.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=sr,this.save(),Be.scale(Qe,Qe),Be.transform(...yr),this.executeOperatorList(mr),this.restore()),kt=T.Util.applyTransform([sr.width,0],yr)[0]*Qe+lr,Be.translate(kt,0),Xe.x+=kt*pt}Be.restore(),this.processingType3=null}}setCharWidth($e,Be){}setCharWidthAndBounds($e,Be,Xe,rt,Qe,vt){this.ctx.rect(Xe,rt,Qe-Xe,vt-rt),this.ctx.clip(),this.endPath()}getColorN_Pattern($e){let Be;if($e[0]==="TilingPattern"){const Xe=$e[1],rt=this.baseTransform||(0,w.getCurrentTransform)(this.ctx),Qe={createCanvasGraphics:vt=>new Lt(vt,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};Be=new S.TilingPattern($e,Xe,this.ctx,Qe,rt)}else Be=this._getPattern($e[1],$e[2]);return Be}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor($e,Be,Xe){const rt=T.Util.makeHexColor($e,Be,Xe);this.ctx.strokeStyle=rt,this.current.strokeColor=rt}setFillRGBColor($e,Be,Xe){const rt=T.Util.makeHexColor($e,Be,Xe);this.ctx.fillStyle=rt,this.current.fillColor=rt,this.current.patternFill=!1}_getPattern($e,Be=null){let Xe;return this.cachedPatterns.has($e)?Xe=this.cachedPatterns.get($e):(Xe=(0,S.getShadingPattern)(this.getObject($e)),this.cachedPatterns.set($e,Xe)),Be&&(Xe.matrix=Be),Xe}shadingFill($e){if(!this.contentVisible)return;const Be=this.ctx;this.save();const Xe=this._getPattern($e);Be.fillStyle=Xe.getPattern(Be,this,(0,w.getCurrentTransformInverse)(Be),S.PathType.SHADING);const rt=(0,w.getCurrentTransformInverse)(Be);if(rt){const{width:Qe,height:vt}=Be.canvas,[Dt,Ut,hr,pt]=T.Util.getAxialAlignedBoundingBox([0,0,Qe,vt],rt);this.ctx.fillRect(Dt,Ut,hr-Dt,pt-Ut)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,T.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,T.unreachable)("Should not call beginImageData")}paintFormXObjectBegin($e,Be){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray($e)&&$e.length===6&&this.transform(...$e),this.baseTransform=(0,w.getCurrentTransform)(this.ctx),Be)){const Xe=Be[2]-Be[0],rt=Be[3]-Be[1];this.ctx.rect(Be[0],Be[1],Xe,rt),this.current.updateRectMinMax((0,w.getCurrentTransform)(this.ctx),Be),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup($e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const Be=this.ctx;$e.isolated||(0,T.info)("TODO: Support non-isolated groups."),$e.knockout&&(0,T.warn)("Knockout groups not supported.");const Xe=(0,w.getCurrentTransform)(Be);if($e.matrix&&Be.transform(...$e.matrix),!$e.bbox)throw new Error("Bounding box is required.");let rt=T.Util.getAxialAlignedBoundingBox($e.bbox,(0,w.getCurrentTransform)(Be));const Qe=[0,0,Be.canvas.width,Be.canvas.height];rt=T.Util.intersect(rt,Qe)||[0,0,0,0];const vt=Math.floor(rt[0]),Dt=Math.floor(rt[1]);let Ut=Math.max(Math.ceil(rt[2])-vt,1),hr=Math.max(Math.ceil(rt[3])-Dt,1),pt=1,yr=1;Ut>ae&&(pt=Ut/ae,Ut=ae),hr>ae&&(yr=hr/ae,hr=ae),this.current.startNewPathAndClipBox([0,0,Ut,hr]);let vr="groupAt"+this.groupLevel;$e.smask&&(vr+="_smask_"+this.smaskCounter++%2);const wr=this.cachedCanvases.getCanvas(vr,Ut,hr),ir=wr.context;ir.scale(1/pt,1/yr),ir.translate(-vt,-Dt),ir.transform(...Xe),$e.smask?this.smaskStack.push({canvas:wr.canvas,context:ir,offsetX:vt,offsetY:Dt,scaleX:pt,scaleY:yr,subtype:$e.smask.subtype,backdrop:$e.smask.backdrop,transferMap:$e.smask.transferMap||null,startTransformInverse:null}):(Be.setTransform(1,0,0,1,0,0),Be.translate(vt,Dt),Be.scale(pt,yr),Be.save()),ze(Be,ir),this.ctx=ir,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(Be),this.groupLevel++}endGroup($e){if(!this.contentVisible)return;this.groupLevel--;const Be=this.ctx,Xe=this.groupStack.pop();if(this.ctx=Xe,this.ctx.imageSmoothingEnabled=!1,$e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const rt=(0,w.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...rt);const Qe=T.Util.getAxialAlignedBoundingBox([0,0,Be.canvas.width,Be.canvas.height],rt);this.ctx.drawImage(Be.canvas,0,0),this.ctx.restore(),this.compose(Qe)}}beginAnnotation($e,Be,Xe,rt,Qe){if(fr(this,nr,ia).call(this),Ue(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(Be)&&Be.length===4){const vt=Be[2]-Be[0],Dt=Be[3]-Be[1];if(Qe&&this.annotationCanvasMap){Xe=Xe.slice(),Xe[4]-=Be[0],Xe[5]-=Be[1],Be=Be.slice(),Be[0]=Be[1]=0,Be[2]=vt,Be[3]=Dt;const[Ut,hr]=T.Util.singularValueDecompose2dScale((0,w.getCurrentTransform)(this.ctx)),{viewportScale:pt}=this,yr=Math.ceil(vt*this.outputScaleX*pt),vr=Math.ceil(Dt*this.outputScaleY*pt);this.annotationCanvas=this.canvasFactory.create(yr,vr);const{canvas:wr,context:ir}=this.annotationCanvas;this.annotationCanvasMap.set($e,wr),this.annotationCanvas.savedCtx=this.ctx,this.ctx=ir,this.ctx.save(),this.ctx.setTransform(Ut,0,0,-hr,0,Dt*hr),Ue(this.ctx)}else Ue(this.ctx),this.ctx.rect(Be[0],Be[1],vt,Dt),this.ctx.clip(),this.endPath()}this.current=new Me(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...Xe),this.transform(...rt)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),fr(this,nr,oa).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject($e){if(!this.contentVisible)return;const Be=$e.count;$e=this.getObject($e.data,$e),$e.count=Be;const Xe=this.ctx,rt=this.processingType3;if(rt&&(rt.compiled===void 0&&(rt.compiled=Fe($e)),rt.compiled)){rt.compiled(Xe);return}const Qe=this._createMaskCanvas($e),vt=Qe.canvas;Xe.save(),Xe.setTransform(1,0,0,1,0,0),Xe.drawImage(vt,Qe.offsetX,Qe.offsetY),Xe.restore(),this.compose()}paintImageMaskXObjectRepeat($e,Be,Xe=0,rt=0,Qe,vt){if(!this.contentVisible)return;$e=this.getObject($e.data,$e);const Dt=this.ctx;Dt.save();const Ut=(0,w.getCurrentTransform)(Dt);Dt.transform(Be,Xe,rt,Qe,0,0);const hr=this._createMaskCanvas($e);Dt.setTransform(1,0,0,1,hr.offsetX-Ut[4],hr.offsetY-Ut[5]);for(let pt=0,yr=vt.length;pt<yr;pt+=2){const vr=T.Util.transform(Ut,[Be,Xe,rt,Qe,vt[pt],vt[pt+1]]),[wr,ir]=T.Util.applyTransform([0,0],vr);Dt.drawImage(hr.canvas,wr,ir)}Dt.restore(),this.compose()}paintImageMaskXObjectGroup($e){if(!this.contentVisible)return;const Be=this.ctx,Xe=this.current.fillColor,rt=this.current.patternFill;for(const Qe of $e){const{data:vt,width:Dt,height:Ut,transform:hr}=Qe,pt=this.cachedCanvases.getCanvas("maskCanvas",Dt,Ut),yr=pt.context;yr.save();const vr=this.getObject(vt,Qe);We(yr,vr),yr.globalCompositeOperation="source-in",yr.fillStyle=rt?Xe.getPattern(yr,this,(0,w.getCurrentTransformInverse)(Be),S.PathType.FILL):Xe,yr.fillRect(0,0,Dt,Ut),yr.restore(),Be.save(),Be.transform(...hr),Be.scale(1,-1),Ce(Be,pt.canvas,0,0,Dt,Ut,0,-1,1,1),Be.restore()}this.compose()}paintImageXObject($e){if(!this.contentVisible)return;const Be=this.getObject($e);if(!Be){(0,T.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(Be)}paintImageXObjectRepeat($e,Be,Xe,rt){if(!this.contentVisible)return;const Qe=this.getObject($e);if(!Qe){(0,T.warn)("Dependent image isn't ready yet");return}const vt=Qe.width,Dt=Qe.height,Ut=[];for(let hr=0,pt=rt.length;hr<pt;hr+=2)Ut.push({transform:[Be,0,0,Xe,rt[hr],rt[hr+1]],x:0,y:0,w:vt,h:Dt});this.paintInlineImageXObjectGroup(Qe,Ut)}applyTransferMapsToCanvas($e){return this.current.transferMaps!=="none"&&($e.filter=this.current.transferMaps,$e.drawImage($e.canvas,0,0),$e.filter="none"),$e.canvas}applyTransferMapsToBitmap($e){if(this.current.transferMaps==="none")return $e.bitmap;const{bitmap:Be,width:Xe,height:rt}=$e,Qe=this.cachedCanvases.getCanvas("inlineImage",Xe,rt),vt=Qe.context;return vt.filter=this.current.transferMaps,vt.drawImage(Be,0,0),vt.filter="none",Qe.canvas}paintInlineImageXObject($e){if(!this.contentVisible)return;const Be=$e.width,Xe=$e.height,rt=this.ctx;if(this.save(),!T.isNodeJS){const{filter:Dt}=rt;Dt!=="none"&&Dt!==""&&(rt.filter="none")}rt.scale(1/Be,-1/Xe);let Qe;if($e.bitmap)Qe=this.applyTransferMapsToBitmap($e);else if(typeof HTMLElement=="function"&&$e instanceof HTMLElement||!$e.data)Qe=$e;else{const Ut=this.cachedCanvases.getCanvas("inlineImage",Be,Xe).context;Ve(Ut,$e),Qe=this.applyTransferMapsToCanvas(Ut)}const vt=this._scaleImage(Qe,(0,w.getCurrentTransformInverse)(rt));rt.imageSmoothingEnabled=Le((0,w.getCurrentTransform)(rt),$e.interpolate),Ce(rt,vt.img,0,0,vt.paintWidth,vt.paintHeight,0,-Xe,Be,Xe),this.compose(),this.restore()}paintInlineImageXObjectGroup($e,Be){if(!this.contentVisible)return;const Xe=this.ctx;let rt;if($e.bitmap)rt=$e.bitmap;else{const Qe=$e.width,vt=$e.height,Ut=this.cachedCanvases.getCanvas("inlineImage",Qe,vt).context;Ve(Ut,$e),rt=this.applyTransferMapsToCanvas(Ut)}for(const Qe of Be)Xe.save(),Xe.transform(...Qe.transform),Xe.scale(1,-1),Ce(Xe,rt,Qe.x,Qe.y,Qe.w,Qe.h,0,-1,1,1),Xe.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint($e){}markPointProps($e,Be){}beginMarkedContent($e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps($e,Be){$e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(Be)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath($e){const Be=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose($e);const Xe=this.ctx;this.pendingClip&&(Be||(this.pendingClip===Rt?Xe.clip("evenodd"):Xe.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),Xe.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const $e=(0,w.getCurrentTransform)(this.ctx);if($e[1]===0&&$e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs($e[0]),Math.abs($e[3]));else{const Be=Math.abs($e[0]*$e[3]-$e[2]*$e[1]),Xe=Math.hypot($e[0],$e[2]),rt=Math.hypot($e[1],$e[3]);this._cachedGetSinglePixelWidth=Math.max(Xe,rt)/Be}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:$e}=this.current,{a:Be,b:Xe,c:rt,d:Qe}=this.ctx.getTransform();let vt,Dt;if(Xe===0&&rt===0){const Ut=Math.abs(Be),hr=Math.abs(Qe);if(Ut===hr)if($e===0)vt=Dt=1/Ut;else{const pt=Ut*$e;vt=Dt=pt<1?1/pt:1}else if($e===0)vt=1/Ut,Dt=1/hr;else{const pt=Ut*$e,yr=hr*$e;vt=pt<1?1/pt:1,Dt=yr<1?1/yr:1}}else{const Ut=Math.abs(Be*Qe-Xe*rt),hr=Math.hypot(Be,Xe),pt=Math.hypot(rt,Qe);if($e===0)vt=pt/Ut,Dt=hr/Ut;else{const yr=$e*Ut;vt=pt>yr?pt/yr:1,Dt=hr>yr?hr/yr:1}}this._cachedScaleForStroking[0]=vt,this._cachedScaleForStroking[1]=Dt}return this._cachedScaleForStroking}rescaleAndStroke($e){const{ctx:Be}=this,{lineWidth:Xe}=this.current,[rt,Qe]=this.getScaleForStroking();if(Be.lineWidth=Xe||1,rt===1&&Qe===1){Be.stroke();return}const vt=Be.getLineDash();if($e&&Be.save(),Be.scale(rt,Qe),vt.length>0){const Dt=Math.max(rt,Qe);Be.setLineDash(vt.map(Ut=>Ut/Dt)),Be.lineDashOffset/=Dt}Be.stroke(),$e&&Be.restore()}isContentVisible(){for(let $e=this.markedContentStack.length-1;$e>=0;$e--)if(!this.markedContentStack[$e].visible)return!1;return!0}};nr=new WeakSet,ia=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},oa=function(){if(this.pageColors){const $e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if($e!=="none"){const Be=this.ctx.filter;this.ctx.filter=$e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=Be}}};let nt=Lt;r.CanvasGraphics=nt;for(const qe in T.OPS)nt.prototype[qe]!==void 0&&(nt.prototype[T.OPS[qe]]=nt.prototype[qe])},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TilingPattern=r.PathType=void 0,r.getShadingPattern=_e;var T=v(1),w=v(6);const S={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};r.PathType=S;function I(Fe,Me){if(!Me)return;const Ve=Me[2]-Me[0],We=Me[3]-Me[1],ze=new Path2D;ze.rect(Me[0],Me[1],Ve,We),Fe.clip(ze)}class H{constructor(){this.constructor===H&&(0,T.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,T.unreachable)("Abstract method `getPattern` called.")}}class te extends H{constructor(Me){super(),this._type=Me[1],this._bbox=Me[2],this._colorStops=Me[3],this._p0=Me[4],this._p1=Me[5],this._r0=Me[6],this._r1=Me[7],this.matrix=null}_createGradient(Me){let Ve;this._type==="axial"?Ve=Me.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(Ve=Me.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const We of this._colorStops)Ve.addColorStop(We[0],We[1]);return Ve}getPattern(Me,Ve,We,ze){let Ue;if(ze===S.STROKE||ze===S.FILL){const je=Ve.current.getClippedPathBoundingBox(ze,(0,w.getCurrentTransform)(Me))||[0,0,0,0],ke=Math.ceil(je[2]-je[0])||1,Ne=Math.ceil(je[3]-je[1])||1,Ge=Ve.cachedCanvases.getCanvas("pattern",ke,Ne,!0),Ie=Ge.context;Ie.clearRect(0,0,Ie.canvas.width,Ie.canvas.height),Ie.beginPath(),Ie.rect(0,0,Ie.canvas.width,Ie.canvas.height),Ie.translate(-je[0],-je[1]),We=T.Util.transform(We,[1,0,0,1,je[0],je[1]]),Ie.transform(...Ve.baseTransform),this.matrix&&Ie.transform(...this.matrix),I(Ie,this._bbox),Ie.fillStyle=this._createGradient(Ie),Ie.fill(),Ue=Me.createPattern(Ge.canvas,"no-repeat");const Le=new DOMMatrix(We);Ue.setTransform(Le)}else I(Me,this._bbox),Ue=this._createGradient(Me);return Ue}}function ae(Fe,Me,Ve,We,ze,Ue,je,ke){const Ne=Me.coords,Ge=Me.colors,Ie=Fe.data,Le=Fe.width*4;let He;Ne[Ve+1]>Ne[We+1]&&(He=Ve,Ve=We,We=He,He=Ue,Ue=je,je=He),Ne[We+1]>Ne[ze+1]&&(He=We,We=ze,ze=He,He=je,je=ke,ke=He),Ne[Ve+1]>Ne[We+1]&&(He=Ve,Ve=We,We=He,He=Ue,Ue=je,je=He);const Ct=(Ne[Ve]+Me.offsetX)*Me.scaleX,Ze=(Ne[Ve+1]+Me.offsetY)*Me.scaleY,Rt=(Ne[We]+Me.offsetX)*Me.scaleX,nt=(Ne[We+1]+Me.offsetY)*Me.scaleY,nr=(Ne[ze]+Me.offsetX)*Me.scaleX,Je=(Ne[ze+1]+Me.offsetY)*Me.scaleY;if(Ze>=Je)return;const Wt=Ge[Ue],Lt=Ge[Ue+1],qe=Ge[Ue+2],$e=Ge[je],Be=Ge[je+1],Xe=Ge[je+2],rt=Ge[ke],Qe=Ge[ke+1],vt=Ge[ke+2],Dt=Math.round(Ze),Ut=Math.round(Je);let hr,pt,yr,vr,wr,ir,sr,kt;for(let rr=Dt;rr<=Ut;rr++){if(rr<nt){const Fr=rr<Ze?0:(Ze-rr)/(Ze-nt);hr=Ct-(Ct-Rt)*Fr,pt=Wt-(Wt-$e)*Fr,yr=Lt-(Lt-Be)*Fr,vr=qe-(qe-Xe)*Fr}else{let Fr;rr>Je?Fr=1:nt===Je?Fr=0:Fr=(nt-rr)/(nt-Je),hr=Rt-(Rt-nr)*Fr,pt=$e-($e-rt)*Fr,yr=Be-(Be-Qe)*Fr,vr=Xe-(Xe-vt)*Fr}let lr;rr<Ze?lr=0:rr>Je?lr=1:lr=(Ze-rr)/(Ze-Je),wr=Ct-(Ct-nr)*lr,ir=Wt-(Wt-rt)*lr,sr=Lt-(Lt-Qe)*lr,kt=qe-(qe-vt)*lr;const mr=Math.round(Math.min(hr,wr)),Ir=Math.round(Math.max(hr,wr));let Or=Le*rr+mr*4;for(let Fr=mr;Fr<=Ir;Fr++)lr=(hr-Fr)/(hr-wr),lr<0?lr=0:lr>1&&(lr=1),Ie[Or++]=pt-(pt-ir)*lr|0,Ie[Or++]=yr-(yr-sr)*lr|0,Ie[Or++]=vr-(vr-kt)*lr|0,Ie[Or++]=255}}function ie(Fe,Me,Ve){const We=Me.coords,ze=Me.colors;let Ue,je;switch(Me.type){case"lattice":const ke=Me.verticesPerRow,Ne=Math.floor(We.length/ke)-1,Ge=ke-1;for(Ue=0;Ue<Ne;Ue++){let Ie=Ue*ke;for(let Le=0;Le<Ge;Le++,Ie++)ae(Fe,Ve,We[Ie],We[Ie+1],We[Ie+ke],ze[Ie],ze[Ie+1],ze[Ie+ke]),ae(Fe,Ve,We[Ie+ke+1],We[Ie+1],We[Ie+ke],ze[Ie+ke+1],ze[Ie+1],ze[Ie+ke])}break;case"triangles":for(Ue=0,je=We.length;Ue<je;Ue+=3)ae(Fe,Ve,We[Ue],We[Ue+1],We[Ue+2],ze[Ue],ze[Ue+1],ze[Ue+2]);break;default:throw new Error("illegal figure")}}class ce extends H{constructor(Me){super(),this._coords=Me[2],this._colors=Me[3],this._figures=Me[4],this._bounds=Me[5],this._bbox=Me[7],this._background=Me[8],this.matrix=null}_createMeshCanvas(Me,Ve,We){const ke=Math.floor(this._bounds[0]),Ne=Math.floor(this._bounds[1]),Ge=Math.ceil(this._bounds[2])-ke,Ie=Math.ceil(this._bounds[3])-Ne,Le=Math.min(Math.ceil(Math.abs(Ge*Me[0]*1.1)),3e3),He=Math.min(Math.ceil(Math.abs(Ie*Me[1]*1.1)),3e3),Ct=Ge/Le,Ze=Ie/He,Rt={coords:this._coords,colors:this._colors,offsetX:-ke,offsetY:-Ne,scaleX:1/Ct,scaleY:1/Ze},nt=Le+2*2,nr=He+2*2,Je=We.getCanvas("mesh",nt,nr,!1),Wt=Je.context,Lt=Wt.createImageData(Le,He);if(Ve){const $e=Lt.data;for(let Be=0,Xe=$e.length;Be<Xe;Be+=4)$e[Be]=Ve[0],$e[Be+1]=Ve[1],$e[Be+2]=Ve[2],$e[Be+3]=255}for(const $e of this._figures)ie(Lt,$e,Rt);return Wt.putImageData(Lt,2,2),{canvas:Je.canvas,offsetX:ke-2*Ct,offsetY:Ne-2*Ze,scaleX:Ct,scaleY:Ze}}getPattern(Me,Ve,We,ze){I(Me,this._bbox);let Ue;if(ze===S.SHADING)Ue=T.Util.singularValueDecompose2dScale((0,w.getCurrentTransform)(Me));else if(Ue=T.Util.singularValueDecompose2dScale(Ve.baseTransform),this.matrix){const ke=T.Util.singularValueDecompose2dScale(this.matrix);Ue=[Ue[0]*ke[0],Ue[1]*ke[1]]}const je=this._createMeshCanvas(Ue,ze===S.SHADING?null:this._background,Ve.cachedCanvases);return ze!==S.SHADING&&(Me.setTransform(...Ve.baseTransform),this.matrix&&Me.transform(...this.matrix)),Me.translate(je.offsetX,je.offsetY),Me.scale(je.scaleX,je.scaleY),Me.createPattern(je.canvas,"no-repeat")}}class me extends H{getPattern(){return"hotpink"}}function _e(Fe){switch(Fe[0]){case"RadialAxial":return new te(Fe);case"Mesh":return new ce(Fe);case"Dummy":return new me}throw new Error(`Unknown IR type: ${Fe[0]}`)}const Re={COLORED:1,UNCOLORED:2},Ce=class Ce{constructor(Me,Ve,We,ze,Ue){this.operatorList=Me[2],this.matrix=Me[3]||[1,0,0,1,0,0],this.bbox=Me[4],this.xstep=Me[5],this.ystep=Me[6],this.paintType=Me[7],this.tilingType=Me[8],this.color=Ve,this.ctx=We,this.canvasGraphicsFactory=ze,this.baseTransform=Ue}createPatternCanvas(Me){const Ve=this.operatorList,We=this.bbox,ze=this.xstep,Ue=this.ystep,je=this.paintType,ke=this.tilingType,Ne=this.color,Ge=this.canvasGraphicsFactory;(0,T.info)("TilingType: "+ke);const Ie=We[0],Le=We[1],He=We[2],Ct=We[3],Ze=T.Util.singularValueDecompose2dScale(this.matrix),Rt=T.Util.singularValueDecompose2dScale(this.baseTransform),nt=[Ze[0]*Rt[0],Ze[1]*Rt[1]],nr=this.getSizeAndScale(ze,this.ctx.canvas.width,nt[0]),Je=this.getSizeAndScale(Ue,this.ctx.canvas.height,nt[1]),Wt=Me.cachedCanvases.getCanvas("pattern",nr.size,Je.size,!0),Lt=Wt.context,qe=Ge.createCanvasGraphics(Lt);qe.groupLevel=Me.groupLevel,this.setFillAndStrokeStyleToContext(qe,je,Ne);let $e=Ie,Be=Le,Xe=He,rt=Ct;return Ie<0&&($e=0,Xe+=Math.abs(Ie)),Le<0&&(Be=0,rt+=Math.abs(Le)),Lt.translate(-(nr.scale*$e),-(Je.scale*Be)),qe.transform(nr.scale,0,0,Je.scale,0,0),Lt.save(),this.clipBbox(qe,$e,Be,Xe,rt),qe.baseTransform=(0,w.getCurrentTransform)(qe.ctx),qe.executeOperatorList(Ve),qe.endDrawing(),{canvas:Wt.canvas,scaleX:nr.scale,scaleY:Je.scale,offsetX:$e,offsetY:Be}}getSizeAndScale(Me,Ve,We){Me=Math.abs(Me);const ze=Math.max(Ce.MAX_PATTERN_SIZE,Ve);let Ue=Math.ceil(Me*We);return Ue>=ze?Ue=ze:We=Ue/Me,{scale:We,size:Ue}}clipBbox(Me,Ve,We,ze,Ue){const je=ze-Ve,ke=Ue-We;Me.ctx.rect(Ve,We,je,ke),Me.current.updateRectMinMax((0,w.getCurrentTransform)(Me.ctx),[Ve,We,ze,Ue]),Me.clip(),Me.endPath()}setFillAndStrokeStyleToContext(Me,Ve,We){const ze=Me.ctx,Ue=Me.current;switch(Ve){case Re.COLORED:const je=this.ctx;ze.fillStyle=je.fillStyle,ze.strokeStyle=je.strokeStyle,Ue.fillColor=je.fillStyle,Ue.strokeColor=je.strokeStyle;break;case Re.UNCOLORED:const ke=T.Util.makeHexColor(We[0],We[1],We[2]);ze.fillStyle=ke,ze.strokeStyle=ke,Ue.fillColor=ke,Ue.strokeColor=ke;break;default:throw new T.FormatError(`Unsupported paint type: ${Ve}`)}}getPattern(Me,Ve,We,ze){let Ue=We;ze!==S.SHADING&&(Ue=T.Util.transform(Ue,Ve.baseTransform),this.matrix&&(Ue=T.Util.transform(Ue,this.matrix)));const je=this.createPatternCanvas(Ve);let ke=new DOMMatrix(Ue);ke=ke.translate(je.offsetX,je.offsetY),ke=ke.scale(1/je.scaleX,1/je.scaleY);const Ne=Me.createPattern(je.canvas,"repeat");return Ne.setTransform(ke),Ne}};cs(Ce,"MAX_PATTERN_SIZE",3e3);let Pe=Ce;r.TilingPattern=Pe},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.convertBlackAndWhiteToRGBA=S,r.convertToRGBA=w,r.grayToRGBA=H;var T=v(1);function w(te){switch(te.kind){case T.ImageKind.GRAYSCALE_1BPP:return S(te);case T.ImageKind.RGB_24BPP:return I(te)}return null}function S({src:te,srcPos:ae=0,dest:ie,width:ce,height:me,nonBlackColor:_e=4294967295,inverseDecode:Re=!1}){const Pe=T.FeatureTest.isLittleEndian?4278190080:255,[Ce,Fe]=Re?[_e,Pe]:[Pe,_e],Me=ce>>3,Ve=ce&7,We=te.length;ie=new Uint32Array(ie.buffer);let ze=0;for(let Ue=0;Ue<me;Ue++){for(const ke=ae+Me;ae<ke;ae++){const Ne=ae<We?te[ae]:255;ie[ze++]=Ne&128?Fe:Ce,ie[ze++]=Ne&64?Fe:Ce,ie[ze++]=Ne&32?Fe:Ce,ie[ze++]=Ne&16?Fe:Ce,ie[ze++]=Ne&8?Fe:Ce,ie[ze++]=Ne&4?Fe:Ce,ie[ze++]=Ne&2?Fe:Ce,ie[ze++]=Ne&1?Fe:Ce}if(Ve===0)continue;const je=ae<We?te[ae++]:255;for(let ke=0;ke<Ve;ke++)ie[ze++]=je&1<<7-ke?Fe:Ce}return{srcPos:ae,destPos:ze}}function I({src:te,srcPos:ae=0,dest:ie,destPos:ce=0,width:me,height:_e}){let Re=0;const Pe=te.length>>2,Ce=new Uint32Array(te.buffer,ae,Pe);if(T.FeatureTest.isLittleEndian){for(;Re<Pe-2;Re+=3,ce+=4){const Fe=Ce[Re],Me=Ce[Re+1],Ve=Ce[Re+2];ie[ce]=Fe|4278190080,ie[ce+1]=Fe>>>24|Me<<8|4278190080,ie[ce+2]=Me>>>16|Ve<<16|4278190080,ie[ce+3]=Ve>>>8|4278190080}for(let Fe=Re*4,Me=te.length;Fe<Me;Fe+=3)ie[ce++]=te[Fe]|te[Fe+1]<<8|te[Fe+2]<<16|4278190080}else{for(;Re<Pe-2;Re+=3,ce+=4){const Fe=Ce[Re],Me=Ce[Re+1],Ve=Ce[Re+2];ie[ce]=Fe|255,ie[ce+1]=Fe<<24|Me>>>8|255,ie[ce+2]=Me<<16|Ve>>>16|255,ie[ce+3]=Ve<<8|255}for(let Fe=Re*4,Me=te.length;Fe<Me;Fe+=3)ie[ce++]=te[Fe]<<24|te[Fe+1]<<16|te[Fe+2]<<8|255}return{srcPos:ae,destPos:ce}}function H(te,ae){if(T.FeatureTest.isLittleEndian)for(let ie=0,ce=te.length;ie<ce;ie++)ae[ie]=te[ie]*65793|4278190080;else for(let ie=0,ce=te.length;ie<ce;ie++)ae[ie]=te[ie]*16843008|255}},(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.GlobalWorkerOptions=void 0;const v=Object.create(null);r.GlobalWorkerOptions=v,v.workerPort=null,v.workerSrc=""},(E,r,v)=>{var te,mi,gi,jn;Object.defineProperty(r,"__esModule",{value:!0}),r.MessageHandler=void 0;var T=v(1);const w={DATA:1,ERROR:2},S={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function I(me){switch(me instanceof Error||typeof me=="object"&&me!==null||(0,T.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),me.name){case"AbortException":return new T.AbortException(me.message);case"MissingPDFException":return new T.MissingPDFException(me.message);case"PasswordException":return new T.PasswordException(me.message,me.code);case"UnexpectedResponseException":return new T.UnexpectedResponseException(me.message,me.status);case"UnknownErrorException":return new T.UnknownErrorException(me.message,me.details);default:return new T.UnknownErrorException(me.message,me.toString())}}class H{constructor(_e,Re,Pe){Tr(this,te);this.sourceName=_e,this.targetName=Re,this.comObj=Pe,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=Ce=>{const Fe=Ce.data;if(Fe.targetName!==this.sourceName)return;if(Fe.stream){fr(this,te,gi).call(this,Fe);return}if(Fe.callback){const Ve=Fe.callbackId,We=this.callbackCapabilities[Ve];if(!We)throw new Error(`Cannot resolve callback ${Ve}`);if(delete this.callbackCapabilities[Ve],Fe.callback===w.DATA)We.resolve(Fe.data);else if(Fe.callback===w.ERROR)We.reject(I(Fe.reason));else throw new Error("Unexpected callback case");return}const Me=this.actionHandler[Fe.action];if(!Me)throw new Error(`Unknown action from worker: ${Fe.action}`);if(Fe.callbackId){const Ve=this.sourceName,We=Fe.sourceName;new Promise(function(ze){ze(Me(Fe.data))}).then(function(ze){Pe.postMessage({sourceName:Ve,targetName:We,callback:w.DATA,callbackId:Fe.callbackId,data:ze})},function(ze){Pe.postMessage({sourceName:Ve,targetName:We,callback:w.ERROR,callbackId:Fe.callbackId,reason:I(ze)})});return}if(Fe.streamId){fr(this,te,mi).call(this,Fe);return}Me(Fe.data)},Pe.addEventListener("message",this._onComObjOnMessage)}on(_e,Re){const Pe=this.actionHandler;if(Pe[_e])throw new Error(`There is already an actionName called "${_e}"`);Pe[_e]=Re}send(_e,Re,Pe){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:_e,data:Re},Pe)}sendWithPromise(_e,Re,Pe){const Ce=this.callbackId++,Fe=new T.PromiseCapability;this.callbackCapabilities[Ce]=Fe;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:_e,callbackId:Ce,data:Re},Pe)}catch(Me){Fe.reject(Me)}return Fe.promise}sendWithStream(_e,Re,Pe,Ce){const Fe=this.streamId++,Me=this.sourceName,Ve=this.targetName,We=this.comObj;return new ReadableStream({start:ze=>{const Ue=new T.PromiseCapability;return this.streamControllers[Fe]={controller:ze,startCall:Ue,pullCall:null,cancelCall:null,isClosed:!1},We.postMessage({sourceName:Me,targetName:Ve,action:_e,streamId:Fe,data:Re,desiredSize:ze.desiredSize},Ce),Ue.promise},pull:ze=>{const Ue=new T.PromiseCapability;return this.streamControllers[Fe].pullCall=Ue,We.postMessage({sourceName:Me,targetName:Ve,stream:S.PULL,streamId:Fe,desiredSize:ze.desiredSize}),Ue.promise},cancel:ze=>{(0,T.assert)(ze instanceof Error,"cancel must have a valid reason");const Ue=new T.PromiseCapability;return this.streamControllers[Fe].cancelCall=Ue,this.streamControllers[Fe].isClosed=!0,We.postMessage({sourceName:Me,targetName:Ve,stream:S.CANCEL,streamId:Fe,reason:I(ze)}),Ue.promise}},Pe)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}te=new WeakSet,mi=function(_e){const Re=_e.streamId,Pe=this.sourceName,Ce=_e.sourceName,Fe=this.comObj,Me=this,Ve=this.actionHandler[_e.action],We={enqueue(ze,Ue=1,je){if(this.isCancelled)return;const ke=this.desiredSize;this.desiredSize-=Ue,ke>0&&this.desiredSize<=0&&(this.sinkCapability=new T.PromiseCapability,this.ready=this.sinkCapability.promise),Fe.postMessage({sourceName:Pe,targetName:Ce,stream:S.ENQUEUE,streamId:Re,chunk:ze},je)},close(){this.isCancelled||(this.isCancelled=!0,Fe.postMessage({sourceName:Pe,targetName:Ce,stream:S.CLOSE,streamId:Re}),delete Me.streamSinks[Re])},error(ze){(0,T.assert)(ze instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,Fe.postMessage({sourceName:Pe,targetName:Ce,stream:S.ERROR,streamId:Re,reason:I(ze)}))},sinkCapability:new T.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:_e.desiredSize,ready:null};We.sinkCapability.resolve(),We.ready=We.sinkCapability.promise,this.streamSinks[Re]=We,new Promise(function(ze){ze(Ve(_e.data,We))}).then(function(){Fe.postMessage({sourceName:Pe,targetName:Ce,stream:S.START_COMPLETE,streamId:Re,success:!0})},function(ze){Fe.postMessage({sourceName:Pe,targetName:Ce,stream:S.START_COMPLETE,streamId:Re,reason:I(ze)})})},gi=function(_e){const Re=_e.streamId,Pe=this.sourceName,Ce=_e.sourceName,Fe=this.comObj,Me=this.streamControllers[Re],Ve=this.streamSinks[Re];switch(_e.stream){case S.START_COMPLETE:_e.success?Me.startCall.resolve():Me.startCall.reject(I(_e.reason));break;case S.PULL_COMPLETE:_e.success?Me.pullCall.resolve():Me.pullCall.reject(I(_e.reason));break;case S.PULL:if(!Ve){Fe.postMessage({sourceName:Pe,targetName:Ce,stream:S.PULL_COMPLETE,streamId:Re,success:!0});break}Ve.desiredSize<=0&&_e.desiredSize>0&&Ve.sinkCapability.resolve(),Ve.desiredSize=_e.desiredSize,new Promise(function(We){var ze;We((ze=Ve.onPull)==null?void 0:ze.call(Ve))}).then(function(){Fe.postMessage({sourceName:Pe,targetName:Ce,stream:S.PULL_COMPLETE,streamId:Re,success:!0})},function(We){Fe.postMessage({sourceName:Pe,targetName:Ce,stream:S.PULL_COMPLETE,streamId:Re,reason:I(We)})});break;case S.ENQUEUE:if((0,T.assert)(Me,"enqueue should have stream controller"),Me.isClosed)break;Me.controller.enqueue(_e.chunk);break;case S.CLOSE:if((0,T.assert)(Me,"close should have stream controller"),Me.isClosed)break;Me.isClosed=!0,Me.controller.close(),fr(this,te,jn).call(this,Me,Re);break;case S.ERROR:(0,T.assert)(Me,"error should have stream controller"),Me.controller.error(I(_e.reason)),fr(this,te,jn).call(this,Me,Re);break;case S.CANCEL_COMPLETE:_e.success?Me.cancelCall.resolve():Me.cancelCall.reject(I(_e.reason)),fr(this,te,jn).call(this,Me,Re);break;case S.CANCEL:if(!Ve)break;new Promise(function(We){var ze;We((ze=Ve.onCancel)==null?void 0:ze.call(Ve,I(_e.reason)))}).then(function(){Fe.postMessage({sourceName:Pe,targetName:Ce,stream:S.CANCEL_COMPLETE,streamId:Re,success:!0})},function(We){Fe.postMessage({sourceName:Pe,targetName:Ce,stream:S.CANCEL_COMPLETE,streamId:Re,reason:I(We)})}),Ve.sinkCapability.reject(I(_e.reason)),Ve.isCancelled=!0,delete this.streamSinks[Re];break;default:throw new Error("Unexpected stream case")}},jn=async function(_e,Re){var Pe,Ce,Fe;await Promise.allSettled([(Pe=_e.startCall)==null?void 0:Pe.promise,(Ce=_e.pullCall)==null?void 0:Ce.promise,(Fe=_e.cancelCall)==null?void 0:Fe.promise]),delete this.streamControllers[Re]},r.MessageHandler=H},(E,r,v)=>{var S,I;Object.defineProperty(r,"__esModule",{value:!0}),r.Metadata=void 0;var T=v(1);class w{constructor({parsedData:te,rawData:ae}){Tr(this,S);Tr(this,I);Ar(this,S,te),Ar(this,I,ae)}getRaw(){return Ye(this,I)}get(te){return Ye(this,S).get(te)??null}getAll(){return(0,T.objectFromMap)(Ye(this,S))}has(te){return Ye(this,S).has(te)}}S=new WeakMap,I=new WeakMap,r.Metadata=w},(E,r,v)=>{var te,ae,ie,ce,me,_e,ca;Object.defineProperty(r,"__esModule",{value:!0}),r.OptionalContentConfig=void 0;var T=v(1),w=v(8);const S=Symbol("INTERNAL");class I{constructor(Ce,Fe){Tr(this,te,!0);this.name=Ce,this.intent=Fe}get visible(){return Ye(this,te)}_setVisible(Ce,Fe){Ce!==S&&(0,T.unreachable)("Internal method `_setVisible` called."),Ar(this,te,Fe)}}te=new WeakMap;class H{constructor(Ce){Tr(this,_e);Tr(this,ae,null);Tr(this,ie,new Map);Tr(this,ce,null);Tr(this,me,null);if(this.name=null,this.creator=null,Ce!==null){this.name=Ce.name,this.creator=Ce.creator,Ar(this,me,Ce.order);for(const Fe of Ce.groups)Ye(this,ie).set(Fe.id,new I(Fe.name,Fe.intent));if(Ce.baseState==="OFF")for(const Fe of Ye(this,ie).values())Fe._setVisible(S,!1);for(const Fe of Ce.on)Ye(this,ie).get(Fe)._setVisible(S,!0);for(const Fe of Ce.off)Ye(this,ie).get(Fe)._setVisible(S,!1);Ar(this,ce,this.getHash())}}isVisible(Ce){if(Ye(this,ie).size===0)return!0;if(!Ce)return(0,T.warn)("Optional content group not defined."),!0;if(Ce.type==="OCG")return Ye(this,ie).has(Ce.id)?Ye(this,ie).get(Ce.id).visible:((0,T.warn)(`Optional content group not found: ${Ce.id}`),!0);if(Ce.type==="OCMD"){if(Ce.expression)return fr(this,_e,ca).call(this,Ce.expression);if(!Ce.policy||Ce.policy==="AnyOn"){for(const Fe of Ce.ids){if(!Ye(this,ie).has(Fe))return(0,T.warn)(`Optional content group not found: ${Fe}`),!0;if(Ye(this,ie).get(Fe).visible)return!0}return!1}else if(Ce.policy==="AllOn"){for(const Fe of Ce.ids){if(!Ye(this,ie).has(Fe))return(0,T.warn)(`Optional content group not found: ${Fe}`),!0;if(!Ye(this,ie).get(Fe).visible)return!1}return!0}else if(Ce.policy==="AnyOff"){for(const Fe of Ce.ids){if(!Ye(this,ie).has(Fe))return(0,T.warn)(`Optional content group not found: ${Fe}`),!0;if(!Ye(this,ie).get(Fe).visible)return!0}return!1}else if(Ce.policy==="AllOff"){for(const Fe of Ce.ids){if(!Ye(this,ie).has(Fe))return(0,T.warn)(`Optional content group not found: ${Fe}`),!0;if(Ye(this,ie).get(Fe).visible)return!1}return!0}return(0,T.warn)(`Unknown optional content policy ${Ce.policy}.`),!0}return(0,T.warn)(`Unknown group type ${Ce.type}.`),!0}setVisibility(Ce,Fe=!0){if(!Ye(this,ie).has(Ce)){(0,T.warn)(`Optional content group not found: ${Ce}`);return}Ye(this,ie).get(Ce)._setVisible(S,!!Fe),Ar(this,ae,null)}get hasInitialVisibility(){return Ye(this,ce)===null||this.getHash()===Ye(this,ce)}getOrder(){return Ye(this,ie).size?Ye(this,me)?Ye(this,me).slice():[...Ye(this,ie).keys()]:null}getGroups(){return Ye(this,ie).size>0?(0,T.objectFromMap)(Ye(this,ie)):null}getGroup(Ce){return Ye(this,ie).get(Ce)||null}getHash(){if(Ye(this,ae)!==null)return Ye(this,ae);const Ce=new w.MurmurHash3_64;for(const[Fe,Me]of Ye(this,ie))Ce.update(`${Fe}:${Me.visible}`);return Ar(this,ae,Ce.hexdigest())}}ae=new WeakMap,ie=new WeakMap,ce=new WeakMap,me=new WeakMap,_e=new WeakSet,ca=function(Ce){const Fe=Ce.length;if(Fe<2)return!0;const Me=Ce[0];for(let Ve=1;Ve<Fe;Ve++){const We=Ce[Ve];let ze;if(Array.isArray(We))ze=fr(this,_e,ca).call(this,We);else if(Ye(this,ie).has(We))ze=Ye(this,ie).get(We).visible;else return(0,T.warn)(`Optional content group not found: ${We}`),!0;switch(Me){case"And":if(!ze)return!1;break;case"Or":if(ze)return!0;break;case"Not":return!ze;default:return!0}}return Me==="And"},r.OptionalContentConfig=H},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFDataTransportStream=void 0;var T=v(1),w=v(6);class S{constructor({length:ae,initialData:ie,progressiveDone:ce=!1,contentDispositionFilename:me=null,disableRange:_e=!1,disableStream:Re=!1},Pe){if((0,T.assert)(Pe,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=ce,this._contentDispositionFilename=me,(ie==null?void 0:ie.length)>0){const Ce=ie instanceof Uint8Array&&ie.byteLength===ie.buffer.byteLength?ie.buffer:new Uint8Array(ie).buffer;this._queuedChunks.push(Ce)}this._pdfDataRangeTransport=Pe,this._isStreamingSupported=!Re,this._isRangeSupported=!_e,this._contentLength=ae,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((Ce,Fe)=>{this._onReceiveData({begin:Ce,chunk:Fe})}),this._pdfDataRangeTransport.addProgressListener((Ce,Fe)=>{this._onProgress({loaded:Ce,total:Fe})}),this._pdfDataRangeTransport.addProgressiveReadListener(Ce=>{this._onReceiveData({chunk:Ce})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:ae,chunk:ie}){const ce=ie instanceof Uint8Array&&ie.byteLength===ie.buffer.byteLength?ie.buffer:new Uint8Array(ie).buffer;if(ae===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(ce):this._queuedChunks.push(ce);else{const me=this._rangeReaders.some(function(_e){return _e._begin!==ae?!1:(_e._enqueue(ce),!0)});(0,T.assert)(me,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var ae;return((ae=this._fullRequestReader)==null?void 0:ae._loaded)??0}_onProgress(ae){var ie,ce,me,_e;ae.total===void 0?(ce=(ie=this._rangeReaders[0])==null?void 0:ie.onProgress)==null||ce.call(ie,{loaded:ae.loaded}):(_e=(me=this._fullRequestReader)==null?void 0:me.onProgress)==null||_e.call(me,{loaded:ae.loaded,total:ae.total})}_onProgressiveDone(){var ae;(ae=this._fullRequestReader)==null||ae.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(ae){const ie=this._rangeReaders.indexOf(ae);ie>=0&&this._rangeReaders.splice(ie,1)}getFullReader(){(0,T.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const ae=this._queuedChunks;return this._queuedChunks=null,new I(this,ae,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(ae,ie){if(ie<=this._progressiveDataLength)return null;const ce=new H(this,ae,ie);return this._pdfDataRangeTransport.requestDataRange(ae,ie),this._rangeReaders.push(ce),ce}cancelAllRequests(ae){var ie;(ie=this._fullRequestReader)==null||ie.cancel(ae);for(const ce of this._rangeReaders.slice(0))ce.cancel(ae);this._pdfDataRangeTransport.abort()}}r.PDFDataTransportStream=S;class I{constructor(ae,ie,ce=!1,me=null){this._stream=ae,this._done=ce||!1,this._filename=(0,w.isPdfFile)(me)?me:null,this._queuedChunks=ie||[],this._loaded=0;for(const _e of this._queuedChunks)this._loaded+=_e.byteLength;this._requests=[],this._headersReady=Promise.resolve(),ae._fullRequestReader=this,this.onProgress=null}_enqueue(ae){this._done||(this._requests.length>0?this._requests.shift().resolve({value:ae,done:!1}):this._queuedChunks.push(ae),this._loaded+=ae.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const ae=new T.PromiseCapability;return this._requests.push(ae),ae.promise}cancel(ae){this._done=!0;for(const ie of this._requests)ie.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class H{constructor(ae,ie,ce){this._stream=ae,this._begin=ie,this._end=ce,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(ae){if(!this._done){if(this._requests.length===0)this._queuedChunk=ae;else{this._requests.shift().resolve({value:ae,done:!1});for(const ce of this._requests)ce.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const ie=this._queuedChunk;return this._queuedChunk=null,{value:ie,done:!1}}if(this._done)return{value:void 0,done:!0};const ae=new T.PromiseCapability;return this._requests.push(ae),ae.promise}cancel(ae){this._done=!0;for(const ie of this._requests)ie.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFFetchStream=void 0;var T=v(1),w=v(20);function S(ce,me,_e){return{method:"GET",headers:ce,signal:_e.signal,mode:"cors",credentials:me?"include":"same-origin",redirect:"follow"}}function I(ce){const me=new Headers;for(const _e in ce){const Re=ce[_e];Re!==void 0&&me.append(_e,Re)}return me}function H(ce){return ce instanceof Uint8Array?ce.buffer:ce instanceof ArrayBuffer?ce:((0,T.warn)(`getArrayBuffer - unexpected data format: ${ce}`),new Uint8Array(ce).buffer)}class te{constructor(me){this.source=me,this.isHttp=/^https?:/i.test(me.url),this.httpHeaders=this.isHttp&&me.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var me;return((me=this._fullRequestReader)==null?void 0:me._loaded)??0}getFullReader(){return(0,T.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new ae(this),this._fullRequestReader}getRangeReader(me,_e){if(_e<=this._progressiveDataLength)return null;const Re=new ie(this,me,_e);return this._rangeRequestReaders.push(Re),Re}cancelAllRequests(me){var _e;(_e=this._fullRequestReader)==null||_e.cancel(me);for(const Re of this._rangeRequestReaders.slice(0))Re.cancel(me)}}r.PDFFetchStream=te;class ae{constructor(me){this._stream=me,this._reader=null,this._loaded=0,this._filename=null;const _e=me.source;this._withCredentials=_e.withCredentials||!1,this._contentLength=_e.length,this._headersCapability=new T.PromiseCapability,this._disableRange=_e.disableRange||!1,this._rangeChunkSize=_e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!_e.disableStream,this._isRangeSupported=!_e.disableRange,this._headers=I(this._stream.httpHeaders);const Re=_e.url;fetch(Re,S(this._headers,this._withCredentials,this._abortController)).then(Pe=>{if(!(0,w.validateResponseStatus)(Pe.status))throw(0,w.createResponseStatusError)(Pe.status,Re);this._reader=Pe.body.getReader(),this._headersCapability.resolve();const Ce=Ve=>Pe.headers.get(Ve),{allowRangeRequests:Fe,suggestedLength:Me}=(0,w.validateRangeRequestCapabilities)({getResponseHeader:Ce,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=Fe,this._contentLength=Me||this._contentLength,this._filename=(0,w.extractFilenameFromHeader)(Ce),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new T.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var Re;await this._headersCapability.promise;const{value:me,done:_e}=await this._reader.read();return _e?{value:me,done:_e}:(this._loaded+=me.byteLength,(Re=this.onProgress)==null||Re.call(this,{loaded:this._loaded,total:this._contentLength}),{value:H(me),done:!1})}cancel(me){var _e;(_e=this._reader)==null||_e.cancel(me),this._abortController.abort()}}class ie{constructor(me,_e,Re){this._stream=me,this._reader=null,this._loaded=0;const Pe=me.source;this._withCredentials=Pe.withCredentials||!1,this._readCapability=new T.PromiseCapability,this._isStreamingSupported=!Pe.disableStream,this._abortController=new AbortController,this._headers=I(this._stream.httpHeaders),this._headers.append("Range",`bytes=${_e}-${Re-1}`);const Ce=Pe.url;fetch(Ce,S(this._headers,this._withCredentials,this._abortController)).then(Fe=>{if(!(0,w.validateResponseStatus)(Fe.status))throw(0,w.createResponseStatusError)(Fe.status,Ce);this._readCapability.resolve(),this._reader=Fe.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var Re;await this._readCapability.promise;const{value:me,done:_e}=await this._reader.read();return _e?{value:me,done:_e}:(this._loaded+=me.byteLength,(Re=this.onProgress)==null||Re.call(this,{loaded:this._loaded}),{value:H(me),done:!1})}cancel(me){var _e;(_e=this._reader)==null||_e.cancel(me),this._abortController.abort()}}},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createResponseStatusError=te,r.extractFilenameFromHeader=H,r.validateRangeRequestCapabilities=I,r.validateResponseStatus=ae;var T=v(1),w=v(21),S=v(6);function I({getResponseHeader:ie,isHttp:ce,rangeChunkSize:me,disableRange:_e}){const Re={allowRangeRequests:!1,suggestedLength:void 0},Pe=parseInt(ie("Content-Length"),10);return!Number.isInteger(Pe)||(Re.suggestedLength=Pe,Pe<=2*me)||_e||!ce||ie("Accept-Ranges")!=="bytes"||(ie("Content-Encoding")||"identity")!=="identity"||(Re.allowRangeRequests=!0),Re}function H(ie){const ce=ie("Content-Disposition");if(ce){let me=(0,w.getFilenameFromContentDispositionHeader)(ce);if(me.includes("%"))try{me=decodeURIComponent(me)}catch{}if((0,S.isPdfFile)(me))return me}return null}function te(ie,ce){return ie===404||ie===0&&ce.startsWith("file:")?new T.MissingPDFException('Missing PDF "'+ce+'".'):new T.UnexpectedResponseException(`Unexpected server response (${ie}) while retrieving PDF "${ce}".`,ie)}function ae(ie){return ie===200||ie===206}},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getFilenameFromContentDispositionHeader=w;var T=v(1);function w(S){let I=!0,H=te("filename\\*","i").exec(S);if(H){H=H[1];let Pe=me(H);return Pe=unescape(Pe),Pe=_e(Pe),Pe=Re(Pe),ie(Pe)}if(H=ce(S),H){const Pe=Re(H);return ie(Pe)}if(H=te("filename","i").exec(S),H){H=H[1];let Pe=me(H);return Pe=Re(Pe),ie(Pe)}function te(Pe,Ce){return new RegExp("(?:^|;)\\s*"+Pe+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',Ce)}function ae(Pe,Ce){if(Pe){if(!/^[\x00-\xFF]+$/.test(Ce))return Ce;try{const Fe=new TextDecoder(Pe,{fatal:!0}),Me=(0,T.stringToBytes)(Ce);Ce=Fe.decode(Me),I=!1}catch{}}return Ce}function ie(Pe){return I&&/[\x80-\xff]/.test(Pe)&&(Pe=ae("utf-8",Pe),I&&(Pe=ae("iso-8859-1",Pe))),Pe}function ce(Pe){const Ce=[];let Fe;const Me=te("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(Fe=Me.exec(Pe))!==null;){let[,We,ze,Ue]=Fe;if(We=parseInt(We,10),We in Ce){if(We===0)break;continue}Ce[We]=[ze,Ue]}const Ve=[];for(let We=0;We<Ce.length&&We in Ce;++We){let[ze,Ue]=Ce[We];Ue=me(Ue),ze&&(Ue=unescape(Ue),We===0&&(Ue=_e(Ue))),Ve.push(Ue)}return Ve.join("")}function me(Pe){if(Pe.startsWith('"')){const Ce=Pe.slice(1).split('\\"');for(let Fe=0;Fe<Ce.length;++Fe){const Me=Ce[Fe].indexOf('"');Me!==-1&&(Ce[Fe]=Ce[Fe].slice(0,Me),Ce.length=Fe+1),Ce[Fe]=Ce[Fe].replaceAll(/\\(.)/g,"$1")}Pe=Ce.join('"')}return Pe}function _e(Pe){const Ce=Pe.indexOf("'");if(Ce===-1)return Pe;const Fe=Pe.slice(0,Ce),Ve=Pe.slice(Ce+1).replace(/^[^']*'/,"");return ae(Fe,Ve)}function Re(Pe){return!Pe.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(Pe)?Pe:Pe.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(Ce,Fe,Me,Ve){if(Me==="q"||Me==="Q")return Ve=Ve.replaceAll("_"," "),Ve=Ve.replaceAll(/=([0-9a-fA-F]{2})/g,function(We,ze){return String.fromCharCode(parseInt(ze,16))}),ae(Fe,Ve);try{Ve=atob(Ve)}catch{}return ae(Fe,Ve)})}return""}},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFNetworkStream=void 0;var T=v(1),w=v(20);const S=200,I=206;function H(me){const _e=me.response;return typeof _e!="string"?_e:(0,T.stringToBytes)(_e).buffer}class te{constructor(_e,Re={}){this.url=_e,this.isHttp=/^https?:/i.test(_e),this.httpHeaders=this.isHttp&&Re.httpHeaders||Object.create(null),this.withCredentials=Re.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(_e,Re,Pe){const Ce={begin:_e,end:Re};for(const Fe in Pe)Ce[Fe]=Pe[Fe];return this.request(Ce)}requestFull(_e){return this.request(_e)}request(_e){const Re=new XMLHttpRequest,Pe=this.currXhrId++,Ce=this.pendingRequests[Pe]={xhr:Re};Re.open("GET",this.url),Re.withCredentials=this.withCredentials;for(const Fe in this.httpHeaders){const Me=this.httpHeaders[Fe];Me!==void 0&&Re.setRequestHeader(Fe,Me)}return this.isHttp&&"begin"in _e&&"end"in _e?(Re.setRequestHeader("Range",`bytes=${_e.begin}-${_e.end-1}`),Ce.expectedStatus=I):Ce.expectedStatus=S,Re.responseType="arraybuffer",_e.onError&&(Re.onerror=function(Fe){_e.onError(Re.status)}),Re.onreadystatechange=this.onStateChange.bind(this,Pe),Re.onprogress=this.onProgress.bind(this,Pe),Ce.onHeadersReceived=_e.onHeadersReceived,Ce.onDone=_e.onDone,Ce.onError=_e.onError,Ce.onProgress=_e.onProgress,Re.send(null),Pe}onProgress(_e,Re){var Ce;const Pe=this.pendingRequests[_e];Pe&&((Ce=Pe.onProgress)==null||Ce.call(Pe,Re))}onStateChange(_e,Re){var We,ze,Ue;const Pe=this.pendingRequests[_e];if(!Pe)return;const Ce=Pe.xhr;if(Ce.readyState>=2&&Pe.onHeadersReceived&&(Pe.onHeadersReceived(),delete Pe.onHeadersReceived),Ce.readyState!==4||!(_e in this.pendingRequests))return;if(delete this.pendingRequests[_e],Ce.status===0&&this.isHttp){(We=Pe.onError)==null||We.call(Pe,Ce.status);return}const Fe=Ce.status||S;if(!(Fe===S&&Pe.expectedStatus===I)&&Fe!==Pe.expectedStatus){(ze=Pe.onError)==null||ze.call(Pe,Ce.status);return}const Ve=H(Ce);if(Fe===I){const je=Ce.getResponseHeader("Content-Range"),ke=/bytes (\d+)-(\d+)\/(\d+)/.exec(je);Pe.onDone({begin:parseInt(ke[1],10),chunk:Ve})}else Ve?Pe.onDone({begin:0,chunk:Ve}):(Ue=Pe.onError)==null||Ue.call(Pe,Ce.status)}getRequestXhr(_e){return this.pendingRequests[_e].xhr}isPendingRequest(_e){return _e in this.pendingRequests}abortRequest(_e){const Re=this.pendingRequests[_e].xhr;delete this.pendingRequests[_e],Re.abort()}}class ae{constructor(_e){this._source=_e,this._manager=new te(_e.url,{httpHeaders:_e.httpHeaders,withCredentials:_e.withCredentials}),this._rangeChunkSize=_e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(_e){const Re=this._rangeRequestReaders.indexOf(_e);Re>=0&&this._rangeRequestReaders.splice(Re,1)}getFullReader(){return(0,T.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new ie(this._manager,this._source),this._fullRequestReader}getRangeReader(_e,Re){const Pe=new ce(this._manager,_e,Re);return Pe.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(Pe),Pe}cancelAllRequests(_e){var Re;(Re=this._fullRequestReader)==null||Re.cancel(_e);for(const Pe of this._rangeRequestReaders.slice(0))Pe.cancel(_e)}}r.PDFNetworkStream=ae;class ie{constructor(_e,Re){this._manager=_e;const Pe={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=Re.url,this._fullRequestId=_e.requestFull(Pe),this._headersReceivedCapability=new T.PromiseCapability,this._disableRange=Re.disableRange||!1,this._contentLength=Re.length,this._rangeChunkSize=Re.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const _e=this._fullRequestId,Re=this._manager.getRequestXhr(_e),Pe=Me=>Re.getResponseHeader(Me),{allowRangeRequests:Ce,suggestedLength:Fe}=(0,w.validateRangeRequestCapabilities)({getResponseHeader:Pe,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});Ce&&(this._isRangeSupported=!0),this._contentLength=Fe||this._contentLength,this._filename=(0,w.extractFilenameFromHeader)(Pe),this._isRangeSupported&&this._manager.abortRequest(_e),this._headersReceivedCapability.resolve()}_onDone(_e){if(_e&&(this._requests.length>0?this._requests.shift().resolve({value:_e.chunk,done:!1}):this._cachedChunks.push(_e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const Re of this._requests)Re.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(_e){this._storedError=(0,w.createResponseStatusError)(_e,this._url),this._headersReceivedCapability.reject(this._storedError);for(const Re of this._requests)Re.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(_e){var Re;(Re=this.onProgress)==null||Re.call(this,{loaded:_e.loaded,total:_e.lengthComputable?_e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const _e=new T.PromiseCapability;return this._requests.push(_e),_e.promise}cancel(_e){this._done=!0,this._headersReceivedCapability.reject(_e);for(const Re of this._requests)Re.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class ce{constructor(_e,Re,Pe){this._manager=_e;const Ce={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=_e.url,this._requestId=_e.requestRange(Re,Pe,Ce),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var _e;(_e=this.onClosed)==null||_e.call(this,this)}_onDone(_e){const Re=_e.chunk;this._requests.length>0?this._requests.shift().resolve({value:Re,done:!1}):this._queuedChunk=Re,this._done=!0;for(const Pe of this._requests)Pe.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(_e){this._storedError=(0,w.createResponseStatusError)(_e,this._url);for(const Re of this._requests)Re.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(_e){var Re;this.isStreamingSupported||(Re=this.onProgress)==null||Re.call(this,{loaded:_e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const Re=this._queuedChunk;return this._queuedChunk=null,{value:Re,done:!1}}if(this._done)return{value:void 0,done:!0};const _e=new T.PromiseCapability;return this._requests.push(_e),_e.promise}cancel(_e){this._done=!0;for(const Re of this._requests)Re.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PDFNodeStream=void 0;var T=v(1),w=v(20);const S=/^file:\/\/\/[a-zA-Z]:\//;function I(Pe){const Ce=require$$5,Fe=Ce.parse(Pe);return Fe.protocol==="file:"||Fe.host?Fe:/^[a-z]:[/\\]/i.test(Pe)?Ce.parse(`file:///${Pe}`):(Fe.host||(Fe.protocol="file:"),Fe)}class H{constructor(Ce){this.source=Ce,this.url=I(Ce.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&Ce.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var Ce;return((Ce=this._fullRequestReader)==null?void 0:Ce._loaded)??0}getFullReader(){return(0,T.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new _e(this):new ce(this),this._fullRequestReader}getRangeReader(Ce,Fe){if(Fe<=this._progressiveDataLength)return null;const Me=this.isFsUrl?new Re(this,Ce,Fe):new me(this,Ce,Fe);return this._rangeRequestReaders.push(Me),Me}cancelAllRequests(Ce){var Fe;(Fe=this._fullRequestReader)==null||Fe.cancel(Ce);for(const Me of this._rangeRequestReaders.slice(0))Me.cancel(Ce)}}r.PDFNodeStream=H;class te{constructor(Ce){this._url=Ce.url,this._done=!1,this._storedError=null,this.onProgress=null;const Fe=Ce.source;this._contentLength=Fe.length,this._loaded=0,this._filename=null,this._disableRange=Fe.disableRange||!1,this._rangeChunkSize=Fe.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!Fe.disableStream,this._isRangeSupported=!Fe.disableRange,this._readableStream=null,this._readCapability=new T.PromiseCapability,this._headersCapability=new T.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var Me;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const Ce=this._readableStream.read();return Ce===null?(this._readCapability=new T.PromiseCapability,this.read()):(this._loaded+=Ce.length,(Me=this.onProgress)==null||Me.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(Ce).buffer,done:!1})}cancel(Ce){if(!this._readableStream){this._error(Ce);return}this._readableStream.destroy(Ce)}_error(Ce){this._storedError=Ce,this._readCapability.resolve()}_setReadableStream(Ce){this._readableStream=Ce,Ce.on("readable",()=>{this._readCapability.resolve()}),Ce.on("end",()=>{Ce.destroy(),this._done=!0,this._readCapability.resolve()}),Ce.on("error",Fe=>{this._error(Fe)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new T.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class ae{constructor(Ce){this._url=Ce.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new T.PromiseCapability;const Fe=Ce.source;this._isStreamingSupported=!Fe.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var Me;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const Ce=this._readableStream.read();return Ce===null?(this._readCapability=new T.PromiseCapability,this.read()):(this._loaded+=Ce.length,(Me=this.onProgress)==null||Me.call(this,{loaded:this._loaded}),{value:new Uint8Array(Ce).buffer,done:!1})}cancel(Ce){if(!this._readableStream){this._error(Ce);return}this._readableStream.destroy(Ce)}_error(Ce){this._storedError=Ce,this._readCapability.resolve()}_setReadableStream(Ce){this._readableStream=Ce,Ce.on("readable",()=>{this._readCapability.resolve()}),Ce.on("end",()=>{Ce.destroy(),this._done=!0,this._readCapability.resolve()}),Ce.on("error",Fe=>{this._error(Fe)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function ie(Pe,Ce){return{protocol:Pe.protocol,auth:Pe.auth,host:Pe.hostname,port:Pe.port,path:Pe.path,method:"GET",headers:Ce}}class ce extends te{constructor(Ce){super(Ce);const Fe=Me=>{if(Me.statusCode===404){const Ue=new T.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=Ue,this._headersCapability.reject(Ue);return}this._headersCapability.resolve(),this._setReadableStream(Me);const Ve=Ue=>this._readableStream.headers[Ue.toLowerCase()],{allowRangeRequests:We,suggestedLength:ze}=(0,w.validateRangeRequestCapabilities)({getResponseHeader:Ve,isHttp:Ce.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=We,this._contentLength=ze||this._contentLength,this._filename=(0,w.extractFilenameFromHeader)(Ve)};if(this._request=null,this._url.protocol==="http:"){const Me=require$$5;this._request=Me.request(ie(this._url,Ce.httpHeaders),Fe)}else{const Me=require$$5;this._request=Me.request(ie(this._url,Ce.httpHeaders),Fe)}this._request.on("error",Me=>{this._storedError=Me,this._headersCapability.reject(Me)}),this._request.end()}}class me extends ae{constructor(Ce,Fe,Me){super(Ce),this._httpHeaders={};for(const We in Ce.httpHeaders){const ze=Ce.httpHeaders[We];ze!==void 0&&(this._httpHeaders[We]=ze)}this._httpHeaders.Range=`bytes=${Fe}-${Me-1}`;const Ve=We=>{if(We.statusCode===404){const ze=new T.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=ze;return}this._setReadableStream(We)};if(this._request=null,this._url.protocol==="http:"){const We=require$$5;this._request=We.request(ie(this._url,this._httpHeaders),Ve)}else{const We=require$$5;this._request=We.request(ie(this._url,this._httpHeaders),Ve)}this._request.on("error",We=>{this._storedError=We}),this._request.end()}}class _e extends te{constructor(Ce){super(Ce);let Fe=decodeURIComponent(this._url.path);S.test(this._url.href)&&(Fe=Fe.replace(/^\//,""));const Me=require$$5;Me.lstat(Fe,(Ve,We)=>{if(Ve){Ve.code==="ENOENT"&&(Ve=new T.MissingPDFException(`Missing PDF "${Fe}".`)),this._storedError=Ve,this._headersCapability.reject(Ve);return}this._contentLength=We.size,this._setReadableStream(Me.createReadStream(Fe)),this._headersCapability.resolve()})}}class Re extends ae{constructor(Ce,Fe,Me){super(Ce);let Ve=decodeURIComponent(this._url.path);S.test(this._url.href)&&(Ve=Ve.replace(/^\//,""));const We=require$$5;this._setReadableStream(We.createReadStream(Ve,{start:Fe,end:Me-1}))}}},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SVGGraphics=void 0;var T=v(6),w=v(1);const S={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},I="http://www.w3.org/XML/1998/namespace",H="http://www.w3.org/1999/xlink",te=["butt","round","square"],ae=["miter","round","bevel"],ie=function(We,ze="",Ue=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!Ue)return URL.createObjectURL(new Blob([We],{type:ze}));const je="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let ke=`data:${ze};base64,`;for(let Ne=0,Ge=We.length;Ne<Ge;Ne+=3){const Ie=We[Ne]&255,Le=We[Ne+1]&255,He=We[Ne+2]&255,Ct=Ie>>2,Ze=(Ie&3)<<4|Le>>4,Rt=Ne+1<Ge?(Le&15)<<2|He>>6:64,nt=Ne+2<Ge?He&63:64;ke+=je[Ct]+je[Ze]+je[Rt]+je[nt]}return ke},ce=function(){const We=new Uint8Array([137,80,78,71,13,10,26,10]),ze=12,Ue=new Int32Array(256);for(let He=0;He<256;He++){let Ct=He;for(let Ze=0;Ze<8;Ze++)Ct=Ct&1?3988292384^Ct>>1&2147483647:Ct>>1&2147483647;Ue[He]=Ct}function je(He,Ct,Ze){let Rt=-1;for(let nt=Ct;nt<Ze;nt++){const nr=(Rt^He[nt])&255,Je=Ue[nr];Rt=Rt>>>8^Je}return Rt^-1}function ke(He,Ct,Ze,Rt){let nt=Rt;const nr=Ct.length;Ze[nt]=nr>>24&255,Ze[nt+1]=nr>>16&255,Ze[nt+2]=nr>>8&255,Ze[nt+3]=nr&255,nt+=4,Ze[nt]=He.charCodeAt(0)&255,Ze[nt+1]=He.charCodeAt(1)&255,Ze[nt+2]=He.charCodeAt(2)&255,Ze[nt+3]=He.charCodeAt(3)&255,nt+=4,Ze.set(Ct,nt),nt+=Ct.length;const Je=je(Ze,Rt+4,nt);Ze[nt]=Je>>24&255,Ze[nt+1]=Je>>16&255,Ze[nt+2]=Je>>8&255,Ze[nt+3]=Je&255}function Ne(He,Ct,Ze){let Rt=1,nt=0;for(let nr=Ct;nr<Ze;++nr)Rt=(Rt+(He[nr]&255))%65521,nt=(nt+Rt)%65521;return nt<<16|Rt}function Ge(He){if(!w.isNodeJS)return Ie(He);try{const Ct=parseInt(process.versions.node)>=8?He:Buffer.from(He),Ze=require$$5.deflateSync(Ct,{level:9});return Ze instanceof Uint8Array?Ze:new Uint8Array(Ze)}catch(Ct){(0,w.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+Ct)}return Ie(He)}function Ie(He){let Ct=He.length;const Ze=65535,Rt=Math.ceil(Ct/Ze),nt=new Uint8Array(2+Ct+Rt*5+4);let nr=0;nt[nr++]=120,nt[nr++]=156;let Je=0;for(;Ct>Ze;)nt[nr++]=0,nt[nr++]=255,nt[nr++]=255,nt[nr++]=0,nt[nr++]=0,nt.set(He.subarray(Je,Je+Ze),nr),nr+=Ze,Je+=Ze,Ct-=Ze;nt[nr++]=1,nt[nr++]=Ct&255,nt[nr++]=Ct>>8&255,nt[nr++]=~Ct&65535&255,nt[nr++]=(~Ct&65535)>>8&255,nt.set(He.subarray(Je),nr),nr+=He.length-Je;const Wt=Ne(He,0,He.length);return nt[nr++]=Wt>>24&255,nt[nr++]=Wt>>16&255,nt[nr++]=Wt>>8&255,nt[nr++]=Wt&255,nt}function Le(He,Ct,Ze,Rt){const nt=He.width,nr=He.height;let Je,Wt,Lt;const qe=He.data;switch(Ct){case w.ImageKind.GRAYSCALE_1BPP:Wt=0,Je=1,Lt=nt+7>>3;break;case w.ImageKind.RGB_24BPP:Wt=2,Je=8,Lt=nt*3;break;case w.ImageKind.RGBA_32BPP:Wt=6,Je=8,Lt=nt*4;break;default:throw new Error("invalid format")}const $e=new Uint8Array((1+Lt)*nr);let Be=0,Xe=0;for(let hr=0;hr<nr;++hr)$e[Be++]=0,$e.set(qe.subarray(Xe,Xe+Lt),Be),Xe+=Lt,Be+=Lt;if(Ct===w.ImageKind.GRAYSCALE_1BPP&&Rt){Be=0;for(let hr=0;hr<nr;hr++){Be++;for(let pt=0;pt<Lt;pt++)$e[Be++]^=255}}const rt=new Uint8Array([nt>>24&255,nt>>16&255,nt>>8&255,nt&255,nr>>24&255,nr>>16&255,nr>>8&255,nr&255,Je,Wt,0,0,0]),Qe=Ge($e),vt=We.length+ze*3+rt.length+Qe.length,Dt=new Uint8Array(vt);let Ut=0;return Dt.set(We,Ut),Ut+=We.length,ke("IHDR",rt,Dt,Ut),Ut+=ze+rt.length,ke("IDATA",Qe,Dt,Ut),Ut+=ze+Qe.length,ke("IEND",new Uint8Array(0),Dt,Ut),ie(Dt,"image/png",Ze)}return function(Ct,Ze,Rt){const nt=Ct.kind===void 0?w.ImageKind.GRAYSCALE_1BPP:Ct.kind;return Le(Ct,nt,Ze,Rt)}}();class me{constructor(){this.fontSizeScale=1,this.fontWeight=S.fontWeight,this.fontSize=0,this.textMatrix=w.IDENTITY_MATRIX,this.fontMatrix=w.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=w.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=S.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(ze,Ue){this.x=ze,this.y=Ue}}function _e(We){let ze=[];const Ue=[];for(const je of We){if(je.fn==="save"){ze.push({fnId:92,fn:"group",items:[]}),Ue.push(ze),ze=ze.at(-1).items;continue}je.fn==="restore"?ze=Ue.pop():ze.push(je)}return ze}function Re(We){if(Number.isInteger(We))return We.toString();const ze=We.toFixed(10);let Ue=ze.length-1;if(ze[Ue]!=="0")return ze;do Ue--;while(ze[Ue]==="0");return ze.substring(0,ze[Ue]==="."?Ue:Ue+1)}function Pe(We){if(We[4]===0&&We[5]===0){if(We[1]===0&&We[2]===0)return We[0]===1&&We[3]===1?"":`scale(${Re(We[0])} ${Re(We[3])})`;if(We[0]===We[3]&&We[1]===-We[2]){const ze=Math.acos(We[0])*180/Math.PI;return`rotate(${Re(ze)})`}}else if(We[0]===1&&We[1]===0&&We[2]===0&&We[3]===1)return`translate(${Re(We[4])} ${Re(We[5])})`;return`matrix(${Re(We[0])} ${Re(We[1])} ${Re(We[2])} ${Re(We[3])} ${Re(We[4])} ${Re(We[5])})`}let Ce=0,Fe=0,Me=0;class Ve{constructor(ze,Ue,je=!1){(0,T.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new T.DOMSVGFactory,this.current=new me,this.transformMatrix=w.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=ze,this.objs=Ue,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!je,this._operatorIdMapping=[];for(const ke in w.OPS)this._operatorIdMapping[w.OPS[ke]]=ke}getObject(ze,Ue=null){return typeof ze=="string"?ze.startsWith("g_")?this.commonObjs.get(ze):this.objs.get(ze):Ue}save(){this.transformStack.push(this.transformMatrix);const ze=this.current;this.extraStack.push(ze),this.current=ze.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(ze){this.save(),this.executeOpTree(ze),this.restore()}loadDependencies(ze){const Ue=ze.fnArray,je=ze.argsArray;for(let ke=0,Ne=Ue.length;ke<Ne;ke++)if(Ue[ke]===w.OPS.dependency)for(const Ge of je[ke]){const Ie=Ge.startsWith("g_")?this.commonObjs:this.objs,Le=new Promise(He=>{Ie.get(Ge,He)});this.current.dependencies.push(Le)}return Promise.all(this.current.dependencies)}transform(ze,Ue,je,ke,Ne,Ge){const Ie=[ze,Ue,je,ke,Ne,Ge];this.transformMatrix=w.Util.transform(this.transformMatrix,Ie),this.tgrp=null}getSVG(ze,Ue){this.viewport=Ue;const je=this._initialize(Ue);return this.loadDependencies(ze).then(()=>(this.transformMatrix=w.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(ze)),je))}convertOpList(ze){const Ue=this._operatorIdMapping,je=ze.argsArray,ke=ze.fnArray,Ne=[];for(let Ge=0,Ie=ke.length;Ge<Ie;Ge++){const Le=ke[Ge];Ne.push({fnId:Le,fn:Ue[Le],args:je[Ge]})}return _e(Ne)}executeOpTree(ze){for(const Ue of ze){const je=Ue.fn,ke=Ue.fnId,Ne=Ue.args;switch(ke|0){case w.OPS.beginText:this.beginText();break;case w.OPS.dependency:break;case w.OPS.setLeading:this.setLeading(Ne);break;case w.OPS.setLeadingMoveText:this.setLeadingMoveText(Ne[0],Ne[1]);break;case w.OPS.setFont:this.setFont(Ne);break;case w.OPS.showText:this.showText(Ne[0]);break;case w.OPS.showSpacedText:this.showText(Ne[0]);break;case w.OPS.endText:this.endText();break;case w.OPS.moveText:this.moveText(Ne[0],Ne[1]);break;case w.OPS.setCharSpacing:this.setCharSpacing(Ne[0]);break;case w.OPS.setWordSpacing:this.setWordSpacing(Ne[0]);break;case w.OPS.setHScale:this.setHScale(Ne[0]);break;case w.OPS.setTextMatrix:this.setTextMatrix(Ne[0],Ne[1],Ne[2],Ne[3],Ne[4],Ne[5]);break;case w.OPS.setTextRise:this.setTextRise(Ne[0]);break;case w.OPS.setTextRenderingMode:this.setTextRenderingMode(Ne[0]);break;case w.OPS.setLineWidth:this.setLineWidth(Ne[0]);break;case w.OPS.setLineJoin:this.setLineJoin(Ne[0]);break;case w.OPS.setLineCap:this.setLineCap(Ne[0]);break;case w.OPS.setMiterLimit:this.setMiterLimit(Ne[0]);break;case w.OPS.setFillRGBColor:this.setFillRGBColor(Ne[0],Ne[1],Ne[2]);break;case w.OPS.setStrokeRGBColor:this.setStrokeRGBColor(Ne[0],Ne[1],Ne[2]);break;case w.OPS.setStrokeColorN:this.setStrokeColorN(Ne);break;case w.OPS.setFillColorN:this.setFillColorN(Ne);break;case w.OPS.shadingFill:this.shadingFill(Ne[0]);break;case w.OPS.setDash:this.setDash(Ne[0],Ne[1]);break;case w.OPS.setRenderingIntent:this.setRenderingIntent(Ne[0]);break;case w.OPS.setFlatness:this.setFlatness(Ne[0]);break;case w.OPS.setGState:this.setGState(Ne[0]);break;case w.OPS.fill:this.fill();break;case w.OPS.eoFill:this.eoFill();break;case w.OPS.stroke:this.stroke();break;case w.OPS.fillStroke:this.fillStroke();break;case w.OPS.eoFillStroke:this.eoFillStroke();break;case w.OPS.clip:this.clip("nonzero");break;case w.OPS.eoClip:this.clip("evenodd");break;case w.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case w.OPS.paintImageXObject:this.paintImageXObject(Ne[0]);break;case w.OPS.paintInlineImageXObject:this.paintInlineImageXObject(Ne[0]);break;case w.OPS.paintImageMaskXObject:this.paintImageMaskXObject(Ne[0]);break;case w.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(Ne[0],Ne[1]);break;case w.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case w.OPS.closePath:this.closePath();break;case w.OPS.closeStroke:this.closeStroke();break;case w.OPS.closeFillStroke:this.closeFillStroke();break;case w.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case w.OPS.nextLine:this.nextLine();break;case w.OPS.transform:this.transform(Ne[0],Ne[1],Ne[2],Ne[3],Ne[4],Ne[5]);break;case w.OPS.constructPath:this.constructPath(Ne[0],Ne[1]);break;case w.OPS.endPath:this.endPath();break;case 92:this.group(Ue.items);break;default:(0,w.warn)(`Unimplemented operator ${je}`);break}}}setWordSpacing(ze){this.current.wordSpacing=ze}setCharSpacing(ze){this.current.charSpacing=ze}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(ze,Ue,je,ke,Ne,Ge){const Ie=this.current;Ie.textMatrix=Ie.lineMatrix=[ze,Ue,je,ke,Ne,Ge],Ie.textMatrixScale=Math.hypot(ze,Ue),Ie.x=Ie.lineX=0,Ie.y=Ie.lineY=0,Ie.xcoords=[],Ie.ycoords=[],Ie.tspan=this.svgFactory.createElement("svg:tspan"),Ie.tspan.setAttributeNS(null,"font-family",Ie.fontFamily),Ie.tspan.setAttributeNS(null,"font-size",`${Re(Ie.fontSize)}px`),Ie.tspan.setAttributeNS(null,"y",Re(-Ie.y)),Ie.txtElement=this.svgFactory.createElement("svg:text"),Ie.txtElement.append(Ie.tspan)}beginText(){const ze=this.current;ze.x=ze.lineX=0,ze.y=ze.lineY=0,ze.textMatrix=w.IDENTITY_MATRIX,ze.lineMatrix=w.IDENTITY_MATRIX,ze.textMatrixScale=1,ze.tspan=this.svgFactory.createElement("svg:tspan"),ze.txtElement=this.svgFactory.createElement("svg:text"),ze.txtgrp=this.svgFactory.createElement("svg:g"),ze.xcoords=[],ze.ycoords=[]}moveText(ze,Ue){const je=this.current;je.x=je.lineX+=ze,je.y=je.lineY+=Ue,je.xcoords=[],je.ycoords=[],je.tspan=this.svgFactory.createElement("svg:tspan"),je.tspan.setAttributeNS(null,"font-family",je.fontFamily),je.tspan.setAttributeNS(null,"font-size",`${Re(je.fontSize)}px`),je.tspan.setAttributeNS(null,"y",Re(-je.y))}showText(ze){const Ue=this.current,je=Ue.font,ke=Ue.fontSize;if(ke===0)return;const Ne=Ue.fontSizeScale,Ge=Ue.charSpacing,Ie=Ue.wordSpacing,Le=Ue.fontDirection,He=Ue.textHScale*Le,Ct=je.vertical,Ze=Ct?1:-1,Rt=je.defaultVMetrics,nt=ke*Ue.fontMatrix[0];let nr=0;for(const Lt of ze){if(Lt===null){nr+=Le*Ie;continue}else if(typeof Lt=="number"){nr+=Ze*Lt*ke/1e3;continue}const qe=(Lt.isSpace?Ie:0)+Ge,$e=Lt.fontChar;let Be,Xe,rt=Lt.width;if(Ct){let vt;const Dt=Lt.vmetric||Rt;vt=Lt.vmetric?Dt[1]:rt*.5,vt=-vt*nt;const Ut=Dt[2]*nt;rt=Dt?-Dt[0]:rt,Be=vt/Ne,Xe=(nr+Ut)/Ne}else Be=nr/Ne,Xe=0;(Lt.isInFont||je.missingFile)&&(Ue.xcoords.push(Ue.x+Be),Ct&&Ue.ycoords.push(-Ue.y+Xe),Ue.tspan.textContent+=$e);const Qe=Ct?rt*nt-qe*Le:rt*nt+qe*Le;nr+=Qe}Ue.tspan.setAttributeNS(null,"x",Ue.xcoords.map(Re).join(" ")),Ct?Ue.tspan.setAttributeNS(null,"y",Ue.ycoords.map(Re).join(" ")):Ue.tspan.setAttributeNS(null,"y",Re(-Ue.y)),Ct?Ue.y-=nr:Ue.x+=nr*He,Ue.tspan.setAttributeNS(null,"font-family",Ue.fontFamily),Ue.tspan.setAttributeNS(null,"font-size",`${Re(Ue.fontSize)}px`),Ue.fontStyle!==S.fontStyle&&Ue.tspan.setAttributeNS(null,"font-style",Ue.fontStyle),Ue.fontWeight!==S.fontWeight&&Ue.tspan.setAttributeNS(null,"font-weight",Ue.fontWeight);const Je=Ue.textRenderingMode&w.TextRenderingMode.FILL_STROKE_MASK;if(Je===w.TextRenderingMode.FILL||Je===w.TextRenderingMode.FILL_STROKE?(Ue.fillColor!==S.fillColor&&Ue.tspan.setAttributeNS(null,"fill",Ue.fillColor),Ue.fillAlpha<1&&Ue.tspan.setAttributeNS(null,"fill-opacity",Ue.fillAlpha)):Ue.textRenderingMode===w.TextRenderingMode.ADD_TO_PATH?Ue.tspan.setAttributeNS(null,"fill","transparent"):Ue.tspan.setAttributeNS(null,"fill","none"),Je===w.TextRenderingMode.STROKE||Je===w.TextRenderingMode.FILL_STROKE){const Lt=1/(Ue.textMatrixScale||1);this._setStrokeAttributes(Ue.tspan,Lt)}let Wt=Ue.textMatrix;Ue.textRise!==0&&(Wt=Wt.slice(),Wt[5]+=Ue.textRise),Ue.txtElement.setAttributeNS(null,"transform",`${Pe(Wt)} scale(${Re(He)}, -1)`),Ue.txtElement.setAttributeNS(I,"xml:space","preserve"),Ue.txtElement.append(Ue.tspan),Ue.txtgrp.append(Ue.txtElement),this._ensureTransformGroup().append(Ue.txtElement)}setLeadingMoveText(ze,Ue){this.setLeading(-Ue),this.moveText(ze,Ue)}addFontStyle(ze){if(!ze.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const Ue=ie(ze.data,ze.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${ze.loadedName}"; src: url(${Ue}); }
`}setFont(ze){const Ue=this.current,je=this.commonObjs.get(ze[0]);let ke=ze[1];Ue.font=je,this.embedFonts&&!je.missingFile&&!this.embeddedFonts[je.loadedName]&&(this.addFontStyle(je),this.embeddedFonts[je.loadedName]=je),Ue.fontMatrix=je.fontMatrix||w.FONT_IDENTITY_MATRIX;let Ne="normal";je.black?Ne="900":je.bold&&(Ne="bold");const Ge=je.italic?"italic":"normal";ke<0?(ke=-ke,Ue.fontDirection=-1):Ue.fontDirection=1,Ue.fontSize=ke,Ue.fontFamily=je.loadedName,Ue.fontWeight=Ne,Ue.fontStyle=Ge,Ue.tspan=this.svgFactory.createElement("svg:tspan"),Ue.tspan.setAttributeNS(null,"y",Re(-Ue.y)),Ue.xcoords=[],Ue.ycoords=[]}endText(){var Ue;const ze=this.current;ze.textRenderingMode&w.TextRenderingMode.ADD_TO_PATH_FLAG&&((Ue=ze.txtElement)!=null&&Ue.hasChildNodes())&&(ze.element=ze.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(ze){ze>0&&(this.current.lineWidth=ze)}setLineCap(ze){this.current.lineCap=te[ze]}setLineJoin(ze){this.current.lineJoin=ae[ze]}setMiterLimit(ze){this.current.miterLimit=ze}setStrokeAlpha(ze){this.current.strokeAlpha=ze}setStrokeRGBColor(ze,Ue,je){this.current.strokeColor=w.Util.makeHexColor(ze,Ue,je)}setFillAlpha(ze){this.current.fillAlpha=ze}setFillRGBColor(ze,Ue,je){this.current.fillColor=w.Util.makeHexColor(ze,Ue,je),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(ze){this.current.strokeColor=this._makeColorN_Pattern(ze)}setFillColorN(ze){this.current.fillColor=this._makeColorN_Pattern(ze)}shadingFill(ze){const{width:Ue,height:je}=this.viewport,ke=w.Util.inverseTransform(this.transformMatrix),[Ne,Ge,Ie,Le]=w.Util.getAxialAlignedBoundingBox([0,0,Ue,je],ke),He=this.svgFactory.createElement("svg:rect");He.setAttributeNS(null,"x",Ne),He.setAttributeNS(null,"y",Ge),He.setAttributeNS(null,"width",Ie-Ne),He.setAttributeNS(null,"height",Le-Ge),He.setAttributeNS(null,"fill",this._makeShadingPattern(ze)),this.current.fillAlpha<1&&He.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(He)}_makeColorN_Pattern(ze){return ze[0]==="TilingPattern"?this._makeTilingPattern(ze):this._makeShadingPattern(ze)}_makeTilingPattern(ze){const Ue=ze[1],je=ze[2],ke=ze[3]||w.IDENTITY_MATRIX,[Ne,Ge,Ie,Le]=ze[4],He=ze[5],Ct=ze[6],Ze=ze[7],Rt=`shading${Me++}`,[nt,nr,Je,Wt]=w.Util.normalizeRect([...w.Util.applyTransform([Ne,Ge],ke),...w.Util.applyTransform([Ie,Le],ke)]),[Lt,qe]=w.Util.singularValueDecompose2dScale(ke),$e=He*Lt,Be=Ct*qe,Xe=this.svgFactory.createElement("svg:pattern");Xe.setAttributeNS(null,"id",Rt),Xe.setAttributeNS(null,"patternUnits","userSpaceOnUse"),Xe.setAttributeNS(null,"width",$e),Xe.setAttributeNS(null,"height",Be),Xe.setAttributeNS(null,"x",`${nt}`),Xe.setAttributeNS(null,"y",`${nr}`);const rt=this.svg,Qe=this.transformMatrix,vt=this.current.fillColor,Dt=this.current.strokeColor,Ut=this.svgFactory.create(Je-nt,Wt-nr);if(this.svg=Ut,this.transformMatrix=ke,Ze===2){const hr=w.Util.makeHexColor(...Ue);this.current.fillColor=hr,this.current.strokeColor=hr}return this.executeOpTree(this.convertOpList(je)),this.svg=rt,this.transformMatrix=Qe,this.current.fillColor=vt,this.current.strokeColor=Dt,Xe.append(Ut.childNodes[0]),this.defs.append(Xe),`url(#${Rt})`}_makeShadingPattern(ze){switch(typeof ze=="string"&&(ze=this.objs.get(ze)),ze[0]){case"RadialAxial":const Ue=`shading${Me++}`,je=ze[3];let ke;switch(ze[1]){case"axial":const Ne=ze[4],Ge=ze[5];ke=this.svgFactory.createElement("svg:linearGradient"),ke.setAttributeNS(null,"id",Ue),ke.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),ke.setAttributeNS(null,"x1",Ne[0]),ke.setAttributeNS(null,"y1",Ne[1]),ke.setAttributeNS(null,"x2",Ge[0]),ke.setAttributeNS(null,"y2",Ge[1]);break;case"radial":const Ie=ze[4],Le=ze[5],He=ze[6],Ct=ze[7];ke=this.svgFactory.createElement("svg:radialGradient"),ke.setAttributeNS(null,"id",Ue),ke.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),ke.setAttributeNS(null,"cx",Le[0]),ke.setAttributeNS(null,"cy",Le[1]),ke.setAttributeNS(null,"r",Ct),ke.setAttributeNS(null,"fx",Ie[0]),ke.setAttributeNS(null,"fy",Ie[1]),ke.setAttributeNS(null,"fr",He);break;default:throw new Error(`Unknown RadialAxial type: ${ze[1]}`)}for(const Ne of je){const Ge=this.svgFactory.createElement("svg:stop");Ge.setAttributeNS(null,"offset",Ne[0]),Ge.setAttributeNS(null,"stop-color",Ne[1]),ke.append(Ge)}return this.defs.append(ke),`url(#${Ue})`;case"Mesh":return(0,w.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${ze[0]}`)}}setDash(ze,Ue){this.current.dashArray=ze,this.current.dashPhase=Ue}constructPath(ze,Ue){const je=this.current;let ke=je.x,Ne=je.y,Ge=[],Ie=0;for(const Le of ze)switch(Le|0){case w.OPS.rectangle:ke=Ue[Ie++],Ne=Ue[Ie++];const He=Ue[Ie++],Ct=Ue[Ie++],Ze=ke+He,Rt=Ne+Ct;Ge.push("M",Re(ke),Re(Ne),"L",Re(Ze),Re(Ne),"L",Re(Ze),Re(Rt),"L",Re(ke),Re(Rt),"Z");break;case w.OPS.moveTo:ke=Ue[Ie++],Ne=Ue[Ie++],Ge.push("M",Re(ke),Re(Ne));break;case w.OPS.lineTo:ke=Ue[Ie++],Ne=Ue[Ie++],Ge.push("L",Re(ke),Re(Ne));break;case w.OPS.curveTo:ke=Ue[Ie+4],Ne=Ue[Ie+5],Ge.push("C",Re(Ue[Ie]),Re(Ue[Ie+1]),Re(Ue[Ie+2]),Re(Ue[Ie+3]),Re(ke),Re(Ne)),Ie+=6;break;case w.OPS.curveTo2:Ge.push("C",Re(ke),Re(Ne),Re(Ue[Ie]),Re(Ue[Ie+1]),Re(Ue[Ie+2]),Re(Ue[Ie+3])),ke=Ue[Ie+2],Ne=Ue[Ie+3],Ie+=4;break;case w.OPS.curveTo3:ke=Ue[Ie+2],Ne=Ue[Ie+3],Ge.push("C",Re(Ue[Ie]),Re(Ue[Ie+1]),Re(ke),Re(Ne),Re(ke),Re(Ne)),Ie+=4;break;case w.OPS.closePath:Ge.push("Z");break}Ge=Ge.join(" "),je.path&&ze.length>0&&ze[0]!==w.OPS.rectangle&&ze[0]!==w.OPS.moveTo?Ge=je.path.getAttributeNS(null,"d")+Ge:(je.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(je.path)),je.path.setAttributeNS(null,"d",Ge),je.path.setAttributeNS(null,"fill","none"),je.element=je.path,je.setCurrentPoint(ke,Ne)}endPath(){const ze=this.current;if(ze.path=null,!this.pendingClip)return;if(!ze.element){this.pendingClip=null;return}const Ue=`clippath${Ce++}`,je=this.svgFactory.createElement("svg:clipPath");je.setAttributeNS(null,"id",Ue),je.setAttributeNS(null,"transform",Pe(this.transformMatrix));const ke=ze.element.cloneNode(!0);if(this.pendingClip==="evenodd"?ke.setAttributeNS(null,"clip-rule","evenodd"):ke.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,je.append(ke),this.defs.append(je),ze.activeClipUrl){ze.clipGroup=null;for(const Ne of this.extraStack)Ne.clipGroup=null;je.setAttributeNS(null,"clip-path",ze.activeClipUrl)}ze.activeClipUrl=`url(#${Ue})`,this.tgrp=null}clip(ze){this.pendingClip=ze}closePath(){const ze=this.current;if(ze.path){const Ue=`${ze.path.getAttributeNS(null,"d")}Z`;ze.path.setAttributeNS(null,"d",Ue)}}setLeading(ze){this.current.leading=-ze}setTextRise(ze){this.current.textRise=ze}setTextRenderingMode(ze){this.current.textRenderingMode=ze}setHScale(ze){this.current.textHScale=ze/100}setRenderingIntent(ze){}setFlatness(ze){}setGState(ze){for(const[Ue,je]of ze)switch(Ue){case"LW":this.setLineWidth(je);break;case"LC":this.setLineCap(je);break;case"LJ":this.setLineJoin(je);break;case"ML":this.setMiterLimit(je);break;case"D":this.setDash(je[0],je[1]);break;case"RI":this.setRenderingIntent(je);break;case"FL":this.setFlatness(je);break;case"Font":this.setFont(je);break;case"CA":this.setStrokeAlpha(je);break;case"ca":this.setFillAlpha(je);break;default:(0,w.warn)(`Unimplemented graphic state operator ${Ue}`);break}}fill(){const ze=this.current;ze.element&&(ze.element.setAttributeNS(null,"fill",ze.fillColor),ze.element.setAttributeNS(null,"fill-opacity",ze.fillAlpha),this.endPath())}stroke(){const ze=this.current;ze.element&&(this._setStrokeAttributes(ze.element),ze.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(ze,Ue=1){const je=this.current;let ke=je.dashArray;Ue!==1&&ke.length>0&&(ke=ke.map(function(Ne){return Ue*Ne})),ze.setAttributeNS(null,"stroke",je.strokeColor),ze.setAttributeNS(null,"stroke-opacity",je.strokeAlpha),ze.setAttributeNS(null,"stroke-miterlimit",Re(je.miterLimit)),ze.setAttributeNS(null,"stroke-linecap",je.lineCap),ze.setAttributeNS(null,"stroke-linejoin",je.lineJoin),ze.setAttributeNS(null,"stroke-width",Re(Ue*je.lineWidth)+"px"),ze.setAttributeNS(null,"stroke-dasharray",ke.map(Re).join(" ")),ze.setAttributeNS(null,"stroke-dashoffset",Re(Ue*je.dashPhase)+"px")}eoFill(){var ze;(ze=this.current.element)==null||ze.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var ze;(ze=this.current.element)==null||ze.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const ze=this.svgFactory.createElement("svg:rect");ze.setAttributeNS(null,"x","0"),ze.setAttributeNS(null,"y","0"),ze.setAttributeNS(null,"width","1px"),ze.setAttributeNS(null,"height","1px"),ze.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(ze)}paintImageXObject(ze){const Ue=this.getObject(ze);if(!Ue){(0,w.warn)(`Dependent image with object ID ${ze} is not ready yet`);return}this.paintInlineImageXObject(Ue)}paintInlineImageXObject(ze,Ue){const je=ze.width,ke=ze.height,Ne=ce(ze,this.forceDataSchema,!!Ue),Ge=this.svgFactory.createElement("svg:rect");Ge.setAttributeNS(null,"x","0"),Ge.setAttributeNS(null,"y","0"),Ge.setAttributeNS(null,"width",Re(je)),Ge.setAttributeNS(null,"height",Re(ke)),this.current.element=Ge,this.clip("nonzero");const Ie=this.svgFactory.createElement("svg:image");Ie.setAttributeNS(H,"xlink:href",Ne),Ie.setAttributeNS(null,"x","0"),Ie.setAttributeNS(null,"y",Re(-ke)),Ie.setAttributeNS(null,"width",Re(je)+"px"),Ie.setAttributeNS(null,"height",Re(ke)+"px"),Ie.setAttributeNS(null,"transform",`scale(${Re(1/je)} ${Re(-1/ke)})`),Ue?Ue.append(Ie):this._ensureTransformGroup().append(Ie)}paintImageMaskXObject(ze){const Ue=this.getObject(ze.data,ze);if(Ue.bitmap){(0,w.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const je=this.current,ke=Ue.width,Ne=Ue.height,Ge=je.fillColor;je.maskId=`mask${Fe++}`;const Ie=this.svgFactory.createElement("svg:mask");Ie.setAttributeNS(null,"id",je.maskId);const Le=this.svgFactory.createElement("svg:rect");Le.setAttributeNS(null,"x","0"),Le.setAttributeNS(null,"y","0"),Le.setAttributeNS(null,"width",Re(ke)),Le.setAttributeNS(null,"height",Re(Ne)),Le.setAttributeNS(null,"fill",Ge),Le.setAttributeNS(null,"mask",`url(#${je.maskId})`),this.defs.append(Ie),this._ensureTransformGroup().append(Le),this.paintInlineImageXObject(Ue,Ie)}paintFormXObjectBegin(ze,Ue){if(Array.isArray(ze)&&ze.length===6&&this.transform(ze[0],ze[1],ze[2],ze[3],ze[4],ze[5]),Ue){const je=Ue[2]-Ue[0],ke=Ue[3]-Ue[1],Ne=this.svgFactory.createElement("svg:rect");Ne.setAttributeNS(null,"x",Ue[0]),Ne.setAttributeNS(null,"y",Ue[1]),Ne.setAttributeNS(null,"width",Re(je)),Ne.setAttributeNS(null,"height",Re(ke)),this.current.element=Ne,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(ze){const Ue=this.svgFactory.create(ze.width,ze.height),je=this.svgFactory.createElement("svg:defs");Ue.append(je),this.defs=je;const ke=this.svgFactory.createElement("svg:g");return ke.setAttributeNS(null,"transform",Pe(ze.transform)),Ue.append(ke),this.svg=ke,Ue}_ensureClipGroup(){if(!this.current.clipGroup){const ze=this.svgFactory.createElement("svg:g");ze.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(ze),this.current.clipGroup=ze}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",Pe(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}r.SVGGraphics=Ve},(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.XfaText=void 0;class v{static textContent(w){const S=[],I={items:S,styles:Object.create(null)};function H(te){var ce;if(!te)return;let ae=null;const ie=te.name;if(ie==="#text")ae=te.value;else if(v.shouldBuildText(ie))(ce=te==null?void 0:te.attributes)!=null&&ce.textContent?ae=te.attributes.textContent:te.value&&(ae=te.value);else return;if(ae!==null&&S.push({str:ae}),!!te.children)for(const me of te.children)H(me)}return H(w),I}static shouldBuildText(w){return!(w==="textarea"||w==="input"||w==="option"||w==="select")}}r.XfaText=v},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TextLayerRenderTask=void 0,r.renderTextLayer=Pe,r.updateTextLayer=Ce;var T=v(1),w=v(6);const S=1e5,I=30,H=.8,te=new Map;function ae(Fe,Me){let Ve;if(Me&&T.FeatureTest.isOffscreenCanvasSupported)Ve=new OffscreenCanvas(Fe,Fe).getContext("2d",{alpha:!1});else{const We=document.createElement("canvas");We.width=We.height=Fe,Ve=We.getContext("2d",{alpha:!1})}return Ve}function ie(Fe,Me){const Ve=te.get(Fe);if(Ve)return Ve;const We=ae(I,Me);We.font=`${I}px ${Fe}`;const ze=We.measureText("");let Ue=ze.fontBoundingBoxAscent,je=Math.abs(ze.fontBoundingBoxDescent);if(Ue){const Ne=Ue/(Ue+je);return te.set(Fe,Ne),We.canvas.width=We.canvas.height=0,Ne}We.strokeStyle="red",We.clearRect(0,0,I,I),We.strokeText("g",0,0);let ke=We.getImageData(0,0,I,I).data;je=0;for(let Ne=ke.length-1-3;Ne>=0;Ne-=4)if(ke[Ne]>0){je=Math.ceil(Ne/4/I);break}We.clearRect(0,0,I,I),We.strokeText("A",0,I),ke=We.getImageData(0,0,I,I).data,Ue=0;for(let Ne=0,Ge=ke.length;Ne<Ge;Ne+=4)if(ke[Ne]>0){Ue=I-Math.floor(Ne/4/I);break}if(We.canvas.width=We.canvas.height=0,Ue){const Ne=Ue/(Ue+je);return te.set(Fe,Ne),Ne}return te.set(Fe,H),H}function ce(Fe,Me,Ve){const We=document.createElement("span"),ze={angle:0,canvasWidth:0,hasText:Me.str!=="",hasEOL:Me.hasEOL,fontSize:0};Fe._textDivs.push(We);const Ue=T.Util.transform(Fe._transform,Me.transform);let je=Math.atan2(Ue[1],Ue[0]);const ke=Ve[Me.fontName];ke.vertical&&(je+=Math.PI/2);const Ne=Math.hypot(Ue[2],Ue[3]),Ge=Ne*ie(ke.fontFamily,Fe._isOffscreenCanvasSupported);let Ie,Le;je===0?(Ie=Ue[4],Le=Ue[5]-Ge):(Ie=Ue[4]+Ge*Math.sin(je),Le=Ue[5]-Ge*Math.cos(je));const He="calc(var(--scale-factor)*",Ct=We.style;Fe._container===Fe._rootContainer?(Ct.left=`${(100*Ie/Fe._pageWidth).toFixed(2)}%`,Ct.top=`${(100*Le/Fe._pageHeight).toFixed(2)}%`):(Ct.left=`${He}${Ie.toFixed(2)}px)`,Ct.top=`${He}${Le.toFixed(2)}px)`),Ct.fontSize=`${He}${Ne.toFixed(2)}px)`,Ct.fontFamily=ke.fontFamily,ze.fontSize=Ne,We.setAttribute("role","presentation"),We.textContent=Me.str,We.dir=Me.dir,Fe._fontInspectorEnabled&&(We.dataset.fontName=Me.fontName),je!==0&&(ze.angle=je*(180/Math.PI));let Ze=!1;if(Me.str.length>1)Ze=!0;else if(Me.str!==" "&&Me.transform[0]!==Me.transform[3]){const Rt=Math.abs(Me.transform[0]),nt=Math.abs(Me.transform[3]);Rt!==nt&&Math.max(Rt,nt)/Math.min(Rt,nt)>1.5&&(Ze=!0)}Ze&&(ze.canvasWidth=ke.vertical?Me.height:Me.width),Fe._textDivProperties.set(We,ze),Fe._isReadableStream&&Fe._layoutText(We)}function me(Fe){const{div:Me,scale:Ve,properties:We,ctx:ze,prevFontSize:Ue,prevFontFamily:je}=Fe,{style:ke}=Me;let Ne="";if(We.canvasWidth!==0&&We.hasText){const{fontFamily:Ge}=ke,{canvasWidth:Ie,fontSize:Le}=We;(Ue!==Le||je!==Ge)&&(ze.font=`${Le*Ve}px ${Ge}`,Fe.prevFontSize=Le,Fe.prevFontFamily=Ge);const{width:He}=ze.measureText(Me.textContent);He>0&&(Ne=`scaleX(${Ie*Ve/He})`)}We.angle!==0&&(Ne=`rotate(${We.angle}deg) ${Ne}`),Ne.length>0&&(ke.transform=Ne)}function _e(Fe){if(Fe._canceled)return;const Me=Fe._textDivs,Ve=Fe._capability;if(Me.length>S){Ve.resolve();return}if(!Fe._isReadableStream)for(const ze of Me)Fe._layoutText(ze);Ve.resolve()}class Re{constructor({textContentSource:Me,container:Ve,viewport:We,textDivs:ze,textDivProperties:Ue,textContentItemsStr:je,isOffscreenCanvasSupported:ke}){var He;this._textContentSource=Me,this._isReadableStream=Me instanceof ReadableStream,this._container=this._rootContainer=Ve,this._textDivs=ze||[],this._textContentItemsStr=je||[],this._isOffscreenCanvasSupported=ke,this._fontInspectorEnabled=!!((He=globalThis.FontInspector)!=null&&He.enabled),this._reader=null,this._textDivProperties=Ue||new WeakMap,this._canceled=!1,this._capability=new T.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:We.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:ae(0,ke)};const{pageWidth:Ne,pageHeight:Ge,pageX:Ie,pageY:Le}=We.rawDims;this._transform=[1,0,0,-1,-Ie,Le+Ge],this._pageWidth=Ne,this._pageHeight=Ge,(0,w.setLayerDimensions)(Ve,We),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new T.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new T.AbortException("TextLayer task cancelled."))}_processItems(Me,Ve){for(const We of Me){if(We.str===void 0){if(We.type==="beginMarkedContentProps"||We.type==="beginMarkedContent"){const ze=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),We.id!==null&&this._container.setAttribute("id",`${We.id}`),ze.append(this._container)}else We.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(We.str),ce(this,We,Ve)}}_layoutText(Me){const Ve=this._layoutTextParams.properties=this._textDivProperties.get(Me);if(this._layoutTextParams.div=Me,me(this._layoutTextParams),Ve.hasText&&this._container.append(Me),Ve.hasEOL){const We=document.createElement("br");We.setAttribute("role","presentation"),this._container.append(We)}}_render(){const Me=new T.PromiseCapability;let Ve=Object.create(null);if(this._isReadableStream){const We=()=>{this._reader.read().then(({value:ze,done:Ue})=>{if(Ue){Me.resolve();return}Object.assign(Ve,ze.styles),this._processItems(ze.items,Ve),We()},Me.reject)};this._reader=this._textContentSource.getReader(),We()}else if(this._textContentSource){const{items:We,styles:ze}=this._textContentSource;this._processItems(We,ze),Me.resolve()}else throw new Error('No "textContentSource" parameter specified.');Me.promise.then(()=>{Ve=null,_e(this)},this._capability.reject)}}r.TextLayerRenderTask=Re;function Pe(Fe){!Fe.textContentSource&&(Fe.textContent||Fe.textContentStream)&&((0,w.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),Fe.textContentSource=Fe.textContent||Fe.textContentStream);const{container:Me,viewport:Ve}=Fe,We=getComputedStyle(Me),ze=We.getPropertyValue("visibility"),Ue=parseFloat(We.getPropertyValue("--scale-factor"));ze==="visible"&&(!Ue||Math.abs(Ue-Ve.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const je=new Re(Fe);return je._render(),je}function Ce({container:Fe,viewport:Me,textDivs:Ve,textDivProperties:We,isOffscreenCanvasSupported:ze,mustRotate:Ue=!0,mustRescale:je=!0}){if(Ue&&(0,w.setLayerDimensions)(Fe,{rotation:Me.rotation}),je){const ke=ae(0,ze),Ge={prevFontSize:null,prevFontFamily:null,div:null,scale:Me.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:ke};for(const Ie of Ve)Ge.properties=We.get(Ie),Ge.div=Ie,me(Ge)}}},(E,r,v)=>{var ie,ce,me,_e,Re,Pe,Ce,Fe,Me,Ve,We,la,In,ua,ha;Object.defineProperty(r,"__esModule",{value:!0}),r.AnnotationEditorLayer=void 0;var T=v(1),w=v(4),S=v(28),I=v(33),H=v(6),te=v(34);const Ne=class Ne{constructor({uiManager:Ie,pageIndex:Le,div:He,accessibilityManager:Ct,annotationLayer:Ze,viewport:Rt,l10n:nt}){Tr(this,We);Tr(this,ie);Tr(this,ce,!1);Tr(this,me,null);Tr(this,_e,this.pointerup.bind(this));Tr(this,Re,this.pointerdown.bind(this));Tr(this,Pe,new Map);Tr(this,Ce,!1);Tr(this,Fe,!1);Tr(this,Me,!1);Tr(this,Ve);const nr=[S.FreeTextEditor,I.InkEditor,te.StampEditor];if(!Ne._initialized){Ne._initialized=!0;for(const Je of nr)Je.initialize(nt)}Ie.registerEditorTypes(nr),Ar(this,Ve,Ie),this.pageIndex=Le,this.div=He,Ar(this,ie,Ct),Ar(this,me,Ze),this.viewport=Rt,Ye(this,Ve).addLayer(this)}get isEmpty(){return Ye(this,Pe).size===0}updateToolbar(Ie){Ye(this,Ve).updateToolbar(Ie)}updateMode(Ie=Ye(this,Ve).getMode()){fr(this,We,ha).call(this),Ie===T.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),Ie!==T.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",Ie===T.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",Ie===T.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",Ie===T.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(Ie){if(!Ie&&Ye(this,Ve).getMode()!==T.AnnotationEditorType.INK)return;if(!Ie){for(const He of Ye(this,Pe).values())if(He.isEmpty()){He.setInBackground();return}}fr(this,We,In).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(Ie){Ye(this,Ve).setEditingState(Ie)}addCommands(Ie){Ye(this,Ve).addCommands(Ie)}enable(){this.div.style.pointerEvents="auto";const Ie=new Set;for(const He of Ye(this,Pe).values())He.enableEditing(),He.annotationElementId&&Ie.add(He.annotationElementId);if(!Ye(this,me))return;const Le=Ye(this,me).getEditableAnnotations();for(const He of Le){if(He.hide(),Ye(this,Ve).isDeletedAnnotationElement(He.data.id)||Ie.has(He.data.id))continue;const Ct=this.deserialize(He);Ct&&(this.addOrRebuild(Ct),Ct.enableEditing())}}disable(){var Le;Ar(this,Me,!0),this.div.style.pointerEvents="none";const Ie=new Set;for(const He of Ye(this,Pe).values()){if(He.disableEditing(),!He.annotationElementId||He.serialize()!==null){Ie.add(He.annotationElementId);continue}(Le=this.getEditableAnnotation(He.annotationElementId))==null||Le.show(),He.remove()}if(Ye(this,me)){const He=Ye(this,me).getEditableAnnotations();for(const Ct of He){const{id:Ze}=Ct.data;Ie.has(Ze)||Ye(this,Ve).isDeletedAnnotationElement(Ze)||Ct.show()}}fr(this,We,ha).call(this),this.isEmpty&&(this.div.hidden=!0),Ar(this,Me,!1)}getEditableAnnotation(Ie){var Le;return((Le=Ye(this,me))==null?void 0:Le.getEditableAnnotation(Ie))||null}setActiveEditor(Ie){Ye(this,Ve).getActive()!==Ie&&Ye(this,Ve).setActiveEditor(Ie)}enableClick(){this.div.addEventListener("pointerdown",Ye(this,Re)),this.div.addEventListener("pointerup",Ye(this,_e))}disableClick(){this.div.removeEventListener("pointerdown",Ye(this,Re)),this.div.removeEventListener("pointerup",Ye(this,_e))}attach(Ie){Ye(this,Pe).set(Ie.id,Ie);const{annotationElementId:Le}=Ie;Le&&Ye(this,Ve).isDeletedAnnotationElement(Le)&&Ye(this,Ve).removeDeletedAnnotationElement(Ie)}detach(Ie){var Le;Ye(this,Pe).delete(Ie.id),(Le=Ye(this,ie))==null||Le.removePointerInTextLayer(Ie.contentDiv),!Ye(this,Me)&&Ie.annotationElementId&&Ye(this,Ve).addDeletedAnnotationElement(Ie)}remove(Ie){this.detach(Ie),Ye(this,Ve).removeEditor(Ie),Ie.div.contains(document.activeElement)&&setTimeout(()=>{Ye(this,Ve).focusMainContainer()},0),Ie.div.remove(),Ie.isAttachedToDOM=!1,Ye(this,Fe)||this.addInkEditorIfNeeded(!1)}changeParent(Ie){var Le;Ie.parent!==this&&(Ie.annotationElementId&&(Ye(this,Ve).addDeletedAnnotationElement(Ie.annotationElementId),w.AnnotationEditor.deleteAnnotationElement(Ie),Ie.annotationElementId=null),this.attach(Ie),(Le=Ie.parent)==null||Le.detach(Ie),Ie.setParent(this),Ie.div&&Ie.isAttachedToDOM&&(Ie.div.remove(),this.div.append(Ie.div)))}add(Ie){if(this.changeParent(Ie),Ye(this,Ve).addEditor(Ie),this.attach(Ie),!Ie.isAttachedToDOM){const Le=Ie.render();this.div.append(Le),Ie.isAttachedToDOM=!0}Ie.fixAndSetPosition(),Ie.onceAdded(),Ye(this,Ve).addToAnnotationStorage(Ie)}moveEditorInDOM(Ie){var He;if(!Ie.isAttachedToDOM)return;const{activeElement:Le}=document;Ie.div.contains(Le)&&(Ie._focusEventsAllowed=!1,setTimeout(()=>{Ie.div.contains(document.activeElement)?Ie._focusEventsAllowed=!0:(Ie.div.addEventListener("focusin",()=>{Ie._focusEventsAllowed=!0},{once:!0}),Le.focus())},0)),Ie._structTreeParentId=(He=Ye(this,ie))==null?void 0:He.moveElementInDOM(this.div,Ie.div,Ie.contentDiv,!0)}addOrRebuild(Ie){Ie.needsToBeRebuilt()?Ie.rebuild():this.add(Ie)}addUndoableEditor(Ie){const Le=()=>Ie._uiManager.rebuild(Ie),He=()=>{Ie.remove()};this.addCommands({cmd:Le,undo:He,mustExec:!1})}getNextId(){return Ye(this,Ve).getId()}pasteEditor(Ie,Le){Ye(this,Ve).updateToolbar(Ie),Ye(this,Ve).updateMode(Ie);const{offsetX:He,offsetY:Ct}=fr(this,We,ua).call(this),Ze=this.getNextId(),Rt=fr(this,We,la).call(this,{parent:this,id:Ze,x:He,y:Ct,uiManager:Ye(this,Ve),isCentered:!0,...Le});Rt&&this.add(Rt)}deserialize(Ie){switch(Ie.annotationType??Ie.annotationEditorType){case T.AnnotationEditorType.FREETEXT:return S.FreeTextEditor.deserialize(Ie,this,Ye(this,Ve));case T.AnnotationEditorType.INK:return I.InkEditor.deserialize(Ie,this,Ye(this,Ve));case T.AnnotationEditorType.STAMP:return te.StampEditor.deserialize(Ie,this,Ye(this,Ve))}return null}addNewEditor(){fr(this,We,In).call(this,fr(this,We,ua).call(this),!0)}setSelected(Ie){Ye(this,Ve).setSelected(Ie)}toggleSelected(Ie){Ye(this,Ve).toggleSelected(Ie)}isSelected(Ie){return Ye(this,Ve).isSelected(Ie)}unselect(Ie){Ye(this,Ve).unselect(Ie)}pointerup(Ie){const{isMac:Le}=T.FeatureTest.platform;if(!(Ie.button!==0||Ie.ctrlKey&&Le)&&Ie.target===this.div&&Ye(this,Ce)){if(Ar(this,Ce,!1),!Ye(this,ce)){Ar(this,ce,!0);return}if(Ye(this,Ve).getMode()===T.AnnotationEditorType.STAMP){Ye(this,Ve).unselectAll();return}fr(this,We,In).call(this,Ie,!1)}}pointerdown(Ie){if(Ye(this,Ce)){Ar(this,Ce,!1);return}const{isMac:Le}=T.FeatureTest.platform;if(Ie.button!==0||Ie.ctrlKey&&Le||Ie.target!==this.div)return;Ar(this,Ce,!0);const He=Ye(this,Ve).getActive();Ar(this,ce,!He||He.isEmpty())}findNewParent(Ie,Le,He){const Ct=Ye(this,Ve).findParent(Le,He);return Ct===null||Ct===this?!1:(Ct.changeParent(Ie),!0)}destroy(){var Ie,Le;((Ie=Ye(this,Ve).getActive())==null?void 0:Ie.parent)===this&&(Ye(this,Ve).commitOrRemove(),Ye(this,Ve).setActiveEditor(null));for(const He of Ye(this,Pe).values())(Le=Ye(this,ie))==null||Le.removePointerInTextLayer(He.contentDiv),He.setParent(null),He.isAttachedToDOM=!1,He.div.remove();this.div=null,Ye(this,Pe).clear(),Ye(this,Ve).removeLayer(this)}render({viewport:Ie}){this.viewport=Ie,(0,H.setLayerDimensions)(this.div,Ie);for(const Le of Ye(this,Ve).getEditors(this.pageIndex))this.add(Le);this.updateMode()}update({viewport:Ie}){Ye(this,Ve).commitOrRemove(),this.viewport=Ie,(0,H.setLayerDimensions)(this.div,{rotation:Ie.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:Ie,pageHeight:Le}=this.viewport.rawDims;return[Ie,Le]}};ie=new WeakMap,ce=new WeakMap,me=new WeakMap,_e=new WeakMap,Re=new WeakMap,Pe=new WeakMap,Ce=new WeakMap,Fe=new WeakMap,Me=new WeakMap,Ve=new WeakMap,We=new WeakSet,la=function(Ie){switch(Ye(this,Ve).getMode()){case T.AnnotationEditorType.FREETEXT:return new S.FreeTextEditor(Ie);case T.AnnotationEditorType.INK:return new I.InkEditor(Ie);case T.AnnotationEditorType.STAMP:return new te.StampEditor(Ie)}return null},In=function(Ie,Le){const He=this.getNextId(),Ct=fr(this,We,la).call(this,{parent:this,id:He,x:Ie.offsetX,y:Ie.offsetY,uiManager:Ye(this,Ve),isCentered:Le});return Ct&&this.add(Ct),Ct},ua=function(){const{x:Ie,y:Le,width:He,height:Ct}=this.div.getBoundingClientRect(),Ze=Math.max(0,Ie),Rt=Math.max(0,Le),nt=Math.min(window.innerWidth,Ie+He),nr=Math.min(window.innerHeight,Le+Ct),Je=(Ze+nt)/2-Ie,Wt=(Rt+nr)/2-Le,[Lt,qe]=this.viewport.rotation%180===0?[Je,Wt]:[Wt,Je];return{offsetX:Lt,offsetY:qe}},ha=function(){Ar(this,Fe,!0);for(const Ie of Ye(this,Pe).values())Ie.isEmpty()&&Ie.remove();Ar(this,Fe,!1)},cs(Ne,"_initialized",!1);let ae=Ne;r.AnnotationEditorLayer=ae},(E,r,v)=>{var te,ae,ie,ce,me,_e,Re,Pe,Ce,Fe,_i,xi,Ei,un,da,vi,fa;Object.defineProperty(r,"__esModule",{value:!0}),r.FreeTextEditor=void 0;var T=v(1),w=v(5),S=v(4),I=v(29);const Ne=class Ne extends S.AnnotationEditor{constructor(Le){super({...Le,name:"freeTextEditor"});Tr(this,Fe);Tr(this,te,this.editorDivBlur.bind(this));Tr(this,ae,this.editorDivFocus.bind(this));Tr(this,ie,this.editorDivInput.bind(this));Tr(this,ce,this.editorDivKeydown.bind(this));Tr(this,me);Tr(this,_e,"");Tr(this,Re,`${this.id}-editor`);Tr(this,Pe);Tr(this,Ce,null);Ar(this,me,Le.color||Ne._defaultColor||S.AnnotationEditor._defaultLineColor),Ar(this,Pe,Le.fontSize||Ne._defaultFontSize)}static get _keyboardManager(){const Le=Ne.prototype,He=Rt=>Rt.isEmpty(),Ct=w.AnnotationEditorUIManager.TRANSLATE_SMALL,Ze=w.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,T.shadow)(this,"_keyboardManager",new w.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],Le.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],Le.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],Le._translateEmpty,{args:[-Ct,0],checker:He}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],Le._translateEmpty,{args:[-Ze,0],checker:He}],[["ArrowRight","mac+ArrowRight"],Le._translateEmpty,{args:[Ct,0],checker:He}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],Le._translateEmpty,{args:[Ze,0],checker:He}],[["ArrowUp","mac+ArrowUp"],Le._translateEmpty,{args:[0,-Ct],checker:He}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],Le._translateEmpty,{args:[0,-Ze],checker:He}],[["ArrowDown","mac+ArrowDown"],Le._translateEmpty,{args:[0,Ct],checker:He}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],Le._translateEmpty,{args:[0,Ze],checker:He}]]))}static initialize(Le){S.AnnotationEditor.initialize(Le,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const He=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(He.getPropertyValue("--freetext-padding"))}static updateDefaultParams(Le,He){switch(Le){case T.AnnotationEditorParamsType.FREETEXT_SIZE:Ne._defaultFontSize=He;break;case T.AnnotationEditorParamsType.FREETEXT_COLOR:Ne._defaultColor=He;break}}updateParams(Le,He){switch(Le){case T.AnnotationEditorParamsType.FREETEXT_SIZE:fr(this,Fe,_i).call(this,He);break;case T.AnnotationEditorParamsType.FREETEXT_COLOR:fr(this,Fe,xi).call(this,He);break}}static get defaultPropertiesToUpdate(){return[[T.AnnotationEditorParamsType.FREETEXT_SIZE,Ne._defaultFontSize],[T.AnnotationEditorParamsType.FREETEXT_COLOR,Ne._defaultColor||S.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[T.AnnotationEditorParamsType.FREETEXT_SIZE,Ye(this,Pe)],[T.AnnotationEditorParamsType.FREETEXT_COLOR,Ye(this,me)]]}_translateEmpty(Le,He){this._uiManager.translateSelectedEditors(Le,He,!0)}getInitialTranslation(){const Le=this.parentScale;return[-Ne._internalPadding*Le,-(Ne._internalPadding+Ye(this,Pe))*Le]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(T.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",Ye(this,ce)),this.editorDiv.addEventListener("focus",Ye(this,ae)),this.editorDiv.addEventListener("blur",Ye(this,te)),this.editorDiv.addEventListener("input",Ye(this,ie)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",Ye(this,Re)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",Ye(this,ce)),this.editorDiv.removeEventListener("focus",Ye(this,ae)),this.editorDiv.removeEventListener("blur",Ye(this,te)),this.editorDiv.removeEventListener("input",Ye(this,ie)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(Le){this._focusEventsAllowed&&(super.focusin(Le),Le.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var Le;if(this.width){fr(this,Fe,fa).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(Le=this._initialOptions)!=null&&Le.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const Le=Ye(this,_e),He=Ar(this,_e,fr(this,Fe,Ei).call(this).trimEnd());if(Le===He)return;const Ct=Ze=>{if(Ar(this,_e,Ze),!Ze){this.remove();return}fr(this,Fe,da).call(this),this._uiManager.rebuild(this),fr(this,Fe,un).call(this)};this.addCommands({cmd:()=>{Ct(He)},undo:()=>{Ct(Le)},mustExec:!1}),fr(this,Fe,un).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(Le){this.enterInEditMode()}keydown(Le){Le.target===this.div&&Le.key==="Enter"&&(this.enterInEditMode(),Le.preventDefault())}editorDivKeydown(Le){Ne._keyboardManager.exec(this,Le)}editorDivFocus(Le){this.isEditing=!0}editorDivBlur(Le){this.isEditing=!1}editorDivInput(Le){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let Le,He;this.width&&(Le=this.x,He=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",Ye(this,Re)),this.enableEditing(),S.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(Ze=>{var Rt;return(Rt=this.editorDiv)==null?void 0:Rt.setAttribute("aria-label",Ze)}),S.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(Ze=>{var Rt;return(Rt=this.editorDiv)==null?void 0:Rt.setAttribute("default-content",Ze)}),this.editorDiv.contentEditable=!0;const{style:Ct}=this.editorDiv;if(Ct.fontSize=`calc(${Ye(this,Pe)}px * var(--scale-factor))`,Ct.color=Ye(this,me),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,w.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Ze,Rt]=this.parentDimensions;if(this.annotationElementId){const{position:nt}=Ye(this,Ce);let[nr,Je]=this.getInitialTranslation();[nr,Je]=this.pageTranslationToScreen(nr,Je);const[Wt,Lt]=this.pageDimensions,[qe,$e]=this.pageTranslation;let Be,Xe;switch(this.rotation){case 0:Be=Le+(nt[0]-qe)/Wt,Xe=He+this.height-(nt[1]-$e)/Lt;break;case 90:Be=Le+(nt[0]-qe)/Wt,Xe=He-(nt[1]-$e)/Lt,[nr,Je]=[Je,-nr];break;case 180:Be=Le-this.width+(nt[0]-qe)/Wt,Xe=He-(nt[1]-$e)/Lt,[nr,Je]=[-nr,-Je];break;case 270:Be=Le+(nt[0]-qe-this.height*Lt)/Wt,Xe=He+(nt[1]-$e-this.width*Wt)/Lt,[nr,Je]=[-Je,nr];break}this.setAt(Be*Ze,Xe*Rt,nr,Je)}else this.setAt(Le*Ze,He*Rt,this.width*Ze,this.height*Rt);fr(this,Fe,da).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(Le,He,Ct){let Ze=null;if(Le instanceof I.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:nt,fontColor:nr},rect:Je,rotation:Wt,id:Lt},textContent:qe,textPosition:$e,parent:{page:{pageNumber:Be}}}=Le;if(!qe||qe.length===0)return null;Ze=Le={annotationType:T.AnnotationEditorType.FREETEXT,color:Array.from(nr),fontSize:nt,value:qe.join(`
`),position:$e,pageIndex:Be-1,rect:Je,rotation:Wt,id:Lt,deleted:!1}}const Rt=super.deserialize(Le,He,Ct);return Ar(Rt,Pe,Le.fontSize),Ar(Rt,me,T.Util.makeHexColor(...Le.color)),Ar(Rt,_e,Le.value),Rt.annotationElementId=Le.id||null,Ar(Rt,Ce,Ze),Rt}serialize(Le=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const He=Ne._internalPadding*this.parentScale,Ct=this.getRect(He,He),Ze=S.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:Ye(this,me)),Rt={annotationType:T.AnnotationEditorType.FREETEXT,color:Ze,fontSize:Ye(this,Pe),value:Ye(this,_e),pageIndex:this.pageIndex,rect:Ct,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return Le?Rt:this.annotationElementId&&!fr(this,Fe,vi).call(this,Rt)?null:(Rt.id=this.annotationElementId,Rt)}};te=new WeakMap,ae=new WeakMap,ie=new WeakMap,ce=new WeakMap,me=new WeakMap,_e=new WeakMap,Re=new WeakMap,Pe=new WeakMap,Ce=new WeakMap,Fe=new WeakSet,_i=function(Le){const He=Ze=>{this.editorDiv.style.fontSize=`calc(${Ze}px * var(--scale-factor))`,this.translate(0,-(Ze-Ye(this,Pe))*this.parentScale),Ar(this,Pe,Ze),fr(this,Fe,un).call(this)},Ct=Ye(this,Pe);this.addCommands({cmd:()=>{He(Le)},undo:()=>{He(Ct)},mustExec:!0,type:T.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},xi=function(Le){const He=Ye(this,me);this.addCommands({cmd:()=>{Ar(this,me,this.editorDiv.style.color=Le)},undo:()=>{Ar(this,me,this.editorDiv.style.color=He)},mustExec:!0,type:T.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Ei=function(){const Le=this.editorDiv.getElementsByTagName("div");if(Le.length===0)return this.editorDiv.innerText;const He=[];for(const Ct of Le)He.push(Ct.innerText.replace(/\r\n?|\n/,""));return He.join(`
`)},un=function(){const[Le,He]=this.parentDimensions;let Ct;if(this.isAttachedToDOM)Ct=this.div.getBoundingClientRect();else{const{currentLayer:Ze,div:Rt}=this,nt=Rt.style.display;Rt.style.display="hidden",Ze.div.append(this.div),Ct=Rt.getBoundingClientRect(),Rt.remove(),Rt.style.display=nt}this.rotation%180===this.parentRotation%180?(this.width=Ct.width/Le,this.height=Ct.height/He):(this.width=Ct.height/Le,this.height=Ct.width/He),this.fixAndSetPosition()},da=function(){if(this.editorDiv.replaceChildren(),!!Ye(this,_e))for(const Le of Ye(this,_e).split(`
`)){const He=document.createElement("div");He.append(Le?document.createTextNode(Le):document.createElement("br")),this.editorDiv.append(He)}},vi=function(Le){const{value:He,fontSize:Ct,color:Ze,rect:Rt,pageIndex:nt}=Ye(this,Ce);return Le.value!==He||Le.fontSize!==Ct||Le.rect.some((nr,Je)=>Math.abs(nr-Rt[Je])>=1)||Le.color.some((nr,Je)=>nr!==Ze[Je])||Le.pageIndex!==nt},fa=function(Le=!1){if(!this.annotationElementId)return;if(fr(this,Fe,un).call(this),!Le&&(this.width===0||this.height===0)){setTimeout(()=>fr(this,Fe,fa).call(this,!0),0);return}const He=Ne._internalPadding*this.parentScale;Ye(this,Ce).rect=this.getRect(He,He)},cs(Ne,"_freeTextDefaultContent",""),cs(Ne,"_internalPadding",0),cs(Ne,"_defaultColor",null),cs(Ne,"_defaultFontSize",10),cs(Ne,"_type","freetext");let H=Ne;r.FreeTextEditor=H},(E,r,v)=>{var Xe,Qe,ks,yi,Ut,hr,pt,yr,vr,wr,ir,sr,kt,rr,lr,mr,Ir,Or,Fr,Et,dr,br,Ri,kn,pa,ma,gr,$r,Xr,Rr,pr,xr,qr,ga,ss,ar,Sr,zr,Ti,_a;Object.defineProperty(r,"__esModule",{value:!0}),r.StampAnnotationElement=r.InkAnnotationElement=r.FreeTextAnnotationElement=r.AnnotationLayer=void 0;var T=v(1),w=v(6),S=v(3),I=v(30),H=v(31),te=v(32);const ae=1e3,ie=9,ce=new WeakSet;function me(Wr){return{width:Wr[2]-Wr[0],height:Wr[3]-Wr[1]}}class _e{static create(er){switch(er.data.annotationType){case T.AnnotationType.LINK:return new Pe(er);case T.AnnotationType.TEXT:return new Ce(er);case T.AnnotationType.WIDGET:switch(er.data.fieldType){case"Tx":return new Me(er);case"Btn":return er.data.radioButton?new ze(er):er.data.checkBox?new We(er):new Ue(er);case"Ch":return new je(er);case"Sig":return new Ve(er)}return new Fe(er);case T.AnnotationType.POPUP:return new ke(er);case T.AnnotationType.FREETEXT:return new Ge(er);case T.AnnotationType.LINE:return new Ie(er);case T.AnnotationType.SQUARE:return new Le(er);case T.AnnotationType.CIRCLE:return new He(er);case T.AnnotationType.POLYLINE:return new Ct(er);case T.AnnotationType.CARET:return new Rt(er);case T.AnnotationType.INK:return new nt(er);case T.AnnotationType.POLYGON:return new Ze(er);case T.AnnotationType.HIGHLIGHT:return new nr(er);case T.AnnotationType.UNDERLINE:return new Je(er);case T.AnnotationType.SQUIGGLY:return new Wt(er);case T.AnnotationType.STRIKEOUT:return new Lt(er);case T.AnnotationType.STAMP:return new qe(er);case T.AnnotationType.FILEATTACHMENT:return new $e(er);default:return new Re(er)}}}const rt=class rt{constructor(er,{isRenderable:Bt=!1,ignoreBorder:cr=!1,createQuadrilaterals:_r=!1}={}){Tr(this,Xe,!1);this.isRenderable=Bt,this.data=er.data,this.layer=er.layer,this.linkService=er.linkService,this.downloadManager=er.downloadManager,this.imageResourcesPath=er.imageResourcesPath,this.renderForms=er.renderForms,this.svgFactory=er.svgFactory,this.annotationStorage=er.annotationStorage,this.enableScripting=er.enableScripting,this.hasJSActions=er.hasJSActions,this._fieldObjects=er.fieldObjects,this.parent=er.parent,Bt&&(this.container=this._createContainer(cr)),_r&&this._createQuadrilaterals()}static _hasPopupData({titleObj:er,contentsObj:Bt,richText:cr}){return!!(er!=null&&er.str||Bt!=null&&Bt.str||cr!=null&&cr.str)}get hasPopupData(){return rt._hasPopupData(this.data)}_createContainer(er){const{data:Bt,parent:{page:cr,viewport:_r}}=this,jr=document.createElement("section");jr.setAttribute("data-annotation-id",Bt.id),this instanceof Fe||(jr.tabIndex=ae),jr.style.zIndex=this.parent.zIndex++,this.data.popupRef&&jr.setAttribute("aria-haspopup","dialog"),Bt.noRotate&&jr.classList.add("norotate");const{pageWidth:Mr,pageHeight:Vr,pageX:Zr,pageY:Jr}=_r.rawDims;if(!Bt.rect||this instanceof ke){const{rotation:qt}=Bt;return!Bt.hasOwnCanvas&&qt!==0&&this.setRotation(qt,jr),jr}const{width:et,height:Gt}=me(Bt.rect),It=T.Util.normalizeRect([Bt.rect[0],cr.view[3]-Bt.rect[1]+cr.view[1],Bt.rect[2],cr.view[3]-Bt.rect[3]+cr.view[1]]);if(!er&&Bt.borderStyle.width>0){jr.style.borderWidth=`${Bt.borderStyle.width}px`;const qt=Bt.borderStyle.horizontalCornerRadius,tr=Bt.borderStyle.verticalCornerRadius;if(qt>0||tr>0){const Nr=`calc(${qt}px * var(--scale-factor)) / calc(${tr}px * var(--scale-factor))`;jr.style.borderRadius=Nr}else if(this instanceof ze){const Nr=`calc(${et}px * var(--scale-factor)) / calc(${Gt}px * var(--scale-factor))`;jr.style.borderRadius=Nr}switch(Bt.borderStyle.style){case T.AnnotationBorderStyleType.SOLID:jr.style.borderStyle="solid";break;case T.AnnotationBorderStyleType.DASHED:jr.style.borderStyle="dashed";break;case T.AnnotationBorderStyleType.BEVELED:(0,T.warn)("Unimplemented border style: beveled");break;case T.AnnotationBorderStyleType.INSET:(0,T.warn)("Unimplemented border style: inset");break;case T.AnnotationBorderStyleType.UNDERLINE:jr.style.borderBottomStyle="solid";break}const Er=Bt.borderColor||null;Er?(Ar(this,Xe,!0),jr.style.borderColor=T.Util.makeHexColor(Er[0]|0,Er[1]|0,Er[2]|0)):jr.style.borderWidth=0}jr.style.left=`${100*(It[0]-Zr)/Mr}%`,jr.style.top=`${100*(It[1]-Jr)/Vr}%`;const{rotation:Nt}=Bt;return Bt.hasOwnCanvas||Nt===0?(jr.style.width=`${100*et/Mr}%`,jr.style.height=`${100*Gt/Vr}%`):this.setRotation(Nt,jr),jr}setRotation(er,Bt=this.container){if(!this.data.rect)return;const{pageWidth:cr,pageHeight:_r}=this.parent.viewport.rawDims,{width:jr,height:Mr}=me(this.data.rect);let Vr,Zr;er%180===0?(Vr=100*jr/cr,Zr=100*Mr/_r):(Vr=100*Mr/cr,Zr=100*jr/_r),Bt.style.width=`${Vr}%`,Bt.style.height=`${Zr}%`,Bt.setAttribute("data-main-rotation",(360-er)%360)}get _commonActions(){const er=(Bt,cr,_r)=>{const jr=_r.detail[Bt],Mr=jr[0],Vr=jr.slice(1);_r.target.style[cr]=I.ColorConverters[`${Mr}_HTML`](Vr),this.annotationStorage.setValue(this.data.id,{[cr]:I.ColorConverters[`${Mr}_rgb`](Vr)})};return(0,T.shadow)(this,"_commonActions",{display:Bt=>{const{display:cr}=Bt.detail,_r=cr%2===1;this.container.style.visibility=_r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:_r,noPrint:cr===1||cr===2})},print:Bt=>{this.annotationStorage.setValue(this.data.id,{noPrint:!Bt.detail.print})},hidden:Bt=>{const{hidden:cr}=Bt.detail;this.container.style.visibility=cr?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:cr,noView:cr})},focus:Bt=>{setTimeout(()=>Bt.target.focus({preventScroll:!1}),0)},userName:Bt=>{Bt.target.title=Bt.detail.userName},readonly:Bt=>{Bt.target.disabled=Bt.detail.readonly},required:Bt=>{this._setRequired(Bt.target,Bt.detail.required)},bgColor:Bt=>{er("bgColor","backgroundColor",Bt)},fillColor:Bt=>{er("fillColor","backgroundColor",Bt)},fgColor:Bt=>{er("fgColor","color",Bt)},textColor:Bt=>{er("textColor","color",Bt)},borderColor:Bt=>{er("borderColor","borderColor",Bt)},strokeColor:Bt=>{er("strokeColor","borderColor",Bt)},rotation:Bt=>{const cr=Bt.detail.rotation;this.setRotation(cr),this.annotationStorage.setValue(this.data.id,{rotation:cr})}})}_dispatchEventFromSandbox(er,Bt){const cr=this._commonActions;for(const _r of Object.keys(Bt.detail)){const jr=er[_r]||cr[_r];jr==null||jr(Bt)}}_setDefaultPropertiesFromJS(er){if(!this.enableScripting)return;const Bt=this.annotationStorage.getRawValue(this.data.id);if(!Bt)return;const cr=this._commonActions;for(const[_r,jr]of Object.entries(Bt)){const Mr=cr[_r];if(Mr){const Vr={detail:{[_r]:jr},target:er};Mr(Vr),delete Bt[_r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:er}=this.data;if(!er)return;const[Bt,cr,_r,jr]=this.data.rect;if(er.length===1){const[,{x:tr,y:Er},{x:Nr,y:Pr}]=er[0];if(_r===tr&&jr===Er&&Bt===Nr&&cr===Pr)return}const{style:Mr}=this.container;let Vr;if(Ye(this,Xe)){const{borderColor:tr,borderWidth:Er}=Mr;Mr.borderWidth=0,Vr=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${tr}" stroke-width="${Er}">`],this.container.classList.add("hasBorder")}const Zr=_r-Bt,Jr=jr-cr,{svgFactory:et}=this,Gt=et.createElement("svg");Gt.classList.add("quadrilateralsContainer"),Gt.setAttribute("width",0),Gt.setAttribute("height",0);const It=et.createElement("defs");Gt.append(It);const Nt=et.createElement("clipPath"),qt=`clippath_${this.data.id}`;Nt.setAttribute("id",qt),Nt.setAttribute("clipPathUnits","objectBoundingBox"),It.append(Nt);for(const[,{x:tr,y:Er},{x:Nr,y:Pr}]of er){const Cr=et.createElement("rect"),Dr=(Nr-Bt)/Zr,Hr=(jr-Er)/Jr,Kr=(tr-Nr)/Zr,rs=(Er-Pr)/Jr;Cr.setAttribute("x",Dr),Cr.setAttribute("y",Hr),Cr.setAttribute("width",Kr),Cr.setAttribute("height",rs),Nt.append(Cr),Vr==null||Vr.push(`<rect vector-effect="non-scaling-stroke" x="${Dr}" y="${Hr}" width="${Kr}" height="${rs}"/>`)}Ye(this,Xe)&&(Vr.push("</g></svg>')"),Mr.backgroundImage=Vr.join("")),this.container.append(Gt),this.container.style.clipPath=`url(#${qt})`}_createPopup(){const{container:er,data:Bt}=this;er.setAttribute("aria-haspopup","dialog");const cr=new ke({data:{color:Bt.color,titleObj:Bt.titleObj,modificationDate:Bt.modificationDate,contentsObj:Bt.contentsObj,richText:Bt.richText,parentRect:Bt.rect,borderStyle:0,id:`popup_${Bt.id}`,rotation:Bt.rotation},parent:this.parent,elements:[this]});this.parent.div.append(cr.render())}render(){(0,T.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(er,Bt=null){const cr=[];if(this._fieldObjects){const _r=this._fieldObjects[er];if(_r)for(const{page:jr,id:Mr,exportValues:Vr}of _r){if(jr===-1||Mr===Bt)continue;const Zr=typeof Vr=="string"?Vr:null,Jr=document.querySelector(`[data-element-id="${Mr}"]`);if(Jr&&!ce.has(Jr)){(0,T.warn)(`_getElementsByName - element not allowed: ${Mr}`);continue}cr.push({id:Mr,exportValue:Zr,domElement:Jr})}return cr}for(const _r of document.getElementsByName(er)){const{exportValue:jr}=_r,Mr=_r.getAttribute("data-element-id");Mr!==Bt&&ce.has(_r)&&cr.push({id:Mr,exportValue:jr,domElement:_r})}return cr}show(){var er;this.container&&(this.container.hidden=!1),(er=this.popup)==null||er.maybeShow()}hide(){var er;this.container&&(this.container.hidden=!0),(er=this.popup)==null||er.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const er=this.getElementsToTriggerPopup();if(Array.isArray(er))for(const Bt of er)Bt.classList.add("highlightArea");else er.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:er,data:{id:Bt}}=this;this.container.addEventListener("dblclick",()=>{var cr;(cr=this.linkService.eventBus)==null||cr.dispatch("switchannotationeditormode",{source:this,mode:er,editId:Bt})})}};Xe=new WeakMap;let Re=rt;class Pe extends Re{constructor(Bt,cr=null){super(Bt,{isRenderable:!0,ignoreBorder:!!(cr!=null&&cr.ignoreBorder),createQuadrilaterals:!0});Tr(this,Qe);this.isTooltipOnly=Bt.data.isTooltipOnly}render(){const{data:Bt,linkService:cr}=this,_r=document.createElement("a");_r.setAttribute("data-element-id",Bt.id);let jr=!1;return Bt.url?(cr.addLinkAttributes(_r,Bt.url,Bt.newWindow),jr=!0):Bt.action?(this._bindNamedAction(_r,Bt.action),jr=!0):Bt.attachment?(this._bindAttachment(_r,Bt.attachment),jr=!0):Bt.setOCGState?(fr(this,Qe,yi).call(this,_r,Bt.setOCGState),jr=!0):Bt.dest?(this._bindLink(_r,Bt.dest),jr=!0):(Bt.actions&&(Bt.actions.Action||Bt.actions["Mouse Up"]||Bt.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(_r,Bt),jr=!0),Bt.resetForm?(this._bindResetFormAction(_r,Bt.resetForm),jr=!0):this.isTooltipOnly&&!jr&&(this._bindLink(_r,""),jr=!0)),this.container.classList.add("linkAnnotation"),jr&&this.container.append(_r),this.container}_bindLink(Bt,cr){Bt.href=this.linkService.getDestinationHash(cr),Bt.onclick=()=>(cr&&this.linkService.goToDestination(cr),!1),(cr||cr==="")&&fr(this,Qe,ks).call(this)}_bindNamedAction(Bt,cr){Bt.href=this.linkService.getAnchorUrl(""),Bt.onclick=()=>(this.linkService.executeNamedAction(cr),!1),fr(this,Qe,ks).call(this)}_bindAttachment(Bt,cr){Bt.href=this.linkService.getAnchorUrl(""),Bt.onclick=()=>{var _r;return(_r=this.downloadManager)==null||_r.openOrDownloadData(this.container,cr.content,cr.filename),!1},fr(this,Qe,ks).call(this)}_bindJSAction(Bt,cr){Bt.href=this.linkService.getAnchorUrl("");const _r=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const jr of Object.keys(cr.actions)){const Mr=_r.get(jr);Mr&&(Bt[Mr]=()=>{var Vr;return(Vr=this.linkService.eventBus)==null||Vr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:cr.id,name:jr}}),!1})}Bt.onclick||(Bt.onclick=()=>!1),fr(this,Qe,ks).call(this)}_bindResetFormAction(Bt,cr){const _r=Bt.onclick;if(_r||(Bt.href=this.linkService.getAnchorUrl("")),fr(this,Qe,ks).call(this),!this._fieldObjects){(0,T.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),_r||(Bt.onclick=()=>!1);return}Bt.onclick=()=>{var Gt;_r==null||_r();const{fields:jr,refs:Mr,include:Vr}=cr,Zr=[];if(jr.length!==0||Mr.length!==0){const It=new Set(Mr);for(const Nt of jr){const qt=this._fieldObjects[Nt]||[];for(const{id:tr}of qt)It.add(tr)}for(const Nt of Object.values(this._fieldObjects))for(const qt of Nt)It.has(qt.id)===Vr&&Zr.push(qt)}else for(const It of Object.values(this._fieldObjects))Zr.push(...It);const Jr=this.annotationStorage,et=[];for(const It of Zr){const{id:Nt}=It;switch(et.push(Nt),It.type){case"text":{const tr=It.defaultValue||"";Jr.setValue(Nt,{value:tr});break}case"checkbox":case"radiobutton":{const tr=It.defaultValue===It.exportValues;Jr.setValue(Nt,{value:tr});break}case"combobox":case"listbox":{const tr=It.defaultValue||"";Jr.setValue(Nt,{value:tr});break}default:continue}const qt=document.querySelector(`[data-element-id="${Nt}"]`);if(qt){if(!ce.has(qt)){(0,T.warn)(`_bindResetFormAction - element not allowed: ${Nt}`);continue}}else continue;qt.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((Gt=this.linkService.eventBus)==null||Gt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:et,name:"ResetForm"}})),!1}}}Qe=new WeakSet,ks=function(){this.container.setAttribute("data-internal-link","")},yi=function(Bt,cr){Bt.href=this.linkService.getAnchorUrl(""),Bt.onclick=()=>(this.linkService.executeSetOCGState(cr),!1),fr(this,Qe,ks).call(this)};class Ce extends Re{constructor(er){super(er,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const er=document.createElement("img");return er.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",er.alt="[{{type}} Annotation]",er.dataset.l10nId="text_annotation_type",er.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(er),this.container}}class Fe extends Re{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(er){var Bt;this.data.hasOwnCanvas&&(((Bt=er.previousSibling)==null?void 0:Bt.nodeName)==="CANVAS"&&(er.previousSibling.hidden=!0),er.hidden=!1)}_getKeyModifier(er){const{isWin:Bt,isMac:cr}=T.FeatureTest.platform;return Bt&&er.ctrlKey||cr&&er.metaKey}_setEventListener(er,Bt,cr,_r,jr){cr.includes("mouse")?er.addEventListener(cr,Mr=>{var Vr;(Vr=this.linkService.eventBus)==null||Vr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:_r,value:jr(Mr),shift:Mr.shiftKey,modifier:this._getKeyModifier(Mr)}})}):er.addEventListener(cr,Mr=>{var Vr;if(cr==="blur"){if(!Bt.focused||!Mr.relatedTarget)return;Bt.focused=!1}else if(cr==="focus"){if(Bt.focused)return;Bt.focused=!0}jr&&((Vr=this.linkService.eventBus)==null||Vr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:_r,value:jr(Mr)}}))})}_setEventListeners(er,Bt,cr,_r){var jr,Mr,Vr;for(const[Zr,Jr]of cr)(Jr==="Action"||(jr=this.data.actions)!=null&&jr[Jr])&&((Jr==="Focus"||Jr==="Blur")&&(Bt||(Bt={focused:!1})),this._setEventListener(er,Bt,Zr,Jr,_r),Jr==="Focus"&&!((Mr=this.data.actions)!=null&&Mr.Blur)?this._setEventListener(er,Bt,"blur","Blur",null):Jr==="Blur"&&!((Vr=this.data.actions)!=null&&Vr.Focus)&&this._setEventListener(er,Bt,"focus","Focus",null))}_setBackgroundColor(er){const Bt=this.data.backgroundColor||null;er.style.backgroundColor=Bt===null?"transparent":T.Util.makeHexColor(Bt[0],Bt[1],Bt[2])}_setTextStyle(er){const Bt=["left","center","right"],{fontColor:cr}=this.data.defaultAppearanceData,_r=this.data.defaultAppearanceData.fontSize||ie,jr=er.style;let Mr;const Vr=2,Zr=Jr=>Math.round(10*Jr)/10;if(this.data.multiLine){const Jr=Math.abs(this.data.rect[3]-this.data.rect[1]-Vr),et=Math.round(Jr/(T.LINE_FACTOR*_r))||1,Gt=Jr/et;Mr=Math.min(_r,Zr(Gt/T.LINE_FACTOR))}else{const Jr=Math.abs(this.data.rect[3]-this.data.rect[1]-Vr);Mr=Math.min(_r,Zr(Jr/T.LINE_FACTOR))}jr.fontSize=`calc(${Mr}px * var(--scale-factor))`,jr.color=T.Util.makeHexColor(cr[0],cr[1],cr[2]),this.data.textAlignment!==null&&(jr.textAlign=Bt[this.data.textAlignment])}_setRequired(er,Bt){Bt?er.setAttribute("required",!0):er.removeAttribute("required"),er.setAttribute("aria-required",Bt)}}class Me extends Fe{constructor(er){const Bt=er.renderForms||!er.data.hasAppearance&&!!er.data.fieldValue;super(er,{isRenderable:Bt})}setPropertyOnSiblings(er,Bt,cr,_r){const jr=this.annotationStorage;for(const Mr of this._getElementsByName(er.name,er.id))Mr.domElement&&(Mr.domElement[Bt]=cr),jr.setValue(Mr.id,{[_r]:cr})}render(){var _r,jr;const er=this.annotationStorage,Bt=this.data.id;this.container.classList.add("textWidgetAnnotation");let cr=null;if(this.renderForms){const Mr=er.getValue(Bt,{value:this.data.fieldValue});let Vr=Mr.value||"";const Zr=er.getValue(Bt,{charLimit:this.data.maxLen}).charLimit;Zr&&Vr.length>Zr&&(Vr=Vr.slice(0,Zr));let Jr=Mr.formattedValue||((_r=this.data.textContent)==null?void 0:_r.join(`
`))||null;Jr&&this.data.comb&&(Jr=Jr.replaceAll(/\s+/g,""));const et={userValue:Vr,formattedValue:Jr,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(cr=document.createElement("textarea"),cr.textContent=Jr??Vr,this.data.doNotScroll&&(cr.style.overflowY="hidden")):(cr=document.createElement("input"),cr.type="text",cr.setAttribute("value",Jr??Vr),this.data.doNotScroll&&(cr.style.overflowX="hidden")),this.data.hasOwnCanvas&&(cr.hidden=!0),ce.add(cr),cr.setAttribute("data-element-id",Bt),cr.disabled=this.data.readOnly,cr.name=this.data.fieldName,cr.tabIndex=ae,this._setRequired(cr,this.data.required),Zr&&(cr.maxLength=Zr),cr.addEventListener("input",It=>{er.setValue(Bt,{value:It.target.value}),this.setPropertyOnSiblings(cr,"value",It.target.value,"value"),et.formattedValue=null}),cr.addEventListener("resetform",It=>{const Nt=this.data.defaultFieldValue??"";cr.value=et.userValue=Nt,et.formattedValue=null});let Gt=It=>{const{formattedValue:Nt}=et;Nt!=null&&(It.target.value=Nt),It.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){cr.addEventListener("focus",Nt=>{if(et.focused)return;const{target:qt}=Nt;et.userValue&&(qt.value=et.userValue),et.lastCommittedValue=qt.value,et.commitKey=1,et.focused=!0}),cr.addEventListener("updatefromsandbox",Nt=>{this.showElementAndHideCanvas(Nt.target);const qt={value(tr){et.userValue=tr.detail.value??"",er.setValue(Bt,{value:et.userValue.toString()}),tr.target.value=et.userValue},formattedValue(tr){const{formattedValue:Er}=tr.detail;et.formattedValue=Er,Er!=null&&tr.target!==document.activeElement&&(tr.target.value=Er),er.setValue(Bt,{formattedValue:Er})},selRange(tr){tr.target.setSelectionRange(...tr.detail.selRange)},charLimit:tr=>{var Cr;const{charLimit:Er}=tr.detail,{target:Nr}=tr;if(Er===0){Nr.removeAttribute("maxLength");return}Nr.setAttribute("maxLength",Er);let Pr=et.userValue;!Pr||Pr.length<=Er||(Pr=Pr.slice(0,Er),Nr.value=et.userValue=Pr,er.setValue(Bt,{value:Pr}),(Cr=this.linkService.eventBus)==null||Cr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Bt,name:"Keystroke",value:Pr,willCommit:!0,commitKey:1,selStart:Nr.selectionStart,selEnd:Nr.selectionEnd}}))}};this._dispatchEventFromSandbox(qt,Nt)}),cr.addEventListener("keydown",Nt=>{var Er;et.commitKey=1;let qt=-1;if(Nt.key==="Escape"?qt=0:Nt.key==="Enter"&&!this.data.multiLine?qt=2:Nt.key==="Tab"&&(et.commitKey=3),qt===-1)return;const{value:tr}=Nt.target;et.lastCommittedValue!==tr&&(et.lastCommittedValue=tr,et.userValue=tr,(Er=this.linkService.eventBus)==null||Er.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Bt,name:"Keystroke",value:tr,willCommit:!0,commitKey:qt,selStart:Nt.target.selectionStart,selEnd:Nt.target.selectionEnd}}))});const It=Gt;Gt=null,cr.addEventListener("blur",Nt=>{var tr;if(!et.focused||!Nt.relatedTarget)return;et.focused=!1;const{value:qt}=Nt.target;et.userValue=qt,et.lastCommittedValue!==qt&&((tr=this.linkService.eventBus)==null||tr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Bt,name:"Keystroke",value:qt,willCommit:!0,commitKey:et.commitKey,selStart:Nt.target.selectionStart,selEnd:Nt.target.selectionEnd}})),It(Nt)}),(jr=this.data.actions)!=null&&jr.Keystroke&&cr.addEventListener("beforeinput",Nt=>{var Hr;et.lastCommittedValue=null;const{data:qt,target:tr}=Nt,{value:Er,selectionStart:Nr,selectionEnd:Pr}=tr;let Cr=Nr,Dr=Pr;switch(Nt.inputType){case"deleteWordBackward":{const Kr=Er.substring(0,Nr).match(/\w*[^\w]*$/);Kr&&(Cr-=Kr[0].length);break}case"deleteWordForward":{const Kr=Er.substring(Nr).match(/^[^\w]*\w*/);Kr&&(Dr+=Kr[0].length);break}case"deleteContentBackward":Nr===Pr&&(Cr-=1);break;case"deleteContentForward":Nr===Pr&&(Dr+=1);break}Nt.preventDefault(),(Hr=this.linkService.eventBus)==null||Hr.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Bt,name:"Keystroke",value:Er,change:qt||"",willCommit:!1,selStart:Cr,selEnd:Dr}})}),this._setEventListeners(cr,et,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Nt=>Nt.target.value)}if(Gt&&cr.addEventListener("blur",Gt),this.data.comb){const Nt=(this.data.rect[2]-this.data.rect[0])/Zr;cr.classList.add("comb"),cr.style.letterSpacing=`calc(${Nt}px * var(--scale-factor) - 1ch)`}}else cr=document.createElement("div"),cr.textContent=this.data.fieldValue,cr.style.verticalAlign="middle",cr.style.display="table-cell";return this._setTextStyle(cr),this._setBackgroundColor(cr),this._setDefaultPropertiesFromJS(cr),this.container.append(cr),this.container}}class Ve extends Fe{constructor(er){super(er,{isRenderable:!!er.data.hasOwnCanvas})}}class We extends Fe{constructor(er){super(er,{isRenderable:er.renderForms})}render(){const er=this.annotationStorage,Bt=this.data,cr=Bt.id;let _r=er.getValue(cr,{value:Bt.exportValue===Bt.fieldValue}).value;typeof _r=="string"&&(_r=_r!=="Off",er.setValue(cr,{value:_r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const jr=document.createElement("input");return ce.add(jr),jr.setAttribute("data-element-id",cr),jr.disabled=Bt.readOnly,this._setRequired(jr,this.data.required),jr.type="checkbox",jr.name=Bt.fieldName,_r&&jr.setAttribute("checked",!0),jr.setAttribute("exportValue",Bt.exportValue),jr.tabIndex=ae,jr.addEventListener("change",Mr=>{const{name:Vr,checked:Zr}=Mr.target;for(const Jr of this._getElementsByName(Vr,cr)){const et=Zr&&Jr.exportValue===Bt.exportValue;Jr.domElement&&(Jr.domElement.checked=et),er.setValue(Jr.id,{value:et})}er.setValue(cr,{value:Zr})}),jr.addEventListener("resetform",Mr=>{const Vr=Bt.defaultFieldValue||"Off";Mr.target.checked=Vr===Bt.exportValue}),this.enableScripting&&this.hasJSActions&&(jr.addEventListener("updatefromsandbox",Mr=>{const Vr={value(Zr){Zr.target.checked=Zr.detail.value!=="Off",er.setValue(cr,{value:Zr.target.checked})}};this._dispatchEventFromSandbox(Vr,Mr)}),this._setEventListeners(jr,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Mr=>Mr.target.checked)),this._setBackgroundColor(jr),this._setDefaultPropertiesFromJS(jr),this.container.append(jr),this.container}}class ze extends Fe{constructor(er){super(er,{isRenderable:er.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const er=this.annotationStorage,Bt=this.data,cr=Bt.id;let _r=er.getValue(cr,{value:Bt.fieldValue===Bt.buttonValue}).value;typeof _r=="string"&&(_r=_r!==Bt.buttonValue,er.setValue(cr,{value:_r}));const jr=document.createElement("input");if(ce.add(jr),jr.setAttribute("data-element-id",cr),jr.disabled=Bt.readOnly,this._setRequired(jr,this.data.required),jr.type="radio",jr.name=Bt.fieldName,_r&&jr.setAttribute("checked",!0),jr.tabIndex=ae,jr.addEventListener("change",Mr=>{const{name:Vr,checked:Zr}=Mr.target;for(const Jr of this._getElementsByName(Vr,cr))er.setValue(Jr.id,{value:!1});er.setValue(cr,{value:Zr})}),jr.addEventListener("resetform",Mr=>{const Vr=Bt.defaultFieldValue;Mr.target.checked=Vr!=null&&Vr===Bt.buttonValue}),this.enableScripting&&this.hasJSActions){const Mr=Bt.buttonValue;jr.addEventListener("updatefromsandbox",Vr=>{const Zr={value:Jr=>{const et=Mr===Jr.detail.value;for(const Gt of this._getElementsByName(Jr.target.name)){const It=et&&Gt.id===cr;Gt.domElement&&(Gt.domElement.checked=It),er.setValue(Gt.id,{value:It})}}};this._dispatchEventFromSandbox(Zr,Vr)}),this._setEventListeners(jr,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],Vr=>Vr.target.checked)}return this._setBackgroundColor(jr),this._setDefaultPropertiesFromJS(jr),this.container.append(jr),this.container}}class Ue extends Pe{constructor(er){super(er,{ignoreBorder:er.data.hasAppearance})}render(){const er=super.render();er.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(er.title=this.data.alternativeText);const Bt=er.lastChild;return this.enableScripting&&this.hasJSActions&&Bt&&(this._setDefaultPropertiesFromJS(Bt),Bt.addEventListener("updatefromsandbox",cr=>{this._dispatchEventFromSandbox({},cr)})),er}}class je extends Fe{constructor(er){super(er,{isRenderable:er.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const er=this.annotationStorage,Bt=this.data.id,cr=er.getValue(Bt,{value:this.data.fieldValue}),_r=document.createElement("select");ce.add(_r),_r.setAttribute("data-element-id",Bt),_r.disabled=this.data.readOnly,this._setRequired(_r,this.data.required),_r.name=this.data.fieldName,_r.tabIndex=ae;let jr=this.data.combo&&this.data.options.length>0;this.data.combo||(_r.size=this.data.options.length,this.data.multiSelect&&(_r.multiple=!0)),_r.addEventListener("resetform",et=>{const Gt=this.data.defaultFieldValue;for(const It of _r.options)It.selected=It.value===Gt});for(const et of this.data.options){const Gt=document.createElement("option");Gt.textContent=et.displayValue,Gt.value=et.exportValue,cr.value.includes(et.exportValue)&&(Gt.setAttribute("selected",!0),jr=!1),_r.append(Gt)}let Mr=null;if(jr){const et=document.createElement("option");et.value=" ",et.setAttribute("hidden",!0),et.setAttribute("selected",!0),_r.prepend(et),Mr=()=>{et.remove(),_r.removeEventListener("input",Mr),Mr=null},_r.addEventListener("input",Mr)}const Vr=et=>{const Gt=et?"value":"textContent",{options:It,multiple:Nt}=_r;return Nt?Array.prototype.filter.call(It,qt=>qt.selected).map(qt=>qt[Gt]):It.selectedIndex===-1?null:It[It.selectedIndex][Gt]};let Zr=Vr(!1);const Jr=et=>{const Gt=et.target.options;return Array.prototype.map.call(Gt,It=>({displayValue:It.textContent,exportValue:It.value}))};return this.enableScripting&&this.hasJSActions?(_r.addEventListener("updatefromsandbox",et=>{const Gt={value(It){Mr==null||Mr();const Nt=It.detail.value,qt=new Set(Array.isArray(Nt)?Nt:[Nt]);for(const tr of _r.options)tr.selected=qt.has(tr.value);er.setValue(Bt,{value:Vr(!0)}),Zr=Vr(!1)},multipleSelection(It){_r.multiple=!0},remove(It){const Nt=_r.options,qt=It.detail.remove;Nt[qt].selected=!1,_r.remove(qt),Nt.length>0&&Array.prototype.findIndex.call(Nt,Er=>Er.selected)===-1&&(Nt[0].selected=!0),er.setValue(Bt,{value:Vr(!0),items:Jr(It)}),Zr=Vr(!1)},clear(It){for(;_r.length!==0;)_r.remove(0);er.setValue(Bt,{value:null,items:[]}),Zr=Vr(!1)},insert(It){const{index:Nt,displayValue:qt,exportValue:tr}=It.detail.insert,Er=_r.children[Nt],Nr=document.createElement("option");Nr.textContent=qt,Nr.value=tr,Er?Er.before(Nr):_r.append(Nr),er.setValue(Bt,{value:Vr(!0),items:Jr(It)}),Zr=Vr(!1)},items(It){const{items:Nt}=It.detail;for(;_r.length!==0;)_r.remove(0);for(const qt of Nt){const{displayValue:tr,exportValue:Er}=qt,Nr=document.createElement("option");Nr.textContent=tr,Nr.value=Er,_r.append(Nr)}_r.options.length>0&&(_r.options[0].selected=!0),er.setValue(Bt,{value:Vr(!0),items:Jr(It)}),Zr=Vr(!1)},indices(It){const Nt=new Set(It.detail.indices);for(const qt of It.target.options)qt.selected=Nt.has(qt.index);er.setValue(Bt,{value:Vr(!0)}),Zr=Vr(!1)},editable(It){It.target.disabled=!It.detail.editable}};this._dispatchEventFromSandbox(Gt,et)}),_r.addEventListener("input",et=>{var It;const Gt=Vr(!0);er.setValue(Bt,{value:Gt}),et.preventDefault(),(It=this.linkService.eventBus)==null||It.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Bt,name:"Keystroke",value:Zr,changeEx:Gt,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(_r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],et=>et.target.value)):_r.addEventListener("input",function(et){er.setValue(Bt,{value:Vr(!0)})}),this.data.combo&&this._setTextStyle(_r),this._setBackgroundColor(_r),this._setDefaultPropertiesFromJS(_r),this.container.append(_r),this.container}}class ke extends Re{constructor(er){const{data:Bt,elements:cr}=er;super(er,{isRenderable:Re._hasPopupData(Bt)}),this.elements=cr}render(){this.container.classList.add("popupAnnotation");const er=new Ne({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),Bt=[];for(const cr of this.elements)cr.popup=er,Bt.push(cr.data.id),cr.addHighlightArea();return this.container.setAttribute("aria-controls",Bt.map(cr=>`${T.AnnotationPrefix}${cr}`).join(",")),this.container}}class Ne{constructor({container:er,color:Bt,elements:cr,titleObj:_r,modificationDate:jr,contentsObj:Mr,richText:Vr,parent:Zr,rect:Jr,parentRect:et,open:Gt}){Tr(this,br);Tr(this,Ut,null);Tr(this,hr,fr(this,br,Ri).bind(this));Tr(this,pt,fr(this,br,ma).bind(this));Tr(this,yr,fr(this,br,pa).bind(this));Tr(this,vr,fr(this,br,kn).bind(this));Tr(this,wr,null);Tr(this,ir,null);Tr(this,sr,null);Tr(this,kt,null);Tr(this,rr,null);Tr(this,lr,null);Tr(this,mr,!1);Tr(this,Ir,null);Tr(this,Or,null);Tr(this,Fr,null);Tr(this,Et,null);Tr(this,dr,!1);var Nt;Ar(this,ir,er),Ar(this,Et,_r),Ar(this,sr,Mr),Ar(this,Fr,Vr),Ar(this,rr,Zr),Ar(this,wr,Bt),Ar(this,Or,Jr),Ar(this,lr,et),Ar(this,kt,cr);const It=w.PDFDateString.toDateObject(jr);It&&Ar(this,Ut,Zr.l10n.get("annotation_date_string",{date:It.toLocaleDateString(),time:It.toLocaleTimeString()})),this.trigger=cr.flatMap(qt=>qt.getElementsToTriggerPopup());for(const qt of this.trigger)qt.addEventListener("click",Ye(this,vr)),qt.addEventListener("mouseenter",Ye(this,yr)),qt.addEventListener("mouseleave",Ye(this,pt)),qt.classList.add("popupTriggerArea");for(const qt of cr)(Nt=qt.container)==null||Nt.addEventListener("keydown",Ye(this,hr));Ye(this,ir).hidden=!0,Gt&&fr(this,br,kn).call(this)}render(){if(Ye(this,Ir))return;const{page:{view:er},viewport:{rawDims:{pageWidth:Bt,pageHeight:cr,pageX:_r,pageY:jr}}}=Ye(this,rr),Mr=Ar(this,Ir,document.createElement("div"));if(Mr.className="popup",Ye(this,wr)){const Cr=Mr.style.outlineColor=T.Util.makeHexColor(...Ye(this,wr));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?Mr.style.backgroundColor=`color-mix(in srgb, ${Cr} 30%, white)`:Mr.style.backgroundColor=T.Util.makeHexColor(...Ye(this,wr).map(Hr=>Math.floor(.7*(255-Hr)+Hr)))}const Vr=document.createElement("span");Vr.className="header";const Zr=document.createElement("h1");if(Vr.append(Zr),{dir:Zr.dir,str:Zr.textContent}=Ye(this,Et),Mr.append(Vr),Ye(this,Ut)){const Cr=document.createElement("span");Cr.classList.add("popupDate"),Ye(this,Ut).then(Dr=>{Cr.textContent=Dr}),Vr.append(Cr)}const Jr=Ye(this,sr),et=Ye(this,Fr);if(et!=null&&et.str&&(!(Jr!=null&&Jr.str)||Jr.str===et.str))te.XfaLayer.render({xfaHtml:et.html,intent:"richText",div:Mr}),Mr.lastChild.classList.add("richText","popupContent");else{const Cr=this._formatContents(Jr);Mr.append(Cr)}let Gt=!!Ye(this,lr),It=Gt?Ye(this,lr):Ye(this,Or);for(const Cr of Ye(this,kt))if(!It||T.Util.intersect(Cr.data.rect,It)!==null){It=Cr.data.rect,Gt=!0;break}const Nt=T.Util.normalizeRect([It[0],er[3]-It[1]+er[1],It[2],er[3]-It[3]+er[1]]),tr=Gt?It[2]-It[0]+5:0,Er=Nt[0]+tr,Nr=Nt[1],{style:Pr}=Ye(this,ir);Pr.left=`${100*(Er-_r)/Bt}%`,Pr.top=`${100*(Nr-jr)/cr}%`,Ye(this,ir).append(Mr)}_formatContents({str:er,dir:Bt}){const cr=document.createElement("p");cr.classList.add("popupContent"),cr.dir=Bt;const _r=er.split(/(?:\r\n?|\n)/);for(let jr=0,Mr=_r.length;jr<Mr;++jr){const Vr=_r[jr];cr.append(document.createTextNode(Vr)),jr<Mr-1&&cr.append(document.createElement("br"))}return cr}forceHide(){Ar(this,dr,this.isVisible),Ye(this,dr)&&(Ye(this,ir).hidden=!0)}maybeShow(){Ye(this,dr)&&(Ar(this,dr,!1),Ye(this,ir).hidden=!1)}get isVisible(){return Ye(this,ir).hidden===!1}}Ut=new WeakMap,hr=new WeakMap,pt=new WeakMap,yr=new WeakMap,vr=new WeakMap,wr=new WeakMap,ir=new WeakMap,sr=new WeakMap,kt=new WeakMap,rr=new WeakMap,lr=new WeakMap,mr=new WeakMap,Ir=new WeakMap,Or=new WeakMap,Fr=new WeakMap,Et=new WeakMap,dr=new WeakMap,br=new WeakSet,Ri=function(er){er.altKey||er.shiftKey||er.ctrlKey||er.metaKey||(er.key==="Enter"||er.key==="Escape"&&Ye(this,mr))&&fr(this,br,kn).call(this)},kn=function(){Ar(this,mr,!Ye(this,mr)),Ye(this,mr)?(fr(this,br,pa).call(this),Ye(this,ir).addEventListener("click",Ye(this,vr)),Ye(this,ir).addEventListener("keydown",Ye(this,hr))):(fr(this,br,ma).call(this),Ye(this,ir).removeEventListener("click",Ye(this,vr)),Ye(this,ir).removeEventListener("keydown",Ye(this,hr)))},pa=function(){Ye(this,Ir)||this.render(),this.isVisible?Ye(this,mr)&&Ye(this,ir).classList.add("focused"):(Ye(this,ir).hidden=!1,Ye(this,ir).style.zIndex=parseInt(Ye(this,ir).style.zIndex)+1e3)},ma=function(){Ye(this,ir).classList.remove("focused"),!(Ye(this,mr)||!this.isVisible)&&(Ye(this,ir).hidden=!0,Ye(this,ir).style.zIndex=parseInt(Ye(this,ir).style.zIndex)-1e3)};class Ge extends Re{constructor(er){super(er,{isRenderable:!0,ignoreBorder:!0}),this.textContent=er.data.textContent,this.textPosition=er.data.textPosition,this.annotationEditorType=T.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const er=document.createElement("div");er.classList.add("annotationTextContent"),er.setAttribute("role","comment");for(const Bt of this.textContent){const cr=document.createElement("span");cr.textContent=Bt,er.append(cr)}this.container.append(er)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}r.FreeTextAnnotationElement=Ge;class Ie extends Re{constructor(Bt){super(Bt,{isRenderable:!0,ignoreBorder:!0});Tr(this,gr,null)}render(){this.container.classList.add("lineAnnotation");const Bt=this.data,{width:cr,height:_r}=me(Bt.rect),jr=this.svgFactory.create(cr,_r,!0),Mr=Ar(this,gr,this.svgFactory.createElement("svg:line"));return Mr.setAttribute("x1",Bt.rect[2]-Bt.lineCoordinates[0]),Mr.setAttribute("y1",Bt.rect[3]-Bt.lineCoordinates[1]),Mr.setAttribute("x2",Bt.rect[2]-Bt.lineCoordinates[2]),Mr.setAttribute("y2",Bt.rect[3]-Bt.lineCoordinates[3]),Mr.setAttribute("stroke-width",Bt.borderStyle.width||1),Mr.setAttribute("stroke","transparent"),Mr.setAttribute("fill","transparent"),jr.append(Mr),this.container.append(jr),!Bt.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return Ye(this,gr)}addHighlightArea(){this.container.classList.add("highlightArea")}}gr=new WeakMap;class Le extends Re{constructor(Bt){super(Bt,{isRenderable:!0,ignoreBorder:!0});Tr(this,$r,null)}render(){this.container.classList.add("squareAnnotation");const Bt=this.data,{width:cr,height:_r}=me(Bt.rect),jr=this.svgFactory.create(cr,_r,!0),Mr=Bt.borderStyle.width,Vr=Ar(this,$r,this.svgFactory.createElement("svg:rect"));return Vr.setAttribute("x",Mr/2),Vr.setAttribute("y",Mr/2),Vr.setAttribute("width",cr-Mr),Vr.setAttribute("height",_r-Mr),Vr.setAttribute("stroke-width",Mr||1),Vr.setAttribute("stroke","transparent"),Vr.setAttribute("fill","transparent"),jr.append(Vr),this.container.append(jr),!Bt.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return Ye(this,$r)}addHighlightArea(){this.container.classList.add("highlightArea")}}$r=new WeakMap;class He extends Re{constructor(Bt){super(Bt,{isRenderable:!0,ignoreBorder:!0});Tr(this,Xr,null)}render(){this.container.classList.add("circleAnnotation");const Bt=this.data,{width:cr,height:_r}=me(Bt.rect),jr=this.svgFactory.create(cr,_r,!0),Mr=Bt.borderStyle.width,Vr=Ar(this,Xr,this.svgFactory.createElement("svg:ellipse"));return Vr.setAttribute("cx",cr/2),Vr.setAttribute("cy",_r/2),Vr.setAttribute("rx",cr/2-Mr/2),Vr.setAttribute("ry",_r/2-Mr/2),Vr.setAttribute("stroke-width",Mr||1),Vr.setAttribute("stroke","transparent"),Vr.setAttribute("fill","transparent"),jr.append(Vr),this.container.append(jr),!Bt.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return Ye(this,Xr)}addHighlightArea(){this.container.classList.add("highlightArea")}}Xr=new WeakMap;class Ct extends Re{constructor(Bt){super(Bt,{isRenderable:!0,ignoreBorder:!0});Tr(this,Rr,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const Bt=this.data,{width:cr,height:_r}=me(Bt.rect),jr=this.svgFactory.create(cr,_r,!0);let Mr=[];for(const Zr of Bt.vertices){const Jr=Zr.x-Bt.rect[0],et=Bt.rect[3]-Zr.y;Mr.push(Jr+","+et)}Mr=Mr.join(" ");const Vr=Ar(this,Rr,this.svgFactory.createElement(this.svgElementName));return Vr.setAttribute("points",Mr),Vr.setAttribute("stroke-width",Bt.borderStyle.width||1),Vr.setAttribute("stroke","transparent"),Vr.setAttribute("fill","transparent"),jr.append(Vr),this.container.append(jr),!Bt.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return Ye(this,Rr)}addHighlightArea(){this.container.classList.add("highlightArea")}}Rr=new WeakMap;class Ze extends Ct{constructor(er){super(er),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Rt extends Re{constructor(er){super(er,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class nt extends Re{constructor(Bt){super(Bt,{isRenderable:!0,ignoreBorder:!0});Tr(this,pr,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=T.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const Bt=this.data,{width:cr,height:_r}=me(Bt.rect),jr=this.svgFactory.create(cr,_r,!0);for(const Mr of Bt.inkLists){let Vr=[];for(const Jr of Mr){const et=Jr.x-Bt.rect[0],Gt=Bt.rect[3]-Jr.y;Vr.push(`${et},${Gt}`)}Vr=Vr.join(" ");const Zr=this.svgFactory.createElement(this.svgElementName);Ye(this,pr).push(Zr),Zr.setAttribute("points",Vr),Zr.setAttribute("stroke-width",Bt.borderStyle.width||1),Zr.setAttribute("stroke","transparent"),Zr.setAttribute("fill","transparent"),!Bt.popupRef&&this.hasPopupData&&this._createPopup(),jr.append(Zr)}return this.container.append(jr),this.container}getElementsToTriggerPopup(){return Ye(this,pr)}addHighlightArea(){this.container.classList.add("highlightArea")}}pr=new WeakMap,r.InkAnnotationElement=nt;class nr extends Re{constructor(er){super(er,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class Je extends Re{constructor(er){super(er,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class Wt extends Re{constructor(er){super(er,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class Lt extends Re{constructor(er){super(er,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class qe extends Re{constructor(er){super(er,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}r.StampAnnotationElement=qe;class $e extends Re{constructor(Bt){var jr;super(Bt,{isRenderable:!0});Tr(this,qr);Tr(this,xr,null);const{filename:cr,content:_r}=this.data.file;this.filename=(0,w.getFilenameFromUrl)(cr,!0),this.content=_r,(jr=this.linkService.eventBus)==null||jr.dispatch("fileattachmentannotation",{source:this,filename:cr,content:_r})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:Bt,data:cr}=this;let _r;cr.hasAppearance||cr.fillAlpha===0?_r=document.createElement("div"):(_r=document.createElement("img"),_r.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(cr.name)?"paperclip":"pushpin"}.svg`,cr.fillAlpha&&cr.fillAlpha<1&&(_r.style=`filter: opacity(${Math.round(cr.fillAlpha*100)}%);`)),_r.addEventListener("dblclick",fr(this,qr,ga).bind(this)),Ar(this,xr,_r);const{isMac:jr}=T.FeatureTest.platform;return Bt.addEventListener("keydown",Mr=>{Mr.key==="Enter"&&(jr?Mr.metaKey:Mr.ctrlKey)&&fr(this,qr,ga).call(this)}),!cr.popupRef&&this.hasPopupData?this._createPopup():_r.classList.add("popupTriggerArea"),Bt.append(_r),Bt}getElementsToTriggerPopup(){return Ye(this,xr)}addHighlightArea(){this.container.classList.add("highlightArea")}}xr=new WeakMap,qr=new WeakSet,ga=function(){var Bt;(Bt=this.downloadManager)==null||Bt.openOrDownloadData(this.container,this.content,this.filename)};class Be{constructor({div:er,accessibilityManager:Bt,annotationCanvasMap:cr,l10n:_r,page:jr,viewport:Mr}){Tr(this,zr);Tr(this,ss,null);Tr(this,ar,null);Tr(this,Sr,new Map);this.div=er,Ar(this,ss,Bt),Ar(this,ar,cr),this.l10n=_r,this.page=jr,this.viewport=Mr,this.zIndex=0,this.l10n||(this.l10n=H.NullL10n)}async render(er){const{annotations:Bt}=er,cr=this.div;(0,w.setLayerDimensions)(cr,this.viewport);const _r=new Map,jr={data:null,layer:cr,linkService:er.linkService,downloadManager:er.downloadManager,imageResourcesPath:er.imageResourcesPath||"",renderForms:er.renderForms!==!1,svgFactory:new w.DOMSVGFactory,annotationStorage:er.annotationStorage||new S.AnnotationStorage,enableScripting:er.enableScripting===!0,hasJSActions:er.hasJSActions,fieldObjects:er.fieldObjects,parent:this,elements:null};for(const Mr of Bt){if(Mr.noHTML)continue;const Vr=Mr.annotationType===T.AnnotationType.POPUP;if(Vr){const et=_r.get(Mr.id);if(!et)continue;jr.elements=et}else{const{width:et,height:Gt}=me(Mr.rect);if(et<=0||Gt<=0)continue}jr.data=Mr;const Zr=_e.create(jr);if(!Zr.isRenderable)continue;if(!Vr&&Mr.popupRef){const et=_r.get(Mr.popupRef);et?et.push(Zr):_r.set(Mr.popupRef,[Zr])}Zr.annotationEditorType>0&&Ye(this,Sr).set(Zr.data.id,Zr);const Jr=Zr.render();Mr.hidden&&(Jr.style.visibility="hidden"),fr(this,zr,Ti).call(this,Jr,Mr.id)}fr(this,zr,_a).call(this),await this.l10n.translate(cr)}update({viewport:er}){const Bt=this.div;this.viewport=er,(0,w.setLayerDimensions)(Bt,{rotation:er.rotation}),fr(this,zr,_a).call(this),Bt.hidden=!1}getEditableAnnotations(){return Array.from(Ye(this,Sr).values())}getEditableAnnotation(er){return Ye(this,Sr).get(er)}}ss=new WeakMap,ar=new WeakMap,Sr=new WeakMap,zr=new WeakSet,Ti=function(er,Bt){var _r;const cr=er.firstChild||er;cr.id=`${T.AnnotationPrefix}${Bt}`,this.div.append(er),(_r=Ye(this,ss))==null||_r.moveElementInDOM(this.div,er,cr,!1)},_a=function(){if(!Ye(this,ar))return;const er=this.div;for(const[Bt,cr]of Ye(this,ar)){const _r=er.querySelector(`[data-annotation-id="${Bt}"]`);if(!_r)continue;const{firstChild:jr}=_r;jr?jr.nodeName==="CANVAS"?jr.replaceWith(cr):jr.before(cr):_r.append(cr)}Ye(this,ar).clear()},r.AnnotationLayer=Be},(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ColorConverters=void 0;function v(S){return Math.floor(Math.max(0,Math.min(1,S))*255).toString(16).padStart(2,"0")}function T(S){return Math.max(0,Math.min(255,255*S))}class w{static CMYK_G([I,H,te,ae]){return["G",1-Math.min(1,.3*I+.59*te+.11*H+ae)]}static G_CMYK([I]){return["CMYK",0,0,0,1-I]}static G_RGB([I]){return["RGB",I,I,I]}static G_rgb([I]){return I=T(I),[I,I,I]}static G_HTML([I]){const H=v(I);return`#${H}${H}${H}`}static RGB_G([I,H,te]){return["G",.3*I+.59*H+.11*te]}static RGB_rgb(I){return I.map(T)}static RGB_HTML(I){return`#${I.map(v).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([I,H,te,ae]){return["RGB",1-Math.min(1,I+ae),1-Math.min(1,te+ae),1-Math.min(1,H+ae)]}static CMYK_rgb([I,H,te,ae]){return[T(1-Math.min(1,I+ae)),T(1-Math.min(1,te+ae)),T(1-Math.min(1,H+ae))]}static CMYK_HTML(I){const H=this.CMYK_RGB(I).slice(1);return this.RGB_HTML(H)}static RGB_CMYK([I,H,te]){const ae=1-I,ie=1-H,ce=1-te,me=Math.min(ae,ie,ce);return["CMYK",ae,ie,ce,me]}}r.ColorConverters=w},(E,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.NullL10n=void 0,r.getL10nFallback=T;const v={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};v.print_progress_percent="{{progress}}%";function T(I,H){switch(I){case"find_match_count":I=`find_match_count[${H.total===1?"one":"other"}]`;break;case"find_match_count_limit":I=`find_match_count_limit[${H.limit===1?"one":"other"}]`;break}return v[I]||""}function w(I,H){return H?I.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(te,ae)=>ae in H?H[ae]:"{{"+ae+"}}"):I}const S={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(I,H=null,te=T(I,H)){return w(te,H)},async translate(I){}};r.NullL10n=S},(E,r,v)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.XfaLayer=void 0;var T=v(25);class w{static setupStorage(I,H,te,ae,ie){const ce=ae.getValue(H,{value:null});switch(te.name){case"textarea":if(ce.value!==null&&(I.textContent=ce.value),ie==="print")break;I.addEventListener("input",me=>{ae.setValue(H,{value:me.target.value})});break;case"input":if(te.attributes.type==="radio"||te.attributes.type==="checkbox"){if(ce.value===te.attributes.xfaOn?I.setAttribute("checked",!0):ce.value===te.attributes.xfaOff&&I.removeAttribute("checked"),ie==="print")break;I.addEventListener("change",me=>{ae.setValue(H,{value:me.target.checked?me.target.getAttribute("xfaOn"):me.target.getAttribute("xfaOff")})})}else{if(ce.value!==null&&I.setAttribute("value",ce.value),ie==="print")break;I.addEventListener("input",me=>{ae.setValue(H,{value:me.target.value})})}break;case"select":if(ce.value!==null){I.setAttribute("value",ce.value);for(const me of te.children)me.attributes.value===ce.value?me.attributes.selected=!0:me.attributes.hasOwnProperty("selected")&&delete me.attributes.selected}I.addEventListener("input",me=>{const _e=me.target.options,Re=_e.selectedIndex===-1?"":_e[_e.selectedIndex].value;ae.setValue(H,{value:Re})});break}}static setAttributes({html:I,element:H,storage:te=null,intent:ae,linkService:ie}){const{attributes:ce}=H,me=I instanceof HTMLAnchorElement;ce.type==="radio"&&(ce.name=`${ce.name}-${ae}`);for(const[_e,Re]of Object.entries(ce))if(Re!=null)switch(_e){case"class":Re.length&&I.setAttribute(_e,Re.join(" "));break;case"dataId":break;case"id":I.setAttribute("data-element-id",Re);break;case"style":Object.assign(I.style,Re);break;case"textContent":I.textContent=Re;break;default:(!me||_e!=="href"&&_e!=="newWindow")&&I.setAttribute(_e,Re)}me&&ie.addLinkAttributes(I,ce.href,ce.newWindow),te&&ce.dataId&&this.setupStorage(I,ce.dataId,H,te)}static render(I){var Pe;const H=I.annotationStorage,te=I.linkService,ae=I.xfaHtml,ie=I.intent||"display",ce=document.createElement(ae.name);ae.attributes&&this.setAttributes({html:ce,element:ae,intent:ie,linkService:te});const me=[[ae,-1,ce]],_e=I.div;if(_e.append(ce),I.viewport){const Ce=`matrix(${I.viewport.transform.join(",")})`;_e.style.transform=Ce}ie!=="richText"&&_e.setAttribute("class","xfaLayer xfaFont");const Re=[];for(;me.length>0;){const[Ce,Fe,Me]=me.at(-1);if(Fe+1===Ce.children.length){me.pop();continue}const Ve=Ce.children[++me.at(-1)[1]];if(Ve===null)continue;const{name:We}=Ve;if(We==="#text"){const Ue=document.createTextNode(Ve.value);Re.push(Ue),Me.append(Ue);continue}const ze=(Pe=Ve==null?void 0:Ve.attributes)!=null&&Pe.xmlns?document.createElementNS(Ve.attributes.xmlns,We):document.createElement(We);if(Me.append(ze),Ve.attributes&&this.setAttributes({html:ze,element:Ve,storage:H,intent:ie,linkService:te}),Ve.children&&Ve.children.length>0)me.push([Ve,-1,ze]);else if(Ve.value){const Ue=document.createTextNode(Ve.value);T.XfaText.shouldBuildText(We)&&Re.push(Ue),ze.append(Ue)}}for(const Ce of _e.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))Ce.setAttribute("readOnly",!0);return{textDivs:Re}}static update(I){const H=`matrix(${I.viewport.transform.join(",")})`;I.div.style.transform=H,I.div.hidden=!1}}r.XfaLayer=w},(E,r,v)=>{var ae,ie,ce,me,_e,Re,Pe,Ce,Fe,Me,Ve,We,ze,Ue,je,bi,Ai,wi,Si,xa,Ci,Ea,Pi,ji,Ii,ki,Ni,As,va,Nn,Dn,Bs,ya,Fn,Qe,Di,Ra,Fi,Li,Ta,Ln,Us;Object.defineProperty(r,"__esModule",{value:!0}),r.InkEditor=void 0;var T=v(1),w=v(4),S=v(29),I=v(6),H=v(5);const wr=class wr extends w.AnnotationEditor{constructor(kt){super({...kt,name:"inkEditor"});Tr(this,je);Tr(this,ae,0);Tr(this,ie,0);Tr(this,ce,this.canvasPointermove.bind(this));Tr(this,me,this.canvasPointerleave.bind(this));Tr(this,_e,this.canvasPointerup.bind(this));Tr(this,Re,this.canvasPointerdown.bind(this));Tr(this,Pe,new Path2D);Tr(this,Ce,!1);Tr(this,Fe,!1);Tr(this,Me,!1);Tr(this,Ve,null);Tr(this,We,0);Tr(this,ze,0);Tr(this,Ue,null);this.color=kt.color||null,this.thickness=kt.thickness||null,this.opacity=kt.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(kt){w.AnnotationEditor.initialize(kt,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(kt,rr){switch(kt){case T.AnnotationEditorParamsType.INK_THICKNESS:wr._defaultThickness=rr;break;case T.AnnotationEditorParamsType.INK_COLOR:wr._defaultColor=rr;break;case T.AnnotationEditorParamsType.INK_OPACITY:wr._defaultOpacity=rr/100;break}}updateParams(kt,rr){switch(kt){case T.AnnotationEditorParamsType.INK_THICKNESS:fr(this,je,bi).call(this,rr);break;case T.AnnotationEditorParamsType.INK_COLOR:fr(this,je,Ai).call(this,rr);break;case T.AnnotationEditorParamsType.INK_OPACITY:fr(this,je,wi).call(this,rr);break}}static get defaultPropertiesToUpdate(){return[[T.AnnotationEditorParamsType.INK_THICKNESS,wr._defaultThickness],[T.AnnotationEditorParamsType.INK_COLOR,wr._defaultColor||w.AnnotationEditor._defaultLineColor],[T.AnnotationEditorParamsType.INK_OPACITY,Math.round(wr._defaultOpacity*100)]]}get propertiesToUpdate(){return[[T.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||wr._defaultThickness],[T.AnnotationEditorParamsType.INK_COLOR,this.color||wr._defaultColor||w.AnnotationEditor._defaultLineColor],[T.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??wr._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(fr(this,je,Nn).call(this),fr(this,je,Dn).call(this)),this.isAttachedToDOM||(this.parent.add(this),fr(this,je,Bs).call(this)),fr(this,je,Us).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,Ye(this,Ve).disconnect(),Ar(this,Ve,null),super.remove())}setParent(kt){!this.parent&&kt?this._uiManager.removeShouldRescale(this):this.parent&&kt===null&&this._uiManager.addShouldRescale(this),super.setParent(kt)}onScaleChanging(){const[kt,rr]=this.parentDimensions,lr=this.width*kt,mr=this.height*rr;this.setDimensions(lr,mr)}enableEditMode(){Ye(this,Ce)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",Ye(this,Re)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",Ye(this,Re)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){Ye(this,Ce)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),Ar(this,Ce,!0),this.div.classList.add("disabled"),fr(this,je,Us).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(kt){this._focusEventsAllowed&&(super.focusin(kt),this.enableEditMode())}canvasPointerdown(kt){kt.button!==0||!this.isInEditMode()||Ye(this,Ce)||(this.setInForeground(),kt.preventDefault(),kt.type!=="mouse"&&this.div.focus(),fr(this,je,Ci).call(this,kt.offsetX,kt.offsetY))}canvasPointermove(kt){kt.preventDefault(),fr(this,je,Ea).call(this,kt.offsetX,kt.offsetY)}canvasPointerup(kt){kt.preventDefault(),fr(this,je,va).call(this,kt)}canvasPointerleave(kt){fr(this,je,va).call(this,kt)}get isResizable(){return!this.isEmpty()&&Ye(this,Ce)}render(){if(this.div)return this.div;let kt,rr;this.width&&(kt=this.x,rr=this.y),super.render(),w.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(Fr=>{var Et;return(Et=this.div)==null?void 0:Et.setAttribute("aria-label",Fr)});const[lr,mr,Ir,Or]=fr(this,je,Si).call(this);if(this.setAt(lr,mr,0,0),this.setDims(Ir,Or),fr(this,je,Nn).call(this),this.width){const[Fr,Et]=this.parentDimensions;this.setAspectRatio(this.width*Fr,this.height*Et),this.setAt(kt*Fr,rr*Et,this.width*Fr,this.height*Et),Ar(this,Me,!0),fr(this,je,Bs).call(this),this.setDims(this.width*Fr,this.height*Et),fr(this,je,As).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return fr(this,je,Dn).call(this),this.div}setDimensions(kt,rr){const lr=Math.round(kt),mr=Math.round(rr);if(Ye(this,We)===lr&&Ye(this,ze)===mr)return;Ar(this,We,lr),Ar(this,ze,mr),this.canvas.style.visibility="hidden";const[Ir,Or]=this.parentDimensions;this.width=kt/Ir,this.height=rr/Or,this.fixAndSetPosition(),Ye(this,Ce)&&fr(this,je,ya).call(this,kt,rr),fr(this,je,Bs).call(this),fr(this,je,As).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(kt,rr,lr){var gr,$r,Xr;if(kt instanceof S.InkAnnotationElement)return null;const mr=super.deserialize(kt,rr,lr);mr.thickness=kt.thickness,mr.color=T.Util.makeHexColor(...kt.color),mr.opacity=kt.opacity;const[Ir,Or]=mr.pageDimensions,Fr=mr.width*Ir,Et=mr.height*Or,dr=mr.parentScale,br=kt.thickness/2;Ar(mr,Ce,!0),Ar(mr,We,Math.round(Fr)),Ar(mr,ze,Math.round(Et));const{paths:Br,rect:Lr,rotation:or}=kt;for(let{bezier:Rr}of Br){Rr=fr(gr=wr,Qe,Fi).call(gr,Rr,Lr,or);const pr=[];mr.paths.push(pr);let xr=dr*(Rr[0]-br),qr=dr*(Rr[1]-br);for(let ss=2,ar=Rr.length;ss<ar;ss+=6){const Sr=dr*(Rr[ss]-br),zr=dr*(Rr[ss+1]-br),Gr=dr*(Rr[ss+2]-br),Qr=dr*(Rr[ss+3]-br),Wr=dr*(Rr[ss+4]-br),er=dr*(Rr[ss+5]-br);pr.push([[xr,qr],[Sr,zr],[Gr,Qr],[Wr,er]]),xr=Wr,qr=er}const ns=fr(this,Qe,Di).call(this,pr);mr.bezierPath2D.push(ns)}const ur=fr($r=mr,je,Ta).call($r);return Ar(mr,ie,Math.max(w.AnnotationEditor.MIN_SIZE,ur[2]-ur[0])),Ar(mr,ae,Math.max(w.AnnotationEditor.MIN_SIZE,ur[3]-ur[1])),fr(Xr=mr,je,ya).call(Xr,Fr,Et),mr}serialize(){if(this.isEmpty())return null;const kt=this.getRect(0,0),rr=w.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:T.AnnotationEditorType.INK,color:rr,thickness:this.thickness,opacity:this.opacity,paths:fr(this,je,Li).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,kt),pageIndex:this.pageIndex,rect:kt,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};ae=new WeakMap,ie=new WeakMap,ce=new WeakMap,me=new WeakMap,_e=new WeakMap,Re=new WeakMap,Pe=new WeakMap,Ce=new WeakMap,Fe=new WeakMap,Me=new WeakMap,Ve=new WeakMap,We=new WeakMap,ze=new WeakMap,Ue=new WeakMap,je=new WeakSet,bi=function(kt){const rr=this.thickness;this.addCommands({cmd:()=>{this.thickness=kt,fr(this,je,Us).call(this)},undo:()=>{this.thickness=rr,fr(this,je,Us).call(this)},mustExec:!0,type:T.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},Ai=function(kt){const rr=this.color;this.addCommands({cmd:()=>{this.color=kt,fr(this,je,As).call(this)},undo:()=>{this.color=rr,fr(this,je,As).call(this)},mustExec:!0,type:T.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},wi=function(kt){kt/=100;const rr=this.opacity;this.addCommands({cmd:()=>{this.opacity=kt,fr(this,je,As).call(this)},undo:()=>{this.opacity=rr,fr(this,je,As).call(this)},mustExec:!0,type:T.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},Si=function(){const{parentRotation:kt,parentDimensions:[rr,lr]}=this;switch(kt){case 90:return[0,lr,lr,rr];case 180:return[rr,lr,rr,lr];case 270:return[rr,0,lr,rr];default:return[0,0,rr,lr]}},xa=function(){const{ctx:kt,color:rr,opacity:lr,thickness:mr,parentScale:Ir,scaleFactor:Or}=this;kt.lineWidth=mr*Ir/Or,kt.lineCap="round",kt.lineJoin="round",kt.miterLimit=10,kt.strokeStyle=`${rr}${(0,H.opacityToHex)(lr)}`},Ci=function(kt,rr){this.canvas.addEventListener("contextmenu",I.noContextMenu),this.canvas.addEventListener("pointerleave",Ye(this,me)),this.canvas.addEventListener("pointermove",Ye(this,ce)),this.canvas.addEventListener("pointerup",Ye(this,_e)),this.canvas.removeEventListener("pointerdown",Ye(this,Re)),this.isEditing=!0,Ye(this,Me)||(Ar(this,Me,!0),fr(this,je,Bs).call(this),this.thickness||(this.thickness=wr._defaultThickness),this.color||(this.color=wr._defaultColor||w.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=wr._defaultOpacity)),this.currentPath.push([kt,rr]),Ar(this,Fe,!1),fr(this,je,xa).call(this),Ar(this,Ue,()=>{fr(this,je,Ii).call(this),Ye(this,Ue)&&window.requestAnimationFrame(Ye(this,Ue))}),window.requestAnimationFrame(Ye(this,Ue))},Ea=function(kt,rr){const[lr,mr]=this.currentPath.at(-1);if(this.currentPath.length>1&&kt===lr&&rr===mr)return;const Ir=this.currentPath;let Or=Ye(this,Pe);if(Ir.push([kt,rr]),Ar(this,Fe,!0),Ir.length<=2){Or.moveTo(...Ir[0]),Or.lineTo(kt,rr);return}Ir.length===3&&(Ar(this,Pe,Or=new Path2D),Or.moveTo(...Ir[0])),fr(this,je,ki).call(this,Or,...Ir.at(-3),...Ir.at(-2),kt,rr)},Pi=function(){if(this.currentPath.length===0)return;const kt=this.currentPath.at(-1);Ye(this,Pe).lineTo(...kt)},ji=function(kt,rr){Ar(this,Ue,null),kt=Math.min(Math.max(kt,0),this.canvas.width),rr=Math.min(Math.max(rr,0),this.canvas.height),fr(this,je,Ea).call(this,kt,rr),fr(this,je,Pi).call(this);let lr;if(this.currentPath.length!==1)lr=fr(this,je,Ni).call(this);else{const Et=[kt,rr];lr=[[Et,Et.slice(),Et.slice(),Et]]}const mr=Ye(this,Pe),Ir=this.currentPath;this.currentPath=[],Ar(this,Pe,new Path2D);const Or=()=>{this.allRawPaths.push(Ir),this.paths.push(lr),this.bezierPath2D.push(mr),this.rebuild()},Fr=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(fr(this,je,Nn).call(this),fr(this,je,Dn).call(this)),fr(this,je,Us).call(this))};this.addCommands({cmd:Or,undo:Fr,mustExec:!0})},Ii=function(){if(!Ye(this,Fe))return;Ar(this,Fe,!1);const kt=Math.ceil(this.thickness*this.parentScale),rr=this.currentPath.slice(-3),lr=rr.map(Or=>Or[0]),mr=rr.map(Or=>Or[1]);Math.min(...lr)-kt,Math.max(...lr)+kt,Math.min(...mr)-kt,Math.max(...mr)+kt;const{ctx:Ir}=this;Ir.save(),Ir.clearRect(0,0,this.canvas.width,this.canvas.height);for(const Or of this.bezierPath2D)Ir.stroke(Or);Ir.stroke(Ye(this,Pe)),Ir.restore()},ki=function(kt,rr,lr,mr,Ir,Or,Fr){const Et=(rr+mr)/2,dr=(lr+Ir)/2,br=(mr+Or)/2,Br=(Ir+Fr)/2;kt.bezierCurveTo(Et+2*(mr-Et)/3,dr+2*(Ir-dr)/3,br+2*(mr-br)/3,Br+2*(Ir-Br)/3,br,Br)},Ni=function(){const kt=this.currentPath;if(kt.length<=2)return[[kt[0],kt[0],kt.at(-1),kt.at(-1)]];const rr=[];let lr,[mr,Ir]=kt[0];for(lr=1;lr<kt.length-2;lr++){const[Lr,or]=kt[lr],[ur,gr]=kt[lr+1],$r=(Lr+ur)/2,Xr=(or+gr)/2,Rr=[mr+2*(Lr-mr)/3,Ir+2*(or-Ir)/3],pr=[$r+2*(Lr-$r)/3,Xr+2*(or-Xr)/3];rr.push([[mr,Ir],Rr,pr,[$r,Xr]]),[mr,Ir]=[$r,Xr]}const[Or,Fr]=kt[lr],[Et,dr]=kt[lr+1],br=[mr+2*(Or-mr)/3,Ir+2*(Fr-Ir)/3],Br=[Et+2*(Or-Et)/3,dr+2*(Fr-dr)/3];return rr.push([[mr,Ir],br,Br,[Et,dr]]),rr},As=function(){if(this.isEmpty()){fr(this,je,Fn).call(this);return}fr(this,je,xa).call(this);const{canvas:kt,ctx:rr}=this;rr.setTransform(1,0,0,1,0,0),rr.clearRect(0,0,kt.width,kt.height),fr(this,je,Fn).call(this);for(const lr of this.bezierPath2D)rr.stroke(lr)},va=function(kt){this.canvas.removeEventListener("pointerleave",Ye(this,me)),this.canvas.removeEventListener("pointermove",Ye(this,ce)),this.canvas.removeEventListener("pointerup",Ye(this,_e)),this.canvas.addEventListener("pointerdown",Ye(this,Re)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",I.noContextMenu)},10),fr(this,je,ji).call(this,kt.offsetX,kt.offsetY),this.addToAnnotationStorage(),this.setInBackground()},Nn=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",w.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(kt=>{var rr;return(rr=this.canvas)==null?void 0:rr.setAttribute("aria-label",kt)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Dn=function(){Ar(this,Ve,new ResizeObserver(kt=>{const rr=kt[0].contentRect;rr.width&&rr.height&&this.setDimensions(rr.width,rr.height)})),Ye(this,Ve).observe(this.div)},Bs=function(){if(!Ye(this,Me))return;const[kt,rr]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*kt),this.canvas.height=Math.ceil(this.height*rr),fr(this,je,Fn).call(this)},ya=function(kt,rr){const lr=fr(this,je,Ln).call(this),mr=(kt-lr)/Ye(this,ie),Ir=(rr-lr)/Ye(this,ae);this.scaleFactor=Math.min(mr,Ir)},Fn=function(){const kt=fr(this,je,Ln).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+kt,this.translationY*this.scaleFactor+kt)},Qe=new WeakSet,Di=function(kt){const rr=new Path2D;for(let lr=0,mr=kt.length;lr<mr;lr++){const[Ir,Or,Fr,Et]=kt[lr];lr===0&&rr.moveTo(...Ir),rr.bezierCurveTo(Or[0],Or[1],Fr[0],Fr[1],Et[0],Et[1])}return rr},Ra=function(kt,rr,lr){const[mr,Ir,Or,Fr]=rr;switch(lr){case 0:for(let Et=0,dr=kt.length;Et<dr;Et+=2)kt[Et]+=mr,kt[Et+1]=Fr-kt[Et+1];break;case 90:for(let Et=0,dr=kt.length;Et<dr;Et+=2){const br=kt[Et];kt[Et]=kt[Et+1]+mr,kt[Et+1]=br+Ir}break;case 180:for(let Et=0,dr=kt.length;Et<dr;Et+=2)kt[Et]=Or-kt[Et],kt[Et+1]+=Ir;break;case 270:for(let Et=0,dr=kt.length;Et<dr;Et+=2){const br=kt[Et];kt[Et]=Or-kt[Et+1],kt[Et+1]=Fr-br}break;default:throw new Error("Invalid rotation")}return kt},Fi=function(kt,rr,lr){const[mr,Ir,Or,Fr]=rr;switch(lr){case 0:for(let Et=0,dr=kt.length;Et<dr;Et+=2)kt[Et]-=mr,kt[Et+1]=Fr-kt[Et+1];break;case 90:for(let Et=0,dr=kt.length;Et<dr;Et+=2){const br=kt[Et];kt[Et]=kt[Et+1]-Ir,kt[Et+1]=br-mr}break;case 180:for(let Et=0,dr=kt.length;Et<dr;Et+=2)kt[Et]=Or-kt[Et],kt[Et+1]-=Ir;break;case 270:for(let Et=0,dr=kt.length;Et<dr;Et+=2){const br=kt[Et];kt[Et]=Fr-kt[Et+1],kt[Et+1]=Or-br}break;default:throw new Error("Invalid rotation")}return kt},Li=function(kt,rr,lr,mr){var dr,br;const Ir=[],Or=this.thickness/2,Fr=kt*rr+Or,Et=kt*lr+Or;for(const Br of this.paths){const Lr=[],or=[];for(let ur=0,gr=Br.length;ur<gr;ur++){const[$r,Xr,Rr,pr]=Br[ur],xr=kt*$r[0]+Fr,qr=kt*$r[1]+Et,ns=kt*Xr[0]+Fr,ss=kt*Xr[1]+Et,ar=kt*Rr[0]+Fr,Sr=kt*Rr[1]+Et,zr=kt*pr[0]+Fr,Gr=kt*pr[1]+Et;ur===0&&(Lr.push(xr,qr),or.push(xr,qr)),Lr.push(ns,ss,ar,Sr,zr,Gr),or.push(ns,ss),ur===gr-1&&or.push(zr,Gr)}Ir.push({bezier:fr(dr=wr,Qe,Ra).call(dr,Lr,mr,this.rotation),points:fr(br=wr,Qe,Ra).call(br,or,mr,this.rotation)})}return Ir},Ta=function(){let kt=1/0,rr=-1/0,lr=1/0,mr=-1/0;for(const Ir of this.paths)for(const[Or,Fr,Et,dr]of Ir){const br=T.Util.bezierBoundingBox(...Or,...Fr,...Et,...dr);kt=Math.min(kt,br[0]),lr=Math.min(lr,br[1]),rr=Math.max(rr,br[2]),mr=Math.max(mr,br[3])}return[kt,lr,rr,mr]},Ln=function(){return Ye(this,Ce)?Math.ceil(this.thickness*this.parentScale):0},Us=function(kt=!1){if(this.isEmpty())return;if(!Ye(this,Ce)){fr(this,je,As).call(this);return}const rr=fr(this,je,Ta).call(this),lr=fr(this,je,Ln).call(this);Ar(this,ie,Math.max(w.AnnotationEditor.MIN_SIZE,rr[2]-rr[0])),Ar(this,ae,Math.max(w.AnnotationEditor.MIN_SIZE,rr[3]-rr[1]));const mr=Math.ceil(lr+Ye(this,ie)*this.scaleFactor),Ir=Math.ceil(lr+Ye(this,ae)*this.scaleFactor),[Or,Fr]=this.parentDimensions;this.width=mr/Or,this.height=Ir/Fr,this.setAspectRatio(mr,Ir);const Et=this.translationX,dr=this.translationY;this.translationX=-rr[0],this.translationY=-rr[1],fr(this,je,Bs).call(this),fr(this,je,As).call(this),Ar(this,We,mr),Ar(this,ze,Ir),this.setDims(mr,Ir);const br=kt?lr/this.scaleFactor/2:0;this.translate(Et-this.translationX-br,dr-this.translationY-br)},Tr(wr,Qe),cs(wr,"_defaultColor",null),cs(wr,"_defaultOpacity",1),cs(wr,"_defaultThickness",1),cs(wr,"_type","ink");let te=wr;r.InkEditor=te},(E,r,v)=>{var te,ae,ie,ce,me,_e,Re,Pe,Ce,Fe,Me,hn,dn,Mn,ba,Mi,Oi,Aa,On,Vi;Object.defineProperty(r,"__esModule",{value:!0}),r.StampEditor=void 0;var T=v(1),w=v(4),S=v(6),I=v(29);const Le=class Le extends w.AnnotationEditor{constructor(Ze){super({...Ze,name:"stampEditor"});Tr(this,Me);Tr(this,te,null);Tr(this,ae,null);Tr(this,ie,null);Tr(this,ce,null);Tr(this,me,null);Tr(this,_e,null);Tr(this,Re,null);Tr(this,Pe,null);Tr(this,Ce,!1);Tr(this,Fe,!1);Ar(this,ce,Ze.bitmapUrl),Ar(this,me,Ze.bitmapFile)}static initialize(Ze){w.AnnotationEditor.initialize(Ze)}static get supportedTypes(){const Ze=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,T.shadow)(this,"supportedTypes",Ze.map(Rt=>`image/${Rt}`))}static get supportedTypesStr(){return(0,T.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(Ze){return this.supportedTypes.includes(Ze)}static paste(Ze,Rt){Rt.pasteEditor(T.AnnotationEditorType.STAMP,{bitmapFile:Ze.getAsFile()})}remove(){var Ze,Rt;Ye(this,ae)&&(Ar(this,te,null),this._uiManager.imageManager.deleteId(Ye(this,ae)),(Ze=Ye(this,_e))==null||Ze.remove(),Ar(this,_e,null),(Rt=Ye(this,Re))==null||Rt.disconnect(),Ar(this,Re,null)),super.remove()}rebuild(){if(!this.parent){Ye(this,ae)&&fr(this,Me,Mn).call(this);return}super.rebuild(),this.div!==null&&(Ye(this,ae)&&fr(this,Me,Mn).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(Ye(this,ie)||Ye(this,te)||Ye(this,ce)||Ye(this,me))}get isResizable(){return!0}render(){if(this.div)return this.div;let Ze,Rt;if(this.width&&(Ze=this.x,Rt=this.y),super.render(),this.div.hidden=!0,Ye(this,te)?fr(this,Me,ba).call(this):fr(this,Me,Mn).call(this),this.width){const[nt,nr]=this.parentDimensions;this.setAt(Ze*nt,Rt*nr,this.width*nt,this.height*nr)}return this.div}static deserialize(Ze,Rt,nt){if(Ze instanceof I.StampAnnotationElement)return null;const nr=super.deserialize(Ze,Rt,nt),{rect:Je,bitmapUrl:Wt,bitmapId:Lt,isSvg:qe,accessibilityData:$e}=Ze;Lt&&nt.imageManager.isValidId(Lt)?Ar(nr,ae,Lt):Ar(nr,ce,Wt),Ar(nr,Ce,qe);const[Be,Xe]=nr.pageDimensions;return nr.width=(Je[2]-Je[0])/Be,nr.height=(Je[3]-Je[1])/Xe,$e&&(nr.altTextData=$e),nr}serialize(Ze=!1,Rt=null){if(this.isEmpty())return null;const nt={annotationType:T.AnnotationEditorType.STAMP,bitmapId:Ye(this,ae),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:Ye(this,Ce),structTreeParentId:this._structTreeParentId};if(Ze)return nt.bitmapUrl=fr(this,Me,On).call(this,!0),nt.accessibilityData=this.altTextData,nt;const{decorative:nr,altText:Je}=this.altTextData;if(!nr&&Je&&(nt.accessibilityData={type:"Figure",alt:Je}),Rt===null)return nt;Rt.stamps||(Rt.stamps=new Map);const Wt=Ye(this,Ce)?(nt.rect[2]-nt.rect[0])*(nt.rect[3]-nt.rect[1]):null;if(!Rt.stamps.has(Ye(this,ae)))Rt.stamps.set(Ye(this,ae),{area:Wt,serialized:nt}),nt.bitmap=fr(this,Me,On).call(this,!1);else if(Ye(this,Ce)){const Lt=Rt.stamps.get(Ye(this,ae));Wt>Lt.area&&(Lt.area=Wt,Lt.serialized.bitmap.close(),Lt.serialized.bitmap=fr(this,Me,On).call(this,!1))}return nt}};te=new WeakMap,ae=new WeakMap,ie=new WeakMap,ce=new WeakMap,me=new WeakMap,_e=new WeakMap,Re=new WeakMap,Pe=new WeakMap,Ce=new WeakMap,Fe=new WeakMap,Me=new WeakSet,hn=function(Ze,Rt=!1){if(!Ze){this.remove();return}Ar(this,te,Ze.bitmap),Rt||(Ar(this,ae,Ze.id),Ar(this,Ce,Ze.isSvg)),fr(this,Me,ba).call(this)},dn=function(){Ar(this,ie,null),this._uiManager.enableWaiting(!1),Ye(this,_e)&&this.div.focus()},Mn=function(){if(Ye(this,ae)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(Ye(this,ae)).then(Rt=>fr(this,Me,hn).call(this,Rt,!0)).finally(()=>fr(this,Me,dn).call(this));return}if(Ye(this,ce)){const Rt=Ye(this,ce);Ar(this,ce,null),this._uiManager.enableWaiting(!0),Ar(this,ie,this._uiManager.imageManager.getFromUrl(Rt).then(nt=>fr(this,Me,hn).call(this,nt)).finally(()=>fr(this,Me,dn).call(this)));return}if(Ye(this,me)){const Rt=Ye(this,me);Ar(this,me,null),this._uiManager.enableWaiting(!0),Ar(this,ie,this._uiManager.imageManager.getFromFile(Rt).then(nt=>fr(this,Me,hn).call(this,nt)).finally(()=>fr(this,Me,dn).call(this)));return}const Ze=document.createElement("input");Ze.type="file",Ze.accept=Le.supportedTypesStr,Ar(this,ie,new Promise(Rt=>{Ze.addEventListener("change",async()=>{if(!Ze.files||Ze.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const nt=await this._uiManager.imageManager.getFromFile(Ze.files[0]);fr(this,Me,hn).call(this,nt)}Rt()}),Ze.addEventListener("cancel",()=>{this.remove(),Rt()})}).finally(()=>fr(this,Me,dn).call(this))),Ze.click()},ba=function(){const{div:Ze}=this;let{width:Rt,height:nt}=Ye(this,te);const[nr,Je]=this.pageDimensions,Wt=.75;if(this.width)Rt=this.width*nr,nt=this.height*Je;else if(Rt>Wt*nr||nt>Wt*Je){const Be=Math.min(Wt*nr/Rt,Wt*Je/nt);Rt*=Be,nt*=Be}const[Lt,qe]=this.parentDimensions;this.setDims(Rt*Lt/nr,nt*qe/Je),this._uiManager.enableWaiting(!1);const $e=Ar(this,_e,document.createElement("canvas"));Ze.append($e),Ze.hidden=!1,fr(this,Me,Aa).call(this,Rt,nt),fr(this,Me,Vi).call(this),Ye(this,Fe)||(this.parent.addUndoableEditor(this),Ar(this,Fe,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},Mi=function(Ze,Rt){var Wt;const[nt,nr]=this.parentDimensions;this.width=Ze/nt,this.height=Rt/nr,this.setDims(Ze,Rt),(Wt=this._initialOptions)!=null&&Wt.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,Ye(this,Pe)!==null&&clearTimeout(Ye(this,Pe)),Ar(this,Pe,setTimeout(()=>{Ar(this,Pe,null),fr(this,Me,Aa).call(this,Ze,Rt)},200))},Oi=function(Ze,Rt){const{width:nt,height:nr}=Ye(this,te);let Je=nt,Wt=nr,Lt=Ye(this,te);for(;Je>2*Ze||Wt>2*Rt;){const qe=Je,$e=Wt;Je>2*Ze&&(Je=Je>=16384?Math.floor(Je/2)-1:Math.ceil(Je/2)),Wt>2*Rt&&(Wt=Wt>=16384?Math.floor(Wt/2)-1:Math.ceil(Wt/2));const Be=new OffscreenCanvas(Je,Wt);Be.getContext("2d").drawImage(Lt,0,0,qe,$e,0,0,Je,Wt),Lt=Be.transferToImageBitmap()}return Lt},Aa=function(Ze,Rt){Ze=Math.ceil(Ze),Rt=Math.ceil(Rt);const nt=Ye(this,_e);if(!nt||nt.width===Ze&&nt.height===Rt)return;nt.width=Ze,nt.height=Rt;const nr=Ye(this,Ce)?Ye(this,te):fr(this,Me,Oi).call(this,Ze,Rt),Je=nt.getContext("2d");Je.filter=this._uiManager.hcmFilter,Je.drawImage(nr,0,0,nr.width,nr.height,0,0,Ze,Rt)},On=function(Ze){if(Ze){if(Ye(this,Ce)){const nr=this._uiManager.imageManager.getSvgUrl(Ye(this,ae));if(nr)return nr}const Rt=document.createElement("canvas");return{width:Rt.width,height:Rt.height}=Ye(this,te),Rt.getContext("2d").drawImage(Ye(this,te),0,0),Rt.toDataURL()}if(Ye(this,Ce)){const[Rt,nt]=this.pageDimensions,nr=Math.round(this.width*Rt*S.PixelsPerInch.PDF_TO_CSS_UNITS),Je=Math.round(this.height*nt*S.PixelsPerInch.PDF_TO_CSS_UNITS),Wt=new OffscreenCanvas(nr,Je);return Wt.getContext("2d").drawImage(Ye(this,te),0,0,Ye(this,te).width,Ye(this,te).height,0,0,nr,Je),Wt.transferToImageBitmap()}return structuredClone(Ye(this,te))},Vi=function(){Ar(this,Re,new ResizeObserver(Ze=>{const Rt=Ze[0].contentRect;Rt.width&&Rt.height&&fr(this,Me,Mi).call(this,Rt.width,Rt.height)})),Ye(this,Re).observe(this.div)},cs(Le,"_type","stamp");let H=Le;r.StampEditor=H}],__webpack_module_cache__={};function __w_pdfjs_require__(E){var r=__webpack_module_cache__[E];if(r!==void 0)return r.exports;var v=__webpack_module_cache__[E]={exports:{}};return __webpack_modules__[E](v,v.exports,__w_pdfjs_require__),v.exports}var __webpack_exports__={};return(()=>{var E=__webpack_exports__;Object.defineProperty(E,"__esModule",{value:!0}),Object.defineProperty(E,"AbortException",{enumerable:!0,get:function(){return r.AbortException}}),Object.defineProperty(E,"AnnotationEditorLayer",{enumerable:!0,get:function(){return S.AnnotationEditorLayer}}),Object.defineProperty(E,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return r.AnnotationEditorParamsType}}),Object.defineProperty(E,"AnnotationEditorType",{enumerable:!0,get:function(){return r.AnnotationEditorType}}),Object.defineProperty(E,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return I.AnnotationEditorUIManager}}),Object.defineProperty(E,"AnnotationLayer",{enumerable:!0,get:function(){return H.AnnotationLayer}}),Object.defineProperty(E,"AnnotationMode",{enumerable:!0,get:function(){return r.AnnotationMode}}),Object.defineProperty(E,"CMapCompressionType",{enumerable:!0,get:function(){return r.CMapCompressionType}}),Object.defineProperty(E,"DOMSVGFactory",{enumerable:!0,get:function(){return T.DOMSVGFactory}}),Object.defineProperty(E,"FeatureTest",{enumerable:!0,get:function(){return r.FeatureTest}}),Object.defineProperty(E,"GlobalWorkerOptions",{enumerable:!0,get:function(){return te.GlobalWorkerOptions}}),Object.defineProperty(E,"ImageKind",{enumerable:!0,get:function(){return r.ImageKind}}),Object.defineProperty(E,"InvalidPDFException",{enumerable:!0,get:function(){return r.InvalidPDFException}}),Object.defineProperty(E,"MissingPDFException",{enumerable:!0,get:function(){return r.MissingPDFException}}),Object.defineProperty(E,"OPS",{enumerable:!0,get:function(){return r.OPS}}),Object.defineProperty(E,"PDFDataRangeTransport",{enumerable:!0,get:function(){return v.PDFDataRangeTransport}}),Object.defineProperty(E,"PDFDateString",{enumerable:!0,get:function(){return T.PDFDateString}}),Object.defineProperty(E,"PDFWorker",{enumerable:!0,get:function(){return v.PDFWorker}}),Object.defineProperty(E,"PasswordResponses",{enumerable:!0,get:function(){return r.PasswordResponses}}),Object.defineProperty(E,"PermissionFlag",{enumerable:!0,get:function(){return r.PermissionFlag}}),Object.defineProperty(E,"PixelsPerInch",{enumerable:!0,get:function(){return T.PixelsPerInch}}),Object.defineProperty(E,"PromiseCapability",{enumerable:!0,get:function(){return r.PromiseCapability}}),Object.defineProperty(E,"RenderingCancelledException",{enumerable:!0,get:function(){return T.RenderingCancelledException}}),Object.defineProperty(E,"SVGGraphics",{enumerable:!0,get:function(){return v.SVGGraphics}}),Object.defineProperty(E,"UnexpectedResponseException",{enumerable:!0,get:function(){return r.UnexpectedResponseException}}),Object.defineProperty(E,"Util",{enumerable:!0,get:function(){return r.Util}}),Object.defineProperty(E,"VerbosityLevel",{enumerable:!0,get:function(){return r.VerbosityLevel}}),Object.defineProperty(E,"XfaLayer",{enumerable:!0,get:function(){return ae.XfaLayer}}),Object.defineProperty(E,"build",{enumerable:!0,get:function(){return v.build}}),Object.defineProperty(E,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return r.createValidAbsoluteUrl}}),Object.defineProperty(E,"getDocument",{enumerable:!0,get:function(){return v.getDocument}}),Object.defineProperty(E,"getFilenameFromUrl",{enumerable:!0,get:function(){return T.getFilenameFromUrl}}),Object.defineProperty(E,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return T.getPdfFilenameFromUrl}}),Object.defineProperty(E,"getXfaPageViewport",{enumerable:!0,get:function(){return T.getXfaPageViewport}}),Object.defineProperty(E,"isDataScheme",{enumerable:!0,get:function(){return T.isDataScheme}}),Object.defineProperty(E,"isPdfFile",{enumerable:!0,get:function(){return T.isPdfFile}}),Object.defineProperty(E,"loadScript",{enumerable:!0,get:function(){return T.loadScript}}),Object.defineProperty(E,"noContextMenu",{enumerable:!0,get:function(){return T.noContextMenu}}),Object.defineProperty(E,"normalizeUnicode",{enumerable:!0,get:function(){return r.normalizeUnicode}}),Object.defineProperty(E,"renderTextLayer",{enumerable:!0,get:function(){return w.renderTextLayer}}),Object.defineProperty(E,"setLayerDimensions",{enumerable:!0,get:function(){return T.setLayerDimensions}}),Object.defineProperty(E,"shadow",{enumerable:!0,get:function(){return r.shadow}}),Object.defineProperty(E,"updateTextLayer",{enumerable:!0,get:function(){return w.updateTextLayer}}),Object.defineProperty(E,"version",{enumerable:!0,get:function(){return v.version}});var r=__w_pdfjs_require__(1),v=__w_pdfjs_require__(2),T=__w_pdfjs_require__(6),w=__w_pdfjs_require__(26),S=__w_pdfjs_require__(27),I=__w_pdfjs_require__(5),H=__w_pdfjs_require__(29),te=__w_pdfjs_require__(14),ae=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;class PDFService{constructor(){pdfExports.GlobalWorkerOptions.workerSrc=`https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfExports.version}/pdf.worker.min.js`}async parsePDF(r){try{const v=await r.arrayBuffer(),T=await pdfExports.getDocument({data:v}).promise,w=T.numPages,S=await T.getMetadata();let I="";for(let H=1;H<=w;H++){const ie=(await(await T.getPage(H)).getTextContent()).items.map(ce=>ce.str).join(" ");I+=ie+`

`}return{text:I.trim(),pages:w,metadata:S.info}}catch(v){throw console.error("Error parsing PDF:",v),new Error("Failed to parse PDF file")}}async extractTables(r){try{const v=await r.arrayBuffer(),T=await pdfExports.getDocument({data:v}).promise,w=[];for(let S=1;S<=T.numPages;S++){const H=await(await T.getPage(S)).getTextContent(),te=this._groupTextItems(H.items),ae=this._detectTables(te);ae.length>0&&w.push(...ae)}return w}catch(v){throw console.error("Error extracting tables:",v),new Error("Failed to extract tables from PDF")}}_groupTextItems(r){const v={};return r.forEach(T=>{const w=Math.round(T.transform[5]);v[w]||(v[w]=[]),v[w].push({text:T.str,x:T.transform[4]})}),Object.entries(v).sort(([T],[w])=>Number(w)-Number(T)).map(([T,w])=>w.sort((S,I)=>S.x-I.x).map(S=>S.text))}_detectTables(r){const v=[];let T=[],w=0;return r.forEach(S=>{S.length>1?w===0?(w=S.length,T.push(S)):S.length===w||S.length>=w*.7&&S.length<=w*1.3?T.push(S):T.length>0&&(T.length>=2&&v.push([...T]),T=[],w=0):T.length>0&&(T.length>=2&&v.push([...T]),T=[],w=0)}),T.length>=2&&v.push(T),v}}const pdfService=new PDFService,CellPDFParser=({columnName:E,onValueExtracted:r})=>{const[v,T]=reactExports.useState(""),[w,S]=reactExports.useState(!1),I=async H=>{const te=H.target.files[0];if(te){if(te.type!=="application/pdf"){console.error("Please upload a PDF file");return}S(!0);try{const ae=await pdfService.parsePDF(te),ie={text:ae.text,metadata:ae.metadata,targetColumns:[E],tableName:"current_table",instructions:v||`
          Por favor analiza el documento y extrae la siguiente información:
          - ${E}: Encuentra el valor exacto en el texto
          
          Reglas importantes:
          1. Extrae valores EXACTOS del documento
          2. Devuelve null si no se puede encontrar un valor
          3. Para fechas, mantén el formato como se muestra en el documento
          4. Para valores monetarios, incluye la cantidad completa con decimales
          5. Para campos de texto, extrae el texto completo como se muestra
          
          REGLAS DE NORMALIZACIÓN:
          6. NOMBRES DE ASEGURADORA: Normaliza "Grupo Nacional Provincial, S.A.B.", "Grupo Nacional Provincial S.A.B.", "GNP Seguros", "G.N.P." a "GNP"
          7. NOMBRES DE PERSONAS: Formato Título (ej., "JUAN PÉREZ" → "Juan Pérez")
          8. DIRECCIONES: Estandariza abreviaciones (Av. → Avenida, Col. → Colonia)
          9. RFC: Solo mayúsculas y sin espacios extra
        `},ce=await fetch(`${API_URL}/gpt/analyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ie)});if(!ce.ok)throw new Error("Failed to analyze PDF");const me=await ce.json();me.mappedData&&me.mappedData[E]!==void 0&&r(me.mappedData[E]||"")}catch(ae){console.error("Error analyzing PDF:",ae)}finally{S(!1)}}};return jsxRuntimeExports.jsxs("div",{className:"cell-pdf-parser",children:[jsxRuntimeExports.jsx("textarea",{value:v,onChange:H=>T(H.target.value),placeholder:`Instrucciones personalizadas para extraer ${E} del PDF...`,rows:2,className:"prompt-textarea"}),jsxRuntimeExports.jsxs("label",{className:"file-input-label",children:[jsxRuntimeExports.jsx("input",{type:"file",accept:".pdf",onChange:I,disabled:w,className:"file-input"}),jsxRuntimeExports.jsx("span",{className:"file-input-text",children:w?"Analizando...":"Seleccionar Archivo PDF"})]})]})},ROOT_FOLDER_ID$1="1rDGEXJg-8fssJ_atzDNHeJr6BouwGCCo",DriveSelector=({isOpen:E,onClose:r,onFolderSelect:v,selectedFolderId:T})=>{const[w,S]=reactExports.useState([]),[I,H]=reactExports.useState(null),[te,ae]=reactExports.useState([]),[ie,ce]=reactExports.useState(!1),[me,_e]=reactExports.useState(null);reactExports.useEffect(()=>{E&&Re()},[E,I]);const Re=async(Me=null)=>{try{ce(!0),_e(null);const Ve=Me||ROOT_FOLDER_ID$1,ze=(await axios.get(`${API_URL}/drive/files`,{params:{folderId:Ve,fields:"files(id, name, mimeType)"}})).data.files.filter(Ue=>Ue.mimeType==="application/vnd.google-apps.folder");S(ze)}catch(Ve){console.error("Error fetching folders:",Ve),_e("Error al cargar las carpetas")}finally{ce(!1)}},Pe=async Me=>{ae([...te,{id:I,name:Me.name}]),H(Me.id)},Ce=()=>{if(te.length>0){const Me=[...te],Ve=Me.pop();ae(Me),H((Ve==null?void 0:Ve.id)||null)}},Fe=()=>{const Me=I||ROOT_FOLDER_ID$1,Ve=te.length>0?te[te.length-1].name:"Carpeta Principal";v({id:Me,name:Ve,path:te.map(We=>We.name).join(" > ")}),r()};return E?jsxRuntimeExports.jsx("div",{className:"drive-selector-overlay",onClick:r,children:jsxRuntimeExports.jsxs("div",{className:"drive-selector-modal",onClick:Me=>Me.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"drive-selector-header",children:[jsxRuntimeExports.jsx("h3",{children:"Seleccionar Carpeta de Drive"}),jsxRuntimeExports.jsx("button",{className:"close-btn",onClick:r,children:"×"})]}),jsxRuntimeExports.jsxs("div",{className:"drive-selector-body",children:[me&&jsxRuntimeExports.jsx("div",{className:"error-message",children:jsxRuntimeExports.jsxs("span",{children:["⚠️ ",me]})}),jsxRuntimeExports.jsxs("div",{className:"folder-navigation",children:[jsxRuntimeExports.jsx("button",{onClick:Ce,disabled:!I||ie,className:"back-button",children:"← Atrás"}),jsxRuntimeExports.jsxs("div",{className:"current-path",children:[jsxRuntimeExports.jsx("span",{children:"📁 Inicio"}),te.map((Me,Ve)=>jsxRuntimeExports.jsxs("span",{children:[jsxRuntimeExports.jsx("span",{className:"path-separator",children:" › "}),jsxRuntimeExports.jsx("span",{children:Me.name})]},Ve))]})]}),ie?jsxRuntimeExports.jsx("div",{className:"loading-state",children:jsxRuntimeExports.jsx("span",{children:"🔄 Cargando carpetas..."})}):jsxRuntimeExports.jsx("div",{className:"folders-list",children:w.length===0?jsxRuntimeExports.jsx("div",{className:"empty-state",children:jsxRuntimeExports.jsx("span",{children:"📂 No hay subcarpetas en esta ubicación"})}):w.map(Me=>jsxRuntimeExports.jsxs("div",{className:"folder-item",onClick:()=>Pe(Me),children:[jsxRuntimeExports.jsx("span",{className:"folder-icon",children:"📁"}),jsxRuntimeExports.jsx("span",{className:"folder-name",children:Me.name}),jsxRuntimeExports.jsx("span",{className:"folder-arrow",children:"›"})]},Me.id))})]}),jsxRuntimeExports.jsxs("div",{className:"drive-selector-footer",children:[jsxRuntimeExports.jsx("button",{className:"cancel-btn",onClick:r,children:"Cancelar"}),jsxRuntimeExports.jsx("button",{className:"select-btn",onClick:Fe,disabled:ie,children:"Seleccionar Esta Carpeta"})]})]})}):null},TableMail=({isOpen:E,onClose:r,rowData:v})=>{const[T,w]=reactExports.useState({subject:"",message:""}),[S,I]=reactExports.useState(!1),[H,te]=reactExports.useState(null),[ae,ie]=reactExports.useState(null),[ce,me]=reactExports.useState([]),[_e,Re]=reactExports.useState(null),[Pe,Ce]=reactExports.useState(!1),[Fe,Me]=reactExports.useState(!1),Ve=reactExports.useRef(null),We=Ie=>{const Le=["email","e-mail","e_mail","mail","correo","correo_electronico","email_address"];for(const He of Le)if(Ie[He]&&typeof Ie[He]=="string"&&Ie[He].includes("@"))return Ie[He];for(const[He,Ct]of Object.entries(Ie))if(typeof Ct=="string"&&Ct.includes("@")&&(He.toLowerCase().includes("email")||He.toLowerCase().includes("mail")||He.toLowerCase().includes("correo")))return Ct;return""};reactExports.useEffect(()=>{E&&v&&ze()},[E,v]);const ze=async()=>{I(!0),te(null);try{const Ie=We(v);if(!Ie)throw new Error("No se encontró una dirección de correo válida");console.log("Generando correo para:",{...v,email:Ie});const Le=await fetch(`${API_URL}/gpt/analyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"welcome_email",data:{...v,email:Ie}})});if(!Le.ok)throw new Error("Error al conectar con el servidor");const He=await Le.json();if(He.emailContent)console.log("Contenido generado:",He.emailContent),w(He.emailContent);else throw new Error("No se pudo generar el contenido del correo")}catch(Ie){console.error("Error:",Ie),te(Ie.message||"Error al generar el correo. Por favor, intenta de nuevo.")}finally{I(!1)}},Ue=Ie=>{const Le=Array.from(Ie.target.files),He=16*1024*1024,Ze=Le.filter(Rt=>Rt.size>He?(te(`El archivo "${Rt.name}" excede el límite de 16MB`),!1):!0).map(Rt=>({id:Date.now()+Math.random(),file:Rt,name:Rt.name,size:Rt.size,type:Rt.type}));me(Rt=>[...Rt,...Ze]),Ve.current&&(Ve.current.value="")},je=Ie=>{me(Le=>Le.filter(He=>He.id!==Ie))},ke=Ie=>{if(Ie===0)return"0 Bytes";const Le=1024,He=["Bytes","KB","MB","GB"],Ct=Math.floor(Math.log(Ie)/Math.log(Le));return parseFloat((Ie/Math.pow(Le,Ct)).toFixed(2))+" "+He[Ct]},Ne=async()=>{if(!_e||ce.length===0)return[];Me(!0);const Ie=[];try{for(const Le of ce){const He=new FormData;He.append("file",Le.file),He.append("folderId",_e.id);const Ct=await fetch(`${API_URL}/drive/upload`,{method:"POST",body:He});if(!Ct.ok)throw new Error(`Error uploading ${Le.name}`);const Ze=await Ct.json();Ie.push({...Le,driveFileId:Ze.id,driveLink:Ze.webViewLink})}}catch(Le){throw console.error("Error uploading to Drive:",Le),Le}finally{Me(!1)}return Ie},Ge=async()=>{const Ie=We(v);if(!Ie){te("No se encontró una dirección de correo válida");return}te(null),ie(null);try{let Le=[];if(ce.length>0&&_e&&(ie("Subiendo archivos a Drive..."),Le=await Ne()),ie("Enviando correo..."),ce.length>0){const He=new FormData;He.append("to",Ie),He.append("subject",T.subject),He.append("gptResponse",T.message),Le.length>0&&He.append("driveLinks",JSON.stringify(Le.map(Rt=>({name:Rt.name,link:Rt.driveLink})))),Object.keys(v).forEach(Rt=>{v[Rt]!==null&&v[Rt]!==void 0&&He.append(Rt,String(v[Rt]))}),ce.forEach((Rt,nt)=>{He.append("attachment",Rt.file)});const Ct=await fetch(`${API_URL}/email/send-welcome`,{method:"POST",body:He});if(!Ct.ok){const Rt=await Ct.json();throw new Error(Rt.error||"Error al enviar el correo")}const Ze=await Ct.json();console.log("Email enviado exitosamente:",Ze)}else{const He={to:Ie,gptResponse:T.message,subject:T.subject,driveLinks:Le.map(Rt=>({name:Rt.name,link:Rt.driveLink})),...v},Ct=await fetch(`${API_URL}/email/send-welcome`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(He)});if(!Ct.ok){const Rt=await Ct.json();throw new Error(Rt.error||"Error al enviar el correo")}const Ze=await Ct.json();console.log("Email enviado exitosamente:",Ze)}ie("¡Correo enviado exitosamente!"),setTimeout(()=>{r()},2e3)}catch(Le){console.error("Error al enviar el correo:",Le),te(Le.message||"Error al enviar el correo. Por favor, intenta de nuevo.")}};return E?jsxRuntimeExports.jsx("div",{className:"mail-modal-overlay",onClick:r,children:jsxRuntimeExports.jsxs("div",{className:"mail-modal-content",onClick:Ie=>Ie.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"mail-modal-header",children:[jsxRuntimeExports.jsx("h3",{children:"Enviar Correo de Bienvenida"}),jsxRuntimeExports.jsx("button",{className:"close-modal-btn",onClick:r,children:"×"})]}),jsxRuntimeExports.jsxs("div",{className:"mail-modal-body",children:[H&&jsxRuntimeExports.jsx("div",{className:"mail-error",children:H}),ae&&jsxRuntimeExports.jsx("div",{className:"mail-success",children:ae}),jsxRuntimeExports.jsxs("div",{className:"mail-field",children:[jsxRuntimeExports.jsx("label",{children:"Para:"}),jsxRuntimeExports.jsx("input",{type:"email",value:We(v),readOnly:!0,className:"mail-input"})]}),jsxRuntimeExports.jsxs("div",{className:"mail-field",children:[jsxRuntimeExports.jsx("label",{children:"Asunto:"}),jsxRuntimeExports.jsx("input",{type:"text",className:"mail-input",placeholder:S?"Generando asunto...":"Ingrese asunto...",value:T.subject,onChange:Ie=>w(Le=>({...Le,subject:Ie.target.value})),disabled:S})]}),jsxRuntimeExports.jsxs("div",{className:"mail-field",children:[jsxRuntimeExports.jsx("label",{children:"Mensaje:"}),jsxRuntimeExports.jsx("textarea",{className:"mail-textarea",placeholder:S?"Generando contenido...":"Escriba su mensaje...",value:T.message,onChange:Ie=>w(Le=>({...Le,message:Ie.target.value})),rows:8,disabled:S})]}),jsxRuntimeExports.jsxs("div",{className:"mail-field",children:[jsxRuntimeExports.jsx("label",{children:"Adjuntos:"}),jsxRuntimeExports.jsxs("div",{className:"attachments-section",children:[jsxRuntimeExports.jsx("input",{type:"file",ref:Ve,onChange:Ue,multiple:!0,style:{display:"none"},accept:"*/*"}),jsxRuntimeExports.jsxs("div",{className:"attachment-controls",children:[jsxRuntimeExports.jsx("button",{type:"button",className:"attach-btn",onClick:()=>{var Ie;return(Ie=Ve.current)==null?void 0:Ie.click()},disabled:S||Fe,children:"📎 Adjuntar Archivos"}),jsxRuntimeExports.jsx("button",{type:"button",className:"drive-folder-btn",onClick:()=>Ce(!0),disabled:S||Fe,children:"📁 Seleccionar Carpeta Drive"})]}),_e&&jsxRuntimeExports.jsxs("div",{className:"selected-folder",children:[jsxRuntimeExports.jsxs("span",{className:"folder-info",children:["📁 Carpeta seleccionada: ",jsxRuntimeExports.jsx("strong",{children:_e.name})]}),jsxRuntimeExports.jsx("button",{type:"button",className:"remove-folder-btn",onClick:()=>Re(null),children:"✕"})]}),ce.length>0&&jsxRuntimeExports.jsxs("div",{className:"attachments-list",children:[ce.map(Ie=>jsxRuntimeExports.jsxs("div",{className:"attachment-item",children:[jsxRuntimeExports.jsxs("div",{className:"attachment-info",children:[jsxRuntimeExports.jsx("span",{className:"attachment-name",children:Ie.name}),jsxRuntimeExports.jsxs("span",{className:"attachment-size",children:["(",ke(Ie.size),")"]})]}),jsxRuntimeExports.jsx("button",{type:"button",className:"remove-attachment-btn",onClick:()=>je(Ie.id),disabled:Fe,children:"✕"})]},Ie.id)),jsxRuntimeExports.jsxs("div",{className:"attachments-summary",children:["Total: ",ce.length," archivo(s) - ",ke(ce.reduce((Ie,Le)=>Ie+Le.size,0))]})]})]})]}),jsxRuntimeExports.jsx("div",{className:"mail-actions",children:jsxRuntimeExports.jsx("button",{className:"regenerate-btn",onClick:ze,disabled:S||Fe,children:S?"Generando...":"Regenerar Contenido"})})]}),jsxRuntimeExports.jsxs("div",{className:"mail-modal-footer",children:[jsxRuntimeExports.jsx("button",{className:"cancel-btn",onClick:r,children:"Cancelar"}),jsxRuntimeExports.jsx("button",{className:"send-btn",onClick:Ge,disabled:S||Fe||!T.subject||!T.message||!We(v),children:Fe?"Subiendo archivos...":"Enviar Correo"})]}),jsxRuntimeExports.jsx(DriveSelector,{isOpen:Pe,onClose:()=>Ce(!1),onFolderSelect:Re,selectedFolderId:_e==null?void 0:_e.id})]})}):null},GPTAnalysis=({parsedData:E,selectedTable:r,tableInfo:v,autoAnalyze:T=!1})=>{const[w,S]=reactExports.useState(null),[I,H]=reactExports.useState(!1),[te,ae]=reactExports.useState(null),[ie,ce]=reactExports.useState(null),[me,_e]=reactExports.useState(null),[Re,Pe]=reactExports.useState(null),[Ce,Fe]=reactExports.useState(null),Me=typeof r=="string"?r:r==null?void 0:r.name;console.log("GPTAnalysis - selectedTable:",r),console.log("GPTAnalysis - tableName derived:",Me),console.log("GPTAnalysis - typeof selectedTable:",typeof r),console.log("GPTAnalysis - tableInfo:",v);const Ve={numeric:["prima","suma_asegurada","prima_neta","derecho_de_poliza","i_v_a","recargo_por_pago_fraccionado","pago_total_o_prima_total","modelo"],date:["fecha_inicio","fecha_fin","desde_vigencia","hasta_vigencia","fecha_expedicion","fecha_pago"],status:["status"]},We=(Ge,Ie="general")=>{if(!Ge||typeof Ge!="string")return Ge;if(Ie==="rfc")return Ge.toUpperCase().trim();let Le=Ge;return Le=Le.trim(),[/grupo\s+nacional\s+provincial\s*,?\s*s\.a\.b\.?/gi,/grupo\s+naci[oó]n\s+aprovincial/gi,/grupo\s+nacional\s+aprovincial/gi,/gnp\s+seguros/gi,/g\.n\.p\.?/gi,/grupo\s+nacion\s+aprovincial/gi].forEach(Ct=>{Le=Le.replace(Ct,"GNP")}),(Ie==="name"||Ie==="contratante")&&(Le=Le.toLowerCase().split(" ").map(Ct=>["de","del","la","las","los","el","y","e"].includes(Ct)?Ct:Ct.charAt(0).toUpperCase()+Ct.slice(1)).join(" "),Le=Le.replace(/\bDe\b/g,"de"),Le=Le.replace(/\bDel\b/g,"del"),Le=Le.replace(/\bLa\b/g,"la"),Le=Le.replace(/\bY\b/g,"y")),(Ie==="address"||Ie==="direccion")&&(Object.entries({"av\\.?":"Avenida","ave\\.?":"Avenida","blvd\\.?":"Boulevard","c\\.?":"Calle","col\\.?":"Colonia","fracc\\.?":"Fraccionamiento","no\\.?":"Número","num\\.?":"Número","#":"Número","int\\.?":"Interior","ext\\.?":"Exterior","depto\\.?":"Departamento","dept\\.?":"Departamento","piso\\.?":"Piso","mz\\.?":"Manzana","lt\\.?":"Lote","km\\.?":"Kilómetro","cp\\.?":"C.P.","c\\.p\\.?":"C.P."}).forEach(([Ze,Rt])=>{const nt=new RegExp(`\\b${Ze}\\b`,"gi");Le=Le.replace(nt,Rt)}),Le=Le.toLowerCase().split(" ").map(Ze=>["de","del","la","las","los","el","y","e","con"].includes(Ze)?Ze:Ze.charAt(0).toUpperCase()+Ze.slice(1)).join(" ")),Le=Le.replace(/\s+/g," ").replace(/[""]/g,'"').replace(/['']/g,"'").trim(),Le},ze=Ge=>{if(Ge==null)return"N/A";if(typeof Ge=="string")return Ge;if(typeof Ge=="number"||typeof Ge=="boolean")return Ge.toString();if(Ge instanceof Date)return Ge.toLocaleDateString();if(Array.isArray(Ge))return Ge.map(Ie=>typeof Ie=="object"?JSON.stringify(Ie,null,2):Ie).join(", ");if(typeof Ge=="object")try{return Object.entries(Ge).map(([Ie,Le])=>{const He=typeof Le=="object"?JSON.stringify(Le,null,2):Le;return`${Ie}: ${He}`}).join(`
`)}catch(Ie){return console.error("Error formatting object:",Ie),"Invalid Object"}return"N/A"};reactExports.useEffect(()=>{ie&&!me&&_e({...ie})},[ie]),reactExports.useEffect(()=>{T&&E&&Me&&!w&&Ue()},[E,Me,T]);const Ue=async()=>{if(!Me||!v){ae("Por favor selecciona una tabla válida primero");return}H(!0),ae(null);try{console.log("Fetching tables for:",Me);const Ge=await tableService.getTables();console.log("Available tables:",Ge.map(Rt=>Rt.name));const Ie=Ge.find(Rt=>Rt.name===Me);if(!Ie)throw console.error("Table not found:",Me,"Available tables:",Ge.map(Rt=>Rt.name)),new Error(`Selected table "${Me}" not found`);let Le;v.type==="simple"?Le=v.fields:v.type==="group"?Le=v.childFields:Le=Ie.columns.filter(Rt=>Rt.name!=="id").map(Rt=>Rt.name);const He={text:E.text,tables:[Ie],metadata:E.metadata,targetColumns:Le,tableName:Me,tableType:v.type||"simple",instructions:`
                    Por favor analiza el documento y extrae la siguiente información:
                    ${Le.map(Rt=>`- ${Rt}: Encuentra el valor exacto en el texto`).join(`
`)}
                    
                    Reglas importantes:
                    1. Extrae valores EXACTOS del documento
                    2. No repitas valores en diferentes campos
                    3. Devuelve null si no se puede encontrar un valor
                    4. Para fechas, mantén el formato como se muestra en el documento
                    5. Para valores monetarios, incluye la cantidad completa con decimales
                    6. Para campos de texto, extrae el texto completo como se muestra
                    ${v.type==="simple"?"7. Esta es una tabla de póliza simple, enfócate en información básica de la póliza":""}
                    
                    REGLAS DE NORMALIZACIÓN DE TEXTO:
                    8. NOMBRES DE ASEGURADORA: Siempre normaliza "Grupo Nacional Provincial, S.A.B.", "Grupo Nacional Provincial S.A.B.", "Grupo Nación Aprovincial", "Grupo Nacional Aprovincial", "GNP Seguros", "G.N.P.", o cualquier variación a "GNP"
                    9. NOMBRES DE PERSONAS: Convierte a formato Título Apropiado (ej., "JUAN PÉREZ LÓPEZ" → "Juan Pérez López", mantén "de", "del", "la" en minúsculas)
                    10. DIRECCIONES: Estandariza abreviaciones (Av. → Avenida, Col. → Colonia, No. → Número, etc.) y usa formato Título
                    11. CAMPOS RFC: Mantén el RFC exactamente como se encuentra, solo en mayúsculas y sin espacios extra
                    12. TEXTO GENERAL: Limpia espacios extra, normaliza comillas y apostrofes
                    13. NO normalices valores RFC más allá de mayúsculas y quitar espacios
                    
                    NORMALIZACIÓN ESPECÍFICA POR CAMPO:
                    - contratante, nombre: Aplicar normalización de nombres (formato Título)
                    - direccion: Aplicar normalización de direcciones (estandarizar abreviaciones + formato Título)
                    - rfc: Solo mayúsculas y quitar espacios, sin otros cambios
                    - Todos los demás campos de texto: Aplicar limpieza general de texto y normalización de nombres de compañías
                `},Ct=await fetch(`${API_URL}/gpt/analyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(He)});if(!Ct.ok){const Rt=await Ct.json();throw new Error(Rt.error||"Failed to analyze content")}const Ze=await Ct.json();if(Ze.mappedData){const Rt={};Le.forEach(nt=>{let nr=Ze.mappedData[nt]||null;nr&&typeof nr=="string"&&(nt.toLowerCase().includes("rfc")?nr=We(nr,"rfc"):nt.toLowerCase().includes("nombre")||nt.toLowerCase().includes("contratante")?nr=We(nr,"name"):nt.toLowerCase().includes("direccion")||nt.toLowerCase().includes("address")?nr=We(nr,"address"):nr=We(nr,"general")),Rt[nt]=nr}),S(Ze),ce(Rt)}else throw new Error("No mapped data received from analysis")}catch(Ge){console.error("Error analyzing content:",Ge),ae(Ge.message||"Failed to analyze content")}finally{H(!1)}},je=async Ge=>{try{if(!Me||!v)throw new Error("Invalid table information");console.log("Starting data insertion with raw data:",Ge),console.log("Table name:",Me),console.log("Table info:",v);let Ie;if(v.type==="simple"?Ie=v.fields:v.type==="group"&&(Ie=v.childFields),console.log("Target columns:",Ie),!Ie)throw new Error("No columns defined for table");const Le={};Ie.forEach(He=>{if(Ge[He]!==void 0){let Ct=Ge[He];if(console.log(`Processing column ${He} with value:`,Ct),console.log("Value type:",typeof Ct),typeof Ct=="string"&&!Ve.numeric.includes(He)&&!Ve.date.includes(He)&&(He.toLowerCase().includes("rfc")?Ct=We(Ct,"rfc"):He.toLowerCase().includes("nombre")||He.toLowerCase().includes("contratante")?Ct=We(Ct,"name"):He.toLowerCase().includes("direccion")||He.toLowerCase().includes("address")?Ct=We(Ct,"address"):Ct=We(Ct,"general"),console.log(`Text field ${He} normalized:`,Ct)),Ve.numeric.includes(He)){const Ze=(Ct==null?void 0:Ct.toString().replace(/[$,]/g,""))||"0";Ct=parseFloat(Ze)||null,console.log(`Numeric field ${He} processed:`,Ct)}else if(Ve.date.includes(He))try{if(typeof Ct=="string")if(Ct.includes("/")){const[Ze,Rt,nt]=Ct.split("/");Ct=`${nt}-${Rt.padStart(2,"0")}-${Ze.padStart(2,"0")}`}else Ct.includes("-")&&(Ct=Ct);else Ct instanceof Date&&(Ct=Ct.toISOString().split("T")[0]);console.log(`Date field ${He} processed:`,Ct)}catch(Ze){console.warn(`Failed to parse date: ${Ct}`,Ze),Ct=null}else if(Ve.status.includes(He)){const Ze=Ct==null?void 0:Ct.toString().toLowerCase();Ct=Ze==="pagado"||Ze==="paid"?"Pagado":"No Pagado",console.log(`Status field ${He} processed:`,Ct)}else typeof Ct=="object"&&Ct!==null&&(Ct=JSON.stringify(Ct),console.log(`Object field ${He} stringified:`,Ct));Le[He]=Ct}}),console.log("Final clean data before insertion:",Le),console.log("Clean data structure:",Object.keys(Le));try{const He=await tableService.insertData(Me,Le);console.log("Data insertion result:",He),Pe("Datos insertados exitosamente"),ae(null);const Ct=new CustomEvent("policyDataUpdated",{detail:{table:Me}});window.dispatchEvent(Ct)}catch(He){console.error("Error during data insertion:",He),console.error("Error details:",{message:He.message,stack:He.stack});const Ct=He.message||"Failed to insert data";ae(`Error inserting data into ${Me}: ${Ct}`),Pe(null)}}catch(Ie){console.error("Error preparing data for insertion:",Ie),console.error("Error details:",{message:Ie.message,stack:Ie.stack}),ae(Ie.message||"Failed to prepare data for insertion"),Pe(null)}},ke=(Ge,Ie)=>{let Le=Ie;if(typeof Ie=="string"&&(Ie.startsWith("{")||Ie.startsWith("[")))try{Le=JSON.parse(Ie)}catch(He){console.warn("Failed to parse JSON:",He)}typeof Le=="string"&&(Ge.toLowerCase().includes("rfc")?Le=We(Le,"rfc"):Ge.toLowerCase().includes("nombre")||Ge.toLowerCase().includes("contratante")?Le=We(Le,"name"):Ge.toLowerCase().includes("direccion")||Ge.toLowerCase().includes("address")?Le=We(Le,"address"):Le=We(Le,"general")),_e(He=>({...He,[Ge]:Le}))},Ne=(Ge,Ie)=>{Ge.key==="Enter"&&Fe(null)};return jsxRuntimeExports.jsxs("div",{className:"gpt-analysis",children:[!r&&jsxRuntimeExports.jsx("div",{className:"error-message",children:"Por favor selecciona una tabla primero"}),!E&&jsxRuntimeExports.jsx("div",{className:"error-message",children:"Por favor sube un archivo PDF primero"}),I&&jsxRuntimeExports.jsx("div",{className:"loading",children:"Analizando contenido..."}),te&&jsxRuntimeExports.jsxs("div",{className:"error-message",children:[te,jsxRuntimeExports.jsx("button",{onClick:Ue,className:"retry-button",children:"Retry Analysis"})]}),Re&&jsxRuntimeExports.jsx("div",{className:"success-message",children:Re}),ie&&jsxRuntimeExports.jsxs("div",{className:"mapped-data",children:[jsxRuntimeExports.jsx("h3",{children:"Extracted Data"}),jsxRuntimeExports.jsx("div",{className:"data-table",children:jsxRuntimeExports.jsxs("table",{children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"email-column",children:jsxRuntimeExports.jsx("div",{className:"header-content",children:jsxRuntimeExports.jsx("span",{children:"Email"})})}),Object.keys(ie).map(Ge=>jsxRuntimeExports.jsx("th",{className:"sortable-header",children:jsxRuntimeExports.jsx("div",{className:"th-content",children:jsxRuntimeExports.jsx("span",{children:Ge})})},Ge))]})}),jsxRuntimeExports.jsx("tbody",{children:jsxRuntimeExports.jsxs("tr",{className:"table-row",children:[jsxRuntimeExports.jsx("td",{className:"email-cell",children:jsxRuntimeExports.jsx("button",{className:"email-icon-btn",title:"Send Email",disabled:!0,children:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"email-icon",children:[jsxRuntimeExports.jsx("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),jsxRuntimeExports.jsx("path",{d:"M22 6l-10 7L2 6"})]})})}),Object.entries(me||{}).map(([Ge,Ie])=>jsxRuntimeExports.jsx("td",{className:`editable-cell ${Ge==="id"?"id-cell":""} ${Ge==="status"?"status-cell":""}`,onClick:()=>Fe(Ge),children:Ce===Ge?jsxRuntimeExports.jsx("input",{type:"text",value:typeof Ie=="object"?JSON.stringify(Ie,null,2):Ie||"",onChange:Le=>{let He=Le.target.value;try{(He.startsWith("{")&&He.endsWith("}")||He.startsWith("[")&&He.endsWith("]"))&&(He=JSON.parse(He))}catch(Ct){console.warn("Failed to parse JSON:",Ct)}ke(Ge,He)},onBlur:()=>Fe(null),onKeyDown:Le=>Ne(Le),className:"edit-cell-input",autoFocus:!0}):jsxRuntimeExports.jsx("span",{className:`cell-content ${typeof Ie=="object"?"object-value":""}`,children:ze(Ie)})},Ge))]})})]})}),jsxRuntimeExports.jsxs("div",{className:"action-buttons",children:[jsxRuntimeExports.jsx("button",{onClick:()=>je(me),className:"insert-button",children:"Insert Data"}),jsxRuntimeExports.jsx("button",{onClick:Ue,className:"reanalyze-button",children:"Reanalyze"})]})]})]})},ListadoAnalysis=({parsedData:E,selectedTable:r,tableInfo:v,autoAnalyze:T=!1})=>{const[w,S]=reactExports.useState(null),[I,H]=reactExports.useState(!1),[te,ae]=reactExports.useState(null),[ie,ce]=reactExports.useState([]),[me,_e]=reactExports.useState([]),[Re,Pe]=reactExports.useState(null),[Ce,Fe]=reactExports.useState(null);reactExports.useEffect(()=>{ie.length>0&&me.length===0&&_e([...ie])},[ie]),reactExports.useEffect(()=>{T&&E&&r&&!w&&Me()},[E,r,T]);const Me=async()=>{if(!r||!v){ae("Por favor selecciona una tabla válida primero");return}H(!0),ae(null);try{const Ue=await tableService.getTables(),je=Ue.find(Le=>Le.name===r);if(!je)throw new Error("Selected table not found");let ke;v.type==="listado"?ke=v.fields:ke=je.columns.filter(Le=>Le.name!=="id").map(Le=>Le.name);const Ne={text:E.text,tables:Ue,metadata:E.metadata,targetColumns:ke,tableName:r,tableType:v.type,instructions:`
                    Por favor analiza el documento y extrae la siguiente información para cada elemento en la lista:
                    ${ke.map(Le=>`- ${Le}: Encuentra el valor exacto en el texto`).join(`
`)}
                    
                    Reglas importantes:
                    1. Extrae valores EXACTOS del documento
                    2. No repitas valores en diferentes campos
                    3. Devuelve null si no se puede encontrar un valor
                    4. Para fechas, mantén el formato como se muestra en el documento
                    5. Para valores monetarios, incluye la cantidad completa con decimales
                    6. Para campos de texto, extrae el texto completo como se muestra
                    7. Esta es una tabla de lista, extrae todos los elementos encontrados en el documento
                    
                    REGLAS DE NORMALIZACIÓN DE TEXTO:
                    8. NOMBRES DE ASEGURADORA: Siempre normaliza "Grupo Nacional Provincial, S.A.B.", "Grupo Nacional Provincial S.A.B.", "Grupo Nación Aprovincial", "Grupo Nacional Aprovincial", "GNP Seguros", "G.N.P.", o cualquier variación a "GNP"
                    9. NOMBRES DE PERSONAS: Convierte a formato Título Apropiado (ej., "JUAN PÉREZ LÓPEZ" → "Juan Pérez López", mantén "de", "del", "la" en minúsculas)
                    10. DIRECCIONES: Estandariza abreviaciones (Av. → Avenida, Col. → Colonia, No. → Número, etc.) y usa formato Título
                    11. CAMPOS RFC: Mantén el RFC exactamente como se encuentra, solo en mayúsculas y sin espacios extra
                    12. TEXTO GENERAL: Limpia espacios extra, normaliza comillas y apostrofes
                `},Ge=await fetch(`${API_URL}/gpt/analyze-list`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Ne)});if(!Ge.ok){const Le=await Ge.json();throw new Error(Le.error||"Failed to analyze content")}const Ie=await Ge.json();if(Ie.mappedData&&Array.isArray(Ie.mappedData)){const Le=Ie.mappedData.map(He=>{const Ct={};return ke.forEach(Ze=>{Ct[Ze]=He[Ze]||null}),Ct});S(Ie),ce(Le)}else throw new Error("No mapped data received from analysis")}catch(Ue){console.error("Error analyzing content:",Ue),ae(Ue.message||"Failed to analyze content")}finally{H(!1)}},Ve=async Ue=>{try{if(!v)throw new Error("Invalid table information");const je=Ue.map(Ge=>{const Ie={...Ge};delete Ie.id;const Le={numeric:["prima","suma_asegurada","prima_neta","derecho_de_poliza","i_v_a","recargo_por_pago_fraccionado","pago_total_o_prima_total","modelo"],date:["fecha_inicio","fecha_fin","desde_vigencia","hasta_vigencia","fecha_expedicion","fecha_pago"],status:["status"]};for(const[He,Ct]of Object.entries(Ie))if(Le.numeric.includes(He)){const Ze=(Ct==null?void 0:Ct.toString().replace(/[$,]/g,""))||"0";Ie[He]=parseFloat(Ze)||null}else if(Le.date.includes(He))try{if(typeof Ct=="string")if(Ct.includes("/")){const[Ze,Rt,nt]=Ct.split("/");Ie[He]=`${nt}-${Rt.padStart(2,"0")}-${Ze.padStart(2,"0")}`}else Ct.includes("-")&&(Ie[He]=Ct);else Ct instanceof Date&&(Ie[He]=Ct.toISOString().split("T")[0])}catch(Ze){console.warn(`Failed to parse date: ${Ct}`,Ze),Ie[He]=null}else if(Le.status.includes(He)){const Ze=Ct==null?void 0:Ct.toString().toLowerCase();Ie[He]=Ze==="pagado"||Ze==="paid"?"Pagado":"No Pagado"}return Ie}),ke=await tableService.insertData(r,je);console.log("Data insertion result:",ke),Pe("Data inserted successfully"),ae(null);const Ne=new CustomEvent("policyDataUpdated",{detail:{table:r}});window.dispatchEvent(Ne)}catch(je){console.error("Error inserting data:",je),ae(je.message||"Failed to insert data"),Pe(null)}},We=(Ue,je,ke)=>{_e(Ne=>{const Ge=[...Ne];return Ge[Ue]={...Ge[Ue],[je]:ke},Ge})},ze=(Ue,je,ke)=>{Ue.key==="Enter"&&Fe(null)};return jsxRuntimeExports.jsxs("div",{className:"listado-analysis",children:[!r&&jsxRuntimeExports.jsx("div",{className:"error-message",children:"Por favor selecciona una tabla primero"}),!E&&jsxRuntimeExports.jsx("div",{className:"error-message",children:"Please upload a PDF file first"}),I&&jsxRuntimeExports.jsx("div",{className:"loading",children:"Analyzing content..."}),te&&jsxRuntimeExports.jsxs("div",{className:"error-message",children:[te,jsxRuntimeExports.jsx("button",{onClick:Me,className:"retry-button",children:"Retry Analysis"})]}),Re&&jsxRuntimeExports.jsx("div",{className:"success-message",children:Re}),ie.length>0&&jsxRuntimeExports.jsxs("div",{className:"mapped-data",children:[jsxRuntimeExports.jsx("h3",{children:"Extracted Data"}),jsxRuntimeExports.jsx("div",{className:"data-table",children:jsxRuntimeExports.jsxs("table",{children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{children:"#"}),Object.keys(ie[0]).map(Ue=>jsxRuntimeExports.jsx("th",{children:Ue},Ue))]})}),jsxRuntimeExports.jsx("tbody",{children:me.map((Ue,je)=>jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{children:je+1}),Object.entries(Ue).map(([ke,Ne])=>jsxRuntimeExports.jsx("td",{children:Ce===`${je}-${ke}`?jsxRuntimeExports.jsx("input",{type:"text",value:Ne||"",onChange:Ge=>We(je,ke,Ge.target.value),onBlur:()=>Fe(null),onKeyDown:Ge=>ze(Ge),autoFocus:!0}):jsxRuntimeExports.jsx("span",{onClick:()=>Fe(`${je}-${ke}`),children:Ne||"N/A"})},ke))]},je))})]})}),jsxRuntimeExports.jsxs("div",{className:"action-buttons",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Ve(me),className:"insert-button",children:"Insert Data"}),jsxRuntimeExports.jsx("button",{onClick:Me,className:"reanalyze-button",children:"Reanalyze"})]})]})]})},PDFParser=({selectedTable:E})=>{var Pe;const[r,v]=reactExports.useState(null),[T,w]=reactExports.useState(!1),[S,I]=reactExports.useState(null),[H,te]=reactExports.useState(""),[ae,ie]=reactExports.useState({}),me=(()=>{const Ce=typeof E=="string"?E:E==null?void 0:E.name;return console.log("PDFParser - selectedTable:",E),console.log("PDFParser - tableName:",Ce),console.log("PDFParser - typeof selectedTable:",typeof E),Ce})();reactExports.useEffect(()=>{(async()=>{try{I(null);const Fe=await tableService.getTableTypes();if(!Fe||typeof Fe!="object")throw new Error("Invalid table types data received");me&&!Fe[me]&&console.warn(`No type information found for table: ${me}`),ie(Fe)}catch(Fe){console.error("Error fetching table types:",Fe),I(Fe.message||"Failed to fetch table types"),ie({})}})()},[me]);const _e=async Ce=>{const Fe=Ce.target.files[0];if(Fe){if(Fe.type!=="application/pdf"){I("Please upload a PDF file");return}te(Fe.name),w(!0),I(null);try{new FormData().append("pdf",Fe);const Ve=await pdfService.parsePDF(Fe);v(Ve)}catch(Me){console.error("Error parsing PDF:",Me),I("Failed to parse PDF file")}finally{w(!1)}}},Re=Ce=>ae[Ce]||null;return me?jsxRuntimeExports.jsxs("div",{className:"pdf-parser",children:[jsxRuntimeExports.jsxs("div",{className:"upload-section",children:[jsxRuntimeExports.jsxs("label",{className:"file-input-label",children:[jsxRuntimeExports.jsx("input",{type:"file",accept:".pdf",onChange:_e,className:"file-input"}),jsxRuntimeExports.jsx("span",{className:"file-input-text",children:H?`Selected: ${H}`:"Choose PDF File"})]}),T&&jsxRuntimeExports.jsx("div",{className:"loading",children:"Processing PDF..."}),S&&jsxRuntimeExports.jsx("div",{className:"error-message",children:S})]}),r&&jsxRuntimeExports.jsx("div",{className:"analysis-section",children:jsxRuntimeExports.jsx("div",{className:"analysis-component",children:(Pe=Re(me))!=null&&Pe.isGroup?jsxRuntimeExports.jsx(ListadoAnalysis,{parsedData:r,selectedTable:me,tableInfo:Re(me),autoAnalyze:!0}):jsxRuntimeExports.jsx(GPTAnalysis,{parsedData:r,selectedTable:me,tableInfo:Re(me),autoAnalyze:!0})})})]}):jsxRuntimeExports.jsx("div",{className:"pdf-parser",children:jsxRuntimeExports.jsx("div",{className:"error-message",children:"Please select a table first"})})},DataTable=({data:E,onRowClick:r,onCellUpdate:v,onRefresh:T,tableName:w})=>{var Lr;console.log("DataTable received data:",E),console.log("DataTable received tableName:",w);const[S,I]=reactExports.useState(null),[H,te]=reactExports.useState(""),[ae,ie]=reactExports.useState(!1),[ce,me]=reactExports.useState({key:null,direction:null}),[_e,Re]=reactExports.useState([]),[Pe,Ce]=reactExports.useState(!1),[Fe,Me]=reactExports.useState(""),[Ve,We]=reactExports.useState(!1),[ze,Ue]=reactExports.useState([]),[je,ke]=reactExports.useState(null),[Ne,Ge]=reactExports.useState(""),[Ie,Le]=reactExports.useState([]),[He,Ct]=reactExports.useState({isOpen:!1,rowData:null}),[Ze,Rt]=reactExports.useState(null),[nt,nr]=reactExports.useState({isOpen:!1,rowId:null,currentStatus:null}),[Je,Wt]=reactExports.useState(!1),[Lt,qe]=reactExports.useState(""),[$e,Be]=reactExports.useState([]),[Xe,rt]=reactExports.useState(""),[Qe,vt]=reactExports.useState(null),[Dt,Ut]=reactExports.useState(null);if(reactExports.useEffect(()=>{if(console.log("Setting sorted data:",E),!Array.isArray(E)){console.error("Data is not an array:",E),Re([]),Le([]);return}Re(E),Le(E)},[E]),reactExports.useEffect(()=>{if(w){const or=tableService.formatTableTitle(w);qe(or),console.log("Table name:",w),console.log("Formatted title:",or)}},[w]),reactExports.useEffect(()=>{(async()=>{const ur=w!=null&&w.includes("→")?w.split("→")[0].trim():w;if(!ur){Be([]),rt("");return}try{console.log("Fetching child tables for:",ur);const gr=await tableService.getChildTables(ur);if(console.log("Available child tables:",gr),Be(gr),w!=null&&w.includes("→")){const $r=w.split("→")[1].trim();console.log("Setting selected child table to:",$r),rt($r)}else console.log("Resetting selected child table (parent table)"),rt("")}catch(gr){console.error("Error fetching child tables:",gr),Be([])}})()},[w]),reactExports.useEffect(()=>{(async()=>{if(!(!w||w.includes("→")))try{Ut(w);const ur=await tableService.getData(w);vt(Array.isArray(ur)?ur:[])}catch(ur){console.error("Error loading parent data:",ur),vt([])}})()},[w]),reactExports.useEffect(()=>{if(!Ne.trim()){Le(_e);return}const or=Ne.toLowerCase(),ur=_e.filter(gr=>Object.values(gr).some($r=>$r==null?!1:String($r).toLowerCase().includes(or)));Le(ur)},[Ne,_e]),(!E||!Array.isArray(E)||E.length===0)&&w)return jsxRuntimeExports.jsxs("div",{className:"data-table-container",children:[w&&jsxRuntimeExports.jsxs("div",{className:"table-title",children:[jsxRuntimeExports.jsx("h2",{children:Lt}),($e.length>0||w.includes("→"))&&jsxRuntimeExports.jsx("div",{className:"child-table-selector",children:jsxRuntimeExports.jsx("select",{value:w.includes("→")?"child":"parent",onChange:or=>{console.log("🔄 Empty state dropdown onChange triggered:",or.target.value);const ur=w.includes("→")?w.split("→")[0].trim():w;if(or.target.value==="parent")console.log("🔄 Switching to parent table:",ur),Br(ur);else if(or.target.value==="child"){const gr=w.includes("→")?w.split("→")[1].trim():$e[0];console.log("🔄 Switching to child table:",gr),Br(gr)}},className:"child-table-dropdown",children:w.includes("→")?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("option",{value:"parent",children:[tableService.formatSingleTableName(w.split("→")[0].trim())," (Principal)"]}),jsxRuntimeExports.jsxs("option",{value:"child",children:[tableService.formatSingleTableName(w.split("→")[1].trim())," (Secundaria)"]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("option",{value:"parent",children:[tableService.formatSingleTableName(w)," (Principal)"]}),$e.map(or=>jsxRuntimeExports.jsxs("option",{value:"child",children:[tableService.formatSingleTableName(or)," (Secundaria)"]},or))]})})}),w.includes("→")&&jsxRuntimeExports.jsx("div",{className:"table-subtitle",children:(()=>{const[or,ur]=w.split("→").map(gr=>gr.trim());return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"parent-table",children:[jsxRuntimeExports.jsx("span",{className:"table-label",children:"Tabla Principal:"}),tableService.formatSingleTableName(or)]}),jsxRuntimeExports.jsxs("div",{className:"child-table",children:[jsxRuntimeExports.jsx("span",{className:"table-label",children:"Tabla Secundaria:"}),tableService.formatSingleTableName(ur)]})]})})()})]}),jsxRuntimeExports.jsx("div",{className:"table-controls",children:jsxRuntimeExports.jsx("div",{className:"search-section",children:jsxRuntimeExports.jsxs("button",{className:"capturador-btn",onClick:()=>Wt(!0),title:"Abrir Capturador",children:[jsxRuntimeExports.jsxs("svg",{className:"pdf-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),jsxRuntimeExports.jsx("path",{d:"M14 2v6h6"}),jsxRuntimeExports.jsx("path",{d:"M16 13H8"}),jsxRuntimeExports.jsx("path",{d:"M16 17H8"}),jsxRuntimeExports.jsx("path",{d:"M10 9H8"})]}),"Capturador"]})})}),Qe&&Qe.length>0&&jsxRuntimeExports.jsxs("div",{className:"parent-table-section",children:[jsxRuntimeExports.jsx("h3",{children:tableService.formatSingleTableName(Dt)}),jsxRuntimeExports.jsxs("table",{className:"data-table",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsx("tr",{children:Object.keys(Qe[0]||{}).map(or=>jsxRuntimeExports.jsx("th",{children:or},or))})}),jsxRuntimeExports.jsx("tbody",{children:Qe.map((or,ur)=>jsxRuntimeExports.jsx("tr",{children:Object.values(or).map((gr,$r)=>jsxRuntimeExports.jsx("td",{children:gr},$r))},ur))})]})]}),jsxRuntimeExports.jsxs("div",{className:"empty-table-state",children:[jsxRuntimeExports.jsx("p",{children:"No hay datos en esta tabla."}),jsxRuntimeExports.jsx("p",{children:'Utilice el botón "Capturador" para comenzar a agregar registros.'})]}),jsxRuntimeExports.jsx(Modal$1,{isOpen:Je,onClose:()=>Wt(!1),size:"full",children:jsxRuntimeExports.jsx("div",{style:{height:"100%",width:"100%"},children:jsxRuntimeExports.jsx(PDFParser,{selectedTable:w,onDataCaptured:T})})})]});if(!E||!Array.isArray(E)||E.length===0)return jsxRuntimeExports.jsx("div",{className:"no-data",children:"No data available"});const hr=Object.keys(E[0]),pt=(or,ur,gr)=>{if(ur==="status"){const $r=E[or];nr({isOpen:!0,rowId:$r.id,currentStatus:gr||"Vigente 🟢"});return}I({rowIndex:or,column:ur,value:gr}),te(gr!==null?String(gr):"")},yr=()=>{I(null),te("")},vr=async()=>{var $r,Xr;if(!S)return;const{rowIndex:or,column:ur}=S,gr=E[or];try{if(H==null)throw new Error("Invalid value: Value cannot be empty");if(!gr||!gr.id)throw new Error("Invalid row data");console.log("Updating cell with:",{id:gr.id,column:ur,value:H});const Rr=await v(gr.id,ur,H);if(console.log("Update result:",Rr),!Rr||Rr.success===!1)throw new Error((Rr==null?void 0:Rr.message)||"Failed to update cell");if(Rr.updatedData){const pr=Ie.map(xr=>xr.id===gr.id?{...xr,...Rr.updatedData}:xr);Le(pr)}yr(),c.success("Cell updated successfully")}catch(Rr){console.error("Failed to update cell:",Rr);const pr=((Xr=($r=Rr.response)==null?void 0:$r.data)==null?void 0:Xr.error)||Rr.message||"Failed to update cell";c.error(`Update failed: ${pr}`)}},wr=or=>{or.key==="Enter"?(or.preventDefault(),vr()):or.key==="Escape"&&yr()},ir=(or,ur,gr,$r)=>{if(or.preventDefault(),or.detail===2){pt(ur,gr,$r);return}const Xr=`${ur}-${gr}`;if(or.shiftKey&&je){const Rr=Math.min(je.rowIndex,ur),pr=Math.max(je.rowIndex,ur),xr=hr.indexOf(je.column),qr=hr.indexOf(gr),ns=Math.min(xr,qr),ss=Math.max(xr,qr),ar=[];for(let Sr=Rr;Sr<=pr;Sr++)for(let zr=ns;zr<=ss;zr++)ar.push(`${Sr}-${hr[zr]}`);Ue(ar)}else or.metaKey||or.ctrlKey?Ue(Rr=>Rr.includes(Xr)?Rr.filter(pr=>pr!==Xr):[...Rr,Xr]):(Ue([Xr]),ke({rowIndex:ur,column:gr}))};reactExports.useEffect(()=>{const or=ur=>{var qr;if(ze.length===0)return;const gr={};let $r=1/0,Xr=-1/0,Rr=1/0,pr=-1/0;ze.forEach(ns=>{const[ss,ar]=ns.split("-"),Sr=parseInt(ss),zr=hr.indexOf(ar);$r=Math.min($r,Sr),Xr=Math.max(Xr,Sr),Rr=Math.min(Rr,zr),pr=Math.max(pr,zr),gr[Sr]||(gr[Sr]={}),gr[Sr][zr]=E[Sr][ar]});let xr="";for(let ns=$r;ns<=Xr;ns++){const ss=[];for(let ar=Rr;ar<=pr;ar++)ss.push(((qr=gr[ns])==null?void 0:qr[ar])??"");xr+=ss.join("	")+`
`}ur.clipboardData.setData("text/plain",xr.trim()),ur.preventDefault()};return document.addEventListener("copy",or),()=>document.removeEventListener("copy",or)},[ze,E,hr]);const sr=or=>{Ct({isOpen:!0,rowData:or})},kt=()=>{Ct({isOpen:!1,rowData:null})},rr=or=>{Rt(or)},lr=async()=>{if(!(!Ze||!Ze.id))try{await tableService.deleteRow(w,Ze.id),Rt(null);const or=Ie.filter(ur=>ur.id!==Ze.id);Le(or),c.success("Row deleted successfully"),T&&await T()}catch(or){console.error("Error deleting row:",or),c.error("Failed to delete row")}},mr=async(or,ur)=>{var gr;try{if(console.log("Status change initiated:",{rowId:or,newValue:ur}),!["Vigente 🟢","Baja 🔴"].includes(ur))throw new Error(`Invalid status value: ${ur}`);Le($r=>$r.map(Xr=>Xr.id===or?{...Xr,status:ur}:Xr)),await v(or,"status",ur),console.log("Status update successful"),await refreshData()}catch($r){console.error("Failed to update status:",{error:$r,rowId:or,newValue:ur,details:(gr=$r.response)==null?void 0:gr.data}),await refreshData(),alert("Error updating status. Please try again.")}},Ir=()=>{nr({isOpen:!1,rowId:null,currentStatus:null})},Or=async or=>{try{await mr(nt.rowId,or),Ir()}catch(ur){console.error("Error updating status:",ur)}},Fr=(or,ur,gr)=>{if(S&&S.rowIndex===ur&&S.column===gr)return gr==="status"?jsxRuntimeExports.jsxs("select",{value:H,onChange:Xr=>te(Xr.target.value),onKeyDown:wr,autoFocus:!0,className:"edit-cell-input",children:[jsxRuntimeExports.jsx("option",{value:"Vigente 🟢",children:"Vigente 🟢"}),jsxRuntimeExports.jsx("option",{value:"Baja 🔴",children:"Baja 🔴"})]}):jsxRuntimeExports.jsx("input",{type:"text",value:H,onChange:Xr=>te(Xr.target.value),onKeyDown:wr,autoFocus:!0,className:"edit-cell-input"});if(gr==="status"){const Xr=or[gr]||"Vigente 🟢";return jsxRuntimeExports.jsx("div",{className:`status-indicator ${Xr.includes("Baja")?"status-inactive":"status-active"}`,children:Xr})}const $r=or[gr]!==null?String(or[gr]):"-";return jsxRuntimeExports.jsxs("div",{className:"cell-content",children:[$r,jsxRuntimeExports.jsx("span",{className:"edit-pencil",onClick:Xr=>{Xr.stopPropagation(),pt(ur,gr,or[gr])},children:"✎"})]})};let Et=hr;if(w&&((Lr=E[0])==null?void 0:Lr.status)!==void 0){Et=hr.filter(ur=>ur!=="status");const or=Et.indexOf("id");or!==-1&&Et.splice(or+1,0,"status")}const dr=or=>!ce||ce.key!==or?jsxRuntimeExports.jsx("span",{className:"sort-icon",children:"⇅"}):jsxRuntimeExports.jsx("span",{className:"sort-icon active",children:ce.direction==="ascending"?"↑":"↓"}),br=or=>{let ur="ascending";ce.key===or&&ce.direction==="ascending"&&(ur="descending"),me({key:or,direction:ur});const gr=[...Ie].sort(($r,Xr)=>{if($r[or]===null)return 1;if(Xr[or]===null)return-1;if($r[or]===Xr[or])return 0;const Rr=$r[or]<Xr[or]?-1:1;return ur==="ascending"?Rr:-Rr});Le(gr)},Br=async or=>{if(console.log("🚀 handleChildTableSelect called with:",or),!or){console.log("❌ No selectedTableName provided");return}const ur=w.includes("→")?w.split("→")[0].trim():w;if(console.log("📊 Current state:",{selectedTableName:or,baseParentTable:ur,currentTableName:w,currentSelectedChild:Xe}),or===ur){console.log("Loading parent table:",ur),rt(""),T&&await T(ur);return}console.log("Selecting child table:",or,"for parent:",ur),rt(or);const gr=`${ur} → ${or}`;console.log("Loading combined table:",gr),T&&await T(gr)};return jsxRuntimeExports.jsxs("div",{className:"data-table-container",children:[Lt&&jsxRuntimeExports.jsxs("div",{className:"table-title",children:[jsxRuntimeExports.jsx("h2",{children:Lt}),($e.length>0||w.includes("→"))&&jsxRuntimeExports.jsx("div",{className:"child-table-selector",children:jsxRuntimeExports.jsx("select",{value:w.includes("→")?"child":"parent",onChange:or=>{console.log("🔄 DROPDOWN CLICKED! Value:",or.target.value,"Current table:",w);const ur=w.includes("→")?w.split("→")[0].trim():w;if(or.target.value==="parent")console.log("🔄 Switching to parent table:",ur),Br(ur);else if(or.target.value==="child"){const gr=w.includes("→")?w.split("→")[1].trim():$e[0];console.log("🔄 Switching to child table:",gr),Br(gr)}},className:"child-table-dropdown",children:w.includes("→")?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("option",{value:"parent",children:[tableService.formatSingleTableName(w.split("→")[0].trim())," (Principal)"]}),jsxRuntimeExports.jsxs("option",{value:"child",children:[tableService.formatSingleTableName(w.split("→")[1].trim())," (Secundaria)"]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("option",{value:"parent",children:[tableService.formatSingleTableName(w)," (Principal)"]}),$e.map(or=>jsxRuntimeExports.jsxs("option",{value:"child",children:[tableService.formatSingleTableName(or)," (Secundaria)"]},or))]})})}),w.includes("→")&&jsxRuntimeExports.jsx("div",{className:"table-subtitle",children:(()=>{const[or,ur]=w.split("→").map(gr=>gr.trim());return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"parent-table",children:[jsxRuntimeExports.jsx("span",{className:"table-label",children:"Tabla Principal:"}),tableService.formatSingleTableName(or)]}),jsxRuntimeExports.jsxs("div",{className:"child-table",children:[jsxRuntimeExports.jsx("span",{className:"table-label",children:"Tabla Secundaria:"}),tableService.formatSingleTableName(ur)]})]})})()})]}),jsxRuntimeExports.jsx("div",{className:"table-controls",children:jsxRuntimeExports.jsxs("div",{className:"search-section",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Buscar en tabla...",value:Ne,onChange:or=>Ge(or.target.value),className:"search-input"}),jsxRuntimeExports.jsxs("button",{className:"capturador-btn",onClick:()=>Wt(!0),title:"Abrir Capturador",children:[jsxRuntimeExports.jsxs("svg",{className:"pdf-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),jsxRuntimeExports.jsx("path",{d:"M14 2v6h6"}),jsxRuntimeExports.jsx("path",{d:"M16 13H8"}),jsxRuntimeExports.jsx("path",{d:"M16 17H8"}),jsxRuntimeExports.jsx("path",{d:"M10 9H8"})]}),"Capturador"]})]})}),jsxRuntimeExports.jsx(Modal$1,{isOpen:Je,onClose:()=>Wt(!1),size:"full",children:jsxRuntimeExports.jsx("div",{style:{height:"100%",width:"100%"},children:jsxRuntimeExports.jsx(PDFParser,{selectedTable:w})})}),jsxRuntimeExports.jsx("div",{className:`table-wrapper ${ae?"refreshing":""}`,children:jsxRuntimeExports.jsxs("table",{className:"data-table",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{className:"email-column",children:jsxRuntimeExports.jsx("div",{className:"header-content",children:jsxRuntimeExports.jsx("span",{children:"Actions"})})}),Et.map(or=>jsxRuntimeExports.jsx("th",{onClick:()=>br(or),className:`sortable-header ${ce.key===or?"active":""}`,children:jsxRuntimeExports.jsxs("div",{className:"th-content",children:[jsxRuntimeExports.jsx("span",{children:or}),dr(or)]})},or))]})}),jsxRuntimeExports.jsx("tbody",{children:Ie.map((or,ur)=>jsxRuntimeExports.jsxs("tr",{className:"table-row",children:[jsxRuntimeExports.jsx("td",{className:"actions-cell",children:jsxRuntimeExports.jsxs("div",{className:"row-actions",children:[jsxRuntimeExports.jsx("button",{className:"email-icon-btn",title:"Send Email",onClick:gr=>{gr.stopPropagation(),sr(or)},children:jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"email-icon",children:[jsxRuntimeExports.jsx("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"}),jsxRuntimeExports.jsx("path",{d:"M22 6l-10 7L2 6"})]})}),jsxRuntimeExports.jsx("button",{className:"delete-btn",title:"Delete Row",onClick:gr=>{gr.stopPropagation(),rr(or)},children:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",className:"delete-icon",children:jsxRuntimeExports.jsx("path",{d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})}),Et.map(gr=>jsxRuntimeExports.jsx("td",{onClick:$r=>ir($r,ur,gr,or[gr]),className:`editable-cell ${gr==="id"?"id-cell":""} ${gr==="status"?"status-cell":""} ${ze.includes(`${ur}-${gr}`)?"selected-cell":""}`,children:Fr(or,ur,gr)},`${ur}-${gr}`))]},ur))})]})}),jsxRuntimeExports.jsx(TableMail,{isOpen:He.isOpen,onClose:kt,rowData:He.rowData}),Ze&&jsxRuntimeExports.jsx("div",{className:"delete-overlay",children:jsxRuntimeExports.jsxs("div",{className:"delete-confirmation-dialog",children:[jsxRuntimeExports.jsx("h4",{children:"Delete Row"}),jsxRuntimeExports.jsx("p",{children:"Are you sure you want to delete this row? This action cannot be undone."}),jsxRuntimeExports.jsxs("div",{className:"delete-confirmation-actions",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Rt(null),className:"delete-cancel-btn",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:lr,className:"delete-confirm-btn",children:"Delete"})]})]})}),S&&jsxRuntimeExports.jsx("div",{className:"edit-cell-popup",children:jsxRuntimeExports.jsxs("div",{className:"edit-cell-content",onClick:or=>or.stopPropagation(),children:[jsxRuntimeExports.jsx("h4",{children:"Edit Cell"}),jsxRuntimeExports.jsxs("div",{className:"edit-cell-info",children:[jsxRuntimeExports.jsxs("p",{children:["Column: ",S.column]}),jsxRuntimeExports.jsx("textarea",{value:H,onChange:or=>te(or.target.value),onKeyDown:wr,autoFocus:!0,rows:3,className:"edit-cell-textarea"}),jsxRuntimeExports.jsx("div",{className:"pdf-upload-section",children:jsxRuntimeExports.jsx("button",{onClick:()=>Ce(!Pe),className:"pdf-toggle-btn",title:"Extract from PDF",children:jsxRuntimeExports.jsxs("svg",{className:"pdf-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),jsxRuntimeExports.jsx("path",{d:"M14 2v6h6"}),jsxRuntimeExports.jsx("path",{d:"M16 13H8"}),jsxRuntimeExports.jsx("path",{d:"M16 17H8"}),jsxRuntimeExports.jsx("path",{d:"M10 9H8"})]})})}),Pe&&jsxRuntimeExports.jsx(CellPDFParser,{columnName:S.column,onValueExtracted:te})]}),jsxRuntimeExports.jsxs("div",{className:"edit-cell-actions",children:[jsxRuntimeExports.jsx("button",{onClick:yr,className:"cancel-btn",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:vr,className:"confirm-btn",children:"Save"})]})]})}),nt.isOpen&&jsxRuntimeExports.jsx("div",{className:"status-modal-overlay",children:jsxRuntimeExports.jsxs("div",{className:"status-modal",children:[jsxRuntimeExports.jsx("h4",{children:"Cambiar Estado"}),jsxRuntimeExports.jsxs("div",{className:"status-options",children:[jsxRuntimeExports.jsx("button",{className:`status-option ${nt.currentStatus==="Vigente 🟢"?"active":""}`,onClick:()=>Or("Vigente 🟢"),children:"Vigente 🟢"}),jsxRuntimeExports.jsx("button",{className:`status-option ${nt.currentStatus==="Baja 🔴"?"active":""}`,onClick:()=>Or("Baja 🔴"),children:"Baja 🔴"})]}),jsxRuntimeExports.jsx("div",{className:"status-modal-actions",children:jsxRuntimeExports.jsx("button",{onClick:Ir,className:"cancel-btn",children:"Cancelar"})})]})})]})},TableCardView=({data:E,onCardClick:r})=>{const[v,T]=reactExports.useState(new Set),w=(me,_e)=>{_e.stopPropagation(),T(Re=>{const Pe=new Set(Re);return Pe.has(me)?Pe.delete(me):Pe.add(me),Pe})},S=me=>me?me.charAt(0).toUpperCase()+me.slice(1):"General",I=me=>{if(me.nombre_contratante)return me.nombre_contratante;const _e=["nombre","contratante","name"];for(const Re of _e)if(me[Re]&&typeof me[Re]=="string")return me[Re];return"Sin título"},H=me=>{if(me.numero_de_poliza)return`Póliza: ${me.numero_de_poliza}`;const _e=["poliza","numero_poliza"];for(const Re of _e)if(me[Re]&&typeof me[Re]=="string")return`Póliza: ${me[Re]}`;return""},te=me=>{if(!me||me.includes("/"))return me;const _e=new Date(me);return isNaN(_e.getTime())?me:_e.toLocaleDateString("es-MX")},ae=(me,_e)=>{if(!_e)return"-";if(me==="forma_de_pago"){const Re=_e.toString().trim().toLowerCase();return!Re||Re==="null"||Re==="undefined"?"No especificada":Re.charAt(0).toUpperCase()+Re.slice(1)}if(me.includes("fecha")||me.includes("vigencia"))return te(_e);if(me.includes("prima")||me.includes("pago")||me.includes("precio")||me.includes("costo")){const Re=typeof _e=="string"?parseFloat(_e):_e;return isNaN(Re)?"-":`$${Re.toLocaleString("es-MX",{minimumFractionDigits:2})}`}return me.includes("direccion")||me.includes("domicilio")?_e.toString().split(",").map(Re=>Re.trim()).join(`,
`):me.includes("descripcion")||typeof _e=="string"&&_e.length>50?_e.toString().split(" ").reduce((Re,Pe)=>(Re.length>0&&Re[Re.length-1].length+Pe.length<40?Re[Re.length-1]=`${Re[Re.length-1]} ${Pe}`:Re.push(Pe),Re),[]).join(`
`):_e.toString()},ie=me=>me.split("_").map(_e=>_e.charAt(0).toUpperCase()+_e.slice(1)).join(" "),ce=(me,_e)=>{const Re=I(me),Pe=H(me),Ce=["vigencia_fin","forma_de_pago"],Fe=["id","_sourceTable","nombre_contratante","numero_de_poliza","aa","pdf","ramo"],Me=["aseguradora","tipo_de_vehiculo","vigencia_inicio","duracion","prima_neta","pago_total_o_prima_total","descripcion_del_vehiculo","modelo","placas"];return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("h3",{className:"card-title",children:Re}),Pe&&jsxRuntimeExports.jsx("div",{className:"card-subtitle",children:Pe}),jsxRuntimeExports.jsxs("div",{className:`card-details ${_e?"expanded":""}`,children:[Ce.map(Ve=>jsxRuntimeExports.jsxs("div",{className:"card-detail-item",children:[jsxRuntimeExports.jsxs("span",{className:"detail-label",children:[ie(Ve),":"]}),jsxRuntimeExports.jsx("span",{className:"detail-value",children:ae(Ve,me[Ve])})]},Ve)),_e&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[Me.map(Ve=>me[Ve]&&jsxRuntimeExports.jsxs("div",{className:"card-detail-item",children:[jsxRuntimeExports.jsxs("span",{className:"detail-label",children:[ie(Ve),":"]}),jsxRuntimeExports.jsx("span",{className:"detail-value",children:ae(Ve,me[Ve])})]},Ve)),Object.entries(me).filter(([Ve])=>!Fe.includes(Ve)&&!Ce.includes(Ve)&&!Me.includes(Ve)&&me[Ve]!==null&&me[Ve]!==void 0&&me[Ve]!=="").sort(([Ve],[We])=>Ve.localeCompare(We)).map(([Ve,We])=>jsxRuntimeExports.jsxs("div",{className:"card-detail-item",children:[jsxRuntimeExports.jsxs("span",{className:"detail-label",children:[ie(Ve),":"]}),jsxRuntimeExports.jsx("span",{className:"detail-value",children:ae(Ve,We)})]},Ve))]})]})]})};return jsxRuntimeExports.jsx("div",{className:"table-card-view",children:E.map((me,_e)=>{var Ce;const Re=`${me._sourceTable||"table"}-${me.id||_e}`,Pe=v.has(Re);return jsxRuntimeExports.jsxs("div",{className:"data-card",onClick:()=>r(me),children:[jsxRuntimeExports.jsxs("div",{className:"card-header",children:[jsxRuntimeExports.jsxs("div",{className:"card-header-left",children:[jsxRuntimeExports.jsx("span",{className:"card-source-table",children:S(me._sourceTable)}),me.id&&jsxRuntimeExports.jsxs("span",{className:"card-id",children:["#",me.id]})]}),jsxRuntimeExports.jsxs("div",{className:"card-header-right",children:[me.status&&jsxRuntimeExports.jsx("span",{className:`card-status status-${(Ce=me.status)==null?void 0:Ce.toLowerCase()}`,children:me.status}),jsxRuntimeExports.jsx("button",{className:"expand-button",onClick:Fe=>w(Re,Fe),"aria-label":Pe?"Contraer":"Expandir",children:Pe?"−":"+"})]})]}),jsxRuntimeExports.jsx("div",{className:`card-content ${Pe?"expanded":""}`,children:ce(me,Pe)})]},Re)})})};/*! xlsx.js (C) 2013-present SheetJS -- http://sheetjs.com */var current_ansi=1252,VALID_ANSI=[874,932,936,949,950,1250,1251,1252,1253,1254,1255,1256,1257,1258,1e4],CS2CP={0:1252,1:65001,2:65001,77:1e4,128:932,129:949,130:1361,134:936,136:950,161:1253,162:1254,163:1258,177:1255,178:1256,186:1257,204:1251,222:874,238:1250,255:1252,69:6969},set_ansi=function(E){VALID_ANSI.indexOf(E)!=-1&&(current_ansi=CS2CP[0]=E)};function reset_ansi(){set_ansi(1252)}var set_cp=function(E){set_ansi(E)};function reset_cp(){set_cp(1200),reset_ansi()}function char_codes(E){for(var r=[],v=0,T=E.length;v<T;++v)r[v]=E.charCodeAt(v);return r}function utf16leread(E){for(var r=[],v=0;v<E.length>>1;++v)r[v]=String.fromCharCode(E.charCodeAt(2*v)+(E.charCodeAt(2*v+1)<<8));return r.join("")}function utf16beread(E){for(var r=[],v=0;v<E.length>>1;++v)r[v]=String.fromCharCode(E.charCodeAt(2*v+1)+(E.charCodeAt(2*v)<<8));return r.join("")}var debom=function(E){var r=E.charCodeAt(0),v=E.charCodeAt(1);return r==255&&v==254?utf16leread(E.slice(2)):r==254&&v==255?utf16beread(E.slice(2)):r==65279?E.slice(1):E},_getchar=function E(r){return String.fromCharCode(r)},_getansi=function E(r){return String.fromCharCode(r)},$cptable,Base64_map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Base64_encode(E){for(var r="",v=0,T=0,w=0,S=0,I=0,H=0,te=0,ae=0;ae<E.length;)v=E.charCodeAt(ae++),S=v>>2,T=E.charCodeAt(ae++),I=(v&3)<<4|T>>4,w=E.charCodeAt(ae++),H=(T&15)<<2|w>>6,te=w&63,isNaN(T)?H=te=64:isNaN(w)&&(te=64),r+=Base64_map.charAt(S)+Base64_map.charAt(I)+Base64_map.charAt(H)+Base64_map.charAt(te);return r}function Base64_decode(E){var r="",v=0,T=0,w=0,S=0,I=0,H=0,te=0;E=E.replace(/[^\w\+\/\=]/g,"");for(var ae=0;ae<E.length;)S=Base64_map.indexOf(E.charAt(ae++)),I=Base64_map.indexOf(E.charAt(ae++)),v=S<<2|I>>4,r+=String.fromCharCode(v),H=Base64_map.indexOf(E.charAt(ae++)),T=(I&15)<<4|H>>2,H!==64&&(r+=String.fromCharCode(T)),te=Base64_map.indexOf(E.charAt(ae++)),w=(H&3)<<6|te,te!==64&&(r+=String.fromCharCode(w));return r}var has_buf=function(){return typeof Buffer<"u"&&typeof process<"u"&&typeof process.versions<"u"&&!!process.versions.node}(),Buffer_from=function(){if(typeof Buffer<"u"){var E=!Buffer.from;if(!E)try{Buffer.from("foo","utf8")}catch{E=!0}return E?function(r,v){return v?new Buffer(r,v):new Buffer(r)}:Buffer.from.bind(Buffer)}return function(){}}();function new_raw_buf(E){return has_buf?Buffer.alloc?Buffer.alloc(E):new Buffer(E):typeof Uint8Array<"u"?new Uint8Array(E):new Array(E)}function new_unsafe_buf(E){return has_buf?Buffer.allocUnsafe?Buffer.allocUnsafe(E):new Buffer(E):typeof Uint8Array<"u"?new Uint8Array(E):new Array(E)}var s2a=function E(r){return has_buf?Buffer_from(r,"binary"):r.split("").map(function(v){return v.charCodeAt(0)&255})};function a2s(E){if(Array.isArray(E))return E.map(function(T){return String.fromCharCode(T)}).join("");for(var r=[],v=0;v<E.length;++v)r[v]=String.fromCharCode(E[v]);return r.join("")}function ab2a(E){if(typeof ArrayBuffer>"u")throw new Error("Unsupported");if(E instanceof ArrayBuffer)return ab2a(new Uint8Array(E));for(var r=new Array(E.length),v=0;v<E.length;++v)r[v]=E[v];return r}var bconcat=has_buf?function(E){return Buffer.concat(E.map(function(r){return Buffer.isBuffer(r)?r:Buffer_from(r)}))}:function(E){if(typeof Uint8Array<"u"){var r=0,v=0;for(r=0;r<E.length;++r)v+=E[r].length;var T=new Uint8Array(v),w=0;for(r=0,v=0;r<E.length;v+=w,++r)if(w=E[r].length,E[r]instanceof Uint8Array)T.set(E[r],v);else{if(typeof E[r]=="string")throw"wtf";T.set(new Uint8Array(E[r]),v)}return T}return[].concat.apply([],E.map(function(S){return Array.isArray(S)?S:[].slice.call(S)}))};function utf8decode(E){for(var r=[],v=0,T=E.length+250,w=new_raw_buf(E.length+255),S=0;S<E.length;++S){var I=E.charCodeAt(S);if(I<128)w[v++]=I;else if(I<2048)w[v++]=192|I>>6&31,w[v++]=128|I&63;else if(I>=55296&&I<57344){I=(I&1023)+64;var H=E.charCodeAt(++S)&1023;w[v++]=240|I>>8&7,w[v++]=128|I>>2&63,w[v++]=128|H>>6&15|(I&3)<<4,w[v++]=128|H&63}else w[v++]=224|I>>12&15,w[v++]=128|I>>6&63,w[v++]=128|I&63;v>T&&(r.push(w.slice(0,v)),v=0,w=new_raw_buf(65535),T=65530)}return r.push(w.slice(0,v)),bconcat(r)}var chr0=/\u0000/g,chr1=/[\u0001-\u0006]/g;function _strrev(E){for(var r="",v=E.length-1;v>=0;)r+=E.charAt(v--);return r}function pad0(E,r){var v=""+E;return v.length>=r?v:fill("0",r-v.length)+v}function pad_(E,r){var v=""+E;return v.length>=r?v:fill(" ",r-v.length)+v}function rpad_(E,r){var v=""+E;return v.length>=r?v:v+fill(" ",r-v.length)}function pad0r1(E,r){var v=""+Math.round(E);return v.length>=r?v:fill("0",r-v.length)+v}function pad0r2(E,r){var v=""+E;return v.length>=r?v:fill("0",r-v.length)+v}var p2_32=Math.pow(2,32);function pad0r(E,r){if(E>p2_32||E<-p2_32)return pad0r1(E,r);var v=Math.round(E);return pad0r2(v,r)}function SSF_isgeneral(E,r){return r=r||0,E.length>=7+r&&(E.charCodeAt(r)|32)===103&&(E.charCodeAt(r+1)|32)===101&&(E.charCodeAt(r+2)|32)===110&&(E.charCodeAt(r+3)|32)===101&&(E.charCodeAt(r+4)|32)===114&&(E.charCodeAt(r+5)|32)===97&&(E.charCodeAt(r+6)|32)===108}var days=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],months=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function SSF_init_table(E){return E||(E={}),E[0]="General",E[1]="0",E[2]="0.00",E[3]="#,##0",E[4]="#,##0.00",E[9]="0%",E[10]="0.00%",E[11]="0.00E+00",E[12]="# ?/?",E[13]="# ??/??",E[14]="m/d/yy",E[15]="d-mmm-yy",E[16]="d-mmm",E[17]="mmm-yy",E[18]="h:mm AM/PM",E[19]="h:mm:ss AM/PM",E[20]="h:mm",E[21]="h:mm:ss",E[22]="m/d/yy h:mm",E[37]="#,##0 ;(#,##0)",E[38]="#,##0 ;[Red](#,##0)",E[39]="#,##0.00;(#,##0.00)",E[40]="#,##0.00;[Red](#,##0.00)",E[45]="mm:ss",E[46]="[h]:mm:ss",E[47]="mmss.0",E[48]="##0.0E+0",E[49]="@",E[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',E}var table_fmt={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",37:"#,##0 ;(#,##0)",38:"#,##0 ;[Red](#,##0)",39:"#,##0.00;(#,##0.00)",40:"#,##0.00;[Red](#,##0.00)",45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},SSF_default_map={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},SSF_default_str={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function SSF_frac(E,r,v){for(var T=E<0?-1:1,w=E*T,S=0,I=1,H=0,te=1,ae=0,ie=0,ce=Math.floor(w);ae<r&&(ce=Math.floor(w),H=ce*I+S,ie=ce*ae+te,!(w-ce<5e-8));)w=1/(w-ce),S=I,I=H,te=ae,ae=ie;if(ie>r&&(ae>r?(ie=te,H=S):(ie=ae,H=I)),!v)return[0,T*H,ie];var me=Math.floor(T*H/ie);return[me,T*H-me*ie,ie]}function SSF_parse_date_code(E,r,v){if(E>2958465||E<0)return null;var T=E|0,w=Math.floor(86400*(E-T)),S=0,I=[],H={D:T,T:w,u:86400*(E-T)-w,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(H.u)<1e-6&&(H.u=0),r&&r.date1904&&(T+=1462),H.u>.9999&&(H.u=0,++w==86400&&(H.T=w=0,++T,++H.D)),T===60)I=v?[1317,10,29]:[1900,2,29],S=3;else if(T===0)I=v?[1317,8,29]:[1900,1,0],S=6;else{T>60&&--T;var te=new Date(1900,0,1);te.setDate(te.getDate()+T-1),I=[te.getFullYear(),te.getMonth()+1,te.getDate()],S=te.getDay(),T<60&&(S=(S+6)%7),v&&(S=SSF_fix_hijri(te,I))}return H.y=I[0],H.m=I[1],H.d=I[2],H.S=w%60,w=Math.floor(w/60),H.M=w%60,w=Math.floor(w/60),H.H=w,H.q=S,H}var SSFbasedate=new Date(1899,11,31,0,0,0),SSFdnthresh=SSFbasedate.getTime(),SSFbase1904=new Date(1900,2,1,0,0,0);function datenum_local(E,r){var v=E.getTime();return r?v-=1461*24*60*60*1e3:E>=SSFbase1904&&(v+=24*60*60*1e3),(v-(SSFdnthresh+(E.getTimezoneOffset()-SSFbasedate.getTimezoneOffset())*6e4))/(24*60*60*1e3)}function SSF_strip_decimal(E){return E.indexOf(".")==-1?E:E.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function SSF_normalize_exp(E){return E.indexOf("E")==-1?E:E.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}function SSF_small_exp(E){var r=E<0?12:11,v=SSF_strip_decimal(E.toFixed(12));return v.length<=r||(v=E.toPrecision(10),v.length<=r)?v:E.toExponential(5)}function SSF_large_exp(E){var r=SSF_strip_decimal(E.toFixed(11));return r.length>(E<0?12:11)||r==="0"||r==="-0"?E.toPrecision(6):r}function SSF_general_num(E){var r=Math.floor(Math.log(Math.abs(E))*Math.LOG10E),v;return r>=-4&&r<=-1?v=E.toPrecision(10+r):Math.abs(r)<=9?v=SSF_small_exp(E):r===10?v=E.toFixed(10).substr(0,12):v=SSF_large_exp(E),SSF_strip_decimal(SSF_normalize_exp(v.toUpperCase()))}function SSF_general(E,r){switch(typeof E){case"string":return E;case"boolean":return E?"TRUE":"FALSE";case"number":return(E|0)===E?E.toString(10):SSF_general_num(E);case"undefined":return"";case"object":if(E==null)return"";if(E instanceof Date)return SSF_format(14,datenum_local(E,r&&r.date1904),r)}throw new Error("unsupported value in General format: "+E)}function SSF_fix_hijri(E,r){r[0]-=581;var v=E.getDay();return E<60&&(v=(v+6)%7),v}function SSF_write_date(E,r,v,T){var w="",S=0,I=0,H=v.y,te,ae=0;switch(E){case 98:H=v.y+543;case 121:switch(r.length){case 1:case 2:te=H%100,ae=2;break;default:te=H%1e4,ae=4;break}break;case 109:switch(r.length){case 1:case 2:te=v.m,ae=r.length;break;case 3:return months[v.m-1][1];case 5:return months[v.m-1][0];default:return months[v.m-1][2]}break;case 100:switch(r.length){case 1:case 2:te=v.d,ae=r.length;break;case 3:return days[v.q][0];default:return days[v.q][1]}break;case 104:switch(r.length){case 1:case 2:te=1+(v.H+11)%12,ae=r.length;break;default:throw"bad hour format: "+r}break;case 72:switch(r.length){case 1:case 2:te=v.H,ae=r.length;break;default:throw"bad hour format: "+r}break;case 77:switch(r.length){case 1:case 2:te=v.M,ae=r.length;break;default:throw"bad minute format: "+r}break;case 115:if(r!="s"&&r!="ss"&&r!=".0"&&r!=".00"&&r!=".000")throw"bad second format: "+r;return v.u===0&&(r=="s"||r=="ss")?pad0(v.S,r.length):(T>=2?I=T===3?1e3:100:I=T===1?10:1,S=Math.round(I*(v.S+v.u)),S>=60*I&&(S=0),r==="s"?S===0?"0":""+S/I:(w=pad0(S,2+T),r==="ss"?w.substr(0,2):"."+w.substr(2,r.length-1)));case 90:switch(r){case"[h]":case"[hh]":te=v.D*24+v.H;break;case"[m]":case"[mm]":te=(v.D*24+v.H)*60+v.M;break;case"[s]":case"[ss]":te=((v.D*24+v.H)*60+v.M)*60+Math.round(v.S+v.u);break;default:throw"bad abstime format: "+r}ae=r.length===3?1:2;break;case 101:te=H,ae=1;break}var ie=ae>0?pad0(te,ae):"";return ie}function commaify(E){var r=3;if(E.length<=r)return E;for(var v=E.length%r,T=E.substr(0,v);v!=E.length;v+=r)T+=(T.length>0?",":"")+E.substr(v,r);return T}var pct1=/%/g;function write_num_pct(E,r,v){var T=r.replace(pct1,""),w=r.length-T.length;return write_num(E,T,v*Math.pow(10,2*w))+fill("%",w)}function write_num_cm(E,r,v){for(var T=r.length-1;r.charCodeAt(T-1)===44;)--T;return write_num(E,r.substr(0,T),v/Math.pow(10,3*(r.length-T)))}function write_num_exp(E,r){var v,T=E.indexOf("E")-E.indexOf(".")-1;if(E.match(/^#+0.0E\+0$/)){if(r==0)return"0.0E+0";if(r<0)return"-"+write_num_exp(E,-r);var w=E.indexOf(".");w===-1&&(w=E.indexOf("E"));var S=Math.floor(Math.log(r)*Math.LOG10E)%w;if(S<0&&(S+=w),v=(r/Math.pow(10,S)).toPrecision(T+1+(w+S)%w),v.indexOf("e")===-1){var I=Math.floor(Math.log(r)*Math.LOG10E);for(v.indexOf(".")===-1?v=v.charAt(0)+"."+v.substr(1)+"E+"+(I-v.length+S):v+="E+"+(I-S);v.substr(0,2)==="0.";)v=v.charAt(0)+v.substr(2,w)+"."+v.substr(2+w),v=v.replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");v=v.replace(/\+-/,"-")}v=v.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(H,te,ae,ie){return te+ae+ie.substr(0,(w+S)%w)+"."+ie.substr(S)+"E"})}else v=r.toExponential(T);return E.match(/E\+00$/)&&v.match(/e[+-]\d$/)&&(v=v.substr(0,v.length-1)+"0"+v.charAt(v.length-1)),E.match(/E\-/)&&v.match(/e\+/)&&(v=v.replace(/e\+/,"e")),v.replace("e","E")}var frac1=/# (\?+)( ?)\/( ?)(\d+)/;function write_num_f1(E,r,v){var T=parseInt(E[4],10),w=Math.round(r*T),S=Math.floor(w/T),I=w-S*T,H=T;return v+(S===0?"":""+S)+" "+(I===0?fill(" ",E[1].length+1+E[4].length):pad_(I,E[1].length)+E[2]+"/"+E[3]+pad0(H,E[4].length))}function write_num_f2(E,r,v){return v+(r===0?"":""+r)+fill(" ",E[1].length+2+E[4].length)}var dec1=/^#*0*\.([0#]+)/,closeparen=/\).*[0#]/,phone=/\(###\) ###\\?-####/;function hashq(E){for(var r="",v,T=0;T!=E.length;++T)switch(v=E.charCodeAt(T)){case 35:break;case 63:r+=" ";break;case 48:r+="0";break;default:r+=String.fromCharCode(v)}return r}function rnd(E,r){var v=Math.pow(10,r);return""+Math.round(E*v)/v}function dec(E,r){var v=E-Math.floor(E),T=Math.pow(10,r);return r<(""+Math.round(v*T)).length?0:Math.round(v*T)}function carry(E,r){return r<(""+Math.round((E-Math.floor(E))*Math.pow(10,r))).length?1:0}function flr(E){return E<2147483647&&E>-2147483648?""+(E>=0?E|0:E-1|0):""+Math.floor(E)}function write_num_flt(E,r,v){if(E.charCodeAt(0)===40&&!r.match(closeparen)){var T=r.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return v>=0?write_num_flt("n",T,v):"("+write_num_flt("n",T,-v)+")"}if(r.charCodeAt(r.length-1)===44)return write_num_cm(E,r,v);if(r.indexOf("%")!==-1)return write_num_pct(E,r,v);if(r.indexOf("E")!==-1)return write_num_exp(r,v);if(r.charCodeAt(0)===36)return"$"+write_num_flt(E,r.substr(r.charAt(1)==" "?2:1),v);var w,S,I,H,te=Math.abs(v),ae=v<0?"-":"";if(r.match(/^00+$/))return ae+pad0r(te,r.length);if(r.match(/^[#?]+$/))return w=pad0r(v,0),w==="0"&&(w=""),w.length>r.length?w:hashq(r.substr(0,r.length-w.length))+w;if(S=r.match(frac1))return write_num_f1(S,te,ae);if(r.match(/^#+0+$/))return ae+pad0r(te,r.length-r.indexOf("0"));if(S=r.match(dec1))return w=rnd(v,S[1].length).replace(/^([^\.]+)$/,"$1."+hashq(S[1])).replace(/\.$/,"."+hashq(S[1])).replace(/\.(\d*)$/,function(Re,Pe){return"."+Pe+fill("0",hashq(S[1]).length-Pe.length)}),r.indexOf("0.")!==-1?w:w.replace(/^0\./,".");if(r=r.replace(/^#+([0.])/,"$1"),S=r.match(/^(0*)\.(#*)$/))return ae+rnd(te,S[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,S[1].length?"0.":".");if(S=r.match(/^#{1,3},##0(\.?)$/))return ae+commaify(pad0r(te,0));if(S=r.match(/^#,##0\.([#0]*0)$/))return v<0?"-"+write_num_flt(E,r,-v):commaify(""+(Math.floor(v)+carry(v,S[1].length)))+"."+pad0(dec(v,S[1].length),S[1].length);if(S=r.match(/^#,#*,#0/))return write_num_flt(E,r.replace(/^#,#*,/,""),v);if(S=r.match(/^([0#]+)(\\?-([0#]+))+$/))return w=_strrev(write_num_flt(E,r.replace(/[\\-]/g,""),v)),I=0,_strrev(_strrev(r.replace(/\\/g,"")).replace(/[0#]/g,function(Re){return I<w.length?w.charAt(I++):Re==="0"?"0":""}));if(r.match(phone))return w=write_num_flt(E,"##########",v),"("+w.substr(0,3)+") "+w.substr(3,3)+"-"+w.substr(6);var ie="";if(S=r.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return I=Math.min(S[4].length,7),H=SSF_frac(te,Math.pow(10,I)-1,!1),w=""+ae,ie=write_num("n",S[1],H[1]),ie.charAt(ie.length-1)==" "&&(ie=ie.substr(0,ie.length-1)+"0"),w+=ie+S[2]+"/"+S[3],ie=rpad_(H[2],I),ie.length<S[4].length&&(ie=hashq(S[4].substr(S[4].length-ie.length))+ie),w+=ie,w;if(S=r.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return I=Math.min(Math.max(S[1].length,S[4].length),7),H=SSF_frac(te,Math.pow(10,I)-1,!0),ae+(H[0]||(H[1]?"":"0"))+" "+(H[1]?pad_(H[1],I)+S[2]+"/"+S[3]+rpad_(H[2],I):fill(" ",2*I+1+S[2].length+S[3].length));if(S=r.match(/^[#0?]+$/))return w=pad0r(v,0),r.length<=w.length?w:hashq(r.substr(0,r.length-w.length))+w;if(S=r.match(/^([#0?]+)\.([#0]+)$/)){w=""+v.toFixed(Math.min(S[2].length,10)).replace(/([^0])0+$/,"$1"),I=w.indexOf(".");var ce=r.indexOf(".")-I,me=r.length-w.length-ce;return hashq(r.substr(0,ce)+w+r.substr(r.length-me))}if(S=r.match(/^00,000\.([#0]*0)$/))return I=dec(v,S[1].length),v<0?"-"+write_num_flt(E,r,-v):commaify(flr(v)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(Re){return"00,"+(Re.length<3?pad0(0,3-Re.length):"")+Re})+"."+pad0(I,S[1].length);switch(r){case"###,##0.00":return write_num_flt(E,"#,##0.00",v);case"###,###":case"##,###":case"#,###":var _e=commaify(pad0r(te,0));return _e!=="0"?ae+_e:"";case"###,###.00":return write_num_flt(E,"###,##0.00",v).replace(/^0\./,".");case"#,###.00":return write_num_flt(E,"#,##0.00",v).replace(/^0\./,".")}throw new Error("unsupported format |"+r+"|")}function write_num_cm2(E,r,v){for(var T=r.length-1;r.charCodeAt(T-1)===44;)--T;return write_num(E,r.substr(0,T),v/Math.pow(10,3*(r.length-T)))}function write_num_pct2(E,r,v){var T=r.replace(pct1,""),w=r.length-T.length;return write_num(E,T,v*Math.pow(10,2*w))+fill("%",w)}function write_num_exp2(E,r){var v,T=E.indexOf("E")-E.indexOf(".")-1;if(E.match(/^#+0.0E\+0$/)){if(r==0)return"0.0E+0";if(r<0)return"-"+write_num_exp2(E,-r);var w=E.indexOf(".");w===-1&&(w=E.indexOf("E"));var S=Math.floor(Math.log(r)*Math.LOG10E)%w;if(S<0&&(S+=w),v=(r/Math.pow(10,S)).toPrecision(T+1+(w+S)%w),!v.match(/[Ee]/)){var I=Math.floor(Math.log(r)*Math.LOG10E);v.indexOf(".")===-1?v=v.charAt(0)+"."+v.substr(1)+"E+"+(I-v.length+S):v+="E+"+(I-S),v=v.replace(/\+-/,"-")}v=v.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(H,te,ae,ie){return te+ae+ie.substr(0,(w+S)%w)+"."+ie.substr(S)+"E"})}else v=r.toExponential(T);return E.match(/E\+00$/)&&v.match(/e[+-]\d$/)&&(v=v.substr(0,v.length-1)+"0"+v.charAt(v.length-1)),E.match(/E\-/)&&v.match(/e\+/)&&(v=v.replace(/e\+/,"e")),v.replace("e","E")}function write_num_int(E,r,v){if(E.charCodeAt(0)===40&&!r.match(closeparen)){var T=r.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return v>=0?write_num_int("n",T,v):"("+write_num_int("n",T,-v)+")"}if(r.charCodeAt(r.length-1)===44)return write_num_cm2(E,r,v);if(r.indexOf("%")!==-1)return write_num_pct2(E,r,v);if(r.indexOf("E")!==-1)return write_num_exp2(r,v);if(r.charCodeAt(0)===36)return"$"+write_num_int(E,r.substr(r.charAt(1)==" "?2:1),v);var w,S,I,H,te=Math.abs(v),ae=v<0?"-":"";if(r.match(/^00+$/))return ae+pad0(te,r.length);if(r.match(/^[#?]+$/))return w=""+v,v===0&&(w=""),w.length>r.length?w:hashq(r.substr(0,r.length-w.length))+w;if(S=r.match(frac1))return write_num_f2(S,te,ae);if(r.match(/^#+0+$/))return ae+pad0(te,r.length-r.indexOf("0"));if(S=r.match(dec1))return w=(""+v).replace(/^([^\.]+)$/,"$1."+hashq(S[1])).replace(/\.$/,"."+hashq(S[1])),w=w.replace(/\.(\d*)$/,function(Re,Pe){return"."+Pe+fill("0",hashq(S[1]).length-Pe.length)}),r.indexOf("0.")!==-1?w:w.replace(/^0\./,".");if(r=r.replace(/^#+([0.])/,"$1"),S=r.match(/^(0*)\.(#*)$/))return ae+(""+te).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,S[1].length?"0.":".");if(S=r.match(/^#{1,3},##0(\.?)$/))return ae+commaify(""+te);if(S=r.match(/^#,##0\.([#0]*0)$/))return v<0?"-"+write_num_int(E,r,-v):commaify(""+v)+"."+fill("0",S[1].length);if(S=r.match(/^#,#*,#0/))return write_num_int(E,r.replace(/^#,#*,/,""),v);if(S=r.match(/^([0#]+)(\\?-([0#]+))+$/))return w=_strrev(write_num_int(E,r.replace(/[\\-]/g,""),v)),I=0,_strrev(_strrev(r.replace(/\\/g,"")).replace(/[0#]/g,function(Re){return I<w.length?w.charAt(I++):Re==="0"?"0":""}));if(r.match(phone))return w=write_num_int(E,"##########",v),"("+w.substr(0,3)+") "+w.substr(3,3)+"-"+w.substr(6);var ie="";if(S=r.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return I=Math.min(S[4].length,7),H=SSF_frac(te,Math.pow(10,I)-1,!1),w=""+ae,ie=write_num("n",S[1],H[1]),ie.charAt(ie.length-1)==" "&&(ie=ie.substr(0,ie.length-1)+"0"),w+=ie+S[2]+"/"+S[3],ie=rpad_(H[2],I),ie.length<S[4].length&&(ie=hashq(S[4].substr(S[4].length-ie.length))+ie),w+=ie,w;if(S=r.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return I=Math.min(Math.max(S[1].length,S[4].length),7),H=SSF_frac(te,Math.pow(10,I)-1,!0),ae+(H[0]||(H[1]?"":"0"))+" "+(H[1]?pad_(H[1],I)+S[2]+"/"+S[3]+rpad_(H[2],I):fill(" ",2*I+1+S[2].length+S[3].length));if(S=r.match(/^[#0?]+$/))return w=""+v,r.length<=w.length?w:hashq(r.substr(0,r.length-w.length))+w;if(S=r.match(/^([#0]+)\.([#0]+)$/)){w=""+v.toFixed(Math.min(S[2].length,10)).replace(/([^0])0+$/,"$1"),I=w.indexOf(".");var ce=r.indexOf(".")-I,me=r.length-w.length-ce;return hashq(r.substr(0,ce)+w+r.substr(r.length-me))}if(S=r.match(/^00,000\.([#0]*0)$/))return v<0?"-"+write_num_int(E,r,-v):commaify(""+v).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(Re){return"00,"+(Re.length<3?pad0(0,3-Re.length):"")+Re})+"."+pad0(0,S[1].length);switch(r){case"###,###":case"##,###":case"#,###":var _e=commaify(""+te);return _e!=="0"?ae+_e:"";default:if(r.match(/\.[0#?]*$/))return write_num_int(E,r.slice(0,r.lastIndexOf(".")),v)+hashq(r.slice(r.lastIndexOf(".")))}throw new Error("unsupported format |"+r+"|")}function write_num(E,r,v){return(v|0)===v?write_num_int(E,r,v):write_num_flt(E,r,v)}function SSF_split_fmt(E){for(var r=[],v=!1,T=0,w=0;T<E.length;++T)switch(E.charCodeAt(T)){case 34:v=!v;break;case 95:case 42:case 92:++T;break;case 59:r[r.length]=E.substr(w,T-w),w=T+1}if(r[r.length]=E.substr(w),v===!0)throw new Error("Format |"+E+"| unterminated string ");return r}var SSF_abstime=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function fmt_is_date(E){for(var r=0,v="",T="";r<E.length;)switch(v=E.charAt(r)){case"G":SSF_isgeneral(E,r)&&(r+=6),r++;break;case'"':for(;E.charCodeAt(++r)!==34&&r<E.length;);++r;break;case"\\":r+=2;break;case"_":r+=2;break;case"@":++r;break;case"B":case"b":if(E.charAt(r+1)==="1"||E.charAt(r+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(E.substr(r,3).toUpperCase()==="A/P"||E.substr(r,5).toUpperCase()==="AM/PM"||E.substr(r,5).toUpperCase()==="上午/下午")return!0;++r;break;case"[":for(T=v;E.charAt(r++)!=="]"&&r<E.length;)T+=E.charAt(r);if(T.match(SSF_abstime))return!0;break;case".":case"0":case"#":for(;r<E.length&&("0#?.,E+-%".indexOf(v=E.charAt(++r))>-1||v=="\\"&&E.charAt(r+1)=="-"&&"0#".indexOf(E.charAt(r+2))>-1););break;case"?":for(;E.charAt(++r)===v;);break;case"*":++r,(E.charAt(r)==" "||E.charAt(r)=="*")&&++r;break;case"(":case")":++r;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;r<E.length&&"0123456789".indexOf(E.charAt(++r))>-1;);break;case" ":++r;break;default:++r;break}return!1}function eval_fmt(E,r,v,T){for(var w=[],S="",I=0,H="",te="t",ae,ie,ce,me="H";I<E.length;)switch(H=E.charAt(I)){case"G":if(!SSF_isgeneral(E,I))throw new Error("unrecognized character "+H+" in "+E);w[w.length]={t:"G",v:"General"},I+=7;break;case'"':for(S="";(ce=E.charCodeAt(++I))!==34&&I<E.length;)S+=String.fromCharCode(ce);w[w.length]={t:"t",v:S},++I;break;case"\\":var _e=E.charAt(++I),Re=_e==="("||_e===")"?_e:"t";w[w.length]={t:Re,v:_e},++I;break;case"_":w[w.length]={t:"t",v:" "},I+=2;break;case"@":w[w.length]={t:"T",v:r},++I;break;case"B":case"b":if(E.charAt(I+1)==="1"||E.charAt(I+1)==="2"){if(ae==null&&(ae=SSF_parse_date_code(r,v,E.charAt(I+1)==="2"),ae==null))return"";w[w.length]={t:"X",v:E.substr(I,2)},te=H,I+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":H=H.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(r<0||ae==null&&(ae=SSF_parse_date_code(r,v),ae==null))return"";for(S=H;++I<E.length&&E.charAt(I).toLowerCase()===H;)S+=H;H==="m"&&te.toLowerCase()==="h"&&(H="M"),H==="h"&&(H=me),w[w.length]={t:H,v:S},te=H;break;case"A":case"a":case"上":var Pe={t:H,v:H};if(ae==null&&(ae=SSF_parse_date_code(r,v)),E.substr(I,3).toUpperCase()==="A/P"?(ae!=null&&(Pe.v=ae.H>=12?"P":"A"),Pe.t="T",me="h",I+=3):E.substr(I,5).toUpperCase()==="AM/PM"?(ae!=null&&(Pe.v=ae.H>=12?"PM":"AM"),Pe.t="T",I+=5,me="h"):E.substr(I,5).toUpperCase()==="上午/下午"?(ae!=null&&(Pe.v=ae.H>=12?"下午":"上午"),Pe.t="T",I+=5,me="h"):(Pe.t="t",++I),ae==null&&Pe.t==="T")return"";w[w.length]=Pe,te=H;break;case"[":for(S=H;E.charAt(I++)!=="]"&&I<E.length;)S+=E.charAt(I);if(S.slice(-1)!=="]")throw'unterminated "[" block: |'+S+"|";if(S.match(SSF_abstime)){if(ae==null&&(ae=SSF_parse_date_code(r,v),ae==null))return"";w[w.length]={t:"Z",v:S.toLowerCase()},te=S.charAt(1)}else S.indexOf("$")>-1&&(S=(S.match(/\$([^-\[\]]*)/)||[])[1]||"$",fmt_is_date(E)||(w[w.length]={t:"t",v:S}));break;case".":if(ae!=null){for(S=H;++I<E.length&&(H=E.charAt(I))==="0";)S+=H;w[w.length]={t:"s",v:S};break}case"0":case"#":for(S=H;++I<E.length&&"0#?.,E+-%".indexOf(H=E.charAt(I))>-1;)S+=H;w[w.length]={t:"n",v:S};break;case"?":for(S=H;E.charAt(++I)===H;)S+=H;w[w.length]={t:H,v:S},te=H;break;case"*":++I,(E.charAt(I)==" "||E.charAt(I)=="*")&&++I;break;case"(":case")":w[w.length]={t:T===1?"t":H,v:H},++I;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(S=H;I<E.length&&"0123456789".indexOf(E.charAt(++I))>-1;)S+=E.charAt(I);w[w.length]={t:"D",v:S};break;case" ":w[w.length]={t:H,v:H},++I;break;case"$":w[w.length]={t:"t",v:"$"},++I;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(H)===-1)throw new Error("unrecognized character "+H+" in "+E);w[w.length]={t:"t",v:H},++I;break}var Ce=0,Fe=0,Me;for(I=w.length-1,te="t";I>=0;--I)switch(w[I].t){case"h":case"H":w[I].t=me,te="h",Ce<1&&(Ce=1);break;case"s":(Me=w[I].v.match(/\.0+$/))&&(Fe=Math.max(Fe,Me[0].length-1)),Ce<3&&(Ce=3);case"d":case"y":case"M":case"e":te=w[I].t;break;case"m":te==="s"&&(w[I].t="M",Ce<2&&(Ce=2));break;case"X":break;case"Z":Ce<1&&w[I].v.match(/[Hh]/)&&(Ce=1),Ce<2&&w[I].v.match(/[Mm]/)&&(Ce=2),Ce<3&&w[I].v.match(/[Ss]/)&&(Ce=3)}switch(Ce){case 0:break;case 1:ae.u>=.5&&(ae.u=0,++ae.S),ae.S>=60&&(ae.S=0,++ae.M),ae.M>=60&&(ae.M=0,++ae.H);break;case 2:ae.u>=.5&&(ae.u=0,++ae.S),ae.S>=60&&(ae.S=0,++ae.M);break}var Ve="",We;for(I=0;I<w.length;++I)switch(w[I].t){case"t":case"T":case" ":case"D":break;case"X":w[I].v="",w[I].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":w[I].v=SSF_write_date(w[I].t.charCodeAt(0),w[I].v,ae,Fe),w[I].t="t";break;case"n":case"?":for(We=I+1;w[We]!=null&&((H=w[We].t)==="?"||H==="D"||(H===" "||H==="t")&&w[We+1]!=null&&(w[We+1].t==="?"||w[We+1].t==="t"&&w[We+1].v==="/")||w[I].t==="("&&(H===" "||H==="n"||H===")")||H==="t"&&(w[We].v==="/"||w[We].v===" "&&w[We+1]!=null&&w[We+1].t=="?"));)w[I].v+=w[We].v,w[We]={v:"",t:";"},++We;Ve+=w[I].v,I=We-1;break;case"G":w[I].t="t",w[I].v=SSF_general(r,v);break}var ze="",Ue,je;if(Ve.length>0){Ve.charCodeAt(0)==40?(Ue=r<0&&Ve.charCodeAt(0)===45?-r:r,je=write_num("n",Ve,Ue)):(Ue=r<0&&T>1?-r:r,je=write_num("n",Ve,Ue),Ue<0&&w[0]&&w[0].t=="t"&&(je=je.substr(1),w[0].v="-"+w[0].v)),We=je.length-1;var ke=w.length;for(I=0;I<w.length;++I)if(w[I]!=null&&w[I].t!="t"&&w[I].v.indexOf(".")>-1){ke=I;break}var Ne=w.length;if(ke===w.length&&je.indexOf("E")===-1){for(I=w.length-1;I>=0;--I)w[I]==null||"n?".indexOf(w[I].t)===-1||(We>=w[I].v.length-1?(We-=w[I].v.length,w[I].v=je.substr(We+1,w[I].v.length)):We<0?w[I].v="":(w[I].v=je.substr(0,We+1),We=-1),w[I].t="t",Ne=I);We>=0&&Ne<w.length&&(w[Ne].v=je.substr(0,We+1)+w[Ne].v)}else if(ke!==w.length&&je.indexOf("E")===-1){for(We=je.indexOf(".")-1,I=ke;I>=0;--I)if(!(w[I]==null||"n?".indexOf(w[I].t)===-1)){for(ie=w[I].v.indexOf(".")>-1&&I===ke?w[I].v.indexOf(".")-1:w[I].v.length-1,ze=w[I].v.substr(ie+1);ie>=0;--ie)We>=0&&(w[I].v.charAt(ie)==="0"||w[I].v.charAt(ie)==="#")&&(ze=je.charAt(We--)+ze);w[I].v=ze,w[I].t="t",Ne=I}for(We>=0&&Ne<w.length&&(w[Ne].v=je.substr(0,We+1)+w[Ne].v),We=je.indexOf(".")+1,I=ke;I<w.length;++I)if(!(w[I]==null||"n?(".indexOf(w[I].t)===-1&&I!==ke)){for(ie=w[I].v.indexOf(".")>-1&&I===ke?w[I].v.indexOf(".")+1:0,ze=w[I].v.substr(0,ie);ie<w[I].v.length;++ie)We<je.length&&(ze+=je.charAt(We++));w[I].v=ze,w[I].t="t",Ne=I}}}for(I=0;I<w.length;++I)w[I]!=null&&"n?".indexOf(w[I].t)>-1&&(Ue=T>1&&r<0&&I>0&&w[I-1].v==="-"?-r:r,w[I].v=write_num(w[I].t,w[I].v,Ue),w[I].t="t");var Ge="";for(I=0;I!==w.length;++I)w[I]!=null&&(Ge+=w[I].v);return Ge}var cfregex2=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function chkcond(E,r){if(r==null)return!1;var v=parseFloat(r[2]);switch(r[1]){case"=":if(E==v)return!0;break;case">":if(E>v)return!0;break;case"<":if(E<v)return!0;break;case"<>":if(E!=v)return!0;break;case">=":if(E>=v)return!0;break;case"<=":if(E<=v)return!0;break}return!1}function choose_fmt(E,r){var v=SSF_split_fmt(E),T=v.length,w=v[T-1].indexOf("@");if(T<4&&w>-1&&--T,v.length>4)throw new Error("cannot find right format for |"+v.join("|")+"|");if(typeof r!="number")return[4,v.length===4||w>-1?v[v.length-1]:"@"];switch(v.length){case 1:v=w>-1?["General","General","General",v[0]]:[v[0],v[0],v[0],"@"];break;case 2:v=w>-1?[v[0],v[0],v[0],v[1]]:[v[0],v[1],v[0],"@"];break;case 3:v=w>-1?[v[0],v[1],v[0],v[2]]:[v[0],v[1],v[2],"@"];break}var S=r>0?v[0]:r<0?v[1]:v[2];if(v[0].indexOf("[")===-1&&v[1].indexOf("[")===-1)return[T,S];if(v[0].match(/\[[=<>]/)!=null||v[1].match(/\[[=<>]/)!=null){var I=v[0].match(cfregex2),H=v[1].match(cfregex2);return chkcond(r,I)?[T,v[0]]:chkcond(r,H)?[T,v[1]]:[T,v[I!=null&&H!=null?2:1]]}return[T,S]}function SSF_format(E,r,v){v==null&&(v={});var T="";switch(typeof E){case"string":E=="m/d/yy"&&v.dateNF?T=v.dateNF:T=E;break;case"number":E==14&&v.dateNF?T=v.dateNF:T=(v.table!=null?v.table:table_fmt)[E],T==null&&(T=v.table&&v.table[SSF_default_map[E]]||table_fmt[SSF_default_map[E]]),T==null&&(T=SSF_default_str[E]||"General");break}if(SSF_isgeneral(T,0))return SSF_general(r,v);r instanceof Date&&(r=datenum_local(r,v.date1904));var w=choose_fmt(T,r);if(SSF_isgeneral(w[1]))return SSF_general(r,v);if(r===!0)r="TRUE";else if(r===!1)r="FALSE";else if(r===""||r==null)return"";return eval_fmt(w[1],r,v,w[0])}function SSF_load(E,r){if(typeof r!="number"){r=+r||-1;for(var v=0;v<392;++v){if(table_fmt[v]==null){r<0&&(r=v);continue}if(table_fmt[v]==E){r=v;break}}r<0&&(r=391)}return table_fmt[r]=E,r}function make_ssf(){table_fmt=SSF_init_table()}var SSFImplicit={5:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',23:"General",24:"General",25:"General",26:"General",27:"m/d/yy",28:"m/d/yy",29:"m/d/yy",30:"m/d/yy",31:"m/d/yy",32:"h:mm:ss",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yy",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* (#,##0);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* (#,##0.00);_("$"* "-"??_);_(@_)',50:"m/d/yy",51:"m/d/yy",52:"m/d/yy",53:"m/d/yy",54:"m/d/yy",55:"m/d/yy",56:"m/d/yy",57:"m/d/yy",58:"m/d/yy",59:"0",60:"0.00",61:"#,##0",62:"#,##0.00",63:'"$"#,##0_);\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',67:"0%",68:"0.00%",69:"# ?/?",70:"# ??/??",71:"m/d/yy",72:"m/d/yy",73:"d-mmm-yy",74:"d-mmm",75:"mmm-yy",76:"h:mm",77:"h:mm:ss",78:"m/d/yy h:mm",79:"mm:ss",80:"[h]:mm:ss",81:"mmss.0"},dateNFregex=/[dD]+|[mM]+|[yYeE]+|[Hh]+|[Ss]+/g;function dateNF_regex(E){var r=typeof E=="number"?table_fmt[E]:E;return r=r.replace(dateNFregex,"(\\d+)"),new RegExp("^"+r+"$")}function dateNF_fix(E,r,v){var T=-1,w=-1,S=-1,I=-1,H=-1,te=-1;(r.match(dateNFregex)||[]).forEach(function(ce,me){var _e=parseInt(v[me+1],10);switch(ce.toLowerCase().charAt(0)){case"y":T=_e;break;case"d":S=_e;break;case"h":I=_e;break;case"s":te=_e;break;case"m":I>=0?H=_e:w=_e;break}}),te>=0&&H==-1&&w>=0&&(H=w,w=-1);var ae=(""+(T>=0?T:new Date().getFullYear())).slice(-4)+"-"+("00"+(w>=1?w:1)).slice(-2)+"-"+("00"+(S>=1?S:1)).slice(-2);ae.length==7&&(ae="0"+ae),ae.length==8&&(ae="20"+ae);var ie=("00"+(I>=0?I:0)).slice(-2)+":"+("00"+(H>=0?H:0)).slice(-2)+":"+("00"+(te>=0?te:0)).slice(-2);return I==-1&&H==-1&&te==-1?ae:T==-1&&w==-1&&S==-1?ie:ae+"T"+ie}var CRC32=function(){var E={};E.version="1.2.0";function r(){for(var je=0,ke=new Array(256),Ne=0;Ne!=256;++Ne)je=Ne,je=je&1?-306674912^je>>>1:je>>>1,je=je&1?-306674912^je>>>1:je>>>1,je=je&1?-306674912^je>>>1:je>>>1,je=je&1?-306674912^je>>>1:je>>>1,je=je&1?-306674912^je>>>1:je>>>1,je=je&1?-306674912^je>>>1:je>>>1,je=je&1?-306674912^je>>>1:je>>>1,je=je&1?-306674912^je>>>1:je>>>1,ke[Ne]=je;return typeof Int32Array<"u"?new Int32Array(ke):ke}var v=r();function T(je){var ke=0,Ne=0,Ge=0,Ie=typeof Int32Array<"u"?new Int32Array(4096):new Array(4096);for(Ge=0;Ge!=256;++Ge)Ie[Ge]=je[Ge];for(Ge=0;Ge!=256;++Ge)for(Ne=je[Ge],ke=256+Ge;ke<4096;ke+=256)Ne=Ie[ke]=Ne>>>8^je[Ne&255];var Le=[];for(Ge=1;Ge!=16;++Ge)Le[Ge-1]=typeof Int32Array<"u"?Ie.subarray(Ge*256,Ge*256+256):Ie.slice(Ge*256,Ge*256+256);return Le}var w=T(v),S=w[0],I=w[1],H=w[2],te=w[3],ae=w[4],ie=w[5],ce=w[6],me=w[7],_e=w[8],Re=w[9],Pe=w[10],Ce=w[11],Fe=w[12],Me=w[13],Ve=w[14];function We(je,ke){for(var Ne=ke^-1,Ge=0,Ie=je.length;Ge<Ie;)Ne=Ne>>>8^v[(Ne^je.charCodeAt(Ge++))&255];return~Ne}function ze(je,ke){for(var Ne=ke^-1,Ge=je.length-15,Ie=0;Ie<Ge;)Ne=Ve[je[Ie++]^Ne&255]^Me[je[Ie++]^Ne>>8&255]^Fe[je[Ie++]^Ne>>16&255]^Ce[je[Ie++]^Ne>>>24]^Pe[je[Ie++]]^Re[je[Ie++]]^_e[je[Ie++]]^me[je[Ie++]]^ce[je[Ie++]]^ie[je[Ie++]]^ae[je[Ie++]]^te[je[Ie++]]^H[je[Ie++]]^I[je[Ie++]]^S[je[Ie++]]^v[je[Ie++]];for(Ge+=15;Ie<Ge;)Ne=Ne>>>8^v[(Ne^je[Ie++])&255];return~Ne}function Ue(je,ke){for(var Ne=ke^-1,Ge=0,Ie=je.length,Le=0,He=0;Ge<Ie;)Le=je.charCodeAt(Ge++),Le<128?Ne=Ne>>>8^v[(Ne^Le)&255]:Le<2048?(Ne=Ne>>>8^v[(Ne^(192|Le>>6&31))&255],Ne=Ne>>>8^v[(Ne^(128|Le&63))&255]):Le>=55296&&Le<57344?(Le=(Le&1023)+64,He=je.charCodeAt(Ge++)&1023,Ne=Ne>>>8^v[(Ne^(240|Le>>8&7))&255],Ne=Ne>>>8^v[(Ne^(128|Le>>2&63))&255],Ne=Ne>>>8^v[(Ne^(128|He>>6&15|(Le&3)<<4))&255],Ne=Ne>>>8^v[(Ne^(128|He&63))&255]):(Ne=Ne>>>8^v[(Ne^(224|Le>>12&15))&255],Ne=Ne>>>8^v[(Ne^(128|Le>>6&63))&255],Ne=Ne>>>8^v[(Ne^(128|Le&63))&255]);return~Ne}return E.table=v,E.bstr=We,E.buf=ze,E.str=Ue,E}(),CFB=function E(){var r={};r.version="1.2.1";function v(et,Gt){for(var It=et.split("/"),Nt=Gt.split("/"),qt=0,tr=0,Er=Math.min(It.length,Nt.length);qt<Er;++qt){if(tr=It[qt].length-Nt[qt].length)return tr;if(It[qt]!=Nt[qt])return It[qt]<Nt[qt]?-1:1}return It.length-Nt.length}function T(et){if(et.charAt(et.length-1)=="/")return et.slice(0,-1).indexOf("/")===-1?et:T(et.slice(0,-1));var Gt=et.lastIndexOf("/");return Gt===-1?et:et.slice(0,Gt+1)}function w(et){if(et.charAt(et.length-1)=="/")return w(et.slice(0,-1));var Gt=et.lastIndexOf("/");return Gt===-1?et:et.slice(Gt+1)}function S(et,Gt){typeof Gt=="string"&&(Gt=new Date(Gt));var It=Gt.getHours();It=It<<6|Gt.getMinutes(),It=It<<5|Gt.getSeconds()>>>1,et.write_shift(2,It);var Nt=Gt.getFullYear()-1980;Nt=Nt<<4|Gt.getMonth()+1,Nt=Nt<<5|Gt.getDate(),et.write_shift(2,Nt)}function I(et){var Gt=et.read_shift(2)&65535,It=et.read_shift(2)&65535,Nt=new Date,qt=It&31;It>>>=5;var tr=It&15;It>>>=4,Nt.setMilliseconds(0),Nt.setFullYear(It+1980),Nt.setMonth(tr-1),Nt.setDate(qt);var Er=Gt&31;Gt>>>=5;var Nr=Gt&63;return Gt>>>=6,Nt.setHours(Gt),Nt.setMinutes(Nr),Nt.setSeconds(Er<<1),Nt}function H(et){prep_blob(et,0);for(var Gt={},It=0;et.l<=et.length-4;){var Nt=et.read_shift(2),qt=et.read_shift(2),tr=et.l+qt,Er={};switch(Nt){case 21589:It=et.read_shift(1),It&1&&(Er.mtime=et.read_shift(4)),qt>5&&(It&2&&(Er.atime=et.read_shift(4)),It&4&&(Er.ctime=et.read_shift(4))),Er.mtime&&(Er.mt=new Date(Er.mtime*1e3));break}et.l=tr,Gt[Nt]=Er}return Gt}var te;function ae(){return te||(te={})}function ie(et,Gt){if(et[0]==80&&et[1]==75)return ss(et,Gt);if((et[0]|32)==109&&(et[1]|32)==105)return cr(et,Gt);if(et.length<512)throw new Error("CFB file size "+et.length+" < 512");var It=3,Nt=512,qt=0,tr=0,Er=0,Nr=0,Pr=0,Cr=[],Dr=et.slice(0,512);prep_blob(Dr,0);var Hr=ce(Dr);switch(It=Hr[0],It){case 3:Nt=512;break;case 4:Nt=4096;break;case 0:if(Hr[1]==0)return ss(et,Gt);default:throw new Error("Major Version: Expected 3 or 4 saw "+It)}Nt!==512&&(Dr=et.slice(0,Nt),prep_blob(Dr,28));var Kr=et.slice(0,Nt);me(Dr,It);var rs=Dr.read_shift(4,"i");if(It===3&&rs!==0)throw new Error("# Directory Sectors: Expected 0 saw "+rs);Dr.l+=4,Er=Dr.read_shift(4,"i"),Dr.l+=4,Dr.chk("00100000","Mini Stream Cutoff Size: "),Nr=Dr.read_shift(4,"i"),qt=Dr.read_shift(4,"i"),Pr=Dr.read_shift(4,"i"),tr=Dr.read_shift(4,"i");for(var Yr=-1,ts=0;ts<109&&(Yr=Dr.read_shift(4,"i"),!(Yr<0));++ts)Cr[ts]=Yr;var as=_e(et,Nt);Ce(Pr,tr,as,Nt,Cr);var ls=Me(as,Er,Cr,Nt);ls[Er].name="!Directory",qt>0&&Nr!==He&&(ls[Nr].name="!MiniFAT"),ls[Cr[0]].name="!FAT",ls.fat_addrs=Cr,ls.ssz=Nt;var os={},ds=[],Rs=[],Ps=[];Ve(Er,ls,as,ds,qt,os,Rs,Nr),Re(Rs,Ps,ds),ds.shift();var ws={FileIndex:Rs,FullPaths:Ps};return Gt&&Gt.raw&&(ws.raw={header:Kr,sectors:as}),ws}function ce(et){if(et[et.l]==80&&et[et.l+1]==75)return[0,0];et.chk(Ct,"Header Signature: "),et.l+=16;var Gt=et.read_shift(2,"u");return[et.read_shift(2,"u"),Gt]}function me(et,Gt){var It=9;switch(et.l+=2,It=et.read_shift(2)){case 9:if(Gt!=3)throw new Error("Sector Shift: Expected 9 saw "+It);break;case 12:if(Gt!=4)throw new Error("Sector Shift: Expected 12 saw "+It);break;default:throw new Error("Sector Shift: Expected 9 or 12 saw "+It)}et.chk("0600","Mini Sector Shift: "),et.chk("000000000000","Reserved: ")}function _e(et,Gt){for(var It=Math.ceil(et.length/Gt)-1,Nt=[],qt=1;qt<It;++qt)Nt[qt-1]=et.slice(qt*Gt,(qt+1)*Gt);return Nt[It-1]=et.slice(It*Gt),Nt}function Re(et,Gt,It){for(var Nt=0,qt=0,tr=0,Er=0,Nr=0,Pr=It.length,Cr=[],Dr=[];Nt<Pr;++Nt)Cr[Nt]=Dr[Nt]=Nt,Gt[Nt]=It[Nt];for(;Nr<Dr.length;++Nr)Nt=Dr[Nr],qt=et[Nt].L,tr=et[Nt].R,Er=et[Nt].C,Cr[Nt]===Nt&&(qt!==-1&&Cr[qt]!==qt&&(Cr[Nt]=Cr[qt]),tr!==-1&&Cr[tr]!==tr&&(Cr[Nt]=Cr[tr])),Er!==-1&&(Cr[Er]=Nt),qt!==-1&&Nt!=Cr[Nt]&&(Cr[qt]=Cr[Nt],Dr.lastIndexOf(qt)<Nr&&Dr.push(qt)),tr!==-1&&Nt!=Cr[Nt]&&(Cr[tr]=Cr[Nt],Dr.lastIndexOf(tr)<Nr&&Dr.push(tr));for(Nt=1;Nt<Pr;++Nt)Cr[Nt]===Nt&&(tr!==-1&&Cr[tr]!==tr?Cr[Nt]=Cr[tr]:qt!==-1&&Cr[qt]!==qt&&(Cr[Nt]=Cr[qt]));for(Nt=1;Nt<Pr;++Nt)if(et[Nt].type!==0){if(Nr=Nt,Nr!=Cr[Nr])do Nr=Cr[Nr],Gt[Nt]=Gt[Nr]+"/"+Gt[Nt];while(Nr!==0&&Cr[Nr]!==-1&&Nr!=Cr[Nr]);Cr[Nt]=-1}for(Gt[0]+="/",Nt=1;Nt<Pr;++Nt)et[Nt].type!==2&&(Gt[Nt]+="/")}function Pe(et,Gt,It){for(var Nt=et.start,qt=et.size,tr=[],Er=Nt;It&&qt>0&&Er>=0;)tr.push(Gt.slice(Er*Le,Er*Le+Le)),qt-=Le,Er=__readInt32LE(It,Er*4);return tr.length===0?new_buf(0):bconcat(tr).slice(0,et.size)}function Ce(et,Gt,It,Nt,qt){var tr=He;if(et===He){if(Gt!==0)throw new Error("DIFAT chain shorter than expected")}else if(et!==-1){var Er=It[et],Nr=(Nt>>>2)-1;if(!Er)return;for(var Pr=0;Pr<Nr&&(tr=__readInt32LE(Er,Pr*4))!==He;++Pr)qt.push(tr);Ce(__readInt32LE(Er,Nt-4),Gt-1,It,Nt,qt)}}function Fe(et,Gt,It,Nt,qt){var tr=[],Er=[];qt||(qt=[]);var Nr=Nt-1,Pr=0,Cr=0;for(Pr=Gt;Pr>=0;){qt[Pr]=!0,tr[tr.length]=Pr,Er.push(et[Pr]);var Dr=It[Math.floor(Pr*4/Nt)];if(Cr=Pr*4&Nr,Nt<4+Cr)throw new Error("FAT boundary crossed: "+Pr+" 4 "+Nt);if(!et[Dr])break;Pr=__readInt32LE(et[Dr],Cr)}return{nodes:tr,data:__toBuffer([Er])}}function Me(et,Gt,It,Nt){var qt=et.length,tr=[],Er=[],Nr=[],Pr=[],Cr=Nt-1,Dr=0,Hr=0,Kr=0,rs=0;for(Dr=0;Dr<qt;++Dr)if(Nr=[],Kr=Dr+Gt,Kr>=qt&&(Kr-=qt),!Er[Kr]){Pr=[];var Yr=[];for(Hr=Kr;Hr>=0;){Yr[Hr]=!0,Er[Hr]=!0,Nr[Nr.length]=Hr,Pr.push(et[Hr]);var ts=It[Math.floor(Hr*4/Nt)];if(rs=Hr*4&Cr,Nt<4+rs)throw new Error("FAT boundary crossed: "+Hr+" 4 "+Nt);if(!et[ts]||(Hr=__readInt32LE(et[ts],rs),Yr[Hr]))break}tr[Kr]={nodes:Nr,data:__toBuffer([Pr])}}return tr}function Ve(et,Gt,It,Nt,qt,tr,Er,Nr){for(var Pr=0,Cr=Nt.length?2:0,Dr=Gt[et].data,Hr=0,Kr=0,rs;Hr<Dr.length;Hr+=128){var Yr=Dr.slice(Hr,Hr+128);prep_blob(Yr,64),Kr=Yr.read_shift(2),rs=__utf16le(Yr,0,Kr-Cr),Nt.push(rs);var ts={name:rs,type:Yr.read_shift(1),color:Yr.read_shift(1),L:Yr.read_shift(4,"i"),R:Yr.read_shift(4,"i"),C:Yr.read_shift(4,"i"),clsid:Yr.read_shift(16),state:Yr.read_shift(4,"i"),start:0,size:0},as=Yr.read_shift(2)+Yr.read_shift(2)+Yr.read_shift(2)+Yr.read_shift(2);as!==0&&(ts.ct=We(Yr,Yr.l-8));var ls=Yr.read_shift(2)+Yr.read_shift(2)+Yr.read_shift(2)+Yr.read_shift(2);ls!==0&&(ts.mt=We(Yr,Yr.l-8)),ts.start=Yr.read_shift(4,"i"),ts.size=Yr.read_shift(4,"i"),ts.size<0&&ts.start<0&&(ts.size=ts.type=0,ts.start=He,ts.name=""),ts.type===5?(Pr=ts.start,qt>0&&Pr!==He&&(Gt[Pr].name="!StreamData")):ts.size>=4096?(ts.storage="fat",Gt[ts.start]===void 0&&(Gt[ts.start]=Fe(It,ts.start,Gt.fat_addrs,Gt.ssz)),Gt[ts.start].name=ts.name,ts.content=Gt[ts.start].data.slice(0,ts.size)):(ts.storage="minifat",ts.size<0?ts.size=0:Pr!==He&&ts.start!==He&&Gt[Pr]&&(ts.content=Pe(ts,Gt[Pr].data,(Gt[Nr]||{}).data))),ts.content&&prep_blob(ts.content,0),tr[rs]=ts,Er.push(ts)}}function We(et,Gt){return new Date((__readUInt32LE(et,Gt+4)/1e7*Math.pow(2,32)+__readUInt32LE(et,Gt)/1e7-11644473600)*1e3)}function ze(et,Gt){return ae(),ie(te.readFileSync(et),Gt)}function Ue(et,Gt){var It=Gt&&Gt.type;switch(It||has_buf&&Buffer.isBuffer(et)&&(It="buffer"),It||"base64"){case"file":return ze(et,Gt);case"base64":return ie(s2a(Base64_decode(et)),Gt);case"binary":return ie(s2a(et),Gt)}return ie(et,Gt)}function je(et,Gt){var It=Gt||{},Nt=It.root||"Root Entry";if(et.FullPaths||(et.FullPaths=[]),et.FileIndex||(et.FileIndex=[]),et.FullPaths.length!==et.FileIndex.length)throw new Error("inconsistent CFB structure");et.FullPaths.length===0&&(et.FullPaths[0]=Nt+"/",et.FileIndex[0]={name:Nt,type:5}),It.CLSID&&(et.FileIndex[0].clsid=It.CLSID),ke(et)}function ke(et){var Gt="Sh33tJ5";if(!CFB.find(et,"/"+Gt)){var It=new_buf(4);It[0]=55,It[1]=It[3]=50,It[2]=54,et.FileIndex.push({name:Gt,type:2,content:It,size:4,L:69,R:69,C:69}),et.FullPaths.push(et.FullPaths[0]+Gt),Ne(et)}}function Ne(et,Gt){je(et);for(var It=!1,Nt=!1,qt=et.FullPaths.length-1;qt>=0;--qt){var tr=et.FileIndex[qt];switch(tr.type){case 0:Nt?It=!0:(et.FileIndex.pop(),et.FullPaths.pop());break;case 1:case 2:case 5:Nt=!0,isNaN(tr.R*tr.L*tr.C)&&(It=!0),tr.R>-1&&tr.L>-1&&tr.R==tr.L&&(It=!0);break;default:It=!0;break}}if(!(!It&&!Gt)){var Er=new Date(1987,1,19),Nr=0,Pr=Object.create?Object.create(null):{},Cr=[];for(qt=0;qt<et.FullPaths.length;++qt)Pr[et.FullPaths[qt]]=!0,et.FileIndex[qt].type!==0&&Cr.push([et.FullPaths[qt],et.FileIndex[qt]]);for(qt=0;qt<Cr.length;++qt){var Dr=T(Cr[qt][0]);Nt=Pr[Dr],Nt||(Cr.push([Dr,{name:w(Dr).replace("/",""),type:1,clsid:Rt,ct:Er,mt:Er,content:null}]),Pr[Dr]=!0)}for(Cr.sort(function(rs,Yr){return v(rs[0],Yr[0])}),et.FullPaths=[],et.FileIndex=[],qt=0;qt<Cr.length;++qt)et.FullPaths[qt]=Cr[qt][0],et.FileIndex[qt]=Cr[qt][1];for(qt=0;qt<Cr.length;++qt){var Hr=et.FileIndex[qt],Kr=et.FullPaths[qt];if(Hr.name=w(Kr).replace("/",""),Hr.L=Hr.R=Hr.C=-(Hr.color=1),Hr.size=Hr.content?Hr.content.length:0,Hr.start=0,Hr.clsid=Hr.clsid||Rt,qt===0)Hr.C=Cr.length>1?1:-1,Hr.size=0,Hr.type=5;else if(Kr.slice(-1)=="/"){for(Nr=qt+1;Nr<Cr.length&&T(et.FullPaths[Nr])!=Kr;++Nr);for(Hr.C=Nr>=Cr.length?-1:Nr,Nr=qt+1;Nr<Cr.length&&T(et.FullPaths[Nr])!=T(Kr);++Nr);Hr.R=Nr>=Cr.length?-1:Nr,Hr.type=1}else T(et.FullPaths[qt+1]||"")==T(Kr)&&(Hr.R=qt+1),Hr.type=2}}}function Ge(et,Gt){var It=Gt||{};if(It.fileType=="mad")return _r(et,It);switch(Ne(et),It.fileType){case"zip":return Sr(et,It)}var Nt=function(rs){for(var Yr=0,ts=0,as=0;as<rs.FileIndex.length;++as){var ls=rs.FileIndex[as];if(ls.content){var os=ls.content.length;os>0&&(os<4096?Yr+=os+63>>6:ts+=os+511>>9)}}for(var ds=rs.FullPaths.length+3>>2,Rs=Yr+7>>3,Ps=Yr+127>>7,ws=Rs+ts+ds+Ps,ys=ws+127>>7,Ns=ys<=109?0:Math.ceil((ys-109)/127);ws+ys+Ns+127>>7>ys;)Ns=++ys<=109?0:Math.ceil((ys-109)/127);var _s=[1,Ns,ys,Ps,ds,ts,Yr,0];return rs.FileIndex[0].size=Yr<<6,_s[7]=(rs.FileIndex[0].start=_s[0]+_s[1]+_s[2]+_s[3]+_s[4]+_s[5])+(_s[6]+7>>3),_s}(et),qt=new_buf(Nt[7]<<9),tr=0,Er=0;{for(tr=0;tr<8;++tr)qt.write_shift(1,Ze[tr]);for(tr=0;tr<8;++tr)qt.write_shift(2,0);for(qt.write_shift(2,62),qt.write_shift(2,3),qt.write_shift(2,65534),qt.write_shift(2,9),qt.write_shift(2,6),tr=0;tr<3;++tr)qt.write_shift(2,0);for(qt.write_shift(4,0),qt.write_shift(4,Nt[2]),qt.write_shift(4,Nt[0]+Nt[1]+Nt[2]+Nt[3]-1),qt.write_shift(4,0),qt.write_shift(4,4096),qt.write_shift(4,Nt[3]?Nt[0]+Nt[1]+Nt[2]-1:He),qt.write_shift(4,Nt[3]),qt.write_shift(-4,Nt[1]?Nt[0]-1:He),qt.write_shift(4,Nt[1]),tr=0;tr<109;++tr)qt.write_shift(-4,tr<Nt[2]?Nt[1]+tr:-1)}if(Nt[1])for(Er=0;Er<Nt[1];++Er){for(;tr<236+Er*127;++tr)qt.write_shift(-4,tr<Nt[2]?Nt[1]+tr:-1);qt.write_shift(-4,Er===Nt[1]-1?He:Er+1)}var Nr=function(rs){for(Er+=rs;tr<Er-1;++tr)qt.write_shift(-4,tr+1);rs&&(++tr,qt.write_shift(-4,He))};for(Er=tr=0,Er+=Nt[1];tr<Er;++tr)qt.write_shift(-4,nt.DIFSECT);for(Er+=Nt[2];tr<Er;++tr)qt.write_shift(-4,nt.FATSECT);Nr(Nt[3]),Nr(Nt[4]);for(var Pr=0,Cr=0,Dr=et.FileIndex[0];Pr<et.FileIndex.length;++Pr)Dr=et.FileIndex[Pr],Dr.content&&(Cr=Dr.content.length,!(Cr<4096)&&(Dr.start=Er,Nr(Cr+511>>9)));for(Nr(Nt[6]+7>>3);qt.l&511;)qt.write_shift(-4,nt.ENDOFCHAIN);for(Er=tr=0,Pr=0;Pr<et.FileIndex.length;++Pr)Dr=et.FileIndex[Pr],Dr.content&&(Cr=Dr.content.length,!(!Cr||Cr>=4096)&&(Dr.start=Er,Nr(Cr+63>>6)));for(;qt.l&511;)qt.write_shift(-4,nt.ENDOFCHAIN);for(tr=0;tr<Nt[4]<<2;++tr){var Hr=et.FullPaths[tr];if(!Hr||Hr.length===0){for(Pr=0;Pr<17;++Pr)qt.write_shift(4,0);for(Pr=0;Pr<3;++Pr)qt.write_shift(4,-1);for(Pr=0;Pr<12;++Pr)qt.write_shift(4,0);continue}Dr=et.FileIndex[tr],tr===0&&(Dr.start=Dr.size?Dr.start-1:He);var Kr=tr===0&&It.root||Dr.name;if(Cr=2*(Kr.length+1),qt.write_shift(64,Kr,"utf16le"),qt.write_shift(2,Cr),qt.write_shift(1,Dr.type),qt.write_shift(1,Dr.color),qt.write_shift(-4,Dr.L),qt.write_shift(-4,Dr.R),qt.write_shift(-4,Dr.C),Dr.clsid)qt.write_shift(16,Dr.clsid,"hex");else for(Pr=0;Pr<4;++Pr)qt.write_shift(4,0);qt.write_shift(4,Dr.state||0),qt.write_shift(4,0),qt.write_shift(4,0),qt.write_shift(4,0),qt.write_shift(4,0),qt.write_shift(4,Dr.start),qt.write_shift(4,Dr.size),qt.write_shift(4,0)}for(tr=1;tr<et.FileIndex.length;++tr)if(Dr=et.FileIndex[tr],Dr.size>=4096)if(qt.l=Dr.start+1<<9,has_buf&&Buffer.isBuffer(Dr.content))Dr.content.copy(qt,qt.l,0,Dr.size),qt.l+=Dr.size+511&-512;else{for(Pr=0;Pr<Dr.size;++Pr)qt.write_shift(1,Dr.content[Pr]);for(;Pr&511;++Pr)qt.write_shift(1,0)}for(tr=1;tr<et.FileIndex.length;++tr)if(Dr=et.FileIndex[tr],Dr.size>0&&Dr.size<4096)if(has_buf&&Buffer.isBuffer(Dr.content))Dr.content.copy(qt,qt.l,0,Dr.size),qt.l+=Dr.size+63&-64;else{for(Pr=0;Pr<Dr.size;++Pr)qt.write_shift(1,Dr.content[Pr]);for(;Pr&63;++Pr)qt.write_shift(1,0)}if(has_buf)qt.l=qt.length;else for(;qt.l<qt.length;)qt.write_shift(1,0);return qt}function Ie(et,Gt){var It=et.FullPaths.map(function(Pr){return Pr.toUpperCase()}),Nt=It.map(function(Pr){var Cr=Pr.split("/");return Cr[Cr.length-(Pr.slice(-1)=="/"?2:1)]}),qt=!1;Gt.charCodeAt(0)===47?(qt=!0,Gt=It[0].slice(0,-1)+Gt):qt=Gt.indexOf("/")!==-1;var tr=Gt.toUpperCase(),Er=qt===!0?It.indexOf(tr):Nt.indexOf(tr);if(Er!==-1)return et.FileIndex[Er];var Nr=!tr.match(chr1);for(tr=tr.replace(chr0,""),Nr&&(tr=tr.replace(chr1,"!")),Er=0;Er<It.length;++Er)if((Nr?It[Er].replace(chr1,"!"):It[Er]).replace(chr0,"")==tr||(Nr?Nt[Er].replace(chr1,"!"):Nt[Er]).replace(chr0,"")==tr)return et.FileIndex[Er];return null}var Le=64,He=-2,Ct="d0cf11e0a1b11ae1",Ze=[208,207,17,224,161,177,26,225],Rt="00000000000000000000000000000000",nt={MAXREGSECT:-6,DIFSECT:-4,FATSECT:-3,ENDOFCHAIN:He,FREESECT:-1,HEADER_SIGNATURE:Ct,HEADER_MINOR_VERSION:"3e00",MAXREGSID:-6,NOSTREAM:-1,HEADER_CLSID:Rt,EntryTypes:["unknown","storage","stream","lockbytes","property","root"]};function nr(et,Gt,It){ae();var Nt=Ge(et,It);te.writeFileSync(Gt,Nt)}function Je(et){for(var Gt=new Array(et.length),It=0;It<et.length;++It)Gt[It]=String.fromCharCode(et[It]);return Gt.join("")}function Wt(et,Gt){var It=Ge(et,Gt);switch(Gt&&Gt.type||"buffer"){case"file":return ae(),te.writeFileSync(Gt.filename,It),It;case"binary":return typeof It=="string"?It:Je(It);case"base64":return Base64_encode(typeof It=="string"?It:Je(It));case"buffer":if(has_buf)return Buffer.isBuffer(It)?It:Buffer_from(It);case"array":return typeof It=="string"?s2a(It):It}return It}var Lt;function qe(et){try{var Gt=et.InflateRaw,It=new Gt;if(It._processChunk(new Uint8Array([3,0]),It._finishFlushFlag),It.bytesRead)Lt=et;else throw new Error("zlib does not expose bytesRead")}catch(Nt){console.error("cannot use native zlib: "+(Nt.message||Nt))}}function $e(et,Gt){if(!Lt)return qr(et,Gt);var It=Lt.InflateRaw,Nt=new It,qt=Nt._processChunk(et.slice(et.l),Nt._finishFlushFlag);return et.l+=Nt.bytesRead,qt}function Be(et){return Lt?Lt.deflateRawSync(et):or(et)}var Xe=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],rt=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],Qe=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];function vt(et){var Gt=(et<<1|et<<11)&139536|(et<<5|et<<15)&558144;return(Gt>>16|Gt>>8|Gt)&255}for(var Dt=typeof Uint8Array<"u",Ut=Dt?new Uint8Array(256):[],hr=0;hr<256;++hr)Ut[hr]=vt(hr);function pt(et,Gt){var It=Ut[et&255];return Gt<=8?It>>>8-Gt:(It=It<<8|Ut[et>>8&255],Gt<=16?It>>>16-Gt:(It=It<<8|Ut[et>>16&255],It>>>24-Gt))}function yr(et,Gt){var It=Gt&7,Nt=Gt>>>3;return(et[Nt]|(It<=6?0:et[Nt+1]<<8))>>>It&3}function vr(et,Gt){var It=Gt&7,Nt=Gt>>>3;return(et[Nt]|(It<=5?0:et[Nt+1]<<8))>>>It&7}function wr(et,Gt){var It=Gt&7,Nt=Gt>>>3;return(et[Nt]|(It<=4?0:et[Nt+1]<<8))>>>It&15}function ir(et,Gt){var It=Gt&7,Nt=Gt>>>3;return(et[Nt]|(It<=3?0:et[Nt+1]<<8))>>>It&31}function sr(et,Gt){var It=Gt&7,Nt=Gt>>>3;return(et[Nt]|(It<=1?0:et[Nt+1]<<8))>>>It&127}function kt(et,Gt,It){var Nt=Gt&7,qt=Gt>>>3,tr=(1<<It)-1,Er=et[qt]>>>Nt;return It<8-Nt||(Er|=et[qt+1]<<8-Nt,It<16-Nt)||(Er|=et[qt+2]<<16-Nt,It<24-Nt)||(Er|=et[qt+3]<<24-Nt),Er&tr}function rr(et,Gt,It){var Nt=Gt&7,qt=Gt>>>3;return Nt<=5?et[qt]|=(It&7)<<Nt:(et[qt]|=It<<Nt&255,et[qt+1]=(It&7)>>8-Nt),Gt+3}function lr(et,Gt,It){var Nt=Gt&7,qt=Gt>>>3;return It=(It&1)<<Nt,et[qt]|=It,Gt+1}function mr(et,Gt,It){var Nt=Gt&7,qt=Gt>>>3;return It<<=Nt,et[qt]|=It&255,It>>>=8,et[qt+1]=It,Gt+8}function Ir(et,Gt,It){var Nt=Gt&7,qt=Gt>>>3;return It<<=Nt,et[qt]|=It&255,It>>>=8,et[qt+1]=It&255,et[qt+2]=It>>>8,Gt+16}function Or(et,Gt){var It=et.length,Nt=2*It>Gt?2*It:Gt+5,qt=0;if(It>=Gt)return et;if(has_buf){var tr=new_unsafe_buf(Nt);if(et.copy)et.copy(tr);else for(;qt<et.length;++qt)tr[qt]=et[qt];return tr}else if(Dt){var Er=new Uint8Array(Nt);if(Er.set)Er.set(et);else for(;qt<It;++qt)Er[qt]=et[qt];return Er}return et.length=Nt,et}function Fr(et){for(var Gt=new Array(et),It=0;It<et;++It)Gt[It]=0;return Gt}function Et(et,Gt,It){var Nt=1,qt=0,tr=0,Er=0,Nr=0,Pr=et.length,Cr=Dt?new Uint16Array(32):Fr(32);for(tr=0;tr<32;++tr)Cr[tr]=0;for(tr=Pr;tr<It;++tr)et[tr]=0;Pr=et.length;var Dr=Dt?new Uint16Array(Pr):Fr(Pr);for(tr=0;tr<Pr;++tr)Cr[qt=et[tr]]++,Nt<qt&&(Nt=qt),Dr[tr]=0;for(Cr[0]=0,tr=1;tr<=Nt;++tr)Cr[tr+16]=Nr=Nr+Cr[tr-1]<<1;for(tr=0;tr<Pr;++tr)Nr=et[tr],Nr!=0&&(Dr[tr]=Cr[Nr+16]++);var Hr=0;for(tr=0;tr<Pr;++tr)if(Hr=et[tr],Hr!=0)for(Nr=pt(Dr[tr],Nt)>>Nt-Hr,Er=(1<<Nt+4-Hr)-1;Er>=0;--Er)Gt[Nr|Er<<Hr]=Hr&15|tr<<4;return Nt}var dr=Dt?new Uint16Array(512):Fr(512),br=Dt?new Uint16Array(32):Fr(32);if(!Dt){for(var Br=0;Br<512;++Br)dr[Br]=0;for(Br=0;Br<32;++Br)br[Br]=0}(function(){for(var et=[],Gt=0;Gt<32;Gt++)et.push(5);Et(et,br,32);var It=[];for(Gt=0;Gt<=143;Gt++)It.push(8);for(;Gt<=255;Gt++)It.push(9);for(;Gt<=279;Gt++)It.push(7);for(;Gt<=287;Gt++)It.push(8);Et(It,dr,288)})();var Lr=function(){for(var Gt=Dt?new Uint8Array(32768):[],It=0,Nt=0;It<Qe.length-1;++It)for(;Nt<Qe[It+1];++Nt)Gt[Nt]=It;for(;Nt<32768;++Nt)Gt[Nt]=29;var qt=Dt?new Uint8Array(259):[];for(It=0,Nt=0;It<rt.length-1;++It)for(;Nt<rt[It+1];++Nt)qt[Nt]=It;function tr(Nr,Pr){for(var Cr=0;Cr<Nr.length;){var Dr=Math.min(65535,Nr.length-Cr),Hr=Cr+Dr==Nr.length;for(Pr.write_shift(1,+Hr),Pr.write_shift(2,Dr),Pr.write_shift(2,~Dr&65535);Dr-- >0;)Pr[Pr.l++]=Nr[Cr++]}return Pr.l}function Er(Nr,Pr){for(var Cr=0,Dr=0,Hr=Dt?new Uint16Array(32768):[];Dr<Nr.length;){var Kr=Math.min(65535,Nr.length-Dr);if(Kr<10){for(Cr=rr(Pr,Cr,+(Dr+Kr==Nr.length)),Cr&7&&(Cr+=8-(Cr&7)),Pr.l=Cr/8|0,Pr.write_shift(2,Kr),Pr.write_shift(2,~Kr&65535);Kr-- >0;)Pr[Pr.l++]=Nr[Dr++];Cr=Pr.l*8;continue}Cr=rr(Pr,Cr,+(Dr+Kr==Nr.length)+2);for(var rs=0;Kr-- >0;){var Yr=Nr[Dr];rs=(rs<<5^Yr)&32767;var ts=-1,as=0;if((ts=Hr[rs])&&(ts|=Dr&-32768,ts>Dr&&(ts-=32768),ts<Dr))for(;Nr[ts+as]==Nr[Dr+as]&&as<250;)++as;if(as>2){Yr=qt[as],Yr<=22?Cr=mr(Pr,Cr,Ut[Yr+1]>>1)-1:(mr(Pr,Cr,3),Cr+=5,mr(Pr,Cr,Ut[Yr-23]>>5),Cr+=3);var ls=Yr<8?0:Yr-4>>2;ls>0&&(Ir(Pr,Cr,as-rt[Yr]),Cr+=ls),Yr=Gt[Dr-ts],Cr=mr(Pr,Cr,Ut[Yr]>>3),Cr-=3;var os=Yr<4?0:Yr-2>>1;os>0&&(Ir(Pr,Cr,Dr-ts-Qe[Yr]),Cr+=os);for(var ds=0;ds<as;++ds)Hr[rs]=Dr&32767,rs=(rs<<5^Nr[Dr])&32767,++Dr;Kr-=as-1}else Yr<=143?Yr=Yr+48:Cr=lr(Pr,Cr,1),Cr=mr(Pr,Cr,Ut[Yr]),Hr[rs]=Dr&32767,++Dr}Cr=mr(Pr,Cr,0)-1}return Pr.l=(Cr+7)/8|0,Pr.l}return function(Pr,Cr){return Pr.length<8?tr(Pr,Cr):Er(Pr,Cr)}}();function or(et){var Gt=new_buf(50+Math.floor(et.length*1.1)),It=Lr(et,Gt);return Gt.slice(0,It)}var ur=Dt?new Uint16Array(32768):Fr(32768),gr=Dt?new Uint16Array(32768):Fr(32768),$r=Dt?new Uint16Array(128):Fr(128),Xr=1,Rr=1;function pr(et,Gt){var It=ir(et,Gt)+257;Gt+=5;var Nt=ir(et,Gt)+1;Gt+=5;var qt=wr(et,Gt)+4;Gt+=4;for(var tr=0,Er=Dt?new Uint8Array(19):Fr(19),Nr=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Pr=1,Cr=Dt?new Uint8Array(8):Fr(8),Dr=Dt?new Uint8Array(8):Fr(8),Hr=Er.length,Kr=0;Kr<qt;++Kr)Er[Xe[Kr]]=tr=vr(et,Gt),Pr<tr&&(Pr=tr),Cr[tr]++,Gt+=3;var rs=0;for(Cr[0]=0,Kr=1;Kr<=Pr;++Kr)Dr[Kr]=rs=rs+Cr[Kr-1]<<1;for(Kr=0;Kr<Hr;++Kr)(rs=Er[Kr])!=0&&(Nr[Kr]=Dr[rs]++);var Yr=0;for(Kr=0;Kr<Hr;++Kr)if(Yr=Er[Kr],Yr!=0){rs=Ut[Nr[Kr]]>>8-Yr;for(var ts=(1<<7-Yr)-1;ts>=0;--ts)$r[rs|ts<<Yr]=Yr&7|Kr<<3}var as=[];for(Pr=1;as.length<It+Nt;)switch(rs=$r[sr(et,Gt)],Gt+=rs&7,rs>>>=3){case 16:for(tr=3+yr(et,Gt),Gt+=2,rs=as[as.length-1];tr-- >0;)as.push(rs);break;case 17:for(tr=3+vr(et,Gt),Gt+=3;tr-- >0;)as.push(0);break;case 18:for(tr=11+sr(et,Gt),Gt+=7;tr-- >0;)as.push(0);break;default:as.push(rs),Pr<rs&&(Pr=rs);break}var ls=as.slice(0,It),os=as.slice(It);for(Kr=It;Kr<286;++Kr)ls[Kr]=0;for(Kr=Nt;Kr<30;++Kr)os[Kr]=0;return Xr=Et(ls,ur,286),Rr=Et(os,gr,30),Gt}function xr(et,Gt){if(et[0]==3&&!(et[1]&3))return[new_raw_buf(Gt),2];for(var It=0,Nt=0,qt=new_unsafe_buf(Gt||1<<18),tr=0,Er=qt.length>>>0,Nr=0,Pr=0;!(Nt&1);){if(Nt=vr(et,It),It+=3,Nt>>>1)Nt>>1==1?(Nr=9,Pr=5):(It=pr(et,It),Nr=Xr,Pr=Rr);else{It&7&&(It+=8-(It&7));var Cr=et[It>>>3]|et[(It>>>3)+1]<<8;if(It+=32,Cr>0)for(!Gt&&Er<tr+Cr&&(qt=Or(qt,tr+Cr),Er=qt.length);Cr-- >0;)qt[tr++]=et[It>>>3],It+=8;continue}for(;;){!Gt&&Er<tr+32767&&(qt=Or(qt,tr+32767),Er=qt.length);var Dr=kt(et,It,Nr),Hr=Nt>>>1==1?dr[Dr]:ur[Dr];if(It+=Hr&15,Hr>>>=4,!(Hr>>>8&255))qt[tr++]=Hr;else{if(Hr==256)break;Hr-=257;var Kr=Hr<8?0:Hr-4>>2;Kr>5&&(Kr=0);var rs=tr+rt[Hr];Kr>0&&(rs+=kt(et,It,Kr),It+=Kr),Dr=kt(et,It,Pr),Hr=Nt>>>1==1?br[Dr]:gr[Dr],It+=Hr&15,Hr>>>=4;var Yr=Hr<4?0:Hr-2>>1,ts=Qe[Hr];for(Yr>0&&(ts+=kt(et,It,Yr),It+=Yr),!Gt&&Er<rs&&(qt=Or(qt,rs+100),Er=qt.length);tr<rs;)qt[tr]=qt[tr-ts],++tr}}}return Gt?[qt,It+7>>>3]:[qt.slice(0,tr),It+7>>>3]}function qr(et,Gt){var It=et.slice(et.l||0),Nt=xr(It,Gt);return et.l+=Nt[1],Nt[0]}function ns(et,Gt){if(et)typeof console<"u"&&console.error(Gt);else throw new Error(Gt)}function ss(et,Gt){var It=et;prep_blob(It,0);var Nt=[],qt=[],tr={FileIndex:Nt,FullPaths:qt};je(tr,{root:Gt.root});for(var Er=It.length-4;(It[Er]!=80||It[Er+1]!=75||It[Er+2]!=5||It[Er+3]!=6)&&Er>=0;)--Er;It.l=Er+4,It.l+=4;var Nr=It.read_shift(2);It.l+=6;var Pr=It.read_shift(4);for(It.l=Pr,Er=0;Er<Nr;++Er){It.l+=20;var Cr=It.read_shift(4),Dr=It.read_shift(4),Hr=It.read_shift(2),Kr=It.read_shift(2),rs=It.read_shift(2);It.l+=8;var Yr=It.read_shift(4),ts=H(It.slice(It.l+Hr,It.l+Hr+Kr));It.l+=Hr+Kr+rs;var as=It.l;It.l=Yr+4,ar(It,Cr,Dr,tr,ts),It.l=as}return tr}function ar(et,Gt,It,Nt,qt){et.l+=2;var tr=et.read_shift(2),Er=et.read_shift(2),Nr=I(et);if(tr&8257)throw new Error("Unsupported ZIP encryption");for(var Pr=et.read_shift(4),Cr=et.read_shift(4),Dr=et.read_shift(4),Hr=et.read_shift(2),Kr=et.read_shift(2),rs="",Yr=0;Yr<Hr;++Yr)rs+=String.fromCharCode(et[et.l++]);if(Kr){var ts=H(et.slice(et.l,et.l+Kr));(ts[21589]||{}).mt&&(Nr=ts[21589].mt),((qt||{})[21589]||{}).mt&&(Nr=qt[21589].mt)}et.l+=Kr;var as=et.slice(et.l,et.l+Cr);switch(Er){case 8:as=$e(et,Dr);break;case 0:break;default:throw new Error("Unsupported ZIP Compression method "+Er)}var ls=!1;tr&8&&(Pr=et.read_shift(4),Pr==134695760&&(Pr=et.read_shift(4),ls=!0),Cr=et.read_shift(4),Dr=et.read_shift(4)),Cr!=Gt&&ns(ls,"Bad compressed size: "+Gt+" != "+Cr),Dr!=It&&ns(ls,"Bad uncompressed size: "+It+" != "+Dr),Mr(Nt,rs,as,{unsafe:!0,mt:Nr})}function Sr(et,Gt){var It=Gt||{},Nt=[],qt=[],tr=new_buf(1),Er=It.compression?8:0,Nr=0,Pr=0,Cr=0,Dr=0,Hr=0,Kr=et.FullPaths[0],rs=Kr,Yr=et.FileIndex[0],ts=[],as=0;for(Pr=1;Pr<et.FullPaths.length;++Pr)if(rs=et.FullPaths[Pr].slice(Kr.length),Yr=et.FileIndex[Pr],!(!Yr.size||!Yr.content||rs=="Sh33tJ5")){var ls=Dr,os=new_buf(rs.length);for(Cr=0;Cr<rs.length;++Cr)os.write_shift(1,rs.charCodeAt(Cr)&127);os=os.slice(0,os.l),ts[Hr]=CRC32.buf(Yr.content,0);var ds=Yr.content;Er==8&&(ds=Be(ds)),tr=new_buf(30),tr.write_shift(4,67324752),tr.write_shift(2,20),tr.write_shift(2,Nr),tr.write_shift(2,Er),Yr.mt?S(tr,Yr.mt):tr.write_shift(4,0),tr.write_shift(-4,ts[Hr]),tr.write_shift(4,ds.length),tr.write_shift(4,Yr.content.length),tr.write_shift(2,os.length),tr.write_shift(2,0),Dr+=tr.length,Nt.push(tr),Dr+=os.length,Nt.push(os),Dr+=ds.length,Nt.push(ds),tr=new_buf(46),tr.write_shift(4,33639248),tr.write_shift(2,0),tr.write_shift(2,20),tr.write_shift(2,Nr),tr.write_shift(2,Er),tr.write_shift(4,0),tr.write_shift(-4,ts[Hr]),tr.write_shift(4,ds.length),tr.write_shift(4,Yr.content.length),tr.write_shift(2,os.length),tr.write_shift(2,0),tr.write_shift(2,0),tr.write_shift(2,0),tr.write_shift(2,0),tr.write_shift(4,0),tr.write_shift(4,ls),as+=tr.l,qt.push(tr),as+=os.length,qt.push(os),++Hr}return tr=new_buf(22),tr.write_shift(4,101010256),tr.write_shift(2,0),tr.write_shift(2,0),tr.write_shift(2,Hr),tr.write_shift(2,Hr),tr.write_shift(4,as),tr.write_shift(4,Dr),tr.write_shift(2,0),bconcat([bconcat(Nt),bconcat(qt),tr])}var zr={htm:"text/html",xml:"text/xml",gif:"image/gif",jpg:"image/jpeg",png:"image/png",mso:"application/x-mso",thmx:"application/vnd.ms-officetheme",sh33tj5:"application/octet-stream"};function Gr(et,Gt){if(et.ctype)return et.ctype;var It=et.name||"",Nt=It.match(/\.([^\.]+)$/);return Nt&&zr[Nt[1]]||Gt&&(Nt=(It=Gt).match(/[\.\\]([^\.\\])+$/),Nt&&zr[Nt[1]])?zr[Nt[1]]:"application/octet-stream"}function Qr(et){for(var Gt=Base64_encode(et),It=[],Nt=0;Nt<Gt.length;Nt+=76)It.push(Gt.slice(Nt,Nt+76));return It.join(`\r
`)+`\r
`}function Wr(et){var Gt=et.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF=]/g,function(Cr){var Dr=Cr.charCodeAt(0).toString(16).toUpperCase();return"="+(Dr.length==1?"0"+Dr:Dr)});Gt=Gt.replace(/ $/mg,"=20").replace(/\t$/mg,"=09"),Gt.charAt(0)==`
`&&(Gt="=0D"+Gt.slice(1)),Gt=Gt.replace(/\r(?!\n)/mg,"=0D").replace(/\n\n/mg,`
=0A`).replace(/([^\r\n])\n/mg,"$1=0A");for(var It=[],Nt=Gt.split(`\r
`),qt=0;qt<Nt.length;++qt){var tr=Nt[qt];if(tr.length==0){It.push("");continue}for(var Er=0;Er<tr.length;){var Nr=76,Pr=tr.slice(Er,Er+Nr);Pr.charAt(Nr-1)=="="?Nr--:Pr.charAt(Nr-2)=="="?Nr-=2:Pr.charAt(Nr-3)=="="&&(Nr-=3),Pr=tr.slice(Er,Er+Nr),Er+=Nr,Er<tr.length&&(Pr+="="),It.push(Pr)}}return It.join(`\r
`)}function er(et){for(var Gt=[],It=0;It<et.length;++It){for(var Nt=et[It];It<=et.length&&Nt.charAt(Nt.length-1)=="=";)Nt=Nt.slice(0,Nt.length-1)+et[++It];Gt.push(Nt)}for(var qt=0;qt<Gt.length;++qt)Gt[qt]=Gt[qt].replace(/[=][0-9A-Fa-f]{2}/g,function(tr){return String.fromCharCode(parseInt(tr.slice(1),16))});return s2a(Gt.join(`\r
`))}function Bt(et,Gt,It){for(var Nt="",qt="",tr="",Er,Nr=0;Nr<10;++Nr){var Pr=Gt[Nr];if(!Pr||Pr.match(/^\s*$/))break;var Cr=Pr.match(/^(.*?):\s*([^\s].*)$/);if(Cr)switch(Cr[1].toLowerCase()){case"content-location":Nt=Cr[2].trim();break;case"content-type":tr=Cr[2].trim();break;case"content-transfer-encoding":qt=Cr[2].trim();break}}switch(++Nr,qt.toLowerCase()){case"base64":Er=s2a(Base64_decode(Gt.slice(Nr).join("")));break;case"quoted-printable":Er=er(Gt.slice(Nr));break;default:throw new Error("Unsupported Content-Transfer-Encoding "+qt)}var Dr=Mr(et,Nt.slice(It.length),Er,{unsafe:!0});tr&&(Dr.ctype=tr)}function cr(et,Gt){if(Je(et.slice(0,13)).toLowerCase()!="mime-version:")throw new Error("Unsupported MAD header");var It=Gt&&Gt.root||"",Nt=(has_buf&&Buffer.isBuffer(et)?et.toString("binary"):Je(et)).split(`\r
`),qt=0,tr="";for(qt=0;qt<Nt.length;++qt)if(tr=Nt[qt],!!/^Content-Location:/i.test(tr)&&(tr=tr.slice(tr.indexOf("file")),It||(It=tr.slice(0,tr.lastIndexOf("/")+1)),tr.slice(0,It.length)!=It))for(;It.length>0&&(It=It.slice(0,It.length-1),It=It.slice(0,It.lastIndexOf("/")+1),tr.slice(0,It.length)!=It););var Er=(Nt[1]||"").match(/boundary="(.*?)"/);if(!Er)throw new Error("MAD cannot find boundary");var Nr="--"+(Er[1]||""),Pr=[],Cr=[],Dr={FileIndex:Pr,FullPaths:Cr};je(Dr);var Hr,Kr=0;for(qt=0;qt<Nt.length;++qt){var rs=Nt[qt];rs!==Nr&&rs!==Nr+"--"||(Kr++&&Bt(Dr,Nt.slice(Hr,qt),It),Hr=qt)}return Dr}function _r(et,Gt){var It=Gt||{},Nt=It.boundary||"SheetJS";Nt="------="+Nt;for(var qt=["MIME-Version: 1.0",'Content-Type: multipart/related; boundary="'+Nt.slice(2)+'"',"","",""],tr=et.FullPaths[0],Er=tr,Nr=et.FileIndex[0],Pr=1;Pr<et.FullPaths.length;++Pr)if(Er=et.FullPaths[Pr].slice(tr.length),Nr=et.FileIndex[Pr],!(!Nr.size||!Nr.content||Er=="Sh33tJ5")){Er=Er.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7E-\xFF]/g,function(as){return"_x"+as.charCodeAt(0).toString(16)+"_"}).replace(/[\u0080-\uFFFF]/g,function(as){return"_u"+as.charCodeAt(0).toString(16)+"_"});for(var Cr=Nr.content,Dr=has_buf&&Buffer.isBuffer(Cr)?Cr.toString("binary"):Je(Cr),Hr=0,Kr=Math.min(1024,Dr.length),rs=0,Yr=0;Yr<=Kr;++Yr)(rs=Dr.charCodeAt(Yr))>=32&&rs<128&&++Hr;var ts=Hr>=Kr*4/5;qt.push(Nt),qt.push("Content-Location: "+(It.root||"file:///C:/SheetJS/")+Er),qt.push("Content-Transfer-Encoding: "+(ts?"quoted-printable":"base64")),qt.push("Content-Type: "+Gr(Nr,Er)),qt.push(""),qt.push(ts?Wr(Dr):Qr(Dr))}return qt.push(Nt+`--\r
`),qt.join(`\r
`)}function jr(et){var Gt={};return je(Gt,et),Gt}function Mr(et,Gt,It,Nt){var qt=Nt&&Nt.unsafe;qt||je(et);var tr=!qt&&CFB.find(et,Gt);if(!tr){var Er=et.FullPaths[0];Gt.slice(0,Er.length)==Er?Er=Gt:(Er.slice(-1)!="/"&&(Er+="/"),Er=(Er+Gt).replace("//","/")),tr={name:w(Gt),type:2},et.FileIndex.push(tr),et.FullPaths.push(Er),qt||CFB.utils.cfb_gc(et)}return tr.content=It,tr.size=It?It.length:0,Nt&&(Nt.CLSID&&(tr.clsid=Nt.CLSID),Nt.mt&&(tr.mt=Nt.mt),Nt.ct&&(tr.ct=Nt.ct)),tr}function Vr(et,Gt){je(et);var It=CFB.find(et,Gt);if(It){for(var Nt=0;Nt<et.FileIndex.length;++Nt)if(et.FileIndex[Nt]==It)return et.FileIndex.splice(Nt,1),et.FullPaths.splice(Nt,1),!0}return!1}function Zr(et,Gt,It){je(et);var Nt=CFB.find(et,Gt);if(Nt){for(var qt=0;qt<et.FileIndex.length;++qt)if(et.FileIndex[qt]==Nt)return et.FileIndex[qt].name=w(It),et.FullPaths[qt]=It,!0}return!1}function Jr(et){Ne(et,!0)}return r.find=Ie,r.read=Ue,r.parse=ie,r.write=Wt,r.writeFile=nr,r.utils={cfb_new:jr,cfb_add:Mr,cfb_del:Vr,cfb_mov:Zr,cfb_gc:Jr,ReadShift,CheckField,prep_blob,bconcat,use_zlib:qe,_deflateRaw:or,_inflateRaw:qr,consts:nt},r}();function read_binary(E){if(typeof Deno<"u")return Deno.readFileSync(E);if(typeof $<"u"&&typeof File<"u"&&typeof Folder<"u")try{var r=File(E);r.open("r"),r.encoding="binary";var v=r.read();return r.close(),v}catch(T){if(!T.message||!T.message.match(/onstruct/))throw T}throw new Error("Cannot access file "+E)}function keys(E){for(var r=Object.keys(E),v=[],T=0;T<r.length;++T)Object.prototype.hasOwnProperty.call(E,r[T])&&v.push(r[T]);return v}function evert(E){for(var r=[],v=keys(E),T=0;T!==v.length;++T)r[E[v[T]]]=v[T];return r}var basedate=new Date(1899,11,30,0,0,0);function datenum(E,r){var v=E.getTime(),T=basedate.getTime()+(E.getTimezoneOffset()-basedate.getTimezoneOffset())*6e4;return(v-T)/(24*60*60*1e3)}var refdate=new Date,dnthresh=basedate.getTime()+(refdate.getTimezoneOffset()-basedate.getTimezoneOffset())*6e4,refoffset=refdate.getTimezoneOffset();function numdate(E){var r=new Date;return r.setTime(E*24*60*60*1e3+dnthresh),r.getTimezoneOffset()!==refoffset&&r.setTime(r.getTime()+(r.getTimezoneOffset()-refoffset)*6e4),r}function parse_isodur(E){var r=0,v=0,T=!1,w=E.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!w)throw new Error("|"+E+"| is not an ISO8601 Duration");for(var S=1;S!=w.length;++S)if(w[S]){switch(v=1,S>3&&(T=!0),w[S].slice(w[S].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+w[S].slice(w[S].length-1));case"D":v*=24;case"H":v*=60;case"M":if(T)v*=60;else throw new Error("Unsupported ISO Duration Field: M")}r+=v*parseInt(w[S],10)}return r}var good_pd_date_1=new Date("2017-02-19T19:06:09.000Z"),good_pd_date=isNaN(good_pd_date_1.getFullYear())?new Date("2/19/17"):good_pd_date_1,good_pd=good_pd_date.getFullYear()==2017;function parseDate(E,r){var v=new Date(E);if(good_pd)return r>0?v.setTime(v.getTime()+v.getTimezoneOffset()*60*1e3):r<0&&v.setTime(v.getTime()-v.getTimezoneOffset()*60*1e3),v;if(E instanceof Date)return E;if(good_pd_date.getFullYear()==1917&&!isNaN(v.getFullYear())){var T=v.getFullYear();return E.indexOf(""+T)>-1||v.setFullYear(v.getFullYear()+100),v}var w=E.match(/\d+/g)||["2017","2","19","0","0","0"],S=new Date(+w[0],+w[1]-1,+w[2],+w[3]||0,+w[4]||0,+w[5]||0);return E.indexOf("Z")>-1&&(S=new Date(S.getTime()-S.getTimezoneOffset()*60*1e3)),S}function cc2str(E,r){if(has_buf&&Buffer.isBuffer(E)){if(r){if(E[0]==255&&E[1]==254)return utf8write(E.slice(2).toString("utf16le"));if(E[1]==254&&E[2]==255)return utf8write(utf16beread(E.slice(2).toString("binary")))}return E.toString("binary")}if(typeof TextDecoder<"u")try{if(r){if(E[0]==255&&E[1]==254)return utf8write(new TextDecoder("utf-16le").decode(E.slice(2)));if(E[0]==254&&E[1]==255)return utf8write(new TextDecoder("utf-16be").decode(E.slice(2)))}var v={"€":"","‚":"",ƒ:"","„":"","…":"","†":"","‡":"","ˆ":"","‰":"",Š:"","‹":"",Œ:"",Ž:"","‘":"","’":"","“":"","”":"","•":"","–":"","—":"","˜":"","™":"",š:"","›":"",œ:"",ž:"",Ÿ:""};return Array.isArray(E)&&(E=new Uint8Array(E)),new TextDecoder("latin1").decode(E).replace(/[€‚ƒ„…†‡ˆ‰Š‹ŒŽ‘’“”•–—˜™š›œžŸ]/g,function(S){return v[S]||S})}catch{}for(var T=[],w=0;w!=E.length;++w)T.push(String.fromCharCode(E[w]));return T.join("")}function dup(E){if(typeof JSON<"u"&&!Array.isArray(E))return JSON.parse(JSON.stringify(E));if(typeof E!="object"||E==null)return E;if(E instanceof Date)return new Date(E.getTime());var r={};for(var v in E)Object.prototype.hasOwnProperty.call(E,v)&&(r[v]=dup(E[v]));return r}function fill(E,r){for(var v="";v.length<r;)v+=E;return v}function fuzzynum(E){var r=Number(E);if(!isNaN(r))return isFinite(r)?r:NaN;if(!/\d/.test(E))return r;var v=1,T=E.replace(/([\d]),([\d])/g,"$1$2").replace(/[$]/g,"").replace(/[%]/g,function(){return v*=100,""});return!isNaN(r=Number(T))||(T=T.replace(/[(](.*)[)]/,function(w,S){return v=-v,S}),!isNaN(r=Number(T)))?r/v:r}var lower_months=["january","february","march","april","may","june","july","august","september","october","november","december"];function fuzzydate(E){var r=new Date(E),v=new Date(NaN),T=r.getYear(),w=r.getMonth(),S=r.getDate();if(isNaN(S))return v;var I=E.toLowerCase();if(I.match(/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/)){if(I=I.replace(/[^a-z]/g,"").replace(/([^a-z]|^)[ap]m?([^a-z]|$)/,""),I.length>3&&lower_months.indexOf(I)==-1)return v}else if(I.match(/[a-z]/))return v;return T<0||T>8099?v:(w>0||S>1)&&T!=101?r:E.match(/[^-0-9:,\/\\]/)?v:r}var split_regex=function(){var E="abacaba".split(/(:?b)/i).length==5;return function(v,T,w){if(E||typeof T=="string")return v.split(T);for(var S=v.split(T),I=[S[0]],H=1;H<S.length;++H)I.push(w),I.push(S[H]);return I}}();function getdatastr(E){return E?E.content&&E.type?cc2str(E.content,!0):E.data?debom(E.data):E.asNodeBuffer&&has_buf?debom(E.asNodeBuffer().toString("binary")):E.asBinary?debom(E.asBinary()):E._data&&E._data.getContent?debom(cc2str(Array.prototype.slice.call(E._data.getContent(),0))):null:null}function getdatabin(E){if(!E)return null;if(E.data)return char_codes(E.data);if(E.asNodeBuffer&&has_buf)return E.asNodeBuffer();if(E._data&&E._data.getContent){var r=E._data.getContent();return typeof r=="string"?char_codes(r):Array.prototype.slice.call(r)}return E.content&&E.type?E.content:null}function getdata(E){return E&&E.name.slice(-4)===".bin"?getdatabin(E):getdatastr(E)}function safegetzipfile(E,r){for(var v=E.FullPaths||keys(E.files),T=r.toLowerCase().replace(/[\/]/g,"\\"),w=T.replace(/\\/g,"/"),S=0;S<v.length;++S){var I=v[S].replace(/^Root Entry[\/]/,"").toLowerCase();if(T==I||w==I)return E.files?E.files[v[S]]:E.FileIndex[S]}return null}function getzipfile(E,r){var v=safegetzipfile(E,r);if(v==null)throw new Error("Cannot find file "+r+" in zip");return v}function getzipdata(E,r,v){if(!v)return getdata(getzipfile(E,r));if(!r)return null;try{return getzipdata(E,r)}catch{return null}}function getzipstr(E,r,v){if(!v)return getdatastr(getzipfile(E,r));if(!r)return null;try{return getzipstr(E,r)}catch{return null}}function getzipbin(E,r,v){return getdatabin(getzipfile(E,r))}function zipentries(E){for(var r=E.FullPaths||keys(E.files),v=[],T=0;T<r.length;++T)r[T].slice(-1)!="/"&&v.push(r[T].replace(/^Root Entry[\/]/,""));return v.sort()}function zip_add_file(E,r,v){if(E.FullPaths){if(typeof v=="string"){var T;return has_buf?T=Buffer_from(v):T=utf8decode(v),CFB.utils.cfb_add(E,r,T)}CFB.utils.cfb_add(E,r,v)}else E.file(r,v)}function zip_read(E,r){switch(r.type){case"base64":return CFB.read(E,{type:"base64"});case"binary":return CFB.read(E,{type:"binary"});case"buffer":case"array":return CFB.read(E,{type:"buffer"})}throw new Error("Unrecognized type "+r.type)}function resolve_path(E,r){if(E.charAt(0)=="/")return E.slice(1);var v=r.split("/");r.slice(-1)!="/"&&v.pop();for(var T=E.split("/");T.length!==0;){var w=T.shift();w===".."?v.pop():w!=="."&&v.push(w)}return v.join("/")}var XML_HEADER=`<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\r
`,attregexg=/([^"\s?>\/]+)\s*=\s*((?:")([^"]*)(?:")|(?:')([^']*)(?:')|([^'">\s]+))/g,tagregex1=/<[\/\?]?[a-zA-Z0-9:_-]+(?:\s+[^"\s?>\/]+\s*=\s*(?:"[^"]*"|'[^']*'|[^'">\s=]+))*\s*[\/\?]?>/mg,tagregex2=/<[^>]*>/g,tagregex=XML_HEADER.match(tagregex1)?tagregex1:tagregex2,nsregex=/<\w*:/,nsregex2=/<(\/?)\w+:/;function parsexmltag(E,r,v){for(var T={},w=0,S=0;w!==E.length&&!((S=E.charCodeAt(w))===32||S===10||S===13);++w);if(r||(T[0]=E.slice(0,w)),w===E.length)return T;var I=E.match(attregexg),H=0,te="",ae=0,ie="",ce="",me=1;if(I)for(ae=0;ae!=I.length;++ae){for(ce=I[ae],S=0;S!=ce.length&&ce.charCodeAt(S)!==61;++S);for(ie=ce.slice(0,S).trim();ce.charCodeAt(S+1)==32;)++S;for(me=(w=ce.charCodeAt(S+1))==34||w==39?1:0,te=ce.slice(S+1+me,ce.length-me),H=0;H!=ie.length&&ie.charCodeAt(H)!==58;++H);if(H===ie.length)ie.indexOf("_")>0&&(ie=ie.slice(0,ie.indexOf("_"))),T[ie]=te,T[ie.toLowerCase()]=te;else{var _e=(H===5&&ie.slice(0,5)==="xmlns"?"xmlns":"")+ie.slice(H+1);if(T[_e]&&ie.slice(H-3,H)=="ext")continue;T[_e]=te,T[_e.toLowerCase()]=te}}return T}function strip_ns(E){return E.replace(nsregex2,"<$1")}var encodings={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"},rencoding=evert(encodings),unescapexml=function(){var E=/&(?:quot|apos|gt|lt|amp|#x?([\da-fA-F]+));/ig,r=/_x([\da-fA-F]{4})_/ig;return function v(T){var w=T+"",S=w.indexOf("<![CDATA[");if(S==-1)return w.replace(E,function(H,te){return encodings[H]||String.fromCharCode(parseInt(te,H.indexOf("x")>-1?16:10))||H}).replace(r,function(H,te){return String.fromCharCode(parseInt(te,16))});var I=w.indexOf("]]>");return v(w.slice(0,S))+w.slice(S+9,I)+v(w.slice(I+3))}}(),decregex=/[&<>'"]/g,htmlcharegex=/[\u0000-\u001f]/g;function escapehtml(E){var r=E+"";return r.replace(decregex,function(v){return rencoding[v]}).replace(/\n/g,"<br/>").replace(htmlcharegex,function(v){return"&#x"+("000"+v.charCodeAt(0).toString(16)).slice(-4)+";"})}var xlml_fixstr=function(){var E=/&#(\d+);/g;function r(v,T){return String.fromCharCode(parseInt(T,10))}return function(T){return T.replace(E,r)}}();function parsexmlbool(E){switch(E){case 1:case!0:case"1":case"true":case"TRUE":return!0;default:return!1}}function utf8reada(E){for(var r="",v=0,T=0,w=0,S=0,I=0,H=0;v<E.length;){if(T=E.charCodeAt(v++),T<128){r+=String.fromCharCode(T);continue}if(w=E.charCodeAt(v++),T>191&&T<224){I=(T&31)<<6,I|=w&63,r+=String.fromCharCode(I);continue}if(S=E.charCodeAt(v++),T<240){r+=String.fromCharCode((T&15)<<12|(w&63)<<6|S&63);continue}I=E.charCodeAt(v++),H=((T&7)<<18|(w&63)<<12|(S&63)<<6|I&63)-65536,r+=String.fromCharCode(55296+(H>>>10&1023)),r+=String.fromCharCode(56320+(H&1023))}return r}function utf8readb(E){var r=new_raw_buf(2*E.length),v,T,w=1,S=0,I=0,H;for(T=0;T<E.length;T+=w)w=1,(H=E.charCodeAt(T))<128?v=H:H<224?(v=(H&31)*64+(E.charCodeAt(T+1)&63),w=2):H<240?(v=(H&15)*4096+(E.charCodeAt(T+1)&63)*64+(E.charCodeAt(T+2)&63),w=3):(w=4,v=(H&7)*262144+(E.charCodeAt(T+1)&63)*4096+(E.charCodeAt(T+2)&63)*64+(E.charCodeAt(T+3)&63),v-=65536,I=55296+(v>>>10&1023),v=56320+(v&1023)),I!==0&&(r[S++]=I&255,r[S++]=I>>>8,I=0),r[S++]=v%256,r[S++]=v>>>8;return r.slice(0,S).toString("ucs2")}function utf8readc(E){return Buffer_from(E,"binary").toString("utf8")}var utf8corpus="foo bar bazâð£",utf8read=has_buf&&(utf8readc(utf8corpus)==utf8reada(utf8corpus)&&utf8readc||utf8readb(utf8corpus)==utf8reada(utf8corpus)&&utf8readb)||utf8reada,utf8write=has_buf?function(E){return Buffer_from(E,"utf8").toString("binary")}:function(E){for(var r=[],v=0,T=0,w=0;v<E.length;)switch(T=E.charCodeAt(v++),!0){case T<128:r.push(String.fromCharCode(T));break;case T<2048:r.push(String.fromCharCode(192+(T>>6))),r.push(String.fromCharCode(128+(T&63)));break;case(T>=55296&&T<57344):T-=55296,w=E.charCodeAt(v++)-56320+(T<<10),r.push(String.fromCharCode(240+(w>>18&7))),r.push(String.fromCharCode(144+(w>>12&63))),r.push(String.fromCharCode(128+(w>>6&63))),r.push(String.fromCharCode(128+(w&63)));break;default:r.push(String.fromCharCode(224+(T>>12))),r.push(String.fromCharCode(128+(T>>6&63))),r.push(String.fromCharCode(128+(T&63)))}return r.join("")},matchtag=function(){var E={};return function(v,T){var w=v+"|"+(T||"");return E[w]?E[w]:E[w]=new RegExp("<(?:\\w+:)?"+v+'(?: xml:space="preserve")?(?:[^>]*)>([\\s\\S]*?)</(?:\\w+:)?'+v+">",T||"")}}(),htmldecode=function(){var E=[["nbsp"," "],["middot","·"],["quot",'"'],["apos","'"],["gt",">"],["lt","<"],["amp","&"]].map(function(r){return[new RegExp("&"+r[0]+";","ig"),r[1]]});return function(v){for(var T=v.replace(/^[\t\n\r ]+/,"").replace(/[\t\n\r ]+$/,"").replace(/>\s+/g,">").replace(/\s+</g,"<").replace(/[\t\n\r ]+/g," ").replace(/<\s*[bB][rR]\s*\/?>/g,`
`).replace(/<[^>]*>/g,""),w=0;w<E.length;++w)T=T.replace(E[w][0],E[w][1]);return T}}(),vtregex=function(){var E={};return function(v){return E[v]!==void 0?E[v]:E[v]=new RegExp("<(?:vt:)?"+v+">([\\s\\S]*?)</(?:vt:)?"+v+">","g")}}(),vtvregex=/<\/?(?:vt:)?variant>/g,vtmregex=/<(?:vt:)([^>]*)>([\s\S]*)</;function parseVector(E,r){var v=parsexmltag(E),T=E.match(vtregex(v.baseType))||[],w=[];if(T.length!=v.size){if(r.WTF)throw new Error("unexpected vector length "+T.length+" != "+v.size);return w}return T.forEach(function(S){var I=S.replace(vtvregex,"").match(vtmregex);I&&w.push({v:utf8read(I[2]),t:I[1]})}),w}var wtregex=/(^\s|\s$|\n)/;function wxt_helper(E){return keys(E).map(function(r){return" "+r+'="'+E[r]+'"'}).join("")}function writextag(E,r,v){return"<"+E+(v!=null?wxt_helper(v):"")+(r!=null?(r.match(wtregex)?' xml:space="preserve"':"")+">"+r+"</"+E:"/")+">"}function xlml_normalize(E){if(has_buf&&Buffer.isBuffer(E))return E.toString("utf8");if(typeof E=="string")return E;if(typeof Uint8Array<"u"&&E instanceof Uint8Array)return utf8read(a2s(ab2a(E)));throw new Error("Bad input format: expected Buffer or string")}var xlmlregex=/<(\/?)([^\s?><!\/:]*:|)([^\s?<>:\/]+)(?:[\s?:\/][^>]*)?>/mg,XMLNS={CT:"http://schemas.openxmlformats.org/package/2006/content-types"},XMLNS_main=["http://schemas.openxmlformats.org/spreadsheetml/2006/main","http://purl.oclc.org/ooxml/spreadsheetml/main","http://schemas.microsoft.com/office/excel/2006/main","http://schemas.microsoft.com/office/excel/2006/2"];function read_double_le(E,r){for(var v=1-2*(E[r+7]>>>7),T=((E[r+7]&127)<<4)+(E[r+6]>>>4&15),w=E[r+6]&15,S=5;S>=0;--S)w=w*256+E[r+S];return T==2047?w==0?v*(1/0):NaN:(T==0?T=-1022:(T-=1023,w+=Math.pow(2,52)),v*Math.pow(2,T-52)*w)}function write_double_le(E,r,v){var T=(r<0||1/r==-1/0?1:0)<<7,w=0,S=0,I=T?-r:r;isFinite(I)?I==0?w=S=0:(w=Math.floor(Math.log(I)/Math.LN2),S=I*Math.pow(2,52-w),w<=-1023&&(!isFinite(S)||S<Math.pow(2,52))?w=-1022:(S-=Math.pow(2,52),w+=1023)):(w=2047,S=isNaN(r)?26985:0);for(var H=0;H<=5;++H,S/=256)E[v+H]=S&255;E[v+6]=(w&15)<<4|S&15,E[v+7]=w>>4|T}var ___toBuffer=function(E){for(var r=[],v=10240,T=0;T<E[0].length;++T)if(E[0][T])for(var w=0,S=E[0][T].length;w<S;w+=v)r.push.apply(r,E[0][T].slice(w,w+v));return r},__toBuffer=has_buf?function(E){return E[0].length>0&&Buffer.isBuffer(E[0][0])?Buffer.concat(E[0].map(function(r){return Buffer.isBuffer(r)?r:Buffer_from(r)})):___toBuffer(E)}:___toBuffer,___utf16le=function(E,r,v){for(var T=[],w=r;w<v;w+=2)T.push(String.fromCharCode(__readUInt16LE(E,w)));return T.join("").replace(chr0,"")},__utf16le=has_buf?function(E,r,v){return Buffer.isBuffer(E)?E.toString("utf16le",r,v).replace(chr0,""):___utf16le(E,r,v)}:___utf16le,___hexlify=function(E,r,v){for(var T=[],w=r;w<r+v;++w)T.push(("0"+E[w].toString(16)).slice(-2));return T.join("")},__hexlify=has_buf?function(E,r,v){return Buffer.isBuffer(E)?E.toString("hex",r,r+v):___hexlify(E,r,v)}:___hexlify,___utf8=function(E,r,v){for(var T=[],w=r;w<v;w++)T.push(String.fromCharCode(__readUInt8(E,w)));return T.join("")},__utf8=has_buf?function E(r,v,T){return Buffer.isBuffer(r)?r.toString("utf8",v,T):___utf8(r,v,T)}:___utf8,___lpstr=function(E,r){var v=__readUInt32LE(E,r);return v>0?__utf8(E,r+4,r+4+v-1):""},__lpstr=___lpstr,___cpstr=function(E,r){var v=__readUInt32LE(E,r);return v>0?__utf8(E,r+4,r+4+v-1):""},__cpstr=___cpstr,___lpwstr=function(E,r){var v=2*__readUInt32LE(E,r);return v>0?__utf8(E,r+4,r+4+v-1):""},__lpwstr=___lpwstr,___lpp4=function E(r,v){var T=__readUInt32LE(r,v);return T>0?__utf16le(r,v+4,v+4+T):""},__lpp4=___lpp4,___8lpp4=function(E,r){var v=__readUInt32LE(E,r);return v>0?__utf8(E,r+4,r+4+v):""},__8lpp4=___8lpp4,___double=function(E,r){return read_double_le(E,r)},__double=___double,is_buf=function E(r){return Array.isArray(r)||typeof Uint8Array<"u"&&r instanceof Uint8Array};has_buf&&(__lpstr=function(r,v){if(!Buffer.isBuffer(r))return ___lpstr(r,v);var T=r.readUInt32LE(v);return T>0?r.toString("utf8",v+4,v+4+T-1):""},__cpstr=function(r,v){if(!Buffer.isBuffer(r))return ___cpstr(r,v);var T=r.readUInt32LE(v);return T>0?r.toString("utf8",v+4,v+4+T-1):""},__lpwstr=function(r,v){if(!Buffer.isBuffer(r))return ___lpwstr(r,v);var T=2*r.readUInt32LE(v);return r.toString("utf16le",v+4,v+4+T-1)},__lpp4=function(r,v){if(!Buffer.isBuffer(r))return ___lpp4(r,v);var T=r.readUInt32LE(v);return r.toString("utf16le",v+4,v+4+T)},__8lpp4=function(r,v){if(!Buffer.isBuffer(r))return ___8lpp4(r,v);var T=r.readUInt32LE(v);return r.toString("utf8",v+4,v+4+T)},__double=function(r,v){return Buffer.isBuffer(r)?r.readDoubleLE(v):___double(r,v)},is_buf=function(r){return Buffer.isBuffer(r)||Array.isArray(r)||typeof Uint8Array<"u"&&r instanceof Uint8Array});var __readUInt8=function(E,r){return E[r]},__readUInt16LE=function(E,r){return E[r+1]*256+E[r]},__readInt16LE=function(E,r){var v=E[r+1]*256+E[r];return v<32768?v:(65535-v+1)*-1},__readUInt32LE=function(E,r){return E[r+3]*(1<<24)+(E[r+2]<<16)+(E[r+1]<<8)+E[r]},__readInt32LE=function(E,r){return E[r+3]<<24|E[r+2]<<16|E[r+1]<<8|E[r]},__readInt32BE=function(E,r){return E[r]<<24|E[r+1]<<16|E[r+2]<<8|E[r+3]};function ReadShift(E,r){var v="",T,w,S=[],I,H,te,ae;switch(r){case"dbcs":if(ae=this.l,has_buf&&Buffer.isBuffer(this))v=this.slice(this.l,this.l+2*E).toString("utf16le");else for(te=0;te<E;++te)v+=String.fromCharCode(__readUInt16LE(this,ae)),ae+=2;E*=2;break;case"utf8":v=__utf8(this,this.l,this.l+E);break;case"utf16le":E*=2,v=__utf16le(this,this.l,this.l+E);break;case"wstr":return ReadShift.call(this,E,"dbcs");case"lpstr-ansi":v=__lpstr(this,this.l),E=4+__readUInt32LE(this,this.l);break;case"lpstr-cp":v=__cpstr(this,this.l),E=4+__readUInt32LE(this,this.l);break;case"lpwstr":v=__lpwstr(this,this.l),E=4+2*__readUInt32LE(this,this.l);break;case"lpp4":E=4+__readUInt32LE(this,this.l),v=__lpp4(this,this.l),E&2&&(E+=2);break;case"8lpp4":E=4+__readUInt32LE(this,this.l),v=__8lpp4(this,this.l),E&3&&(E+=4-(E&3));break;case"cstr":for(E=0,v="";(I=__readUInt8(this,this.l+E++))!==0;)S.push(_getchar(I));v=S.join("");break;case"_wstr":for(E=0,v="";(I=__readUInt16LE(this,this.l+E))!==0;)S.push(_getchar(I)),E+=2;E+=2,v=S.join("");break;case"dbcs-cont":for(v="",ae=this.l,te=0;te<E;++te){if(this.lens&&this.lens.indexOf(ae)!==-1)return I=__readUInt8(this,ae),this.l=ae+1,H=ReadShift.call(this,E-te,I?"dbcs-cont":"sbcs-cont"),S.join("")+H;S.push(_getchar(__readUInt16LE(this,ae))),ae+=2}v=S.join(""),E*=2;break;case"cpstr":case"sbcs-cont":for(v="",ae=this.l,te=0;te!=E;++te){if(this.lens&&this.lens.indexOf(ae)!==-1)return I=__readUInt8(this,ae),this.l=ae+1,H=ReadShift.call(this,E-te,I?"dbcs-cont":"sbcs-cont"),S.join("")+H;S.push(_getchar(__readUInt8(this,ae))),ae+=1}v=S.join("");break;default:switch(E){case 1:return T=__readUInt8(this,this.l),this.l++,T;case 2:return T=(r==="i"?__readInt16LE:__readUInt16LE)(this,this.l),this.l+=2,T;case 4:case-4:return r==="i"||!(this[this.l+3]&128)?(T=(E>0?__readInt32LE:__readInt32BE)(this,this.l),this.l+=4,T):(w=__readUInt32LE(this,this.l),this.l+=4,w);case 8:case-8:if(r==="f")return E==8?w=__double(this,this.l):w=__double([this[this.l+7],this[this.l+6],this[this.l+5],this[this.l+4],this[this.l+3],this[this.l+2],this[this.l+1],this[this.l+0]],0),this.l+=8,w;E=8;case 16:v=__hexlify(this,this.l,E);break}}return this.l+=E,v}var __writeUInt32LE=function(E,r,v){E[v]=r&255,E[v+1]=r>>>8&255,E[v+2]=r>>>16&255,E[v+3]=r>>>24&255},__writeInt32LE=function(E,r,v){E[v]=r&255,E[v+1]=r>>8&255,E[v+2]=r>>16&255,E[v+3]=r>>24&255},__writeUInt16LE=function(E,r,v){E[v]=r&255,E[v+1]=r>>>8&255};function WriteShift(E,r,v){var T=0,w=0;if(v==="dbcs"){for(w=0;w!=r.length;++w)__writeUInt16LE(this,r.charCodeAt(w),this.l+2*w);T=2*r.length}else if(v==="sbcs"){for(r=r.replace(/[^\x00-\x7F]/g,"_"),w=0;w!=r.length;++w)this[this.l+w]=r.charCodeAt(w)&255;T=r.length}else if(v==="hex"){for(;w<E;++w)this[this.l++]=parseInt(r.slice(2*w,2*w+2),16)||0;return this}else if(v==="utf16le"){var S=Math.min(this.l+E,this.length);for(w=0;w<Math.min(r.length,E);++w){var I=r.charCodeAt(w);this[this.l++]=I&255,this[this.l++]=I>>8}for(;this.l<S;)this[this.l++]=0;return this}else switch(E){case 1:T=1,this[this.l]=r&255;break;case 2:T=2,this[this.l]=r&255,r>>>=8,this[this.l+1]=r&255;break;case 3:T=3,this[this.l]=r&255,r>>>=8,this[this.l+1]=r&255,r>>>=8,this[this.l+2]=r&255;break;case 4:T=4,__writeUInt32LE(this,r,this.l);break;case 8:if(T=8,v==="f"){write_double_le(this,r,this.l);break}case 16:break;case-4:T=4,__writeInt32LE(this,r,this.l);break}return this.l+=T,this}function CheckField(E,r){var v=__hexlify(this,this.l,E.length>>1);if(v!==E)throw new Error(r+"Expected "+E+" saw "+v);this.l+=E.length>>1}function prep_blob(E,r){E.l=r,E.read_shift=ReadShift,E.chk=CheckField,E.write_shift=WriteShift}function parsenoop(E,r){E.l+=r}function new_buf(E){var r=new_raw_buf(E);return prep_blob(r,0),r}function recordhopper(E,r,v){if(E){var T,w,S;prep_blob(E,E.l||0);for(var I=E.length,H=0,te=0;E.l<I;){H=E.read_shift(1),H&128&&(H=(H&127)+((E.read_shift(1)&127)<<7));var ae=XLSBRecordEnum[H]||XLSBRecordEnum[65535];for(T=E.read_shift(1),S=T&127,w=1;w<4&&T&128;++w)S+=((T=E.read_shift(1))&127)<<7*w;te=E.l+S;var ie=ae.f&&ae.f(E,S,v);if(E.l=te,r(ie,ae,H))return}}}function buf_array(){var E=[],r=has_buf?256:2048,v=function(ae){var ie=new_buf(ae);return prep_blob(ie,0),ie},T=v(r),w=function(){T&&(T.length>T.l&&(T=T.slice(0,T.l),T.l=T.length),T.length>0&&E.push(T),T=null)},S=function(ae){return T&&ae<T.length-T.l?T:(w(),T=v(Math.max(ae+1,r)))},I=function(){return w(),bconcat(E)},H=function(ae){w(),T=ae,T.l==null&&(T.l=T.length),S(r)};return{next:S,push:H,end:I,_bufs:E}}function shift_cell_xls(E,r,v){var T=dup(E);if(r.s?(T.cRel&&(T.c+=r.s.c),T.rRel&&(T.r+=r.s.r)):(T.cRel&&(T.c+=r.c),T.rRel&&(T.r+=r.r)),!v||v.biff<12){for(;T.c>=256;)T.c-=256;for(;T.r>=65536;)T.r-=65536}return T}function shift_range_xls(E,r,v){var T=dup(E);return T.s=shift_cell_xls(T.s,r.s,v),T.e=shift_cell_xls(T.e,r.s,v),T}function encode_cell_xls(E,r){if(E.cRel&&E.c<0)for(E=dup(E);E.c<0;)E.c+=r>8?16384:256;if(E.rRel&&E.r<0)for(E=dup(E);E.r<0;)E.r+=r>8?1048576:r>5?65536:16384;var v=encode_cell(E);return!E.cRel&&E.cRel!=null&&(v=fix_col(v)),!E.rRel&&E.rRel!=null&&(v=fix_row(v)),v}function encode_range_xls(E,r){return E.s.r==0&&!E.s.rRel&&E.e.r==(r.biff>=12?1048575:r.biff>=8?65536:16384)&&!E.e.rRel?(E.s.cRel?"":"$")+encode_col(E.s.c)+":"+(E.e.cRel?"":"$")+encode_col(E.e.c):E.s.c==0&&!E.s.cRel&&E.e.c==(r.biff>=12?16383:255)&&!E.e.cRel?(E.s.rRel?"":"$")+encode_row(E.s.r)+":"+(E.e.rRel?"":"$")+encode_row(E.e.r):encode_cell_xls(E.s,r.biff)+":"+encode_cell_xls(E.e,r.biff)}function decode_row(E){return parseInt(unfix_row(E),10)-1}function encode_row(E){return""+(E+1)}function fix_row(E){return E.replace(/([A-Z]|^)(\d+)$/,"$1$$$2")}function unfix_row(E){return E.replace(/\$(\d+)$/,"$1")}function decode_col(E){for(var r=unfix_col(E),v=0,T=0;T!==r.length;++T)v=26*v+r.charCodeAt(T)-64;return v-1}function encode_col(E){if(E<0)throw new Error("invalid column "+E);var r="";for(++E;E;E=Math.floor((E-1)/26))r=String.fromCharCode((E-1)%26+65)+r;return r}function fix_col(E){return E.replace(/^([A-Z])/,"$$$1")}function unfix_col(E){return E.replace(/^\$([A-Z])/,"$1")}function split_cell(E){return E.replace(/(\$?[A-Z]*)(\$?\d*)/,"$1,$2").split(",")}function decode_cell(E){for(var r=0,v=0,T=0;T<E.length;++T){var w=E.charCodeAt(T);w>=48&&w<=57?r=10*r+(w-48):w>=65&&w<=90&&(v=26*v+(w-64))}return{c:v-1,r:r-1}}function encode_cell(E){for(var r=E.c+1,v="";r;r=(r-1)/26|0)v=String.fromCharCode((r-1)%26+65)+v;return v+(E.r+1)}function decode_range(E){var r=E.indexOf(":");return r==-1?{s:decode_cell(E),e:decode_cell(E)}:{s:decode_cell(E.slice(0,r)),e:decode_cell(E.slice(r+1))}}function encode_range(E,r){return typeof r>"u"||typeof r=="number"?encode_range(E.s,E.e):(typeof E!="string"&&(E=encode_cell(E)),typeof r!="string"&&(r=encode_cell(r)),E==r?E:E+":"+r)}function safe_decode_range(E){var r={s:{c:0,r:0},e:{c:0,r:0}},v=0,T=0,w=0,S=E.length;for(v=0;T<S&&!((w=E.charCodeAt(T)-64)<1||w>26);++T)v=26*v+w;for(r.s.c=--v,v=0;T<S&&!((w=E.charCodeAt(T)-48)<0||w>9);++T)v=10*v+w;if(r.s.r=--v,T===S||w!=10)return r.e.c=r.s.c,r.e.r=r.s.r,r;for(++T,v=0;T!=S&&!((w=E.charCodeAt(T)-64)<1||w>26);++T)v=26*v+w;for(r.e.c=--v,v=0;T!=S&&!((w=E.charCodeAt(T)-48)<0||w>9);++T)v=10*v+w;return r.e.r=--v,r}function safe_format_cell(E,r){var v=E.t=="d"&&r instanceof Date;if(E.z!=null)try{return E.w=SSF_format(E.z,v?datenum(r):r)}catch{}try{return E.w=SSF_format((E.XF||{}).numFmtId||(v?14:0),v?datenum(r):r)}catch{return""+r}}function format_cell(E,r,v){return E==null||E.t==null||E.t=="z"?"":E.w!==void 0?E.w:(E.t=="d"&&!E.z&&v&&v.dateNF&&(E.z=v.dateNF),E.t=="e"?BErr[E.v]||E.v:r==null?safe_format_cell(E,E.v):safe_format_cell(E,r))}function sheet_to_workbook(E,r){var v=r&&r.sheet?r.sheet:"Sheet1",T={};return T[v]=E,{SheetNames:[v],Sheets:T}}function sheet_add_aoa(E,r,v){var T=v||{},w=E?Array.isArray(E):T.dense,S=E||(w?[]:{}),I=0,H=0;if(S&&T.origin!=null){if(typeof T.origin=="number")I=T.origin;else{var te=typeof T.origin=="string"?decode_cell(T.origin):T.origin;I=te.r,H=te.c}S["!ref"]||(S["!ref"]="A1:A1")}var ae={s:{c:1e7,r:1e7},e:{c:0,r:0}};if(S["!ref"]){var ie=safe_decode_range(S["!ref"]);ae.s.c=ie.s.c,ae.s.r=ie.s.r,ae.e.c=Math.max(ae.e.c,ie.e.c),ae.e.r=Math.max(ae.e.r,ie.e.r),I==-1&&(ae.e.r=I=ie.e.r+1)}for(var ce=0;ce!=r.length;++ce)if(r[ce]){if(!Array.isArray(r[ce]))throw new Error("aoa_to_sheet expects an array of arrays");for(var me=0;me!=r[ce].length;++me)if(!(typeof r[ce][me]>"u")){var _e={v:r[ce][me]},Re=I+ce,Pe=H+me;if(ae.s.r>Re&&(ae.s.r=Re),ae.s.c>Pe&&(ae.s.c=Pe),ae.e.r<Re&&(ae.e.r=Re),ae.e.c<Pe&&(ae.e.c=Pe),r[ce][me]&&typeof r[ce][me]=="object"&&!Array.isArray(r[ce][me])&&!(r[ce][me]instanceof Date))_e=r[ce][me];else if(Array.isArray(_e.v)&&(_e.f=r[ce][me][1],_e.v=_e.v[0]),_e.v===null)if(_e.f)_e.t="n";else if(T.nullError)_e.t="e",_e.v=0;else if(T.sheetStubs)_e.t="z";else continue;else typeof _e.v=="number"?_e.t="n":typeof _e.v=="boolean"?_e.t="b":_e.v instanceof Date?(_e.z=T.dateNF||table_fmt[14],T.cellDates?(_e.t="d",_e.w=SSF_format(_e.z,datenum(_e.v))):(_e.t="n",_e.v=datenum(_e.v),_e.w=SSF_format(_e.z,_e.v))):_e.t="s";if(w)S[Re]||(S[Re]=[]),S[Re][Pe]&&S[Re][Pe].z&&(_e.z=S[Re][Pe].z),S[Re][Pe]=_e;else{var Ce=encode_cell({c:Pe,r:Re});S[Ce]&&S[Ce].z&&(_e.z=S[Ce].z),S[Ce]=_e}}}return ae.s.c<1e7&&(S["!ref"]=encode_range(ae)),S}function aoa_to_sheet(E,r){return sheet_add_aoa(null,E,r)}function parse_Int32LE(E){return E.read_shift(4,"i")}function parse_XLWideString(E){var r=E.read_shift(4);return r===0?"":E.read_shift(r,"dbcs")}function parse_StrRun(E){return{ich:E.read_shift(2),ifnt:E.read_shift(2)}}function parse_RichStr(E,r){var v=E.l,T=E.read_shift(1),w=parse_XLWideString(E),S=[],I={t:w,h:w};if(T&1){for(var H=E.read_shift(4),te=0;te!=H;++te)S.push(parse_StrRun(E));I.r=S}else I.r=[{ich:0,ifnt:0}];return E.l=v+r,I}var parse_BrtCommentText=parse_RichStr;function parse_XLSBCell(E){var r=E.read_shift(4),v=E.read_shift(2);return v+=E.read_shift(1)<<16,E.l++,{c:r,iStyleRef:v}}function parse_XLSBShortCell(E){var r=E.read_shift(2);return r+=E.read_shift(1)<<16,E.l++,{c:-1,iStyleRef:r}}var parse_XLSBCodeName=parse_XLWideString;function parse_XLNullableWideString(E){var r=E.read_shift(4);return r===0||r===4294967295?"":E.read_shift(r,"dbcs")}var parse_XLNameWideString=parse_XLWideString,parse_RelID=parse_XLNullableWideString;function parse_RkNumber(E){var r=E.slice(E.l,E.l+4),v=r[0]&1,T=r[0]&2;E.l+=4;var w=T===0?__double([0,0,0,0,r[0]&252,r[1],r[2],r[3]],0):__readInt32LE(r,0)>>2;return v?w/100:w}function parse_RfX(E){var r={s:{},e:{}};return r.s.r=E.read_shift(4),r.e.r=E.read_shift(4),r.s.c=E.read_shift(4),r.e.c=E.read_shift(4),r}var parse_UncheckedRfX=parse_RfX;function parse_Xnum(E){if(E.length-E.l<8)throw"XLS Xnum Buffer underflow";return E.read_shift(8,"f")}function parse_BrtColor(E){var r={},v=E.read_shift(1),T=v>>>1,w=E.read_shift(1),S=E.read_shift(2,"i"),I=E.read_shift(1),H=E.read_shift(1),te=E.read_shift(1);switch(E.l++,T){case 0:r.auto=1;break;case 1:r.index=w;var ae=XLSIcv[w];ae&&(r.rgb=rgb2Hex(ae));break;case 2:r.rgb=rgb2Hex([I,H,te]);break;case 3:r.theme=w;break}return S!=0&&(r.tint=S>0?S/32767:S/32768),r}function parse_FontFlags(E){var r=E.read_shift(1);E.l++;var v={fBold:r&1,fItalic:r&2,fUnderline:r&4,fStrikeout:r&8,fOutline:r&16,fShadow:r&32,fCondense:r&64,fExtend:r&128};return v}function parse_ClipboardFormatOrString(E,r){var v={2:"BITMAP",3:"METAFILEPICT",8:"DIB",14:"ENHMETAFILE"},T=E.read_shift(4);switch(T){case 0:return"";case 4294967295:case 4294967294:return v[E.read_shift(4)]||""}if(T>400)throw new Error("Unsupported Clipboard: "+T.toString(16));return E.l-=4,E.read_shift(0,r==1?"lpstr":"lpwstr")}function parse_ClipboardFormatOrAnsiString(E){return parse_ClipboardFormatOrString(E,1)}function parse_ClipboardFormatOrUnicodeString(E){return parse_ClipboardFormatOrString(E,2)}var VT_I2=2,VT_I4=3,VT_BOOL=11,VT_VARIANT=12,VT_UI4=19,VT_FILETIME=64,VT_BLOB=65,VT_CF=71,VT_VECTOR_VARIANT=4108,VT_VECTOR_LPSTR=4126,VT_STRING=80,VT_USTR=81,VT_CUSTOM=[VT_STRING,VT_USTR],DocSummaryPIDDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Category",t:VT_STRING},3:{n:"PresentationFormat",t:VT_STRING},4:{n:"ByteCount",t:VT_I4},5:{n:"LineCount",t:VT_I4},6:{n:"ParagraphCount",t:VT_I4},7:{n:"SlideCount",t:VT_I4},8:{n:"NoteCount",t:VT_I4},9:{n:"HiddenCount",t:VT_I4},10:{n:"MultimediaClipCount",t:VT_I4},11:{n:"ScaleCrop",t:VT_BOOL},12:{n:"HeadingPairs",t:VT_VECTOR_VARIANT},13:{n:"TitlesOfParts",t:VT_VECTOR_LPSTR},14:{n:"Manager",t:VT_STRING},15:{n:"Company",t:VT_STRING},16:{n:"LinksUpToDate",t:VT_BOOL},17:{n:"CharacterCount",t:VT_I4},19:{n:"SharedDoc",t:VT_BOOL},22:{n:"HyperlinksChanged",t:VT_BOOL},23:{n:"AppVersion",t:VT_I4,p:"version"},24:{n:"DigSig",t:VT_BLOB},26:{n:"ContentType",t:VT_STRING},27:{n:"ContentStatus",t:VT_STRING},28:{n:"Language",t:VT_STRING},29:{n:"Version",t:VT_STRING},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}},SummaryPIDSI={1:{n:"CodePage",t:VT_I2},2:{n:"Title",t:VT_STRING},3:{n:"Subject",t:VT_STRING},4:{n:"Author",t:VT_STRING},5:{n:"Keywords",t:VT_STRING},6:{n:"Comments",t:VT_STRING},7:{n:"Template",t:VT_STRING},8:{n:"LastAuthor",t:VT_STRING},9:{n:"RevNumber",t:VT_STRING},10:{n:"EditTime",t:VT_FILETIME},11:{n:"LastPrinted",t:VT_FILETIME},12:{n:"CreatedDate",t:VT_FILETIME},13:{n:"ModifiedDate",t:VT_FILETIME},14:{n:"PageCount",t:VT_I4},15:{n:"WordCount",t:VT_I4},16:{n:"CharCount",t:VT_I4},17:{n:"Thumbnail",t:VT_CF},18:{n:"Application",t:VT_STRING},19:{n:"DocSecurity",t:VT_I4},255:{},2147483648:{n:"Locale",t:VT_UI4},2147483651:{n:"Behavior",t:VT_UI4},1919054434:{}},CountryEnum={1:"US",2:"CA",3:"",7:"RU",20:"EG",30:"GR",31:"NL",32:"BE",33:"FR",34:"ES",36:"HU",39:"IT",41:"CH",43:"AT",44:"GB",45:"DK",46:"SE",47:"NO",48:"PL",49:"DE",52:"MX",55:"BR",61:"AU",64:"NZ",66:"TH",81:"JP",82:"KR",84:"VN",86:"CN",90:"TR",105:"JS",213:"DZ",216:"MA",218:"LY",351:"PT",354:"IS",358:"FI",420:"CZ",886:"TW",961:"LB",962:"JO",963:"SY",964:"IQ",965:"KW",966:"SA",971:"AE",972:"IL",974:"QA",981:"IR",65535:"US"},XLSFillPattern=[null,"solid","mediumGray","darkGray","lightGray","darkHorizontal","darkVertical","darkDown","darkUp","darkGrid","darkTrellis","lightHorizontal","lightVertical","lightDown","lightUp","lightGrid","lightTrellis","gray125","gray0625"];function rgbify(E){return E.map(function(r){return[r>>16&255,r>>8&255,r&255]})}var _XLSIcv=rgbify([0,16777215,16711680,65280,255,16776960,16711935,65535,0,16777215,16711680,65280,255,16776960,16711935,65535,8388608,32768,128,8421376,8388736,32896,12632256,8421504,10066431,10040166,16777164,13434879,6684774,16744576,26316,13421823,128,16711935,16776960,65535,8388736,8388608,32896,255,52479,13434879,13434828,16777113,10079487,16751052,13408767,16764057,3368703,3394764,10079232,16763904,16750848,16737792,6710937,9868950,13158,3381606,13056,3355392,10040064,10040166,3355545,3355443,16777215,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),XLSIcv=dup(_XLSIcv),BErr={0:"#NULL!",7:"#DIV/0!",15:"#VALUE!",23:"#REF!",29:"#NAME?",36:"#NUM!",42:"#N/A",43:"#GETTING_DATA",255:"#WTF?"},RBErr={"#NULL!":0,"#DIV/0!":7,"#VALUE!":15,"#REF!":23,"#NAME?":29,"#NUM!":36,"#N/A":42,"#GETTING_DATA":43,"#WTF?":255},ct2type={"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml":"workbooks","application/vnd.ms-excel.sheet.macroEnabled.main+xml":"workbooks","application/vnd.ms-excel.sheet.binary.macroEnabled.main":"workbooks","application/vnd.ms-excel.addin.macroEnabled.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.template.main+xml":"workbooks","application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml":"sheets","application/vnd.ms-excel.worksheet":"sheets","application/vnd.ms-excel.binIndexWs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.chartsheet+xml":"charts","application/vnd.ms-excel.chartsheet":"charts","application/vnd.ms-excel.macrosheet+xml":"macros","application/vnd.ms-excel.macrosheet":"macros","application/vnd.ms-excel.intlmacrosheet":"TODO","application/vnd.ms-excel.binIndexMs":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.dialogsheet+xml":"dialogs","application/vnd.ms-excel.dialogsheet":"dialogs","application/vnd.openxmlformats-officedocument.spreadsheetml.sharedStrings+xml":"strs","application/vnd.ms-excel.sharedStrings":"strs","application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml":"styles","application/vnd.ms-excel.styles":"styles","application/vnd.openxmlformats-package.core-properties+xml":"coreprops","application/vnd.openxmlformats-officedocument.custom-properties+xml":"custprops","application/vnd.openxmlformats-officedocument.extended-properties+xml":"extprops","application/vnd.openxmlformats-officedocument.customXmlProperties+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.customProperty":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.comments+xml":"comments","application/vnd.ms-excel.comments":"comments","application/vnd.ms-excel.threadedcomments+xml":"threadedcomments","application/vnd.ms-excel.person+xml":"people","application/vnd.openxmlformats-officedocument.spreadsheetml.sheetMetadata+xml":"metadata","application/vnd.ms-excel.sheetMetadata":"metadata","application/vnd.ms-excel.pivotTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotTable+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.chart+xml":"TODO","application/vnd.ms-office.chartcolorstyle+xml":"TODO","application/vnd.ms-office.chartstyle+xml":"TODO","application/vnd.ms-office.chartex+xml":"TODO","application/vnd.ms-excel.calcChain":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.calcChain+xml":"calcchains","application/vnd.openxmlformats-officedocument.spreadsheetml.printerSettings":"TODO","application/vnd.ms-office.activeX":"TODO","application/vnd.ms-office.activeX+xml":"TODO","application/vnd.ms-excel.attachedToolbars":"TODO","application/vnd.ms-excel.connections":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.connections+xml":"TODO","application/vnd.ms-excel.externalLink":"links","application/vnd.openxmlformats-officedocument.spreadsheetml.externalLink+xml":"links","application/vnd.ms-excel.pivotCacheDefinition":"TODO","application/vnd.ms-excel.pivotCacheRecords":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheDefinition+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.pivotCacheRecords+xml":"TODO","application/vnd.ms-excel.queryTable":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.queryTable+xml":"TODO","application/vnd.ms-excel.userNames":"TODO","application/vnd.ms-excel.revisionHeaders":"TODO","application/vnd.ms-excel.revisionLog":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionHeaders+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.revisionLog+xml":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.userNames+xml":"TODO","application/vnd.ms-excel.tableSingleCells":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.tableSingleCells+xml":"TODO","application/vnd.ms-excel.slicer":"TODO","application/vnd.ms-excel.slicerCache":"TODO","application/vnd.ms-excel.slicer+xml":"TODO","application/vnd.ms-excel.slicerCache+xml":"TODO","application/vnd.ms-excel.wsSortMap":"TODO","application/vnd.ms-excel.table":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.table+xml":"TODO","application/vnd.openxmlformats-officedocument.theme+xml":"themes","application/vnd.openxmlformats-officedocument.themeOverride+xml":"TODO","application/vnd.ms-excel.Timeline+xml":"TODO","application/vnd.ms-excel.TimelineCache+xml":"TODO","application/vnd.ms-office.vbaProject":"vba","application/vnd.ms-office.vbaProjectSignature":"TODO","application/vnd.ms-office.volatileDependencies":"TODO","application/vnd.openxmlformats-officedocument.spreadsheetml.volatileDependencies+xml":"TODO","application/vnd.ms-excel.controlproperties+xml":"TODO","application/vnd.openxmlformats-officedocument.model+data":"TODO","application/vnd.ms-excel.Survey+xml":"TODO","application/vnd.openxmlformats-officedocument.drawing+xml":"drawings","application/vnd.openxmlformats-officedocument.drawingml.chartshapes+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramColors+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramData+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramLayout+xml":"TODO","application/vnd.openxmlformats-officedocument.drawingml.diagramStyle+xml":"TODO","application/vnd.openxmlformats-officedocument.vmlDrawing":"TODO","application/vnd.openxmlformats-package.relationships+xml":"rels","application/vnd.openxmlformats-officedocument.oleObject":"TODO","image/png":"TODO",sheet:"js"};function new_ct(){return{workbooks:[],sheets:[],charts:[],dialogs:[],macros:[],rels:[],strs:[],comments:[],threadedcomments:[],links:[],coreprops:[],extprops:[],custprops:[],themes:[],styles:[],calcchains:[],vba:[],drawings:[],metadata:[],people:[],TODO:[],xmlns:""}}function parse_ct(E){var r=new_ct();if(!E||!E.match)return r;var v={};if((E.match(tagregex)||[]).forEach(function(T){var w=parsexmltag(T);switch(w[0].replace(nsregex,"<")){case"<?xml":break;case"<Types":r.xmlns=w["xmlns"+(w[0].match(/<(\w+):/)||["",""])[1]];break;case"<Default":v[w.Extension]=w.ContentType;break;case"<Override":r[ct2type[w.ContentType]]!==void 0&&r[ct2type[w.ContentType]].push(w.PartName);break}}),r.xmlns!==XMLNS.CT)throw new Error("Unknown Namespace: "+r.xmlns);return r.calcchain=r.calcchains.length>0?r.calcchains[0]:"",r.sst=r.strs.length>0?r.strs[0]:"",r.style=r.styles.length>0?r.styles[0]:"",r.defaults=v,delete r.calcchains,r}var RELS={WB:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument",SHEET:"http://sheetjs.openxmlformats.org/officeDocument/2006/relationships/officeDocument",HLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/hyperlink",VML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/vmlDrawing",XPATH:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLinkPath",XMISS:"http://schemas.microsoft.com/office/2006/relationships/xlExternalLinkPath/xlPathMissing",XLINK:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/externalLink",CXML:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXml",CXMLP:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/customXmlProps",CMNT:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/comments",CORE_PROPS:"http://schemas.openxmlformats.org/package/2006/relationships/metadata/core-properties",EXT_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/extended-properties",CUST_PROPS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/custom-properties",SST:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sharedStrings",STY:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles",THEME:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/theme",CHART:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chart",CHARTEX:"http://schemas.microsoft.com/office/2014/relationships/chartEx",CS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/chartsheet",WS:["http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet","http://purl.oclc.org/ooxml/officeDocument/relationships/worksheet"],DS:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/dialogsheet",MS:"http://schemas.microsoft.com/office/2006/relationships/xlMacrosheet",IMG:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/image",DRAW:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing",XLMETA:"http://schemas.openxmlformats.org/officeDocument/2006/relationships/sheetMetadata",TCMNT:"http://schemas.microsoft.com/office/2017/10/relationships/threadedComment",PEOPLE:"http://schemas.microsoft.com/office/2017/10/relationships/person",VBA:"http://schemas.microsoft.com/office/2006/relationships/vbaProject"};function get_rels_path(E){var r=E.lastIndexOf("/");return E.slice(0,r+1)+"_rels/"+E.slice(r+1)+".rels"}function parse_rels(E,r){var v={"!id":{}};if(!E)return v;r.charAt(0)!=="/"&&(r="/"+r);var T={};return(E.match(tagregex)||[]).forEach(function(w){var S=parsexmltag(w);if(S[0]==="<Relationship"){var I={};I.Type=S.Type,I.Target=S.Target,I.Id=S.Id,S.TargetMode&&(I.TargetMode=S.TargetMode);var H=S.TargetMode==="External"?S.Target:resolve_path(S.Target,r);v[H]=I,T[S.Id]=I}}),v["!id"]=T,v}var CT_ODS="application/vnd.oasis.opendocument.spreadsheet";function parse_manifest(E,r){for(var v=xlml_normalize(E),T,w;T=xlmlregex.exec(v);)switch(T[3]){case"manifest":break;case"file-entry":if(w=parsexmltag(T[0],!1),w.path=="/"&&w.type!==CT_ODS)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:if(r&&r.WTF)throw T}}var CORE_PROPS=[["cp:category","Category"],["cp:contentStatus","ContentStatus"],["cp:keywords","Keywords"],["cp:lastModifiedBy","LastAuthor"],["cp:lastPrinted","LastPrinted"],["cp:revision","RevNumber"],["cp:version","Version"],["dc:creator","Author"],["dc:description","Comments"],["dc:identifier","Identifier"],["dc:language","Language"],["dc:subject","Subject"],["dc:title","Title"],["dcterms:created","CreatedDate","date"],["dcterms:modified","ModifiedDate","date"]],CORE_PROPS_REGEX=function(){for(var E=new Array(CORE_PROPS.length),r=0;r<CORE_PROPS.length;++r){var v=CORE_PROPS[r],T="(?:"+v[0].slice(0,v[0].indexOf(":"))+":)"+v[0].slice(v[0].indexOf(":")+1);E[r]=new RegExp("<"+T+"[^>]*>([\\s\\S]*?)</"+T+">")}return E}();function parse_core_props(E){var r={};E=utf8read(E);for(var v=0;v<CORE_PROPS.length;++v){var T=CORE_PROPS[v],w=E.match(CORE_PROPS_REGEX[v]);w!=null&&w.length>0&&(r[T[1]]=unescapexml(w[1])),T[2]==="date"&&r[T[1]]&&(r[T[1]]=parseDate(r[T[1]]))}return r}var EXT_PROPS=[["Application","Application","string"],["AppVersion","AppVersion","string"],["Company","Company","string"],["DocSecurity","DocSecurity","string"],["Manager","Manager","string"],["HyperlinksChanged","HyperlinksChanged","bool"],["SharedDoc","SharedDoc","bool"],["LinksUpToDate","LinksUpToDate","bool"],["ScaleCrop","ScaleCrop","bool"],["HeadingPairs","HeadingPairs","raw"],["TitlesOfParts","TitlesOfParts","raw"]];function load_props_pairs(E,r,v,T){var w=[];if(typeof E=="string")w=parseVector(E,T);else for(var S=0;S<E.length;++S)w=w.concat(E[S].map(function(ie){return{v:ie}}));var I=typeof r=="string"?parseVector(r,T).map(function(ie){return ie.v}):r,H=0,te=0;if(I.length>0)for(var ae=0;ae!==w.length;ae+=2){switch(te=+w[ae+1].v,w[ae].v){case"Worksheets":case"工作表":case"Листы":case"أوراق العمل":case"ワークシート":case"גליונות עבודה":case"Arbeitsblätter":case"Çalışma Sayfaları":case"Feuilles de calcul":case"Fogli di lavoro":case"Folhas de cálculo":case"Planilhas":case"Regneark":case"Hojas de cálculo":case"Werkbladen":v.Worksheets=te,v.SheetNames=I.slice(H,H+te);break;case"Named Ranges":case"Rangos con nombre":case"名前付き一覧":case"Benannte Bereiche":case"Navngivne områder":v.NamedRanges=te,v.DefinedNames=I.slice(H,H+te);break;case"Charts":case"Diagramme":v.Chartsheets=te,v.ChartNames=I.slice(H,H+te);break}H+=te}}function parse_ext_props(E,r,v){var T={};return r||(r={}),E=utf8read(E),EXT_PROPS.forEach(function(w){var S=(E.match(matchtag(w[0]))||[])[1];switch(w[2]){case"string":S&&(r[w[1]]=unescapexml(S));break;case"bool":r[w[1]]=S==="true";break;case"raw":var I=E.match(new RegExp("<"+w[0]+"[^>]*>([\\s\\S]*?)</"+w[0]+">"));I&&I.length>0&&(T[w[1]]=I[1]);break}}),T.HeadingPairs&&T.TitlesOfParts&&load_props_pairs(T.HeadingPairs,T.TitlesOfParts,r,v),r}var custregex=/<[^>]+>[^<]*/g;function parse_cust_props(E,r){var v={},T="",w=E.match(custregex);if(w)for(var S=0;S!=w.length;++S){var I=w[S],H=parsexmltag(I);switch(H[0]){case"<?xml":break;case"<Properties":break;case"<property":T=unescapexml(H.name);break;case"</property>":T=null;break;default:if(I.indexOf("<vt:")===0){var te=I.split(">"),ae=te[0].slice(4),ie=te[1];switch(ae){case"lpstr":case"bstr":case"lpwstr":v[T]=unescapexml(ie);break;case"bool":v[T]=parsexmlbool(ie);break;case"i1":case"i2":case"i4":case"i8":case"int":case"uint":v[T]=parseInt(ie,10);break;case"r4":case"r8":case"decimal":v[T]=parseFloat(ie);break;case"filetime":case"date":v[T]=parseDate(ie);break;case"cy":case"error":v[T]=unescapexml(ie);break;default:if(ae.slice(-1)=="/")break;r.WTF&&typeof console<"u"&&console.warn("Unexpected",I,ae,te)}}else if(I.slice(0,2)!=="</"){if(r.WTF)throw new Error(I)}}}return v}var XLMLDocPropsMap={Title:"Title",Subject:"Subject",Author:"Author",Keywords:"Keywords",Comments:"Description",LastAuthor:"LastAuthor",RevNumber:"Revision",Application:"AppName",LastPrinted:"LastPrinted",CreatedDate:"Created",ModifiedDate:"LastSaved",Category:"Category",Manager:"Manager",Company:"Company",AppVersion:"Version",ContentStatus:"ContentStatus",Identifier:"Identifier",Language:"Language"},evert_XLMLDPM;function xlml_set_prop(E,r,v){evert_XLMLDPM||(evert_XLMLDPM=evert(XLMLDocPropsMap)),r=evert_XLMLDPM[r]||r,E[r]=v}function parse_FILETIME(E){var r=E.read_shift(4),v=E.read_shift(4);return new Date((v/1e7*Math.pow(2,32)+r/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function parse_lpstr(E,r,v){var T=E.l,w=E.read_shift(0,"lpstr-cp");if(v)for(;E.l-T&3;)++E.l;return w}function parse_lpwstr(E,r,v){var T=E.read_shift(0,"lpwstr");return T}function parse_VtStringBase(E,r,v){return r===31?parse_lpwstr(E):parse_lpstr(E,r,v)}function parse_VtString(E,r,v){return parse_VtStringBase(E,r,v===!1?0:4)}function parse_VtUnalignedString(E,r){if(!r)throw new Error("VtUnalignedString must have positive length");return parse_VtStringBase(E,r,0)}function parse_VtVecLpwstrValue(E){for(var r=E.read_shift(4),v=[],T=0;T!=r;++T){var w=E.l;v[T]=E.read_shift(0,"lpwstr").replace(chr0,""),E.l-w&2&&(E.l+=2)}return v}function parse_VtVecUnalignedLpstrValue(E){for(var r=E.read_shift(4),v=[],T=0;T!=r;++T)v[T]=E.read_shift(0,"lpstr-cp").replace(chr0,"");return v}function parse_VtHeadingPair(E){var r=E.l,v=parse_TypedPropertyValue(E,VT_USTR);E[E.l]==0&&E[E.l+1]==0&&E.l-r&2&&(E.l+=2);var T=parse_TypedPropertyValue(E,VT_I4);return[v,T]}function parse_VtVecHeadingPairValue(E){for(var r=E.read_shift(4),v=[],T=0;T<r/2;++T)v.push(parse_VtHeadingPair(E));return v}function parse_dictionary(E,r){for(var v=E.read_shift(4),T={},w=0;w!=v;++w){var S=E.read_shift(4),I=E.read_shift(4);T[S]=E.read_shift(I,r===1200?"utf16le":"utf8").replace(chr0,"").replace(chr1,"!"),r===1200&&I%2&&(E.l+=2)}return E.l&3&&(E.l=E.l>>3<<2),T}function parse_BLOB(E){var r=E.read_shift(4),v=E.slice(E.l,E.l+r);return E.l+=r,(r&3)>0&&(E.l+=4-(r&3)&3),v}function parse_ClipboardData(E){var r={};return r.Size=E.read_shift(4),E.l+=r.Size+3-(r.Size-1)%4,r}function parse_TypedPropertyValue(E,r,v){var T=E.read_shift(2),w,S=v||{};if(E.l+=2,r!==VT_VARIANT&&T!==r&&VT_CUSTOM.indexOf(r)===-1&&!((r&65534)==4126&&(T&65534)==4126))throw new Error("Expected type "+r+" saw "+T);switch(r===VT_VARIANT?T:r){case 2:return w=E.read_shift(2,"i"),S.raw||(E.l+=2),w;case 3:return w=E.read_shift(4,"i"),w;case 11:return E.read_shift(4)!==0;case 19:return w=E.read_shift(4),w;case 30:return parse_lpstr(E,T,4).replace(chr0,"");case 31:return parse_lpwstr(E);case 64:return parse_FILETIME(E);case 65:return parse_BLOB(E);case 71:return parse_ClipboardData(E);case 80:return parse_VtString(E,T,!S.raw).replace(chr0,"");case 81:return parse_VtUnalignedString(E,T).replace(chr0,"");case 4108:return parse_VtVecHeadingPairValue(E);case 4126:case 4127:return T==4127?parse_VtVecLpwstrValue(E):parse_VtVecUnalignedLpstrValue(E);default:throw new Error("TypedPropertyValue unrecognized type "+r+" "+T)}}function parse_PropertySet(E,r){var v=E.l,T=E.read_shift(4),w=E.read_shift(4),S=[],I=0,H=0,te=-1,ae={};for(I=0;I!=w;++I){var ie=E.read_shift(4),ce=E.read_shift(4);S[I]=[ie,ce+v]}S.sort(function(Me,Ve){return Me[1]-Ve[1]});var me={};for(I=0;I!=w;++I){if(E.l!==S[I][1]){var _e=!0;if(I>0&&r)switch(r[S[I-1][0]].t){case 2:E.l+2===S[I][1]&&(E.l+=2,_e=!1);break;case 80:E.l<=S[I][1]&&(E.l=S[I][1],_e=!1);break;case 4108:E.l<=S[I][1]&&(E.l=S[I][1],_e=!1);break}if((!r||I==0)&&E.l<=S[I][1]&&(_e=!1,E.l=S[I][1]),_e)throw new Error("Read Error: Expected address "+S[I][1]+" at "+E.l+" :"+I)}if(r){var Re=r[S[I][0]];if(me[Re.n]=parse_TypedPropertyValue(E,Re.t,{raw:!0}),Re.p==="version"&&(me[Re.n]=String(me[Re.n]>>16)+"."+("0000"+String(me[Re.n]&65535)).slice(-4)),Re.n=="CodePage")switch(me[Re.n]){case 0:me[Re.n]=1252;case 874:case 932:case 936:case 949:case 950:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 1e4:case 1200:case 1201:case 1252:case 65e3:case-536:case 65001:case-535:set_cp(H=me[Re.n]>>>0&65535);break;default:throw new Error("Unsupported CodePage: "+me[Re.n])}}else if(S[I][0]===1){if(H=me.CodePage=parse_TypedPropertyValue(E,VT_I2),set_cp(H),te!==-1){var Pe=E.l;E.l=S[te][1],ae=parse_dictionary(E,H),E.l=Pe}}else if(S[I][0]===0){if(H===0){te=I,E.l=S[I+1][1];continue}ae=parse_dictionary(E,H)}else{var Ce=ae[S[I][0]],Fe;switch(E[E.l]){case 65:E.l+=4,Fe=parse_BLOB(E);break;case 30:E.l+=4,Fe=parse_VtString(E,E[E.l-4]).replace(/\u0000+$/,"");break;case 31:E.l+=4,Fe=parse_VtString(E,E[E.l-4]).replace(/\u0000+$/,"");break;case 3:E.l+=4,Fe=E.read_shift(4,"i");break;case 19:E.l+=4,Fe=E.read_shift(4);break;case 5:E.l+=4,Fe=E.read_shift(8,"f");break;case 11:E.l+=4,Fe=parsebool(E,4);break;case 64:E.l+=4,Fe=parseDate(parse_FILETIME(E));break;default:throw new Error("unparsed value: "+E[E.l])}me[Ce]=Fe}}return E.l=v+T,me}function parse_PropertySetStream(E,r,v){var T=E.content;if(!T)return{};prep_blob(T,0);var w,S,I,H,te=0;T.chk("feff","Byte Order: "),T.read_shift(2);var ae=T.read_shift(4),ie=T.read_shift(16);if(ie!==CFB.utils.consts.HEADER_CLSID&&ie!==v)throw new Error("Bad PropertySet CLSID "+ie);if(w=T.read_shift(4),w!==1&&w!==2)throw new Error("Unrecognized #Sets: "+w);if(S=T.read_shift(16),H=T.read_shift(4),w===1&&H!==T.l)throw new Error("Length mismatch: "+H+" !== "+T.l);w===2&&(I=T.read_shift(16),te=T.read_shift(4));var ce=parse_PropertySet(T,r),me={SystemIdentifier:ae};for(var _e in ce)me[_e]=ce[_e];if(me.FMTID=S,w===1)return me;if(te-T.l==2&&(T.l+=2),T.l!==te)throw new Error("Length mismatch 2: "+T.l+" !== "+te);var Re;try{Re=parse_PropertySet(T,null)}catch{}for(_e in Re)me[_e]=Re[_e];return me.FMTID=[S,I],me}function parsenoop2(E,r){return E.read_shift(r),null}function parslurp(E,r,v){for(var T=[],w=E.l+r;E.l<w;)T.push(v(E,w-E.l));if(w!==E.l)throw new Error("Slurp error");return T}function parsebool(E,r){return E.read_shift(r)===1}function parseuint16(E){return E.read_shift(2,"u")}function parseuint16a(E,r){return parslurp(E,r,parseuint16)}function parse_Bes(E){var r=E.read_shift(1),v=E.read_shift(1);return v===1?r:r===1}function parse_ShortXLUnicodeString(E,r,v){var T=E.read_shift(v&&v.biff>=12?2:1),w="sbcs-cont";if(v&&v.biff>=8,!v||v.biff==8){var S=E.read_shift(1);S&&(w="dbcs-cont")}else v.biff==12&&(w="wstr");v.biff>=2&&v.biff<=5&&(w="cpstr");var I=T?E.read_shift(T,w):"";return I}function parse_XLUnicodeRichExtendedString(E){var r=E.read_shift(2),v=E.read_shift(1),T=v&4,w=v&8,S=1+(v&1),I=0,H,te={};w&&(I=E.read_shift(2)),T&&(H=E.read_shift(4));var ae=S==2?"dbcs-cont":"sbcs-cont",ie=r===0?"":E.read_shift(r,ae);return w&&(E.l+=4*I),T&&(E.l+=H),te.t=ie,w||(te.raw="<t>"+te.t+"</t>",te.r=te.t),te}function parse_XLUnicodeStringNoCch(E,r,v){var T;if(v){if(v.biff>=2&&v.biff<=5)return E.read_shift(r,"cpstr");if(v.biff>=12)return E.read_shift(r,"dbcs-cont")}var w=E.read_shift(1);return w===0?T=E.read_shift(r,"sbcs-cont"):T=E.read_shift(r,"dbcs-cont"),T}function parse_XLUnicodeString(E,r,v){var T=E.read_shift(v&&v.biff==2?1:2);return T===0?(E.l++,""):parse_XLUnicodeStringNoCch(E,T,v)}function parse_XLUnicodeString2(E,r,v){if(v.biff>5)return parse_XLUnicodeString(E,r,v);var T=E.read_shift(1);return T===0?(E.l++,""):E.read_shift(T,v.biff<=4||!E.lens?"cpstr":"sbcs-cont")}function parse_ControlInfo(E){var r=E.read_shift(1);E.l++;var v=E.read_shift(2);return E.l+=2,[r,v]}function parse_URLMoniker(E){var r=E.read_shift(4),v=E.l,T=!1;r>24&&(E.l+=r-24,E.read_shift(16)==="795881f43b1d7f48af2c825dc4852763"&&(T=!0),E.l=v);var w=E.read_shift((T?r-24:r)>>1,"utf16le").replace(chr0,"");return T&&(E.l+=24),w}function parse_FileMoniker(E){for(var r=E.read_shift(2),v="";r-- >0;)v+="../";var T=E.read_shift(0,"lpstr-ansi");if(E.l+=2,E.read_shift(2)!=57005)throw new Error("Bad FileMoniker");var w=E.read_shift(4);if(w===0)return v+T.replace(/\\/g,"/");var S=E.read_shift(4);if(E.read_shift(2)!=3)throw new Error("Bad FileMoniker");var I=E.read_shift(S>>1,"utf16le").replace(chr0,"");return v+I}function parse_HyperlinkMoniker(E,r){var v=E.read_shift(16);switch(v){case"e0c9ea79f9bace118c8200aa004ba90b":return parse_URLMoniker(E);case"0303000000000000c000000000000046":return parse_FileMoniker(E);default:throw new Error("Unsupported Moniker "+v)}}function parse_HyperlinkString(E){var r=E.read_shift(4),v=r>0?E.read_shift(r,"utf16le").replace(chr0,""):"";return v}function parse_Hyperlink(E,r){var v=E.l+r,T=E.read_shift(4);if(T!==2)throw new Error("Unrecognized streamVersion: "+T);var w=E.read_shift(2);E.l+=2;var S,I,H,te,ae="",ie,ce;w&16&&(S=parse_HyperlinkString(E,v-E.l)),w&128&&(I=parse_HyperlinkString(E,v-E.l)),(w&257)===257&&(H=parse_HyperlinkString(E,v-E.l)),(w&257)===1&&(te=parse_HyperlinkMoniker(E,v-E.l)),w&8&&(ae=parse_HyperlinkString(E,v-E.l)),w&32&&(ie=E.read_shift(16)),w&64&&(ce=parse_FILETIME(E)),E.l=v;var me=I||H||te||"";me&&ae&&(me+="#"+ae),me||(me="#"+ae),w&2&&me.charAt(0)=="/"&&me.charAt(1)!="/"&&(me="file://"+me);var _e={Target:me};return ie&&(_e.guid=ie),ce&&(_e.time=ce),S&&(_e.Tooltip=S),_e}function parse_LongRGBA(E){var r=E.read_shift(1),v=E.read_shift(1),T=E.read_shift(1),w=E.read_shift(1);return[r,v,T,w]}function parse_LongRGB(E,r){var v=parse_LongRGBA(E);return v[3]=0,v}function parse_XLSCell(E){var r=E.read_shift(2),v=E.read_shift(2),T=E.read_shift(2);return{r,c:v,ixfe:T}}function parse_frtHeader(E){var r=E.read_shift(2),v=E.read_shift(2);return E.l+=8,{type:r,flags:v}}function parse_OptXLUnicodeString(E,r,v){return r===0?"":parse_XLUnicodeString2(E,r,v)}function parse_XTI(E,r,v){var T=v.biff>8?4:2,w=E.read_shift(T),S=E.read_shift(T,"i"),I=E.read_shift(T,"i");return[w,S,I]}function parse_RkRec(E){var r=E.read_shift(2),v=parse_RkNumber(E);return[r,v]}function parse_AddinUdf(E,r,v){E.l+=4,r-=4;var T=E.l+r,w=parse_ShortXLUnicodeString(E,r,v),S=E.read_shift(2);if(T-=E.l,S!==T)throw new Error("Malformed AddinUdf: padding = "+T+" != "+S);return E.l+=S,w}function parse_Ref8U(E){var r=E.read_shift(2),v=E.read_shift(2),T=E.read_shift(2),w=E.read_shift(2);return{s:{c:T,r},e:{c:w,r:v}}}function parse_RefU(E){var r=E.read_shift(2),v=E.read_shift(2),T=E.read_shift(1),w=E.read_shift(1);return{s:{c:T,r},e:{c:w,r:v}}}var parse_Ref=parse_RefU;function parse_FtCmo(E){E.l+=4;var r=E.read_shift(2),v=E.read_shift(2),T=E.read_shift(2);return E.l+=12,[v,r,T]}function parse_FtNts(E){var r={};return E.l+=4,E.l+=16,r.fSharedNote=E.read_shift(2),E.l+=4,r}function parse_FtCf(E){var r={};return E.l+=4,E.cf=E.read_shift(2),r}function parse_FtSkip(E){E.l+=2,E.l+=E.read_shift(2)}var FtTab={0:parse_FtSkip,4:parse_FtSkip,5:parse_FtSkip,6:parse_FtSkip,7:parse_FtCf,8:parse_FtSkip,9:parse_FtSkip,10:parse_FtSkip,11:parse_FtSkip,12:parse_FtSkip,13:parse_FtNts,14:parse_FtSkip,15:parse_FtSkip,16:parse_FtSkip,17:parse_FtSkip,18:parse_FtSkip,19:parse_FtSkip,20:parse_FtSkip,21:parse_FtCmo};function parse_FtArray(E,r){for(var v=E.l+r,T=[];E.l<v;){var w=E.read_shift(2);E.l-=2;try{T.push(FtTab[w](E,v-E.l))}catch{return E.l=v,T}}return E.l!=v&&(E.l=v),T}function parse_BOF(E,r){var v={BIFFVer:0,dt:0};switch(v.BIFFVer=E.read_shift(2),r-=2,r>=2&&(v.dt=E.read_shift(2),E.l-=2),v.BIFFVer){case 1536:case 1280:case 1024:case 768:case 512:case 2:case 7:break;default:if(r>6)throw new Error("Unexpected BIFF Ver "+v.BIFFVer)}return E.read_shift(r),v}function parse_InterfaceHdr(E,r){return r===0||E.read_shift(2),1200}function parse_WriteAccess(E,r,v){if(v.enc)return E.l+=r,"";var T=E.l,w=parse_XLUnicodeString2(E,0,v);return E.read_shift(r+T-E.l),w}function parse_WsBool(E,r,v){var T=v&&v.biff==8||r==2?E.read_shift(2):(E.l+=r,0);return{fDialog:T&16,fBelow:T&64,fRight:T&128}}function parse_BoundSheet8(E,r,v){var T=E.read_shift(4),w=E.read_shift(1)&3,S=E.read_shift(1);switch(S){case 0:S="Worksheet";break;case 1:S="Macrosheet";break;case 2:S="Chartsheet";break;case 6:S="VBAModule";break}var I=parse_ShortXLUnicodeString(E,0,v);return I.length===0&&(I="Sheet1"),{pos:T,hs:w,dt:S,name:I}}function parse_SST(E,r){for(var v=E.l+r,T=E.read_shift(4),w=E.read_shift(4),S=[],I=0;I!=w&&E.l<v;++I)S.push(parse_XLUnicodeRichExtendedString(E));return S.Count=T,S.Unique=w,S}function parse_ExtSST(E,r){var v={};return v.dsst=E.read_shift(2),E.l+=r-2,v}function parse_Row(E){var r={};r.r=E.read_shift(2),r.c=E.read_shift(2),r.cnt=E.read_shift(2)-r.c;var v=E.read_shift(2);E.l+=4;var T=E.read_shift(1);return E.l+=3,T&7&&(r.level=T&7),T&32&&(r.hidden=!0),T&64&&(r.hpt=v/20),r}function parse_ForceFullCalculation(E){var r=parse_frtHeader(E);if(r.type!=2211)throw new Error("Invalid Future Record "+r.type);var v=E.read_shift(4);return v!==0}function parse_RecalcId(E){return E.read_shift(2),E.read_shift(4)}function parse_DefaultRowHeight(E,r,v){var T=0;v&&v.biff==2||(T=E.read_shift(2));var w=E.read_shift(2);v&&v.biff==2&&(T=1-(w>>15),w&=32767);var S={Unsynced:T&1,DyZero:(T&2)>>1,ExAsc:(T&4)>>2,ExDsc:(T&8)>>3};return[S,w]}function parse_Window1(E){var r=E.read_shift(2),v=E.read_shift(2),T=E.read_shift(2),w=E.read_shift(2),S=E.read_shift(2),I=E.read_shift(2),H=E.read_shift(2),te=E.read_shift(2),ae=E.read_shift(2);return{Pos:[r,v],Dim:[T,w],Flags:S,CurTab:I,FirstTab:H,Selected:te,TabRatio:ae}}function parse_Window2(E,r,v){if(v&&v.biff>=2&&v.biff<5)return{};var T=E.read_shift(2);return{RTL:T&64}}function parse_Pane(){}function parse_Font(E,r,v){var T={dyHeight:E.read_shift(2),fl:E.read_shift(2)};switch(v&&v.biff||8){case 2:break;case 3:case 4:E.l+=2;break;default:E.l+=10;break}return T.name=parse_ShortXLUnicodeString(E,0,v),T}function parse_LabelSst(E){var r=parse_XLSCell(E);return r.isst=E.read_shift(4),r}function parse_Label(E,r,v){v.biffguess&&v.biff==2&&(v.biff=5);var T=E.l+r,w=parse_XLSCell(E);v.biff==2&&E.l++;var S=parse_XLUnicodeString(E,T-E.l,v);return w.val=S,w}function parse_Format(E,r,v){var T=E.read_shift(2),w=parse_XLUnicodeString2(E,0,v);return[T,w]}var parse_BIFF2Format=parse_XLUnicodeString2;function parse_Dimensions(E,r,v){var T=E.l+r,w=v.biff==8||!v.biff?4:2,S=E.read_shift(w),I=E.read_shift(w),H=E.read_shift(2),te=E.read_shift(2);return E.l=T,{s:{r:S,c:H},e:{r:I,c:te}}}function parse_RK(E){var r=E.read_shift(2),v=E.read_shift(2),T=parse_RkRec(E);return{r,c:v,ixfe:T[0],rknum:T[1]}}function parse_MulRk(E,r){for(var v=E.l+r-2,T=E.read_shift(2),w=E.read_shift(2),S=[];E.l<v;)S.push(parse_RkRec(E));if(E.l!==v)throw new Error("MulRK read error");var I=E.read_shift(2);if(S.length!=I-w+1)throw new Error("MulRK length mismatch");return{r:T,c:w,C:I,rkrec:S}}function parse_MulBlank(E,r){for(var v=E.l+r-2,T=E.read_shift(2),w=E.read_shift(2),S=[];E.l<v;)S.push(E.read_shift(2));if(E.l!==v)throw new Error("MulBlank read error");var I=E.read_shift(2);if(S.length!=I-w+1)throw new Error("MulBlank length mismatch");return{r:T,c:w,C:I,ixfe:S}}function parse_CellStyleXF(E,r,v,T){var w={},S=E.read_shift(4),I=E.read_shift(4),H=E.read_shift(4),te=E.read_shift(2);return w.patternType=XLSFillPattern[H>>26],T.cellStyles&&(w.alc=S&7,w.fWrap=S>>3&1,w.alcV=S>>4&7,w.fJustLast=S>>7&1,w.trot=S>>8&255,w.cIndent=S>>16&15,w.fShrinkToFit=S>>20&1,w.iReadOrder=S>>22&2,w.fAtrNum=S>>26&1,w.fAtrFnt=S>>27&1,w.fAtrAlc=S>>28&1,w.fAtrBdr=S>>29&1,w.fAtrPat=S>>30&1,w.fAtrProt=S>>31&1,w.dgLeft=I&15,w.dgRight=I>>4&15,w.dgTop=I>>8&15,w.dgBottom=I>>12&15,w.icvLeft=I>>16&127,w.icvRight=I>>23&127,w.grbitDiag=I>>30&3,w.icvTop=H&127,w.icvBottom=H>>7&127,w.icvDiag=H>>14&127,w.dgDiag=H>>21&15,w.icvFore=te&127,w.icvBack=te>>7&127,w.fsxButton=te>>14&1),w}function parse_XF(E,r,v){var T={};return T.ifnt=E.read_shift(2),T.numFmtId=E.read_shift(2),T.flags=E.read_shift(2),T.fStyle=T.flags>>2&1,r-=6,T.data=parse_CellStyleXF(E,r,T.fStyle,v),T}function parse_Guts(E){E.l+=4;var r=[E.read_shift(2),E.read_shift(2)];if(r[0]!==0&&r[0]--,r[1]!==0&&r[1]--,r[0]>7||r[1]>7)throw new Error("Bad Gutters: "+r.join("|"));return r}function parse_BoolErr(E,r,v){var T=parse_XLSCell(E);(v.biff==2||r==9)&&++E.l;var w=parse_Bes(E);return T.val=w,T.t=w===!0||w===!1?"b":"e",T}function parse_Number(E,r,v){v.biffguess&&v.biff==2&&(v.biff=5);var T=parse_XLSCell(E),w=parse_Xnum(E);return T.val=w,T}var parse_XLHeaderFooter=parse_OptXLUnicodeString;function parse_SupBook(E,r,v){var T=E.l+r,w=E.read_shift(2),S=E.read_shift(2);if(v.sbcch=S,S==1025||S==14849)return[S,w];if(S<1||S>255)throw new Error("Unexpected SupBook type: "+S);for(var I=parse_XLUnicodeStringNoCch(E,S),H=[];T>E.l;)H.push(parse_XLUnicodeString(E));return[S,w,I,H]}function parse_ExternName(E,r,v){var T=E.read_shift(2),w,S={fBuiltIn:T&1,fWantAdvise:T>>>1&1,fWantPict:T>>>2&1,fOle:T>>>3&1,fOleLink:T>>>4&1,cf:T>>>5&1023,fIcon:T>>>15&1};return v.sbcch===14849&&(w=parse_AddinUdf(E,r-2,v)),S.body=w||E.read_shift(r-2),typeof w=="string"&&(S.Name=w),S}var XLSLblBuiltIn=["_xlnm.Consolidate_Area","_xlnm.Auto_Open","_xlnm.Auto_Close","_xlnm.Extract","_xlnm.Database","_xlnm.Criteria","_xlnm.Print_Area","_xlnm.Print_Titles","_xlnm.Recorder","_xlnm.Data_Form","_xlnm.Auto_Activate","_xlnm.Auto_Deactivate","_xlnm.Sheet_Title","_xlnm._FilterDatabase"];function parse_Lbl(E,r,v){var T=E.l+r,w=E.read_shift(2),S=E.read_shift(1),I=E.read_shift(1),H=E.read_shift(v&&v.biff==2?1:2),te=0;(!v||v.biff>=5)&&(v.biff!=5&&(E.l+=2),te=E.read_shift(2),v.biff==5&&(E.l+=2),E.l+=4);var ae=parse_XLUnicodeStringNoCch(E,I,v);w&32&&(ae=XLSLblBuiltIn[ae.charCodeAt(0)]);var ie=T-E.l;v&&v.biff==2&&--ie;var ce=T==E.l||H===0||!(ie>0)?[]:parse_NameParsedFormula(E,ie,v,H);return{chKey:S,Name:ae,itab:te,rgce:ce}}function parse_ExternSheet(E,r,v){if(v.biff<8)return parse_BIFF5ExternSheet(E,r,v);for(var T=[],w=E.l+r,S=E.read_shift(v.biff>8?4:2);S--!==0;)T.push(parse_XTI(E,v.biff>8?12:6,v));if(E.l!=w)throw new Error("Bad ExternSheet: "+E.l+" != "+w);return T}function parse_BIFF5ExternSheet(E,r,v){E[E.l+1]==3&&E[E.l]++;var T=parse_ShortXLUnicodeString(E,r,v);return T.charCodeAt(0)==3?T.slice(1):T}function parse_NameCmt(E,r,v){if(v.biff<8){E.l+=r;return}var T=E.read_shift(2),w=E.read_shift(2),S=parse_XLUnicodeStringNoCch(E,T,v),I=parse_XLUnicodeStringNoCch(E,w,v);return[S,I]}function parse_ShrFmla(E,r,v){var T=parse_RefU(E);E.l++;var w=E.read_shift(1);return r-=8,[parse_SharedParsedFormula(E,r,v),w,T]}function parse_Array(E,r,v){var T=parse_Ref(E);switch(v.biff){case 2:E.l++,r-=7;break;case 3:case 4:E.l+=2,r-=8;break;default:E.l+=6,r-=12}return[T,parse_ArrayParsedFormula(E,r,v)]}function parse_MTRSettings(E){var r=E.read_shift(4)!==0,v=E.read_shift(4)!==0,T=E.read_shift(4);return[r,v,T]}function parse_NoteSh(E,r,v){if(!(v.biff<8)){var T=E.read_shift(2),w=E.read_shift(2),S=E.read_shift(2),I=E.read_shift(2),H=parse_XLUnicodeString2(E,0,v);return v.biff<8&&E.read_shift(1),[{r:T,c:w},H,I,S]}}function parse_Note(E,r,v){return parse_NoteSh(E,r,v)}function parse_MergeCells(E,r){for(var v=[],T=E.read_shift(2);T--;)v.push(parse_Ref8U(E));return v}function parse_Obj(E,r,v){if(v&&v.biff<8)return parse_BIFF5Obj(E,r,v);var T=parse_FtCmo(E),w=parse_FtArray(E,r-22,T[1]);return{cmo:T,ft:w}}var parse_BIFF5OT={8:function(E,r){var v=E.l+r;E.l+=10;var T=E.read_shift(2);E.l+=4,E.l+=2,E.l+=2,E.l+=2,E.l+=4;var w=E.read_shift(1);return E.l+=w,E.l=v,{fmt:T}}};function parse_BIFF5Obj(E,r,v){E.l+=4;var T=E.read_shift(2),w=E.read_shift(2),S=E.read_shift(2);E.l+=2,E.l+=2,E.l+=2,E.l+=2,E.l+=2,E.l+=2,E.l+=2,E.l+=2,E.l+=2,E.l+=6,r-=36;var I=[];return I.push((parse_BIFF5OT[T]||parsenoop)(E,r,v)),{cmo:[w,T,S],ft:I}}function parse_TxO(E,r,v){var T=E.l,w="";try{E.l+=4;var S=(v.lastobj||{cmo:[0,0]}).cmo[1],I;[0,5,7,11,12,14].indexOf(S)==-1?E.l+=6:I=parse_ControlInfo(E,6,v);var H=E.read_shift(2);E.read_shift(2),parseuint16(E,2);var te=E.read_shift(2);E.l+=te;for(var ae=1;ae<E.lens.length-1;++ae){if(E.l-T!=E.lens[ae])throw new Error("TxO: bad continue record");var ie=E[E.l],ce=parse_XLUnicodeStringNoCch(E,E.lens[ae+1]-E.lens[ae]-1);if(w+=ce,w.length>=(ie?H:2*H))break}if(w.length!==H&&w.length!==H*2)throw new Error("cchText: "+H+" != "+w.length);return E.l=T+r,{t:w}}catch{return E.l=T+r,{t:w}}}function parse_HLink(E,r){var v=parse_Ref8U(E);E.l+=16;var T=parse_Hyperlink(E,r-24);return[v,T]}function parse_HLinkTooltip(E,r){E.read_shift(2);var v=parse_Ref8U(E),T=E.read_shift((r-10)/2,"dbcs-cont");return T=T.replace(chr0,""),[v,T]}function parse_Country(E){var r=[0,0],v;return v=E.read_shift(2),r[0]=CountryEnum[v]||v,v=E.read_shift(2),r[1]=CountryEnum[v]||v,r}function parse_ClrtClient(E){for(var r=E.read_shift(2),v=[];r-- >0;)v.push(parse_LongRGB(E));return v}function parse_Palette(E){for(var r=E.read_shift(2),v=[];r-- >0;)v.push(parse_LongRGB(E));return v}function parse_XFCRC(E){E.l+=2;var r={cxfs:0,crc:0};return r.cxfs=E.read_shift(2),r.crc=E.read_shift(4),r}function parse_ColInfo(E,r,v){if(!v.cellStyles)return parsenoop(E,r);var T=v&&v.biff>=12?4:2,w=E.read_shift(T),S=E.read_shift(T),I=E.read_shift(T),H=E.read_shift(T),te=E.read_shift(2);T==2&&(E.l+=2);var ae={s:w,e:S,w:I,ixfe:H,flags:te};return(v.biff>=5||!v.biff)&&(ae.level=te>>8&7),ae}function parse_Setup(E,r){var v={};return r<32||(E.l+=16,v.header=parse_Xnum(E),v.footer=parse_Xnum(E),E.l+=2),v}function parse_ShtProps(E,r,v){var T={area:!1};if(v.biff!=5)return E.l+=r,T;var w=E.read_shift(1);return E.l+=3,w&16&&(T.area=!0),T}var parse_Blank=parse_XLSCell,parse_Scl=parseuint16a,parse_String=parse_XLUnicodeString;function parse_ImData(E){var r=E.read_shift(2),v=E.read_shift(2),T=E.read_shift(4),w={fmt:r,env:v,len:T,data:E.slice(E.l,E.l+T)};return E.l+=T,w}function parse_BIFF2STR(E,r,v){v.biffguess&&v.biff==5&&(v.biff=2);var T=parse_XLSCell(E);++E.l;var w=parse_XLUnicodeString2(E,r-7,v);return T.t="str",T.val=w,T}function parse_BIFF2NUM(E){var r=parse_XLSCell(E);++E.l;var v=parse_Xnum(E);return r.t="n",r.val=v,r}function parse_BIFF2INT(E){var r=parse_XLSCell(E);++E.l;var v=E.read_shift(2);return r.t="n",r.val=v,r}function parse_BIFF2STRING(E){var r=E.read_shift(1);return r===0?(E.l++,""):E.read_shift(r,"sbcs-cont")}function parse_BIFF2FONTXTRA(E,r){E.l+=6,E.l+=2,E.l+=1,E.l+=3,E.l+=1,E.l+=r-13}function parse_RString(E,r,v){var T=E.l+r,w=parse_XLSCell(E),S=E.read_shift(2),I=parse_XLUnicodeStringNoCch(E,S,v);return E.l=T,w.t="str",w.val=I,w}var DBF_SUPPORTED_VERSIONS=[2,3,48,49,131,139,140,245],DBF=function(){var E={1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127,8:865,9:437,10:850,11:437,13:437,14:850,15:437,16:850,17:437,18:850,19:932,20:850,21:437,22:850,23:865,24:437,25:437,26:850,27:437,28:863,29:850,31:852,34:852,35:852,36:860,37:850,38:866,55:850,64:852,77:936,78:949,79:950,80:874,87:1252,88:1252,89:1252,108:863,134:737,135:852,136:857,204:1257,255:16969},r=evert({1:437,2:850,3:1252,4:1e4,100:852,101:866,102:865,103:861,104:895,105:620,106:737,107:857,120:950,121:949,122:936,123:932,124:874,125:1255,126:1256,150:10007,151:10029,152:10006,200:1250,201:1251,202:1254,203:1253,0:20127});function v(H,te){var ae=[],ie=new_raw_buf(1);switch(te.type){case"base64":ie=s2a(Base64_decode(H));break;case"binary":ie=s2a(H);break;case"buffer":case"array":ie=H;break}prep_blob(ie,0);var ce=ie.read_shift(1),me=!!(ce&136),_e=!1,Re=!1;switch(ce){case 2:break;case 3:break;case 48:_e=!0,me=!0;break;case 49:_e=!0,me=!0;break;case 131:break;case 139:break;case 140:Re=!0;break;case 245:break;default:throw new Error("DBF Unsupported Version: "+ce.toString(16))}var Pe=0,Ce=521;ce==2&&(Pe=ie.read_shift(2)),ie.l+=3,ce!=2&&(Pe=ie.read_shift(4)),Pe>1048576&&(Pe=1e6),ce!=2&&(Ce=ie.read_shift(2));var Fe=ie.read_shift(2),Me=te.codepage||1252;ce!=2&&(ie.l+=16,ie.read_shift(1),ie[ie.l]!==0&&(Me=E[ie[ie.l]]),ie.l+=1,ie.l+=2),Re&&(ie.l+=36);for(var Ve=[],We={},ze=Math.min(ie.length,ce==2?521:Ce-10-(_e?264:0)),Ue=Re?32:11;ie.l<ze&&ie[ie.l]!=13;)switch(We={},We.name=$cptable.utils.decode(Me,ie.slice(ie.l,ie.l+Ue)).replace(/[\u0000\r\n].*$/g,""),ie.l+=Ue,We.type=String.fromCharCode(ie.read_shift(1)),ce!=2&&!Re&&(We.offset=ie.read_shift(4)),We.len=ie.read_shift(1),ce==2&&(We.offset=ie.read_shift(2)),We.dec=ie.read_shift(1),We.name.length&&Ve.push(We),ce!=2&&(ie.l+=Re?13:14),We.type){case"B":(!_e||We.len!=8)&&te.WTF&&console.log("Skipping "+We.name+":"+We.type);break;case"G":case"P":te.WTF&&console.log("Skipping "+We.name+":"+We.type);break;case"+":case"0":case"@":case"C":case"D":case"F":case"I":case"L":case"M":case"N":case"O":case"T":case"Y":break;default:throw new Error("Unknown Field Type: "+We.type)}if(ie[ie.l]!==13&&(ie.l=Ce-1),ie.read_shift(1)!==13)throw new Error("DBF Terminator not found "+ie.l+" "+ie[ie.l]);ie.l=Ce;var je=0,ke=0;for(ae[0]=[],ke=0;ke!=Ve.length;++ke)ae[0][ke]=Ve[ke].name;for(;Pe-- >0;){if(ie[ie.l]===42){ie.l+=Fe;continue}for(++ie.l,ae[++je]=[],ke=0,ke=0;ke!=Ve.length;++ke){var Ne=ie.slice(ie.l,ie.l+Ve[ke].len);ie.l+=Ve[ke].len,prep_blob(Ne,0);var Ge=$cptable.utils.decode(Me,Ne);switch(Ve[ke].type){case"C":Ge.trim().length&&(ae[je][ke]=Ge.replace(/\s+$/,""));break;case"D":Ge.length===8?ae[je][ke]=new Date(+Ge.slice(0,4),+Ge.slice(4,6)-1,+Ge.slice(6,8)):ae[je][ke]=Ge;break;case"F":ae[je][ke]=parseFloat(Ge.trim());break;case"+":case"I":ae[je][ke]=Re?Ne.read_shift(-4,"i")^2147483648:Ne.read_shift(4,"i");break;case"L":switch(Ge.trim().toUpperCase()){case"Y":case"T":ae[je][ke]=!0;break;case"N":case"F":ae[je][ke]=!1;break;case"":case"?":break;default:throw new Error("DBF Unrecognized L:|"+Ge+"|")}break;case"M":if(!me)throw new Error("DBF Unexpected MEMO for type "+ce.toString(16));ae[je][ke]="##MEMO##"+(Re?parseInt(Ge.trim(),10):Ne.read_shift(4));break;case"N":Ge=Ge.replace(/\u0000/g,"").trim(),Ge&&Ge!="."&&(ae[je][ke]=+Ge||0);break;case"@":ae[je][ke]=new Date(Ne.read_shift(-8,"f")-621356832e5);break;case"T":ae[je][ke]=new Date((Ne.read_shift(4)-2440588)*864e5+Ne.read_shift(4));break;case"Y":ae[je][ke]=Ne.read_shift(4,"i")/1e4+Ne.read_shift(4,"i")/1e4*Math.pow(2,32);break;case"O":ae[je][ke]=-Ne.read_shift(-8,"f");break;case"B":if(_e&&Ve[ke].len==8){ae[je][ke]=Ne.read_shift(8,"f");break}case"G":case"P":Ne.l+=Ve[ke].len;break;case"0":if(Ve[ke].name==="_NullFlags")break;default:throw new Error("DBF Unsupported data type "+Ve[ke].type)}}}if(ce!=2&&ie.l<ie.length&&ie[ie.l++]!=26)throw new Error("DBF EOF Marker missing "+(ie.l-1)+" of "+ie.length+" "+ie[ie.l-1].toString(16));return te&&te.sheetRows&&(ae=ae.slice(0,te.sheetRows)),te.DBF=Ve,ae}function T(H,te){var ae=te||{};ae.dateNF||(ae.dateNF="yyyymmdd");var ie=aoa_to_sheet(v(H,ae),ae);return ie["!cols"]=ae.DBF.map(function(ce){return{wch:ce.len,DBF:ce}}),delete ae.DBF,ie}function w(H,te){try{return sheet_to_workbook(T(H,te),te)}catch(ae){if(te&&te.WTF)throw ae}return{SheetNames:[],Sheets:{}}}var S={B:8,C:250,L:1,D:8,"?":0,"":0};function I(H,te){var ae=te||{};if(+ae.codepage>=0&&set_cp(+ae.codepage),ae.type=="string")throw new Error("Cannot write DBF to JS string");var ie=buf_array(),ce=sheet_to_json(H,{header:1,raw:!0,cellDates:!0}),me=ce[0],_e=ce.slice(1),Re=H["!cols"]||[],Pe=0,Ce=0,Fe=0,Me=1;for(Pe=0;Pe<me.length;++Pe){if(((Re[Pe]||{}).DBF||{}).name){me[Pe]=Re[Pe].DBF.name,++Fe;continue}if(me[Pe]!=null){if(++Fe,typeof me[Pe]=="number"&&(me[Pe]=me[Pe].toString(10)),typeof me[Pe]!="string")throw new Error("DBF Invalid column name "+me[Pe]+" |"+typeof me[Pe]+"|");if(me.indexOf(me[Pe])!==Pe){for(Ce=0;Ce<1024;++Ce)if(me.indexOf(me[Pe]+"_"+Ce)==-1){me[Pe]+="_"+Ce;break}}}}var Ve=safe_decode_range(H["!ref"]),We=[],ze=[],Ue=[];for(Pe=0;Pe<=Ve.e.c-Ve.s.c;++Pe){var je="",ke="",Ne=0,Ge=[];for(Ce=0;Ce<_e.length;++Ce)_e[Ce][Pe]!=null&&Ge.push(_e[Ce][Pe]);if(Ge.length==0||me[Pe]==null){We[Pe]="?";continue}for(Ce=0;Ce<Ge.length;++Ce){switch(typeof Ge[Ce]){case"number":ke="B";break;case"string":ke="C";break;case"boolean":ke="L";break;case"object":ke=Ge[Ce]instanceof Date?"D":"C";break;default:ke="C"}Ne=Math.max(Ne,String(Ge[Ce]).length),je=je&&je!=ke?"C":ke}Ne>250&&(Ne=250),ke=((Re[Pe]||{}).DBF||{}).type,ke=="C"&&Re[Pe].DBF.len>Ne&&(Ne=Re[Pe].DBF.len),je=="B"&&ke=="N"&&(je="N",Ue[Pe]=Re[Pe].DBF.dec,Ne=Re[Pe].DBF.len),ze[Pe]=je=="C"||ke=="N"?Ne:S[je]||0,Me+=ze[Pe],We[Pe]=je}var Ie=ie.next(32);for(Ie.write_shift(4,318902576),Ie.write_shift(4,_e.length),Ie.write_shift(2,296+32*Fe),Ie.write_shift(2,Me),Pe=0;Pe<4;++Pe)Ie.write_shift(4,0);for(Ie.write_shift(4,0|(+r[current_ansi]||3)<<8),Pe=0,Ce=0;Pe<me.length;++Pe)if(me[Pe]!=null){var Le=ie.next(32),He=(me[Pe].slice(-10)+"\0\0\0\0\0\0\0\0\0\0\0").slice(0,11);Le.write_shift(1,He,"sbcs"),Le.write_shift(1,We[Pe]=="?"?"C":We[Pe],"sbcs"),Le.write_shift(4,Ce),Le.write_shift(1,ze[Pe]||S[We[Pe]]||0),Le.write_shift(1,Ue[Pe]||0),Le.write_shift(1,2),Le.write_shift(4,0),Le.write_shift(1,0),Le.write_shift(4,0),Le.write_shift(4,0),Ce+=ze[Pe]||S[We[Pe]]||0}var Ct=ie.next(264);for(Ct.write_shift(4,13),Pe=0;Pe<65;++Pe)Ct.write_shift(4,0);for(Pe=0;Pe<_e.length;++Pe){var Ze=ie.next(Me);for(Ze.write_shift(1,0),Ce=0;Ce<me.length;++Ce)if(me[Ce]!=null)switch(We[Ce]){case"L":Ze.write_shift(1,_e[Pe][Ce]==null?63:_e[Pe][Ce]?84:70);break;case"B":Ze.write_shift(8,_e[Pe][Ce]||0,"f");break;case"N":var Rt="0";for(typeof _e[Pe][Ce]=="number"&&(Rt=_e[Pe][Ce].toFixed(Ue[Ce]||0)),Fe=0;Fe<ze[Ce]-Rt.length;++Fe)Ze.write_shift(1,32);Ze.write_shift(1,Rt,"sbcs");break;case"D":_e[Pe][Ce]?(Ze.write_shift(4,("0000"+_e[Pe][Ce].getFullYear()).slice(-4),"sbcs"),Ze.write_shift(2,("00"+(_e[Pe][Ce].getMonth()+1)).slice(-2),"sbcs"),Ze.write_shift(2,("00"+_e[Pe][Ce].getDate()).slice(-2),"sbcs")):Ze.write_shift(8,"00000000","sbcs");break;case"C":var nt=String(_e[Pe][Ce]!=null?_e[Pe][Ce]:"").slice(0,ze[Ce]);for(Ze.write_shift(1,nt,"sbcs"),Fe=0;Fe<ze[Ce]-nt.length;++Fe)Ze.write_shift(1,32);break}}return ie.next(1).write_shift(1,26),ie.end()}return{to_workbook:w,to_sheet:T,from_sheet:I}}(),SYLK=function(){var E={AA:"À",BA:"Á",CA:"Â",DA:195,HA:"Ä",JA:197,AE:"È",BE:"É",CE:"Ê",HE:"Ë",AI:"Ì",BI:"Í",CI:"Î",HI:"Ï",AO:"Ò",BO:"Ó",CO:"Ô",DO:213,HO:"Ö",AU:"Ù",BU:"Ú",CU:"Û",HU:"Ü",Aa:"à",Ba:"á",Ca:"â",Da:227,Ha:"ä",Ja:229,Ae:"è",Be:"é",Ce:"ê",He:"ë",Ai:"ì",Bi:"í",Ci:"î",Hi:"ï",Ao:"ò",Bo:"ó",Co:"ô",Do:245,Ho:"ö",Au:"ù",Bu:"ú",Cu:"û",Hu:"ü",KC:"Ç",Kc:"ç",q:"æ",z:"œ",a:"Æ",j:"Œ",DN:209,Dn:241,Hy:255,S:169,c:170,R:174,"B ":180,0:176,1:177,2:178,3:179,5:181,6:182,7:183,Q:185,k:186,b:208,i:216,l:222,s:240,y:248,"!":161,'"':162,"#":163,"(":164,"%":165,"'":167,"H ":168,"+":171,";":187,"<":188,"=":189,">":190,"?":191,"{":223},r=new RegExp("\x1BN("+keys(E).join("|").replace(/\|\|\|/,"|\\||").replace(/([?()+])/g,"\\$1")+"|\\|)","gm"),v=function(me,_e){var Re=E[_e];return typeof Re=="number"?_getansi(Re):Re},T=function(me,_e,Re){var Pe=_e.charCodeAt(0)-32<<4|Re.charCodeAt(0)-48;return Pe==59?me:_getansi(Pe)};E["|"]=254;function w(me,_e){switch(_e.type){case"base64":return S(Base64_decode(me),_e);case"binary":return S(me,_e);case"buffer":return S(has_buf&&Buffer.isBuffer(me)?me.toString("binary"):a2s(me),_e);case"array":return S(cc2str(me),_e)}throw new Error("Unrecognized type "+_e.type)}function S(me,_e){var Re=me.split(/[\n\r]+/),Pe=-1,Ce=-1,Fe=0,Me=0,Ve=[],We=[],ze=null,Ue={},je=[],ke=[],Ne=[],Ge=0,Ie;for(+_e.codepage>=0&&set_cp(+_e.codepage);Fe!==Re.length;++Fe){Ge=0;var Le=Re[Fe].trim().replace(/\x1B([\x20-\x2F])([\x30-\x3F])/g,T).replace(r,v),He=Le.replace(/;;/g,"\0").split(";").map(function(Xe){return Xe.replace(/\u0000/g,";")}),Ct=He[0],Ze;if(Le.length>0)switch(Ct){case"ID":break;case"E":break;case"B":break;case"O":break;case"W":break;case"P":He[1].charAt(0)=="P"&&We.push(Le.slice(3).replace(/;;/g,";"));break;case"C":var Rt=!1,nt=!1,nr=!1,Je=!1,Wt=-1,Lt=-1;for(Me=1;Me<He.length;++Me)switch(He[Me].charAt(0)){case"A":break;case"X":Ce=parseInt(He[Me].slice(1))-1,nt=!0;break;case"Y":for(Pe=parseInt(He[Me].slice(1))-1,nt||(Ce=0),Ie=Ve.length;Ie<=Pe;++Ie)Ve[Ie]=[];break;case"K":Ze=He[Me].slice(1),Ze.charAt(0)==='"'?Ze=Ze.slice(1,Ze.length-1):Ze==="TRUE"?Ze=!0:Ze==="FALSE"?Ze=!1:isNaN(fuzzynum(Ze))?isNaN(fuzzydate(Ze).getDate())||(Ze=parseDate(Ze)):(Ze=fuzzynum(Ze),ze!==null&&fmt_is_date(ze)&&(Ze=numdate(Ze))),Rt=!0;break;case"E":Je=!0;var qe=rc_to_a1(He[Me].slice(1),{r:Pe,c:Ce});Ve[Pe][Ce]=[Ve[Pe][Ce],qe];break;case"S":nr=!0,Ve[Pe][Ce]=[Ve[Pe][Ce],"S5S"];break;case"G":break;case"R":Wt=parseInt(He[Me].slice(1))-1;break;case"C":Lt=parseInt(He[Me].slice(1))-1;break;default:if(_e&&_e.WTF)throw new Error("SYLK bad record "+Le)}if(Rt&&(Ve[Pe][Ce]&&Ve[Pe][Ce].length==2?Ve[Pe][Ce][0]=Ze:Ve[Pe][Ce]=Ze,ze=null),nr){if(Je)throw new Error("SYLK shared formula cannot have own formula");var $e=Wt>-1&&Ve[Wt][Lt];if(!$e||!$e[1])throw new Error("SYLK shared formula cannot find base");Ve[Pe][Ce][1]=shift_formula_str($e[1],{r:Pe-Wt,c:Ce-Lt})}break;case"F":var Be=0;for(Me=1;Me<He.length;++Me)switch(He[Me].charAt(0)){case"X":Ce=parseInt(He[Me].slice(1))-1,++Be;break;case"Y":for(Pe=parseInt(He[Me].slice(1))-1,Ie=Ve.length;Ie<=Pe;++Ie)Ve[Ie]=[];break;case"M":Ge=parseInt(He[Me].slice(1))/20;break;case"F":break;case"G":break;case"P":ze=We[parseInt(He[Me].slice(1))];break;case"S":break;case"D":break;case"N":break;case"W":for(Ne=He[Me].slice(1).split(" "),Ie=parseInt(Ne[0],10);Ie<=parseInt(Ne[1],10);++Ie)Ge=parseInt(Ne[2],10),ke[Ie-1]=Ge===0?{hidden:!0}:{wch:Ge},process_col(ke[Ie-1]);break;case"C":Ce=parseInt(He[Me].slice(1))-1,ke[Ce]||(ke[Ce]={});break;case"R":Pe=parseInt(He[Me].slice(1))-1,je[Pe]||(je[Pe]={}),Ge>0?(je[Pe].hpt=Ge,je[Pe].hpx=pt2px(Ge)):Ge===0&&(je[Pe].hidden=!0);break;default:if(_e&&_e.WTF)throw new Error("SYLK bad record "+Le)}Be<1&&(ze=null);break;default:if(_e&&_e.WTF)throw new Error("SYLK bad record "+Le)}}return je.length>0&&(Ue["!rows"]=je),ke.length>0&&(Ue["!cols"]=ke),_e&&_e.sheetRows&&(Ve=Ve.slice(0,_e.sheetRows)),[Ve,Ue]}function I(me,_e){var Re=w(me,_e),Pe=Re[0],Ce=Re[1],Fe=aoa_to_sheet(Pe,_e);return keys(Ce).forEach(function(Me){Fe[Me]=Ce[Me]}),Fe}function H(me,_e){return sheet_to_workbook(I(me,_e),_e)}function te(me,_e,Re,Pe){var Ce="C;Y"+(Re+1)+";X"+(Pe+1)+";K";switch(me.t){case"n":Ce+=me.v||0,me.f&&!me.F&&(Ce+=";E"+a1_to_rc(me.f,{r:Re,c:Pe}));break;case"b":Ce+=me.v?"TRUE":"FALSE";break;case"e":Ce+=me.w||me.v;break;case"d":Ce+='"'+(me.w||me.v)+'"';break;case"s":Ce+='"'+me.v.replace(/"/g,"").replace(/;/g,";;")+'"';break}return Ce}function ae(me,_e){_e.forEach(function(Re,Pe){var Ce="F;W"+(Pe+1)+" "+(Pe+1)+" ";Re.hidden?Ce+="0":(typeof Re.width=="number"&&!Re.wpx&&(Re.wpx=width2px(Re.width)),typeof Re.wpx=="number"&&!Re.wch&&(Re.wch=px2char(Re.wpx)),typeof Re.wch=="number"&&(Ce+=Math.round(Re.wch))),Ce.charAt(Ce.length-1)!=" "&&me.push(Ce)})}function ie(me,_e){_e.forEach(function(Re,Pe){var Ce="F;";Re.hidden?Ce+="M0;":Re.hpt?Ce+="M"+20*Re.hpt+";":Re.hpx&&(Ce+="M"+20*px2pt(Re.hpx)+";"),Ce.length>2&&me.push(Ce+"R"+(Pe+1))})}function ce(me,_e){var Re=["ID;PWXL;N;E"],Pe=[],Ce=safe_decode_range(me["!ref"]),Fe,Me=Array.isArray(me),Ve=`\r
`;Re.push("P;PGeneral"),Re.push("F;P0;DG0G8;M255"),me["!cols"]&&ae(Re,me["!cols"]),me["!rows"]&&ie(Re,me["!rows"]),Re.push("B;Y"+(Ce.e.r-Ce.s.r+1)+";X"+(Ce.e.c-Ce.s.c+1)+";D"+[Ce.s.c,Ce.s.r,Ce.e.c,Ce.e.r].join(" "));for(var We=Ce.s.r;We<=Ce.e.r;++We)for(var ze=Ce.s.c;ze<=Ce.e.c;++ze){var Ue=encode_cell({r:We,c:ze});Fe=Me?(me[We]||[])[ze]:me[Ue],!(!Fe||Fe.v==null&&(!Fe.f||Fe.F))&&Pe.push(te(Fe,me,We,ze))}return Re.join(Ve)+Ve+Pe.join(Ve)+Ve+"E"+Ve}return{to_workbook:H,to_sheet:I,from_sheet:ce}}(),DIF=function(){function E(S,I){switch(I.type){case"base64":return r(Base64_decode(S),I);case"binary":return r(S,I);case"buffer":return r(has_buf&&Buffer.isBuffer(S)?S.toString("binary"):a2s(S),I);case"array":return r(cc2str(S),I)}throw new Error("Unrecognized type "+I.type)}function r(S,I){for(var H=S.split(`
`),te=-1,ae=-1,ie=0,ce=[];ie!==H.length;++ie){if(H[ie].trim()==="BOT"){ce[++te]=[],ae=0;continue}if(!(te<0)){var me=H[ie].trim().split(","),_e=me[0],Re=me[1];++ie;for(var Pe=H[ie]||"";(Pe.match(/["]/g)||[]).length&1&&ie<H.length-1;)Pe+=`
`+H[++ie];switch(Pe=Pe.trim(),+_e){case-1:if(Pe==="BOT"){ce[++te]=[],ae=0;continue}else if(Pe!=="EOD")throw new Error("Unrecognized DIF special command "+Pe);break;case 0:Pe==="TRUE"?ce[te][ae]=!0:Pe==="FALSE"?ce[te][ae]=!1:isNaN(fuzzynum(Re))?isNaN(fuzzydate(Re).getDate())?ce[te][ae]=Re:ce[te][ae]=parseDate(Re):ce[te][ae]=fuzzynum(Re),++ae;break;case 1:Pe=Pe.slice(1,Pe.length-1),Pe=Pe.replace(/""/g,'"'),Pe&&Pe.match(/^=".*"$/)&&(Pe=Pe.slice(2,-1)),ce[te][ae++]=Pe!==""?Pe:null;break}if(Pe==="EOD")break}}return I&&I.sheetRows&&(ce=ce.slice(0,I.sheetRows)),ce}function v(S,I){return aoa_to_sheet(E(S,I),I)}function T(S,I){return sheet_to_workbook(v(S,I),I)}var w=function(){var S=function(te,ae,ie,ce,me){te.push(ae),te.push(ie+","+ce),te.push('"'+me.replace(/"/g,'""')+'"')},I=function(te,ae,ie,ce){te.push(ae+","+ie),te.push(ae==1?'"'+ce.replace(/"/g,'""')+'"':ce)};return function(te){var ae=[],ie=safe_decode_range(te["!ref"]),ce,me=Array.isArray(te);S(ae,"TABLE",0,1,"sheetjs"),S(ae,"VECTORS",0,ie.e.r-ie.s.r+1,""),S(ae,"TUPLES",0,ie.e.c-ie.s.c+1,""),S(ae,"DATA",0,0,"");for(var _e=ie.s.r;_e<=ie.e.r;++_e){I(ae,-1,0,"BOT");for(var Re=ie.s.c;Re<=ie.e.c;++Re){var Pe=encode_cell({r:_e,c:Re});if(ce=me?(te[_e]||[])[Re]:te[Pe],!ce){I(ae,1,0,"");continue}switch(ce.t){case"n":var Ce=ce.w;!Ce&&ce.v!=null&&(Ce=ce.v),Ce==null?ce.f&&!ce.F?I(ae,1,0,"="+ce.f):I(ae,1,0,""):I(ae,0,Ce,"V");break;case"b":I(ae,0,ce.v?1:0,ce.v?"TRUE":"FALSE");break;case"s":I(ae,1,0,isNaN(ce.v)?ce.v:'="'+ce.v+'"');break;case"d":ce.w||(ce.w=SSF_format(ce.z||table_fmt[14],datenum(parseDate(ce.v)))),I(ae,0,ce.w,"V");break;default:I(ae,1,0,"")}}}I(ae,-1,0,"EOD");var Fe=`\r
`,Me=ae.join(Fe);return Me}}();return{to_workbook:T,to_sheet:v,from_sheet:w}}(),ETH=function(){function E(ce){return ce.replace(/\\b/g,"\\").replace(/\\c/g,":").replace(/\\n/g,`
`)}function r(ce){return ce.replace(/\\/g,"\\b").replace(/:/g,"\\c").replace(/\n/g,"\\n")}function v(ce,me){for(var _e=ce.split(`
`),Re=-1,Pe=-1,Ce=0,Fe=[];Ce!==_e.length;++Ce){var Me=_e[Ce].trim().split(":");if(Me[0]==="cell"){var Ve=decode_cell(Me[1]);if(Fe.length<=Ve.r)for(Re=Fe.length;Re<=Ve.r;++Re)Fe[Re]||(Fe[Re]=[]);switch(Re=Ve.r,Pe=Ve.c,Me[2]){case"t":Fe[Re][Pe]=E(Me[3]);break;case"v":Fe[Re][Pe]=+Me[3];break;case"vtf":var We=Me[Me.length-1];case"vtc":switch(Me[3]){case"nl":Fe[Re][Pe]=!!+Me[4];break;default:Fe[Re][Pe]=+Me[4];break}Me[2]=="vtf"&&(Fe[Re][Pe]=[Fe[Re][Pe],We])}}}return me&&me.sheetRows&&(Fe=Fe.slice(0,me.sheetRows)),Fe}function T(ce,me){return aoa_to_sheet(v(ce,me),me)}function w(ce,me){return sheet_to_workbook(T(ce,me),me)}var S=["socialcalc:version:1.5","MIME-Version: 1.0","Content-Type: multipart/mixed; boundary=SocialCalcSpreadsheetControlSave"].join(`
`),I=["--SocialCalcSpreadsheetControlSave","Content-type: text/plain; charset=UTF-8"].join(`
`)+`
`,H=["# SocialCalc Spreadsheet Control Save","part:sheet"].join(`
`),te="--SocialCalcSpreadsheetControlSave--";function ae(ce){if(!ce||!ce["!ref"])return"";for(var me=[],_e=[],Re,Pe="",Ce=decode_range(ce["!ref"]),Fe=Array.isArray(ce),Me=Ce.s.r;Me<=Ce.e.r;++Me)for(var Ve=Ce.s.c;Ve<=Ce.e.c;++Ve)if(Pe=encode_cell({r:Me,c:Ve}),Re=Fe?(ce[Me]||[])[Ve]:ce[Pe],!(!Re||Re.v==null||Re.t==="z")){switch(_e=["cell",Pe,"t"],Re.t){case"s":case"str":_e.push(r(Re.v));break;case"n":Re.f?(_e[2]="vtf",_e[3]="n",_e[4]=Re.v,_e[5]=r(Re.f)):(_e[2]="v",_e[3]=Re.v);break;case"b":_e[2]="vt"+(Re.f?"f":"c"),_e[3]="nl",_e[4]=Re.v?"1":"0",_e[5]=r(Re.f||(Re.v?"TRUE":"FALSE"));break;case"d":var We=datenum(parseDate(Re.v));_e[2]="vtc",_e[3]="nd",_e[4]=""+We,_e[5]=Re.w||SSF_format(Re.z||table_fmt[14],We);break;case"e":continue}me.push(_e.join(":"))}return me.push("sheet:c:"+(Ce.e.c-Ce.s.c+1)+":r:"+(Ce.e.r-Ce.s.r+1)+":tvf:1"),me.push("valueformat:1:text-wiki"),me.join(`
`)}function ie(ce){return[S,I,H,I,ae(ce),te].join(`
`)}return{to_workbook:w,to_sheet:T,from_sheet:ie}}(),PRN=function(){function E(ie,ce,me,_e,Re){Re.raw?ce[me][_e]=ie:ie===""||(ie==="TRUE"?ce[me][_e]=!0:ie==="FALSE"?ce[me][_e]=!1:isNaN(fuzzynum(ie))?isNaN(fuzzydate(ie).getDate())?ce[me][_e]=ie:ce[me][_e]=parseDate(ie):ce[me][_e]=fuzzynum(ie))}function r(ie,ce){var me=ce||{},_e=[];if(!ie||ie.length===0)return _e;for(var Re=ie.split(/[\r\n]/),Pe=Re.length-1;Pe>=0&&Re[Pe].length===0;)--Pe;for(var Ce=10,Fe=0,Me=0;Me<=Pe;++Me)Fe=Re[Me].indexOf(" "),Fe==-1?Fe=Re[Me].length:Fe++,Ce=Math.max(Ce,Fe);for(Me=0;Me<=Pe;++Me){_e[Me]=[];var Ve=0;for(E(Re[Me].slice(0,Ce).trim(),_e,Me,Ve,me),Ve=1;Ve<=(Re[Me].length-Ce)/10+1;++Ve)E(Re[Me].slice(Ce+(Ve-1)*10,Ce+Ve*10).trim(),_e,Me,Ve,me)}return me.sheetRows&&(_e=_e.slice(0,me.sheetRows)),_e}var v={44:",",9:"	",59:";",124:"|"},T={44:3,9:2,59:1,124:0};function w(ie){for(var ce={},me=!1,_e=0,Re=0;_e<ie.length;++_e)(Re=ie.charCodeAt(_e))==34?me=!me:!me&&Re in v&&(ce[Re]=(ce[Re]||0)+1);Re=[];for(_e in ce)Object.prototype.hasOwnProperty.call(ce,_e)&&Re.push([ce[_e],_e]);if(!Re.length){ce=T;for(_e in ce)Object.prototype.hasOwnProperty.call(ce,_e)&&Re.push([ce[_e],_e])}return Re.sort(function(Pe,Ce){return Pe[0]-Ce[0]||T[Pe[1]]-T[Ce[1]]}),v[Re.pop()[1]]||44}function S(ie,ce){var me=ce||{},_e="",Re=me.dense?[]:{},Pe={s:{c:0,r:0},e:{c:0,r:0}};ie.slice(0,4)=="sep="?ie.charCodeAt(5)==13&&ie.charCodeAt(6)==10?(_e=ie.charAt(4),ie=ie.slice(7)):ie.charCodeAt(5)==13||ie.charCodeAt(5)==10?(_e=ie.charAt(4),ie=ie.slice(6)):_e=w(ie.slice(0,1024)):me&&me.FS?_e=me.FS:_e=w(ie.slice(0,1024));var Ce=0,Fe=0,Me=0,Ve=0,We=0,ze=_e.charCodeAt(0),Ue=!1,je=0,ke=ie.charCodeAt(0);ie=ie.replace(/\r\n/mg,`
`);var Ne=me.dateNF!=null?dateNF_regex(me.dateNF):null;function Ge(){var Ie=ie.slice(Ve,We),Le={};if(Ie.charAt(0)=='"'&&Ie.charAt(Ie.length-1)=='"'&&(Ie=Ie.slice(1,-1).replace(/""/g,'"')),Ie.length===0)Le.t="z";else if(me.raw)Le.t="s",Le.v=Ie;else if(Ie.trim().length===0)Le.t="s",Le.v=Ie;else if(Ie.charCodeAt(0)==61)Ie.charCodeAt(1)==34&&Ie.charCodeAt(Ie.length-1)==34?(Le.t="s",Le.v=Ie.slice(2,-1).replace(/""/g,'"')):fuzzyfmla(Ie)?(Le.t="n",Le.f=Ie.slice(1)):(Le.t="s",Le.v=Ie);else if(Ie=="TRUE")Le.t="b",Le.v=!0;else if(Ie=="FALSE")Le.t="b",Le.v=!1;else if(!isNaN(Me=fuzzynum(Ie)))Le.t="n",me.cellText!==!1&&(Le.w=Ie),Le.v=Me;else if(!isNaN(fuzzydate(Ie).getDate())||Ne&&Ie.match(Ne)){Le.z=me.dateNF||table_fmt[14];var He=0;Ne&&Ie.match(Ne)&&(Ie=dateNF_fix(Ie,me.dateNF,Ie.match(Ne)||[]),He=1),me.cellDates?(Le.t="d",Le.v=parseDate(Ie,He)):(Le.t="n",Le.v=datenum(parseDate(Ie,He))),me.cellText!==!1&&(Le.w=SSF_format(Le.z,Le.v instanceof Date?datenum(Le.v):Le.v)),me.cellNF||delete Le.z}else Le.t="s",Le.v=Ie;if(Le.t=="z"||(me.dense?(Re[Ce]||(Re[Ce]=[]),Re[Ce][Fe]=Le):Re[encode_cell({c:Fe,r:Ce})]=Le),Ve=We+1,ke=ie.charCodeAt(Ve),Pe.e.c<Fe&&(Pe.e.c=Fe),Pe.e.r<Ce&&(Pe.e.r=Ce),je==ze)++Fe;else if(Fe=0,++Ce,me.sheetRows&&me.sheetRows<=Ce)return!0}e:for(;We<ie.length;++We)switch(je=ie.charCodeAt(We)){case 34:ke===34&&(Ue=!Ue);break;case ze:case 10:case 13:if(!Ue&&Ge())break e;break}return We-Ve>0&&Ge(),Re["!ref"]=encode_range(Pe),Re}function I(ie,ce){return!(ce&&ce.PRN)||ce.FS||ie.slice(0,4)=="sep="||ie.indexOf("	")>=0||ie.indexOf(",")>=0||ie.indexOf(";")>=0?S(ie,ce):aoa_to_sheet(r(ie,ce),ce)}function H(ie,ce){var me="",_e=ce.type=="string"?[0,0,0,0]:firstbyte(ie,ce);switch(ce.type){case"base64":me=Base64_decode(ie);break;case"binary":me=ie;break;case"buffer":ce.codepage==65001?me=ie.toString("utf8"):(ce.codepage,me=has_buf&&Buffer.isBuffer(ie)?ie.toString("binary"):a2s(ie));break;case"array":me=cc2str(ie);break;case"string":me=ie;break;default:throw new Error("Unrecognized type "+ce.type)}return _e[0]==239&&_e[1]==187&&_e[2]==191?me=utf8read(me.slice(3)):ce.type!="string"&&ce.type!="buffer"&&ce.codepage==65001?me=utf8read(me):ce.type=="binary",me.slice(0,19)=="socialcalc:version:"?ETH.to_sheet(ce.type=="string"?me:utf8read(me),ce):I(me,ce)}function te(ie,ce){return sheet_to_workbook(H(ie,ce),ce)}function ae(ie){for(var ce=[],me=safe_decode_range(ie["!ref"]),_e,Re=Array.isArray(ie),Pe=me.s.r;Pe<=me.e.r;++Pe){for(var Ce=[],Fe=me.s.c;Fe<=me.e.c;++Fe){var Me=encode_cell({r:Pe,c:Fe});if(_e=Re?(ie[Pe]||[])[Fe]:ie[Me],!_e||_e.v==null){Ce.push("          ");continue}for(var Ve=(_e.w||(format_cell(_e),_e.w)||"").slice(0,10);Ve.length<10;)Ve+=" ";Ce.push(Ve+(Fe===0?" ":""))}ce.push(Ce.join(""))}return ce.join(`
`)}return{to_workbook:te,to_sheet:H,from_sheet:ae}}();function read_wb_ID(E,r){var v=r||{},T=!!v.WTF;v.WTF=!0;try{var w=SYLK.to_workbook(E,v);return v.WTF=T,w}catch(S){if(v.WTF=T,!S.message.match(/SYLK bad record ID/)&&T)throw S;return PRN.to_workbook(E,r)}}var WK_=function(){function E(qe,$e,Be){if(qe){prep_blob(qe,qe.l||0);for(var Xe=Be.Enum||Wt;qe.l<qe.length;){var rt=qe.read_shift(2),Qe=Xe[rt]||Xe[65535],vt=qe.read_shift(2),Dt=qe.l+vt,Ut=Qe.f&&Qe.f(qe,vt,Be);if(qe.l=Dt,$e(Ut,Qe,rt))return}}}function r(qe,$e){switch($e.type){case"base64":return v(s2a(Base64_decode(qe)),$e);case"binary":return v(s2a(qe),$e);case"buffer":case"array":return v(qe,$e)}throw"Unsupported type "+$e.type}function v(qe,$e){if(!qe)return qe;var Be=$e||{},Xe=Be.dense?[]:{},rt="Sheet1",Qe="",vt=0,Dt={},Ut=[],hr=[],pt={s:{r:0,c:0},e:{r:0,c:0}},yr=Be.sheetRows||0;if(qe[2]==0&&(qe[3]==8||qe[3]==9)&&qe.length>=16&&qe[14]==5&&qe[15]===108)throw new Error("Unsupported Works 3 for Mac file");if(qe[2]==2)Be.Enum=Wt,E(qe,function(sr,kt,rr){switch(rr){case 0:Be.vers=sr,sr>=4096&&(Be.qpro=!0);break;case 6:pt=sr;break;case 204:sr&&(Qe=sr);break;case 222:Qe=sr;break;case 15:case 51:Be.qpro||(sr[1].v=sr[1].v.slice(1));case 13:case 14:case 16:rr==14&&(sr[2]&112)==112&&(sr[2]&15)>1&&(sr[2]&15)<15&&(sr[1].z=Be.dateNF||table_fmt[14],Be.cellDates&&(sr[1].t="d",sr[1].v=numdate(sr[1].v))),Be.qpro&&sr[3]>vt&&(Xe["!ref"]=encode_range(pt),Dt[rt]=Xe,Ut.push(rt),Xe=Be.dense?[]:{},pt={s:{r:0,c:0},e:{r:0,c:0}},vt=sr[3],rt=Qe||"Sheet"+(vt+1),Qe="");var lr=Be.dense?(Xe[sr[0].r]||[])[sr[0].c]:Xe[encode_cell(sr[0])];if(lr){lr.t=sr[1].t,lr.v=sr[1].v,sr[1].z!=null&&(lr.z=sr[1].z),sr[1].f!=null&&(lr.f=sr[1].f);break}Be.dense?(Xe[sr[0].r]||(Xe[sr[0].r]=[]),Xe[sr[0].r][sr[0].c]=sr[1]):Xe[encode_cell(sr[0])]=sr[1];break}},Be);else if(qe[2]==26||qe[2]==14)Be.Enum=Lt,qe[2]==14&&(Be.qpro=!0,qe.l=0),E(qe,function(sr,kt,rr){switch(rr){case 204:rt=sr;break;case 22:sr[1].v=sr[1].v.slice(1);case 23:case 24:case 25:case 37:case 39:case 40:if(sr[3]>vt&&(Xe["!ref"]=encode_range(pt),Dt[rt]=Xe,Ut.push(rt),Xe=Be.dense?[]:{},pt={s:{r:0,c:0},e:{r:0,c:0}},vt=sr[3],rt="Sheet"+(vt+1)),yr>0&&sr[0].r>=yr)break;Be.dense?(Xe[sr[0].r]||(Xe[sr[0].r]=[]),Xe[sr[0].r][sr[0].c]=sr[1]):Xe[encode_cell(sr[0])]=sr[1],pt.e.c<sr[0].c&&(pt.e.c=sr[0].c),pt.e.r<sr[0].r&&(pt.e.r=sr[0].r);break;case 27:sr[14e3]&&(hr[sr[14e3][0]]=sr[14e3][1]);break;case 1537:hr[sr[0]]=sr[1],sr[0]==vt&&(rt=sr[1]);break}},Be);else throw new Error("Unrecognized LOTUS BOF "+qe[2]);if(Xe["!ref"]=encode_range(pt),Dt[Qe||rt]=Xe,Ut.push(Qe||rt),!hr.length)return{SheetNames:Ut,Sheets:Dt};for(var vr={},wr=[],ir=0;ir<hr.length;++ir)Dt[Ut[ir]]?(wr.push(hr[ir]||Ut[ir]),vr[hr[ir]]=Dt[hr[ir]]||Dt[Ut[ir]]):(wr.push(hr[ir]),vr[hr[ir]]={"!ref":"A1"});return{SheetNames:wr,Sheets:vr}}function T(qe,$e){var Be=$e||{};if(+Be.codepage>=0&&set_cp(+Be.codepage),Be.type=="string")throw new Error("Cannot write WK1 to JS string");var Xe=buf_array(),rt=safe_decode_range(qe["!ref"]),Qe=Array.isArray(qe),vt=[];write_biff_rec(Xe,0,S(1030)),write_biff_rec(Xe,6,te(rt));for(var Dt=Math.min(rt.e.r,8191),Ut=rt.s.r;Ut<=Dt;++Ut)for(var hr=encode_row(Ut),pt=rt.s.c;pt<=rt.e.c;++pt){Ut===rt.s.r&&(vt[pt]=encode_col(pt));var yr=vt[pt]+hr,vr=Qe?(qe[Ut]||[])[pt]:qe[yr];if(!(!vr||vr.t=="z"))if(vr.t=="n")(vr.v|0)==vr.v&&vr.v>=-32768&&vr.v<=32767?write_biff_rec(Xe,13,_e(Ut,pt,vr.v)):write_biff_rec(Xe,14,Pe(Ut,pt,vr.v));else{var wr=format_cell(vr);write_biff_rec(Xe,15,ce(Ut,pt,wr.slice(0,239)))}}return write_biff_rec(Xe,1),Xe.end()}function w(qe,$e){var Be=$e||{};if(+Be.codepage>=0&&set_cp(+Be.codepage),Be.type=="string")throw new Error("Cannot write WK3 to JS string");var Xe=buf_array();write_biff_rec(Xe,0,I(qe));for(var rt=0,Qe=0;rt<qe.SheetNames.length;++rt)(qe.Sheets[qe.SheetNames[rt]]||{})["!ref"]&&write_biff_rec(Xe,27,Je(qe.SheetNames[rt],Qe++));var vt=0;for(rt=0;rt<qe.SheetNames.length;++rt){var Dt=qe.Sheets[qe.SheetNames[rt]];if(!(!Dt||!Dt["!ref"])){for(var Ut=safe_decode_range(Dt["!ref"]),hr=Array.isArray(Dt),pt=[],yr=Math.min(Ut.e.r,8191),vr=Ut.s.r;vr<=yr;++vr)for(var wr=encode_row(vr),ir=Ut.s.c;ir<=Ut.e.c;++ir){vr===Ut.s.r&&(pt[ir]=encode_col(ir));var sr=pt[ir]+wr,kt=hr?(Dt[vr]||[])[ir]:Dt[sr];if(!(!kt||kt.t=="z"))if(kt.t=="n")write_biff_rec(Xe,23,Ge(vr,ir,vt,kt.v));else{var rr=format_cell(kt);write_biff_rec(Xe,22,je(vr,ir,vt,rr.slice(0,239)))}}++vt}}return write_biff_rec(Xe,1),Xe.end()}function S(qe){var $e=new_buf(2);return $e.write_shift(2,qe),$e}function I(qe){var $e=new_buf(26);$e.write_shift(2,4096),$e.write_shift(2,4),$e.write_shift(4,0);for(var Be=0,Xe=0,rt=0,Qe=0;Qe<qe.SheetNames.length;++Qe){var vt=qe.SheetNames[Qe],Dt=qe.Sheets[vt];if(!(!Dt||!Dt["!ref"])){++rt;var Ut=decode_range(Dt["!ref"]);Be<Ut.e.r&&(Be=Ut.e.r),Xe<Ut.e.c&&(Xe=Ut.e.c)}}return Be>8191&&(Be=8191),$e.write_shift(2,Be),$e.write_shift(1,rt),$e.write_shift(1,Xe),$e.write_shift(2,0),$e.write_shift(2,0),$e.write_shift(1,1),$e.write_shift(1,2),$e.write_shift(4,0),$e.write_shift(4,0),$e}function H(qe,$e,Be){var Xe={s:{c:0,r:0},e:{c:0,r:0}};return $e==8&&Be.qpro?(Xe.s.c=qe.read_shift(1),qe.l++,Xe.s.r=qe.read_shift(2),Xe.e.c=qe.read_shift(1),qe.l++,Xe.e.r=qe.read_shift(2),Xe):(Xe.s.c=qe.read_shift(2),Xe.s.r=qe.read_shift(2),$e==12&&Be.qpro&&(qe.l+=2),Xe.e.c=qe.read_shift(2),Xe.e.r=qe.read_shift(2),$e==12&&Be.qpro&&(qe.l+=2),Xe.s.c==65535&&(Xe.s.c=Xe.e.c=Xe.s.r=Xe.e.r=0),Xe)}function te(qe){var $e=new_buf(8);return $e.write_shift(2,qe.s.c),$e.write_shift(2,qe.s.r),$e.write_shift(2,qe.e.c),$e.write_shift(2,qe.e.r),$e}function ae(qe,$e,Be){var Xe=[{c:0,r:0},{t:"n",v:0},0,0];return Be.qpro&&Be.vers!=20768?(Xe[0].c=qe.read_shift(1),Xe[3]=qe.read_shift(1),Xe[0].r=qe.read_shift(2),qe.l+=2):(Xe[2]=qe.read_shift(1),Xe[0].c=qe.read_shift(2),Xe[0].r=qe.read_shift(2)),Xe}function ie(qe,$e,Be){var Xe=qe.l+$e,rt=ae(qe,$e,Be);if(rt[1].t="s",Be.vers==20768){qe.l++;var Qe=qe.read_shift(1);return rt[1].v=qe.read_shift(Qe,"utf8"),rt}return Be.qpro&&qe.l++,rt[1].v=qe.read_shift(Xe-qe.l,"cstr"),rt}function ce(qe,$e,Be){var Xe=new_buf(7+Be.length);Xe.write_shift(1,255),Xe.write_shift(2,$e),Xe.write_shift(2,qe),Xe.write_shift(1,39);for(var rt=0;rt<Xe.length;++rt){var Qe=Be.charCodeAt(rt);Xe.write_shift(1,Qe>=128?95:Qe)}return Xe.write_shift(1,0),Xe}function me(qe,$e,Be){var Xe=ae(qe,$e,Be);return Xe[1].v=qe.read_shift(2,"i"),Xe}function _e(qe,$e,Be){var Xe=new_buf(7);return Xe.write_shift(1,255),Xe.write_shift(2,$e),Xe.write_shift(2,qe),Xe.write_shift(2,Be,"i"),Xe}function Re(qe,$e,Be){var Xe=ae(qe,$e,Be);return Xe[1].v=qe.read_shift(8,"f"),Xe}function Pe(qe,$e,Be){var Xe=new_buf(13);return Xe.write_shift(1,255),Xe.write_shift(2,$e),Xe.write_shift(2,qe),Xe.write_shift(8,Be,"f"),Xe}function Ce(qe,$e,Be){var Xe=qe.l+$e,rt=ae(qe,$e,Be);if(rt[1].v=qe.read_shift(8,"f"),Be.qpro)qe.l=Xe;else{var Qe=qe.read_shift(2);We(qe.slice(qe.l,qe.l+Qe),rt),qe.l+=Qe}return rt}function Fe(qe,$e,Be){var Xe=$e&32768;return $e&=-32769,$e=(Xe?qe:0)+($e>=8192?$e-16384:$e),(Xe?"":"$")+(Be?encode_col($e):encode_row($e))}var Me={51:["FALSE",0],52:["TRUE",0],70:["LEN",1],80:["SUM",69],81:["AVERAGEA",69],82:["COUNTA",69],83:["MINA",69],84:["MAXA",69],111:["T",1]},Ve=["","","","","","","","","","+","-","*","/","^","=","<>","<=",">=","<",">","","","","","&","","","","","","",""];function We(qe,$e){prep_blob(qe,0);for(var Be=[],Xe=0,rt="",Qe="",vt="",Dt="";qe.l<qe.length;){var Ut=qe[qe.l++];switch(Ut){case 0:Be.push(qe.read_shift(8,"f"));break;case 1:Qe=Fe($e[0].c,qe.read_shift(2),!0),rt=Fe($e[0].r,qe.read_shift(2),!1),Be.push(Qe+rt);break;case 2:{var hr=Fe($e[0].c,qe.read_shift(2),!0),pt=Fe($e[0].r,qe.read_shift(2),!1);Qe=Fe($e[0].c,qe.read_shift(2),!0),rt=Fe($e[0].r,qe.read_shift(2),!1),Be.push(hr+pt+":"+Qe+rt)}break;case 3:if(qe.l<qe.length){console.error("WK1 premature formula end");return}break;case 4:Be.push("("+Be.pop()+")");break;case 5:Be.push(qe.read_shift(2));break;case 6:{for(var yr="";Ut=qe[qe.l++];)yr+=String.fromCharCode(Ut);Be.push('"'+yr.replace(/"/g,'""')+'"')}break;case 8:Be.push("-"+Be.pop());break;case 23:Be.push("+"+Be.pop());break;case 22:Be.push("NOT("+Be.pop()+")");break;case 20:case 21:Dt=Be.pop(),vt=Be.pop(),Be.push(["AND","OR"][Ut-20]+"("+vt+","+Dt+")");break;default:if(Ut<32&&Ve[Ut])Dt=Be.pop(),vt=Be.pop(),Be.push(vt+Ve[Ut]+Dt);else if(Me[Ut]){if(Xe=Me[Ut][1],Xe==69&&(Xe=qe[qe.l++]),Xe>Be.length){console.error("WK1 bad formula parse 0x"+Ut.toString(16)+":|"+Be.join("|")+"|");return}var vr=Be.slice(-Xe);Be.length-=Xe,Be.push(Me[Ut][0]+"("+vr.join(",")+")")}else return Ut<=7?console.error("WK1 invalid opcode "+Ut.toString(16)):Ut<=24?console.error("WK1 unsupported op "+Ut.toString(16)):Ut<=30?console.error("WK1 invalid opcode "+Ut.toString(16)):Ut<=115?console.error("WK1 unsupported function opcode "+Ut.toString(16)):console.error("WK1 unrecognized opcode "+Ut.toString(16))}}Be.length==1?$e[1].f=""+Be[0]:console.error("WK1 bad formula parse |"+Be.join("|")+"|")}function ze(qe){var $e=[{c:0,r:0},{t:"n",v:0},0];return $e[0].r=qe.read_shift(2),$e[3]=qe[qe.l++],$e[0].c=qe[qe.l++],$e}function Ue(qe,$e){var Be=ze(qe);return Be[1].t="s",Be[1].v=qe.read_shift($e-4,"cstr"),Be}function je(qe,$e,Be,Xe){var rt=new_buf(6+Xe.length);rt.write_shift(2,qe),rt.write_shift(1,Be),rt.write_shift(1,$e),rt.write_shift(1,39);for(var Qe=0;Qe<Xe.length;++Qe){var vt=Xe.charCodeAt(Qe);rt.write_shift(1,vt>=128?95:vt)}return rt.write_shift(1,0),rt}function ke(qe,$e){var Be=ze(qe);Be[1].v=qe.read_shift(2);var Xe=Be[1].v>>1;if(Be[1].v&1)switch(Xe&7){case 0:Xe=(Xe>>3)*5e3;break;case 1:Xe=(Xe>>3)*500;break;case 2:Xe=(Xe>>3)/20;break;case 3:Xe=(Xe>>3)/200;break;case 4:Xe=(Xe>>3)/2e3;break;case 5:Xe=(Xe>>3)/2e4;break;case 6:Xe=(Xe>>3)/16;break;case 7:Xe=(Xe>>3)/64;break}return Be[1].v=Xe,Be}function Ne(qe,$e){var Be=ze(qe),Xe=qe.read_shift(4),rt=qe.read_shift(4),Qe=qe.read_shift(2);if(Qe==65535)return Xe===0&&rt===3221225472?(Be[1].t="e",Be[1].v=15):Xe===0&&rt===3489660928?(Be[1].t="e",Be[1].v=42):Be[1].v=0,Be;var vt=Qe&32768;return Qe=(Qe&32767)-16446,Be[1].v=(1-vt*2)*(rt*Math.pow(2,Qe+32)+Xe*Math.pow(2,Qe)),Be}function Ge(qe,$e,Be,Xe){var rt=new_buf(14);if(rt.write_shift(2,qe),rt.write_shift(1,Be),rt.write_shift(1,$e),Xe==0)return rt.write_shift(4,0),rt.write_shift(4,0),rt.write_shift(2,65535),rt;var Qe=0,vt=0,Dt=0,Ut=0;return Xe<0&&(Qe=1,Xe=-Xe),vt=Math.log2(Xe)|0,Xe/=Math.pow(2,vt-31),Ut=Xe>>>0,Ut&2147483648||(Xe/=2,++vt,Ut=Xe>>>0),Xe-=Ut,Ut|=2147483648,Ut>>>=0,Xe*=Math.pow(2,32),Dt=Xe>>>0,rt.write_shift(4,Dt),rt.write_shift(4,Ut),vt+=16383+(Qe?32768:0),rt.write_shift(2,vt),rt}function Ie(qe,$e){var Be=Ne(qe);return qe.l+=$e-14,Be}function Le(qe,$e){var Be=ze(qe),Xe=qe.read_shift(4);return Be[1].v=Xe>>6,Be}function He(qe,$e){var Be=ze(qe),Xe=qe.read_shift(8,"f");return Be[1].v=Xe,Be}function Ct(qe,$e){var Be=He(qe);return qe.l+=$e-10,Be}function Ze(qe,$e){return qe[qe.l+$e-1]==0?qe.read_shift($e,"cstr"):""}function Rt(qe,$e){var Be=qe[qe.l++];Be>$e-1&&(Be=$e-1);for(var Xe="";Xe.length<Be;)Xe+=String.fromCharCode(qe[qe.l++]);return Xe}function nt(qe,$e,Be){if(!(!Be.qpro||$e<21)){var Xe=qe.read_shift(1);qe.l+=17,qe.l+=1,qe.l+=2;var rt=qe.read_shift($e-21,"cstr");return[Xe,rt]}}function nr(qe,$e){for(var Be={},Xe=qe.l+$e;qe.l<Xe;){var rt=qe.read_shift(2);if(rt==14e3){for(Be[rt]=[0,""],Be[rt][0]=qe.read_shift(2);qe[qe.l];)Be[rt][1]+=String.fromCharCode(qe[qe.l]),qe.l++;qe.l++}}return Be}function Je(qe,$e){var Be=new_buf(5+qe.length);Be.write_shift(2,14e3),Be.write_shift(2,$e);for(var Xe=0;Xe<qe.length;++Xe){var rt=qe.charCodeAt(Xe);Be[Be.l++]=rt>127?95:rt}return Be[Be.l++]=0,Be}var Wt={0:{n:"BOF",f:parseuint16},1:{n:"EOF"},2:{n:"CALCMODE"},3:{n:"CALCORDER"},4:{n:"SPLIT"},5:{n:"SYNC"},6:{n:"RANGE",f:H},7:{n:"WINDOW1"},8:{n:"COLW1"},9:{n:"WINTWO"},10:{n:"COLW2"},11:{n:"NAME"},12:{n:"BLANK"},13:{n:"INTEGER",f:me},14:{n:"NUMBER",f:Re},15:{n:"LABEL",f:ie},16:{n:"FORMULA",f:Ce},24:{n:"TABLE"},25:{n:"ORANGE"},26:{n:"PRANGE"},27:{n:"SRANGE"},28:{n:"FRANGE"},29:{n:"KRANGE1"},32:{n:"HRANGE"},35:{n:"KRANGE2"},36:{n:"PROTEC"},37:{n:"FOOTER"},38:{n:"HEADER"},39:{n:"SETUP"},40:{n:"MARGINS"},41:{n:"LABELFMT"},42:{n:"TITLES"},43:{n:"SHEETJS"},45:{n:"GRAPH"},46:{n:"NGRAPH"},47:{n:"CALCCOUNT"},48:{n:"UNFORMATTED"},49:{n:"CURSORW12"},50:{n:"WINDOW"},51:{n:"STRING",f:ie},55:{n:"PASSWORD"},56:{n:"LOCKED"},60:{n:"QUERY"},61:{n:"QUERYNAME"},62:{n:"PRINT"},63:{n:"PRINTNAME"},64:{n:"GRAPH2"},65:{n:"GRAPHNAME"},66:{n:"ZOOM"},67:{n:"SYMSPLIT"},68:{n:"NSROWS"},69:{n:"NSCOLS"},70:{n:"RULER"},71:{n:"NNAME"},72:{n:"ACOMM"},73:{n:"AMACRO"},74:{n:"PARSE"},102:{n:"PRANGES??"},103:{n:"RRANGES??"},104:{n:"FNAME??"},105:{n:"MRANGES??"},204:{n:"SHEETNAMECS",f:Ze},222:{n:"SHEETNAMELP",f:Rt},65535:{n:""}},Lt={0:{n:"BOF"},1:{n:"EOF"},2:{n:"PASSWORD"},3:{n:"CALCSET"},4:{n:"WINDOWSET"},5:{n:"SHEETCELLPTR"},6:{n:"SHEETLAYOUT"},7:{n:"COLUMNWIDTH"},8:{n:"HIDDENCOLUMN"},9:{n:"USERRANGE"},10:{n:"SYSTEMRANGE"},11:{n:"ZEROFORCE"},12:{n:"SORTKEYDIR"},13:{n:"FILESEAL"},14:{n:"DATAFILLNUMS"},15:{n:"PRINTMAIN"},16:{n:"PRINTSTRING"},17:{n:"GRAPHMAIN"},18:{n:"GRAPHSTRING"},19:{n:"??"},20:{n:"ERRCELL"},21:{n:"NACELL"},22:{n:"LABEL16",f:Ue},23:{n:"NUMBER17",f:Ne},24:{n:"NUMBER18",f:ke},25:{n:"FORMULA19",f:Ie},26:{n:"FORMULA1A"},27:{n:"XFORMAT",f:nr},28:{n:"DTLABELMISC"},29:{n:"DTLABELCELL"},30:{n:"GRAPHWINDOW"},31:{n:"CPA"},32:{n:"LPLAUTO"},33:{n:"QUERY"},34:{n:"HIDDENSHEET"},35:{n:"??"},37:{n:"NUMBER25",f:Le},38:{n:"??"},39:{n:"NUMBER27",f:He},40:{n:"FORMULA28",f:Ct},142:{n:"??"},147:{n:"??"},150:{n:"??"},151:{n:"??"},152:{n:"??"},153:{n:"??"},154:{n:"??"},155:{n:"??"},156:{n:"??"},163:{n:"??"},174:{n:"??"},175:{n:"??"},176:{n:"??"},177:{n:"??"},184:{n:"??"},185:{n:"??"},186:{n:"??"},187:{n:"??"},188:{n:"??"},195:{n:"??"},201:{n:"??"},204:{n:"SHEETNAMECS",f:Ze},205:{n:"??"},206:{n:"??"},207:{n:"??"},208:{n:"??"},256:{n:"??"},259:{n:"??"},260:{n:"??"},261:{n:"??"},262:{n:"??"},263:{n:"??"},265:{n:"??"},266:{n:"??"},267:{n:"??"},268:{n:"??"},270:{n:"??"},271:{n:"??"},384:{n:"??"},389:{n:"??"},390:{n:"??"},393:{n:"??"},396:{n:"??"},512:{n:"??"},514:{n:"??"},513:{n:"??"},516:{n:"??"},517:{n:"??"},640:{n:"??"},641:{n:"??"},642:{n:"??"},643:{n:"??"},644:{n:"??"},645:{n:"??"},646:{n:"??"},647:{n:"??"},648:{n:"??"},658:{n:"??"},659:{n:"??"},660:{n:"??"},661:{n:"??"},662:{n:"??"},665:{n:"??"},666:{n:"??"},768:{n:"??"},772:{n:"??"},1537:{n:"SHEETINFOQP",f:nt},1600:{n:"??"},1602:{n:"??"},1793:{n:"??"},1794:{n:"??"},1795:{n:"??"},1796:{n:"??"},1920:{n:"??"},2048:{n:"??"},2049:{n:"??"},2052:{n:"??"},2688:{n:"??"},10998:{n:"??"},12849:{n:"??"},28233:{n:"??"},28484:{n:"??"},65535:{n:""}};return{sheet_to_wk1:T,book_to_wk3:w,to_workbook:r}}();function parse_rpr(E){var r={},v=E.match(tagregex),T=0,w=!1;if(v)for(;T!=v.length;++T){var S=parsexmltag(v[T]);switch(S[0].replace(/\w*:/g,"")){case"<condense":break;case"<extend":break;case"<shadow":if(!S.val)break;case"<shadow>":case"<shadow/>":r.shadow=1;break;case"</shadow>":break;case"<charset":if(S.val=="1")break;r.cp=CS2CP[parseInt(S.val,10)];break;case"<outline":if(!S.val)break;case"<outline>":case"<outline/>":r.outline=1;break;case"</outline>":break;case"<rFont":r.name=S.val;break;case"<sz":r.sz=S.val;break;case"<strike":if(!S.val)break;case"<strike>":case"<strike/>":r.strike=1;break;case"</strike>":break;case"<u":if(!S.val)break;switch(S.val){case"double":r.uval="double";break;case"singleAccounting":r.uval="single-accounting";break;case"doubleAccounting":r.uval="double-accounting";break}case"<u>":case"<u/>":r.u=1;break;case"</u>":break;case"<b":if(S.val=="0")break;case"<b>":case"<b/>":r.b=1;break;case"</b>":break;case"<i":if(S.val=="0")break;case"<i>":case"<i/>":r.i=1;break;case"</i>":break;case"<color":S.rgb&&(r.color=S.rgb.slice(2,8));break;case"<color>":case"<color/>":case"</color>":break;case"<family":r.family=S.val;break;case"<family>":case"<family/>":case"</family>":break;case"<vertAlign":r.valign=S.val;break;case"<vertAlign>":case"<vertAlign/>":case"</vertAlign>":break;case"<scheme":break;case"<scheme>":case"<scheme/>":case"</scheme>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":w=!0;break;case"</ext>":w=!1;break;default:if(S[0].charCodeAt(1)!==47&&!w)throw new Error("Unrecognized rich format "+S[0])}}return r}var parse_rs=function(){var E=matchtag("t"),r=matchtag("rPr");function v(S){var I=S.match(E);if(!I)return{t:"s",v:""};var H={t:"s",v:unescapexml(I[1])},te=S.match(r);return te&&(H.s=parse_rpr(te[1])),H}var T=/<(?:\w+:)?r>/g,w=/<\/(?:\w+:)?r>/;return function(I){return I.replace(T,"").split(w).map(v).filter(function(H){return H.v})}}(),rs_to_html=function E(){var r=/(\r\n|\n)/g;function v(w,S,I){var H=[];w.u&&H.push("text-decoration: underline;"),w.uval&&H.push("text-underline-style:"+w.uval+";"),w.sz&&H.push("font-size:"+w.sz+"pt;"),w.outline&&H.push("text-effect: outline;"),w.shadow&&H.push("text-shadow: auto;"),S.push('<span style="'+H.join("")+'">'),w.b&&(S.push("<b>"),I.push("</b>")),w.i&&(S.push("<i>"),I.push("</i>")),w.strike&&(S.push("<s>"),I.push("</s>"));var te=w.valign||"";return te=="superscript"||te=="super"?te="sup":te=="subscript"&&(te="sub"),te!=""&&(S.push("<"+te+">"),I.push("</"+te+">")),I.push("</span>"),w}function T(w){var S=[[],w.v,[]];return w.v?(w.s&&v(w.s,S[0],S[2]),S[0].join("")+S[1].replace(r,"<br/>")+S[2].join("")):""}return function(S){return S.map(T).join("")}}(),sitregex=/<(?:\w+:)?t[^>]*>([^<]*)<\/(?:\w+:)?t>/g,sirregex=/<(?:\w+:)?r>/,sirphregex=/<(?:\w+:)?rPh.*?>([\s\S]*?)<\/(?:\w+:)?rPh>/g;function parse_si(E,r){var v=r?r.cellHTML:!0,T={};return E?(E.match(/^\s*<(?:\w+:)?t[^>]*>/)?(T.t=unescapexml(utf8read(E.slice(E.indexOf(">")+1).split(/<\/(?:\w+:)?t>/)[0]||"")),T.r=utf8read(E),v&&(T.h=escapehtml(T.t))):E.match(sirregex)&&(T.r=utf8read(E),T.t=unescapexml(utf8read((E.replace(sirphregex,"").match(sitregex)||[]).join("").replace(tagregex,""))),v&&(T.h=rs_to_html(parse_rs(T.r)))),T):{t:""}}var sstr0=/<(?:\w+:)?sst([^>]*)>([\s\S]*)<\/(?:\w+:)?sst>/,sstr1=/<(?:\w+:)?(?:si|sstItem)>/g,sstr2=/<\/(?:\w+:)?(?:si|sstItem)>/;function parse_sst_xml(E,r){var v=[],T="";if(!E)return v;var w=E.match(sstr0);if(w){T=w[2].replace(sstr1,"").split(sstr2);for(var S=0;S!=T.length;++S){var I=parse_si(T[S].trim(),r);I!=null&&(v[v.length]=I)}w=parsexmltag(w[1]),v.Count=w.count,v.Unique=w.uniqueCount}return v}function parse_BrtBeginSst(E){return[E.read_shift(4),E.read_shift(4)]}function parse_sst_bin(E,r){var v=[],T=!1;return recordhopper(E,function(S,I,H){switch(H){case 159:v.Count=S[0],v.Unique=S[1];break;case 19:v.push(S);break;case 160:return!0;case 35:T=!0;break;case 36:T=!1;break;default:if(I.T,!T||r.WTF)throw new Error("Unexpected record 0x"+H.toString(16))}}),v}function _JS2ANSI(E){for(var r=[],v=E.split(""),T=0;T<v.length;++T)r[T]=v[T].charCodeAt(0);return r}function parse_CRYPTOVersion(E,r){var v={};return v.Major=E.read_shift(2),v.Minor=E.read_shift(2),r>=4&&(E.l+=r-4),v}function parse_DataSpaceVersionInfo(E){var r={};return r.id=E.read_shift(0,"lpp4"),r.R=parse_CRYPTOVersion(E,4),r.U=parse_CRYPTOVersion(E,4),r.W=parse_CRYPTOVersion(E,4),r}function parse_DataSpaceMapEntry(E){for(var r=E.read_shift(4),v=E.l+r-4,T={},w=E.read_shift(4),S=[];w-- >0;)S.push({t:E.read_shift(4),v:E.read_shift(0,"lpp4")});if(T.name=E.read_shift(0,"lpp4"),T.comps=S,E.l!=v)throw new Error("Bad DataSpaceMapEntry: "+E.l+" != "+v);return T}function parse_DataSpaceMap(E){var r=[];E.l+=4;for(var v=E.read_shift(4);v-- >0;)r.push(parse_DataSpaceMapEntry(E));return r}function parse_DataSpaceDefinition(E){var r=[];E.l+=4;for(var v=E.read_shift(4);v-- >0;)r.push(E.read_shift(0,"lpp4"));return r}function parse_TransformInfoHeader(E){var r={};return E.read_shift(4),E.l+=4,r.id=E.read_shift(0,"lpp4"),r.name=E.read_shift(0,"lpp4"),r.R=parse_CRYPTOVersion(E,4),r.U=parse_CRYPTOVersion(E,4),r.W=parse_CRYPTOVersion(E,4),r}function parse_Primary(E){var r=parse_TransformInfoHeader(E);if(r.ename=E.read_shift(0,"8lpp4"),r.blksz=E.read_shift(4),r.cmode=E.read_shift(4),E.read_shift(4)!=4)throw new Error("Bad !Primary record");return r}function parse_EncryptionHeader(E,r){var v=E.l+r,T={};T.Flags=E.read_shift(4)&63,E.l+=4,T.AlgID=E.read_shift(4);var w=!1;switch(T.AlgID){case 26126:case 26127:case 26128:w=T.Flags==36;break;case 26625:w=T.Flags==4;break;case 0:w=T.Flags==16||T.Flags==4||T.Flags==36;break;default:throw"Unrecognized encryption algorithm: "+T.AlgID}if(!w)throw new Error("Encryption Flags/AlgID mismatch");return T.AlgIDHash=E.read_shift(4),T.KeySize=E.read_shift(4),T.ProviderType=E.read_shift(4),E.l+=8,T.CSPName=E.read_shift(v-E.l>>1,"utf16le"),E.l=v,T}function parse_EncryptionVerifier(E,r){var v={},T=E.l+r;return E.l+=4,v.Salt=E.slice(E.l,E.l+16),E.l+=16,v.Verifier=E.slice(E.l,E.l+16),E.l+=16,E.read_shift(4),v.VerifierHash=E.slice(E.l,T),E.l=T,v}function parse_EncryptionInfo(E){var r=parse_CRYPTOVersion(E);switch(r.Minor){case 2:return[r.Minor,parse_EncInfoStd(E)];case 3:return[r.Minor,parse_EncInfoExt()];case 4:return[r.Minor,parse_EncInfoAgl(E)]}throw new Error("ECMA-376 Encrypted file unrecognized Version: "+r.Minor)}function parse_EncInfoStd(E){var r=E.read_shift(4);if((r&63)!=36)throw new Error("EncryptionInfo mismatch");var v=E.read_shift(4),T=parse_EncryptionHeader(E,v),w=parse_EncryptionVerifier(E,E.length-E.l);return{t:"Std",h:T,v:w}}function parse_EncInfoExt(){throw new Error("File is password-protected: ECMA-376 Extensible")}function parse_EncInfoAgl(E){var r=["saltSize","blockSize","keyBits","hashSize","cipherAlgorithm","cipherChaining","hashAlgorithm","saltValue"];E.l+=4;var v=E.read_shift(E.length-E.l,"utf8"),T={};return v.replace(tagregex,function(S){var I=parsexmltag(S);switch(strip_ns(I[0])){case"<?xml":break;case"<encryption":case"</encryption>":break;case"<keyData":r.forEach(function(H){T[H]=I[H]});break;case"<dataIntegrity":T.encryptedHmacKey=I.encryptedHmacKey,T.encryptedHmacValue=I.encryptedHmacValue;break;case"<keyEncryptors>":case"<keyEncryptors":T.encs=[];break;case"</keyEncryptors>":break;case"<keyEncryptor":T.uri=I.uri;break;case"</keyEncryptor>":break;case"<encryptedKey":T.encs.push(I);break;default:throw I[0]}}),T}function parse_RC4CryptoHeader(E,r){var v={},T=v.EncryptionVersionInfo=parse_CRYPTOVersion(E,4);if(r-=4,T.Minor!=2)throw new Error("unrecognized minor version code: "+T.Minor);if(T.Major>4||T.Major<2)throw new Error("unrecognized major version code: "+T.Major);v.Flags=E.read_shift(4),r-=4;var w=E.read_shift(4);return r-=4,v.EncryptionHeader=parse_EncryptionHeader(E,w),r-=w,v.EncryptionVerifier=parse_EncryptionVerifier(E,r),v}function parse_RC4Header(E){var r={},v=r.EncryptionVersionInfo=parse_CRYPTOVersion(E,4);if(v.Major!=1||v.Minor!=1)throw"unrecognized version code "+v.Major+" : "+v.Minor;return r.Salt=E.read_shift(16),r.EncryptedVerifier=E.read_shift(16),r.EncryptedVerifierHash=E.read_shift(16),r}function crypto_CreatePasswordVerifier_Method1(E){var r=0,v,T=_JS2ANSI(E),w=T.length+1,S,I,H,te,ae;for(v=new_raw_buf(w),v[0]=T.length,S=1;S!=w;++S)v[S]=T[S-1];for(S=w-1;S>=0;--S)I=v[S],H=r&16384?1:0,te=r<<1&32767,ae=H|te,r=ae^I;return r^52811}var crypto_CreateXorArray_Method1=function(){var E=[187,255,255,186,255,255,185,128,0,190,15,0,191,15,0],r=[57840,7439,52380,33984,4364,3600,61902,12606,6258,57657,54287,34041,10252,43370,20163],v=[44796,19929,39858,10053,20106,40212,10761,31585,63170,64933,60267,50935,40399,11199,17763,35526,1453,2906,5812,11624,23248,885,1770,3540,7080,14160,28320,56640,55369,41139,20807,41614,21821,43642,17621,28485,56970,44341,19019,38038,14605,29210,60195,50791,40175,10751,21502,43004,24537,18387,36774,3949,7898,15796,31592,63184,47201,24803,49606,37805,14203,28406,56812,17824,35648,1697,3394,6788,13576,27152,43601,17539,35078,557,1114,2228,4456,30388,60776,51953,34243,7079,14158,28316,14128,28256,56512,43425,17251,34502,7597,13105,26210,52420,35241,883,1766,3532,4129,8258,16516,33032,4657,9314,18628],T=function(I){return(I/2|I*128)&255},w=function(I,H){return T(I^H)},S=function(I){for(var H=r[I.length-1],te=104,ae=I.length-1;ae>=0;--ae)for(var ie=I[ae],ce=0;ce!=7;++ce)ie&64&&(H^=v[te]),ie*=2,--te;return H};return function(I){for(var H=_JS2ANSI(I),te=S(H),ae=H.length,ie=new_raw_buf(16),ce=0;ce!=16;++ce)ie[ce]=0;var me,_e,Re;for((ae&1)===1&&(me=te>>8,ie[ae]=w(E[0],me),--ae,me=te&255,_e=H[H.length-1],ie[ae]=w(_e,me));ae>0;)--ae,me=te>>8,ie[ae]=w(H[ae],me),--ae,me=te&255,ie[ae]=w(H[ae],me);for(ae=15,Re=15-H.length;Re>0;)me=te>>8,ie[ae]=w(E[Re],me),--ae,--Re,me=te&255,ie[ae]=w(H[ae],me),--ae,--Re;return ie}}(),crypto_DecryptData_Method1=function(E,r,v,T,w){w||(w=r),T||(T=crypto_CreateXorArray_Method1(E));var S,I;for(S=0;S!=r.length;++S)I=r[S],I^=T[v],I=(I>>5|I<<3)&255,w[S]=I,++v;return[w,v,T]},crypto_MakeXorDecryptor=function(E){var r=0,v=crypto_CreateXorArray_Method1(E);return function(T){var w=crypto_DecryptData_Method1("",T,r,v);return r=w[1],w[0]}};function parse_XORObfuscation(E,r,v,T){var w={key:parseuint16(E),verificationBytes:parseuint16(E)};return v.password&&(w.verifier=crypto_CreatePasswordVerifier_Method1(v.password)),T.valid=w.verificationBytes===w.verifier,T.valid&&(T.insitu=crypto_MakeXorDecryptor(v.password)),w}function parse_FilePassHeader(E,r,v){var T=v||{};return T.Info=E.read_shift(2),E.l-=2,T.Info===1?T.Data=parse_RC4Header(E):T.Data=parse_RC4CryptoHeader(E,r),T}function parse_FilePass(E,r,v){var T={Type:v.biff>=8?E.read_shift(2):0};return T.Type?parse_FilePassHeader(E,r-2,T):parse_XORObfuscation(E,v.biff>=8?r:r-2,v,T),T}var RTF=function(){function E(w,S){switch(S.type){case"base64":return r(Base64_decode(w),S);case"binary":return r(w,S);case"buffer":return r(has_buf&&Buffer.isBuffer(w)?w.toString("binary"):a2s(w),S);case"array":return r(cc2str(w),S)}throw new Error("Unrecognized type "+S.type)}function r(w,S){var I=S||{},H=I.dense?[]:{},te=w.match(/\\trowd.*?\\row\b/g);if(!te.length)throw new Error("RTF missing table");var ae={s:{c:0,r:0},e:{c:0,r:te.length-1}};return te.forEach(function(ie,ce){Array.isArray(H)&&(H[ce]=[]);for(var me=/\\\w+\b/g,_e=0,Re,Pe=-1;Re=me.exec(ie);){switch(Re[0]){case"\\cell":var Ce=ie.slice(_e,me.lastIndex-Re[0].length);if(Ce[0]==" "&&(Ce=Ce.slice(1)),++Pe,Ce.length){var Fe={v:Ce,t:"s"};Array.isArray(H)?H[ce][Pe]=Fe:H[encode_cell({r:ce,c:Pe})]=Fe}break}_e=me.lastIndex}Pe>ae.e.c&&(ae.e.c=Pe)}),H["!ref"]=encode_range(ae),H}function v(w,S){return sheet_to_workbook(E(w,S),S)}function T(w){for(var S=["{\\rtf1\\ansi"],I=safe_decode_range(w["!ref"]),H,te=Array.isArray(w),ae=I.s.r;ae<=I.e.r;++ae){S.push("\\trowd\\trautofit1");for(var ie=I.s.c;ie<=I.e.c;++ie)S.push("\\cellx"+(ie+1));for(S.push("\\pard\\intbl"),ie=I.s.c;ie<=I.e.c;++ie){var ce=encode_cell({r:ae,c:ie});H=te?(w[ae]||[])[ie]:w[ce],!(!H||H.v==null&&(!H.f||H.F))&&(S.push(" "+(H.w||(format_cell(H),H.w))),S.push("\\cell"))}S.push("\\pard\\intbl\\row")}return S.join("")+"}"}return{to_workbook:v,to_sheet:E,from_sheet:T}}();function hex2RGB(E){var r=E.slice(E[0]==="#"?1:0).slice(0,6);return[parseInt(r.slice(0,2),16),parseInt(r.slice(2,4),16),parseInt(r.slice(4,6),16)]}function rgb2Hex(E){for(var r=0,v=1;r!=3;++r)v=v*256+(E[r]>255?255:E[r]<0?0:E[r]);return v.toString(16).toUpperCase().slice(1)}function rgb2HSL(E){var r=E[0]/255,v=E[1]/255,T=E[2]/255,w=Math.max(r,v,T),S=Math.min(r,v,T),I=w-S;if(I===0)return[0,0,r];var H=0,te=0,ae=w+S;switch(te=I/(ae>1?2-ae:ae),w){case r:H=((v-T)/I+6)%6;break;case v:H=(T-r)/I+2;break;case T:H=(r-v)/I+4;break}return[H/6,te,ae/2]}function hsl2RGB(E){var r=E[0],v=E[1],T=E[2],w=v*2*(T<.5?T:1-T),S=T-w/2,I=[S,S,S],H=6*r,te;if(v!==0)switch(H|0){case 0:case 6:te=w*H,I[0]+=w,I[1]+=te;break;case 1:te=w*(2-H),I[0]+=te,I[1]+=w;break;case 2:te=w*(H-2),I[1]+=w,I[2]+=te;break;case 3:te=w*(4-H),I[1]+=te,I[2]+=w;break;case 4:te=w*(H-4),I[2]+=w,I[0]+=te;break;case 5:te=w*(6-H),I[2]+=te,I[0]+=w;break}for(var ae=0;ae!=3;++ae)I[ae]=Math.round(I[ae]*255);return I}function rgb_tint(E,r){if(r===0)return E;var v=rgb2HSL(hex2RGB(E));return r<0?v[2]=v[2]*(1+r):v[2]=1-(1-v[2])*(1-r),rgb2Hex(hsl2RGB(v))}var DEF_MDW=6,MAX_MDW=15,MIN_MDW=1,MDW=DEF_MDW;function width2px(E){return Math.floor((E+Math.round(128/MDW)/256)*MDW)}function px2char(E){return Math.floor((E-5)/MDW*100+.5)/100}function char2width(E){return Math.round((E*MDW+5)/MDW*256)/256}function cycle_width(E){return char2width(px2char(width2px(E)))}function find_mdw_colw(E){var r=Math.abs(E-cycle_width(E)),v=MDW;if(r>.005)for(MDW=MIN_MDW;MDW<MAX_MDW;++MDW)Math.abs(E-cycle_width(E))<=r&&(r=Math.abs(E-cycle_width(E)),v=MDW);MDW=v}function process_col(E){E.width?(E.wpx=width2px(E.width),E.wch=px2char(E.wpx),E.MDW=MDW):E.wpx?(E.wch=px2char(E.wpx),E.width=char2width(E.wch),E.MDW=MDW):typeof E.wch=="number"&&(E.width=char2width(E.wch),E.wpx=width2px(E.width),E.MDW=MDW),E.customWidth&&delete E.customWidth}var DEF_PPI=96,PPI=DEF_PPI;function px2pt(E){return E*96/PPI}function pt2px(E){return E*PPI/96}var XLMLPatternTypeMap={None:"none",Solid:"solid",Gray50:"mediumGray",Gray75:"darkGray",Gray25:"lightGray",HorzStripe:"darkHorizontal",VertStripe:"darkVertical",ReverseDiagStripe:"darkDown",DiagStripe:"darkUp",DiagCross:"darkGrid",ThickDiagCross:"darkTrellis",ThinHorzStripe:"lightHorizontal",ThinVertStripe:"lightVertical",ThinReverseDiagStripe:"lightDown",ThinHorzCross:"lightGrid"};function parse_borders(E,r,v,T){r.Borders=[];var w={},S=!1;(E[0].match(tagregex)||[]).forEach(function(I){var H=parsexmltag(I);switch(strip_ns(H[0])){case"<borders":case"<borders>":case"</borders>":break;case"<border":case"<border>":case"<border/>":w={},H.diagonalUp&&(w.diagonalUp=parsexmlbool(H.diagonalUp)),H.diagonalDown&&(w.diagonalDown=parsexmlbool(H.diagonalDown)),r.Borders.push(w);break;case"</border>":break;case"<left/>":break;case"<left":case"<left>":break;case"</left>":break;case"<right/>":break;case"<right":case"<right>":break;case"</right>":break;case"<top/>":break;case"<top":case"<top>":break;case"</top>":break;case"<bottom/>":break;case"<bottom":case"<bottom>":break;case"</bottom>":break;case"<diagonal":case"<diagonal>":case"<diagonal/>":break;case"</diagonal>":break;case"<horizontal":case"<horizontal>":case"<horizontal/>":break;case"</horizontal>":break;case"<vertical":case"<vertical>":case"<vertical/>":break;case"</vertical>":break;case"<start":case"<start>":case"<start/>":break;case"</start>":break;case"<end":case"<end>":case"<end/>":break;case"</end>":break;case"<color":case"<color>":break;case"<color/>":case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":S=!0;break;case"</ext>":S=!1;break;default:if(T&&T.WTF&&!S)throw new Error("unrecognized "+H[0]+" in borders")}})}function parse_fills(E,r,v,T){r.Fills=[];var w={},S=!1;(E[0].match(tagregex)||[]).forEach(function(I){var H=parsexmltag(I);switch(strip_ns(H[0])){case"<fills":case"<fills>":case"</fills>":break;case"<fill>":case"<fill":case"<fill/>":w={},r.Fills.push(w);break;case"</fill>":break;case"<gradientFill>":break;case"<gradientFill":case"</gradientFill>":r.Fills.push(w),w={};break;case"<patternFill":case"<patternFill>":H.patternType&&(w.patternType=H.patternType);break;case"<patternFill/>":case"</patternFill>":break;case"<bgColor":w.bgColor||(w.bgColor={}),H.indexed&&(w.bgColor.indexed=parseInt(H.indexed,10)),H.theme&&(w.bgColor.theme=parseInt(H.theme,10)),H.tint&&(w.bgColor.tint=parseFloat(H.tint)),H.rgb&&(w.bgColor.rgb=H.rgb.slice(-6));break;case"<bgColor/>":case"</bgColor>":break;case"<fgColor":w.fgColor||(w.fgColor={}),H.theme&&(w.fgColor.theme=parseInt(H.theme,10)),H.tint&&(w.fgColor.tint=parseFloat(H.tint)),H.rgb!=null&&(w.fgColor.rgb=H.rgb.slice(-6));break;case"<fgColor/>":case"</fgColor>":break;case"<stop":case"<stop/>":break;case"</stop>":break;case"<color":case"<color/>":break;case"</color>":break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":S=!0;break;case"</ext>":S=!1;break;default:if(T&&T.WTF&&!S)throw new Error("unrecognized "+H[0]+" in fills")}})}function parse_fonts(E,r,v,T){r.Fonts=[];var w={},S=!1;(E[0].match(tagregex)||[]).forEach(function(I){var H=parsexmltag(I);switch(strip_ns(H[0])){case"<fonts":case"<fonts>":case"</fonts>":break;case"<font":case"<font>":break;case"</font>":case"<font/>":r.Fonts.push(w),w={};break;case"<name":H.val&&(w.name=utf8read(H.val));break;case"<name/>":case"</name>":break;case"<b":w.bold=H.val?parsexmlbool(H.val):1;break;case"<b/>":w.bold=1;break;case"<i":w.italic=H.val?parsexmlbool(H.val):1;break;case"<i/>":w.italic=1;break;case"<u":switch(H.val){case"none":w.underline=0;break;case"single":w.underline=1;break;case"double":w.underline=2;break;case"singleAccounting":w.underline=33;break;case"doubleAccounting":w.underline=34;break}break;case"<u/>":w.underline=1;break;case"<strike":w.strike=H.val?parsexmlbool(H.val):1;break;case"<strike/>":w.strike=1;break;case"<outline":w.outline=H.val?parsexmlbool(H.val):1;break;case"<outline/>":w.outline=1;break;case"<shadow":w.shadow=H.val?parsexmlbool(H.val):1;break;case"<shadow/>":w.shadow=1;break;case"<condense":w.condense=H.val?parsexmlbool(H.val):1;break;case"<condense/>":w.condense=1;break;case"<extend":w.extend=H.val?parsexmlbool(H.val):1;break;case"<extend/>":w.extend=1;break;case"<sz":H.val&&(w.sz=+H.val);break;case"<sz/>":case"</sz>":break;case"<vertAlign":H.val&&(w.vertAlign=H.val);break;case"<vertAlign/>":case"</vertAlign>":break;case"<family":H.val&&(w.family=parseInt(H.val,10));break;case"<family/>":case"</family>":break;case"<scheme":H.val&&(w.scheme=H.val);break;case"<scheme/>":case"</scheme>":break;case"<charset":if(H.val=="1")break;H.codepage=CS2CP[parseInt(H.val,10)];break;case"<color":if(w.color||(w.color={}),H.auto&&(w.color.auto=parsexmlbool(H.auto)),H.rgb)w.color.rgb=H.rgb.slice(-6);else if(H.indexed){w.color.index=parseInt(H.indexed,10);var te=XLSIcv[w.color.index];w.color.index==81&&(te=XLSIcv[1]),te||(te=XLSIcv[1]),w.color.rgb=te[0].toString(16)+te[1].toString(16)+te[2].toString(16)}else H.theme&&(w.color.theme=parseInt(H.theme,10),H.tint&&(w.color.tint=parseFloat(H.tint)),H.theme&&v.themeElements&&v.themeElements.clrScheme&&(w.color.rgb=rgb_tint(v.themeElements.clrScheme[w.color.theme].rgb,w.color.tint||0)));break;case"<color/>":case"</color>":break;case"<AlternateContent":S=!0;break;case"</AlternateContent>":S=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":S=!0;break;case"</ext>":S=!1;break;default:if(T&&T.WTF&&!S)throw new Error("unrecognized "+H[0]+" in fonts")}})}function parse_numFmts(E,r,v){r.NumberFmt=[];for(var T=keys(table_fmt),w=0;w<T.length;++w)r.NumberFmt[T[w]]=table_fmt[T[w]];var S=E[0].match(tagregex);if(S)for(w=0;w<S.length;++w){var I=parsexmltag(S[w]);switch(strip_ns(I[0])){case"<numFmts":case"</numFmts>":case"<numFmts/>":case"<numFmts>":break;case"<numFmt":{var H=unescapexml(utf8read(I.formatCode)),te=parseInt(I.numFmtId,10);if(r.NumberFmt[te]=H,te>0){if(te>392){for(te=392;te>60&&r.NumberFmt[te]!=null;--te);r.NumberFmt[te]=H}SSF_load(H,te)}}break;case"</numFmt>":break;default:if(v.WTF)throw new Error("unrecognized "+I[0]+" in numFmts")}}}var cellXF_uint=["numFmtId","fillId","fontId","borderId","xfId"],cellXF_bool=["applyAlignment","applyBorder","applyFill","applyFont","applyNumberFormat","applyProtection","pivotButton","quotePrefix"];function parse_cellXfs(E,r,v){r.CellXf=[];var T,w=!1;(E[0].match(tagregex)||[]).forEach(function(S){var I=parsexmltag(S),H=0;switch(strip_ns(I[0])){case"<cellXfs":case"<cellXfs>":case"<cellXfs/>":case"</cellXfs>":break;case"<xf":case"<xf/>":for(T=I,delete T[0],H=0;H<cellXF_uint.length;++H)T[cellXF_uint[H]]&&(T[cellXF_uint[H]]=parseInt(T[cellXF_uint[H]],10));for(H=0;H<cellXF_bool.length;++H)T[cellXF_bool[H]]&&(T[cellXF_bool[H]]=parsexmlbool(T[cellXF_bool[H]]));if(r.NumberFmt&&T.numFmtId>392){for(H=392;H>60;--H)if(r.NumberFmt[T.numFmtId]==r.NumberFmt[H]){T.numFmtId=H;break}}r.CellXf.push(T);break;case"</xf>":break;case"<alignment":case"<alignment/>":var te={};I.vertical&&(te.vertical=I.vertical),I.horizontal&&(te.horizontal=I.horizontal),I.textRotation!=null&&(te.textRotation=I.textRotation),I.indent&&(te.indent=I.indent),I.wrapText&&(te.wrapText=parsexmlbool(I.wrapText)),T.alignment=te;break;case"</alignment>":break;case"<protection":break;case"</protection>":case"<protection/>":break;case"<AlternateContent":w=!0;break;case"</AlternateContent>":w=!1;break;case"<extLst":case"<extLst>":case"</extLst>":break;case"<ext":w=!0;break;case"</ext>":w=!1;break;default:if(v&&v.WTF&&!w)throw new Error("unrecognized "+I[0]+" in cellXfs")}})}var parse_sty_xml=function E(){var r=/<(?:\w+:)?numFmts([^>]*)>[\S\s]*?<\/(?:\w+:)?numFmts>/,v=/<(?:\w+:)?cellXfs([^>]*)>[\S\s]*?<\/(?:\w+:)?cellXfs>/,T=/<(?:\w+:)?fills([^>]*)>[\S\s]*?<\/(?:\w+:)?fills>/,w=/<(?:\w+:)?fonts([^>]*)>[\S\s]*?<\/(?:\w+:)?fonts>/,S=/<(?:\w+:)?borders([^>]*)>[\S\s]*?<\/(?:\w+:)?borders>/;return function(H,te,ae){var ie={};if(!H)return ie;H=H.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");var ce;return(ce=H.match(r))&&parse_numFmts(ce,ie,ae),(ce=H.match(w))&&parse_fonts(ce,ie,te,ae),(ce=H.match(T))&&parse_fills(ce,ie,te,ae),(ce=H.match(S))&&parse_borders(ce,ie,te,ae),(ce=H.match(v))&&parse_cellXfs(ce,ie,ae),ie}}();function parse_BrtFmt(E,r){var v=E.read_shift(2),T=parse_XLWideString(E);return[v,T]}function parse_BrtFont(E,r,v){var T={};T.sz=E.read_shift(2)/20;var w=parse_FontFlags(E);w.fItalic&&(T.italic=1),w.fCondense&&(T.condense=1),w.fExtend&&(T.extend=1),w.fShadow&&(T.shadow=1),w.fOutline&&(T.outline=1),w.fStrikeout&&(T.strike=1);var S=E.read_shift(2);switch(S===700&&(T.bold=1),E.read_shift(2)){case 1:T.vertAlign="superscript";break;case 2:T.vertAlign="subscript";break}var I=E.read_shift(1);I!=0&&(T.underline=I);var H=E.read_shift(1);H>0&&(T.family=H);var te=E.read_shift(1);switch(te>0&&(T.charset=te),E.l++,T.color=parse_BrtColor(E),E.read_shift(1)){case 1:T.scheme="major";break;case 2:T.scheme="minor";break}return T.name=parse_XLWideString(E),T}var parse_BrtFill=parsenoop;function parse_BrtXF(E,r){var v=E.l+r,T=E.read_shift(2),w=E.read_shift(2);return E.l=v,{ixfe:T,numFmtId:w}}var parse_BrtBorder=parsenoop;function parse_sty_bin(E,r,v){var T={};T.NumberFmt=[];for(var w in table_fmt)T.NumberFmt[w]=table_fmt[w];T.CellXf=[],T.Fonts=[];var S=[],I=!1;return recordhopper(E,function(te,ae,ie){switch(ie){case 44:T.NumberFmt[te[0]]=te[1],SSF_load(te[1],te[0]);break;case 43:T.Fonts.push(te),te.color.theme!=null&&r&&r.themeElements&&r.themeElements.clrScheme&&(te.color.rgb=rgb_tint(r.themeElements.clrScheme[te.color.theme].rgb,te.color.tint||0));break;case 1025:break;case 45:break;case 46:break;case 47:S[S.length-1]==617&&T.CellXf.push(te);break;case 48:case 507:case 572:case 475:break;case 1171:case 2102:case 1130:case 512:case 2095:case 3072:break;case 35:I=!0;break;case 36:I=!1;break;case 37:S.push(ie),I=!0;break;case 38:S.pop(),I=!1;break;default:if(ae.T>0)S.push(ie);else if(ae.T<0)S.pop();else if(!I||v.WTF&&S[S.length-1]!=37)throw new Error("Unexpected record 0x"+ie.toString(16))}}),T}var XLSXThemeClrScheme=["</a:lt1>","</a:dk1>","</a:lt2>","</a:dk2>","</a:accent1>","</a:accent2>","</a:accent3>","</a:accent4>","</a:accent5>","</a:accent6>","</a:hlink>","</a:folHlink>"];function parse_clrScheme(E,r,v){r.themeElements.clrScheme=[];var T={};(E[0].match(tagregex)||[]).forEach(function(w){var S=parsexmltag(w);switch(S[0]){case"<a:clrScheme":case"</a:clrScheme>":break;case"<a:srgbClr":T.rgb=S.val;break;case"<a:sysClr":T.rgb=S.lastClr;break;case"<a:dk1>":case"</a:dk1>":case"<a:lt1>":case"</a:lt1>":case"<a:dk2>":case"</a:dk2>":case"<a:lt2>":case"</a:lt2>":case"<a:accent1>":case"</a:accent1>":case"<a:accent2>":case"</a:accent2>":case"<a:accent3>":case"</a:accent3>":case"<a:accent4>":case"</a:accent4>":case"<a:accent5>":case"</a:accent5>":case"<a:accent6>":case"</a:accent6>":case"<a:hlink>":case"</a:hlink>":case"<a:folHlink>":case"</a:folHlink>":S[0].charAt(1)==="/"?(r.themeElements.clrScheme[XLSXThemeClrScheme.indexOf(S[0])]=T,T={}):T.name=S[0].slice(3,S[0].length-1);break;default:if(v&&v.WTF)throw new Error("Unrecognized "+S[0]+" in clrScheme")}})}function parse_fontScheme(){}function parse_fmtScheme(){}var clrsregex=/<a:clrScheme([^>]*)>[\s\S]*<\/a:clrScheme>/,fntsregex=/<a:fontScheme([^>]*)>[\s\S]*<\/a:fontScheme>/,fmtsregex=/<a:fmtScheme([^>]*)>[\s\S]*<\/a:fmtScheme>/;function parse_themeElements(E,r,v){r.themeElements={};var T;[["clrScheme",clrsregex,parse_clrScheme],["fontScheme",fntsregex,parse_fontScheme],["fmtScheme",fmtsregex,parse_fmtScheme]].forEach(function(w){if(!(T=E.match(w[1])))throw new Error(w[0]+" not found in themeElements");w[2](T,r,v)})}var themeltregex=/<a:themeElements([^>]*)>[\s\S]*<\/a:themeElements>/;function parse_theme_xml(E,r){(!E||E.length===0)&&(E=write_theme());var v,T={};if(!(v=E.match(themeltregex)))throw new Error("themeElements not found in theme");return parse_themeElements(v[0],T,r),T.raw=E,T}function write_theme(E,r){var v=[XML_HEADER];return v[v.length]='<a:theme xmlns:a="http://schemas.openxmlformats.org/drawingml/2006/main" name="Office Theme">',v[v.length]="<a:themeElements>",v[v.length]='<a:clrScheme name="Office">',v[v.length]='<a:dk1><a:sysClr val="windowText" lastClr="000000"/></a:dk1>',v[v.length]='<a:lt1><a:sysClr val="window" lastClr="FFFFFF"/></a:lt1>',v[v.length]='<a:dk2><a:srgbClr val="1F497D"/></a:dk2>',v[v.length]='<a:lt2><a:srgbClr val="EEECE1"/></a:lt2>',v[v.length]='<a:accent1><a:srgbClr val="4F81BD"/></a:accent1>',v[v.length]='<a:accent2><a:srgbClr val="C0504D"/></a:accent2>',v[v.length]='<a:accent3><a:srgbClr val="9BBB59"/></a:accent3>',v[v.length]='<a:accent4><a:srgbClr val="8064A2"/></a:accent4>',v[v.length]='<a:accent5><a:srgbClr val="4BACC6"/></a:accent5>',v[v.length]='<a:accent6><a:srgbClr val="F79646"/></a:accent6>',v[v.length]='<a:hlink><a:srgbClr val="0000FF"/></a:hlink>',v[v.length]='<a:folHlink><a:srgbClr val="800080"/></a:folHlink>',v[v.length]="</a:clrScheme>",v[v.length]='<a:fontScheme name="Office">',v[v.length]="<a:majorFont>",v[v.length]='<a:latin typeface="Cambria"/>',v[v.length]='<a:ea typeface=""/>',v[v.length]='<a:cs typeface=""/>',v[v.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',v[v.length]='<a:font script="Hang" typeface="맑은 고딕"/>',v[v.length]='<a:font script="Hans" typeface="宋体"/>',v[v.length]='<a:font script="Hant" typeface="新細明體"/>',v[v.length]='<a:font script="Arab" typeface="Times New Roman"/>',v[v.length]='<a:font script="Hebr" typeface="Times New Roman"/>',v[v.length]='<a:font script="Thai" typeface="Tahoma"/>',v[v.length]='<a:font script="Ethi" typeface="Nyala"/>',v[v.length]='<a:font script="Beng" typeface="Vrinda"/>',v[v.length]='<a:font script="Gujr" typeface="Shruti"/>',v[v.length]='<a:font script="Khmr" typeface="MoolBoran"/>',v[v.length]='<a:font script="Knda" typeface="Tunga"/>',v[v.length]='<a:font script="Guru" typeface="Raavi"/>',v[v.length]='<a:font script="Cans" typeface="Euphemia"/>',v[v.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',v[v.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',v[v.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',v[v.length]='<a:font script="Thaa" typeface="MV Boli"/>',v[v.length]='<a:font script="Deva" typeface="Mangal"/>',v[v.length]='<a:font script="Telu" typeface="Gautami"/>',v[v.length]='<a:font script="Taml" typeface="Latha"/>',v[v.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',v[v.length]='<a:font script="Orya" typeface="Kalinga"/>',v[v.length]='<a:font script="Mlym" typeface="Kartika"/>',v[v.length]='<a:font script="Laoo" typeface="DokChampa"/>',v[v.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',v[v.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',v[v.length]='<a:font script="Viet" typeface="Times New Roman"/>',v[v.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',v[v.length]='<a:font script="Geor" typeface="Sylfaen"/>',v[v.length]="</a:majorFont>",v[v.length]="<a:minorFont>",v[v.length]='<a:latin typeface="Calibri"/>',v[v.length]='<a:ea typeface=""/>',v[v.length]='<a:cs typeface=""/>',v[v.length]='<a:font script="Jpan" typeface="ＭＳ Ｐゴシック"/>',v[v.length]='<a:font script="Hang" typeface="맑은 고딕"/>',v[v.length]='<a:font script="Hans" typeface="宋体"/>',v[v.length]='<a:font script="Hant" typeface="新細明體"/>',v[v.length]='<a:font script="Arab" typeface="Arial"/>',v[v.length]='<a:font script="Hebr" typeface="Arial"/>',v[v.length]='<a:font script="Thai" typeface="Tahoma"/>',v[v.length]='<a:font script="Ethi" typeface="Nyala"/>',v[v.length]='<a:font script="Beng" typeface="Vrinda"/>',v[v.length]='<a:font script="Gujr" typeface="Shruti"/>',v[v.length]='<a:font script="Khmr" typeface="DaunPenh"/>',v[v.length]='<a:font script="Knda" typeface="Tunga"/>',v[v.length]='<a:font script="Guru" typeface="Raavi"/>',v[v.length]='<a:font script="Cans" typeface="Euphemia"/>',v[v.length]='<a:font script="Cher" typeface="Plantagenet Cherokee"/>',v[v.length]='<a:font script="Yiii" typeface="Microsoft Yi Baiti"/>',v[v.length]='<a:font script="Tibt" typeface="Microsoft Himalaya"/>',v[v.length]='<a:font script="Thaa" typeface="MV Boli"/>',v[v.length]='<a:font script="Deva" typeface="Mangal"/>',v[v.length]='<a:font script="Telu" typeface="Gautami"/>',v[v.length]='<a:font script="Taml" typeface="Latha"/>',v[v.length]='<a:font script="Syrc" typeface="Estrangelo Edessa"/>',v[v.length]='<a:font script="Orya" typeface="Kalinga"/>',v[v.length]='<a:font script="Mlym" typeface="Kartika"/>',v[v.length]='<a:font script="Laoo" typeface="DokChampa"/>',v[v.length]='<a:font script="Sinh" typeface="Iskoola Pota"/>',v[v.length]='<a:font script="Mong" typeface="Mongolian Baiti"/>',v[v.length]='<a:font script="Viet" typeface="Arial"/>',v[v.length]='<a:font script="Uigh" typeface="Microsoft Uighur"/>',v[v.length]='<a:font script="Geor" typeface="Sylfaen"/>',v[v.length]="</a:minorFont>",v[v.length]="</a:fontScheme>",v[v.length]='<a:fmtScheme name="Office">',v[v.length]="<a:fillStyleLst>",v[v.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',v[v.length]='<a:gradFill rotWithShape="1">',v[v.length]="<a:gsLst>",v[v.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="50000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',v[v.length]='<a:gs pos="35000"><a:schemeClr val="phClr"><a:tint val="37000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',v[v.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="15000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',v[v.length]="</a:gsLst>",v[v.length]='<a:lin ang="16200000" scaled="1"/>',v[v.length]="</a:gradFill>",v[v.length]='<a:gradFill rotWithShape="1">',v[v.length]="<a:gsLst>",v[v.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="100000"/><a:shade val="100000"/><a:satMod val="130000"/></a:schemeClr></a:gs>',v[v.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:tint val="50000"/><a:shade val="100000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',v[v.length]="</a:gsLst>",v[v.length]='<a:lin ang="16200000" scaled="0"/>',v[v.length]="</a:gradFill>",v[v.length]="</a:fillStyleLst>",v[v.length]="<a:lnStyleLst>",v[v.length]='<a:ln w="9525" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"><a:shade val="95000"/><a:satMod val="105000"/></a:schemeClr></a:solidFill><a:prstDash val="solid"/></a:ln>',v[v.length]='<a:ln w="25400" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',v[v.length]='<a:ln w="38100" cap="flat" cmpd="sng" algn="ctr"><a:solidFill><a:schemeClr val="phClr"/></a:solidFill><a:prstDash val="solid"/></a:ln>',v[v.length]="</a:lnStyleLst>",v[v.length]="<a:effectStyleLst>",v[v.length]="<a:effectStyle>",v[v.length]="<a:effectLst>",v[v.length]='<a:outerShdw blurRad="40000" dist="20000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="38000"/></a:srgbClr></a:outerShdw>',v[v.length]="</a:effectLst>",v[v.length]="</a:effectStyle>",v[v.length]="<a:effectStyle>",v[v.length]="<a:effectLst>",v[v.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',v[v.length]="</a:effectLst>",v[v.length]="</a:effectStyle>",v[v.length]="<a:effectStyle>",v[v.length]="<a:effectLst>",v[v.length]='<a:outerShdw blurRad="40000" dist="23000" dir="5400000" rotWithShape="0"><a:srgbClr val="000000"><a:alpha val="35000"/></a:srgbClr></a:outerShdw>',v[v.length]="</a:effectLst>",v[v.length]='<a:scene3d><a:camera prst="orthographicFront"><a:rot lat="0" lon="0" rev="0"/></a:camera><a:lightRig rig="threePt" dir="t"><a:rot lat="0" lon="0" rev="1200000"/></a:lightRig></a:scene3d>',v[v.length]='<a:sp3d><a:bevelT w="63500" h="25400"/></a:sp3d>',v[v.length]="</a:effectStyle>",v[v.length]="</a:effectStyleLst>",v[v.length]="<a:bgFillStyleLst>",v[v.length]='<a:solidFill><a:schemeClr val="phClr"/></a:solidFill>',v[v.length]='<a:gradFill rotWithShape="1">',v[v.length]="<a:gsLst>",v[v.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="40000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',v[v.length]='<a:gs pos="40000"><a:schemeClr val="phClr"><a:tint val="45000"/><a:shade val="99000"/><a:satMod val="350000"/></a:schemeClr></a:gs>',v[v.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="20000"/><a:satMod val="255000"/></a:schemeClr></a:gs>',v[v.length]="</a:gsLst>",v[v.length]='<a:path path="circle"><a:fillToRect l="50000" t="-80000" r="50000" b="180000"/></a:path>',v[v.length]="</a:gradFill>",v[v.length]='<a:gradFill rotWithShape="1">',v[v.length]="<a:gsLst>",v[v.length]='<a:gs pos="0"><a:schemeClr val="phClr"><a:tint val="80000"/><a:satMod val="300000"/></a:schemeClr></a:gs>',v[v.length]='<a:gs pos="100000"><a:schemeClr val="phClr"><a:shade val="30000"/><a:satMod val="200000"/></a:schemeClr></a:gs>',v[v.length]="</a:gsLst>",v[v.length]='<a:path path="circle"><a:fillToRect l="50000" t="50000" r="50000" b="50000"/></a:path>',v[v.length]="</a:gradFill>",v[v.length]="</a:bgFillStyleLst>",v[v.length]="</a:fmtScheme>",v[v.length]="</a:themeElements>",v[v.length]="<a:objectDefaults>",v[v.length]="<a:spDef>",v[v.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="1"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="3"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="2"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="lt1"/></a:fontRef></a:style>',v[v.length]="</a:spDef>",v[v.length]="<a:lnDef>",v[v.length]='<a:spPr/><a:bodyPr/><a:lstStyle/><a:style><a:lnRef idx="2"><a:schemeClr val="accent1"/></a:lnRef><a:fillRef idx="0"><a:schemeClr val="accent1"/></a:fillRef><a:effectRef idx="1"><a:schemeClr val="accent1"/></a:effectRef><a:fontRef idx="minor"><a:schemeClr val="tx1"/></a:fontRef></a:style>',v[v.length]="</a:lnDef>",v[v.length]="</a:objectDefaults>",v[v.length]="<a:extraClrSchemeLst/>",v[v.length]="</a:theme>",v.join("")}function parse_Theme(E,r,v){var T=E.l+r,w=E.read_shift(4);if(w!==124226){if(!v.cellStyles){E.l=T;return}var S=E.slice(E.l);E.l=T;var I;try{I=zip_read(S,{type:"array"})}catch{return}var H=getzipstr(I,"theme/theme/theme1.xml",!0);if(H)return parse_theme_xml(H,v)}}function parse_ColorTheme(E){return E.read_shift(4)}function parse_FullColorExt(E){var r={};switch(r.xclrType=E.read_shift(2),r.nTintShade=E.read_shift(2),r.xclrType){case 0:E.l+=4;break;case 1:r.xclrValue=parse_IcvXF(E,4);break;case 2:r.xclrValue=parse_LongRGBA(E);break;case 3:r.xclrValue=parse_ColorTheme(E);break;case 4:E.l+=4;break}return E.l+=8,r}function parse_IcvXF(E,r){return parsenoop(E,r)}function parse_XFExtGradient(E,r){return parsenoop(E,r)}function parse_ExtProp(E){var r=E.read_shift(2),v=E.read_shift(2)-4,T=[r];switch(r){case 4:case 5:case 7:case 8:case 9:case 10:case 11:case 13:T[1]=parse_FullColorExt(E);break;case 6:T[1]=parse_XFExtGradient(E,v);break;case 14:case 15:T[1]=E.read_shift(v===1?1:2);break;default:throw new Error("Unrecognized ExtProp type: "+r+" "+v)}return T}function parse_XFExt(E,r){var v=E.l+r;E.l+=2;var T=E.read_shift(2);E.l+=2;for(var w=E.read_shift(2),S=[];w-- >0;)S.push(parse_ExtProp(E,v-E.l));return{ixfe:T,ext:S}}function update_xfext(E,r){r.forEach(function(v){switch(v[0]){}})}function parse_BrtMdtinfo(E,r){return{flags:E.read_shift(4),version:E.read_shift(4),name:parse_XLWideString(E)}}function parse_BrtMdb(E){for(var r=[],v=E.read_shift(4);v-- >0;)r.push([E.read_shift(4),E.read_shift(4)]);return r}function parse_BrtBeginEsmdb(E){return E.l+=4,E.read_shift(4)!=0}function parse_xlmeta_bin(E,r,v){var T={Types:[],Cell:[],Value:[]},w=v||{},S=[],I=!1,H=2;return recordhopper(E,function(te,ae,ie){switch(ie){case 335:T.Types.push({name:te.name});break;case 51:te.forEach(function(ce){H==1?T.Cell.push({type:T.Types[ce[0]-1].name,index:ce[1]}):H==0&&T.Value.push({type:T.Types[ce[0]-1].name,index:ce[1]})});break;case 337:H=te?1:0;break;case 338:H=2;break;case 35:S.push(ie),I=!0;break;case 36:S.pop(),I=!1;break;default:if(!ae.T){if(!I||w.WTF&&S[S.length-1]!=35)throw new Error("Unexpected record 0x"+ie.toString(16))}}}),T}function parse_xlmeta_xml(E,r,v){var T={Types:[],Cell:[],Value:[]};if(!E)return T;var w=!1,S=2,I;return E.replace(tagregex,function(H){var te=parsexmltag(H);switch(strip_ns(te[0])){case"<?xml":break;case"<metadata":case"</metadata>":break;case"<metadataTypes":case"</metadataTypes>":break;case"<metadataType":T.Types.push({name:te.name});break;case"</metadataType>":break;case"<futureMetadata":for(var ae=0;ae<T.Types.length;++ae)T.Types[ae].name==te.name&&(I=T.Types[ae]);break;case"</futureMetadata>":break;case"<bk>":break;case"</bk>":break;case"<rc":S==1?T.Cell.push({type:T.Types[te.t-1].name,index:+te.v}):S==0&&T.Value.push({type:T.Types[te.t-1].name,index:+te.v});break;case"</rc>":break;case"<cellMetadata":S=1;break;case"</cellMetadata>":S=2;break;case"<valueMetadata":S=0;break;case"</valueMetadata>":S=2;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":w=!0;break;case"</ext>":w=!1;break;case"<rvb":if(!I)break;I.offsets||(I.offsets=[]),I.offsets.push(+te.i);break;default:if(!w&&v.WTF)throw new Error("unrecognized "+te[0]+" in metadata")}return H}),T}function parse_cc_xml(E){var r=[];if(!E)return r;var v=1;return(E.match(tagregex)||[]).forEach(function(T){var w=parsexmltag(T);switch(w[0]){case"<?xml":break;case"<calcChain":case"<calcChain>":case"</calcChain>":break;case"<c":delete w[0],w.i?v=w.i:w.i=v,r.push(w);break}}),r}function parse_BrtCalcChainItem$(E){var r={};r.i=E.read_shift(4);var v={};v.r=E.read_shift(4),v.c=E.read_shift(4),r.r=encode_cell(v);var T=E.read_shift(1);return T&2&&(r.l="1"),T&8&&(r.a="1"),r}function parse_cc_bin(E,r,v){var T=[];return recordhopper(E,function(S,I,H){switch(H){case 63:T.push(S);break;default:if(!I.T)throw new Error("Unexpected record 0x"+H.toString(16))}}),T}function parse_xlink_xml(){}function parse_xlink_bin(E,r,v,T){if(!E)return E;var w=T||{},S=!1;recordhopper(E,function(H,te,ae){switch(ae){case 359:case 363:case 364:case 366:case 367:case 368:case 369:case 370:case 371:case 472:case 577:case 578:case 579:case 580:case 581:case 582:case 583:case 584:case 585:case 586:case 587:break;case 35:S=!0;break;case 36:S=!1;break;default:if(!te.T){if(!S||w.WTF)throw new Error("Unexpected record 0x"+ae.toString(16))}}},w)}function parse_drawing(E,r){if(!E)return"??";var v=(E.match(/<c:chart [^>]*r:id="([^"]*)"/)||["",""])[1];return r["!id"][v].Target}function sheet_insert_comments(E,r,v,T){var w=Array.isArray(E),S;r.forEach(function(I){var H=decode_cell(I.ref);if(w?(E[H.r]||(E[H.r]=[]),S=E[H.r][H.c]):S=E[I.ref],!S){S={t:"z"},w?E[H.r][H.c]=S:E[I.ref]=S;var te=safe_decode_range(E["!ref"]||"BDWGO1000001:A1");te.s.r>H.r&&(te.s.r=H.r),te.e.r<H.r&&(te.e.r=H.r),te.s.c>H.c&&(te.s.c=H.c),te.e.c<H.c&&(te.e.c=H.c);var ae=encode_range(te);ae!==E["!ref"]&&(E["!ref"]=ae)}S.c||(S.c=[]);var ie={a:I.author,t:I.t,r:I.r,T:v};I.h&&(ie.h=I.h);for(var ce=S.c.length-1;ce>=0;--ce){if(!v&&S.c[ce].T)return;v&&!S.c[ce].T&&S.c.splice(ce,1)}if(v&&T){for(ce=0;ce<T.length;++ce)if(ie.a==T[ce].id){ie.a=T[ce].name||ie.a;break}}S.c.push(ie)})}function parse_comments_xml(E,r){if(E.match(/<(?:\w+:)?comments *\/>/))return[];var v=[],T=[],w=E.match(/<(?:\w+:)?authors>([\s\S]*)<\/(?:\w+:)?authors>/);w&&w[1]&&w[1].split(/<\/\w*:?author>/).forEach(function(I){if(!(I===""||I.trim()==="")){var H=I.match(/<(?:\w+:)?author[^>]*>(.*)/);H&&v.push(H[1])}});var S=E.match(/<(?:\w+:)?commentList>([\s\S]*)<\/(?:\w+:)?commentList>/);return S&&S[1]&&S[1].split(/<\/\w*:?comment>/).forEach(function(I){if(!(I===""||I.trim()==="")){var H=I.match(/<(?:\w+:)?comment[^>]*>/);if(H){var te=parsexmltag(H[0]),ae={author:te.authorId&&v[te.authorId]||"sheetjsghost",ref:te.ref,guid:te.guid},ie=decode_cell(te.ref);if(!(r.sheetRows&&r.sheetRows<=ie.r)){var ce=I.match(/<(?:\w+:)?text>([\s\S]*)<\/(?:\w+:)?text>/),me=!!ce&&!!ce[1]&&parse_si(ce[1])||{r:"",t:"",h:""};ae.r=me.r,me.r=="<t></t>"&&(me.t=me.h=""),ae.t=(me.t||"").replace(/\r\n/g,`
`).replace(/\r/g,`
`),r.cellHTML&&(ae.h=me.h),T.push(ae)}}}}),T}function parse_tcmnt_xml(E,r){var v=[],T=!1,w={},S=0;return E.replace(tagregex,function(H,te){var ae=parsexmltag(H);switch(strip_ns(ae[0])){case"<?xml":break;case"<ThreadedComments":break;case"</ThreadedComments>":break;case"<threadedComment":w={author:ae.personId,guid:ae.id,ref:ae.ref,T:1};break;case"</threadedComment>":w.t!=null&&v.push(w);break;case"<text>":case"<text":S=te+H.length;break;case"</text>":w.t=E.slice(S,te).replace(/\r\n/g,`
`).replace(/\r/g,`
`);break;case"<mentions":case"<mentions>":T=!0;break;case"</mentions>":T=!1;break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":T=!0;break;case"</ext>":T=!1;break;default:if(!T&&r.WTF)throw new Error("unrecognized "+ae[0]+" in threaded comments")}return H}),v}function parse_people_xml(E,r){var v=[],T=!1;return E.replace(tagregex,function(S){var I=parsexmltag(S);switch(strip_ns(I[0])){case"<?xml":break;case"<personList":break;case"</personList>":break;case"<person":v.push({name:I.displayname,id:I.id});break;case"</person>":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":T=!0;break;case"</ext>":T=!1;break;default:if(!T&&r.WTF)throw new Error("unrecognized "+I[0]+" in threaded comments")}return S}),v}function parse_BrtBeginComment(E){var r={};r.iauthor=E.read_shift(4);var v=parse_UncheckedRfX(E);return r.rfx=v.s,r.ref=encode_cell(v.s),E.l+=16,r}var parse_BrtCommentAuthor=parse_XLWideString;function parse_comments_bin(E,r){var v=[],T=[],w={},S=!1;return recordhopper(E,function(H,te,ae){switch(ae){case 632:T.push(H);break;case 635:w=H;break;case 637:w.t=H.t,w.h=H.h,w.r=H.r;break;case 636:if(w.author=T[w.iauthor],delete w.iauthor,r.sheetRows&&w.rfx&&r.sheetRows<=w.rfx.r)break;w.t||(w.t=""),delete w.rfx,v.push(w);break;case 3072:break;case 35:S=!0;break;case 36:S=!1;break;case 37:break;case 38:break;default:if(!te.T){if(!S||r.WTF)throw new Error("Unexpected record 0x"+ae.toString(16))}}}),v}var CT_VBA="application/vnd.ms-office.vbaProject";function make_vba_xls(E){var r=CFB.utils.cfb_new({root:"R"});return E.FullPaths.forEach(function(v,T){if(!(v.slice(-1)==="/"||!v.match(/_VBA_PROJECT_CUR/))){var w=v.replace(/^[^\/]*/,"R").replace(/\/_VBA_PROJECT_CUR\u0000*/,"");CFB.utils.cfb_add(r,w,E.FileIndex[T].content)}}),CFB.write(r)}function parse_ds_bin(){return{"!type":"dialog"}}function parse_ds_xml(){return{"!type":"dialog"}}function parse_ms_bin(){return{"!type":"macro"}}function parse_ms_xml(){return{"!type":"macro"}}var rc_to_a1=function(){var E=/(^|[^A-Za-z_])R(\[?-?\d+\]|[1-9]\d*|)C(\[?-?\d+\]|[1-9]\d*|)(?![A-Za-z0-9_])/g,r={r:0,c:0};function v(T,w,S,I){var H=!1,te=!1;S.length==0?te=!0:S.charAt(0)=="["&&(te=!0,S=S.slice(1,-1)),I.length==0?H=!0:I.charAt(0)=="["&&(H=!0,I=I.slice(1,-1));var ae=S.length>0?parseInt(S,10)|0:0,ie=I.length>0?parseInt(I,10)|0:0;return H?ie+=r.c:--ie,te?ae+=r.r:--ae,w+(H?"":"$")+encode_col(ie)+(te?"":"$")+encode_row(ae)}return function(w,S){return r=S,w.replace(E,v)}}(),crefregex=/(^|[^._A-Z0-9])([$]?)([A-Z]{1,2}|[A-W][A-Z]{2}|X[A-E][A-Z]|XF[A-D])([$]?)(10[0-3]\d{4}|104[0-7]\d{3}|1048[0-4]\d{2}|10485[0-6]\d|104857[0-6]|[1-9]\d{0,5})(?![_.\(A-Za-z0-9])/g,a1_to_rc=function(){return function(r,v){return r.replace(crefregex,function(T,w,S,I,H,te){var ae=decode_col(I)-(S?0:v.c),ie=decode_row(te)-(H?0:v.r),ce=ie==0?"":H?ie+1:"["+ie+"]",me=ae==0?"":S?ae+1:"["+ae+"]";return w+"R"+ce+"C"+me})}}();function shift_formula_str(E,r){return E.replace(crefregex,function(v,T,w,S,I,H){return T+(w=="$"?w+S:encode_col(decode_col(S)+r.c))+(I=="$"?I+H:encode_row(decode_row(H)+r.r))})}function shift_formula_xlsx(E,r,v){var T=decode_range(r),w=T.s,S=decode_cell(v),I={r:S.r-w.r,c:S.c-w.c};return shift_formula_str(E,I)}function fuzzyfmla(E){return E.length!=1}function _xlfn(E){return E.replace(/_xlfn\./g,"")}function parseread1(E){E.l+=1}function parse_ColRelU(E,r){var v=E.read_shift(2);return[v&16383,v>>14&1,v>>15&1]}function parse_RgceArea(E,r,v){var T=2;if(v){if(v.biff>=2&&v.biff<=5)return parse_RgceArea_BIFF2(E);v.biff==12&&(T=4)}var w=E.read_shift(T),S=E.read_shift(T),I=parse_ColRelU(E),H=parse_ColRelU(E);return{s:{r:w,c:I[0],cRel:I[1],rRel:I[2]},e:{r:S,c:H[0],cRel:H[1],rRel:H[2]}}}function parse_RgceArea_BIFF2(E){var r=parse_ColRelU(E),v=parse_ColRelU(E),T=E.read_shift(1),w=E.read_shift(1);return{s:{r:r[0],c:T,cRel:r[1],rRel:r[2]},e:{r:v[0],c:w,cRel:v[1],rRel:v[2]}}}function parse_RgceAreaRel(E,r,v){if(v.biff<8)return parse_RgceArea_BIFF2(E);var T=E.read_shift(v.biff==12?4:2),w=E.read_shift(v.biff==12?4:2),S=parse_ColRelU(E),I=parse_ColRelU(E);return{s:{r:T,c:S[0],cRel:S[1],rRel:S[2]},e:{r:w,c:I[0],cRel:I[1],rRel:I[2]}}}function parse_RgceLoc(E,r,v){if(v&&v.biff>=2&&v.biff<=5)return parse_RgceLoc_BIFF2(E);var T=E.read_shift(v&&v.biff==12?4:2),w=parse_ColRelU(E);return{r:T,c:w[0],cRel:w[1],rRel:w[2]}}function parse_RgceLoc_BIFF2(E){var r=parse_ColRelU(E),v=E.read_shift(1);return{r:r[0],c:v,cRel:r[1],rRel:r[2]}}function parse_RgceElfLoc(E){var r=E.read_shift(2),v=E.read_shift(2);return{r,c:v&255,fQuoted:!!(v&16384),cRel:v>>15,rRel:v>>15}}function parse_RgceLocRel(E,r,v){var T=v&&v.biff?v.biff:8;if(T>=2&&T<=5)return parse_RgceLocRel_BIFF2(E);var w=E.read_shift(T>=12?4:2),S=E.read_shift(2),I=(S&16384)>>14,H=(S&32768)>>15;if(S&=16383,H==1)for(;w>524287;)w-=1048576;if(I==1)for(;S>8191;)S=S-16384;return{r:w,c:S,cRel:I,rRel:H}}function parse_RgceLocRel_BIFF2(E){var r=E.read_shift(2),v=E.read_shift(1),T=(r&32768)>>15,w=(r&16384)>>14;return r&=16383,T==1&&r>=8192&&(r=r-16384),w==1&&v>=128&&(v=v-256),{r,c:v,cRel:w,rRel:T}}function parse_PtgArea(E,r,v){var T=(E[E.l++]&96)>>5,w=parse_RgceArea(E,v.biff>=2&&v.biff<=5?6:8,v);return[T,w]}function parse_PtgArea3d(E,r,v){var T=(E[E.l++]&96)>>5,w=E.read_shift(2,"i"),S=8;if(v)switch(v.biff){case 5:E.l+=12,S=6;break;case 12:S=12;break}var I=parse_RgceArea(E,S,v);return[T,w,I]}function parse_PtgAreaErr(E,r,v){var T=(E[E.l++]&96)>>5;return E.l+=v&&v.biff>8?12:v.biff<8?6:8,[T]}function parse_PtgAreaErr3d(E,r,v){var T=(E[E.l++]&96)>>5,w=E.read_shift(2),S=8;if(v)switch(v.biff){case 5:E.l+=12,S=6;break;case 12:S=12;break}return E.l+=S,[T,w]}function parse_PtgAreaN(E,r,v){var T=(E[E.l++]&96)>>5,w=parse_RgceAreaRel(E,r-1,v);return[T,w]}function parse_PtgArray(E,r,v){var T=(E[E.l++]&96)>>5;return E.l+=v.biff==2?6:v.biff==12?14:7,[T]}function parse_PtgAttrBaxcel(E){var r=E[E.l+1]&1,v=1;return E.l+=4,[r,v]}function parse_PtgAttrChoose(E,r,v){E.l+=2;for(var T=E.read_shift(v&&v.biff==2?1:2),w=[],S=0;S<=T;++S)w.push(E.read_shift(v&&v.biff==2?1:2));return w}function parse_PtgAttrGoto(E,r,v){var T=E[E.l+1]&255?1:0;return E.l+=2,[T,E.read_shift(v&&v.biff==2?1:2)]}function parse_PtgAttrIf(E,r,v){var T=E[E.l+1]&255?1:0;return E.l+=2,[T,E.read_shift(v&&v.biff==2?1:2)]}function parse_PtgAttrIfError(E){var r=E[E.l+1]&255?1:0;return E.l+=2,[r,E.read_shift(2)]}function parse_PtgAttrSemi(E,r,v){var T=E[E.l+1]&255?1:0;return E.l+=v&&v.biff==2?3:4,[T]}function parse_PtgAttrSpaceType(E){var r=E.read_shift(1),v=E.read_shift(1);return[r,v]}function parse_PtgAttrSpace(E){return E.read_shift(2),parse_PtgAttrSpaceType(E)}function parse_PtgAttrSpaceSemi(E){return E.read_shift(2),parse_PtgAttrSpaceType(E)}function parse_PtgRef(E,r,v){var T=(E[E.l]&96)>>5;E.l+=1;var w=parse_RgceLoc(E,0,v);return[T,w]}function parse_PtgRefN(E,r,v){var T=(E[E.l]&96)>>5;E.l+=1;var w=parse_RgceLocRel(E,0,v);return[T,w]}function parse_PtgRef3d(E,r,v){var T=(E[E.l]&96)>>5;E.l+=1;var w=E.read_shift(2);v&&v.biff==5&&(E.l+=12);var S=parse_RgceLoc(E,0,v);return[T,w,S]}function parse_PtgFunc(E,r,v){var T=(E[E.l]&96)>>5;E.l+=1;var w=E.read_shift(v&&v.biff<=3?1:2);return[FtabArgc[w],Ftab[w],T]}function parse_PtgFuncVar(E,r,v){var T=E[E.l++],w=E.read_shift(1),S=v&&v.biff<=3?[T==88?-1:0,E.read_shift(1)]:parsetab(E);return[w,(S[0]===0?Ftab:Cetab)[S[1]]]}function parsetab(E){return[E[E.l+1]>>7,E.read_shift(2)&32767]}function parse_PtgAttrSum(E,r,v){E.l+=v&&v.biff==2?3:4}function parse_PtgExp(E,r,v){if(E.l++,v&&v.biff==12)return[E.read_shift(4,"i"),0];var T=E.read_shift(2),w=E.read_shift(v&&v.biff==2?1:2);return[T,w]}function parse_PtgErr(E){return E.l++,BErr[E.read_shift(1)]}function parse_PtgInt(E){return E.l++,E.read_shift(2)}function parse_PtgBool(E){return E.l++,E.read_shift(1)!==0}function parse_PtgNum(E){return E.l++,parse_Xnum(E)}function parse_PtgStr(E,r,v){return E.l++,parse_ShortXLUnicodeString(E,r-1,v)}function parse_SerAr(E,r){var v=[E.read_shift(1)];if(r==12)switch(v[0]){case 2:v[0]=4;break;case 4:v[0]=16;break;case 0:v[0]=1;break;case 1:v[0]=2;break}switch(v[0]){case 4:v[1]=parsebool(E,1)?"TRUE":"FALSE",r!=12&&(E.l+=7);break;case 37:case 16:v[1]=BErr[E[E.l]],E.l+=r==12?4:8;break;case 0:E.l+=8;break;case 1:v[1]=parse_Xnum(E);break;case 2:v[1]=parse_XLUnicodeString2(E,0,{biff:r>0&&r<8?2:r});break;default:throw new Error("Bad SerAr: "+v[0])}return v}function parse_PtgExtraMem(E,r,v){for(var T=E.read_shift(v.biff==12?4:2),w=[],S=0;S!=T;++S)w.push((v.biff==12?parse_UncheckedRfX:parse_Ref8U)(E));return w}function parse_PtgExtraArray(E,r,v){var T=0,w=0;v.biff==12?(T=E.read_shift(4),w=E.read_shift(4)):(w=1+E.read_shift(1),T=1+E.read_shift(2)),v.biff>=2&&v.biff<8&&(--T,--w==0&&(w=256));for(var S=0,I=[];S!=T&&(I[S]=[]);++S)for(var H=0;H!=w;++H)I[S][H]=parse_SerAr(E,v.biff);return I}function parse_PtgName(E,r,v){var T=E.read_shift(1)>>>5&3,w=!v||v.biff>=8?4:2,S=E.read_shift(w);switch(v.biff){case 2:E.l+=5;break;case 3:case 4:E.l+=8;break;case 5:E.l+=12;break}return[T,0,S]}function parse_PtgNameX(E,r,v){if(v.biff==5)return parse_PtgNameX_BIFF5(E);var T=E.read_shift(1)>>>5&3,w=E.read_shift(2),S=E.read_shift(4);return[T,w,S]}function parse_PtgNameX_BIFF5(E){var r=E.read_shift(1)>>>5&3,v=E.read_shift(2,"i");E.l+=8;var T=E.read_shift(2);return E.l+=12,[r,v,T]}function parse_PtgMemArea(E,r,v){var T=E.read_shift(1)>>>5&3;E.l+=v&&v.biff==2?3:4;var w=E.read_shift(v&&v.biff==2?1:2);return[T,w]}function parse_PtgMemFunc(E,r,v){var T=E.read_shift(1)>>>5&3,w=E.read_shift(v&&v.biff==2?1:2);return[T,w]}function parse_PtgRefErr(E,r,v){var T=E.read_shift(1)>>>5&3;return E.l+=4,v.biff<8&&E.l--,v.biff==12&&(E.l+=2),[T]}function parse_PtgRefErr3d(E,r,v){var T=(E[E.l++]&96)>>5,w=E.read_shift(2),S=4;if(v)switch(v.biff){case 5:S=15;break;case 12:S=6;break}return E.l+=S,[T,w]}var parse_PtgMemErr=parsenoop,parse_PtgMemNoMem=parsenoop,parse_PtgTbl=parsenoop;function parse_PtgElfLoc(E,r,v){return E.l+=2,[parse_RgceElfLoc(E)]}function parse_PtgElfNoop(E){return E.l+=6,[]}var parse_PtgElfCol=parse_PtgElfLoc,parse_PtgElfColS=parse_PtgElfNoop,parse_PtgElfColSV=parse_PtgElfNoop,parse_PtgElfColV=parse_PtgElfLoc;function parse_PtgElfLel(E){return E.l+=2,[parseuint16(E),E.read_shift(2)&1]}var parse_PtgElfRadical=parse_PtgElfLoc,parse_PtgElfRadicalLel=parse_PtgElfLel,parse_PtgElfRadicalS=parse_PtgElfNoop,parse_PtgElfRw=parse_PtgElfLoc,parse_PtgElfRwV=parse_PtgElfLoc,PtgListRT=["Data","All","Headers","??","?Data2","??","?DataHeaders","??","Totals","??","??","??","?DataTotals","??","??","??","?Current"];function parse_PtgList(E){E.l+=2;var r=E.read_shift(2),v=E.read_shift(2),T=E.read_shift(4),w=E.read_shift(2),S=E.read_shift(2),I=PtgListRT[v>>2&31];return{ixti:r,coltype:v&3,rt:I,idx:T,c:w,C:S}}function parse_PtgSxName(E){return E.l+=2,[E.read_shift(4)]}function parse_PtgSheet(E,r,v){return E.l+=5,E.l+=2,E.l+=v.biff==2?1:4,["PTGSHEET"]}function parse_PtgEndSheet(E,r,v){return E.l+=v.biff==2?4:5,["PTGENDSHEET"]}function parse_PtgMemAreaN(E){var r=E.read_shift(1)>>>5&3,v=E.read_shift(2);return[r,v]}function parse_PtgMemNoMemN(E){var r=E.read_shift(1)>>>5&3,v=E.read_shift(2);return[r,v]}function parse_PtgAttrNoop(E){return E.l+=4,[0,0]}var PtgTypes={1:{n:"PtgExp",f:parse_PtgExp},2:{n:"PtgTbl",f:parse_PtgTbl},3:{n:"PtgAdd",f:parseread1},4:{n:"PtgSub",f:parseread1},5:{n:"PtgMul",f:parseread1},6:{n:"PtgDiv",f:parseread1},7:{n:"PtgPower",f:parseread1},8:{n:"PtgConcat",f:parseread1},9:{n:"PtgLt",f:parseread1},10:{n:"PtgLe",f:parseread1},11:{n:"PtgEq",f:parseread1},12:{n:"PtgGe",f:parseread1},13:{n:"PtgGt",f:parseread1},14:{n:"PtgNe",f:parseread1},15:{n:"PtgIsect",f:parseread1},16:{n:"PtgUnion",f:parseread1},17:{n:"PtgRange",f:parseread1},18:{n:"PtgUplus",f:parseread1},19:{n:"PtgUminus",f:parseread1},20:{n:"PtgPercent",f:parseread1},21:{n:"PtgParen",f:parseread1},22:{n:"PtgMissArg",f:parseread1},23:{n:"PtgStr",f:parse_PtgStr},26:{n:"PtgSheet",f:parse_PtgSheet},27:{n:"PtgEndSheet",f:parse_PtgEndSheet},28:{n:"PtgErr",f:parse_PtgErr},29:{n:"PtgBool",f:parse_PtgBool},30:{n:"PtgInt",f:parse_PtgInt},31:{n:"PtgNum",f:parse_PtgNum},32:{n:"PtgArray",f:parse_PtgArray},33:{n:"PtgFunc",f:parse_PtgFunc},34:{n:"PtgFuncVar",f:parse_PtgFuncVar},35:{n:"PtgName",f:parse_PtgName},36:{n:"PtgRef",f:parse_PtgRef},37:{n:"PtgArea",f:parse_PtgArea},38:{n:"PtgMemArea",f:parse_PtgMemArea},39:{n:"PtgMemErr",f:parse_PtgMemErr},40:{n:"PtgMemNoMem",f:parse_PtgMemNoMem},41:{n:"PtgMemFunc",f:parse_PtgMemFunc},42:{n:"PtgRefErr",f:parse_PtgRefErr},43:{n:"PtgAreaErr",f:parse_PtgAreaErr},44:{n:"PtgRefN",f:parse_PtgRefN},45:{n:"PtgAreaN",f:parse_PtgAreaN},46:{n:"PtgMemAreaN",f:parse_PtgMemAreaN},47:{n:"PtgMemNoMemN",f:parse_PtgMemNoMemN},57:{n:"PtgNameX",f:parse_PtgNameX},58:{n:"PtgRef3d",f:parse_PtgRef3d},59:{n:"PtgArea3d",f:parse_PtgArea3d},60:{n:"PtgRefErr3d",f:parse_PtgRefErr3d},61:{n:"PtgAreaErr3d",f:parse_PtgAreaErr3d},255:{}},PtgDupes={64:32,96:32,65:33,97:33,66:34,98:34,67:35,99:35,68:36,100:36,69:37,101:37,70:38,102:38,71:39,103:39,72:40,104:40,73:41,105:41,74:42,106:42,75:43,107:43,76:44,108:44,77:45,109:45,78:46,110:46,79:47,111:47,88:34,120:34,89:57,121:57,90:58,122:58,91:59,123:59,92:60,124:60,93:61,125:61},Ptg18={1:{n:"PtgElfLel",f:parse_PtgElfLel},2:{n:"PtgElfRw",f:parse_PtgElfRw},3:{n:"PtgElfCol",f:parse_PtgElfCol},6:{n:"PtgElfRwV",f:parse_PtgElfRwV},7:{n:"PtgElfColV",f:parse_PtgElfColV},10:{n:"PtgElfRadical",f:parse_PtgElfRadical},11:{n:"PtgElfRadicalS",f:parse_PtgElfRadicalS},13:{n:"PtgElfColS",f:parse_PtgElfColS},15:{n:"PtgElfColSV",f:parse_PtgElfColSV},16:{n:"PtgElfRadicalLel",f:parse_PtgElfRadicalLel},25:{n:"PtgList",f:parse_PtgList},29:{n:"PtgSxName",f:parse_PtgSxName},255:{}},Ptg19={0:{n:"PtgAttrNoop",f:parse_PtgAttrNoop},1:{n:"PtgAttrSemi",f:parse_PtgAttrSemi},2:{n:"PtgAttrIf",f:parse_PtgAttrIf},4:{n:"PtgAttrChoose",f:parse_PtgAttrChoose},8:{n:"PtgAttrGoto",f:parse_PtgAttrGoto},16:{n:"PtgAttrSum",f:parse_PtgAttrSum},32:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},33:{n:"PtgAttrBaxcel",f:parse_PtgAttrBaxcel},64:{n:"PtgAttrSpace",f:parse_PtgAttrSpace},65:{n:"PtgAttrSpaceSemi",f:parse_PtgAttrSpaceSemi},128:{n:"PtgAttrIfError",f:parse_PtgAttrIfError},255:{}};function parse_RgbExtra(E,r,v,T){if(T.biff<8)return parsenoop(E,r);for(var w=E.l+r,S=[],I=0;I!==v.length;++I)switch(v[I][0]){case"PtgArray":v[I][1]=parse_PtgExtraArray(E,0,T),S.push(v[I][1]);break;case"PtgMemArea":v[I][2]=parse_PtgExtraMem(E,v[I][1],T),S.push(v[I][2]);break;case"PtgExp":T&&T.biff==12&&(v[I][1][1]=E.read_shift(4),S.push(v[I][1]));break;case"PtgList":case"PtgElfRadicalS":case"PtgElfColS":case"PtgElfColSV":throw"Unsupported "+v[I][0]}return r=w-E.l,r!==0&&S.push(parsenoop(E,r)),S}function parse_Rgce(E,r,v){for(var T=E.l+r,w,S,I=[];T!=E.l;)r=T-E.l,S=E[E.l],w=PtgTypes[S]||PtgTypes[PtgDupes[S]],(S===24||S===25)&&(w=(S===24?Ptg18:Ptg19)[E[E.l+1]]),!w||!w.f?parsenoop(E,r):I.push([w.n,w.f(E,r,v)]);return I}function stringify_array(E){for(var r=[],v=0;v<E.length;++v){for(var T=E[v],w=[],S=0;S<T.length;++S){var I=T[S];if(I)switch(I[0]){case 2:w.push('"'+I[1].replace(/"/g,'""')+'"');break;default:w.push(I[1])}else w.push("")}r.push(w.join(","))}return r.join(";")}var PtgBinOp={PtgAdd:"+",PtgConcat:"&",PtgDiv:"/",PtgEq:"=",PtgGe:">=",PtgGt:">",PtgLe:"<=",PtgLt:"<",PtgMul:"*",PtgNe:"<>",PtgPower:"^",PtgSub:"-"};function formula_quote_sheet_name(E,r){if(!E&&!(r&&r.biff<=5&&r.biff>=2))throw new Error("empty sheet name");return/[^\w\u4E00-\u9FFF\u3040-\u30FF]/.test(E)?"'"+E+"'":E}function get_ixti_raw(E,r,v){if(!E)return"SH33TJSERR0";if(v.biff>8&&(!E.XTI||!E.XTI[r]))return E.SheetNames[r];if(!E.XTI)return"SH33TJSERR6";var T=E.XTI[r];if(v.biff<8)return r>1e4&&(r-=65536),r<0&&(r=-r),r==0?"":E.XTI[r-1];if(!T)return"SH33TJSERR1";var w="";if(v.biff>8)switch(E[T[0]][0]){case 357:return w=T[1]==-1?"#REF":E.SheetNames[T[1]],T[1]==T[2]?w:w+":"+E.SheetNames[T[2]];case 358:return v.SID!=null?E.SheetNames[v.SID]:"SH33TJSSAME"+E[T[0]][0];case 355:default:return"SH33TJSSRC"+E[T[0]][0]}switch(E[T[0]][0][0]){case 1025:return w=T[1]==-1?"#REF":E.SheetNames[T[1]]||"SH33TJSERR3",T[1]==T[2]?w:w+":"+E.SheetNames[T[2]];case 14849:return E[T[0]].slice(1).map(function(S){return S.Name}).join(";;");default:return E[T[0]][0][3]?(w=T[1]==-1?"#REF":E[T[0]][0][3][T[1]]||"SH33TJSERR4",T[1]==T[2]?w:w+":"+E[T[0]][0][3][T[2]]):"SH33TJSERR2"}}function get_ixti(E,r,v){var T=get_ixti_raw(E,r,v);return T=="#REF"?T:formula_quote_sheet_name(T,v)}function stringify_formula(E,r,v,T,w){var S=w&&w.biff||8,I={s:{c:0,r:0}},H=[],te,ae,ie,ce=0,me=0,_e,Re="";if(!E[0]||!E[0][0])return"";for(var Pe=-1,Ce="",Fe=0,Me=E[0].length;Fe<Me;++Fe){var Ve=E[0][Fe];switch(Ve[0]){case"PtgUminus":H.push("-"+H.pop());break;case"PtgUplus":H.push("+"+H.pop());break;case"PtgPercent":H.push(H.pop()+"%");break;case"PtgAdd":case"PtgConcat":case"PtgDiv":case"PtgEq":case"PtgGe":case"PtgGt":case"PtgLe":case"PtgLt":case"PtgMul":case"PtgNe":case"PtgPower":case"PtgSub":if(te=H.pop(),ae=H.pop(),Pe>=0){switch(E[0][Pe][1][0]){case 0:Ce=fill(" ",E[0][Pe][1][1]);break;case 1:Ce=fill("\r",E[0][Pe][1][1]);break;default:if(Ce="",w.WTF)throw new Error("Unexpected PtgAttrSpaceType "+E[0][Pe][1][0])}ae=ae+Ce,Pe=-1}H.push(ae+PtgBinOp[Ve[0]]+te);break;case"PtgIsect":te=H.pop(),ae=H.pop(),H.push(ae+" "+te);break;case"PtgUnion":te=H.pop(),ae=H.pop(),H.push(ae+","+te);break;case"PtgRange":te=H.pop(),ae=H.pop(),H.push(ae+":"+te);break;case"PtgAttrChoose":break;case"PtgAttrGoto":break;case"PtgAttrIf":break;case"PtgAttrIfError":break;case"PtgRef":ie=shift_cell_xls(Ve[1][1],I,w),H.push(encode_cell_xls(ie,S));break;case"PtgRefN":ie=v?shift_cell_xls(Ve[1][1],v,w):Ve[1][1],H.push(encode_cell_xls(ie,S));break;case"PtgRef3d":ce=Ve[1][1],ie=shift_cell_xls(Ve[1][2],I,w),Re=get_ixti(T,ce,w),H.push(Re+"!"+encode_cell_xls(ie,S));break;case"PtgFunc":case"PtgFuncVar":var We=Ve[1][0],ze=Ve[1][1];We||(We=0),We&=127;var Ue=We==0?[]:H.slice(-We);H.length-=We,ze==="User"&&(ze=Ue.shift()),H.push(ze+"("+Ue.join(",")+")");break;case"PtgBool":H.push(Ve[1]?"TRUE":"FALSE");break;case"PtgInt":H.push(Ve[1]);break;case"PtgNum":H.push(String(Ve[1]));break;case"PtgStr":H.push('"'+Ve[1].replace(/"/g,'""')+'"');break;case"PtgErr":H.push(Ve[1]);break;case"PtgAreaN":_e=shift_range_xls(Ve[1][1],v?{s:v}:I,w),H.push(encode_range_xls(_e,w));break;case"PtgArea":_e=shift_range_xls(Ve[1][1],I,w),H.push(encode_range_xls(_e,w));break;case"PtgArea3d":ce=Ve[1][1],_e=Ve[1][2],Re=get_ixti(T,ce,w),H.push(Re+"!"+encode_range_xls(_e,w));break;case"PtgAttrSum":H.push("SUM("+H.pop()+")");break;case"PtgAttrBaxcel":case"PtgAttrSemi":break;case"PtgName":me=Ve[1][2];var je=(T.names||[])[me-1]||(T[0]||[])[me],ke=je?je.Name:"SH33TJSNAME"+String(me);ke&&ke.slice(0,6)=="_xlfn."&&!w.xlfn&&(ke=ke.slice(6)),H.push(ke);break;case"PtgNameX":var Ne=Ve[1][1];me=Ve[1][2];var Ge;if(w.biff<=5)Ne<0&&(Ne=-Ne),T[Ne]&&(Ge=T[Ne][me]);else{var Ie="";if(((T[Ne]||[])[0]||[])[0]==14849||(((T[Ne]||[])[0]||[])[0]==1025?T[Ne][me]&&T[Ne][me].itab>0&&(Ie=T.SheetNames[T[Ne][me].itab-1]+"!"):Ie=T.SheetNames[me-1]+"!"),T[Ne]&&T[Ne][me])Ie+=T[Ne][me].Name;else if(T[0]&&T[0][me])Ie+=T[0][me].Name;else{var Le=(get_ixti_raw(T,Ne,w)||"").split(";;");Le[me-1]?Ie=Le[me-1]:Ie+="SH33TJSERRX"}H.push(Ie);break}Ge||(Ge={Name:"SH33TJSERRY"}),H.push(Ge.Name);break;case"PtgParen":var He="(",Ct=")";if(Pe>=0){switch(Ce="",E[0][Pe][1][0]){case 2:He=fill(" ",E[0][Pe][1][1])+He;break;case 3:He=fill("\r",E[0][Pe][1][1])+He;break;case 4:Ct=fill(" ",E[0][Pe][1][1])+Ct;break;case 5:Ct=fill("\r",E[0][Pe][1][1])+Ct;break;default:if(w.WTF)throw new Error("Unexpected PtgAttrSpaceType "+E[0][Pe][1][0])}Pe=-1}H.push(He+H.pop()+Ct);break;case"PtgRefErr":H.push("#REF!");break;case"PtgRefErr3d":H.push("#REF!");break;case"PtgExp":ie={c:Ve[1][1],r:Ve[1][0]};var Ze={c:v.c,r:v.r};if(T.sharedf[encode_cell(ie)]){var Rt=T.sharedf[encode_cell(ie)];H.push(stringify_formula(Rt,I,Ze,T,w))}else{var nt=!1;for(te=0;te!=T.arrayf.length;++te)if(ae=T.arrayf[te],!(ie.c<ae[0].s.c||ie.c>ae[0].e.c)&&!(ie.r<ae[0].s.r||ie.r>ae[0].e.r)){H.push(stringify_formula(ae[1],I,Ze,T,w)),nt=!0;break}nt||H.push(Ve[1])}break;case"PtgArray":H.push("{"+stringify_array(Ve[1])+"}");break;case"PtgMemArea":break;case"PtgAttrSpace":case"PtgAttrSpaceSemi":Pe=Fe;break;case"PtgTbl":break;case"PtgMemErr":break;case"PtgMissArg":H.push("");break;case"PtgAreaErr":H.push("#REF!");break;case"PtgAreaErr3d":H.push("#REF!");break;case"PtgList":H.push("Table"+Ve[1].idx+"[#"+Ve[1].rt+"]");break;case"PtgMemAreaN":case"PtgMemNoMemN":case"PtgAttrNoop":case"PtgSheet":case"PtgEndSheet":break;case"PtgMemFunc":break;case"PtgMemNoMem":break;case"PtgElfCol":case"PtgElfColS":case"PtgElfColSV":case"PtgElfColV":case"PtgElfLel":case"PtgElfRadical":case"PtgElfRadicalLel":case"PtgElfRadicalS":case"PtgElfRw":case"PtgElfRwV":throw new Error("Unsupported ELFs");case"PtgSxName":throw new Error("Unrecognized Formula Token: "+String(Ve));default:throw new Error("Unrecognized Formula Token: "+String(Ve))}var nr=["PtgAttrSpace","PtgAttrSpaceSemi","PtgAttrGoto"];if(w.biff!=3&&Pe>=0&&nr.indexOf(E[0][Fe][0])==-1){Ve=E[0][Pe];var Je=!0;switch(Ve[1][0]){case 4:Je=!1;case 0:Ce=fill(" ",Ve[1][1]);break;case 5:Je=!1;case 1:Ce=fill("\r",Ve[1][1]);break;default:if(Ce="",w.WTF)throw new Error("Unexpected PtgAttrSpaceType "+Ve[1][0])}H.push((Je?Ce:"")+H.pop()+(Je?"":Ce)),Pe=-1}}if(H.length>1&&w.WTF)throw new Error("bad formula stack");return H[0]}function parse_ArrayParsedFormula(E,r,v){var T=E.l+r,w=v.biff==2?1:2,S,I=E.read_shift(w);if(I==65535)return[[],parsenoop(E,r-2)];var H=parse_Rgce(E,I,v);return r!==I+w&&(S=parse_RgbExtra(E,r-I-w,H,v)),E.l=T,[H,S]}function parse_XLSCellParsedFormula(E,r,v){var T=E.l+r,w=v.biff==2?1:2,S,I=E.read_shift(w);if(I==65535)return[[],parsenoop(E,r-2)];var H=parse_Rgce(E,I,v);return r!==I+w&&(S=parse_RgbExtra(E,r-I-w,H,v)),E.l=T,[H,S]}function parse_NameParsedFormula(E,r,v,T){var w=E.l+r,S=parse_Rgce(E,T,v),I;return w!==E.l&&(I=parse_RgbExtra(E,w-E.l,S,v)),[S,I]}function parse_SharedParsedFormula(E,r,v){var T=E.l+r,w,S=E.read_shift(2),I=parse_Rgce(E,S,v);return S==65535?[[],parsenoop(E,r-2)]:(r!==S+2&&(w=parse_RgbExtra(E,T-S-2,I,v)),[I,w])}function parse_FormulaValue(E){var r;if(__readUInt16LE(E,E.l+6)!==65535)return[parse_Xnum(E),"n"];switch(E[E.l]){case 0:return E.l+=8,["String","s"];case 1:return r=E[E.l+2]===1,E.l+=8,[r,"b"];case 2:return r=E[E.l+2],E.l+=8,[r,"e"];case 3:return E.l+=8,["","s"]}return[]}function parse_Formula(E,r,v){var T=E.l+r,w=parse_XLSCell(E);v.biff==2&&++E.l;var S=parse_FormulaValue(E),I=E.read_shift(1);v.biff!=2&&(E.read_shift(1),v.biff>=5&&E.read_shift(4));var H=parse_XLSCellParsedFormula(E,T-E.l,v);return{cell:w,val:S[0],formula:H,shared:I>>3&1,tt:S[1]}}function parse_XLSBParsedFormula(E,r,v){var T=E.read_shift(4),w=parse_Rgce(E,T,v),S=E.read_shift(4),I=S>0?parse_RgbExtra(E,S,w,v):null;return[w,I]}var parse_XLSBArrayParsedFormula=parse_XLSBParsedFormula,parse_XLSBCellParsedFormula=parse_XLSBParsedFormula,parse_XLSBNameParsedFormula=parse_XLSBParsedFormula,parse_XLSBSharedParsedFormula=parse_XLSBParsedFormula,Cetab={0:"BEEP",1:"OPEN",2:"OPEN.LINKS",3:"CLOSE.ALL",4:"SAVE",5:"SAVE.AS",6:"FILE.DELETE",7:"PAGE.SETUP",8:"PRINT",9:"PRINTER.SETUP",10:"QUIT",11:"NEW.WINDOW",12:"ARRANGE.ALL",13:"WINDOW.SIZE",14:"WINDOW.MOVE",15:"FULL",16:"CLOSE",17:"RUN",22:"SET.PRINT.AREA",23:"SET.PRINT.TITLES",24:"SET.PAGE.BREAK",25:"REMOVE.PAGE.BREAK",26:"FONT",27:"DISPLAY",28:"PROTECT.DOCUMENT",29:"PRECISION",30:"A1.R1C1",31:"CALCULATE.NOW",32:"CALCULATION",34:"DATA.FIND",35:"EXTRACT",36:"DATA.DELETE",37:"SET.DATABASE",38:"SET.CRITERIA",39:"SORT",40:"DATA.SERIES",41:"TABLE",42:"FORMAT.NUMBER",43:"ALIGNMENT",44:"STYLE",45:"BORDER",46:"CELL.PROTECTION",47:"COLUMN.WIDTH",48:"UNDO",49:"CUT",50:"COPY",51:"PASTE",52:"CLEAR",53:"PASTE.SPECIAL",54:"EDIT.DELETE",55:"INSERT",56:"FILL.RIGHT",57:"FILL.DOWN",61:"DEFINE.NAME",62:"CREATE.NAMES",63:"FORMULA.GOTO",64:"FORMULA.FIND",65:"SELECT.LAST.CELL",66:"SHOW.ACTIVE.CELL",67:"GALLERY.AREA",68:"GALLERY.BAR",69:"GALLERY.COLUMN",70:"GALLERY.LINE",71:"GALLERY.PIE",72:"GALLERY.SCATTER",73:"COMBINATION",74:"PREFERRED",75:"ADD.OVERLAY",76:"GRIDLINES",77:"SET.PREFERRED",78:"AXES",79:"LEGEND",80:"ATTACH.TEXT",81:"ADD.ARROW",82:"SELECT.CHART",83:"SELECT.PLOT.AREA",84:"PATTERNS",85:"MAIN.CHART",86:"OVERLAY",87:"SCALE",88:"FORMAT.LEGEND",89:"FORMAT.TEXT",90:"EDIT.REPEAT",91:"PARSE",92:"JUSTIFY",93:"HIDE",94:"UNHIDE",95:"WORKSPACE",96:"FORMULA",97:"FORMULA.FILL",98:"FORMULA.ARRAY",99:"DATA.FIND.NEXT",100:"DATA.FIND.PREV",101:"FORMULA.FIND.NEXT",102:"FORMULA.FIND.PREV",103:"ACTIVATE",104:"ACTIVATE.NEXT",105:"ACTIVATE.PREV",106:"UNLOCKED.NEXT",107:"UNLOCKED.PREV",108:"COPY.PICTURE",109:"SELECT",110:"DELETE.NAME",111:"DELETE.FORMAT",112:"VLINE",113:"HLINE",114:"VPAGE",115:"HPAGE",116:"VSCROLL",117:"HSCROLL",118:"ALERT",119:"NEW",120:"CANCEL.COPY",121:"SHOW.CLIPBOARD",122:"MESSAGE",124:"PASTE.LINK",125:"APP.ACTIVATE",126:"DELETE.ARROW",127:"ROW.HEIGHT",128:"FORMAT.MOVE",129:"FORMAT.SIZE",130:"FORMULA.REPLACE",131:"SEND.KEYS",132:"SELECT.SPECIAL",133:"APPLY.NAMES",134:"REPLACE.FONT",135:"FREEZE.PANES",136:"SHOW.INFO",137:"SPLIT",138:"ON.WINDOW",139:"ON.DATA",140:"DISABLE.INPUT",142:"OUTLINE",143:"LIST.NAMES",144:"FILE.CLOSE",145:"SAVE.WORKBOOK",146:"DATA.FORM",147:"COPY.CHART",148:"ON.TIME",149:"WAIT",150:"FORMAT.FONT",151:"FILL.UP",152:"FILL.LEFT",153:"DELETE.OVERLAY",155:"SHORT.MENUS",159:"SET.UPDATE.STATUS",161:"COLOR.PALETTE",162:"DELETE.STYLE",163:"WINDOW.RESTORE",164:"WINDOW.MAXIMIZE",166:"CHANGE.LINK",167:"CALCULATE.DOCUMENT",168:"ON.KEY",169:"APP.RESTORE",170:"APP.MOVE",171:"APP.SIZE",172:"APP.MINIMIZE",173:"APP.MAXIMIZE",174:"BRING.TO.FRONT",175:"SEND.TO.BACK",185:"MAIN.CHART.TYPE",186:"OVERLAY.CHART.TYPE",187:"SELECT.END",188:"OPEN.MAIL",189:"SEND.MAIL",190:"STANDARD.FONT",191:"CONSOLIDATE",192:"SORT.SPECIAL",193:"GALLERY.3D.AREA",194:"GALLERY.3D.COLUMN",195:"GALLERY.3D.LINE",196:"GALLERY.3D.PIE",197:"VIEW.3D",198:"GOAL.SEEK",199:"WORKGROUP",200:"FILL.GROUP",201:"UPDATE.LINK",202:"PROMOTE",203:"DEMOTE",204:"SHOW.DETAIL",206:"UNGROUP",207:"OBJECT.PROPERTIES",208:"SAVE.NEW.OBJECT",209:"SHARE",210:"SHARE.NAME",211:"DUPLICATE",212:"APPLY.STYLE",213:"ASSIGN.TO.OBJECT",214:"OBJECT.PROTECTION",215:"HIDE.OBJECT",216:"SET.EXTRACT",217:"CREATE.PUBLISHER",218:"SUBSCRIBE.TO",219:"ATTRIBUTES",220:"SHOW.TOOLBAR",222:"PRINT.PREVIEW",223:"EDIT.COLOR",224:"SHOW.LEVELS",225:"FORMAT.MAIN",226:"FORMAT.OVERLAY",227:"ON.RECALC",228:"EDIT.SERIES",229:"DEFINE.STYLE",240:"LINE.PRINT",243:"ENTER.DATA",249:"GALLERY.RADAR",250:"MERGE.STYLES",251:"EDITION.OPTIONS",252:"PASTE.PICTURE",253:"PASTE.PICTURE.LINK",254:"SPELLING",256:"ZOOM",259:"INSERT.OBJECT",260:"WINDOW.MINIMIZE",265:"SOUND.NOTE",266:"SOUND.PLAY",267:"FORMAT.SHAPE",268:"EXTEND.POLYGON",269:"FORMAT.AUTO",272:"GALLERY.3D.BAR",273:"GALLERY.3D.SURFACE",274:"FILL.AUTO",276:"CUSTOMIZE.TOOLBAR",277:"ADD.TOOL",278:"EDIT.OBJECT",279:"ON.DOUBLECLICK",280:"ON.ENTRY",281:"WORKBOOK.ADD",282:"WORKBOOK.MOVE",283:"WORKBOOK.COPY",284:"WORKBOOK.OPTIONS",285:"SAVE.WORKSPACE",288:"CHART.WIZARD",289:"DELETE.TOOL",290:"MOVE.TOOL",291:"WORKBOOK.SELECT",292:"WORKBOOK.ACTIVATE",293:"ASSIGN.TO.TOOL",295:"COPY.TOOL",296:"RESET.TOOL",297:"CONSTRAIN.NUMERIC",298:"PASTE.TOOL",302:"WORKBOOK.NEW",305:"SCENARIO.CELLS",306:"SCENARIO.DELETE",307:"SCENARIO.ADD",308:"SCENARIO.EDIT",309:"SCENARIO.SHOW",310:"SCENARIO.SHOW.NEXT",311:"SCENARIO.SUMMARY",312:"PIVOT.TABLE.WIZARD",313:"PIVOT.FIELD.PROPERTIES",314:"PIVOT.FIELD",315:"PIVOT.ITEM",316:"PIVOT.ADD.FIELDS",318:"OPTIONS.CALCULATION",319:"OPTIONS.EDIT",320:"OPTIONS.VIEW",321:"ADDIN.MANAGER",322:"MENU.EDITOR",323:"ATTACH.TOOLBARS",324:"VBAActivate",325:"OPTIONS.CHART",328:"VBA.INSERT.FILE",330:"VBA.PROCEDURE.DEFINITION",336:"ROUTING.SLIP",338:"ROUTE.DOCUMENT",339:"MAIL.LOGON",342:"INSERT.PICTURE",343:"EDIT.TOOL",344:"GALLERY.DOUGHNUT",350:"CHART.TREND",352:"PIVOT.ITEM.PROPERTIES",354:"WORKBOOK.INSERT",355:"OPTIONS.TRANSITION",356:"OPTIONS.GENERAL",370:"FILTER.ADVANCED",373:"MAIL.ADD.MAILER",374:"MAIL.DELETE.MAILER",375:"MAIL.REPLY",376:"MAIL.REPLY.ALL",377:"MAIL.FORWARD",378:"MAIL.NEXT.LETTER",379:"DATA.LABEL",380:"INSERT.TITLE",381:"FONT.PROPERTIES",382:"MACRO.OPTIONS",383:"WORKBOOK.HIDE",384:"WORKBOOK.UNHIDE",385:"WORKBOOK.DELETE",386:"WORKBOOK.NAME",388:"GALLERY.CUSTOM",390:"ADD.CHART.AUTOFORMAT",391:"DELETE.CHART.AUTOFORMAT",392:"CHART.ADD.DATA",393:"AUTO.OUTLINE",394:"TAB.ORDER",395:"SHOW.DIALOG",396:"SELECT.ALL",397:"UNGROUP.SHEETS",398:"SUBTOTAL.CREATE",399:"SUBTOTAL.REMOVE",400:"RENAME.OBJECT",412:"WORKBOOK.SCROLL",413:"WORKBOOK.NEXT",414:"WORKBOOK.PREV",415:"WORKBOOK.TAB.SPLIT",416:"FULL.SCREEN",417:"WORKBOOK.PROTECT",420:"SCROLLBAR.PROPERTIES",421:"PIVOT.SHOW.PAGES",422:"TEXT.TO.COLUMNS",423:"FORMAT.CHARTTYPE",424:"LINK.FORMAT",425:"TRACER.DISPLAY",430:"TRACER.NAVIGATE",431:"TRACER.CLEAR",432:"TRACER.ERROR",433:"PIVOT.FIELD.GROUP",434:"PIVOT.FIELD.UNGROUP",435:"CHECKBOX.PROPERTIES",436:"LABEL.PROPERTIES",437:"LISTBOX.PROPERTIES",438:"EDITBOX.PROPERTIES",439:"PIVOT.REFRESH",440:"LINK.COMBO",441:"OPEN.TEXT",442:"HIDE.DIALOG",443:"SET.DIALOG.FOCUS",444:"ENABLE.OBJECT",445:"PUSHBUTTON.PROPERTIES",446:"SET.DIALOG.DEFAULT",447:"FILTER",448:"FILTER.SHOW.ALL",449:"CLEAR.OUTLINE",450:"FUNCTION.WIZARD",451:"ADD.LIST.ITEM",452:"SET.LIST.ITEM",453:"REMOVE.LIST.ITEM",454:"SELECT.LIST.ITEM",455:"SET.CONTROL.VALUE",456:"SAVE.COPY.AS",458:"OPTIONS.LISTS.ADD",459:"OPTIONS.LISTS.DELETE",460:"SERIES.AXES",461:"SERIES.X",462:"SERIES.Y",463:"ERRORBAR.X",464:"ERRORBAR.Y",465:"FORMAT.CHART",466:"SERIES.ORDER",467:"MAIL.LOGOFF",468:"CLEAR.ROUTING.SLIP",469:"APP.ACTIVATE.MICROSOFT",470:"MAIL.EDIT.MAILER",471:"ON.SHEET",472:"STANDARD.WIDTH",473:"SCENARIO.MERGE",474:"SUMMARY.INFO",475:"FIND.FILE",476:"ACTIVE.CELL.FONT",477:"ENABLE.TIPWIZARD",478:"VBA.MAKE.ADDIN",480:"INSERTDATATABLE",481:"WORKGROUP.OPTIONS",482:"MAIL.SEND.MAILER",485:"AUTOCORRECT",489:"POST.DOCUMENT",491:"PICKLIST",493:"VIEW.SHOW",494:"VIEW.DEFINE",495:"VIEW.DELETE",509:"SHEET.BACKGROUND",510:"INSERT.MAP.OBJECT",511:"OPTIONS.MENONO",517:"MSOCHECKS",518:"NORMAL",519:"LAYOUT",520:"RM.PRINT.AREA",521:"CLEAR.PRINT.AREA",522:"ADD.PRINT.AREA",523:"MOVE.BRK",545:"HIDECURR.NOTE",546:"HIDEALL.NOTES",547:"DELETE.NOTE",548:"TRAVERSE.NOTES",549:"ACTIVATE.NOTES",620:"PROTECT.REVISIONS",621:"UNPROTECT.REVISIONS",647:"OPTIONS.ME",653:"WEB.PUBLISH",667:"NEWWEBQUERY",673:"PIVOT.TABLE.CHART",753:"OPTIONS.SAVE",755:"OPTIONS.SPELL",808:"HIDEALL.INKANNOTS"},Ftab={0:"COUNT",1:"IF",2:"ISNA",3:"ISERROR",4:"SUM",5:"AVERAGE",6:"MIN",7:"MAX",8:"ROW",9:"COLUMN",10:"NA",11:"NPV",12:"STDEV",13:"DOLLAR",14:"FIXED",15:"SIN",16:"COS",17:"TAN",18:"ATAN",19:"PI",20:"SQRT",21:"EXP",22:"LN",23:"LOG10",24:"ABS",25:"INT",26:"SIGN",27:"ROUND",28:"LOOKUP",29:"INDEX",30:"REPT",31:"MID",32:"LEN",33:"VALUE",34:"TRUE",35:"FALSE",36:"AND",37:"OR",38:"NOT",39:"MOD",40:"DCOUNT",41:"DSUM",42:"DAVERAGE",43:"DMIN",44:"DMAX",45:"DSTDEV",46:"VAR",47:"DVAR",48:"TEXT",49:"LINEST",50:"TREND",51:"LOGEST",52:"GROWTH",53:"GOTO",54:"HALT",55:"RETURN",56:"PV",57:"FV",58:"NPER",59:"PMT",60:"RATE",61:"MIRR",62:"IRR",63:"RAND",64:"MATCH",65:"DATE",66:"TIME",67:"DAY",68:"MONTH",69:"YEAR",70:"WEEKDAY",71:"HOUR",72:"MINUTE",73:"SECOND",74:"NOW",75:"AREAS",76:"ROWS",77:"COLUMNS",78:"OFFSET",79:"ABSREF",80:"RELREF",81:"ARGUMENT",82:"SEARCH",83:"TRANSPOSE",84:"ERROR",85:"STEP",86:"TYPE",87:"ECHO",88:"SET.NAME",89:"CALLER",90:"DEREF",91:"WINDOWS",92:"SERIES",93:"DOCUMENTS",94:"ACTIVE.CELL",95:"SELECTION",96:"RESULT",97:"ATAN2",98:"ASIN",99:"ACOS",100:"CHOOSE",101:"HLOOKUP",102:"VLOOKUP",103:"LINKS",104:"INPUT",105:"ISREF",106:"GET.FORMULA",107:"GET.NAME",108:"SET.VALUE",109:"LOG",110:"EXEC",111:"CHAR",112:"LOWER",113:"UPPER",114:"PROPER",115:"LEFT",116:"RIGHT",117:"EXACT",118:"TRIM",119:"REPLACE",120:"SUBSTITUTE",121:"CODE",122:"NAMES",123:"DIRECTORY",124:"FIND",125:"CELL",126:"ISERR",127:"ISTEXT",128:"ISNUMBER",129:"ISBLANK",130:"T",131:"N",132:"FOPEN",133:"FCLOSE",134:"FSIZE",135:"FREADLN",136:"FREAD",137:"FWRITELN",138:"FWRITE",139:"FPOS",140:"DATEVALUE",141:"TIMEVALUE",142:"SLN",143:"SYD",144:"DDB",145:"GET.DEF",146:"REFTEXT",147:"TEXTREF",148:"INDIRECT",149:"REGISTER",150:"CALL",151:"ADD.BAR",152:"ADD.MENU",153:"ADD.COMMAND",154:"ENABLE.COMMAND",155:"CHECK.COMMAND",156:"RENAME.COMMAND",157:"SHOW.BAR",158:"DELETE.MENU",159:"DELETE.COMMAND",160:"GET.CHART.ITEM",161:"DIALOG.BOX",162:"CLEAN",163:"MDETERM",164:"MINVERSE",165:"MMULT",166:"FILES",167:"IPMT",168:"PPMT",169:"COUNTA",170:"CANCEL.KEY",171:"FOR",172:"WHILE",173:"BREAK",174:"NEXT",175:"INITIATE",176:"REQUEST",177:"POKE",178:"EXECUTE",179:"TERMINATE",180:"RESTART",181:"HELP",182:"GET.BAR",183:"PRODUCT",184:"FACT",185:"GET.CELL",186:"GET.WORKSPACE",187:"GET.WINDOW",188:"GET.DOCUMENT",189:"DPRODUCT",190:"ISNONTEXT",191:"GET.NOTE",192:"NOTE",193:"STDEVP",194:"VARP",195:"DSTDEVP",196:"DVARP",197:"TRUNC",198:"ISLOGICAL",199:"DCOUNTA",200:"DELETE.BAR",201:"UNREGISTER",204:"USDOLLAR",205:"FINDB",206:"SEARCHB",207:"REPLACEB",208:"LEFTB",209:"RIGHTB",210:"MIDB",211:"LENB",212:"ROUNDUP",213:"ROUNDDOWN",214:"ASC",215:"DBCS",216:"RANK",219:"ADDRESS",220:"DAYS360",221:"TODAY",222:"VDB",223:"ELSE",224:"ELSE.IF",225:"END.IF",226:"FOR.CELL",227:"MEDIAN",228:"SUMPRODUCT",229:"SINH",230:"COSH",231:"TANH",232:"ASINH",233:"ACOSH",234:"ATANH",235:"DGET",236:"CREATE.OBJECT",237:"VOLATILE",238:"LAST.ERROR",239:"CUSTOM.UNDO",240:"CUSTOM.REPEAT",241:"FORMULA.CONVERT",242:"GET.LINK.INFO",243:"TEXT.BOX",244:"INFO",245:"GROUP",246:"GET.OBJECT",247:"DB",248:"PAUSE",251:"RESUME",252:"FREQUENCY",253:"ADD.TOOLBAR",254:"DELETE.TOOLBAR",255:"User",256:"RESET.TOOLBAR",257:"EVALUATE",258:"GET.TOOLBAR",259:"GET.TOOL",260:"SPELLING.CHECK",261:"ERROR.TYPE",262:"APP.TITLE",263:"WINDOW.TITLE",264:"SAVE.TOOLBAR",265:"ENABLE.TOOL",266:"PRESS.TOOL",267:"REGISTER.ID",268:"GET.WORKBOOK",269:"AVEDEV",270:"BETADIST",271:"GAMMALN",272:"BETAINV",273:"BINOMDIST",274:"CHIDIST",275:"CHIINV",276:"COMBIN",277:"CONFIDENCE",278:"CRITBINOM",279:"EVEN",280:"EXPONDIST",281:"FDIST",282:"FINV",283:"FISHER",284:"FISHERINV",285:"FLOOR",286:"GAMMADIST",287:"GAMMAINV",288:"CEILING",289:"HYPGEOMDIST",290:"LOGNORMDIST",291:"LOGINV",292:"NEGBINOMDIST",293:"NORMDIST",294:"NORMSDIST",295:"NORMINV",296:"NORMSINV",297:"STANDARDIZE",298:"ODD",299:"PERMUT",300:"POISSON",301:"TDIST",302:"WEIBULL",303:"SUMXMY2",304:"SUMX2MY2",305:"SUMX2PY2",306:"CHITEST",307:"CORREL",308:"COVAR",309:"FORECAST",310:"FTEST",311:"INTERCEPT",312:"PEARSON",313:"RSQ",314:"STEYX",315:"SLOPE",316:"TTEST",317:"PROB",318:"DEVSQ",319:"GEOMEAN",320:"HARMEAN",321:"SUMSQ",322:"KURT",323:"SKEW",324:"ZTEST",325:"LARGE",326:"SMALL",327:"QUARTILE",328:"PERCENTILE",329:"PERCENTRANK",330:"MODE",331:"TRIMMEAN",332:"TINV",334:"MOVIE.COMMAND",335:"GET.MOVIE",336:"CONCATENATE",337:"POWER",338:"PIVOT.ADD.DATA",339:"GET.PIVOT.TABLE",340:"GET.PIVOT.FIELD",341:"GET.PIVOT.ITEM",342:"RADIANS",343:"DEGREES",344:"SUBTOTAL",345:"SUMIF",346:"COUNTIF",347:"COUNTBLANK",348:"SCENARIO.GET",349:"OPTIONS.LISTS.GET",350:"ISPMT",351:"DATEDIF",352:"DATESTRING",353:"NUMBERSTRING",354:"ROMAN",355:"OPEN.DIALOG",356:"SAVE.DIALOG",357:"VIEW.GET",358:"GETPIVOTDATA",359:"HYPERLINK",360:"PHONETIC",361:"AVERAGEA",362:"MAXA",363:"MINA",364:"STDEVPA",365:"VARPA",366:"STDEVA",367:"VARA",368:"BAHTTEXT",369:"THAIDAYOFWEEK",370:"THAIDIGIT",371:"THAIMONTHOFYEAR",372:"THAINUMSOUND",373:"THAINUMSTRING",374:"THAISTRINGLENGTH",375:"ISTHAIDIGIT",376:"ROUNDBAHTDOWN",377:"ROUNDBAHTUP",378:"THAIYEAR",379:"RTD",380:"CUBEVALUE",381:"CUBEMEMBER",382:"CUBEMEMBERPROPERTY",383:"CUBERANKEDMEMBER",384:"HEX2BIN",385:"HEX2DEC",386:"HEX2OCT",387:"DEC2BIN",388:"DEC2HEX",389:"DEC2OCT",390:"OCT2BIN",391:"OCT2HEX",392:"OCT2DEC",393:"BIN2DEC",394:"BIN2OCT",395:"BIN2HEX",396:"IMSUB",397:"IMDIV",398:"IMPOWER",399:"IMABS",400:"IMSQRT",401:"IMLN",402:"IMLOG2",403:"IMLOG10",404:"IMSIN",405:"IMCOS",406:"IMEXP",407:"IMARGUMENT",408:"IMCONJUGATE",409:"IMAGINARY",410:"IMREAL",411:"COMPLEX",412:"IMSUM",413:"IMPRODUCT",414:"SERIESSUM",415:"FACTDOUBLE",416:"SQRTPI",417:"QUOTIENT",418:"DELTA",419:"GESTEP",420:"ISEVEN",421:"ISODD",422:"MROUND",423:"ERF",424:"ERFC",425:"BESSELJ",426:"BESSELK",427:"BESSELY",428:"BESSELI",429:"XIRR",430:"XNPV",431:"PRICEMAT",432:"YIELDMAT",433:"INTRATE",434:"RECEIVED",435:"DISC",436:"PRICEDISC",437:"YIELDDISC",438:"TBILLEQ",439:"TBILLPRICE",440:"TBILLYIELD",441:"PRICE",442:"YIELD",443:"DOLLARDE",444:"DOLLARFR",445:"NOMINAL",446:"EFFECT",447:"CUMPRINC",448:"CUMIPMT",449:"EDATE",450:"EOMONTH",451:"YEARFRAC",452:"COUPDAYBS",453:"COUPDAYS",454:"COUPDAYSNC",455:"COUPNCD",456:"COUPNUM",457:"COUPPCD",458:"DURATION",459:"MDURATION",460:"ODDLPRICE",461:"ODDLYIELD",462:"ODDFPRICE",463:"ODDFYIELD",464:"RANDBETWEEN",465:"WEEKNUM",466:"AMORDEGRC",467:"AMORLINC",468:"CONVERT",724:"SHEETJS",469:"ACCRINT",470:"ACCRINTM",471:"WORKDAY",472:"NETWORKDAYS",473:"GCD",474:"MULTINOMIAL",475:"LCM",476:"FVSCHEDULE",477:"CUBEKPIMEMBER",478:"CUBESET",479:"CUBESETCOUNT",480:"IFERROR",481:"COUNTIFS",482:"SUMIFS",483:"AVERAGEIF",484:"AVERAGEIFS"},FtabArgc={2:1,3:1,10:0,15:1,16:1,17:1,18:1,19:0,20:1,21:1,22:1,23:1,24:1,25:1,26:1,27:2,30:2,31:3,32:1,33:1,34:0,35:0,38:1,39:2,40:3,41:3,42:3,43:3,44:3,45:3,47:3,48:2,53:1,61:3,63:0,65:3,66:3,67:1,68:1,69:1,70:1,71:1,72:1,73:1,74:0,75:1,76:1,77:1,79:2,80:2,83:1,85:0,86:1,89:0,90:1,94:0,95:0,97:2,98:1,99:1,101:3,102:3,105:1,106:1,108:2,111:1,112:1,113:1,114:1,117:2,118:1,119:4,121:1,126:1,127:1,128:1,129:1,130:1,131:1,133:1,134:1,135:1,136:2,137:2,138:2,140:1,141:1,142:3,143:4,144:4,161:1,162:1,163:1,164:1,165:2,172:1,175:2,176:2,177:3,178:2,179:1,184:1,186:1,189:3,190:1,195:3,196:3,197:1,198:1,199:3,201:1,207:4,210:3,211:1,212:2,213:2,214:1,215:1,225:0,229:1,230:1,231:1,232:1,233:1,234:1,235:3,244:1,247:4,252:2,257:1,261:1,271:1,273:4,274:2,275:2,276:2,277:3,278:3,279:1,280:3,281:3,282:3,283:1,284:1,285:2,286:4,287:3,288:2,289:4,290:3,291:3,292:3,293:4,294:1,295:3,296:1,297:3,298:1,299:2,300:3,301:3,302:4,303:2,304:2,305:2,306:2,307:2,308:2,309:3,310:2,311:2,312:2,313:2,314:2,315:2,316:4,325:2,326:2,327:2,328:2,331:2,332:2,337:2,342:1,343:1,346:2,347:1,350:4,351:3,352:1,353:2,360:1,368:1,369:1,370:1,371:1,372:1,373:1,374:1,375:1,376:1,377:1,378:1,382:3,385:1,392:1,393:1,396:2,397:2,398:2,399:1,400:1,401:1,402:1,403:1,404:1,405:1,406:1,407:1,408:1,409:1,410:1,414:4,415:1,416:1,417:2,420:1,421:1,422:2,424:1,425:2,426:2,427:2,428:2,430:3,438:3,439:3,440:3,443:2,444:2,445:2,446:2,447:6,448:6,449:2,450:2,464:2,468:3,476:2,479:1,480:2,65535:0};function ods_to_csf_formula(E){return E.slice(0,3)=="of:"&&(E=E.slice(3)),E.charCodeAt(0)==61&&(E=E.slice(1),E.charCodeAt(0)==61&&(E=E.slice(1))),E=E.replace(/COM\.MICROSOFT\./g,""),E=E.replace(/\[((?:\.[A-Z]+[0-9]+)(?::\.[A-Z]+[0-9]+)?)\]/g,function(r,v){return v.replace(/\./g,"")}),E=E.replace(/\[.(#[A-Z]*[?!])\]/g,"$1"),E.replace(/[;~]/g,",").replace(/\|/g,";")}function ods_to_csf_3D(E){var r=E.split(":"),v=r[0].split(".")[0];return[v,r[0].split(".")[1]+(r.length>1?":"+(r[1].split(".")[1]||r[1].split(".")[0]):"")]}var strs={},_ssfopts={};function default_margins(E,r){if(E){var v=[.7,.7,.75,.75,.3,.3];r=="xlml"&&(v=[1,1,1,1,.5,.5]),E.left==null&&(E.left=v[0]),E.right==null&&(E.right=v[1]),E.top==null&&(E.top=v[2]),E.bottom==null&&(E.bottom=v[3]),E.header==null&&(E.header=v[4]),E.footer==null&&(E.footer=v[5])}}function safe_format(E,r,v,T,w,S){try{T.cellNF&&(E.z=table_fmt[r])}catch(H){if(T.WTF)throw H}if(!(E.t==="z"&&!T.cellStyles)){if(E.t==="d"&&typeof E.v=="string"&&(E.v=parseDate(E.v)),(!T||T.cellText!==!1)&&E.t!=="z")try{if(table_fmt[r]==null&&SSF_load(SSFImplicit[r]||"General",r),E.t==="e")E.w=E.w||BErr[E.v];else if(r===0)if(E.t==="n")(E.v|0)===E.v?E.w=E.v.toString(10):E.w=SSF_general_num(E.v);else if(E.t==="d"){var I=datenum(E.v);(I|0)===I?E.w=I.toString(10):E.w=SSF_general_num(I)}else{if(E.v===void 0)return"";E.w=SSF_general(E.v,_ssfopts)}else E.t==="d"?E.w=SSF_format(r,datenum(E.v),_ssfopts):E.w=SSF_format(r,E.v,_ssfopts)}catch(H){if(T.WTF)throw H}if(T.cellStyles&&v!=null)try{E.s=S.Fills[v],E.s.fgColor&&E.s.fgColor.theme&&!E.s.fgColor.rgb&&(E.s.fgColor.rgb=rgb_tint(w.themeElements.clrScheme[E.s.fgColor.theme].rgb,E.s.fgColor.tint||0),T.WTF&&(E.s.fgColor.raw_rgb=w.themeElements.clrScheme[E.s.fgColor.theme].rgb)),E.s.bgColor&&E.s.bgColor.theme&&(E.s.bgColor.rgb=rgb_tint(w.themeElements.clrScheme[E.s.bgColor.theme].rgb,E.s.bgColor.tint||0),T.WTF&&(E.s.bgColor.raw_rgb=w.themeElements.clrScheme[E.s.bgColor.theme].rgb))}catch(H){if(T.WTF&&S.Fills)throw H}}}function parse_ws_xml_dim(E,r){var v=safe_decode_range(r);v.s.r<=v.e.r&&v.s.c<=v.e.c&&v.s.r>=0&&v.s.c>=0&&(E["!ref"]=encode_range(v))}var mergecregex=/<(?:\w:)?mergeCell ref="[A-Z0-9:]+"\s*[\/]?>/g,sheetdataregex=/<(?:\w+:)?sheetData[^>]*>([\s\S]*)<\/(?:\w+:)?sheetData>/,hlinkregex=/<(?:\w:)?hyperlink [^>]*>/mg,dimregex=/"(\w*:\w*)"/,colregex=/<(?:\w:)?col\b[^>]*[\/]?>/g,afregex=/<(?:\w:)?autoFilter[^>]*([\/]|>([\s\S]*)<\/(?:\w:)?autoFilter)>/g,marginregex=/<(?:\w:)?pageMargins[^>]*\/>/g,sheetprregex=/<(?:\w:)?sheetPr\b(?:[^>a-z][^>]*)?\/>/,sheetprregex2=/<(?:\w:)?sheetPr[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetPr)>/,svsregex=/<(?:\w:)?sheetViews[^>]*(?:[\/]|>([\s\S]*)<\/(?:\w:)?sheetViews)>/;function parse_ws_xml(E,r,v,T,w,S,I){if(!E)return E;T||(T={"!id":{}});var H=r.dense?[]:{},te={s:{r:2e6,c:2e6},e:{r:0,c:0}},ae="",ie="",ce=E.match(sheetdataregex);ce?(ae=E.slice(0,ce.index),ie=E.slice(ce.index+ce[0].length)):ae=ie=E;var me=ae.match(sheetprregex);me?parse_ws_xml_sheetpr(me[0],H,w,v):(me=ae.match(sheetprregex2))&&parse_ws_xml_sheetpr2(me[0],me[1]||"",H,w,v);var _e=(ae.match(/<(?:\w*:)?dimension/)||{index:-1}).index;if(_e>0){var Re=ae.slice(_e,_e+50).match(dimregex);Re&&parse_ws_xml_dim(H,Re[1])}var Pe=ae.match(svsregex);Pe&&Pe[1]&&parse_ws_xml_sheetviews(Pe[1],w);var Ce=[];if(r.cellStyles){var Fe=ae.match(colregex);Fe&&parse_ws_xml_cols(Ce,Fe)}ce&&parse_ws_xml_data(ce[1],H,r,te,S,I);var Me=ie.match(afregex);Me&&(H["!autofilter"]=parse_ws_xml_autofilter(Me[0]));var Ve=[],We=ie.match(mergecregex);if(We)for(_e=0;_e!=We.length;++_e)Ve[_e]=safe_decode_range(We[_e].slice(We[_e].indexOf('"')+1));var ze=ie.match(hlinkregex);ze&&parse_ws_xml_hlinks(H,ze,T);var Ue=ie.match(marginregex);if(Ue&&(H["!margins"]=parse_ws_xml_margins(parsexmltag(Ue[0]))),!H["!ref"]&&te.e.c>=te.s.c&&te.e.r>=te.s.r&&(H["!ref"]=encode_range(te)),r.sheetRows>0&&H["!ref"]){var je=safe_decode_range(H["!ref"]);r.sheetRows<=+je.e.r&&(je.e.r=r.sheetRows-1,je.e.r>te.e.r&&(je.e.r=te.e.r),je.e.r<je.s.r&&(je.s.r=je.e.r),je.e.c>te.e.c&&(je.e.c=te.e.c),je.e.c<je.s.c&&(je.s.c=je.e.c),H["!fullref"]=H["!ref"],H["!ref"]=encode_range(je))}return Ce.length>0&&(H["!cols"]=Ce),Ve.length>0&&(H["!merges"]=Ve),H}function parse_ws_xml_sheetpr(E,r,v,T){var w=parsexmltag(E);v.Sheets[T]||(v.Sheets[T]={}),w.codeName&&(v.Sheets[T].CodeName=unescapexml(utf8read(w.codeName)))}function parse_ws_xml_sheetpr2(E,r,v,T,w){parse_ws_xml_sheetpr(E.slice(0,E.indexOf(">")),v,T,w)}function parse_ws_xml_hlinks(E,r,v){for(var T=Array.isArray(E),w=0;w!=r.length;++w){var S=parsexmltag(utf8read(r[w]),!0);if(!S.ref)return;var I=((v||{})["!id"]||[])[S.id];I?(S.Target=I.Target,S.location&&(S.Target+="#"+unescapexml(S.location))):(S.Target="#"+unescapexml(S.location),I={Target:S.Target,TargetMode:"Internal"}),S.Rel=I,S.tooltip&&(S.Tooltip=S.tooltip,delete S.tooltip);for(var H=safe_decode_range(S.ref),te=H.s.r;te<=H.e.r;++te)for(var ae=H.s.c;ae<=H.e.c;++ae){var ie=encode_cell({c:ae,r:te});T?(E[te]||(E[te]=[]),E[te][ae]||(E[te][ae]={t:"z",v:void 0}),E[te][ae].l=S):(E[ie]||(E[ie]={t:"z",v:void 0}),E[ie].l=S)}}}function parse_ws_xml_margins(E){var r={};return["left","right","top","bottom","header","footer"].forEach(function(v){E[v]&&(r[v]=parseFloat(E[v]))}),r}function parse_ws_xml_cols(E,r){for(var v=!1,T=0;T!=r.length;++T){var w=parsexmltag(r[T],!0);w.hidden&&(w.hidden=parsexmlbool(w.hidden));var S=parseInt(w.min,10)-1,I=parseInt(w.max,10)-1;for(w.outlineLevel&&(w.level=+w.outlineLevel||0),delete w.min,delete w.max,w.width=+w.width,!v&&w.width&&(v=!0,find_mdw_colw(w.width)),process_col(w);S<=I;)E[S++]=dup(w)}}function parse_ws_xml_autofilter(E){var r={ref:(E.match(/ref="([^"]*)"/)||[])[1]};return r}var sviewregex=/<(?:\w:)?sheetView(?:[^>a-z][^>]*)?\/?>/;function parse_ws_xml_sheetviews(E,r){r.Views||(r.Views=[{}]),(E.match(sviewregex)||[]).forEach(function(v,T){var w=parsexmltag(v);r.Views[T]||(r.Views[T]={}),+w.zoomScale&&(r.Views[T].zoom=+w.zoomScale),parsexmlbool(w.rightToLeft)&&(r.Views[T].RTL=!0)})}var parse_ws_xml_data=function(){var E=/<(?:\w+:)?c[ \/>]/,r=/<\/(?:\w+:)?row>/,v=/r=["']([^"']*)["']/,T=/<(?:\w+:)?is>([\S\s]*?)<\/(?:\w+:)?is>/,w=/ref=["']([^"']*)["']/,S=matchtag("v"),I=matchtag("f");return function(te,ae,ie,ce,me,_e){for(var Re=0,Pe="",Ce=[],Fe=[],Me=0,Ve=0,We=0,ze="",Ue,je,ke=0,Ne=0,Ge,Ie,Le=0,He=0,Ct=Array.isArray(_e.CellXf),Ze,Rt=[],nt=[],nr=Array.isArray(ae),Je=[],Wt={},Lt=!1,qe=!!ie.sheetStubs,$e=te.split(r),Be=0,Xe=$e.length;Be!=Xe;++Be){Pe=$e[Be].trim();var rt=Pe.length;if(rt!==0){var Qe=0;e:for(Re=0;Re<rt;++Re)switch(Pe[Re]){case">":if(Pe[Re-1]!="/"){++Re;break e}if(ie&&ie.cellStyles){if(je=parsexmltag(Pe.slice(Qe,Re),!0),ke=je.r!=null?parseInt(je.r,10):ke+1,Ne=-1,ie.sheetRows&&ie.sheetRows<ke)continue;Wt={},Lt=!1,je.ht&&(Lt=!0,Wt.hpt=parseFloat(je.ht),Wt.hpx=pt2px(Wt.hpt)),je.hidden=="1"&&(Lt=!0,Wt.hidden=!0),je.outlineLevel!=null&&(Lt=!0,Wt.level=+je.outlineLevel),Lt&&(Je[ke-1]=Wt)}break;case"<":Qe=Re;break}if(Qe>=Re)break;if(je=parsexmltag(Pe.slice(Qe,Re),!0),ke=je.r!=null?parseInt(je.r,10):ke+1,Ne=-1,!(ie.sheetRows&&ie.sheetRows<ke)){ce.s.r>ke-1&&(ce.s.r=ke-1),ce.e.r<ke-1&&(ce.e.r=ke-1),ie&&ie.cellStyles&&(Wt={},Lt=!1,je.ht&&(Lt=!0,Wt.hpt=parseFloat(je.ht),Wt.hpx=pt2px(Wt.hpt)),je.hidden=="1"&&(Lt=!0,Wt.hidden=!0),je.outlineLevel!=null&&(Lt=!0,Wt.level=+je.outlineLevel),Lt&&(Je[ke-1]=Wt)),Ce=Pe.slice(Re).split(E);for(var vt=0;vt!=Ce.length&&Ce[vt].trim().charAt(0)=="<";++vt);for(Ce=Ce.slice(vt),Re=0;Re!=Ce.length;++Re)if(Pe=Ce[Re].trim(),Pe.length!==0){if(Fe=Pe.match(v),Me=Re,Ve=0,We=0,Pe="<c "+(Pe.slice(0,1)=="<"?">":"")+Pe,Fe!=null&&Fe.length===2){for(Me=0,ze=Fe[1],Ve=0;Ve!=ze.length&&!((We=ze.charCodeAt(Ve)-64)<1||We>26);++Ve)Me=26*Me+We;--Me,Ne=Me}else++Ne;for(Ve=0;Ve!=Pe.length&&Pe.charCodeAt(Ve)!==62;++Ve);if(++Ve,je=parsexmltag(Pe.slice(0,Ve),!0),je.r||(je.r=encode_cell({r:ke-1,c:Ne})),ze=Pe.slice(Ve),Ue={t:""},(Fe=ze.match(S))!=null&&Fe[1]!==""&&(Ue.v=unescapexml(Fe[1])),ie.cellFormula){if((Fe=ze.match(I))!=null&&Fe[1]!==""){if(Ue.f=unescapexml(utf8read(Fe[1])).replace(/\r\n/g,`
`),ie.xlfn||(Ue.f=_xlfn(Ue.f)),Fe[0].indexOf('t="array"')>-1)Ue.F=(ze.match(w)||[])[1],Ue.F.indexOf(":")>-1&&Rt.push([safe_decode_range(Ue.F),Ue.F]);else if(Fe[0].indexOf('t="shared"')>-1){Ie=parsexmltag(Fe[0]);var Dt=unescapexml(utf8read(Fe[1]));ie.xlfn||(Dt=_xlfn(Dt)),nt[parseInt(Ie.si,10)]=[Ie,Dt,je.r]}}else(Fe=ze.match(/<f[^>]*\/>/))&&(Ie=parsexmltag(Fe[0]),nt[Ie.si]&&(Ue.f=shift_formula_xlsx(nt[Ie.si][1],nt[Ie.si][2],je.r)));var Ut=decode_cell(je.r);for(Ve=0;Ve<Rt.length;++Ve)Ut.r>=Rt[Ve][0].s.r&&Ut.r<=Rt[Ve][0].e.r&&Ut.c>=Rt[Ve][0].s.c&&Ut.c<=Rt[Ve][0].e.c&&(Ue.F=Rt[Ve][1])}if(je.t==null&&Ue.v===void 0)if(Ue.f||Ue.F)Ue.v=0,Ue.t="n";else if(qe)Ue.t="z";else continue;else Ue.t=je.t||"n";switch(ce.s.c>Ne&&(ce.s.c=Ne),ce.e.c<Ne&&(ce.e.c=Ne),Ue.t){case"n":if(Ue.v==""||Ue.v==null){if(!qe)continue;Ue.t="z"}else Ue.v=parseFloat(Ue.v);break;case"s":if(typeof Ue.v>"u"){if(!qe)continue;Ue.t="z"}else Ge=strs[parseInt(Ue.v,10)],Ue.v=Ge.t,Ue.r=Ge.r,ie.cellHTML&&(Ue.h=Ge.h);break;case"str":Ue.t="s",Ue.v=Ue.v!=null?utf8read(Ue.v):"",ie.cellHTML&&(Ue.h=escapehtml(Ue.v));break;case"inlineStr":Fe=ze.match(T),Ue.t="s",Fe!=null&&(Ge=parse_si(Fe[1]))?(Ue.v=Ge.t,ie.cellHTML&&(Ue.h=Ge.h)):Ue.v="";break;case"b":Ue.v=parsexmlbool(Ue.v);break;case"d":ie.cellDates?Ue.v=parseDate(Ue.v,1):(Ue.v=datenum(parseDate(Ue.v,1)),Ue.t="n");break;case"e":(!ie||ie.cellText!==!1)&&(Ue.w=Ue.v),Ue.v=RBErr[Ue.v];break}if(Le=He=0,Ze=null,Ct&&je.s!==void 0&&(Ze=_e.CellXf[je.s],Ze!=null&&(Ze.numFmtId!=null&&(Le=Ze.numFmtId),ie.cellStyles&&Ze.fillId!=null&&(He=Ze.fillId))),safe_format(Ue,Le,He,ie,me,_e),ie.cellDates&&Ct&&Ue.t=="n"&&fmt_is_date(table_fmt[Le])&&(Ue.t="d",Ue.v=numdate(Ue.v)),je.cm&&ie.xlmeta){var hr=(ie.xlmeta.Cell||[])[+je.cm-1];hr&&hr.type=="XLDAPR"&&(Ue.D=!0)}if(nr){var pt=decode_cell(je.r);ae[pt.r]||(ae[pt.r]=[]),ae[pt.r][pt.c]=Ue}else ae[je.r]=Ue}}}}Je.length>0&&(ae["!rows"]=Je)}}();function parse_BrtRowHdr(E,r){var v={},T=E.l+r;v.r=E.read_shift(4),E.l+=4;var w=E.read_shift(2);E.l+=1;var S=E.read_shift(1);return E.l=T,S&7&&(v.level=S&7),S&16&&(v.hidden=!0),S&32&&(v.hpt=w/20),v}var parse_BrtWsDim=parse_UncheckedRfX;function parse_BrtWsFmtInfo(){}function parse_BrtWsProp(E,r){var v={},T=E[E.l];return++E.l,v.above=!(T&64),v.left=!(T&128),E.l+=18,v.name=parse_XLSBCodeName(E),v}function parse_BrtCellBlank(E){var r=parse_XLSBCell(E);return[r]}function parse_BrtShortBlank(E){var r=parse_XLSBShortCell(E);return[r]}function parse_BrtCellBool(E){var r=parse_XLSBCell(E),v=E.read_shift(1);return[r,v,"b"]}function parse_BrtShortBool(E){var r=parse_XLSBShortCell(E),v=E.read_shift(1);return[r,v,"b"]}function parse_BrtCellError(E){var r=parse_XLSBCell(E),v=E.read_shift(1);return[r,v,"e"]}function parse_BrtShortError(E){var r=parse_XLSBShortCell(E),v=E.read_shift(1);return[r,v,"e"]}function parse_BrtCellIsst(E){var r=parse_XLSBCell(E),v=E.read_shift(4);return[r,v,"s"]}function parse_BrtShortIsst(E){var r=parse_XLSBShortCell(E),v=E.read_shift(4);return[r,v,"s"]}function parse_BrtCellReal(E){var r=parse_XLSBCell(E),v=parse_Xnum(E);return[r,v,"n"]}function parse_BrtShortReal(E){var r=parse_XLSBShortCell(E),v=parse_Xnum(E);return[r,v,"n"]}function parse_BrtCellRk(E){var r=parse_XLSBCell(E),v=parse_RkNumber(E);return[r,v,"n"]}function parse_BrtShortRk(E){var r=parse_XLSBShortCell(E),v=parse_RkNumber(E);return[r,v,"n"]}function parse_BrtCellRString(E){var r=parse_XLSBCell(E),v=parse_RichStr(E);return[r,v,"is"]}function parse_BrtCellSt(E){var r=parse_XLSBCell(E),v=parse_XLWideString(E);return[r,v,"str"]}function parse_BrtShortSt(E){var r=parse_XLSBShortCell(E),v=parse_XLWideString(E);return[r,v,"str"]}function parse_BrtFmlaBool(E,r,v){var T=E.l+r,w=parse_XLSBCell(E);w.r=v["!row"];var S=E.read_shift(1),I=[w,S,"b"];if(v.cellFormula){E.l+=2;var H=parse_XLSBCellParsedFormula(E,T-E.l,v);I[3]=stringify_formula(H,null,w,v.supbooks,v)}else E.l=T;return I}function parse_BrtFmlaError(E,r,v){var T=E.l+r,w=parse_XLSBCell(E);w.r=v["!row"];var S=E.read_shift(1),I=[w,S,"e"];if(v.cellFormula){E.l+=2;var H=parse_XLSBCellParsedFormula(E,T-E.l,v);I[3]=stringify_formula(H,null,w,v.supbooks,v)}else E.l=T;return I}function parse_BrtFmlaNum(E,r,v){var T=E.l+r,w=parse_XLSBCell(E);w.r=v["!row"];var S=parse_Xnum(E),I=[w,S,"n"];if(v.cellFormula){E.l+=2;var H=parse_XLSBCellParsedFormula(E,T-E.l,v);I[3]=stringify_formula(H,null,w,v.supbooks,v)}else E.l=T;return I}function parse_BrtFmlaString(E,r,v){var T=E.l+r,w=parse_XLSBCell(E);w.r=v["!row"];var S=parse_XLWideString(E),I=[w,S,"str"];if(v.cellFormula){E.l+=2;var H=parse_XLSBCellParsedFormula(E,T-E.l,v);I[3]=stringify_formula(H,null,w,v.supbooks,v)}else E.l=T;return I}var parse_BrtMergeCell=parse_UncheckedRfX;function parse_BrtHLink(E,r){var v=E.l+r,T=parse_UncheckedRfX(E),w=parse_XLNullableWideString(E),S=parse_XLWideString(E),I=parse_XLWideString(E),H=parse_XLWideString(E);E.l=v;var te={rfx:T,relId:w,loc:S,display:H};return I&&(te.Tooltip=I),te}function parse_BrtPane(){}function parse_BrtArrFmla(E,r,v){var T=E.l+r,w=parse_RfX(E),S=E.read_shift(1),I=[w];if(I[2]=S,v.cellFormula){var H=parse_XLSBArrayParsedFormula(E,T-E.l,v);I[1]=H}else E.l=T;return I}function parse_BrtShrFmla(E,r,v){var T=E.l+r,w=parse_UncheckedRfX(E),S=[w];if(v.cellFormula){var I=parse_XLSBSharedParsedFormula(E,T-E.l,v);S[1]=I,E.l=T}else E.l=T;return S}var BrtMarginKeys=["left","right","top","bottom","header","footer"];function parse_BrtMargins(E){var r={};return BrtMarginKeys.forEach(function(v){r[v]=parse_Xnum(E)}),r}function parse_BrtBeginWsView(E){var r=E.read_shift(2);return E.l+=28,{RTL:r&32}}function parse_BrtDVal(){}function parse_BrtDVal14(){}function parse_ws_bin(E,r,v,T,w,S,I){if(!E)return E;var H=r||{};T||(T={"!id":{}});var te=H.dense?[]:{},ae,ie={s:{r:2e6,c:2e6},e:{r:0,c:0}},ce=!1,me=!1,_e,Re,Pe,Ce,Fe,Me,Ve,We,ze,Ue=[];H.biff=12,H["!row"]=0;var je=0,ke=!1,Ne=[],Ge={},Ie=H.supbooks||w.supbooks||[[]];if(Ie.sharedf=Ge,Ie.arrayf=Ne,Ie.SheetNames=w.SheetNames||w.Sheets.map(function(nr){return nr.name}),!H.supbooks&&(H.supbooks=Ie,w.Names))for(var Le=0;Le<w.Names.length;++Le)Ie[0][Le+1]=w.Names[Le];var He=[],Ct=[],Ze=!1;XLSBRecordEnum[16]={n:"BrtShortReal",f:parse_BrtShortReal};var Rt;if(recordhopper(E,function(Je,Wt,Lt){if(!me)switch(Lt){case 148:ae=Je;break;case 0:_e=Je,H.sheetRows&&H.sheetRows<=_e.r&&(me=!0),We=encode_row(Ce=_e.r),H["!row"]=_e.r,(Je.hidden||Je.hpt||Je.level!=null)&&(Je.hpt&&(Je.hpx=pt2px(Je.hpt)),Ct[Je.r]=Je);break;case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 13:case 14:case 15:case 16:case 17:case 18:case 62:switch(Re={t:Je[2]},Je[2]){case"n":Re.v=Je[1];break;case"s":Ve=strs[Je[1]],Re.v=Ve.t,Re.r=Ve.r;break;case"b":Re.v=!!Je[1];break;case"e":Re.v=Je[1],H.cellText!==!1&&(Re.w=BErr[Re.v]);break;case"str":Re.t="s",Re.v=Je[1];break;case"is":Re.t="s",Re.v=Je[1].t;break}if((Pe=I.CellXf[Je[0].iStyleRef])&&safe_format(Re,Pe.numFmtId,null,H,S,I),Fe=Je[0].c==-1?Fe+1:Je[0].c,H.dense?(te[Ce]||(te[Ce]=[]),te[Ce][Fe]=Re):te[encode_col(Fe)+We]=Re,H.cellFormula){for(ke=!1,je=0;je<Ne.length;++je){var qe=Ne[je];_e.r>=qe[0].s.r&&_e.r<=qe[0].e.r&&Fe>=qe[0].s.c&&Fe<=qe[0].e.c&&(Re.F=encode_range(qe[0]),ke=!0)}!ke&&Je.length>3&&(Re.f=Je[3])}if(ie.s.r>_e.r&&(ie.s.r=_e.r),ie.s.c>Fe&&(ie.s.c=Fe),ie.e.r<_e.r&&(ie.e.r=_e.r),ie.e.c<Fe&&(ie.e.c=Fe),H.cellDates&&Pe&&Re.t=="n"&&fmt_is_date(table_fmt[Pe.numFmtId])){var $e=SSF_parse_date_code(Re.v);$e&&(Re.t="d",Re.v=new Date($e.y,$e.m-1,$e.d,$e.H,$e.M,$e.S,$e.u))}Rt&&(Rt.type=="XLDAPR"&&(Re.D=!0),Rt=void 0);break;case 1:case 12:if(!H.sheetStubs||ce)break;Re={t:"z",v:void 0},Fe=Je[0].c==-1?Fe+1:Je[0].c,H.dense?(te[Ce]||(te[Ce]=[]),te[Ce][Fe]=Re):te[encode_col(Fe)+We]=Re,ie.s.r>_e.r&&(ie.s.r=_e.r),ie.s.c>Fe&&(ie.s.c=Fe),ie.e.r<_e.r&&(ie.e.r=_e.r),ie.e.c<Fe&&(ie.e.c=Fe),Rt&&(Rt.type=="XLDAPR"&&(Re.D=!0),Rt=void 0);break;case 176:Ue.push(Je);break;case 49:Rt=((H.xlmeta||{}).Cell||[])[Je-1];break;case 494:var Be=T["!id"][Je.relId];for(Be?(Je.Target=Be.Target,Je.loc&&(Je.Target+="#"+Je.loc),Je.Rel=Be):Je.relId==""&&(Je.Target="#"+Je.loc),Ce=Je.rfx.s.r;Ce<=Je.rfx.e.r;++Ce)for(Fe=Je.rfx.s.c;Fe<=Je.rfx.e.c;++Fe)H.dense?(te[Ce]||(te[Ce]=[]),te[Ce][Fe]||(te[Ce][Fe]={t:"z",v:void 0}),te[Ce][Fe].l=Je):(Me=encode_cell({c:Fe,r:Ce}),te[Me]||(te[Me]={t:"z",v:void 0}),te[Me].l=Je);break;case 426:if(!H.cellFormula)break;Ne.push(Je),ze=H.dense?te[Ce][Fe]:te[encode_col(Fe)+We],ze.f=stringify_formula(Je[1],ie,{r:_e.r,c:Fe},Ie,H),ze.F=encode_range(Je[0]);break;case 427:if(!H.cellFormula)break;Ge[encode_cell(Je[0].s)]=Je[1],ze=H.dense?te[Ce][Fe]:te[encode_col(Fe)+We],ze.f=stringify_formula(Je[1],ie,{r:_e.r,c:Fe},Ie,H);break;case 60:if(!H.cellStyles)break;for(;Je.e>=Je.s;)He[Je.e--]={width:Je.w/256,hidden:!!(Je.flags&1),level:Je.level},Ze||(Ze=!0,find_mdw_colw(Je.w/256)),process_col(He[Je.e+1]);break;case 161:te["!autofilter"]={ref:encode_range(Je)};break;case 476:te["!margins"]=Je;break;case 147:w.Sheets[v]||(w.Sheets[v]={}),Je.name&&(w.Sheets[v].CodeName=Je.name),(Je.above||Je.left)&&(te["!outline"]={above:Je.above,left:Je.left});break;case 137:w.Views||(w.Views=[{}]),w.Views[0]||(w.Views[0]={}),Je.RTL&&(w.Views[0].RTL=!0);break;case 485:break;case 64:case 1053:break;case 151:break;case 152:case 175:case 644:case 625:case 562:case 396:case 1112:case 1146:case 471:case 1050:case 649:case 1105:case 589:case 607:case 564:case 1055:case 168:case 174:case 1180:case 499:case 507:case 550:case 171:case 167:case 1177:case 169:case 1181:case 551:case 552:case 661:case 639:case 478:case 537:case 477:case 536:case 1103:case 680:case 1104:case 1024:case 663:case 535:case 678:case 504:case 1043:case 428:case 170:case 3072:case 50:case 2070:case 1045:break;case 35:ce=!0;break;case 36:ce=!1;break;case 37:ce=!0;break;case 38:ce=!1;break;default:if(!Wt.T){if(!ce||H.WTF)throw new Error("Unexpected record 0x"+Lt.toString(16))}}},H),delete H.supbooks,delete H["!row"],!te["!ref"]&&(ie.s.r<2e6||ae&&(ae.e.r>0||ae.e.c>0||ae.s.r>0||ae.s.c>0))&&(te["!ref"]=encode_range(ae||ie)),H.sheetRows&&te["!ref"]){var nt=safe_decode_range(te["!ref"]);H.sheetRows<=+nt.e.r&&(nt.e.r=H.sheetRows-1,nt.e.r>ie.e.r&&(nt.e.r=ie.e.r),nt.e.r<nt.s.r&&(nt.s.r=nt.e.r),nt.e.c>ie.e.c&&(nt.e.c=ie.e.c),nt.e.c<nt.s.c&&(nt.s.c=nt.e.c),te["!fullref"]=te["!ref"],te["!ref"]=encode_range(nt))}return Ue.length>0&&(te["!merges"]=Ue),He.length>0&&(te["!cols"]=He),Ct.length>0&&(te["!rows"]=Ct),te}function parse_Cache(E){var r=[],v=E.match(/^<c:numCache>/),T;(E.match(/<c:pt idx="(\d*)">(.*?)<\/c:pt>/mg)||[]).forEach(function(S){var I=S.match(/<c:pt idx="(\d*?)"><c:v>(.*)<\/c:v><\/c:pt>/);I&&(r[+I[1]]=v?+I[2]:I[2])});var w=unescapexml((E.match(/<c:formatCode>([\s\S]*?)<\/c:formatCode>/)||["","General"])[1]);return(E.match(/<c:f>(.*?)<\/c:f>/mg)||[]).forEach(function(S){T=S.replace(/<.*?>/g,"")}),[r,w,T]}function parse_chart(E,r,v,T,w,S){var I=S||{"!type":"chart"};if(!E)return S;var H=0,te=0,ae="A",ie={s:{r:2e6,c:2e6},e:{r:0,c:0}};return(E.match(/<c:numCache>[\s\S]*?<\/c:numCache>/gm)||[]).forEach(function(ce){var me=parse_Cache(ce);ie.s.r=ie.s.c=0,ie.e.c=H,ae=encode_col(H),me[0].forEach(function(_e,Re){I[ae+encode_row(Re)]={t:"n",v:_e,z:me[1]},te=Re}),ie.e.r<te&&(ie.e.r=te),++H}),H>0&&(I["!ref"]=encode_range(ie)),I}function parse_cs_xml(E,r,v,T,w){if(!E)return E;T||(T={"!id":{}});var S={"!type":"chart","!drawel":null,"!rel":""},I,H=E.match(sheetprregex);return H&&parse_ws_xml_sheetpr(H[0],S,w,v),(I=E.match(/drawing r:id="(.*?)"/))&&(S["!rel"]=I[1]),T["!id"][S["!rel"]]&&(S["!drawel"]=T["!id"][S["!rel"]]),S}function parse_BrtCsProp(E,r){E.l+=10;var v=parse_XLWideString(E);return{name:v}}function parse_cs_bin(E,r,v,T,w){if(!E)return E;T||(T={"!id":{}});var S={"!type":"chart","!drawel":null,"!rel":""},I=!1;return recordhopper(E,function(te,ae,ie){switch(ie){case 550:S["!rel"]=te;break;case 651:w.Sheets[v]||(w.Sheets[v]={}),te.name&&(w.Sheets[v].CodeName=te.name);break;case 562:case 652:case 669:case 679:case 551:case 552:case 476:case 3072:break;case 35:I=!0;break;case 36:I=!1;break;case 37:break;case 38:break;default:if(!(ae.T>0)){if(!(ae.T<0)){if(!I||r.WTF)throw new Error("Unexpected record 0x"+ie.toString(16))}}}},r),T["!id"][S["!rel"]]&&(S["!drawel"]=T["!id"][S["!rel"]]),S}var WBPropsDef=[["allowRefreshQuery",!1,"bool"],["autoCompressPictures",!0,"bool"],["backupFile",!1,"bool"],["checkCompatibility",!1,"bool"],["CodeName",""],["date1904",!1,"bool"],["defaultThemeVersion",0,"int"],["filterPrivacy",!1,"bool"],["hidePivotFieldList",!1,"bool"],["promptedSolutions",!1,"bool"],["publishItems",!1,"bool"],["refreshAllConnections",!1,"bool"],["saveExternalLinkValues",!0,"bool"],["showBorderUnselectedTables",!0,"bool"],["showInkAnnotation",!0,"bool"],["showObjects","all"],["showPivotChartFilter",!1,"bool"],["updateLinks","userSet"]],WBViewDef=[["activeTab",0,"int"],["autoFilterDateGrouping",!0,"bool"],["firstSheet",0,"int"],["minimized",!1,"bool"],["showHorizontalScroll",!0,"bool"],["showSheetTabs",!0,"bool"],["showVerticalScroll",!0,"bool"],["tabRatio",600,"int"],["visibility","visible"]],SheetDef=[],CalcPrDef=[["calcCompleted","true"],["calcMode","auto"],["calcOnSave","true"],["concurrentCalc","true"],["fullCalcOnLoad","false"],["fullPrecision","true"],["iterate","false"],["iterateCount","100"],["iterateDelta","0.001"],["refMode","A1"]];function push_defaults_array(E,r){for(var v=0;v!=E.length;++v)for(var T=E[v],w=0;w!=r.length;++w){var S=r[w];if(T[S[0]]==null)T[S[0]]=S[1];else switch(S[2]){case"bool":typeof T[S[0]]=="string"&&(T[S[0]]=parsexmlbool(T[S[0]]));break;case"int":typeof T[S[0]]=="string"&&(T[S[0]]=parseInt(T[S[0]],10));break}}}function push_defaults(E,r){for(var v=0;v!=r.length;++v){var T=r[v];if(E[T[0]]==null)E[T[0]]=T[1];else switch(T[2]){case"bool":typeof E[T[0]]=="string"&&(E[T[0]]=parsexmlbool(E[T[0]]));break;case"int":typeof E[T[0]]=="string"&&(E[T[0]]=parseInt(E[T[0]],10));break}}}function parse_wb_defaults(E){push_defaults(E.WBProps,WBPropsDef),push_defaults(E.CalcPr,CalcPrDef),push_defaults_array(E.WBView,WBViewDef),push_defaults_array(E.Sheets,SheetDef),_ssfopts.date1904=parsexmlbool(E.WBProps.date1904)}var badchars="][*?/\\".split("");function check_ws_name(E,r){if(E.length>31)throw new Error("Sheet names cannot exceed 31 chars");var v=!0;return badchars.forEach(function(T){if(E.indexOf(T)!=-1)throw new Error("Sheet name cannot contain : \\ / ? * [ ]")}),v}var wbnsregex=/<\w+:workbook/;function parse_wb_xml(E,r){if(!E)throw new Error("Could not find file");var v={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},Names:[],xmlns:""},T=!1,w="xmlns",S={},I=0;if(E.replace(tagregex,function(te,ae){var ie=parsexmltag(te);switch(strip_ns(ie[0])){case"<?xml":break;case"<workbook":te.match(wbnsregex)&&(w="xmlns"+te.match(/<(\w+):/)[1]),v.xmlns=ie[w];break;case"</workbook>":break;case"<fileVersion":delete ie[0],v.AppVersion=ie;break;case"<fileVersion/>":case"</fileVersion>":break;case"<fileSharing":break;case"<fileSharing/>":break;case"<workbookPr":case"<workbookPr/>":WBPropsDef.forEach(function(ce){if(ie[ce[0]]!=null)switch(ce[2]){case"bool":v.WBProps[ce[0]]=parsexmlbool(ie[ce[0]]);break;case"int":v.WBProps[ce[0]]=parseInt(ie[ce[0]],10);break;default:v.WBProps[ce[0]]=ie[ce[0]]}}),ie.codeName&&(v.WBProps.CodeName=utf8read(ie.codeName));break;case"</workbookPr>":break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews":case"<bookViews>":case"</bookViews>":break;case"<workbookView":case"<workbookView/>":delete ie[0],v.WBView.push(ie);break;case"</workbookView>":break;case"<sheets":case"<sheets>":case"</sheets>":break;case"<sheet":switch(ie.state){case"hidden":ie.Hidden=1;break;case"veryHidden":ie.Hidden=2;break;default:ie.Hidden=0}delete ie.state,ie.name=unescapexml(utf8read(ie.name)),delete ie[0],v.Sheets.push(ie);break;case"</sheet>":break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":T=!0;break;case"</definedNames>":T=!1;break;case"<definedName":S={},S.Name=utf8read(ie.name),ie.comment&&(S.Comment=ie.comment),ie.localSheetId&&(S.Sheet=+ie.localSheetId),parsexmlbool(ie.hidden||"0")&&(S.Hidden=!0),I=ae+te.length;break;case"</definedName>":S.Ref=unescapexml(utf8read(E.slice(I,ae))),v.Names.push(S);break;case"<definedName/>":break;case"<calcPr":delete ie[0],v.CalcPr=ie;break;case"<calcPr/>":delete ie[0],v.CalcPr=ie;break;case"</calcPr>":break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst":case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":T=!0;break;case"</ext>":T=!1;break;case"<ArchID":break;case"<AlternateContent":case"<AlternateContent>":T=!0;break;case"</AlternateContent>":T=!1;break;case"<revisionPtr":break;default:if(!T&&r.WTF)throw new Error("unrecognized "+ie[0]+" in workbook")}return te}),XMLNS_main.indexOf(v.xmlns)===-1)throw new Error("Unknown Namespace: "+v.xmlns);return parse_wb_defaults(v),v}function parse_BrtBundleSh(E,r){var v={};return v.Hidden=E.read_shift(4),v.iTabID=E.read_shift(4),v.strRelID=parse_RelID(E),v.name=parse_XLWideString(E),v}function parse_BrtWbProp(E,r){var v={},T=E.read_shift(4);v.defaultThemeVersion=E.read_shift(4);var w=r>8?parse_XLWideString(E):"";return w.length>0&&(v.CodeName=w),v.autoCompressPictures=!!(T&65536),v.backupFile=!!(T&64),v.checkCompatibility=!!(T&4096),v.date1904=!!(T&1),v.filterPrivacy=!!(T&8),v.hidePivotFieldList=!!(T&1024),v.promptedSolutions=!!(T&16),v.publishItems=!!(T&2048),v.refreshAllConnections=!!(T&262144),v.saveExternalLinkValues=!!(T&128),v.showBorderUnselectedTables=!!(T&4),v.showInkAnnotation=!!(T&32),v.showObjects=["all","placeholders","none"][T>>13&3],v.showPivotChartFilter=!!(T&32768),v.updateLinks=["userSet","never","always"][T>>8&3],v}function parse_BrtFRTArchID$(E,r){var v={};return E.read_shift(4),v.ArchID=E.read_shift(4),E.l+=r-8,v}function parse_BrtName(E,r,v){var T=E.l+r;E.l+=4,E.l+=1;var w=E.read_shift(4),S=parse_XLNameWideString(E),I=parse_XLSBNameParsedFormula(E,0,v),H=parse_XLNullableWideString(E);E.l=T;var te={Name:S,Ptg:I};return w<268435455&&(te.Sheet=w),H&&(te.Comment=H),te}function parse_wb_bin(E,r){var v={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""},T=[],w=!1;r||(r={}),r.biff=12;var S=[],I=[[]];return I.SheetNames=[],I.XTI=[],XLSBRecordEnum[16]={n:"BrtFRTArchID$",f:parse_BrtFRTArchID$},recordhopper(E,function(te,ae,ie){switch(ie){case 156:I.SheetNames.push(te.name),v.Sheets.push(te);break;case 153:v.WBProps=te;break;case 39:te.Sheet!=null&&(r.SID=te.Sheet),te.Ref=stringify_formula(te.Ptg,null,null,I,r),delete r.SID,delete te.Ptg,S.push(te);break;case 1036:break;case 357:case 358:case 355:case 667:I[0].length?I.push([ie,te]):I[0]=[ie,te],I[I.length-1].XTI=[];break;case 362:I.length===0&&(I[0]=[],I[0].XTI=[]),I[I.length-1].XTI=I[I.length-1].XTI.concat(te),I.XTI=I.XTI.concat(te);break;case 361:break;case 2071:case 158:case 143:case 664:case 353:break;case 3072:case 3073:case 534:case 677:case 157:case 610:case 2050:case 155:case 548:case 676:case 128:case 665:case 2128:case 2125:case 549:case 2053:case 596:case 2076:case 2075:case 2082:case 397:case 154:case 1117:case 553:case 2091:break;case 35:T.push(ie),w=!0;break;case 36:T.pop(),w=!1;break;case 37:T.push(ie),w=!0;break;case 38:T.pop(),w=!1;break;case 16:break;default:if(!ae.T){if(!w||r.WTF&&T[T.length-1]!=37&&T[T.length-1]!=35)throw new Error("Unexpected record 0x"+ie.toString(16))}}},r),parse_wb_defaults(v),v.Names=S,v.supbooks=I,v}function parse_wb(E,r,v){return r.slice(-4)===".bin"?parse_wb_bin(E,v):parse_wb_xml(E,v)}function parse_ws(E,r,v,T,w,S,I,H){return r.slice(-4)===".bin"?parse_ws_bin(E,T,v,w,S,I,H):parse_ws_xml(E,T,v,w,S,I,H)}function parse_cs(E,r,v,T,w,S,I,H){return r.slice(-4)===".bin"?parse_cs_bin(E,T,v,w,S):parse_cs_xml(E,T,v,w,S)}function parse_ms(E,r,v,T,w,S,I,H){return r.slice(-4)===".bin"?parse_ms_bin():parse_ms_xml()}function parse_ds(E,r,v,T,w,S,I,H){return r.slice(-4)===".bin"?parse_ds_bin():parse_ds_xml()}function parse_sty(E,r,v,T){return r.slice(-4)===".bin"?parse_sty_bin(E,v,T):parse_sty_xml(E,v,T)}function parse_theme(E,r,v){return parse_theme_xml(E,v)}function parse_sst(E,r,v){return r.slice(-4)===".bin"?parse_sst_bin(E,v):parse_sst_xml(E,v)}function parse_cmnt(E,r,v){return r.slice(-4)===".bin"?parse_comments_bin(E,v):parse_comments_xml(E,v)}function parse_cc(E,r,v){return r.slice(-4)===".bin"?parse_cc_bin(E):parse_cc_xml(E)}function parse_xlink(E,r,v,T){return v.slice(-4)===".bin"?parse_xlink_bin(E,r,v,T):void 0}function parse_xlmeta(E,r,v){return r.slice(-4)===".bin"?parse_xlmeta_bin(E,r,v):parse_xlmeta_xml(E,r,v)}var attregexg2=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g,attregex2=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;function xlml_parsexmltag(E,r){var v=E.split(/\s+/),T=[];if(T[0]=v[0],v.length===1)return T;var w=E.match(attregexg2),S,I,H,te;if(w)for(te=0;te!=w.length;++te)S=w[te].match(attregex2),(I=S[1].indexOf(":"))===-1?T[S[1]]=S[2].slice(1,S[2].length-1):(S[1].slice(0,6)==="xmlns:"?H="xmlns"+S[1].slice(6):H=S[1].slice(I+1),T[H]=S[2].slice(1,S[2].length-1));return T}function xlml_parsexmltagobj(E){var r=E.split(/\s+/),v={};if(r.length===1)return v;var T=E.match(attregexg2),w,S,I,H;if(T)for(H=0;H!=T.length;++H)w=T[H].match(attregex2),(S=w[1].indexOf(":"))===-1?v[w[1]]=w[2].slice(1,w[2].length-1):(w[1].slice(0,6)==="xmlns:"?I="xmlns"+w[1].slice(6):I=w[1].slice(S+1),v[I]=w[2].slice(1,w[2].length-1));return v}var XLMLFormatMap;function xlml_format(E,r){var v=XLMLFormatMap[E]||unescapexml(E);return v==="General"?SSF_general(r):SSF_format(v,r)}function xlml_set_custprop(E,r,v,T){var w=T;switch((v[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":w=parsexmlbool(T);break;case"i2":case"int":w=parseInt(T,10);break;case"r4":case"float":w=parseFloat(T);break;case"date":case"dateTime.tz":w=parseDate(T);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw new Error("bad custprop:"+v[0])}E[unescapexml(r)]=w}function safe_format_xlml(E,r,v){if(E.t!=="z"){if(!v||v.cellText!==!1)try{E.t==="e"?E.w=E.w||BErr[E.v]:r==="General"?E.t==="n"?(E.v|0)===E.v?E.w=E.v.toString(10):E.w=SSF_general_num(E.v):E.w=SSF_general(E.v):E.w=xlml_format(r||"General",E.v)}catch(S){if(v.WTF)throw S}try{var T=XLMLFormatMap[r]||r||"General";if(v.cellNF&&(E.z=T),v.cellDates&&E.t=="n"&&fmt_is_date(T)){var w=SSF_parse_date_code(E.v);w&&(E.t="d",E.v=new Date(w.y,w.m-1,w.d,w.H,w.M,w.S,w.u))}}catch(S){if(v.WTF)throw S}}}function process_style_xlml(E,r,v){if(v.cellStyles&&r.Interior){var T=r.Interior;T.Pattern&&(T.patternType=XLMLPatternTypeMap[T.Pattern]||T.Pattern)}E[r.ID]=r}function parse_xlml_data(E,r,v,T,w,S,I,H,te,ae){var ie="General",ce=T.StyleID,me={};ae=ae||{};var _e=[],Re=0;for(ce===void 0&&H&&(ce=H.StyleID),ce===void 0&&I&&(ce=I.StyleID);S[ce]!==void 0&&(S[ce].nf&&(ie=S[ce].nf),S[ce].Interior&&_e.push(S[ce].Interior),!!S[ce].Parent);)ce=S[ce].Parent;switch(v.Type){case"Boolean":T.t="b",T.v=parsexmlbool(E);break;case"String":T.t="s",T.r=xlml_fixstr(unescapexml(E)),T.v=E.indexOf("<")>-1?unescapexml(r||E).replace(/<.*?>/g,""):T.r;break;case"DateTime":E.slice(-1)!="Z"&&(E+="Z"),T.v=(parseDate(E)-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3),T.v!==T.v?T.v=unescapexml(E):T.v<60&&(T.v=T.v-1),(!ie||ie=="General")&&(ie="yyyy-mm-dd");case"Number":T.v===void 0&&(T.v=+E),T.t||(T.t="n");break;case"Error":T.t="e",T.v=RBErr[E],ae.cellText!==!1&&(T.w=E);break;default:E==""&&r==""?T.t="z":(T.t="s",T.v=xlml_fixstr(r||E));break}if(safe_format_xlml(T,ie,ae),ae.cellFormula!==!1)if(T.Formula){var Pe=unescapexml(T.Formula);Pe.charCodeAt(0)==61&&(Pe=Pe.slice(1)),T.f=rc_to_a1(Pe,w),delete T.Formula,T.ArrayRange=="RC"?T.F=rc_to_a1("RC:RC",w):T.ArrayRange&&(T.F=rc_to_a1(T.ArrayRange,w),te.push([safe_decode_range(T.F),T.F]))}else for(Re=0;Re<te.length;++Re)w.r>=te[Re][0].s.r&&w.r<=te[Re][0].e.r&&w.c>=te[Re][0].s.c&&w.c<=te[Re][0].e.c&&(T.F=te[Re][1]);ae.cellStyles&&(_e.forEach(function(Ce){!me.patternType&&Ce.patternType&&(me.patternType=Ce.patternType)}),T.s=me),T.StyleID!==void 0&&(T.ixfe=T.StyleID)}function xlml_clean_comment(E){E.t=E.v||"",E.t=E.t.replace(/\r\n/g,`
`).replace(/\r/g,`
`),E.v=E.w=E.ixfe=void 0}function parse_xlml_xml(E,r){var v=r||{};make_ssf();var T=debom(xlml_normalize(E));(v.type=="binary"||v.type=="array"||v.type=="base64")&&(T=utf8read(T));var w=T.slice(0,1024).toLowerCase(),S=!1;if(w=w.replace(/".*?"/g,""),(w.indexOf(">")&1023)>Math.min(w.indexOf(",")&1023,w.indexOf(";")&1023)){var I=dup(v);return I.type="string",PRN.to_workbook(T,I)}if(w.indexOf("<?xml")==-1&&["html","table","head","meta","script","style","div"].forEach(function(kt){w.indexOf("<"+kt)>=0&&(S=!0)}),S)return html_to_workbook(T,v);XLMLFormatMap={"General Number":"General","General Date":table_fmt[22],"Long Date":"dddd, mmmm dd, yyyy","Medium Date":table_fmt[15],"Short Date":table_fmt[14],"Long Time":table_fmt[19],"Medium Time":table_fmt[18],"Short Time":table_fmt[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:table_fmt[2],Standard:table_fmt[4],Percent:table_fmt[10],Scientific:table_fmt[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'};var H,te=[],ae,ie={},ce=[],me=v.dense?[]:{},_e="",Re={},Pe={},Ce=xlml_parsexmltag('<Data ss:Type="String">'),Fe=0,Me=0,Ve=0,We={s:{r:2e6,c:2e6},e:{r:0,c:0}},ze={},Ue={},je="",ke=0,Ne=[],Ge={},Ie={},Le=0,He=[],Ct=[],Ze={},Rt=[],nt,nr=!1,Je=[],Wt=[],Lt={},qe=0,$e=0,Be={Sheets:[],WBProps:{date1904:!1}},Xe={};xlmlregex.lastIndex=0,T=T.replace(/<!--([\s\S]*?)-->/mg,"");for(var rt="";H=xlmlregex.exec(T);)switch(H[3]=(rt=H[3]).toLowerCase()){case"data":if(rt=="data"){if(H[1]==="/"){if((ae=te.pop())[0]!==H[3])throw new Error("Bad state: "+ae.join("|"))}else H[0].charAt(H[0].length-2)!=="/"&&te.push([H[3],!0]);break}if(te[te.length-1][1])break;H[1]==="/"?parse_xlml_data(T.slice(Fe,H.index),je,Ce,te[te.length-1][0]=="comment"?Ze:Re,{c:Me,r:Ve},ze,Rt[Me],Pe,Je,v):(je="",Ce=xlml_parsexmltag(H[0]),Fe=H.index+H[0].length);break;case"cell":if(H[1]==="/")if(Ct.length>0&&(Re.c=Ct),(!v.sheetRows||v.sheetRows>Ve)&&Re.v!==void 0&&(v.dense?(me[Ve]||(me[Ve]=[]),me[Ve][Me]=Re):me[encode_col(Me)+encode_row(Ve)]=Re),Re.HRef&&(Re.l={Target:unescapexml(Re.HRef)},Re.HRefScreenTip&&(Re.l.Tooltip=Re.HRefScreenTip),delete Re.HRef,delete Re.HRefScreenTip),(Re.MergeAcross||Re.MergeDown)&&(qe=Me+(parseInt(Re.MergeAcross,10)|0),$e=Ve+(parseInt(Re.MergeDown,10)|0),Ne.push({s:{c:Me,r:Ve},e:{c:qe,r:$e}})),!v.sheetStubs)Re.MergeAcross?Me=qe+1:++Me;else if(Re.MergeAcross||Re.MergeDown){for(var Qe=Me;Qe<=qe;++Qe)for(var vt=Ve;vt<=$e;++vt)(Qe>Me||vt>Ve)&&(v.dense?(me[vt]||(me[vt]=[]),me[vt][Qe]={t:"z"}):me[encode_col(Qe)+encode_row(vt)]={t:"z"});Me=qe+1}else++Me;else Re=xlml_parsexmltagobj(H[0]),Re.Index&&(Me=+Re.Index-1),Me<We.s.c&&(We.s.c=Me),Me>We.e.c&&(We.e.c=Me),H[0].slice(-2)==="/>"&&++Me,Ct=[];break;case"row":H[1]==="/"||H[0].slice(-2)==="/>"?(Ve<We.s.r&&(We.s.r=Ve),Ve>We.e.r&&(We.e.r=Ve),H[0].slice(-2)==="/>"&&(Pe=xlml_parsexmltag(H[0]),Pe.Index&&(Ve=+Pe.Index-1)),Me=0,++Ve):(Pe=xlml_parsexmltag(H[0]),Pe.Index&&(Ve=+Pe.Index-1),Lt={},(Pe.AutoFitHeight=="0"||Pe.Height)&&(Lt.hpx=parseInt(Pe.Height,10),Lt.hpt=px2pt(Lt.hpx),Wt[Ve]=Lt),Pe.Hidden=="1"&&(Lt.hidden=!0,Wt[Ve]=Lt));break;case"worksheet":if(H[1]==="/"){if((ae=te.pop())[0]!==H[3])throw new Error("Bad state: "+ae.join("|"));ce.push(_e),We.s.r<=We.e.r&&We.s.c<=We.e.c&&(me["!ref"]=encode_range(We),v.sheetRows&&v.sheetRows<=We.e.r&&(me["!fullref"]=me["!ref"],We.e.r=v.sheetRows-1,me["!ref"]=encode_range(We))),Ne.length&&(me["!merges"]=Ne),Rt.length>0&&(me["!cols"]=Rt),Wt.length>0&&(me["!rows"]=Wt),ie[_e]=me}else We={s:{r:2e6,c:2e6},e:{r:0,c:0}},Ve=Me=0,te.push([H[3],!1]),ae=xlml_parsexmltag(H[0]),_e=unescapexml(ae.Name),me=v.dense?[]:{},Ne=[],Je=[],Wt=[],Xe={name:_e,Hidden:0},Be.Sheets.push(Xe);break;case"table":if(H[1]==="/"){if((ae=te.pop())[0]!==H[3])throw new Error("Bad state: "+ae.join("|"))}else{if(H[0].slice(-2)=="/>")break;te.push([H[3],!1]),Rt=[],nr=!1}break;case"style":H[1]==="/"?process_style_xlml(ze,Ue,v):Ue=xlml_parsexmltag(H[0]);break;case"numberformat":Ue.nf=unescapexml(xlml_parsexmltag(H[0]).Format||"General"),XLMLFormatMap[Ue.nf]&&(Ue.nf=XLMLFormatMap[Ue.nf]);for(var Dt=0;Dt!=392&&table_fmt[Dt]!=Ue.nf;++Dt);if(Dt==392){for(Dt=57;Dt!=392;++Dt)if(table_fmt[Dt]==null){SSF_load(Ue.nf,Dt);break}}break;case"column":if(te[te.length-1][0]!=="table")break;if(nt=xlml_parsexmltag(H[0]),nt.Hidden&&(nt.hidden=!0,delete nt.Hidden),nt.Width&&(nt.wpx=parseInt(nt.Width,10)),!nr&&nt.wpx>10){nr=!0,MDW=DEF_MDW;for(var Ut=0;Ut<Rt.length;++Ut)Rt[Ut]&&process_col(Rt[Ut])}nr&&process_col(nt),Rt[nt.Index-1||Rt.length]=nt;for(var hr=0;hr<+nt.Span;++hr)Rt[Rt.length]=dup(nt);break;case"namedrange":if(H[1]==="/")break;Be.Names||(Be.Names=[]);var pt=parsexmltag(H[0]),yr={Name:pt.Name,Ref:rc_to_a1(pt.RefersTo.slice(1),{r:0,c:0})};Be.Sheets.length>0&&(yr.Sheet=Be.Sheets.length-1),Be.Names.push(yr);break;case"namedcell":break;case"b":break;case"i":break;case"u":break;case"s":break;case"em":break;case"h2":break;case"h3":break;case"sub":break;case"sup":break;case"span":break;case"alignment":break;case"borders":break;case"border":break;case"font":if(H[0].slice(-2)==="/>")break;H[1]==="/"?je+=T.slice(ke,H.index):ke=H.index+H[0].length;break;case"interior":if(!v.cellStyles)break;Ue.Interior=xlml_parsexmltag(H[0]);break;case"protection":break;case"author":case"title":case"description":case"created":case"keywords":case"subject":case"category":case"company":case"lastauthor":case"lastsaved":case"lastprinted":case"version":case"revision":case"totaltime":case"hyperlinkbase":case"manager":case"contentstatus":case"identifier":case"language":case"appname":if(H[0].slice(-2)==="/>")break;H[1]==="/"?xlml_set_prop(Ge,rt,T.slice(Le,H.index)):Le=H.index+H[0].length;break;case"paragraphs":break;case"styles":case"workbook":if(H[1]==="/"){if((ae=te.pop())[0]!==H[3])throw new Error("Bad state: "+ae.join("|"))}else te.push([H[3],!1]);break;case"comment":if(H[1]==="/"){if((ae=te.pop())[0]!==H[3])throw new Error("Bad state: "+ae.join("|"));xlml_clean_comment(Ze),Ct.push(Ze)}else te.push([H[3],!1]),ae=xlml_parsexmltag(H[0]),Ze={a:ae.Author};break;case"autofilter":if(H[1]==="/"){if((ae=te.pop())[0]!==H[3])throw new Error("Bad state: "+ae.join("|"))}else if(H[0].charAt(H[0].length-2)!=="/"){var vr=xlml_parsexmltag(H[0]);me["!autofilter"]={ref:rc_to_a1(vr.Range).replace(/\$/g,"")},te.push([H[3],!0])}break;case"name":break;case"datavalidation":if(H[1]==="/"){if((ae=te.pop())[0]!==H[3])throw new Error("Bad state: "+ae.join("|"))}else H[0].charAt(H[0].length-2)!=="/"&&te.push([H[3],!0]);break;case"pixelsperinch":break;case"componentoptions":case"documentproperties":case"customdocumentproperties":case"officedocumentsettings":case"pivottable":case"pivotcache":case"names":case"mapinfo":case"pagebreaks":case"querytable":case"sorting":case"schema":case"conditionalformatting":case"smarttagtype":case"smarttags":case"excelworkbook":case"workbookoptions":case"worksheetoptions":if(H[1]==="/"){if((ae=te.pop())[0]!==H[3])throw new Error("Bad state: "+ae.join("|"))}else H[0].charAt(H[0].length-2)!=="/"&&te.push([H[3],!0]);break;case"null":break;default:if(te.length==0&&H[3]=="document"||te.length==0&&H[3]=="uof")return parse_fods(T,v);var wr=!0;switch(te[te.length-1][0]){case"officedocumentsettings":switch(H[3]){case"allowpng":break;case"removepersonalinformation":break;case"downloadcomponents":break;case"locationofcomponents":break;case"colors":break;case"color":break;case"index":break;case"rgb":break;case"targetscreensize":break;case"readonlyrecommended":break;default:wr=!1}break;case"componentoptions":switch(H[3]){case"toolbar":break;case"hideofficelogo":break;case"spreadsheetautofit":break;case"label":break;case"caption":break;case"maxheight":break;case"maxwidth":break;case"nextsheetnumber":break;default:wr=!1}break;case"excelworkbook":switch(H[3]){case"date1904":Be.WBProps.date1904=!0;break;case"windowheight":break;case"windowwidth":break;case"windowtopx":break;case"windowtopy":break;case"tabratio":break;case"protectstructure":break;case"protectwindow":break;case"protectwindows":break;case"activesheet":break;case"displayinknotes":break;case"firstvisiblesheet":break;case"supbook":break;case"sheetname":break;case"sheetindex":break;case"sheetindexfirst":break;case"sheetindexlast":break;case"dll":break;case"acceptlabelsinformulas":break;case"donotsavelinkvalues":break;case"iteration":break;case"maxiterations":break;case"maxchange":break;case"path":break;case"xct":break;case"count":break;case"selectedsheets":break;case"calculation":break;case"uncalced":break;case"startupprompt":break;case"crn":break;case"externname":break;case"formula":break;case"colfirst":break;case"collast":break;case"wantadvise":break;case"boolean":break;case"error":break;case"text":break;case"ole":break;case"noautorecover":break;case"publishobjects":break;case"donotcalculatebeforesave":break;case"number":break;case"refmoder1c1":break;case"embedsavesmarttags":break;default:wr=!1}break;case"workbookoptions":switch(H[3]){case"owcversion":break;case"height":break;case"width":break;default:wr=!1}break;case"worksheetoptions":switch(H[3]){case"visible":if(H[0].slice(-2)!=="/>")if(H[1]==="/")switch(T.slice(Le,H.index)){case"SheetHidden":Xe.Hidden=1;break;case"SheetVeryHidden":Xe.Hidden=2;break}else Le=H.index+H[0].length;break;case"header":me["!margins"]||default_margins(me["!margins"]={},"xlml"),isNaN(+parsexmltag(H[0]).Margin)||(me["!margins"].header=+parsexmltag(H[0]).Margin);break;case"footer":me["!margins"]||default_margins(me["!margins"]={},"xlml"),isNaN(+parsexmltag(H[0]).Margin)||(me["!margins"].footer=+parsexmltag(H[0]).Margin);break;case"pagemargins":var ir=parsexmltag(H[0]);me["!margins"]||default_margins(me["!margins"]={},"xlml"),isNaN(+ir.Top)||(me["!margins"].top=+ir.Top),isNaN(+ir.Left)||(me["!margins"].left=+ir.Left),isNaN(+ir.Right)||(me["!margins"].right=+ir.Right),isNaN(+ir.Bottom)||(me["!margins"].bottom=+ir.Bottom);break;case"displayrighttoleft":Be.Views||(Be.Views=[]),Be.Views[0]||(Be.Views[0]={}),Be.Views[0].RTL=!0;break;case"freezepanes":break;case"frozennosplit":break;case"splithorizontal":case"splitvertical":break;case"donotdisplaygridlines":break;case"activerow":break;case"activecol":break;case"toprowbottompane":break;case"leftcolumnrightpane":break;case"unsynced":break;case"print":break;case"printerrors":break;case"panes":break;case"scale":break;case"pane":break;case"number":break;case"layout":break;case"pagesetup":break;case"selected":break;case"protectobjects":break;case"enableselection":break;case"protectscenarios":break;case"validprinterinfo":break;case"horizontalresolution":break;case"verticalresolution":break;case"numberofcopies":break;case"activepane":break;case"toprowvisible":break;case"leftcolumnvisible":break;case"fittopage":break;case"rangeselection":break;case"papersizeindex":break;case"pagelayoutzoom":break;case"pagebreakzoom":break;case"filteron":break;case"fitwidth":break;case"fitheight":break;case"commentslayout":break;case"zoom":break;case"lefttoright":break;case"gridlines":break;case"allowsort":break;case"allowfilter":break;case"allowinsertrows":break;case"allowdeleterows":break;case"allowinsertcols":break;case"allowdeletecols":break;case"allowinserthyperlinks":break;case"allowformatcells":break;case"allowsizecols":break;case"allowsizerows":break;case"nosummaryrowsbelowdetail":me["!outline"]||(me["!outline"]={}),me["!outline"].above=!0;break;case"tabcolorindex":break;case"donotdisplayheadings":break;case"showpagelayoutzoom":break;case"nosummarycolumnsrightdetail":me["!outline"]||(me["!outline"]={}),me["!outline"].left=!0;break;case"blackandwhite":break;case"donotdisplayzeros":break;case"displaypagebreak":break;case"rowcolheadings":break;case"donotdisplayoutline":break;case"noorientation":break;case"allowusepivottables":break;case"zeroheight":break;case"viewablerange":break;case"selection":break;case"protectcontents":break;default:wr=!1}break;case"pivottable":case"pivotcache":switch(H[3]){case"immediateitemsondrop":break;case"showpagemultipleitemlabel":break;case"compactrowindent":break;case"location":break;case"pivotfield":break;case"orientation":break;case"layoutform":break;case"layoutsubtotallocation":break;case"layoutcompactrow":break;case"position":break;case"pivotitem":break;case"datatype":break;case"datafield":break;case"sourcename":break;case"parentfield":break;case"ptlineitems":break;case"ptlineitem":break;case"countofsameitems":break;case"item":break;case"itemtype":break;case"ptsource":break;case"cacheindex":break;case"consolidationreference":break;case"filename":break;case"reference":break;case"nocolumngrand":break;case"norowgrand":break;case"blanklineafteritems":break;case"hidden":break;case"subtotal":break;case"basefield":break;case"mapchilditems":break;case"function":break;case"refreshonfileopen":break;case"printsettitles":break;case"mergelabels":break;case"defaultversion":break;case"refreshname":break;case"refreshdate":break;case"refreshdatecopy":break;case"versionlastrefresh":break;case"versionlastupdate":break;case"versionupdateablemin":break;case"versionrefreshablemin":break;case"calculation":break;default:wr=!1}break;case"pagebreaks":switch(H[3]){case"colbreaks":break;case"colbreak":break;case"rowbreaks":break;case"rowbreak":break;case"colstart":break;case"colend":break;case"rowend":break;default:wr=!1}break;case"autofilter":switch(H[3]){case"autofiltercolumn":break;case"autofiltercondition":break;case"autofilterand":break;case"autofilteror":break;default:wr=!1}break;case"querytable":switch(H[3]){case"id":break;case"autoformatfont":break;case"autoformatpattern":break;case"querysource":break;case"querytype":break;case"enableredirections":break;case"refreshedinxl9":break;case"urlstring":break;case"htmltables":break;case"connection":break;case"commandtext":break;case"refreshinfo":break;case"notitles":break;case"nextid":break;case"columninfo":break;case"overwritecells":break;case"donotpromptforfile":break;case"textwizardsettings":break;case"source":break;case"number":break;case"decimal":break;case"thousandseparator":break;case"trailingminusnumbers":break;case"formatsettings":break;case"fieldtype":break;case"delimiters":break;case"tab":break;case"comma":break;case"autoformatname":break;case"versionlastedit":break;case"versionlastrefresh":break;default:wr=!1}break;case"datavalidation":switch(H[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;case"cellrangelist":break;default:wr=!1}break;case"sorting":case"conditionalformatting":switch(H[3]){case"range":break;case"type":break;case"min":break;case"max":break;case"sort":break;case"descending":break;case"order":break;case"casesensitive":break;case"value":break;case"errorstyle":break;case"errormessage":break;case"errortitle":break;case"cellrangelist":break;case"inputmessage":break;case"inputtitle":break;case"combohide":break;case"inputhide":break;case"condition":break;case"qualifier":break;case"useblank":break;case"value1":break;case"value2":break;case"format":break;default:wr=!1}break;case"mapinfo":case"schema":case"data":switch(H[3]){case"map":break;case"entry":break;case"range":break;case"xpath":break;case"field":break;case"xsdtype":break;case"filteron":break;case"aggregate":break;case"elementtype":break;case"attributetype":break;case"schema":case"element":case"complextype":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:wr=!1}break;case"smarttags":break;default:wr=!1;break}if(wr||H[3].match(/!\[CDATA/))break;if(!te[te.length-1][1])throw"Unrecognized tag: "+H[3]+"|"+te.join("|");if(te[te.length-1][0]==="customdocumentproperties"){if(H[0].slice(-2)==="/>")break;H[1]==="/"?xlml_set_custprop(Ie,rt,He,T.slice(Le,H.index)):(He=H,Le=H.index+H[0].length);break}if(v.WTF)throw"Unrecognized tag: "+H[3]+"|"+te.join("|")}var sr={};return!v.bookSheets&&!v.bookProps&&(sr.Sheets=ie),sr.SheetNames=ce,sr.Workbook=Be,sr.SSF=dup(table_fmt),sr.Props=Ge,sr.Custprops=Ie,sr}function parse_xlml(E,r){switch(fix_read_opts(r=r||{}),r.type||"base64"){case"base64":return parse_xlml_xml(Base64_decode(E),r);case"binary":case"buffer":case"file":return parse_xlml_xml(E,r);case"array":return parse_xlml_xml(a2s(E),r)}}function parse_compobj(E){var r={},v=E.content;if(v.l=28,r.AnsiUserType=v.read_shift(0,"lpstr-ansi"),r.AnsiClipboardFormat=parse_ClipboardFormatOrAnsiString(v),v.length-v.l<=4)return r;var T=v.read_shift(4);if(T==0||T>40||(v.l-=4,r.Reserved1=v.read_shift(0,"lpstr-ansi"),v.length-v.l<=4)||(T=v.read_shift(4),T!==1907505652)||(r.UnicodeClipboardFormat=parse_ClipboardFormatOrUnicodeString(v),T=v.read_shift(4),T==0||T>40))return r;v.l-=4,r.Reserved2=v.read_shift(0,"lpwstr")}var CONTINUE_RT=[60,1084,2066,2165,2175];function slurp(E,r,v,T,w){var S=T,I=[],H=v.slice(v.l,v.l+S);if(w&&w.enc&&w.enc.insitu&&H.length>0)switch(E){case 9:case 521:case 1033:case 2057:case 47:case 405:case 225:case 406:case 312:case 404:case 10:break;case 133:break;default:w.enc.insitu(H)}I.push(H),v.l+=S;for(var te=__readUInt16LE(v,v.l),ae=XLSRecordEnum[te],ie=0;ae!=null&&CONTINUE_RT.indexOf(te)>-1;)S=__readUInt16LE(v,v.l+2),ie=v.l+4,te==2066?ie+=4:(te==2165||te==2175)&&(ie+=12),H=v.slice(ie,v.l+4+S),I.push(H),v.l+=4+S,ae=XLSRecordEnum[te=__readUInt16LE(v,v.l)];var ce=bconcat(I);prep_blob(ce,0);var me=0;ce.lens=[];for(var _e=0;_e<I.length;++_e)ce.lens.push(me),me+=I[_e].length;if(ce.length<T)throw"XLS Record 0x"+E.toString(16)+" Truncated: "+ce.length+" < "+T;return r.f(ce,ce.length,w)}function safe_format_xf(E,r,v){if(E.t!=="z"&&E.XF){var T=0;try{T=E.z||E.XF.numFmtId||0,r.cellNF&&(E.z=table_fmt[T])}catch(S){if(r.WTF)throw S}if(!r||r.cellText!==!1)try{E.t==="e"?E.w=E.w||BErr[E.v]:T===0||T=="General"?E.t==="n"?(E.v|0)===E.v?E.w=E.v.toString(10):E.w=SSF_general_num(E.v):E.w=SSF_general(E.v):E.w=SSF_format(T,E.v,{date1904:!!v,dateNF:r&&r.dateNF})}catch(S){if(r.WTF)throw S}if(r.cellDates&&T&&E.t=="n"&&fmt_is_date(table_fmt[T]||String(T))){var w=SSF_parse_date_code(E.v);w&&(E.t="d",E.v=new Date(w.y,w.m-1,w.d,w.H,w.M,w.S,w.u))}}}function make_cell(E,r,v){return{v:E,ixfe:r,t:v}}function parse_workbook(E,r){var v={opts:{}},T={},w=r.dense?[]:{},S={},I={},H=null,te=[],ae="",ie={},ce,me="",_e,Re,Pe,Ce,Fe={},Me=[],Ve,We,ze=[],Ue=[],je={Sheets:[],WBProps:{date1904:!1},Views:[{}]},ke={},Ne=function(or){return or<8?XLSIcv[or]:or<64&&Ue[or-8]||XLSIcv[or]},Ge=function(or,ur,gr){var $r=ur.XF.data;if(!(!$r||!$r.patternType||!gr||!gr.cellStyles)){ur.s={},ur.s.patternType=$r.patternType;var Xr;(Xr=rgb2Hex(Ne($r.icvFore)))&&(ur.s.fgColor={rgb:Xr}),(Xr=rgb2Hex(Ne($r.icvBack)))&&(ur.s.bgColor={rgb:Xr})}},Ie=function(or,ur,gr){if(!(Lt>1)&&!(gr.sheetRows&&or.r>=gr.sheetRows)){if(gr.cellStyles&&ur.XF&&ur.XF.data&&Ge(or,ur,gr),delete ur.ixfe,delete ur.XF,ce=or,me=encode_cell(or),(!I||!I.s||!I.e)&&(I={s:{r:0,c:0},e:{r:0,c:0}}),or.r<I.s.r&&(I.s.r=or.r),or.c<I.s.c&&(I.s.c=or.c),or.r+1>I.e.r&&(I.e.r=or.r+1),or.c+1>I.e.c&&(I.e.c=or.c+1),gr.cellFormula&&ur.f){for(var $r=0;$r<Me.length;++$r)if(!(Me[$r][0].s.c>or.c||Me[$r][0].s.r>or.r)&&!(Me[$r][0].e.c<or.c||Me[$r][0].e.r<or.r)){ur.F=encode_range(Me[$r][0]),(Me[$r][0].s.c!=or.c||Me[$r][0].s.r!=or.r)&&delete ur.f,ur.f&&(ur.f=""+stringify_formula(Me[$r][1],I,or,Je,Le));break}}gr.dense?(w[or.r]||(w[or.r]=[]),w[or.r][or.c]=ur):w[me]=ur}},Le={enc:!1,sbcch:0,snames:[],sharedf:Fe,arrayf:Me,rrtabid:[],lastuser:"",biff:8,codepage:0,winlocked:0,cellStyles:!!r&&!!r.cellStyles,WTF:!!r&&!!r.wtf};r.password&&(Le.password=r.password);var He,Ct=[],Ze=[],Rt=[],nt=[],nr=!1,Je=[];Je.SheetNames=Le.snames,Je.sharedf=Le.sharedf,Je.arrayf=Le.arrayf,Je.names=[],Je.XTI=[];var Wt=0,Lt=0,qe=0,$e=[],Be=[],Xe;Le.codepage=1200,set_cp(1200);for(var rt=!1;E.l<E.length-1;){var Qe=E.l,vt=E.read_shift(2);if(vt===0&&Wt===10)break;var Dt=E.l===E.length?0:E.read_shift(2),Ut=XLSRecordEnum[vt];if(Ut&&Ut.f){if(r.bookSheets&&Wt===133&&vt!==133)break;if(Wt=vt,Ut.r===2||Ut.r==12){var hr=E.read_shift(2);if(Dt-=2,!Le.enc&&hr!==vt&&((hr&255)<<8|hr>>8)!==vt)throw new Error("rt mismatch: "+hr+"!="+vt);Ut.r==12&&(E.l+=10,Dt-=10)}var pt={};if(vt===10?pt=Ut.f(E,Dt,Le):pt=slurp(vt,Ut,E,Dt,Le),Lt==0&&[9,521,1033,2057].indexOf(Wt)===-1)continue;switch(vt){case 34:v.opts.Date1904=je.WBProps.date1904=pt;break;case 134:v.opts.WriteProtect=!0;break;case 47:if(Le.enc||(E.l=0),Le.enc=pt,!r.password)throw new Error("File is password-protected");if(pt.valid==null)throw new Error("Encryption scheme unsupported");if(!pt.valid)throw new Error("Password is incorrect");break;case 92:Le.lastuser=pt;break;case 66:var yr=Number(pt);switch(yr){case 21010:yr=1200;break;case 32768:yr=1e4;break;case 32769:yr=1252;break}set_cp(Le.codepage=yr),rt=!0;break;case 317:Le.rrtabid=pt;break;case 25:Le.winlocked=pt;break;case 439:v.opts.RefreshAll=pt;break;case 12:v.opts.CalcCount=pt;break;case 16:v.opts.CalcDelta=pt;break;case 17:v.opts.CalcIter=pt;break;case 13:v.opts.CalcMode=pt;break;case 14:v.opts.CalcPrecision=pt;break;case 95:v.opts.CalcSaveRecalc=pt;break;case 15:Le.CalcRefMode=pt;break;case 2211:v.opts.FullCalc=pt;break;case 129:pt.fDialog&&(w["!type"]="dialog"),pt.fBelow||((w["!outline"]||(w["!outline"]={})).above=!0),pt.fRight||((w["!outline"]||(w["!outline"]={})).left=!0);break;case 224:ze.push(pt);break;case 430:Je.push([pt]),Je[Je.length-1].XTI=[];break;case 35:case 547:Je[Je.length-1].push(pt);break;case 24:case 536:Xe={Name:pt.Name,Ref:stringify_formula(pt.rgce,I,null,Je,Le)},pt.itab>0&&(Xe.Sheet=pt.itab-1),Je.names.push(Xe),Je[0]||(Je[0]=[],Je[0].XTI=[]),Je[Je.length-1].push(pt),pt.Name=="_xlnm._FilterDatabase"&&pt.itab>0&&pt.rgce&&pt.rgce[0]&&pt.rgce[0][0]&&pt.rgce[0][0][0]=="PtgArea3d"&&(Be[pt.itab-1]={ref:encode_range(pt.rgce[0][0][1][2])});break;case 22:Le.ExternCount=pt;break;case 23:Je.length==0&&(Je[0]=[],Je[0].XTI=[]),Je[Je.length-1].XTI=Je[Je.length-1].XTI.concat(pt),Je.XTI=Je.XTI.concat(pt);break;case 2196:if(Le.biff<8)break;Xe!=null&&(Xe.Comment=pt[1]);break;case 18:w["!protect"]=pt;break;case 19:pt!==0&&Le.WTF&&console.error("Password verifier: "+pt);break;case 133:S[pt.pos]=pt,Le.snames.push(pt.name);break;case 10:{if(--Lt)break;if(I.e){if(I.e.r>0&&I.e.c>0){if(I.e.r--,I.e.c--,w["!ref"]=encode_range(I),r.sheetRows&&r.sheetRows<=I.e.r){var vr=I.e.r;I.e.r=r.sheetRows-1,w["!fullref"]=w["!ref"],w["!ref"]=encode_range(I),I.e.r=vr}I.e.r++,I.e.c++}Ct.length>0&&(w["!merges"]=Ct),Ze.length>0&&(w["!objects"]=Ze),Rt.length>0&&(w["!cols"]=Rt),nt.length>0&&(w["!rows"]=nt),je.Sheets.push(ke)}ae===""?ie=w:T[ae]=w,w=r.dense?[]:{}}break;case 9:case 521:case 1033:case 2057:{if(Le.biff===8&&(Le.biff={9:2,521:3,1033:4}[vt]||{512:2,768:3,1024:4,1280:5,1536:8,2:2,7:2}[pt.BIFFVer]||8),Le.biffguess=pt.BIFFVer==0,pt.BIFFVer==0&&pt.dt==4096&&(Le.biff=5,rt=!0,set_cp(Le.codepage=28591)),Le.biff==8&&pt.BIFFVer==0&&pt.dt==16&&(Le.biff=2),Lt++)break;if(w=r.dense?[]:{},Le.biff<8&&!rt&&(rt=!0,set_cp(Le.codepage=r.codepage||1252)),Le.biff<5||pt.BIFFVer==0&&pt.dt==4096){ae===""&&(ae="Sheet1"),I={s:{r:0,c:0},e:{r:0,c:0}};var wr={pos:E.l-Dt,name:ae};S[wr.pos]=wr,Le.snames.push(ae)}else ae=(S[Qe]||{name:""}).name;pt.dt==32&&(w["!type"]="chart"),pt.dt==64&&(w["!type"]="macro"),Ct=[],Ze=[],Le.arrayf=Me=[],Rt=[],nt=[],nr=!1,ke={Hidden:(S[Qe]||{hs:0}).hs,name:ae}}break;case 515:case 3:case 2:w["!type"]=="chart"&&(r.dense?(w[pt.r]||[])[pt.c]:w[encode_cell({c:pt.c,r:pt.r})])&&++pt.c,Ve={ixfe:pt.ixfe,XF:ze[pt.ixfe]||{},v:pt.val,t:"n"},qe>0&&(Ve.z=$e[Ve.ixfe>>8&63]),safe_format_xf(Ve,r,v.opts.Date1904),Ie({c:pt.c,r:pt.r},Ve,r);break;case 5:case 517:Ve={ixfe:pt.ixfe,XF:ze[pt.ixfe],v:pt.val,t:pt.t},qe>0&&(Ve.z=$e[Ve.ixfe>>8&63]),safe_format_xf(Ve,r,v.opts.Date1904),Ie({c:pt.c,r:pt.r},Ve,r);break;case 638:Ve={ixfe:pt.ixfe,XF:ze[pt.ixfe],v:pt.rknum,t:"n"},qe>0&&(Ve.z=$e[Ve.ixfe>>8&63]),safe_format_xf(Ve,r,v.opts.Date1904),Ie({c:pt.c,r:pt.r},Ve,r);break;case 189:for(var ir=pt.c;ir<=pt.C;++ir){var sr=pt.rkrec[ir-pt.c][0];Ve={ixfe:sr,XF:ze[sr],v:pt.rkrec[ir-pt.c][1],t:"n"},qe>0&&(Ve.z=$e[Ve.ixfe>>8&63]),safe_format_xf(Ve,r,v.opts.Date1904),Ie({c:ir,r:pt.r},Ve,r)}break;case 6:case 518:case 1030:{if(pt.val=="String"){H=pt;break}if(Ve=make_cell(pt.val,pt.cell.ixfe,pt.tt),Ve.XF=ze[Ve.ixfe],r.cellFormula){var kt=pt.formula;if(kt&&kt[0]&&kt[0][0]&&kt[0][0][0]=="PtgExp"){var rr=kt[0][0][1][0],lr=kt[0][0][1][1],mr=encode_cell({r:rr,c:lr});Fe[mr]?Ve.f=""+stringify_formula(pt.formula,I,pt.cell,Je,Le):Ve.F=((r.dense?(w[rr]||[])[lr]:w[mr])||{}).F}else Ve.f=""+stringify_formula(pt.formula,I,pt.cell,Je,Le)}qe>0&&(Ve.z=$e[Ve.ixfe>>8&63]),safe_format_xf(Ve,r,v.opts.Date1904),Ie(pt.cell,Ve,r),H=pt}break;case 7:case 519:if(H)H.val=pt,Ve=make_cell(pt,H.cell.ixfe,"s"),Ve.XF=ze[Ve.ixfe],r.cellFormula&&(Ve.f=""+stringify_formula(H.formula,I,H.cell,Je,Le)),qe>0&&(Ve.z=$e[Ve.ixfe>>8&63]),safe_format_xf(Ve,r,v.opts.Date1904),Ie(H.cell,Ve,r),H=null;else throw new Error("String record expects Formula");break;case 33:case 545:{Me.push(pt);var Ir=encode_cell(pt[0].s);if(_e=r.dense?(w[pt[0].s.r]||[])[pt[0].s.c]:w[Ir],r.cellFormula&&_e){if(!H||!Ir||!_e)break;_e.f=""+stringify_formula(pt[1],I,pt[0],Je,Le),_e.F=encode_range(pt[0])}}break;case 1212:{if(!r.cellFormula)break;if(me){if(!H)break;Fe[encode_cell(H.cell)]=pt[0],_e=r.dense?(w[H.cell.r]||[])[H.cell.c]:w[encode_cell(H.cell)],(_e||{}).f=""+stringify_formula(pt[0],I,ce,Je,Le)}}break;case 253:Ve=make_cell(te[pt.isst].t,pt.ixfe,"s"),te[pt.isst].h&&(Ve.h=te[pt.isst].h),Ve.XF=ze[Ve.ixfe],qe>0&&(Ve.z=$e[Ve.ixfe>>8&63]),safe_format_xf(Ve,r,v.opts.Date1904),Ie({c:pt.c,r:pt.r},Ve,r);break;case 513:r.sheetStubs&&(Ve={ixfe:pt.ixfe,XF:ze[pt.ixfe],t:"z"},qe>0&&(Ve.z=$e[Ve.ixfe>>8&63]),safe_format_xf(Ve,r,v.opts.Date1904),Ie({c:pt.c,r:pt.r},Ve,r));break;case 190:if(r.sheetStubs)for(var Or=pt.c;Or<=pt.C;++Or){var Fr=pt.ixfe[Or-pt.c];Ve={ixfe:Fr,XF:ze[Fr],t:"z"},qe>0&&(Ve.z=$e[Ve.ixfe>>8&63]),safe_format_xf(Ve,r,v.opts.Date1904),Ie({c:Or,r:pt.r},Ve,r)}break;case 214:case 516:case 4:Ve=make_cell(pt.val,pt.ixfe,"s"),Ve.XF=ze[Ve.ixfe],qe>0&&(Ve.z=$e[Ve.ixfe>>8&63]),safe_format_xf(Ve,r,v.opts.Date1904),Ie({c:pt.c,r:pt.r},Ve,r);break;case 0:case 512:Lt===1&&(I=pt);break;case 252:te=pt;break;case 1054:if(Le.biff==4){$e[qe++]=pt[1];for(var Et=0;Et<qe+163&&table_fmt[Et]!=pt[1];++Et);Et>=163&&SSF_load(pt[1],qe+163)}else SSF_load(pt[1],pt[0]);break;case 30:{$e[qe++]=pt;for(var dr=0;dr<qe+163&&table_fmt[dr]!=pt;++dr);dr>=163&&SSF_load(pt,qe+163)}break;case 229:Ct=Ct.concat(pt);break;case 93:Ze[pt.cmo[0]]=Le.lastobj=pt;break;case 438:Le.lastobj.TxO=pt;break;case 127:Le.lastobj.ImData=pt;break;case 440:for(Ce=pt[0].s.r;Ce<=pt[0].e.r;++Ce)for(Pe=pt[0].s.c;Pe<=pt[0].e.c;++Pe)_e=r.dense?(w[Ce]||[])[Pe]:w[encode_cell({c:Pe,r:Ce})],_e&&(_e.l=pt[1]);break;case 2048:for(Ce=pt[0].s.r;Ce<=pt[0].e.r;++Ce)for(Pe=pt[0].s.c;Pe<=pt[0].e.c;++Pe)_e=r.dense?(w[Ce]||[])[Pe]:w[encode_cell({c:Pe,r:Ce})],_e&&_e.l&&(_e.l.Tooltip=pt[1]);break;case 28:{if(Le.biff<=5&&Le.biff>=2)break;_e=r.dense?(w[pt[0].r]||[])[pt[0].c]:w[encode_cell(pt[0])];var br=Ze[pt[2]];_e||(r.dense?(w[pt[0].r]||(w[pt[0].r]=[]),_e=w[pt[0].r][pt[0].c]={t:"z"}):_e=w[encode_cell(pt[0])]={t:"z"},I.e.r=Math.max(I.e.r,pt[0].r),I.s.r=Math.min(I.s.r,pt[0].r),I.e.c=Math.max(I.e.c,pt[0].c),I.s.c=Math.min(I.s.c,pt[0].c)),_e.c||(_e.c=[]),Re={a:pt[1],t:br.TxO.t},_e.c.push(Re)}break;case 2173:update_xfext(ze[pt.ixfe],pt.ext);break;case 125:{if(!Le.cellStyles)break;for(;pt.e>=pt.s;)Rt[pt.e--]={width:pt.w/256,level:pt.level||0,hidden:!!(pt.flags&1)},nr||(nr=!0,find_mdw_colw(pt.w/256)),process_col(Rt[pt.e+1])}break;case 520:{var Br={};pt.level!=null&&(nt[pt.r]=Br,Br.level=pt.level),pt.hidden&&(nt[pt.r]=Br,Br.hidden=!0),pt.hpt&&(nt[pt.r]=Br,Br.hpt=pt.hpt,Br.hpx=pt2px(pt.hpt))}break;case 38:case 39:case 40:case 41:w["!margins"]||default_margins(w["!margins"]={}),w["!margins"][{38:"left",39:"right",40:"top",41:"bottom"}[vt]]=pt;break;case 161:w["!margins"]||default_margins(w["!margins"]={}),w["!margins"].header=pt.header,w["!margins"].footer=pt.footer;break;case 574:pt.RTL&&(je.Views[0].RTL=!0);break;case 146:Ue=pt;break;case 2198:He=pt;break;case 140:We=pt;break;case 442:ae?ke.CodeName=pt||ke.name:je.WBProps.CodeName=pt||"ThisWorkbook";break}}else Ut||console.error("Missing Info for XLS Record 0x"+vt.toString(16)),E.l+=Dt}return v.SheetNames=keys(S).sort(function(Lr,or){return Number(Lr)-Number(or)}).map(function(Lr){return S[Lr].name}),r.bookSheets||(v.Sheets=T),!v.SheetNames.length&&ie["!ref"]?(v.SheetNames.push("Sheet1"),v.Sheets&&(v.Sheets.Sheet1=ie)):v.Preamble=ie,v.Sheets&&Be.forEach(function(Lr,or){v.Sheets[v.SheetNames[or]]["!autofilter"]=Lr}),v.Strings=te,v.SSF=dup(table_fmt),Le.enc&&(v.Encryption=Le.enc),He&&(v.Themes=He),v.Metadata={},We!==void 0&&(v.Metadata.Country=We),Je.names.length>0&&(je.Names=Je.names),v.Workbook=je,v}var PSCLSID={SI:"e0859ff2f94f6810ab9108002b27b3d9",DSI:"02d5cdd59c2e1b10939708002b2cf9ae",UDI:"05d5cdd59c2e1b10939708002b2cf9ae"};function parse_xls_props(E,r,v){var T=CFB.find(E,"/!DocumentSummaryInformation");if(T&&T.size>0)try{var w=parse_PropertySetStream(T,DocSummaryPIDDSI,PSCLSID.DSI);for(var S in w)r[S]=w[S]}catch(ae){if(v.WTF)throw ae}var I=CFB.find(E,"/!SummaryInformation");if(I&&I.size>0)try{var H=parse_PropertySetStream(I,SummaryPIDSI,PSCLSID.SI);for(var te in H)r[te]==null&&(r[te]=H[te])}catch(ae){if(v.WTF)throw ae}r.HeadingPairs&&r.TitlesOfParts&&(load_props_pairs(r.HeadingPairs,r.TitlesOfParts,r,v),delete r.HeadingPairs,delete r.TitlesOfParts)}function parse_xlscfb(E,r){r||(r={}),fix_read_opts(r),reset_cp(),r.codepage&&set_ansi(r.codepage);var v,T;if(E.FullPaths){if(CFB.find(E,"/encryption"))throw new Error("File is password-protected");v=CFB.find(E,"!CompObj"),T=CFB.find(E,"/Workbook")||CFB.find(E,"/Book")}else{switch(r.type){case"base64":E=s2a(Base64_decode(E));break;case"binary":E=s2a(E);break;case"buffer":break;case"array":Array.isArray(E)||(E=Array.prototype.slice.call(E));break}prep_blob(E,0),T={content:E}}var w,S;if(v&&parse_compobj(v),r.bookProps&&!r.bookSheets)w={};else{var I=has_buf?"buffer":"array";if(T&&T.content)w=parse_workbook(T.content,r);else if((S=CFB.find(E,"PerfectOffice_MAIN"))&&S.content)w=WK_.to_workbook(S.content,(r.type=I,r));else if((S=CFB.find(E,"NativeContent_MAIN"))&&S.content)w=WK_.to_workbook(S.content,(r.type=I,r));else throw(S=CFB.find(E,"MN0"))&&S.content?new Error("Unsupported Works 4 for Mac file"):new Error("Cannot find Workbook stream");r.bookVBA&&E.FullPaths&&CFB.find(E,"/_VBA_PROJECT_CUR/VBA/dir")&&(w.vbaraw=make_vba_xls(E))}var H={};return E.FullPaths&&parse_xls_props(E,H,r),w.Props=w.Custprops=H,r.bookFiles&&(w.cfb=E),w}var XLSBRecordEnum={0:{f:parse_BrtRowHdr},1:{f:parse_BrtCellBlank},2:{f:parse_BrtCellRk},3:{f:parse_BrtCellError},4:{f:parse_BrtCellBool},5:{f:parse_BrtCellReal},6:{f:parse_BrtCellSt},7:{f:parse_BrtCellIsst},8:{f:parse_BrtFmlaString},9:{f:parse_BrtFmlaNum},10:{f:parse_BrtFmlaBool},11:{f:parse_BrtFmlaError},12:{f:parse_BrtShortBlank},13:{f:parse_BrtShortRk},14:{f:parse_BrtShortError},15:{f:parse_BrtShortBool},16:{f:parse_BrtShortReal},17:{f:parse_BrtShortSt},18:{f:parse_BrtShortIsst},19:{f:parse_RichStr},20:{},21:{},22:{},23:{},24:{},25:{},26:{},27:{},28:{},29:{},30:{},31:{},32:{},33:{},34:{},35:{T:1},36:{T:-1},37:{T:1},38:{T:-1},39:{f:parse_BrtName},40:{},42:{},43:{f:parse_BrtFont},44:{f:parse_BrtFmt},45:{f:parse_BrtFill},46:{f:parse_BrtBorder},47:{f:parse_BrtXF},48:{},49:{f:parse_Int32LE},50:{},51:{f:parse_BrtMdb},52:{T:1},53:{T:-1},54:{T:1},55:{T:-1},56:{T:1},57:{T:-1},58:{},59:{},60:{f:parse_ColInfo},62:{f:parse_BrtCellRString},63:{f:parse_BrtCalcChainItem$},64:{f:parse_BrtDVal},65:{},66:{},67:{},68:{},69:{},70:{},128:{},129:{T:1},130:{T:-1},131:{T:1,f:parsenoop,p:0},132:{T:-1},133:{T:1},134:{T:-1},135:{T:1},136:{T:-1},137:{T:1,f:parse_BrtBeginWsView},138:{T:-1},139:{T:1},140:{T:-1},141:{T:1},142:{T:-1},143:{T:1},144:{T:-1},145:{T:1},146:{T:-1},147:{f:parse_BrtWsProp},148:{f:parse_BrtWsDim,p:16},151:{f:parse_BrtPane},152:{},153:{f:parse_BrtWbProp},154:{},155:{},156:{f:parse_BrtBundleSh},157:{},158:{},159:{T:1,f:parse_BrtBeginSst},160:{T:-1},161:{T:1,f:parse_UncheckedRfX},162:{T:-1},163:{T:1},164:{T:-1},165:{T:1},166:{T:-1},167:{},168:{},169:{},170:{},171:{},172:{T:1},173:{T:-1},174:{},175:{},176:{f:parse_BrtMergeCell},177:{T:1},178:{T:-1},179:{T:1},180:{T:-1},181:{T:1},182:{T:-1},183:{T:1},184:{T:-1},185:{T:1},186:{T:-1},187:{T:1},188:{T:-1},189:{T:1},190:{T:-1},191:{T:1},192:{T:-1},193:{T:1},194:{T:-1},195:{T:1},196:{T:-1},197:{T:1},198:{T:-1},199:{T:1},200:{T:-1},201:{T:1},202:{T:-1},203:{T:1},204:{T:-1},205:{T:1},206:{T:-1},207:{T:1},208:{T:-1},209:{T:1},210:{T:-1},211:{T:1},212:{T:-1},213:{T:1},214:{T:-1},215:{T:1},216:{T:-1},217:{T:1},218:{T:-1},219:{T:1},220:{T:-1},221:{T:1},222:{T:-1},223:{T:1},224:{T:-1},225:{T:1},226:{T:-1},227:{T:1},228:{T:-1},229:{T:1},230:{T:-1},231:{T:1},232:{T:-1},233:{T:1},234:{T:-1},235:{T:1},236:{T:-1},237:{T:1},238:{T:-1},239:{T:1},240:{T:-1},241:{T:1},242:{T:-1},243:{T:1},244:{T:-1},245:{T:1},246:{T:-1},247:{T:1},248:{T:-1},249:{T:1},250:{T:-1},251:{T:1},252:{T:-1},253:{T:1},254:{T:-1},255:{T:1},256:{T:-1},257:{T:1},258:{T:-1},259:{T:1},260:{T:-1},261:{T:1},262:{T:-1},263:{T:1},264:{T:-1},265:{T:1},266:{T:-1},267:{T:1},268:{T:-1},269:{T:1},270:{T:-1},271:{T:1},272:{T:-1},273:{T:1},274:{T:-1},275:{T:1},276:{T:-1},277:{},278:{T:1},279:{T:-1},280:{T:1},281:{T:-1},282:{T:1},283:{T:1},284:{T:-1},285:{T:1},286:{T:-1},287:{T:1},288:{T:-1},289:{T:1},290:{T:-1},291:{T:1},292:{T:-1},293:{T:1},294:{T:-1},295:{T:1},296:{T:-1},297:{T:1},298:{T:-1},299:{T:1},300:{T:-1},301:{T:1},302:{T:-1},303:{T:1},304:{T:-1},305:{T:1},306:{T:-1},307:{T:1},308:{T:-1},309:{T:1},310:{T:-1},311:{T:1},312:{T:-1},313:{T:-1},314:{T:1},315:{T:-1},316:{T:1},317:{T:-1},318:{T:1},319:{T:-1},320:{T:1},321:{T:-1},322:{T:1},323:{T:-1},324:{T:1},325:{T:-1},326:{T:1},327:{T:-1},328:{T:1},329:{T:-1},330:{T:1},331:{T:-1},332:{T:1},333:{T:-1},334:{T:1},335:{f:parse_BrtMdtinfo},336:{T:-1},337:{f:parse_BrtBeginEsmdb,T:1},338:{T:-1},339:{T:1},340:{T:-1},341:{T:1},342:{T:-1},343:{T:1},344:{T:-1},345:{T:1},346:{T:-1},347:{T:1},348:{T:-1},349:{T:1},350:{T:-1},351:{},352:{},353:{T:1},354:{T:-1},355:{f:parse_RelID},357:{},358:{},359:{},360:{T:1},361:{},362:{f:parse_ExternSheet},363:{},364:{},366:{},367:{},368:{},369:{},370:{},371:{},372:{T:1},373:{T:-1},374:{T:1},375:{T:-1},376:{T:1},377:{T:-1},378:{T:1},379:{T:-1},380:{T:1},381:{T:-1},382:{T:1},383:{T:-1},384:{T:1},385:{T:-1},386:{T:1},387:{T:-1},388:{T:1},389:{T:-1},390:{T:1},391:{T:-1},392:{T:1},393:{T:-1},394:{T:1},395:{T:-1},396:{},397:{},398:{},399:{},400:{},401:{T:1},403:{},404:{},405:{},406:{},407:{},408:{},409:{},410:{},411:{},412:{},413:{},414:{},415:{},416:{},417:{},418:{},419:{},420:{},421:{},422:{T:1},423:{T:1},424:{T:-1},425:{T:-1},426:{f:parse_BrtArrFmla},427:{f:parse_BrtShrFmla},428:{},429:{T:1},430:{T:-1},431:{T:1},432:{T:-1},433:{T:1},434:{T:-1},435:{T:1},436:{T:-1},437:{T:1},438:{T:-1},439:{T:1},440:{T:-1},441:{T:1},442:{T:-1},443:{T:1},444:{T:-1},445:{T:1},446:{T:-1},447:{T:1},448:{T:-1},449:{T:1},450:{T:-1},451:{T:1},452:{T:-1},453:{T:1},454:{T:-1},455:{T:1},456:{T:-1},457:{T:1},458:{T:-1},459:{T:1},460:{T:-1},461:{T:1},462:{T:-1},463:{T:1},464:{T:-1},465:{T:1},466:{T:-1},467:{T:1},468:{T:-1},469:{T:1},470:{T:-1},471:{},472:{},473:{T:1},474:{T:-1},475:{},476:{f:parse_BrtMargins},477:{},478:{},479:{T:1},480:{T:-1},481:{T:1},482:{T:-1},483:{T:1},484:{T:-1},485:{f:parse_BrtWsFmtInfo},486:{T:1},487:{T:-1},488:{T:1},489:{T:-1},490:{T:1},491:{T:-1},492:{T:1},493:{T:-1},494:{f:parse_BrtHLink},495:{T:1},496:{T:-1},497:{T:1},498:{T:-1},499:{},500:{T:1},501:{T:-1},502:{T:1},503:{T:-1},504:{},505:{T:1},506:{T:-1},507:{},508:{T:1},509:{T:-1},510:{T:1},511:{T:-1},512:{},513:{},514:{T:1},515:{T:-1},516:{T:1},517:{T:-1},518:{T:1},519:{T:-1},520:{T:1},521:{T:-1},522:{},523:{},524:{},525:{},526:{},527:{},528:{T:1},529:{T:-1},530:{T:1},531:{T:-1},532:{T:1},533:{T:-1},534:{},535:{},536:{},537:{},538:{T:1},539:{T:-1},540:{T:1},541:{T:-1},542:{T:1},548:{},549:{},550:{f:parse_RelID},551:{},552:{},553:{},554:{T:1},555:{T:-1},556:{T:1},557:{T:-1},558:{T:1},559:{T:-1},560:{T:1},561:{T:-1},562:{},564:{},565:{T:1},566:{T:-1},569:{T:1},570:{T:-1},572:{},573:{T:1},574:{T:-1},577:{},578:{},579:{},580:{},581:{},582:{},583:{},584:{},585:{},586:{},587:{},588:{T:-1},589:{},590:{T:1},591:{T:-1},592:{T:1},593:{T:-1},594:{T:1},595:{T:-1},596:{},597:{T:1},598:{T:-1},599:{T:1},600:{T:-1},601:{T:1},602:{T:-1},603:{T:1},604:{T:-1},605:{T:1},606:{T:-1},607:{},608:{T:1},609:{T:-1},610:{},611:{T:1},612:{T:-1},613:{T:1},614:{T:-1},615:{T:1},616:{T:-1},617:{T:1},618:{T:-1},619:{T:1},620:{T:-1},625:{},626:{T:1},627:{T:-1},628:{T:1},629:{T:-1},630:{T:1},631:{T:-1},632:{f:parse_BrtCommentAuthor},633:{T:1},634:{T:-1},635:{T:1,f:parse_BrtBeginComment},636:{T:-1},637:{f:parse_BrtCommentText},638:{T:1},639:{},640:{T:-1},641:{T:1},642:{T:-1},643:{T:1},644:{},645:{T:-1},646:{T:1},648:{T:1},649:{},650:{T:-1},651:{f:parse_BrtCsProp},652:{},653:{T:1},654:{T:-1},655:{T:1},656:{T:-1},657:{T:1},658:{T:-1},659:{},660:{T:1},661:{},662:{T:-1},663:{},664:{T:1},665:{},666:{T:-1},667:{},668:{},669:{},671:{T:1},672:{T:-1},673:{T:1},674:{T:-1},675:{},676:{},677:{},678:{},679:{},680:{},681:{},1024:{},1025:{},1026:{T:1},1027:{T:-1},1028:{T:1},1029:{T:-1},1030:{},1031:{T:1},1032:{T:-1},1033:{T:1},1034:{T:-1},1035:{},1036:{},1037:{},1038:{T:1},1039:{T:-1},1040:{},1041:{T:1},1042:{T:-1},1043:{},1044:{},1045:{},1046:{T:1},1047:{T:-1},1048:{T:1},1049:{T:-1},1050:{},1051:{T:1},1052:{T:1},1053:{f:parse_BrtDVal14},1054:{T:1},1055:{},1056:{T:1},1057:{T:-1},1058:{T:1},1059:{T:-1},1061:{},1062:{T:1},1063:{T:-1},1064:{T:1},1065:{T:-1},1066:{T:1},1067:{T:-1},1068:{T:1},1069:{T:-1},1070:{T:1},1071:{T:-1},1072:{T:1},1073:{T:-1},1075:{T:1},1076:{T:-1},1077:{T:1},1078:{T:-1},1079:{T:1},1080:{T:-1},1081:{T:1},1082:{T:-1},1083:{T:1},1084:{T:-1},1085:{},1086:{T:1},1087:{T:-1},1088:{T:1},1089:{T:-1},1090:{T:1},1091:{T:-1},1092:{T:1},1093:{T:-1},1094:{T:1},1095:{T:-1},1096:{},1097:{T:1},1098:{},1099:{T:-1},1100:{T:1},1101:{T:-1},1102:{},1103:{},1104:{},1105:{},1111:{},1112:{},1113:{T:1},1114:{T:-1},1115:{T:1},1116:{T:-1},1117:{},1118:{T:1},1119:{T:-1},1120:{T:1},1121:{T:-1},1122:{T:1},1123:{T:-1},1124:{T:1},1125:{T:-1},1126:{},1128:{T:1},1129:{T:-1},1130:{},1131:{T:1},1132:{T:-1},1133:{T:1},1134:{T:-1},1135:{T:1},1136:{T:-1},1137:{T:1},1138:{T:-1},1139:{T:1},1140:{T:-1},1141:{},1142:{T:1},1143:{T:-1},1144:{T:1},1145:{T:-1},1146:{},1147:{T:1},1148:{T:-1},1149:{T:1},1150:{T:-1},1152:{T:1},1153:{T:-1},1154:{T:-1},1155:{T:-1},1156:{T:-1},1157:{T:1},1158:{T:-1},1159:{T:1},1160:{T:-1},1161:{T:1},1162:{T:-1},1163:{T:1},1164:{T:-1},1165:{T:1},1166:{T:-1},1167:{T:1},1168:{T:-1},1169:{T:1},1170:{T:-1},1171:{},1172:{T:1},1173:{T:-1},1177:{},1178:{T:1},1180:{},1181:{},1182:{},2048:{T:1},2049:{T:-1},2050:{},2051:{T:1},2052:{T:-1},2053:{},2054:{},2055:{T:1},2056:{T:-1},2057:{T:1},2058:{T:-1},2060:{},2067:{},2068:{T:1},2069:{T:-1},2070:{},2071:{},2072:{T:1},2073:{T:-1},2075:{},2076:{},2077:{T:1},2078:{T:-1},2079:{},2080:{T:1},2081:{T:-1},2082:{},2083:{T:1},2084:{T:-1},2085:{T:1},2086:{T:-1},2087:{T:1},2088:{T:-1},2089:{T:1},2090:{T:-1},2091:{},2092:{},2093:{T:1},2094:{T:-1},2095:{},2096:{T:1},2097:{T:-1},2098:{T:1},2099:{T:-1},2100:{T:1},2101:{T:-1},2102:{},2103:{T:1},2104:{T:-1},2105:{},2106:{T:1},2107:{T:-1},2108:{},2109:{T:1},2110:{T:-1},2111:{T:1},2112:{T:-1},2113:{T:1},2114:{T:-1},2115:{},2116:{},2117:{},2118:{T:1},2119:{T:-1},2120:{},2121:{T:1},2122:{T:-1},2123:{T:1},2124:{T:-1},2125:{},2126:{T:1},2127:{T:-1},2128:{},2129:{T:1},2130:{T:-1},2131:{T:1},2132:{T:-1},2133:{T:1},2134:{},2135:{},2136:{},2137:{T:1},2138:{T:-1},2139:{T:1},2140:{T:-1},2141:{},3072:{},3073:{},4096:{T:1},4097:{T:-1},5002:{T:1},5003:{T:-1},5081:{T:1},5082:{T:-1},5083:{},5084:{T:1},5085:{T:-1},5086:{T:1},5087:{T:-1},5088:{},5089:{},5090:{},5092:{T:1},5093:{T:-1},5094:{},5095:{T:1},5096:{T:-1},5097:{},5099:{},65535:{n:""}},XLSRecordEnum={6:{f:parse_Formula},10:{f:parsenoop2},12:{f:parseuint16},13:{f:parseuint16},14:{f:parsebool},15:{f:parsebool},16:{f:parse_Xnum},17:{f:parsebool},18:{f:parsebool},19:{f:parseuint16},20:{f:parse_XLHeaderFooter},21:{f:parse_XLHeaderFooter},23:{f:parse_ExternSheet},24:{f:parse_Lbl},25:{f:parsebool},26:{},27:{},28:{f:parse_Note},29:{},34:{f:parsebool},35:{f:parse_ExternName},38:{f:parse_Xnum},39:{f:parse_Xnum},40:{f:parse_Xnum},41:{f:parse_Xnum},42:{f:parsebool},43:{f:parsebool},47:{f:parse_FilePass},49:{f:parse_Font},51:{f:parseuint16},60:{},61:{f:parse_Window1},64:{f:parsebool},65:{f:parse_Pane},66:{f:parseuint16},77:{},80:{},81:{},82:{},85:{f:parseuint16},89:{},90:{},91:{},92:{f:parse_WriteAccess},93:{f:parse_Obj},94:{},95:{f:parsebool},96:{},97:{},99:{f:parsebool},125:{f:parse_ColInfo},128:{f:parse_Guts},129:{f:parse_WsBool},130:{f:parseuint16},131:{f:parsebool},132:{f:parsebool},133:{f:parse_BoundSheet8},134:{},140:{f:parse_Country},141:{f:parseuint16},144:{},146:{f:parse_Palette},151:{},152:{},153:{},154:{},155:{},156:{f:parseuint16},157:{},158:{},160:{f:parse_Scl},161:{f:parse_Setup},174:{},175:{},176:{},177:{},178:{},180:{},181:{},182:{},184:{},185:{},189:{f:parse_MulRk},190:{f:parse_MulBlank},193:{f:parsenoop2},197:{},198:{},199:{},200:{},201:{},202:{f:parsebool},203:{},204:{},205:{},206:{},207:{},208:{},209:{},210:{},211:{},213:{},215:{},216:{},217:{},218:{f:parseuint16},220:{},221:{f:parsebool},222:{},224:{f:parse_XF},225:{f:parse_InterfaceHdr},226:{f:parsenoop2},227:{},229:{f:parse_MergeCells},233:{},235:{},236:{},237:{},239:{},240:{},241:{},242:{},244:{},245:{},246:{},247:{},248:{},249:{},251:{},252:{f:parse_SST},253:{f:parse_LabelSst},255:{f:parse_ExtSST},256:{},259:{},290:{},311:{},312:{},315:{},317:{f:parseuint16a},318:{},319:{},320:{},330:{},331:{},333:{},334:{},335:{},336:{},337:{},338:{},339:{},340:{},351:{},352:{f:parsebool},353:{f:parsenoop2},401:{},402:{},403:{},404:{},405:{},406:{},407:{},408:{},425:{},426:{},427:{},428:{},429:{},430:{f:parse_SupBook},431:{f:parsebool},432:{},433:{},434:{},437:{},438:{f:parse_TxO},439:{f:parsebool},440:{f:parse_HLink},441:{},442:{f:parse_XLUnicodeString},443:{},444:{f:parseuint16},445:{},446:{},448:{f:parsenoop2},449:{f:parse_RecalcId,r:2},450:{f:parsenoop2},512:{f:parse_Dimensions},513:{f:parse_Blank},515:{f:parse_Number},516:{f:parse_Label},517:{f:parse_BoolErr},519:{f:parse_String},520:{f:parse_Row},523:{},545:{f:parse_Array},549:{f:parse_DefaultRowHeight},566:{},574:{f:parse_Window2},638:{f:parse_RK},659:{},1048:{},1054:{f:parse_Format},1084:{},1212:{f:parse_ShrFmla},2048:{f:parse_HLinkTooltip},2049:{},2050:{},2051:{},2052:{},2053:{},2054:{},2055:{},2056:{},2057:{f:parse_BOF},2058:{},2059:{},2060:{},2061:{},2062:{},2063:{},2064:{},2066:{},2067:{},2128:{},2129:{},2130:{},2131:{},2132:{},2133:{},2134:{},2135:{},2136:{},2137:{},2138:{},2146:{},2147:{r:12},2148:{},2149:{},2150:{},2151:{f:parsenoop2},2152:{},2154:{},2155:{},2156:{},2161:{},2162:{},2164:{},2165:{},2166:{},2167:{},2168:{},2169:{},2170:{},2171:{},2172:{f:parse_XFCRC,r:12},2173:{f:parse_XFExt,r:12},2174:{},2175:{},2180:{},2181:{},2182:{},2183:{},2184:{},2185:{},2186:{},2187:{},2188:{f:parsebool,r:12},2189:{},2190:{r:12},2191:{},2192:{},2194:{},2195:{},2196:{f:parse_NameCmt,r:12},2197:{},2198:{f:parse_Theme,r:12},2199:{},2200:{},2201:{},2202:{f:parse_MTRSettings,r:12},2203:{f:parsenoop2},2204:{},2205:{},2206:{},2207:{},2211:{f:parse_ForceFullCalculation},2212:{},2213:{},2214:{},2215:{},4097:{},4098:{},4099:{},4102:{},4103:{},4105:{},4106:{},4107:{},4108:{},4109:{},4116:{},4117:{},4118:{},4119:{},4120:{},4121:{},4122:{},4123:{},4124:{},4125:{},4126:{},4127:{},4128:{},4129:{},4130:{},4132:{},4133:{},4134:{f:parseuint16},4135:{},4146:{},4147:{},4148:{},4149:{},4154:{},4156:{},4157:{},4158:{},4159:{},4160:{},4161:{},4163:{},4164:{f:parse_ShtProps},4165:{},4166:{},4168:{},4170:{},4171:{},4174:{},4175:{},4176:{},4177:{},4187:{},4188:{f:parse_ClrtClient},4189:{},4191:{},4192:{},4193:{},4194:{},4195:{},4196:{},4197:{},4198:{},4199:{},4200:{},0:{f:parse_Dimensions},1:{},2:{f:parse_BIFF2INT},3:{f:parse_BIFF2NUM},4:{f:parse_BIFF2STR},5:{f:parse_BoolErr},7:{f:parse_BIFF2STRING},8:{},9:{f:parse_BOF},11:{},22:{f:parseuint16},30:{f:parse_BIFF2Format},31:{},32:{},33:{f:parse_Array},36:{},37:{f:parse_DefaultRowHeight},50:{f:parse_BIFF2FONTXTRA},62:{},52:{},67:{},68:{f:parseuint16},69:{},86:{},126:{},127:{f:parse_ImData},135:{},136:{},137:{},145:{},148:{},149:{},150:{},169:{},171:{},188:{},191:{},192:{},194:{},195:{},214:{f:parse_RString},223:{},234:{},354:{},421:{},518:{f:parse_Formula},521:{f:parse_BOF},536:{f:parse_Lbl},547:{f:parse_ExternName},561:{},579:{},1030:{f:parse_Formula},1033:{f:parse_BOF},1091:{},2157:{},2163:{},2177:{},2240:{},2241:{},2242:{},2243:{},2244:{},2245:{},2246:{},2247:{},2248:{},2249:{},2250:{},2251:{},2262:{r:12},29282:{}};function write_biff_rec(E,r,v,T){var w=r;if(!isNaN(w)){var S=(v||[]).length||0,I=E.next(4);I.write_shift(2,w),I.write_shift(2,S),S>0&&is_buf(v)&&E.push(v)}}function html_to_sheet(E,r){var v=r||{},T=v.dense?[]:{};E=E.replace(/<!--.*?-->/g,"");var w=E.match(/<table/i);if(!w)throw new Error("Invalid HTML: could not find <table>");var S=E.match(/<\/table/i),I=w.index,H=S&&S.index||E.length,te=split_regex(E.slice(I,H),/(:?<tr[^>]*>)/i,"<tr>"),ae=-1,ie=0,ce=0,me=0,_e={s:{r:1e7,c:1e7},e:{r:0,c:0}},Re=[];for(I=0;I<te.length;++I){var Pe=te[I].trim(),Ce=Pe.slice(0,3).toLowerCase();if(Ce=="<tr"){if(++ae,v.sheetRows&&v.sheetRows<=ae){--ae;break}ie=0;continue}if(!(Ce!="<td"&&Ce!="<th")){var Fe=Pe.split(/<\/t[dh]>/i);for(H=0;H<Fe.length;++H){var Me=Fe[H].trim();if(Me.match(/<t[dh]/i)){for(var Ve=Me,We=0;Ve.charAt(0)=="<"&&(We=Ve.indexOf(">"))>-1;)Ve=Ve.slice(We+1);for(var ze=0;ze<Re.length;++ze){var Ue=Re[ze];Ue.s.c==ie&&Ue.s.r<ae&&ae<=Ue.e.r&&(ie=Ue.e.c+1,ze=-1)}var je=parsexmltag(Me.slice(0,Me.indexOf(">")));me=je.colspan?+je.colspan:1,((ce=+je.rowspan)>1||me>1)&&Re.push({s:{r:ae,c:ie},e:{r:ae+(ce||1)-1,c:ie+me-1}});var ke=je.t||je["data-t"]||"";if(!Ve.length){ie+=me;continue}if(Ve=htmldecode(Ve),_e.s.r>ae&&(_e.s.r=ae),_e.e.r<ae&&(_e.e.r=ae),_e.s.c>ie&&(_e.s.c=ie),_e.e.c<ie&&(_e.e.c=ie),!Ve.length){ie+=me;continue}var Ne={t:"s",v:Ve};v.raw||!Ve.trim().length||ke=="s"||(Ve==="TRUE"?Ne={t:"b",v:!0}:Ve==="FALSE"?Ne={t:"b",v:!1}:isNaN(fuzzynum(Ve))?isNaN(fuzzydate(Ve).getDate())||(Ne={t:"d",v:parseDate(Ve)},v.cellDates||(Ne={t:"n",v:datenum(Ne.v)}),Ne.z=v.dateNF||table_fmt[14]):Ne={t:"n",v:fuzzynum(Ve)}),v.dense?(T[ae]||(T[ae]=[]),T[ae][ie]=Ne):T[encode_cell({r:ae,c:ie})]=Ne,ie+=me}}}}return T["!ref"]=encode_range(_e),Re.length&&(T["!merges"]=Re),T}function make_html_row(E,r,v,T){for(var w=E["!merges"]||[],S=[],I=r.s.c;I<=r.e.c;++I){for(var H=0,te=0,ae=0;ae<w.length;++ae)if(!(w[ae].s.r>v||w[ae].s.c>I)&&!(w[ae].e.r<v||w[ae].e.c<I)){if(w[ae].s.r<v||w[ae].s.c<I){H=-1;break}H=w[ae].e.r-w[ae].s.r+1,te=w[ae].e.c-w[ae].s.c+1;break}if(!(H<0)){var ie=encode_cell({r:v,c:I}),ce=T.dense?(E[v]||[])[I]:E[ie],me=ce&&ce.v!=null&&(ce.h||escapehtml(ce.w||(format_cell(ce),ce.w)||""))||"",_e={};H>1&&(_e.rowspan=H),te>1&&(_e.colspan=te),T.editable?me='<span contenteditable="true">'+me+"</span>":ce&&(_e["data-t"]=ce&&ce.t||"z",ce.v!=null&&(_e["data-v"]=ce.v),ce.z!=null&&(_e["data-z"]=ce.z),ce.l&&(ce.l.Target||"#").charAt(0)!="#"&&(me='<a href="'+ce.l.Target+'">'+me+"</a>")),_e.id=(T.id||"sjs")+"-"+ie,S.push(writextag("td",me,_e))}}var Re="<tr>";return Re+S.join("")+"</tr>"}var HTML_BEGIN='<html><head><meta charset="utf-8"/><title>SheetJS Table Export</title></head><body>',HTML_END="</body></html>";function html_to_workbook(E,r){var v=E.match(/<table[\s\S]*?>[\s\S]*?<\/table>/gi);if(!v||v.length==0)throw new Error("Invalid HTML: could not find <table>");if(v.length==1)return sheet_to_workbook(html_to_sheet(v[0],r),r);var T=book_new();return v.forEach(function(w,S){book_append_sheet(T,html_to_sheet(w,r),"Sheet"+(S+1))}),T}function make_html_preamble(E,r,v){var T=[];return T.join("")+"<table"+(v&&v.id?' id="'+v.id+'"':"")+">"}function sheet_to_html(E,r){var v=r||{},T=v.header!=null?v.header:HTML_BEGIN,w=v.footer!=null?v.footer:HTML_END,S=[T],I=decode_range(E["!ref"]);v.dense=Array.isArray(E),S.push(make_html_preamble(E,I,v));for(var H=I.s.r;H<=I.e.r;++H)S.push(make_html_row(E,I,H,v));return S.push("</table>"+w),S.join("")}function sheet_add_dom(E,r,v){var T=v||{},w=0,S=0;if(T.origin!=null)if(typeof T.origin=="number")w=T.origin;else{var I=typeof T.origin=="string"?decode_cell(T.origin):T.origin;w=I.r,S=I.c}var H=r.getElementsByTagName("tr"),te=Math.min(T.sheetRows||1e7,H.length),ae={s:{r:0,c:0},e:{r:w,c:S}};if(E["!ref"]){var ie=decode_range(E["!ref"]);ae.s.r=Math.min(ae.s.r,ie.s.r),ae.s.c=Math.min(ae.s.c,ie.s.c),ae.e.r=Math.max(ae.e.r,ie.e.r),ae.e.c=Math.max(ae.e.c,ie.e.c),w==-1&&(ae.e.r=w=ie.e.r+1)}var ce=[],me=0,_e=E["!rows"]||(E["!rows"]=[]),Re=0,Pe=0,Ce=0,Fe=0,Me=0,Ve=0;for(E["!cols"]||(E["!cols"]=[]);Re<H.length&&Pe<te;++Re){var We=H[Re];if(is_dom_element_hidden(We)){if(T.display)continue;_e[Pe]={hidden:!0}}var ze=We.children;for(Ce=Fe=0;Ce<ze.length;++Ce){var Ue=ze[Ce];if(!(T.display&&is_dom_element_hidden(Ue))){var je=Ue.hasAttribute("data-v")?Ue.getAttribute("data-v"):Ue.hasAttribute("v")?Ue.getAttribute("v"):htmldecode(Ue.innerHTML),ke=Ue.getAttribute("data-z")||Ue.getAttribute("z");for(me=0;me<ce.length;++me){var Ne=ce[me];Ne.s.c==Fe+S&&Ne.s.r<Pe+w&&Pe+w<=Ne.e.r&&(Fe=Ne.e.c+1-S,me=-1)}Ve=+Ue.getAttribute("colspan")||1,((Me=+Ue.getAttribute("rowspan")||1)>1||Ve>1)&&ce.push({s:{r:Pe+w,c:Fe+S},e:{r:Pe+w+(Me||1)-1,c:Fe+S+(Ve||1)-1}});var Ge={t:"s",v:je},Ie=Ue.getAttribute("data-t")||Ue.getAttribute("t")||"";je!=null&&(je.length==0?Ge.t=Ie||"z":T.raw||je.trim().length==0||Ie=="s"||(je==="TRUE"?Ge={t:"b",v:!0}:je==="FALSE"?Ge={t:"b",v:!1}:isNaN(fuzzynum(je))?isNaN(fuzzydate(je).getDate())||(Ge={t:"d",v:parseDate(je)},T.cellDates||(Ge={t:"n",v:datenum(Ge.v)}),Ge.z=T.dateNF||table_fmt[14]):Ge={t:"n",v:fuzzynum(je)})),Ge.z===void 0&&ke!=null&&(Ge.z=ke);var Le="",He=Ue.getElementsByTagName("A");if(He&&He.length)for(var Ct=0;Ct<He.length&&!(He[Ct].hasAttribute("href")&&(Le=He[Ct].getAttribute("href"),Le.charAt(0)!="#"));++Ct);Le&&Le.charAt(0)!="#"&&(Ge.l={Target:Le}),T.dense?(E[Pe+w]||(E[Pe+w]=[]),E[Pe+w][Fe+S]=Ge):E[encode_cell({c:Fe+S,r:Pe+w})]=Ge,ae.e.c<Fe+S&&(ae.e.c=Fe+S),Fe+=Ve}}++Pe}return ce.length&&(E["!merges"]=(E["!merges"]||[]).concat(ce)),ae.e.r=Math.max(ae.e.r,Pe-1+w),E["!ref"]=encode_range(ae),Pe>=te&&(E["!fullref"]=encode_range((ae.e.r=H.length-Re+Pe-1+w,ae))),E}function parse_dom_table(E,r){var v=r||{},T=v.dense?[]:{};return sheet_add_dom(T,E,r)}function table_to_book(E,r){return sheet_to_workbook(parse_dom_table(E,r),r)}function is_dom_element_hidden(E){var r="",v=get_get_computed_style_function(E);return v&&(r=v(E).getPropertyValue("display")),r||(r=E.style&&E.style.display),r==="none"}function get_get_computed_style_function(E){return E.ownerDocument.defaultView&&typeof E.ownerDocument.defaultView.getComputedStyle=="function"?E.ownerDocument.defaultView.getComputedStyle:typeof getComputedStyle=="function"?getComputedStyle:null}function parse_text_p(E){var r=E.replace(/[\t\r\n]/g," ").trim().replace(/ +/g," ").replace(/<text:s\/>/g," ").replace(/<text:s text:c="(\d+)"\/>/g,function(T,w){return Array(parseInt(w,10)+1).join(" ")}).replace(/<text:tab[^>]*\/>/g,"	").replace(/<text:line-break\/>/g,`
`),v=unescapexml(r.replace(/<[^>]*>/g,""));return[v]}var number_formats_ods={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"],era:["e","ee"],quarter:["\\Qm",'m\\"th quarter"']};function parse_content_xml(E,r){var v=r||{},T=xlml_normalize(E),w=[],S,I,H={name:""},te="",ae=0,ie,ce,me={},_e=[],Re=v.dense?[]:{},Pe,Ce,Fe={value:""},Me="",Ve=0,We=[],ze=-1,Ue=-1,je={s:{r:1e6,c:1e7},e:{r:0,c:0}},ke=0,Ne={},Ge=[],Ie={},Le=0,He=0,Ct=[],Ze=1,Rt=1,nt=[],nr={Names:[]},Je={},Wt=["",""],Lt=[],qe={},$e="",Be=0,Xe=!1,rt=!1,Qe=0;for(xlmlregex.lastIndex=0,T=T.replace(/<!--([\s\S]*?)-->/mg,"").replace(/<!DOCTYPE[^\[]*\[[^\]]*\]>/gm,"");Pe=xlmlregex.exec(T);)switch(Pe[3]=Pe[3].replace(/_.*$/,"")){case"table":case"工作表":Pe[1]==="/"?(je.e.c>=je.s.c&&je.e.r>=je.s.r?Re["!ref"]=encode_range(je):Re["!ref"]="A1:A1",v.sheetRows>0&&v.sheetRows<=je.e.r&&(Re["!fullref"]=Re["!ref"],je.e.r=v.sheetRows-1,Re["!ref"]=encode_range(je)),Ge.length&&(Re["!merges"]=Ge),Ct.length&&(Re["!rows"]=Ct),ie.name=ie.名称||ie.name,typeof JSON<"u"&&JSON.stringify(ie),_e.push(ie.name),me[ie.name]=Re,rt=!1):Pe[0].charAt(Pe[0].length-2)!=="/"&&(ie=parsexmltag(Pe[0],!1),ze=Ue=-1,je.s.r=je.s.c=1e7,je.e.r=je.e.c=0,Re=v.dense?[]:{},Ge=[],Ct=[],rt=!0);break;case"table-row-group":Pe[1]==="/"?--ke:++ke;break;case"table-row":case"行":if(Pe[1]==="/"){ze+=Ze,Ze=1;break}if(ce=parsexmltag(Pe[0],!1),ce.行号?ze=ce.行号-1:ze==-1&&(ze=0),Ze=+ce["number-rows-repeated"]||1,Ze<10)for(Qe=0;Qe<Ze;++Qe)ke>0&&(Ct[ze+Qe]={level:ke});Ue=-1;break;case"covered-table-cell":Pe[1]!=="/"&&++Ue,v.sheetStubs&&(v.dense?(Re[ze]||(Re[ze]=[]),Re[ze][Ue]={t:"z"}):Re[encode_cell({r:ze,c:Ue})]={t:"z"}),Me="",We=[];break;case"table-cell":case"数据":if(Pe[0].charAt(Pe[0].length-2)==="/")++Ue,Fe=parsexmltag(Pe[0],!1),Rt=parseInt(Fe["number-columns-repeated"]||"1",10),Ce={t:"z",v:null},Fe.formula&&v.cellFormula!=!1&&(Ce.f=ods_to_csf_formula(unescapexml(Fe.formula))),(Fe.数据类型||Fe["value-type"])=="string"&&(Ce.t="s",Ce.v=unescapexml(Fe["string-value"]||""),v.dense?(Re[ze]||(Re[ze]=[]),Re[ze][Ue]=Ce):Re[encode_cell({r:ze,c:Ue})]=Ce),Ue+=Rt-1;else if(Pe[1]!=="/"){++Ue,Me="",Ve=0,We=[],Rt=1;var vt=Ze?ze+Ze-1:ze;if(Ue>je.e.c&&(je.e.c=Ue),Ue<je.s.c&&(je.s.c=Ue),ze<je.s.r&&(je.s.r=ze),vt>je.e.r&&(je.e.r=vt),Fe=parsexmltag(Pe[0],!1),Lt=[],qe={},Ce={t:Fe.数据类型||Fe["value-type"],v:null},v.cellFormula)if(Fe.formula&&(Fe.formula=unescapexml(Fe.formula)),Fe["number-matrix-columns-spanned"]&&Fe["number-matrix-rows-spanned"]&&(Le=parseInt(Fe["number-matrix-rows-spanned"],10)||0,He=parseInt(Fe["number-matrix-columns-spanned"],10)||0,Ie={s:{r:ze,c:Ue},e:{r:ze+Le-1,c:Ue+He-1}},Ce.F=encode_range(Ie),nt.push([Ie,Ce.F])),Fe.formula)Ce.f=ods_to_csf_formula(Fe.formula);else for(Qe=0;Qe<nt.length;++Qe)ze>=nt[Qe][0].s.r&&ze<=nt[Qe][0].e.r&&Ue>=nt[Qe][0].s.c&&Ue<=nt[Qe][0].e.c&&(Ce.F=nt[Qe][1]);switch((Fe["number-columns-spanned"]||Fe["number-rows-spanned"])&&(Le=parseInt(Fe["number-rows-spanned"],10)||0,He=parseInt(Fe["number-columns-spanned"],10)||0,Ie={s:{r:ze,c:Ue},e:{r:ze+Le-1,c:Ue+He-1}},Ge.push(Ie)),Fe["number-columns-repeated"]&&(Rt=parseInt(Fe["number-columns-repeated"],10)),Ce.t){case"boolean":Ce.t="b",Ce.v=parsexmlbool(Fe["boolean-value"]);break;case"float":Ce.t="n",Ce.v=parseFloat(Fe.value);break;case"percentage":Ce.t="n",Ce.v=parseFloat(Fe.value);break;case"currency":Ce.t="n",Ce.v=parseFloat(Fe.value);break;case"date":Ce.t="d",Ce.v=parseDate(Fe["date-value"]),v.cellDates||(Ce.t="n",Ce.v=datenum(Ce.v)),Ce.z="m/d/yy";break;case"time":Ce.t="n",Ce.v=parse_isodur(Fe["time-value"])/86400,v.cellDates&&(Ce.t="d",Ce.v=numdate(Ce.v)),Ce.z="HH:MM:SS";break;case"number":Ce.t="n",Ce.v=parseFloat(Fe.数据数值);break;default:if(Ce.t==="string"||Ce.t==="text"||!Ce.t)Ce.t="s",Fe["string-value"]!=null&&(Me=unescapexml(Fe["string-value"]),We=[]);else throw new Error("Unsupported value type "+Ce.t)}}else{if(Xe=!1,Ce.t==="s"&&(Ce.v=Me||"",We.length&&(Ce.R=We),Xe=Ve==0),Je.Target&&(Ce.l=Je),Lt.length>0&&(Ce.c=Lt,Lt=[]),Me&&v.cellText!==!1&&(Ce.w=Me),Xe&&(Ce.t="z",delete Ce.v),(!Xe||v.sheetStubs)&&!(v.sheetRows&&v.sheetRows<=ze))for(var Dt=0;Dt<Ze;++Dt){if(Rt=parseInt(Fe["number-columns-repeated"]||"1",10),v.dense)for(Re[ze+Dt]||(Re[ze+Dt]=[]),Re[ze+Dt][Ue]=Dt==0?Ce:dup(Ce);--Rt>0;)Re[ze+Dt][Ue+Rt]=dup(Ce);else for(Re[encode_cell({r:ze+Dt,c:Ue})]=Ce;--Rt>0;)Re[encode_cell({r:ze+Dt,c:Ue+Rt})]=dup(Ce);je.e.c<=Ue&&(je.e.c=Ue)}Rt=parseInt(Fe["number-columns-repeated"]||"1",10),Ue+=Rt-1,Rt=0,Ce={},Me="",We=[]}Je={};break;case"document":case"document-content":case"电子表格文档":case"spreadsheet":case"主体":case"scripts":case"styles":case"font-face-decls":case"master-styles":if(Pe[1]==="/"){if((S=w.pop())[0]!==Pe[3])throw"Bad state: "+S}else Pe[0].charAt(Pe[0].length-2)!=="/"&&w.push([Pe[3],!0]);break;case"annotation":if(Pe[1]==="/"){if((S=w.pop())[0]!==Pe[3])throw"Bad state: "+S;qe.t=Me,We.length&&(qe.R=We),qe.a=$e,Lt.push(qe)}else Pe[0].charAt(Pe[0].length-2)!=="/"&&w.push([Pe[3],!1]);$e="",Be=0,Me="",Ve=0,We=[];break;case"creator":Pe[1]==="/"?$e=T.slice(Be,Pe.index):Be=Pe.index+Pe[0].length;break;case"meta":case"元数据":case"settings":case"config-item-set":case"config-item-map-indexed":case"config-item-map-entry":case"config-item-map-named":case"shapes":case"frame":case"text-box":case"image":case"data-pilot-tables":case"list-style":case"form":case"dde-links":case"event-listeners":case"chart":if(Pe[1]==="/"){if((S=w.pop())[0]!==Pe[3])throw"Bad state: "+S}else Pe[0].charAt(Pe[0].length-2)!=="/"&&w.push([Pe[3],!1]);Me="",Ve=0,We=[];break;case"scientific-number":break;case"currency-symbol":break;case"currency-style":break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(Pe[1]==="/"){if(Ne[H.name]=te,(S=w.pop())[0]!==Pe[3])throw"Bad state: "+S}else Pe[0].charAt(Pe[0].length-2)!=="/"&&(te="",H=parsexmltag(Pe[0],!1),w.push([Pe[3],!0]));break;case"script":break;case"libraries":break;case"automatic-styles":break;case"default-style":case"page-layout":break;case"style":break;case"map":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(w[w.length-1][0]){case"time-style":case"date-style":I=parsexmltag(Pe[0],!1),te+=number_formats_ods[Pe[3]][I.style==="long"?1:0];break}break;case"fraction":break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(w[w.length-1][0]){case"time-style":case"date-style":I=parsexmltag(Pe[0],!1),te+=number_formats_ods[Pe[3]][I.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(Pe[0].slice(-2)==="/>")break;if(Pe[1]==="/")switch(w[w.length-1][0]){case"number-style":case"date-style":case"time-style":te+=T.slice(ae,Pe.index);break}else ae=Pe.index+Pe[0].length;break;case"named-range":I=parsexmltag(Pe[0],!1),Wt=ods_to_csf_3D(I["cell-range-address"]);var Ut={Name:I.name,Ref:Wt[0]+"!"+Wt[1]};rt&&(Ut.Sheet=_e.length),nr.Names.push(Ut);break;case"text-content":break;case"text-properties":break;case"embedded-text":break;case"body":case"电子表格":break;case"forms":break;case"table-column":break;case"table-header-rows":break;case"table-rows":break;case"table-column-group":break;case"table-header-columns":break;case"table-columns":break;case"null-date":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"label-range":break;case"label-ranges":break;case"named-expression":break;case"sort":break;case"sort-by":break;case"sort-groups":break;case"tab":break;case"line-break":break;case"span":break;case"p":case"文本串":if(["master-styles"].indexOf(w[w.length-1][0])>-1)break;if(Pe[1]==="/"&&(!Fe||!Fe["string-value"])){var hr=parse_text_p(T.slice(Ve,Pe.index));Me=(Me.length>0?Me+`
`:"")+hr[0]}else parsexmltag(Pe[0],!1),Ve=Pe.index+Pe[0].length;break;case"s":break;case"database-range":if(Pe[1]==="/")break;try{Wt=ods_to_csf_3D(parsexmltag(Pe[0])["target-range-address"]),me[Wt[0]]["!autofilter"]={ref:Wt[1]}}catch{}break;case"date":break;case"object":break;case"title":case"标题":break;case"desc":break;case"binary-data":break;case"table-source":break;case"scenario":break;case"iteration":break;case"content-validations":break;case"content-validation":break;case"help-message":break;case"error-message":break;case"database-ranges":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;case"list-level-style-bullet":break;case"list-level-style-number":break;case"list-level-properties":break;case"sender-firstname":case"sender-lastname":case"sender-initials":case"sender-title":case"sender-position":case"sender-email":case"sender-phone-private":case"sender-fax":case"sender-company":case"sender-phone-work":case"sender-street":case"sender-city":case"sender-postal-code":case"sender-country":case"sender-state-or-province":case"author-name":case"author-initials":case"chapter":case"file-name":case"template-name":case"sheet-name":break;case"event-listener":break;case"initial-creator":case"creation-date":case"print-date":case"generator":case"document-statistic":case"user-defined":case"editing-duration":case"editing-cycles":break;case"config-item":break;case"page-number":break;case"page-count":break;case"time":break;case"cell-range-source":break;case"detective":break;case"operation":break;case"highlighted-range":break;case"data-pilot-table":case"source-cell-range":case"source-service":case"data-pilot-field":case"data-pilot-level":case"data-pilot-subtotals":case"data-pilot-subtotal":case"data-pilot-members":case"data-pilot-member":case"data-pilot-display-info":case"data-pilot-sort-info":case"data-pilot-layout-info":case"data-pilot-field-reference":case"data-pilot-groups":case"data-pilot-group":case"data-pilot-group-member":break;case"rect":break;case"dde-connection-decls":case"dde-connection-decl":case"dde-link":case"dde-source":break;case"properties":break;case"property":break;case"a":if(Pe[1]!=="/"){if(Je=parsexmltag(Pe[0],!1),!Je.href)break;Je.Target=unescapexml(Je.href),delete Je.href,Je.Target.charAt(0)=="#"&&Je.Target.indexOf(".")>-1?(Wt=ods_to_csf_3D(Je.Target.slice(1)),Je.Target="#"+Wt[0]+"!"+Wt[1]):Je.Target.match(/^\.\.[\\\/]/)&&(Je.Target=Je.Target.slice(3))}break;case"table-protection":break;case"data-pilot-grand-total":break;case"office-document-common-attrs":break;default:switch(Pe[2]){case"dc:":case"calcext:":case"loext:":case"ooo:":case"chartooo:":case"draw:":case"style:":case"chart:":case"form:":case"uof:":case"表:":case"字:":break;default:if(v.WTF)throw new Error(Pe)}}var pt={Sheets:me,SheetNames:_e,Workbook:nr};return v.bookSheets&&delete pt.Sheets,pt}function parse_ods(E,r){r=r||{},safegetzipfile(E,"META-INF/manifest.xml")&&parse_manifest(getzipdata(E,"META-INF/manifest.xml"),r);var v=getzipstr(E,"content.xml");if(!v)throw new Error("Missing content.xml in ODS / UOF file");var T=parse_content_xml(utf8read(v),r);return safegetzipfile(E,"meta.xml")&&(T.Props=parse_core_props(getzipdata(E,"meta.xml"))),T}function parse_fods(E,r){return parse_content_xml(E,r)}/*! sheetjs (C) 2013-present SheetJS -- http://sheetjs.com */function u8_to_dataview(E){return new DataView(E.buffer,E.byteOffset,E.byteLength)}function u8str(E){return typeof TextDecoder<"u"?new TextDecoder().decode(E):utf8read(a2s(E))}function u8concat(E){var r=E.reduce(function(w,S){return w+S.length},0),v=new Uint8Array(r),T=0;return E.forEach(function(w){v.set(w,T),T+=w.length}),v}function popcnt(E){return E-=E>>1&1431655765,E=(E&858993459)+(E>>2&858993459),(E+(E>>4)&252645135)*16843009>>>24}function readDecimal128LE(E,r){for(var v=(E[r+15]&127)<<7|E[r+14]>>1,T=E[r+14]&1,w=r+13;w>=r;--w)T=T*256+E[w];return(E[r+15]&128?-T:T)*Math.pow(10,v-6176)}function parse_varint49(E,r){var v=r?r[0]:0,T=E[v]&127;e:if(E[v++]>=128&&(T|=(E[v]&127)<<7,E[v++]<128||(T|=(E[v]&127)<<14,E[v++]<128)||(T|=(E[v]&127)<<21,E[v++]<128)||(T+=(E[v]&127)*Math.pow(2,28),++v,E[v++]<128)||(T+=(E[v]&127)*Math.pow(2,35),++v,E[v++]<128)||(T+=(E[v]&127)*Math.pow(2,42),++v,E[v++]<128)))break e;return r&&(r[0]=v),T}function varint_to_i32(E){var r=0,v=E[r]&127;e:if(E[r++]>=128){if(v|=(E[r]&127)<<7,E[r++]<128||(v|=(E[r]&127)<<14,E[r++]<128)||(v|=(E[r]&127)<<21,E[r++]<128))break e;v|=(E[r]&127)<<28}return v}function parse_shallow(E){for(var r=[],v=[0];v[0]<E.length;){var T=v[0],w=parse_varint49(E,v),S=w&7;w=Math.floor(w/8);var I=0,H;if(w==0)break;switch(S){case 0:{for(var te=v[0];E[v[0]++]>=128;);H=E.slice(te,v[0])}break;case 5:I=4,H=E.slice(v[0],v[0]+I),v[0]+=I;break;case 1:I=8,H=E.slice(v[0],v[0]+I),v[0]+=I;break;case 2:I=parse_varint49(E,v),H=E.slice(v[0],v[0]+I),v[0]+=I;break;case 3:case 4:default:throw new Error("PB Type ".concat(S," for Field ").concat(w," at offset ").concat(T))}var ae={data:H,type:S};r[w]==null?r[w]=[ae]:r[w].push(ae)}return r}function mappa(E,r){return(E==null?void 0:E.map(function(v){return r(v.data)}))||[]}function parse_iwa_file(E){for(var r,v=[],T=[0];T[0]<E.length;){var w=parse_varint49(E,T),S=parse_shallow(E.slice(T[0],T[0]+w));T[0]+=w;var I={id:varint_to_i32(S[1][0].data),messages:[]};S[2].forEach(function(H){var te=parse_shallow(H.data),ae=varint_to_i32(te[3][0].data);I.messages.push({meta:te,data:E.slice(T[0],T[0]+ae)}),T[0]+=ae}),(r=S[3])!=null&&r[0]&&(I.merge=varint_to_i32(S[3][0].data)>>>0>0),v.push(I)}return v}function parse_snappy_chunk(E,r){if(E!=0)throw new Error("Unexpected Snappy chunk type ".concat(E));for(var v=[0],T=parse_varint49(r,v),w=[];v[0]<r.length;){var S=r[v[0]]&3;if(S==0){var I=r[v[0]++]>>2;if(I<60)++I;else{var H=I-59;I=r[v[0]],H>1&&(I|=r[v[0]+1]<<8),H>2&&(I|=r[v[0]+2]<<16),H>3&&(I|=r[v[0]+3]<<24),I>>>=0,I++,v[0]+=H}w.push(r.slice(v[0],v[0]+I)),v[0]+=I;continue}else{var te=0,ae=0;if(S==1?(ae=(r[v[0]]>>2&7)+4,te=(r[v[0]++]&224)<<3,te|=r[v[0]++]):(ae=(r[v[0]++]>>2)+1,S==2?(te=r[v[0]]|r[v[0]+1]<<8,v[0]+=2):(te=(r[v[0]]|r[v[0]+1]<<8|r[v[0]+2]<<16|r[v[0]+3]<<24)>>>0,v[0]+=4)),w=[u8concat(w)],te==0)throw new Error("Invalid offset 0");if(te>w[0].length)throw new Error("Invalid offset beyond length");if(ae>=te)for(w.push(w[0].slice(-te)),ae-=te;ae>=w[w.length-1].length;)w.push(w[w.length-1]),ae-=w[w.length-1].length;w.push(w[0].slice(-te,-te+ae))}}var ie=u8concat(w);if(ie.length!=T)throw new Error("Unexpected length: ".concat(ie.length," != ").concat(T));return ie}function decompress_iwa_file(E){for(var r=[],v=0;v<E.length;){var T=E[v++],w=E[v]|E[v+1]<<8|E[v+2]<<16;v+=3,r.push(parse_snappy_chunk(T,E.slice(v,v+w))),v+=w}if(v!==E.length)throw new Error("data is not a valid framed stream!");return u8concat(r)}function parse_old_storage(E,r,v,T){var w=u8_to_dataview(E),S=w.getUint32(4,!0),I=(T>1?12:8)+popcnt(S&(T>1?3470:398))*4,H=-1,te=-1,ae=NaN,ie=new Date(2001,0,1);S&512&&(H=w.getUint32(I,!0),I+=4),I+=popcnt(S&(T>1?12288:4096))*4,S&16&&(te=w.getUint32(I,!0),I+=4),S&32&&(ae=w.getFloat64(I,!0),I+=8),S&64&&(ie.setTime(ie.getTime()+w.getFloat64(I,!0)*1e3),I+=8);var ce;switch(E[2]){case 0:break;case 2:ce={t:"n",v:ae};break;case 3:ce={t:"s",v:r[te]};break;case 5:ce={t:"d",v:ie};break;case 6:ce={t:"b",v:ae>0};break;case 7:ce={t:"n",v:ae/86400};break;case 8:ce={t:"e",v:0};break;case 9:if(H>-1)ce={t:"s",v:v[H]};else if(te>-1)ce={t:"s",v:r[te]};else if(!isNaN(ae))ce={t:"n",v:ae};else throw new Error("Unsupported cell type ".concat(E.slice(0,4)));break;default:throw new Error("Unsupported cell type ".concat(E.slice(0,4)))}return ce}function parse_new_storage(E,r,v){var T=u8_to_dataview(E),w=T.getUint32(8,!0),S=12,I=-1,H=-1,te=NaN,ae=NaN,ie=new Date(2001,0,1);w&1&&(te=readDecimal128LE(E,S),S+=16),w&2&&(ae=T.getFloat64(S,!0),S+=8),w&4&&(ie.setTime(ie.getTime()+T.getFloat64(S,!0)*1e3),S+=8),w&8&&(H=T.getUint32(S,!0),S+=4),w&16&&(I=T.getUint32(S,!0),S+=4);var ce;switch(E[1]){case 0:break;case 2:ce={t:"n",v:te};break;case 3:ce={t:"s",v:r[H]};break;case 5:ce={t:"d",v:ie};break;case 6:ce={t:"b",v:ae>0};break;case 7:ce={t:"n",v:ae/86400};break;case 8:ce={t:"e",v:0};break;case 9:if(I>-1)ce={t:"s",v:v[I]};else throw new Error("Unsupported cell type ".concat(E[1]," : ").concat(w&31," : ").concat(E.slice(0,4)));break;case 10:ce={t:"n",v:te};break;default:throw new Error("Unsupported cell type ".concat(E[1]," : ").concat(w&31," : ").concat(E.slice(0,4)))}return ce}function parse_cell_storage(E,r,v){switch(E[0]){case 0:case 1:case 2:case 3:return parse_old_storage(E,r,v,E[0]);case 5:return parse_new_storage(E,r,v);default:throw new Error("Unsupported payload version ".concat(E[0]))}}function parse_TSP_Reference(E){var r=parse_shallow(E);return parse_varint49(r[1][0].data)}function parse_TST_TableDataList(E,r){var v=parse_shallow(r.data),T=varint_to_i32(v[1][0].data),w=v[3],S=[];return(w||[]).forEach(function(I){var H=parse_shallow(I.data),te=varint_to_i32(H[1][0].data)>>>0;switch(T){case 1:S[te]=u8str(H[3][0].data);break;case 8:{var ae=E[parse_TSP_Reference(H[9][0].data)][0],ie=parse_shallow(ae.data),ce=E[parse_TSP_Reference(ie[1][0].data)][0],me=varint_to_i32(ce.meta[1][0].data);if(me!=2001)throw new Error("2000 unexpected reference to ".concat(me));var _e=parse_shallow(ce.data);S[te]=_e[3].map(function(Re){return u8str(Re.data)}).join("")}break}}),S}function parse_TST_TileRowInfo(E,r){var v,T,w,S,I,H,te,ae,ie,ce,me,_e,Re,Pe,Ce=parse_shallow(E),Fe=varint_to_i32(Ce[1][0].data)>>>0,Me=varint_to_i32(Ce[2][0].data)>>>0,Ve=((T=(v=Ce[8])==null?void 0:v[0])==null?void 0:T.data)&&varint_to_i32(Ce[8][0].data)>0||!1,We,ze;if((S=(w=Ce[7])==null?void 0:w[0])!=null&&S.data&&r!=0)We=(H=(I=Ce[7])==null?void 0:I[0])==null?void 0:H.data,ze=(ae=(te=Ce[6])==null?void 0:te[0])==null?void 0:ae.data;else if((ce=(ie=Ce[4])==null?void 0:ie[0])!=null&&ce.data&&r!=1)We=(_e=(me=Ce[4])==null?void 0:me[0])==null?void 0:_e.data,ze=(Pe=(Re=Ce[3])==null?void 0:Re[0])==null?void 0:Pe.data;else throw"NUMBERS Tile missing ".concat(r," cell storage");for(var Ue=Ve?4:1,je=u8_to_dataview(We),ke=[],Ne=0;Ne<We.length/2;++Ne){var Ge=je.getUint16(Ne*2,!0);Ge<65535&&ke.push([Ne,Ge])}if(ke.length!=Me)throw"Expected ".concat(Me," cells, found ").concat(ke.length);var Ie=[];for(Ne=0;Ne<ke.length-1;++Ne)Ie[ke[Ne][0]]=ze.subarray(ke[Ne][1]*Ue,ke[Ne+1][1]*Ue);return ke.length>=1&&(Ie[ke[ke.length-1][0]]=ze.subarray(ke[ke.length-1][1]*Ue)),{R:Fe,cells:Ie}}function parse_TST_Tile(E,r){var v,T=parse_shallow(r.data),w=(v=T==null?void 0:T[7])!=null&&v[0]?varint_to_i32(T[7][0].data)>>>0>0?1:0:-1,S=mappa(T[5],function(I){return parse_TST_TileRowInfo(I,w)});return{nrows:varint_to_i32(T[4][0].data)>>>0,data:S.reduce(function(I,H){return I[H.R]||(I[H.R]=[]),H.cells.forEach(function(te,ae){if(I[H.R][ae])throw new Error("Duplicate cell r=".concat(H.R," c=").concat(ae));I[H.R][ae]=te}),I},[])}}function parse_TST_TableModelArchive(E,r,v){var T,w=parse_shallow(r.data),S={s:{r:0,c:0},e:{r:0,c:0}};if(S.e.r=(varint_to_i32(w[6][0].data)>>>0)-1,S.e.r<0)throw new Error("Invalid row varint ".concat(w[6][0].data));if(S.e.c=(varint_to_i32(w[7][0].data)>>>0)-1,S.e.c<0)throw new Error("Invalid col varint ".concat(w[7][0].data));v["!ref"]=encode_range(S);var I=parse_shallow(w[4][0].data),H=parse_TST_TableDataList(E,E[parse_TSP_Reference(I[4][0].data)][0]),te=(T=I[17])!=null&&T[0]?parse_TST_TableDataList(E,E[parse_TSP_Reference(I[17][0].data)][0]):[],ae=parse_shallow(I[3][0].data),ie=0;ae[1].forEach(function(ce){var me=parse_shallow(ce.data),_e=E[parse_TSP_Reference(me[2][0].data)][0],Re=varint_to_i32(_e.meta[1][0].data);if(Re!=6002)throw new Error("6001 unexpected reference to ".concat(Re));var Pe=parse_TST_Tile(E,_e);Pe.data.forEach(function(Ce,Fe){Ce.forEach(function(Me,Ve){var We=encode_cell({r:ie+Fe,c:Ve}),ze=parse_cell_storage(Me,H,te);ze&&(v[We]=ze)})}),ie+=Pe.nrows})}function parse_TST_TableInfoArchive(E,r){var v=parse_shallow(r.data),T={"!ref":"A1"},w=E[parse_TSP_Reference(v[2][0].data)],S=varint_to_i32(w[0].meta[1][0].data);if(S!=6001)throw new Error("6000 unexpected reference to ".concat(S));return parse_TST_TableModelArchive(E,w[0],T),T}function parse_TN_SheetArchive(E,r){var v,T=parse_shallow(r.data),w={name:(v=T[1])!=null&&v[0]?u8str(T[1][0].data):"",sheets:[]},S=mappa(T[2],parse_TSP_Reference);return S.forEach(function(I){E[I].forEach(function(H){var te=varint_to_i32(H.meta[1][0].data);te==6e3&&w.sheets.push(parse_TST_TableInfoArchive(E,H))})}),w}function parse_TN_DocumentArchive(E,r){var v=book_new(),T=parse_shallow(r.data),w=mappa(T[1],parse_TSP_Reference);if(w.forEach(function(S){E[S].forEach(function(I){var H=varint_to_i32(I.meta[1][0].data);if(H==2){var te=parse_TN_SheetArchive(E,I);te.sheets.forEach(function(ae,ie){book_append_sheet(v,ae,ie==0?te.name:te.name+"_"+ie,!0)})}})}),v.SheetNames.length==0)throw new Error("Empty NUMBERS file");return v}function parse_numbers_iwa(E){var r,v,T,w,S={},I=[];if(E.FullPaths.forEach(function(te){if(te.match(/\.iwpv2/))throw new Error("Unsupported password protection")}),E.FileIndex.forEach(function(te){if(te.name.match(/\.iwa$/)){var ae;try{ae=decompress_iwa_file(te.content)}catch(ce){return console.log("?? "+te.content.length+" "+(ce.message||ce))}var ie;try{ie=parse_iwa_file(ae)}catch(ce){return console.log("## "+(ce.message||ce))}ie.forEach(function(ce){S[ce.id]=ce.messages,I.push(ce.id)})}}),!I.length)throw new Error("File has no messages");var H=((w=(T=(v=(r=S==null?void 0:S[1])==null?void 0:r[0])==null?void 0:v.meta)==null?void 0:T[1])==null?void 0:w[0].data)&&varint_to_i32(S[1][0].meta[1][0].data)==1&&S[1][0];if(H||I.forEach(function(te){S[te].forEach(function(ae){var ie=varint_to_i32(ae.meta[1][0].data)>>>0;if(ie==1)if(!H)H=ae;else throw new Error("Document has multiple roots")})}),!H)throw new Error("Cannot find Document root");return parse_TN_DocumentArchive(S,H)}function fix_opts_func(E){return function(v){for(var T=0;T!=E.length;++T){var w=E[T];v[w[0]]===void 0&&(v[w[0]]=w[1]),w[2]==="n"&&(v[w[0]]=Number(v[w[0]]))}}}function fix_read_opts(E){fix_opts_func([["cellNF",!1],["cellHTML",!0],["cellFormula",!0],["cellStyles",!1],["cellText",!0],["cellDates",!1],["sheetStubs",!1],["sheetRows",0,"n"],["bookDeps",!1],["bookSheets",!1],["bookProps",!1],["bookFiles",!1],["bookVBA",!1],["password",""],["WTF",!1]])(E)}function get_sheet_type(E){return RELS.WS.indexOf(E)>-1?"sheet":E==RELS.CS?"chart":E==RELS.DS?"dialog":E==RELS.MS?"macro":E&&E.length?E:"sheet"}function safe_parse_wbrels(E,r){if(!E)return 0;try{E=r.map(function(T){return T.id||(T.id=T.strRelID),[T.name,E["!id"][T.id].Target,get_sheet_type(E["!id"][T.id].Type)]})}catch{return null}return!E||E.length===0?null:E}function safe_parse_sheet(E,r,v,T,w,S,I,H,te,ae,ie,ce){try{S[T]=parse_rels(getzipstr(E,v,!0),r);var me=getzipdata(E,r),_e;switch(H){case"sheet":_e=parse_ws(me,r,w,te,S[T],ae,ie,ce);break;case"chart":if(_e=parse_cs(me,r,w,te,S[T],ae,ie,ce),!_e||!_e["!drawel"])break;var Re=resolve_path(_e["!drawel"].Target,r),Pe=get_rels_path(Re),Ce=parse_drawing(getzipstr(E,Re,!0),parse_rels(getzipstr(E,Pe,!0),Re)),Fe=resolve_path(Ce,Re),Me=get_rels_path(Fe);_e=parse_chart(getzipstr(E,Fe,!0),Fe,te,parse_rels(getzipstr(E,Me,!0),Fe),ae,_e);break;case"macro":_e=parse_ms(me,r,w,te,S[T],ae,ie,ce);break;case"dialog":_e=parse_ds(me,r,w,te,S[T],ae,ie,ce);break;default:throw new Error("Unrecognized sheet type "+H)}I[T]=_e;var Ve=[];S&&S[T]&&keys(S[T]).forEach(function(We){var ze="";if(S[T][We].Type==RELS.CMNT){ze=resolve_path(S[T][We].Target,r);var Ue=parse_cmnt(getzipdata(E,ze,!0),ze,te);if(!Ue||!Ue.length)return;sheet_insert_comments(_e,Ue,!1)}S[T][We].Type==RELS.TCMNT&&(ze=resolve_path(S[T][We].Target,r),Ve=Ve.concat(parse_tcmnt_xml(getzipdata(E,ze,!0),te)))}),Ve&&Ve.length&&sheet_insert_comments(_e,Ve,!0,te.people||[])}catch(We){if(te.WTF)throw We}}function strip_front_slash(E){return E.charAt(0)=="/"?E.slice(1):E}function parse_zip(E,r){if(make_ssf(),r=r||{},fix_read_opts(r),safegetzipfile(E,"META-INF/manifest.xml")||safegetzipfile(E,"objectdata.xml"))return parse_ods(E,r);if(safegetzipfile(E,"Index/Document.iwa")){if(typeof Uint8Array>"u")throw new Error("NUMBERS file parsing requires Uint8Array support");if(typeof parse_numbers_iwa<"u"){if(E.FileIndex)return parse_numbers_iwa(E);var v=CFB.utils.cfb_new();return zipentries(E).forEach(function(Ct){zip_add_file(v,Ct,getzipbin(E,Ct))}),parse_numbers_iwa(v)}throw new Error("Unsupported NUMBERS file")}if(!safegetzipfile(E,"[Content_Types].xml"))throw safegetzipfile(E,"index.xml.gz")?new Error("Unsupported NUMBERS 08 file"):safegetzipfile(E,"index.xml")?new Error("Unsupported NUMBERS 09 file"):new Error("Unsupported ZIP file");var T=zipentries(E),w=parse_ct(getzipstr(E,"[Content_Types].xml")),S=!1,I,H;if(w.workbooks.length===0&&(H="xl/workbook.xml",getzipdata(E,H,!0)&&w.workbooks.push(H)),w.workbooks.length===0){if(H="xl/workbook.bin",!getzipdata(E,H,!0))throw new Error("Could not find workbook");w.workbooks.push(H),S=!0}w.workbooks[0].slice(-3)=="bin"&&(S=!0);var te={},ae={};if(!r.bookSheets&&!r.bookProps){if(strs=[],w.sst)try{strs=parse_sst(getzipdata(E,strip_front_slash(w.sst)),w.sst,r)}catch(Ct){if(r.WTF)throw Ct}r.cellStyles&&w.themes.length&&(te=parse_theme(getzipstr(E,w.themes[0].replace(/^\//,""),!0)||"",w.themes[0],r)),w.style&&(ae=parse_sty(getzipdata(E,strip_front_slash(w.style)),w.style,te,r))}w.links.map(function(Ct){try{var Ze=parse_rels(getzipstr(E,get_rels_path(strip_front_slash(Ct))),Ct);return parse_xlink(getzipdata(E,strip_front_slash(Ct)),Ze,Ct,r)}catch{}});var ie=parse_wb(getzipdata(E,strip_front_slash(w.workbooks[0])),w.workbooks[0],r),ce={},me="";w.coreprops.length&&(me=getzipdata(E,strip_front_slash(w.coreprops[0]),!0),me&&(ce=parse_core_props(me)),w.extprops.length!==0&&(me=getzipdata(E,strip_front_slash(w.extprops[0]),!0),me&&parse_ext_props(me,ce,r)));var _e={};(!r.bookSheets||r.bookProps)&&w.custprops.length!==0&&(me=getzipstr(E,strip_front_slash(w.custprops[0]),!0),me&&(_e=parse_cust_props(me,r)));var Re={};if((r.bookSheets||r.bookProps)&&(ie.Sheets?I=ie.Sheets.map(function(Ze){return Ze.name}):ce.Worksheets&&ce.SheetNames.length>0&&(I=ce.SheetNames),r.bookProps&&(Re.Props=ce,Re.Custprops=_e),r.bookSheets&&typeof I<"u"&&(Re.SheetNames=I),r.bookSheets?Re.SheetNames:r.bookProps))return Re;I={};var Pe={};r.bookDeps&&w.calcchain&&(Pe=parse_cc(getzipdata(E,strip_front_slash(w.calcchain)),w.calcchain));var Ce=0,Fe={},Me,Ve;{var We=ie.Sheets;ce.Worksheets=We.length,ce.SheetNames=[];for(var ze=0;ze!=We.length;++ze)ce.SheetNames[ze]=We[ze].name}var Ue=S?"bin":"xml",je=w.workbooks[0].lastIndexOf("/"),ke=(w.workbooks[0].slice(0,je+1)+"_rels/"+w.workbooks[0].slice(je+1)+".rels").replace(/^\//,"");safegetzipfile(E,ke)||(ke="xl/_rels/workbook."+Ue+".rels");var Ne=parse_rels(getzipstr(E,ke,!0),ke.replace(/_rels.*/,"s5s"));(w.metadata||[]).length>=1&&(r.xlmeta=parse_xlmeta(getzipdata(E,strip_front_slash(w.metadata[0])),w.metadata[0],r)),(w.people||[]).length>=1&&(r.people=parse_people_xml(getzipdata(E,strip_front_slash(w.people[0])),r)),Ne&&(Ne=safe_parse_wbrels(Ne,ie.Sheets));var Ge=getzipdata(E,"xl/worksheets/sheet.xml",!0)?1:0;e:for(Ce=0;Ce!=ce.Worksheets;++Ce){var Ie="sheet";if(Ne&&Ne[Ce]?(Me="xl/"+Ne[Ce][1].replace(/[\/]?xl\//,""),safegetzipfile(E,Me)||(Me=Ne[Ce][1]),safegetzipfile(E,Me)||(Me=ke.replace(/_rels\/.*$/,"")+Ne[Ce][1]),Ie=Ne[Ce][2]):(Me="xl/worksheets/sheet"+(Ce+1-Ge)+"."+Ue,Me=Me.replace(/sheet0\./,"sheet.")),Ve=Me.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels"),r&&r.sheets!=null)switch(typeof r.sheets){case"number":if(Ce!=r.sheets)continue e;break;case"string":if(ce.SheetNames[Ce].toLowerCase()!=r.sheets.toLowerCase())continue e;break;default:if(Array.isArray&&Array.isArray(r.sheets)){for(var Le=!1,He=0;He!=r.sheets.length;++He)typeof r.sheets[He]=="number"&&r.sheets[He]==Ce&&(Le=1),typeof r.sheets[He]=="string"&&r.sheets[He].toLowerCase()==ce.SheetNames[Ce].toLowerCase()&&(Le=1);if(!Le)continue e}}safe_parse_sheet(E,Me,Ve,ce.SheetNames[Ce],Ce,Fe,I,Ie,r,ie,te,ae)}return Re={Directory:w,Workbook:ie,Props:ce,Custprops:_e,Deps:Pe,Sheets:I,SheetNames:ce.SheetNames,Strings:strs,Styles:ae,Themes:te,SSF:dup(table_fmt)},r&&r.bookFiles&&(E.files?(Re.keys=T,Re.files=E.files):(Re.keys=[],Re.files={},E.FullPaths.forEach(function(Ct,Ze){Ct=Ct.replace(/^Root Entry[\/]/,""),Re.keys.push(Ct),Re.files[Ct]=E.FileIndex[Ze]}))),r&&r.bookVBA&&(w.vba.length>0?Re.vbaraw=getzipdata(E,strip_front_slash(w.vba[0]),!0):w.defaults&&w.defaults.bin===CT_VBA&&(Re.vbaraw=getzipdata(E,"xl/vbaProject.bin",!0))),Re}function parse_xlsxcfb(E,r){var v=r||{},T="Workbook",w=CFB.find(E,T);try{if(T="/!DataSpaces/Version",w=CFB.find(E,T),!w||!w.content)throw new Error("ECMA-376 Encrypted file missing "+T);if(parse_DataSpaceVersionInfo(w.content),T="/!DataSpaces/DataSpaceMap",w=CFB.find(E,T),!w||!w.content)throw new Error("ECMA-376 Encrypted file missing "+T);var S=parse_DataSpaceMap(w.content);if(S.length!==1||S[0].comps.length!==1||S[0].comps[0].t!==0||S[0].name!=="StrongEncryptionDataSpace"||S[0].comps[0].v!=="EncryptedPackage")throw new Error("ECMA-376 Encrypted file bad "+T);if(T="/!DataSpaces/DataSpaceInfo/StrongEncryptionDataSpace",w=CFB.find(E,T),!w||!w.content)throw new Error("ECMA-376 Encrypted file missing "+T);var I=parse_DataSpaceDefinition(w.content);if(I.length!=1||I[0]!="StrongEncryptionTransform")throw new Error("ECMA-376 Encrypted file bad "+T);if(T="/!DataSpaces/TransformInfo/StrongEncryptionTransform/!Primary",w=CFB.find(E,T),!w||!w.content)throw new Error("ECMA-376 Encrypted file missing "+T);parse_Primary(w.content)}catch{}if(T="/EncryptionInfo",w=CFB.find(E,T),!w||!w.content)throw new Error("ECMA-376 Encrypted file missing "+T);var H=parse_EncryptionInfo(w.content);if(T="/EncryptedPackage",w=CFB.find(E,T),!w||!w.content)throw new Error("ECMA-376 Encrypted file missing "+T);if(H[0]==4&&typeof decrypt_agile<"u")return decrypt_agile(H[1],w.content,v.password||"",v);if(H[0]==2&&typeof decrypt_std76<"u")return decrypt_std76(H[1],w.content,v.password||"",v);throw new Error("File is password-protected")}function firstbyte(E,r){var v="";switch((r||{}).type||"base64"){case"buffer":return[E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7]];case"base64":v=Base64_decode(E.slice(0,12));break;case"binary":v=E;break;case"array":return[E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7]];default:throw new Error("Unrecognized type "+(r&&r.type||"undefined"))}return[v.charCodeAt(0),v.charCodeAt(1),v.charCodeAt(2),v.charCodeAt(3),v.charCodeAt(4),v.charCodeAt(5),v.charCodeAt(6),v.charCodeAt(7)]}function read_cfb(E,r){return CFB.find(E,"EncryptedPackage")?parse_xlsxcfb(E,r):parse_xlscfb(E,r)}function read_zip(E,r){var v,T=E,w=r||{};return w.type||(w.type=has_buf&&Buffer.isBuffer(E)?"buffer":"base64"),v=zip_read(T,w),parse_zip(v,w)}function read_plaintext(E,r){var v=0;e:for(;v<E.length;)switch(E.charCodeAt(v)){case 10:case 13:case 32:++v;break;case 60:return parse_xlml(E.slice(v),r);default:break e}return PRN.to_workbook(E,r)}function read_plaintext_raw(E,r){var v="",T=firstbyte(E,r);switch(r.type){case"base64":v=Base64_decode(E);break;case"binary":v=E;break;case"buffer":v=E.toString("binary");break;case"array":v=cc2str(E);break;default:throw new Error("Unrecognized type "+r.type)}return T[0]==239&&T[1]==187&&T[2]==191&&(v=utf8read(v)),r.type="binary",read_plaintext(v,r)}function read_utf16(E,r){var v=E;return r.type=="base64"&&(v=Base64_decode(v)),v=$cptable.utils.decode(1200,v.slice(2),"str"),r.type="binary",read_plaintext(v,r)}function bstrify(E){return E.match(/[^\x00-\x7F]/)?utf8write(E):E}function read_prn(E,r,v,T){return T?(v.type="string",PRN.to_workbook(E,v)):PRN.to_workbook(r,v)}function readSync(E,r){reset_cp();var v=r||{};if(typeof ArrayBuffer<"u"&&E instanceof ArrayBuffer)return readSync(new Uint8Array(E),(v=dup(v),v.type="array",v));typeof Uint8Array<"u"&&E instanceof Uint8Array&&!v.type&&(v.type=typeof Deno<"u"?"buffer":"array");var T=E,w=[0,0,0,0],S=!1;if(v.cellStyles&&(v.cellNF=!0,v.sheetStubs=!0),_ssfopts={},v.dateNF&&(_ssfopts.dateNF=v.dateNF),v.type||(v.type=has_buf&&Buffer.isBuffer(E)?"buffer":"base64"),v.type=="file"&&(v.type=has_buf?"buffer":"binary",T=read_binary(E),typeof Uint8Array<"u"&&!has_buf&&(v.type="array")),v.type=="string"&&(S=!0,v.type="binary",v.codepage=65001,T=bstrify(E)),v.type=="array"&&typeof Uint8Array<"u"&&E instanceof Uint8Array&&typeof ArrayBuffer<"u"){var I=new ArrayBuffer(3),H=new Uint8Array(I);if(H.foo="bar",!H.foo)return v=dup(v),v.type="array",readSync(ab2a(T),v)}switch((w=firstbyte(T,v))[0]){case 208:if(w[1]===207&&w[2]===17&&w[3]===224&&w[4]===161&&w[5]===177&&w[6]===26&&w[7]===225)return read_cfb(CFB.read(T,v),v);break;case 9:if(w[1]<=8)return parse_xlscfb(T,v);break;case 60:return parse_xlml(T,v);case 73:if(w[1]===73&&w[2]===42&&w[3]===0)throw new Error("TIFF Image File is not a spreadsheet");if(w[1]===68)return read_wb_ID(T,v);break;case 84:if(w[1]===65&&w[2]===66&&w[3]===76)return DIF.to_workbook(T,v);break;case 80:return w[1]===75&&w[2]<9&&w[3]<9?read_zip(T,v):read_prn(E,T,v,S);case 239:return w[3]===60?parse_xlml(T,v):read_prn(E,T,v,S);case 255:if(w[1]===254)return read_utf16(T,v);if(w[1]===0&&w[2]===2&&w[3]===0)return WK_.to_workbook(T,v);break;case 0:if(w[1]===0&&(w[2]>=2&&w[3]===0||w[2]===0&&(w[3]===8||w[3]===9)))return WK_.to_workbook(T,v);break;case 3:case 131:case 139:case 140:return DBF.to_workbook(T,v);case 123:if(w[1]===92&&w[2]===114&&w[3]===116)return RTF.to_workbook(T,v);break;case 10:case 13:case 32:return read_plaintext_raw(T,v);case 137:if(w[1]===80&&w[2]===78&&w[3]===71)throw new Error("PNG Image File is not a spreadsheet");break}return DBF_SUPPORTED_VERSIONS.indexOf(w[0])>-1&&w[2]<=12&&w[3]<=31?DBF.to_workbook(T,v):read_prn(E,T,v,S)}function make_json_row(E,r,v,T,w,S,I,H){var te=encode_row(v),ae=H.defval,ie=H.raw||!Object.prototype.hasOwnProperty.call(H,"raw"),ce=!0,me=w===1?[]:{};if(w!==1)if(Object.defineProperty)try{Object.defineProperty(me,"__rowNum__",{value:v,enumerable:!1})}catch{me.__rowNum__=v}else me.__rowNum__=v;if(!I||E[v])for(var _e=r.s.c;_e<=r.e.c;++_e){var Re=I?E[v][_e]:E[T[_e]+te];if(Re===void 0||Re.t===void 0){if(ae===void 0)continue;S[_e]!=null&&(me[S[_e]]=ae);continue}var Pe=Re.v;switch(Re.t){case"z":if(Pe==null)break;continue;case"e":Pe=Pe==0?null:void 0;break;case"s":case"d":case"b":case"n":break;default:throw new Error("unrecognized type "+Re.t)}if(S[_e]!=null){if(Pe==null)if(Re.t=="e"&&Pe===null)me[S[_e]]=null;else if(ae!==void 0)me[S[_e]]=ae;else if(ie&&Pe===null)me[S[_e]]=null;else continue;else me[S[_e]]=ie&&(Re.t!=="n"||Re.t==="n"&&H.rawNumbers!==!1)?Pe:format_cell(Re,Pe,H);Pe!=null&&(ce=!1)}}return{row:me,isempty:ce}}function sheet_to_json(E,r){if(E==null||E["!ref"]==null)return[];var v={t:"n",v:0},T=0,w=1,S=[],I=0,H="",te={s:{r:0,c:0},e:{r:0,c:0}},ae=r||{},ie=ae.range!=null?ae.range:E["!ref"];switch(ae.header===1?T=1:ae.header==="A"?T=2:Array.isArray(ae.header)?T=3:ae.header==null&&(T=0),typeof ie){case"string":te=safe_decode_range(ie);break;case"number":te=safe_decode_range(E["!ref"]),te.s.r=ie;break;default:te=ie}T>0&&(w=0);var ce=encode_row(te.s.r),me=[],_e=[],Re=0,Pe=0,Ce=Array.isArray(E),Fe=te.s.r,Me=0,Ve={};Ce&&!E[Fe]&&(E[Fe]=[]);var We=ae.skipHidden&&E["!cols"]||[],ze=ae.skipHidden&&E["!rows"]||[];for(Me=te.s.c;Me<=te.e.c;++Me)if(!(We[Me]||{}).hidden)switch(me[Me]=encode_col(Me),v=Ce?E[Fe][Me]:E[me[Me]+ce],T){case 1:S[Me]=Me-te.s.c;break;case 2:S[Me]=me[Me];break;case 3:S[Me]=ae.header[Me-te.s.c];break;default:if(v==null&&(v={w:"__EMPTY",t:"s"}),H=I=format_cell(v,null,ae),Pe=Ve[I]||0,!Pe)Ve[I]=1;else{do H=I+"_"+Pe++;while(Ve[H]);Ve[I]=Pe,Ve[H]=1}S[Me]=H}for(Fe=te.s.r+w;Fe<=te.e.r;++Fe)if(!(ze[Fe]||{}).hidden){var Ue=make_json_row(E,te,Fe,me,T,S,Ce,ae);(Ue.isempty===!1||(T===1?ae.blankrows!==!1:ae.blankrows))&&(_e[Re++]=Ue.row)}return _e.length=Re,_e}var qreg=/"/g;function make_csv_row(E,r,v,T,w,S,I,H){for(var te=!0,ae=[],ie="",ce=encode_row(v),me=r.s.c;me<=r.e.c;++me)if(T[me]){var _e=H.dense?(E[v]||[])[me]:E[T[me]+ce];if(_e==null)ie="";else if(_e.v!=null){te=!1,ie=""+(H.rawNumbers&&_e.t=="n"?_e.v:format_cell(_e,null,H));for(var Re=0,Pe=0;Re!==ie.length;++Re)if((Pe=ie.charCodeAt(Re))===w||Pe===S||Pe===34||H.forceQuotes){ie='"'+ie.replace(qreg,'""')+'"';break}ie=="ID"&&(ie='"ID"')}else _e.f!=null&&!_e.F?(te=!1,ie="="+_e.f,ie.indexOf(",")>=0&&(ie='"'+ie.replace(qreg,'""')+'"')):ie="";ae.push(ie)}return H.blankrows===!1&&te?null:ae.join(I)}function sheet_to_csv(E,r){var v=[],T=r??{};if(E==null||E["!ref"]==null)return"";var w=safe_decode_range(E["!ref"]),S=T.FS!==void 0?T.FS:",",I=S.charCodeAt(0),H=T.RS!==void 0?T.RS:`
`,te=H.charCodeAt(0),ae=new RegExp((S=="|"?"\\|":S)+"+$"),ie="",ce=[];T.dense=Array.isArray(E);for(var me=T.skipHidden&&E["!cols"]||[],_e=T.skipHidden&&E["!rows"]||[],Re=w.s.c;Re<=w.e.c;++Re)(me[Re]||{}).hidden||(ce[Re]=encode_col(Re));for(var Pe=0,Ce=w.s.r;Ce<=w.e.r;++Ce)(_e[Ce]||{}).hidden||(ie=make_csv_row(E,w,Ce,ce,I,te,S,T),ie!=null&&(T.strip&&(ie=ie.replace(ae,"")),(ie||T.blankrows!==!1)&&v.push((Pe++?H:"")+ie)));return delete T.dense,v.join("")}function sheet_to_txt(E,r){r||(r={}),r.FS="	",r.RS=`
`;var v=sheet_to_csv(E,r);return v}function sheet_to_formulae(E){var r="",v,T="";if(E==null||E["!ref"]==null)return[];var w=safe_decode_range(E["!ref"]),S="",I=[],H,te=[],ae=Array.isArray(E);for(H=w.s.c;H<=w.e.c;++H)I[H]=encode_col(H);for(var ie=w.s.r;ie<=w.e.r;++ie)for(S=encode_row(ie),H=w.s.c;H<=w.e.c;++H)if(r=I[H]+S,v=ae?(E[ie]||[])[H]:E[r],T="",v!==void 0){if(v.F!=null){if(r=v.F,!v.f)continue;T=v.f,r.indexOf(":")==-1&&(r=r+":"+r)}if(v.f!=null)T=v.f;else{if(v.t=="z")continue;if(v.t=="n"&&v.v!=null)T=""+v.v;else if(v.t=="b")T=v.v?"TRUE":"FALSE";else if(v.w!==void 0)T="'"+v.w;else{if(v.v===void 0)continue;v.t=="s"?T="'"+v.v:T=""+v.v}}te[te.length]=r+"="+T}return te}function sheet_add_json(E,r,v){var T=v||{},w=+!T.skipHeader,S=E||{},I=0,H=0;if(S&&T.origin!=null)if(typeof T.origin=="number")I=T.origin;else{var te=typeof T.origin=="string"?decode_cell(T.origin):T.origin;I=te.r,H=te.c}var ae,ie={s:{c:0,r:0},e:{c:H,r:I+r.length-1+w}};if(S["!ref"]){var ce=safe_decode_range(S["!ref"]);ie.e.c=Math.max(ie.e.c,ce.e.c),ie.e.r=Math.max(ie.e.r,ce.e.r),I==-1&&(I=ce.e.r+1,ie.e.r=I+r.length-1+w)}else I==-1&&(I=0,ie.e.r=r.length-1+w);var me=T.header||[],_e=0;r.forEach(function(Pe,Ce){keys(Pe).forEach(function(Fe){(_e=me.indexOf(Fe))==-1&&(me[_e=me.length]=Fe);var Me=Pe[Fe],Ve="z",We="",ze=encode_cell({c:H+_e,r:I+Ce+w});ae=ws_get_cell_stub(S,ze),Me&&typeof Me=="object"&&!(Me instanceof Date)?S[ze]=Me:(typeof Me=="number"?Ve="n":typeof Me=="boolean"?Ve="b":typeof Me=="string"?Ve="s":Me instanceof Date?(Ve="d",T.cellDates||(Ve="n",Me=datenum(Me)),We=T.dateNF||table_fmt[14]):Me===null&&T.nullError&&(Ve="e",Me=0),ae?(ae.t=Ve,ae.v=Me,delete ae.w,delete ae.R,We&&(ae.z=We)):S[ze]=ae={t:Ve,v:Me},We&&(ae.z=We))})}),ie.e.c=Math.max(ie.e.c,H+me.length-1);var Re=encode_row(I);if(w)for(_e=0;_e<me.length;++_e)S[encode_col(_e+H)+Re]={t:"s",v:me[_e]};return S["!ref"]=encode_range(ie),S}function json_to_sheet(E,r){return sheet_add_json(null,E,r)}function ws_get_cell_stub(E,r,v){if(typeof r=="string"){if(Array.isArray(E)){var T=decode_cell(r);return E[T.r]||(E[T.r]=[]),E[T.r][T.c]||(E[T.r][T.c]={t:"z"})}return E[r]||(E[r]={t:"z"})}return typeof r!="number"?ws_get_cell_stub(E,encode_cell(r)):ws_get_cell_stub(E,encode_cell({r,c:v||0}))}function wb_sheet_idx(E,r){if(typeof r=="number"){if(r>=0&&E.SheetNames.length>r)return r;throw new Error("Cannot find sheet # "+r)}else if(typeof r=="string"){var v=E.SheetNames.indexOf(r);if(v>-1)return v;throw new Error("Cannot find sheet name |"+r+"|")}else throw new Error("Cannot find sheet |"+r+"|")}function book_new(){return{SheetNames:[],Sheets:{}}}function book_append_sheet(E,r,v,T){var w=1;if(!v)for(;w<=65535&&E.SheetNames.indexOf(v="Sheet"+w)!=-1;++w,v=void 0);if(!v||E.SheetNames.length>=65535)throw new Error("Too many worksheets");if(T&&E.SheetNames.indexOf(v)>=0){var S=v.match(/(^.*?)(\d+)$/);w=S&&+S[2]||0;var I=S&&S[1]||v;for(++w;w<=65535&&E.SheetNames.indexOf(v=I+w)!=-1;++w);}if(check_ws_name(v),E.SheetNames.indexOf(v)>=0)throw new Error("Worksheet with name |"+v+"| already exists!");return E.SheetNames.push(v),E.Sheets[v]=r,v}function book_set_sheet_visibility(E,r,v){E.Workbook||(E.Workbook={}),E.Workbook.Sheets||(E.Workbook.Sheets=[]);var T=wb_sheet_idx(E,r);switch(E.Workbook.Sheets[T]||(E.Workbook.Sheets[T]={}),v){case 0:case 1:case 2:break;default:throw new Error("Bad sheet visibility setting "+v)}E.Workbook.Sheets[T].Hidden=v}function cell_set_number_format(E,r){return E.z=r,E}function cell_set_hyperlink(E,r,v){return r?(E.l={Target:r},v&&(E.l.Tooltip=v)):delete E.l,E}function cell_set_internal_link(E,r,v){return cell_set_hyperlink(E,"#"+r,v)}function cell_add_comment(E,r,v){E.c||(E.c=[]),E.c.push({t:r,a:v||"SheetJS"})}function sheet_set_array_formula(E,r,v,T){for(var w=typeof r!="string"?r:safe_decode_range(r),S=typeof r=="string"?r:encode_range(r),I=w.s.r;I<=w.e.r;++I)for(var H=w.s.c;H<=w.e.c;++H){var te=ws_get_cell_stub(E,I,H);te.t="n",te.F=S,delete te.v,I==w.s.r&&H==w.s.c&&(te.f=v,T&&(te.D=!0))}return E}var utils={encode_col,encode_row,encode_cell,encode_range,decode_col,decode_row,split_cell,decode_cell,decode_range,format_cell,sheet_add_aoa,sheet_add_json,sheet_add_dom,aoa_to_sheet,json_to_sheet,table_to_sheet:parse_dom_table,table_to_book,sheet_to_csv,sheet_to_txt,sheet_to_json,sheet_to_html,sheet_to_formulae,sheet_to_row_object_array:sheet_to_json,sheet_get_cell:ws_get_cell_stub,book_new,book_append_sheet,book_set_sheet_visibility,cell_set_number_format,cell_set_hyperlink,cell_set_internal_link,cell_add_comment,sheet_set_array_formula,consts:{SHEET_VISIBLE:0,SHEET_HIDDEN:1,SHEET_VERY_HIDDEN:2}};const TableImport=({onFileData:E})=>{const[r,v]=reactExports.useState(null),[T,w]=reactExports.useState(""),[S,I]=reactExports.useState(!1),[H,te]=reactExports.useState(!1),[ae,ie]=reactExports.useState(""),[ce,me]=reactExports.useState(null),_e=["application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","text/csv"],Re=reactExports.useRef(null),Pe=reactExports.useCallback(ke=>{ke.preventDefault(),ke.stopPropagation(),I(!0)},[]),Ce=reactExports.useCallback(ke=>{ke.preventDefault(),ke.stopPropagation(),I(!1)},[]),Fe=reactExports.useCallback(ke=>{ke.preventDefault(),ke.stopPropagation()},[]),Me=async ke=>{if(_e.includes(ke.type)){v(ke),w(""),te(!0);try{const Ne=await ze(ke);me(Ne),E&&E(Ne)}catch(Ne){w("Error parsing file: "+Ne.message)}finally{te(!1)}}else v(null),w("Please select only XLS, XLSX or CSV files")},Ve=reactExports.useCallback(ke=>{ke.preventDefault(),ke.stopPropagation(),I(!1);const Ne=ke.dataTransfer.files[0];Ne&&Me(Ne)},[]),We=async ke=>{const Ne=ke.target.files[0];Ne&&Me(Ne)},ze=ke=>new Promise((Ne,Ge)=>{const Ie=new FileReader;Ie.onload=Le=>{try{const He=Le.target.result,Ct=readSync(He,{type:"array",codepage:65001}),Ze=Ct.SheetNames[0],Rt=Ct.Sheets[Ze],nt=utils.sheet_to_json(Rt,{raw:!1,defval:null,blankrows:!1,header:1});if(nt.length<2)throw new Error("File must contain headers and at least one data row");const nr=nt[0].map(Lt=>Lt?String(Lt).toLowerCase().trim().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9_\s]/g,"").replace(/\s+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,""):"");if(nr.some(Lt=>!Lt))throw new Error("Invalid or empty column headers found");if(new Set(nr).size!==nr.length)throw new Error("Duplicate column names found");const Wt=nt.slice(1).map(Lt=>{const qe={};return nr.forEach(($e,Be)=>{let Xe=Lt[Be];Xe===void 0||Xe===""?Xe=null:Xe=String(Xe).trim(),qe[$e]=Xe}),qe});Ne(Wt)}catch(He){Ge(new Error(`Error processing file: ${He.message}`))}},Ie.onerror=()=>Ge(new Error("Error reading file")),Ie.readAsArrayBuffer(ke)}),Ue=async()=>{if(!ae.trim()){w("Please enter a table name");return}if(!ce||ce.length===0){w("No data to import");return}te(!0),w("");try{const ke=ae.trim().toLowerCase().replace(/[^a-z0-9_\s]/g,"").replace(/\s+/g,"_").replace(/_+/g,"_").replace(/^_|_$/g,""),Ne=await tableService.importCSV(ke,ce);Ne.success?(w(""),me(null),ie(""),v(null),E==null||E({success:!0,tableName:ke,shouldReload:!0}),c.success("Data imported successfully")):w(Ne.error||"Error importing data")}catch(ke){console.error("Error importing data:",ke),c.error(ke.message||"Error importing data"),E==null||E({success:!1,error:ke.message})}finally{te(!1)}},je=()=>{var ke;(ke=Re.current)==null||ke.click()};return jsxRuntimeExports.jsxs("div",{className:"table-import",children:[jsxRuntimeExports.jsxs("div",{className:`drop-zone ${S?"dragging":""}`,onDrop:Ve,onDragOver:Fe,onDragEnter:Pe,onDragLeave:Ce,onClick:je,children:[jsxRuntimeExports.jsx("input",{ref:Re,type:"file",onChange:We,accept:".xls,.xlsx,.csv",className:"file-input"}),jsxRuntimeExports.jsx("div",{className:"drop-zone-content",children:H?jsxRuntimeExports.jsx("p",{children:"Processing file..."}):r?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("p",{children:["File selected: ",r.name]}),jsxRuntimeExports.jsxs("div",{className:"table-name-input",onClick:ke=>ke.stopPropagation(),children:[jsxRuntimeExports.jsx("input",{type:"text",value:ae,onChange:ke=>ie(ke.target.value),placeholder:"Enter table name",disabled:H}),jsxRuntimeExports.jsx("button",{onClick:Ue,disabled:!ae.trim()||H,children:"Import"})]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"upload-icon",children:jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:jsxRuntimeExports.jsx("path",{d:"M12 5v14M5 12l7-7 7 7"})})}),jsxRuntimeExports.jsx("p",{children:"Click here or drag & drop your file to import"}),jsxRuntimeExports.jsx("p",{className:"file-types",children:"Supported formats: XLS, XLSX, CSV"})]})})]}),T&&jsxRuntimeExports.jsx("div",{className:"error-message",children:T}),ce&&jsxRuntimeExports.jsxs("div",{className:"preview-section",onClick:ke=>ke.stopPropagation(),children:[jsxRuntimeExports.jsx("h3",{children:"Preview"}),jsxRuntimeExports.jsxs("div",{className:"preview-table",children:[jsxRuntimeExports.jsxs("table",{children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsx("tr",{children:Object.keys(ce[0]).map((ke,Ne)=>jsxRuntimeExports.jsx("th",{children:ke},Ne))})}),jsxRuntimeExports.jsx("tbody",{children:ce.slice(0,5).map((ke,Ne)=>jsxRuntimeExports.jsx("tr",{children:Object.values(ke).map((Ge,Ie)=>jsxRuntimeExports.jsx("td",{children:Ge===null?"":String(Ge)},Ie))},Ne))})]}),ce.length>5&&jsxRuntimeExports.jsxs("p",{className:"preview-note",children:["Showing first 5 rows of ",ce.length," total rows"]})]})]})]})},AddEntryModal=({isOpen:E,onClose:r,table:v,onSubmit:T})=>{const[w,S]=reactExports.useState({}),[I,H]=reactExports.useState({}),[te,ae]=reactExports.useState(!1);if(reactExports.useEffect(()=>{if(E){const Re={};v.columns.forEach(Pe=>{Pe.isPrimary||(Re[Pe.name]="")}),S(Re),H({})}},[E,v]),!E)return null;const ie=()=>{const Re={};return v.columns.forEach(Pe=>{if(!Pe.isPrimary&&!w[Pe.name]&&Pe.required)Re[Pe.name]="This field is required";else if(w[Pe.name])switch(Pe.type.toUpperCase()){case"INTEGER":Number.isInteger(Number(w[Pe.name]))||(Re[Pe.name]="Must be a whole number");break;case"DECIMAL":isNaN(Number(w[Pe.name]))&&(Re[Pe.name]="Must be a valid number");break;case"DATE":isNaN(Date.parse(w[Pe.name]))&&(Re[Pe.name]="Must be a valid date");break}}),Re},ce=async Re=>{Re.preventDefault();const Pe=ie();if(Object.keys(Pe).length===0){ae(!0);try{await T(w),r()}catch{H({submit:"Failed to submit data. Please try again."})}finally{ae(!1)}}else H(Pe)},me=(Re,Pe)=>{S(Ce=>({...Ce,[Re]:Pe})),I[Re]&&H(Ce=>({...Ce,[Re]:void 0}))},_e=Re=>{const Pe={id:Re.name,name:Re.name,value:w[Re.name]||"",onChange:Ce=>me(Re.name,Ce.target.value),className:`form-input ${I[Re.name]?"error":""}`,required:Re.required,"aria-invalid":I[Re.name]?"true":"false","aria-describedby":I[Re.name]?`${Re.name}-error`:void 0};switch(Re.type.toUpperCase()){case"INTEGER":return jsxRuntimeExports.jsx("input",{type:"number",step:"1",...Pe});case"DECIMAL":return jsxRuntimeExports.jsx("input",{type:"number",step:"0.01",...Pe});case"BOOLEAN":return jsxRuntimeExports.jsxs("select",{...Pe,children:[jsxRuntimeExports.jsx("option",{value:"",children:"Select..."}),jsxRuntimeExports.jsx("option",{value:"true",children:"Yes"}),jsxRuntimeExports.jsx("option",{value:"false",children:"No"})]});case"DATE":return jsxRuntimeExports.jsx("input",{type:"date",...Pe});case"TIMESTAMP":return jsxRuntimeExports.jsx("input",{type:"datetime-local",...Pe});case"TEXT":return jsxRuntimeExports.jsx("textarea",{...Pe,rows:"3"});default:return jsxRuntimeExports.jsx("input",{type:"text",...Pe})}};return jsxRuntimeExports.jsx("div",{className:"modal-overlay",onClick:Re=>Re.target.className==="modal-overlay"&&r(),children:jsxRuntimeExports.jsxs("div",{className:"modal-content",children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsxs("h3",{children:["Add New Entry to ",v.name]}),jsxRuntimeExports.jsx("button",{className:"close-button",onClick:r,"aria-label":"Close modal",children:"×"})]}),jsxRuntimeExports.jsxs("form",{onSubmit:ce,noValidate:!0,children:[I.submit&&jsxRuntimeExports.jsx("div",{className:"error-banner",children:I.submit}),jsxRuntimeExports.jsx("div",{className:"form-fields",children:v.columns.map(Re=>!Re.isPrimary&&jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsxs("label",{htmlFor:Re.name,children:[Re.name,Re.required&&jsxRuntimeExports.jsx("span",{className:"required",children:"*"}),jsxRuntimeExports.jsxs("span",{className:"type-hint",children:["(",Re.type,")"]})]}),_e(Re),I[Re.name]&&jsxRuntimeExports.jsx("div",{className:"error-message",id:`${Re.name}-error`,children:I[Re.name]})]},Re.name))}),jsxRuntimeExports.jsxs("div",{className:"modal-actions",children:[jsxRuntimeExports.jsx("button",{type:"button",className:"btn-secondary",onClick:r,disabled:te,children:"Cancel"}),jsxRuntimeExports.jsx("button",{type:"submit",className:"btn-primary",disabled:te,children:te?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"spinner"}),"Saving..."]}):"Add Entry"})]})]})]})})},DataSection=()=>{const[E,r]=reactExports.useState(null),[v,T]=reactExports.useState("table"),[w,S]=reactExports.useState([]),[I,H]=reactExports.useState(!1),[te,ae]=reactExports.useState(!1),[ie,ce]=reactExports.useState(!1),[me,_e]=reactExports.useState(!1),[Re,Pe]=reactExports.useState({}),[Ce,Fe]=reactExports.useState(null),[Me,Ve]=reactExports.useState(!1),[We,ze]=reactExports.useState(!1),[Ue,je]=reactExports.useState(!0),[ke,Ne]=reactExports.useState(!1),[Ge,Ie]=reactExports.useState(!1),Le=reactExports.useCallback(async(qe=null)=>{const $e=qe||(E==null?void 0:E.name);if($e){H(!0);try{console.log("Loading data for table:",$e);const Be=await tableService.getData($e,Re);if(console.log("Received data from API:",Be),!Be){console.error("No response from API"),S([]);return}const Xe=Be.data||[];console.log("Setting table data with",Xe.length,"rows"),S(Xe),qe&&(console.log("🔄 Updating selectedTable.name from",E==null?void 0:E.name,"to",qe),r(rt=>({...rt,name:qe})))}catch(Be){console.error("Error loading table data:",Be),S([])}finally{H(!1)}}},[E,Re]);reactExports.useEffect(()=>{E&&Object.keys(Re).length>0&&Le()},[Re,Le]);const He=async qe=>{console.log("Selected table:",qe),r(qe),Pe({}),ze(!0),je(!0);try{H(!0);const $e=await tableService.getData(qe.name);if(console.log("Received data from API:",$e),!$e){console.error("No response from API"),S([]);return}const Be=$e.data||[];console.log("Setting table data with",Be.length,"rows"),S(Be)}catch($e){console.error("Error loading table data:",$e),S([])}finally{H(!1)}},Ct=qe=>{console.log("Selected row:",qe)},Ze=()=>{T(v==="table"?"card":"table")},Rt=()=>{if(!w.length)return;const qe=[Object.keys(w[0]).join(","),...w.map(rt=>Object.values(rt).join(","))].join(`
`),$e=new Blob([qe],{type:"text/csv"}),Be=window.URL.createObjectURL($e),Xe=document.createElement("a");Xe.href=Be,Xe.download=`${(E==null?void 0:E.name)||"data"}_export.csv`,Xe.click(),window.URL.revokeObjectURL(Be)},nt=async(qe,$e)=>{if(!qe||!qe.length||!$e){console.error("Data and table name are required");return}H(!0);try{const Be=Math.min(10,qe.length),Xe=qe.slice(0,Be),rt=Object.keys(qe[0]).filter(Ut=>Ut.toLowerCase()!=="id").map(Ut=>{const hr=Xe.map(yr=>yr[Ut]).filter(yr=>yr!=null&&yr!=="");let pt="varchar(255)";if(hr.length>0){const yr=hr.every(sr=>!isNaN(sr)&&!isNaN(parseFloat(sr))),vr=yr&&hr.every(sr=>Number.isInteger(parseFloat(sr))),wr=hr.every(sr=>!isNaN(Date.parse(sr))),ir=Math.max(...hr.map(sr=>String(sr).length));vr?pt="int":yr?pt="decimal(10,2)":wr?pt="date":ir>255?pt="text":pt=`varchar(${Math.min(ir*2,255)})`}return{name:Ut.toLowerCase().replace(/[^a-z0-9_]/g,"_"),type:pt,nullable:!0}}),Qe={name:$e.toLowerCase().replace(/[^a-z0-9_]/g,"_"),columns:[{name:"id",type:"INT",isPrimary:!0,autoIncrement:!0,nullable:!1},...rt]};await tableService.createTable(Qe);const vt=50;for(let Ut=0;Ut<qe.length;Ut+=vt){const pt=qe.slice(Ut,Ut+vt).map(yr=>{const vr={};return rt.forEach(({name:wr,type:ir})=>{let sr=yr[Object.keys(yr).find(kt=>kt.toLowerCase().replace(/[^a-z0-9_]/g,"_")===wr)];if(sr!=null&&sr!==""){if(ir==="int")sr=parseInt(sr);else if(ir==="decimal(10,2)")sr=parseFloat(sr);else if(ir==="date"){const kt=new Date(sr);isNaN(kt)||(sr=kt.toISOString().split("T")[0])}}else sr=null;vr[wr]=sr}),vr});await tableService.insertData($e,pt)}_e(!1);const Dt={name:$e,columns:Qe.columns};r(Dt)}catch(Be){console.error("Error creating table:",Be),Fe(Be.message||"Error creating table")}finally{H(!1)}},nr=async qe=>{if(E)try{await tableService.insertData(E.name,qe),Le(),ce(!1)}catch($e){throw console.error("Error adding entry:",$e),$e}},Je=async()=>{H(!0);try{const qe=await tableService.getData(E.name,Re);S(qe.data||[])}catch(qe){console.error("Error refreshing table data:",qe)}finally{H(!1)}},Wt=async(qe,$e,Be)=>{if(E)try{const Xe=E.name;console.log("Updating cell:",{id:qe,column:$e,value:Be,table:Xe});const rt=await tableService.updateData(Xe,qe,$e,Be);return S(Qe=>Qe.map(vt=>vt.id===qe?{...vt,[$e]:Be}:vt)),rt}catch(Xe){throw console.error("Error updating cell:",Xe),Xe}},Lt=async()=>{try{H(!0);const qe=E==null?void 0:E.name,$e=await tableService.getTables();if(qe){const Be=$e.find(Xe=>Xe.name===qe);r(Be||null),Be&&await Le()}c.success("Data refreshed successfully")}catch(qe){console.error("Error reloading data:",qe),c.error("Failed to refresh data")}finally{H(!1)}};return jsxRuntimeExports.jsxs("div",{className:"data-section",children:[jsxRuntimeExports.jsxs("div",{className:"data-section-header",children:[jsxRuntimeExports.jsxs("div",{className:"header-top",children:[jsxRuntimeExports.jsxs("div",{className:"header-title",children:[jsxRuntimeExports.jsx("h2",{children:"Base de datos"}),jsxRuntimeExports.jsx("button",{className:"reload-btn",onClick:Lt,title:"Reload data",children:"↻"})]}),jsxRuntimeExports.jsxs("button",{className:"btn-primary import-btn",onClick:()=>Ve(!0),children:[jsxRuntimeExports.jsx("svg",{className:"btn-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5m-9-1.5h7.5m-7.5 3h7.5m3-3v3m0 0v3m0-3h-3m3 0h3M3 9l3-3m0 0l3 3m-3-3v12"})}),"Importar csv"]})]}),jsxRuntimeExports.jsx("div",{className:"header-actions",children:E&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("button",{className:"btn-primary add-btn",onClick:()=>ce(!0),disabled:I,children:[jsxRuntimeExports.jsx("svg",{className:"btn-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"})}),"Agregar Entrada"]}),jsxRuntimeExports.jsx("button",{className:"btn-icon-only",onClick:Ze,title:v==="table"?"Switch to Card View":"Switch to Table View",disabled:I,children:v==="table"?jsxRuntimeExports.jsx("svg",{className:"btn-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"})}):jsxRuntimeExports.jsx("svg",{className:"btn-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z"})})}),jsxRuntimeExports.jsx("button",{className:"btn-icon-only",onClick:Rt,title:"Export as CSV",disabled:!E||I||!w.length,children:jsxRuntimeExports.jsx("svg",{className:"btn-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:1.5,children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3"})})})]})})]}),jsxRuntimeExports.jsxs("div",{className:"data-section-content",children:[jsxRuntimeExports.jsxs("div",{className:"compact-managers-panel",children:[jsxRuntimeExports.jsxs("div",{className:`manager-panel ${We?"collapsed":"expanded"}`,children:[jsxRuntimeExports.jsxs("div",{className:"panel-header",children:[jsxRuntimeExports.jsxs("div",{className:"panel-title",onClick:()=>ze(!We),children:[jsxRuntimeExports.jsx("span",{className:"panel-icon",children:"📋"}),jsxRuntimeExports.jsx("span",{children:"Tablas"}),E&&jsxRuntimeExports.jsxs("span",{className:"selected-indicator",children:["• ",E.name]})]}),jsxRuntimeExports.jsxs("div",{className:"panel-actions",children:[jsxRuntimeExports.jsx("button",{className:"action-btn create-table-btn",onClick:qe=>{qe.stopPropagation(),_e(!0)},title:"Crear nueva tabla",children:"➕"}),jsxRuntimeExports.jsx("button",{className:"collapse-btn",onClick:()=>ze(!We),children:We?"▼":"▲"})]})]}),!We&&jsxRuntimeExports.jsx("div",{className:"panel-content",children:jsxRuntimeExports.jsx(TableManager,{onTableSelect:He})})]}),E&&jsxRuntimeExports.jsxs("div",{className:`manager-panel ${Ue?"collapsed":"expanded"}`,children:[jsxRuntimeExports.jsxs("div",{className:"panel-header",children:[jsxRuntimeExports.jsxs("div",{className:"panel-title",onClick:()=>je(!Ue),children:[jsxRuntimeExports.jsx("span",{className:"panel-icon",children:"⚙️"}),jsxRuntimeExports.jsx("span",{children:"Columnas"}),jsxRuntimeExports.jsxs("span",{className:"table-name",children:["(",E.name,")"]})]}),jsxRuntimeExports.jsxs("div",{className:"panel-actions",children:[jsxRuntimeExports.jsx("button",{className:"action-btn add-column-btn",onClick:qe=>{qe.stopPropagation(),Ne(!0)},title:"Agregar columna",children:"➕"}),jsxRuntimeExports.jsx("button",{className:"action-btn edit-columns-btn",onClick:qe=>{qe.stopPropagation(),Ie(!0)},title:"Editar columnas",children:"✏️"}),jsxRuntimeExports.jsx("button",{className:"collapse-btn",onClick:()=>je(!Ue),children:Ue?"▼":"▲"})]})]}),!Ue&&jsxRuntimeExports.jsx("div",{className:"panel-content",children:jsxRuntimeExports.jsx(ColumnManager,{selectedTable:E,onOrderChange:Je})})]})]}),E&&jsxRuntimeExports.jsx("div",{className:"data-display-container",children:I?jsxRuntimeExports.jsx("div",{className:"loading-state",children:"Loading..."}):v==="table"?jsxRuntimeExports.jsx(DataTable,{data:w,onRowClick:Ct,onCellUpdate:Wt,onRefresh:Le,tableName:E.name}):jsxRuntimeExports.jsx(TableCardView,{data:w,onCardClick:Ct})})]}),Me&&jsxRuntimeExports.jsx("div",{className:"import-modal",children:jsxRuntimeExports.jsxs("div",{className:"import-modal-content",children:[jsxRuntimeExports.jsx("button",{className:"close-button",onClick:()=>Ve(!1),children:"×"}),jsxRuntimeExports.jsx(TableImport,{onFileData:qe=>{qe.success&&(qe.shouldReload&&Lt(),Ve(!1))}})]})}),ie&&E&&jsxRuntimeExports.jsx(AddEntryModal,{isOpen:ie,onClose:()=>ce(!1),table:E,onSubmit:nr}),me&&jsxRuntimeExports.jsx("div",{className:"modal-overlay",onClick:()=>_e(!1),children:jsxRuntimeExports.jsxs("div",{className:"modal-content",onClick:qe=>qe.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsx("h3",{children:"Create New Table"}),jsxRuntimeExports.jsx("button",{className:"close-button",onClick:()=>_e(!1),children:"×"})]}),jsxRuntimeExports.jsx("div",{className:"modal-body",children:jsxRuntimeExports.jsx(TableImport,{onFileData:nt,mode:"create"})})]})})]})},sendWelcomeEmail=async(E,r)=>{try{const v=await fetch(`${API_URL}/email/send-welcome`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({to:r.email,gptResponse:E,...r})});if(!v.ok){const w=await v.json();throw new Error(w.error||"Failed to send email")}const T=await v.json();return console.log("Email sent successfully:",T),T}catch(v){throw console.error("Error sending email:",v),v}},TestGPT=()=>{var Rt;const[E,r]=reactExports.useState(""),[v,T]=reactExports.useState(""),[w,S]=reactExports.useState(!1),[I,H]=reactExports.useState([]),[te,ae]=reactExports.useState(""),[ie,ce]=reactExports.useState(null),[me,_e]=reactExports.useState([]),[Re,Pe]=reactExports.useState(""),[Ce,Fe]=reactExports.useState({to:"",subject:"",showConfig:!1}),Me="defaultUser",[Ve,We]=reactExports.useState(""),[ze,Ue]=reactExports.useState(null);reactExports.useEffect(()=>{je(),ke()},[]);const je=async()=>{try{const nt=await tableService.getTables();H(nt)}catch(nt){console.error("Error loading tables:",nt)}},ke=async()=>{try{const nt=await fetch(`${API_URL}/prospeccion/${Me}`);if(!nt.ok)throw new Error("Failed to load prospeccion cards");const nr=await nt.json();_e(nr)}catch(nt){console.error("Error loading prospeccion cards:",nt)}},Ne=async nt=>{const nr=nt.target.value;if(ae(nr),Pe(""),We(""),Ue(null),nr)try{const Je=await tableService.getData(nr);ce(Je)}catch(Je){console.error("Error loading table data:",Je),ce(null)}else ce(null)},Ge=nt=>{const nr=nt.target.value;Pe(nr),ae(""),ce(null)},Ie=nt=>{if(We(nt),!ie||!ie.data)return;if(!nt.trim()){Ue(null);return}const nr=nt.toLowerCase().split(" "),Je=ie.data.filter(Wt=>nr.every(Lt=>Object.values(Wt).some(qe=>String(qe).toLowerCase().includes(Lt))));Ue({...ie,data:Je})},Le=async nt=>{if(nt.preventDefault(),!!E.trim()){S(!0);try{let nr=`Eres un asistente especializado en seguros que analiza información y genera respuestas detalladas.
      
      Si la información proviene de una tabla de la base de datos, genera un email siguiendo esta estructura:
      1. Saludo personalizado
      2. Mensaje de bienvenida
      3. Explicación detallada del seguro y sus beneficios
      4. Conclusión y próximos pasos
      
      Si la información proviene de una tarjeta de prospección, analiza y proporciona:
      1. Puntos clave identificados
      2. Oportunidades potenciales
      3. Pasos siguientes recomendados
      4. Factores de riesgo a considerar
      
      Usa el siguiente formato para resaltar elementos importantes:
      - Usa **texto en negrita** para títulos y elementos importantes
      - Usa *texto en cursiva* para énfasis moderado
      - Usa guiones (-) para listas
      
      El contenido debe ser en español, profesional y enfocado en el valor para el negocio.`,Je=E;const Wt=ze||ie;if(Wt&&Wt.data.length>0)Je=`Base de datos '${te}' contiene: ${JSON.stringify(Wt.data,null,2)}

Basado en estos datos, ${E}`;else if(Re){const Be=me.find(Xe=>Xe.id===parseInt(Re));Be&&(Je=`Tarjeta de prospección contiene: ${Be.content}

Analiza esta información y ${E}`)}const Lt=await fetch(`${API_URL}/gpt/generate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:Je,context:{systemPrompt:nr,selectedTable:te,selectedCard:Re},model:"gpt-4o-mini"})});if(!Lt.ok){const Be=await Lt.json();throw new Error(Be.error||"Failed to generate GPT response")}const qe=await Lt.json(),$e=qe.response||qe.content||"No response generated";T($e),Re&&(await fetch(`${API_URL}/prospeccion/${Me}/${Re}/analyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({analysis:$e})}),ke())}catch(nr){console.error("Error:",nr),T(`Error: ${nr.message||"No se pudo obtener respuesta de GPT"}`)}finally{S(!1)}}},He=async()=>{var nt,nr,Je,Wt;if(!Ce.to||!Ce.subject){alert("Por favor completa el destinatario y asunto del email");return}try{await sendWelcomeEmail(v,{to:Ce.to,subject:Ce.subject,clientName:((nt=ie==null?void 0:ie.data[0])==null?void 0:nt.nombre)||"Cliente",policyNumber:((nr=ie==null?void 0:ie.data[0])==null?void 0:nr.poliza)||"POL-"+new Date().getTime(),insuranceType:((Je=ie==null?void 0:ie.data[0])==null?void 0:Je.tipo)||"Seguro",startDate:new Date().toLocaleDateString("es-MX"),coverage:((Wt=ie==null?void 0:ie.data[0])==null?void 0:Wt.cobertura)||"Por definir",insuranceCompany:"CASIN Seguros",emergencyPhone:"800-123-4567",supportEmail:"soporte@casinseguros.com.mx",policyUrl:"#",companyAddress:"Av. Reforma 123, CDMX, México",companyName:"CASIN Seguros",currentYear:new Date().getFullYear(),gptResponse:v}),alert("Email enviado con éxito"),Fe({...Ce,showConfig:!1})}catch(Lt){console.error("Error al enviar email:",Lt),alert("Error al enviar el email")}},Ct=()=>{r(""),T(""),ae(""),Pe(""),ce(null),Fe({to:"",subject:"",showConfig:!1})},Ze=nt=>{if(!nt||!nt.length)return null;const nr=Object.keys(nt[0]);return jsxRuntimeExports.jsx("div",{className:"table-preview-wrapper",children:jsxRuntimeExports.jsxs("table",{className:"preview-table",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsx("tr",{children:nr.map(Je=>jsxRuntimeExports.jsx("th",{children:Je},Je))})}),jsxRuntimeExports.jsx("tbody",{children:nt.map((Je,Wt)=>jsxRuntimeExports.jsx("tr",{children:nr.map(Lt=>jsxRuntimeExports.jsx("td",{children:Je[Lt]!==null?String(Je[Lt]):"-"},`${Wt}-${Lt}`))},Wt))})]})})};return jsxRuntimeExports.jsxs("div",{className:"testgpt-container",children:[jsxRuntimeExports.jsxs("div",{className:"testgpt-header",children:[jsxRuntimeExports.jsx("h2",{children:"Asistente GPT"}),jsxRuntimeExports.jsx("p",{className:"subtitle",children:"Analiza datos y genera contenido personalizado"})]}),jsxRuntimeExports.jsxs("div",{className:"testgpt-content",children:[jsxRuntimeExports.jsxs("div",{className:"data-selector",children:[jsxRuntimeExports.jsxs("div",{className:"selector-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"table-select",children:"Datos de tabla:"}),jsxRuntimeExports.jsxs("select",{id:"table-select",value:te,onChange:Ne,className:"data-select",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Ninguna"}),I.map(nt=>jsxRuntimeExports.jsx("option",{value:nt.name,children:nt.name},nt.name))]})]}),jsxRuntimeExports.jsxs("div",{className:"selector-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"card-select",children:"Tarjeta de prospección:"}),jsxRuntimeExports.jsxs("select",{id:"card-select",value:Re,onChange:Ge,className:"data-select",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Ninguna"}),me.map(nt=>jsxRuntimeExports.jsx("option",{value:nt.id,children:nt.title},nt.id))]})]})]}),ie&&jsxRuntimeExports.jsxs("div",{className:"data-preview",children:[jsxRuntimeExports.jsxs("div",{className:"data-preview-header",children:[jsxRuntimeExports.jsx("h3",{children:"Datos de Tabla:"}),jsxRuntimeExports.jsx("input",{type:"text",value:Ve,onChange:nt=>Ie(nt.target.value),placeholder:"Buscar en los datos...",className:"data-search-input"})]}),ze&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[Ze(ze.data),jsxRuntimeExports.jsxs("div",{className:"data-filter-info",children:["Mostrando ",ze.data.length," de ",ie.data.length," registros"]})]}),!ze&&jsxRuntimeExports.jsx("div",{className:"search-prompt",children:jsxRuntimeExports.jsx("p",{children:"Realiza una búsqueda en los datos para ver resultados 👆 "})})]}),Re&&jsxRuntimeExports.jsxs("div",{className:"data-preview",children:[jsxRuntimeExports.jsx("h3",{children:"Contenido de Tarjeta:"}),jsxRuntimeExports.jsx("pre",{className:"data-content",children:((Rt=me.find(nt=>nt.id===parseInt(Re)))==null?void 0:Rt.content)||""})]}),(ze||Re)&&jsxRuntimeExports.jsxs("form",{onSubmit:Le,className:"testgpt-form",children:[jsxRuntimeExports.jsxs("div",{className:"input-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"prompt-input",children:"¿Qué análisis necesitas?"}),jsxRuntimeExports.jsx("textarea",{id:"prompt-input",value:E,onChange:nt=>r(nt.target.value),placeholder:te?"Ejemplo: Genera un mensaje de bienvenida basado en estos datos...":"Ejemplo: Analiza esta información de prospección y sugiere próximos pasos...",rows:4,className:"testgpt-input"})]}),jsxRuntimeExports.jsxs("div",{className:"button-group",children:[jsxRuntimeExports.jsx("button",{type:"submit",className:"testgpt-submit",disabled:w||!E.trim(),children:w?"Procesando...":"Analizar"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:Ct,className:"testgpt-clear",children:"Limpiar"})]})]}),v&&jsxRuntimeExports.jsxs("div",{className:"testgpt-response",children:[jsxRuntimeExports.jsx("h3",{children:"Respuesta GPT:"}),jsxRuntimeExports.jsx("div",{className:"response-content",children:v}),jsxRuntimeExports.jsxs("div",{className:"email-section",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Fe({...Ce,showConfig:!Ce.showConfig}),className:"testgpt-submit email-toggle-btn",children:Ce.showConfig?"Ocultar Configuración Email":"Configurar Email"}),Ce.showConfig&&jsxRuntimeExports.jsxs("div",{className:"email-config",children:[jsxRuntimeExports.jsxs("div",{className:"email-input-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"email-to",children:"Destinatario:"}),jsxRuntimeExports.jsx("input",{id:"email-to",type:"email",value:Ce.to,onChange:nt=>Fe({...Ce,to:nt.target.value}),placeholder:"correo@ejemplo.com",className:"email-input"})]}),jsxRuntimeExports.jsxs("div",{className:"email-input-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"email-subject",children:"Asunto:"}),jsxRuntimeExports.jsx("input",{id:"email-subject",type:"text",value:Ce.subject,onChange:nt=>Fe({...Ce,subject:nt.target.value}),placeholder:"Asunto del email",className:"email-input"})]}),jsxRuntimeExports.jsx("button",{onClick:He,className:"testgpt-submit send-email-btn",disabled:!Ce.to||!Ce.subject,children:"Enviar Email"})]})]})]})]})]})},ROOT_FOLDER_ID="1rDGEXJg-8fssJ_atzDNHeJr6BouwGCCo",FileIcon=({mimeType:E})=>{switch(E){case"application/vnd.google-apps.folder":return"📁";case"application/pdf":return"📄";case"application/vnd.google-apps.spreadsheet":return"📊";case"application/vnd.google-apps.document":return"📝";case"image/jpeg":case"image/png":return"🖼️";default:return"📎"}},BreadcrumbPath=({folderStack:E,onNavigate:r})=>jsxRuntimeExports.jsxs("div",{className:"folder-path",children:[jsxRuntimeExports.jsxs("span",{onClick:()=>r(null),className:"path-item",title:"Ir a la carpeta raíz",children:[jsxRuntimeExports.jsx("span",{className:"icon",children:"🏠"}),jsxRuntimeExports.jsx("span",{children:"Inicio"})]}),E.map((v,T)=>jsxRuntimeExports.jsxs("span",{className:"path-item",children:[jsxRuntimeExports.jsx("span",{className:"separator",children:"›"}),jsxRuntimeExports.jsx("span",{onClick:()=>r(T),className:"path-link",title:`Ir a ${v.name}`,children:v.name})]},T))]}),Modal=({title:E,children:r,onClose:v,actions:T})=>jsxRuntimeExports.jsx("div",{className:"modal-backdrop",onClick:v,children:jsxRuntimeExports.jsxs("div",{className:"modal-content",onClick:w=>w.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsx("span",{children:E}),jsxRuntimeExports.jsx("button",{className:"modal-close",onClick:v,children:"×"})]}),jsxRuntimeExports.jsx("div",{className:"modal-body",children:r}),jsxRuntimeExports.jsx("div",{className:"modal-actions",children:T})]})}),Drive=()=>{const[E,r]=reactExports.useState([]),[v,T]=reactExports.useState(null),[w,S]=reactExports.useState([]),[I,H]=reactExports.useState(!1),[te,ae]=reactExports.useState(null),[ie,ce]=reactExports.useState(""),[me,_e]=reactExports.useState(null),[Re,Pe]=reactExports.useState(null),[Ce,Fe]=reactExports.useState(!1),[Me,Ve]=reactExports.useState(!1),[We,ze]=reactExports.useState(""),[Ue,je]=reactExports.useState(!1),[ke,Ne]=reactExports.useState(""),Ge=reactExports.useRef(null),Ie=async(Lt=null)=>{var qe,$e,Be,Xe;try{H(!0),ae(null);const rt=Lt||ROOT_FOLDER_ID;console.log("Obteniendo archivos de:",rt);const Qe=await axios.get(`${API_URL}/drive/files`,{params:{folderId:rt,fields:"files(id, name, mimeType, webViewLink)"}});if(!Qe.data.files){console.warn("No hay array de archivos en la respuesta:",Qe.data),ae("Formato de respuesta inválido del servidor"),r([]);return}const vt=Qe.data.files.map(Dt=>({...Dt,isFolder:Dt.mimeType==="application/vnd.google-apps.folder"}));vt.length===1&&!vt[0].isFolder?ae(`"${vt[0].name}" es un archivo, no una carpeta. Puedes verlo haciendo clic en él.`):vt.length===0&&ae("No se encontraron archivos. La carpeta podría estar vacía o no tienes acceso a ella."),r(vt)}catch(rt){console.error("Detalles del error:",{message:rt.message,response:(qe=rt.response)==null?void 0:qe.data,status:($e=rt.response)==null?void 0:$e.status}),ae(((Xe=(Be=rt.response)==null?void 0:Be.data)==null?void 0:Xe.error)||"Error al obtener los archivos. Por favor, asegúrate de que la cuenta de servicio tiene acceso.")}finally{H(!1)}},Le=reactExports.useMemo(()=>ke?E.filter(Lt=>Lt.name.toLowerCase().includes(ke.toLowerCase())):E,[E,ke]),He=async()=>{var Lt,qe,$e,Be;try{H(!0),ae(null),console.log("Probando conexión con Google Drive...");const Xe=await axios.get(`${API_URL}/drive/test`);console.log("Respuesta completa del test:",Xe.data),_e(Xe.data.status),Xe.data.status==="Connected"?(console.log("Conexión exitosa, obteniendo archivos raíz..."),await Ie()):(console.warn('Conectado pero el estado no es "Connected":',Xe.data.status),ae("Estado de conexión inesperado"))}catch(Xe){console.error("Detalles del error de Drive:",{message:Xe.message,response:(Lt=Xe.response)==null?void 0:Lt.data,status:(qe=Xe.response)==null?void 0:qe.status}),ae(((Be=($e=Xe.response)==null?void 0:$e.data)==null?void 0:Be.error)||"Error al conectar con Google Drive"),_e("Error")}finally{H(!1)}};reactExports.useEffect(()=>{He()},[]),reactExports.useEffect(()=>{me==="Connected"&&Ie(v)},[v,me]);const Ct=async Lt=>{S([...w,{id:v,name:Lt.name}]),T(Lt.id),await Ie(Lt.id)},Ze=async()=>{if(w.length>0){const Lt=[...w],qe=Lt.pop();S(Lt),T((qe==null?void 0:qe.id)||null),await Ie((qe==null?void 0:qe.id)||null)}},Rt=async()=>{var Lt,qe;if(ie.trim())try{H(!0),ae(null);const $e=ie.trim();await axios.post(`${API_URL}/drive/folders`,{name:$e,parentId:v||ROOT_FOLDER_ID}),ce(""),je(!1),await Ie(v)}catch($e){console.error("Error al crear carpeta:",$e),ae(((qe=(Lt=$e.response)==null?void 0:Lt.data)==null?void 0:qe.error)||"Error al crear la carpeta. Por favor, intenta de nuevo.")}finally{H(!1)}},nt=async()=>{try{H(!0),ae(null),await axios.delete(`${API_URL}/drive/files/${Re.id}`),Fe(!1),Pe(null),Ie(v)}catch(Lt){ae("Failed to delete file"),console.error("Error deleting file:",Lt)}finally{H(!1)}},nr=async()=>{if(We.trim())try{H(!0),ae(null),await axios.patch(`${API_URL}/drive/files/${Re.id}`,{name:We}),Ve(!1),Pe(null),ze(""),Ie(v)}catch(Lt){ae("Failed to rename file"),console.error("Error renaming file:",Lt)}finally{H(!1)}},Je=()=>{Ge.current.click()},Wt=async Lt=>{const qe=Lt.target.files[0];if(qe)try{H(!0),ae(null);const $e=new FormData;if($e.append("file",qe),$e.append("folderId",v||ROOT_FOLDER_ID),!(await fetch(`${API_URL}/drive/upload`,{method:"POST",body:$e})).ok)throw new Error("Upload failed");await Ie(v)}catch($e){console.error("Error uploading file:",$e),ae("Failed to upload file. Please try again.")}finally{H(!1),Ge.current&&(Ge.current.value="")}};return jsxRuntimeExports.jsxs("div",{className:"drive-container",children:[jsxRuntimeExports.jsxs("div",{className:"drive-header",children:[jsxRuntimeExports.jsxs("h2",{children:[jsxRuntimeExports.jsx("span",{className:"header-icon",children:"📂"}),"Drive"]}),jsxRuntimeExports.jsxs("div",{className:"header-actions",children:[jsxRuntimeExports.jsxs("div",{className:"search-container",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Buscar archivos...",className:"search-input",value:ke,onChange:Lt=>Ne(Lt.target.value)}),ke&&jsxRuntimeExports.jsx("button",{className:"search-clear",onClick:()=>Ne(""),children:"✕"})]}),jsxRuntimeExports.jsx("input",{type:"file",ref:Ge,className:"upload-input",onChange:Wt,disabled:I}),jsxRuntimeExports.jsxs("button",{className:"upload-button",onClick:Je,disabled:I,title:"Subir un archivo a la carpeta actual",children:[jsxRuntimeExports.jsx("span",{className:"button-icon",children:"📤"}),I?"Subiendo...":"Subir"]}),jsxRuntimeExports.jsx("button",{onClick:()=>je(!0),className:"create-folder-button",disabled:I||!me,title:"Crear una nueva carpeta",children:jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:jsxRuntimeExports.jsx("path",{d:"M12 4v16m8-8H4"})})})]})]}),te&&jsxRuntimeExports.jsxs("div",{className:"error-message",children:[jsxRuntimeExports.jsx("span",{className:"error-icon",children:"⚠️"}),jsxRuntimeExports.jsx("span",{children:te})]}),jsxRuntimeExports.jsxs("div",{className:"folder-navigation",children:[jsxRuntimeExports.jsx("button",{onClick:Ze,disabled:!v||I,className:"back-button",title:"Volver a la carpeta anterior",children:"←"}),jsxRuntimeExports.jsx(BreadcrumbPath,{folderStack:w,onNavigate:Lt=>{if(Lt===null)T(null),S([]),Ie();else{const qe=w.slice(0,Lt+1);S(qe),T(qe[Lt].id)}}})]}),I?jsxRuntimeExports.jsxs("div",{className:"loading-state",children:[jsxRuntimeExports.jsx("span",{className:"loading-icon",children:"🔄"}),jsxRuntimeExports.jsx("span",{children:"Cargando archivos..."})]}):Le.length>0?jsxRuntimeExports.jsx("div",{className:"files-grid",children:Le.map(Lt=>jsxRuntimeExports.jsxs("div",{className:`file-item ${Lt.isFolder?"folder":""}`,children:[jsxRuntimeExports.jsxs("div",{className:"file-actions",children:[jsxRuntimeExports.jsx("button",{className:"action-button edit",onClick:qe=>{qe.stopPropagation(),Pe(Lt),ze(Lt.name),Ve(!0)},title:"Renombrar",children:"✏️"}),jsxRuntimeExports.jsx("button",{className:"action-button delete",onClick:qe=>{qe.stopPropagation(),Pe(Lt),Fe(!0)},title:"Eliminar",children:"🗑️"})]}),jsxRuntimeExports.jsxs("div",{className:"file-content",onClick:qe=>{qe.stopPropagation(),Lt.isFolder?Ct(Lt):Lt.webViewLink&&window.open(Lt.webViewLink,"_blank")},title:Lt.isFolder?"Abrir carpeta":"Ver archivo",children:[jsxRuntimeExports.jsx("div",{className:"file-icon",children:jsxRuntimeExports.jsx(FileIcon,{mimeType:Lt.mimeType})}),jsxRuntimeExports.jsxs("div",{className:"file-details",children:[jsxRuntimeExports.jsx("div",{className:"file-name",children:Lt.name}),jsxRuntimeExports.jsx("div",{className:"file-type",children:Lt.isFolder?"Carpeta":Lt.mimeType.split("/").pop().replace("vnd.google-apps.","")})]})]})]},Lt.id))}):jsxRuntimeExports.jsx("div",{className:"empty-state",children:me==="Connected"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"empty-icon",children:"📂"}),jsxRuntimeExports.jsx("span",{children:ke?`No se encontraron archivos que coincidan con "${ke}"`:"No hay archivos en esta carpeta"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("span",{className:"empty-icon",children:"🔌"}),jsxRuntimeExports.jsx("span",{children:"Conecta con Google Drive para ver los archivos"})]})}),Ce&&jsxRuntimeExports.jsxs(Modal,{title:"Confirmar Eliminación",onClose:()=>{Fe(!1),Pe(null)},actions:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{className:"modal-button cancel",onClick:()=>{Fe(!1),Pe(null)},children:"Cancelar"}),jsxRuntimeExports.jsx("button",{className:"modal-button delete",onClick:nt,disabled:I,children:I?"Eliminando...":"Eliminar"})]}),children:[jsxRuntimeExports.jsxs("p",{children:['¿Estás seguro de que quieres eliminar "',Re==null?void 0:Re.name,'"?']}),jsxRuntimeExports.jsx("p",{className:"warning-text",children:"Esta acción no se puede deshacer."})]}),Me&&jsxRuntimeExports.jsx(Modal,{title:"Renombrar Archivo",onClose:()=>{Ve(!1),Pe(null),ze("")},actions:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{className:"modal-button cancel",onClick:()=>{Ve(!1),Pe(null),ze("")},children:"Cancelar"}),jsxRuntimeExports.jsx("button",{className:"modal-button confirm",onClick:nr,disabled:I||!We.trim(),children:I?"Guardando...":"Guardar"})]}),children:jsxRuntimeExports.jsx("input",{type:"text",value:We,onChange:Lt=>ze(Lt.target.value),placeholder:"Nuevo nombre",className:"modal-input",autoFocus:!0})}),Ue&&jsxRuntimeExports.jsx(Modal,{title:"Crear Nueva Carpeta",onClose:()=>{je(!1),ce("")},actions:jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{className:"modal-button cancel",onClick:()=>{je(!1),ce("")},children:"Cancelar"}),jsxRuntimeExports.jsx("button",{className:"modal-button confirm",onClick:Rt,disabled:I||!ie.trim(),children:I?"Creando...":"Crear"})]}),children:jsxRuntimeExports.jsx("input",{type:"text",value:ie,onChange:Lt=>ce(Lt.target.value),placeholder:"Nombre de la carpeta",className:"modal-input",autoFocus:!0,onKeyPress:Lt=>{Lt.key==="Enter"&&ie.trim()&&!I&&Rt()}})})]})},Prospeccion=()=>{const[E,r]=reactExports.useState([]),[v,T]=reactExports.useState(!0),[w,S]=reactExports.useState(null),[I,H]=reactExports.useState(null),[te,ae]=reactExports.useState(null),ie="defaultUser";reactExports.useEffect(()=>{ce()},[]);const ce=async()=>{try{const Fe=await fetch(`${API_URL}/prospeccion/${ie}`);if(!Fe.ok)throw new Error("Failed to load cards");const Me=await Fe.json();r(Me)}catch(Fe){S("Error loading cards"),console.error(Fe)}finally{T(!1)}},me=async(Fe,Me)=>{try{const Ve=E.find(Ue=>Ue.id===Fe),We=await fetch(`${API_URL}/prospeccion/${ie}/${Fe}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:Ve.title,content:Me})});if(!We.ok)throw new Error("Failed to update card");const ze=await We.json();r(E.map(Ue=>Ue.id===Fe?{...Ue,...ze}:Ue))}catch(Ve){S("Error updating card"),console.error(Ve)}},_e=async()=>{try{const Fe=await fetch(`${API_URL}/prospeccion/${ie}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:`Tarjeta ${E.length+1}`})});if(!Fe.ok)throw new Error("Failed to create card");const Me=await Fe.json();r([...E,Me])}catch(Fe){S("Error creating card"),console.error(Fe)}},Re=Fe=>{H(I===Fe?null:Fe)},Pe=async(Fe,Me)=>{if(!Me.trim()){ae(null);return}try{const Ve=E.find(Ue=>Ue.id===Fe),We=await fetch(`${API_URL}/prospeccion/${ie}/${Fe}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:Me,content:(Ve==null?void 0:Ve.content)||""})});if(!We.ok){const Ue=await We.json();throw new Error(Ue.message||"Failed to update card title")}const ze=await We.json();r(Ue=>Ue.map(je=>je.id===Fe?{...je,...ze}:je)),await ce()}catch(Ve){console.error("Error updating card title:",Ve),S(`Error al actualizar título: ${Ve.message}`)}finally{ae(null)}},Ce=async(Fe,Me,Ve)=>{if(Fe.key==="Enter"){Fe.preventDefault();const We=Fe.target.value.trim();We&&We!==Ve&&await Pe(Me,We),ae(null)}else Fe.key==="Escape"&&(Fe.preventDefault(),ae(null))};return v?jsxRuntimeExports.jsx("div",{className:"loading",children:"Loading cards..."}):w?jsxRuntimeExports.jsx("div",{className:"error",children:w}):jsxRuntimeExports.jsxs("div",{className:"prospeccion-container",children:[jsxRuntimeExports.jsxs("div",{className:"prospeccion-header",children:[jsxRuntimeExports.jsx("h2",{children:"Prospección"}),jsxRuntimeExports.jsx("button",{onClick:_e,className:"add-card-btn",children:"+ Nueva Tarjeta"})]}),jsxRuntimeExports.jsx("div",{className:"cards-grid",children:E.map(Fe=>jsxRuntimeExports.jsxs("div",{className:`card ${I===Fe.id?"expanded":""}`,onDoubleClick:()=>Re(Fe.id),children:[jsxRuntimeExports.jsxs("div",{className:"card-header",children:[te===Fe.id?jsxRuntimeExports.jsx("input",{type:"text",className:"card-title-input",defaultValue:Fe.title,autoFocus:!0,onBlur:async Me=>{const Ve=Me.target.value.trim();Ve&&Ve!==Fe.title&&await Pe(Fe.id,Ve),ae(null)},onKeyDown:Me=>Ce(Me,Fe.id,Fe.title),onClick:Me=>Me.stopPropagation()}):jsxRuntimeExports.jsx("span",{className:"card-title",onDoubleClick:Me=>{Me.stopPropagation(),ae(Fe.id)},children:Fe.title}),Fe.gpt_analysis&&jsxRuntimeExports.jsx("span",{className:"analysis-indicator",title:"Análisis GPT disponible",children:"🤖"})]}),jsxRuntimeExports.jsx("textarea",{className:"card-editor",value:Fe.content||"",onChange:Me=>me(Fe.id,Me.target.value),placeholder:"Escribe tu contenido aquí...",onClick:Me=>Me.stopPropagation()}),I===Fe.id&&Fe.gpt_analysis&&jsxRuntimeExports.jsxs("div",{className:"analysis-section",children:[jsxRuntimeExports.jsx("h4",{children:"Análisis GPT"}),jsxRuntimeExports.jsx("div",{className:"analysis-content",children:Fe.gpt_analysis})]})]},Fe.id))})]})},Datapool=()=>{const[E,r]=reactExports.useState([]),[v,T]=reactExports.useState([]),[w,S]=reactExports.useState(""),[I,H]=reactExports.useState(!0),[te,ae]=reactExports.useState(null);reactExports.useEffect(()=>{me()},[]),reactExports.useEffect(()=>{ie()},[w,E]);const ie=()=>{if(!w.trim()){T(E);return}const Re=w.toLowerCase(),Pe=E.filter(Ce=>Object.entries(Ce).some(([Fe,Me])=>typeof Me=="string"||typeof Me=="number"?Me.toString().toLowerCase().includes(Re):!1));T(Pe)},ce=Re=>{S(Re.target.value)},me=async()=>{H(!0),ae(null);try{const Re=await tableService.getTables();if(!Re||!Array.isArray(Re))throw new Error("No tables found or invalid tables data");const Pe=await Promise.all(Re.map(async Me=>{try{const Ve=await tableService.getData(Me.name);return!Ve||!Ve.data||!Array.isArray(Ve.data)?(console.warn(`No data or invalid data for table ${Me.name}`),[]):Ve.data.map(We=>{console.log("Available fields:",Object.keys(We));const ze=Object.keys(We).find(Ne=>Ne.toLowerCase().includes("contratante")||Ne.toLowerCase().includes("nombre_contratante")||Ne.toLowerCase().includes("nombre del contratante")||Ne.toLowerCase().includes("nombre_del_contratante")||Ne.toLowerCase().includes("nombrecontratante")||Ne.toLowerCase().includes("nombre")||Ne.toLowerCase().includes("contrat")),Ue=Object.keys(We).find(Ne=>Ne.toLowerCase().includes("poliza")||Ne.toLowerCase().includes("numero_poliza")||Ne.toLowerCase().includes("numero de poliza")||Ne.toLowerCase().includes("numeropoliza")||Ne.toLowerCase().includes("numero_de_poliza")||Ne.toLowerCase().includes("nopoliza")||Ne.toLowerCase().includes("no_poliza"));console.log("Found fields:",{contratante:ze,poliza:Ue,contratanteValue:We[ze],polizaValue:We[Ue]});const je=We[ze]||We.nombre_del_contratante||We.NOMBRE_DEL_CONTRATANTE||We.nombreDelContratante||"Sin contratante",ke=We[Ue]||We.numero_de_poliza||We.NUMERO_DE_POLIZA||We.numeroDePoliza||"N/A";return{...We,_sourceTable:Me.name,title:je,subtitle:`Póliza: ${ke} - Tabla: ${Me.name}`,details:Object.entries(We).filter(([Ne])=>!["_sourceTable"].includes(Ne)&&Ne!==ze&&Ne!==Ue).map(([Ne,Ge])=>`${Ne}: ${Ge}`).join(`
`)}})}catch(Ve){return console.error(`Error loading data for table ${Me.name}:`,Ve),[]}}));let Ce=[];try{Ce=await fetchBirthdays(),Ce=Ce.map(Me=>({...Me,_sourceTable:"birthdays",title:Me.name,subtitle:`${Me.formattedDate} (${Me.age} años)`,details:Me.details,status:Me.age>=60?"Senior":"Active"}))}catch(Me){console.error("Error loading birthdays:",Me)}const Fe=[...Pe.flat(),...Ce];r(Fe)}catch(Re){console.error("Error loading data:",Re),ae(Re.message)}finally{H(!1)}},_e=Re=>{Re._sourceTable==="birthdays"?console.log("Birthday card clicked:",Re):console.log("Selected item:",Re)};return I?jsxRuntimeExports.jsx("div",{className:"datapool-loading",children:"Loading all data..."}):te?jsxRuntimeExports.jsx("div",{className:"datapool-error",children:te}):jsxRuntimeExports.jsxs("div",{className:"datapool-container",children:[jsxRuntimeExports.jsxs("div",{className:"datapool-header",children:[jsxRuntimeExports.jsx("h2",{children:"Data Pool"}),jsxRuntimeExports.jsxs("div",{className:"search-container",children:[jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search in all data...",value:w,onChange:ce,className:"search-input"}),jsxRuntimeExports.jsxs("span",{className:"datapool-count",children:[v.length," of ",E.length," entries"]})]})]}),jsxRuntimeExports.jsx(TableCardView,{data:v,onCardClick:_e})]})},Birthdays=()=>{const[E,r]=reactExports.useState([]),[v,T]=reactExports.useState(!0),[w,S]=reactExports.useState(null),[I,H]=reactExports.useState(""),[te,ae]=reactExports.useState("grid"),[ie,ce]=reactExports.useState(null);reactExports.useEffect(()=>{me()},[]);const me=async()=>{try{T(!0);const je=(await fetchBirthdays()).map(ke=>({...ke,date:new Date(ke.date)}));r(je)}catch(Ue){console.error("Error loading birthdays:",Ue),S("Error loading birthdays: "+Ue.message)}finally{T(!1)}},_e=async()=>{try{ce({loading:!0});const Ue=await triggerBirthdayEmails();ce({success:!0,message:`Se enviaron ${Ue.emailsSent} correos de cumpleaños.`}),setTimeout(()=>ce(null),5e3)}catch(Ue){ce({error:!0,message:"Error al enviar correos: "+Ue.message})}},Re=E.filter(Ue=>{var ke,Ne,Ge,Ie;const je=I.toLowerCase();return((ke=Ue.name)==null?void 0:ke.toLowerCase().includes(je))||((Ne=Ue.rfc)==null?void 0:Ne.toLowerCase().includes(je))||((Ge=Ue.email)==null?void 0:Ge.toLowerCase().includes(je))||((Ie=Ue.details)==null?void 0:Ie.toLowerCase().includes(je))}),Pe=new Date,Ce=Pe.toLocaleString("es-MX",{month:"long"}),Fe=Pe.toDateString(),Me=Re.filter(Ue=>Ue.date?Ue.date.toDateString()===Fe:!1),Ve=Re.filter(Ue=>Ue.date?Ue.date.toLocaleString("es-MX",{month:"long"})===Ce:!1),We=Re.reduce((Ue,je)=>{if(!je.date)return Ue;const ke=je.date.toLocaleString("es-MX",{month:"long"});return Ue[ke]||(Ue[ke]=[]),Ue[ke].push(je),Ue},{}),ze=Ue=>{if(!Ue)return"Fecha no disponible";try{return Ue.toLocaleDateString("es-MX",{day:"numeric",month:"long"})}catch(je){return console.error("Error formatting date:",je),"Error en fecha"}};return jsxRuntimeExports.jsxs("div",{className:"birthdays-container",children:[jsxRuntimeExports.jsxs("div",{className:"birthdays-header",children:[jsxRuntimeExports.jsx("h2",{children:"Cumpleaños"}),jsxRuntimeExports.jsxs("div",{className:"header-actions",children:[jsxRuntimeExports.jsxs("div",{className:"search-container",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"search-icon",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"})}),jsxRuntimeExports.jsx("input",{type:"text",className:"search-input",placeholder:"Buscar por nombre, RFC, email o póliza...",value:I,onChange:Ue=>H(Ue.target.value)})]}),jsxRuntimeExports.jsxs("div",{className:"view-actions",children:[jsxRuntimeExports.jsx("button",{className:`view-toggle ${te==="grid"?"active":""}`,onClick:()=>ae("grid"),title:"Vista de tarjetas",children:jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"})})}),jsxRuntimeExports.jsx("button",{className:`view-toggle ${te==="table"?"active":""}`,onClick:()=>ae("table"),title:"Vista de tabla",children:jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.375 19.5h17.25m-17.25 0a1.125 1.125 0 01-1.125-1.125M3.375 19.5h7.5c.621 0 1.125-.504 1.125-1.125m-9.75 0V5.625m0 12.75v-1.5c0-.621.504-1.125 1.125-1.125m18.375 2.625V5.625m0 12.75c0 .621-.504 1.125-1.125 1.125m1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125m0 3.75h-7.5A1.125 1.125 0 0112 18.375m9.75-12.75c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125m19.5 0v1.5c0 .621-.504 1.125-1.125 1.125M2.25 5.625v1.5c0 .621.504 1.125 1.125 1.125m0 0h17.25m-17.25 0h7.5c.621 0 1.125.504 1.125 1.125M3.375 8.25c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125m17.25-3.75h-7.5c-.621 0-1.125.504-1.125 1.125m8.625-1.125c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125M12 10.875v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 10.875c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125M13.125 12h7.5m-7.5 0c-.621 0-1.125.504-1.125 1.125M20.625 12c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125m-17.25 0h7.5M12 14.625v-1.5m0 1.5c0 .621-.504 1.125-1.125 1.125M12 14.625c0 .621.504 1.125 1.125 1.125m-2.25 0c.621 0 1.125.504 1.125 1.125m0 1.5v-1.5m0 0c0-.621.504-1.125 1.125-1.125m0 0h7.5"})})})]}),jsxRuntimeExports.jsxs("button",{className:"btn-primary",onClick:_e,disabled:ie==null?void 0:ie.loading,children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"})}),"Enviar Correos de Cumpleaños"]})]})]}),ie&&jsxRuntimeExports.jsx("div",{className:`email-status ${ie.error?"error":"success"}`,children:ie.message}),v?jsxRuntimeExports.jsx("div",{className:"loading-state",children:"Cargando..."}):w?jsxRuntimeExports.jsx("div",{className:"error-state",children:w}):Re.length===0?jsxRuntimeExports.jsx("div",{className:"empty-state",children:I?jsxRuntimeExports.jsxs("p",{children:['No se encontraron resultados para "',I,'"']}):jsxRuntimeExports.jsx("p",{children:"No hay cumpleaños registrados"})}):te==="grid"?jsxRuntimeExports.jsxs("div",{className:"birthdays-content",children:[Me.length>0&&jsxRuntimeExports.jsxs("div",{className:"highlight-section today-section",children:[jsxRuntimeExports.jsxs("h3",{className:"highlight-title",children:["🎉 Cumpleaños de Hoy (",Me.length,")"]}),jsxRuntimeExports.jsx("div",{className:"birthdays-grid",children:Me.map(Ue=>jsxRuntimeExports.jsx("div",{className:"birthday-card today-birthday",children:jsxRuntimeExports.jsxs("div",{className:"birthday-info",children:[jsxRuntimeExports.jsxs("span",{className:"birthday-date today-badge",children:["¡HOY! (",Ue.age," años)"]}),jsxRuntimeExports.jsx("h3",{className:"birthday-name",children:Ue.name}),jsxRuntimeExports.jsx("p",{className:"birthday-details",children:Ue.details}),jsxRuntimeExports.jsxs("div",{className:"birthday-contact",children:[jsxRuntimeExports.jsx("span",{className:"birthday-rfc",children:Ue.rfc}),Ue.email&&jsxRuntimeExports.jsxs("span",{className:"birthday-email",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"email-icon",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"})}),Ue.email]})]}),jsxRuntimeExports.jsxs("div",{className:"birthday-metadata",children:[jsxRuntimeExports.jsx("span",{className:"birthday-source",children:Ue.source}),jsxRuntimeExports.jsx("span",{className:"birthday-source-type",title:"Fuente de la fecha de nacimiento",children:Ue.birthdaySource})]})]})},Ue.id))})]}),Ve.length>0&&jsxRuntimeExports.jsxs("div",{className:"highlight-section current-month-section",children:[jsxRuntimeExports.jsxs("h3",{className:"highlight-title",children:["📅 Cumpleaños de ",Ce," (",Ve.length,")"]}),jsxRuntimeExports.jsx("div",{className:"birthdays-grid",children:Ve.filter(Ue=>!Me.some(je=>je.id===Ue.id)).sort((Ue,je)=>Ue.date.getDate()-je.date.getDate()).map(Ue=>jsxRuntimeExports.jsx("div",{className:"birthday-card current-month-birthday",children:jsxRuntimeExports.jsxs("div",{className:"birthday-info",children:[jsxRuntimeExports.jsxs("span",{className:"birthday-date current-month-badge",children:[ze(Ue.date)," (",Ue.age," años)"]}),jsxRuntimeExports.jsx("h3",{className:"birthday-name",children:Ue.name}),jsxRuntimeExports.jsx("p",{className:"birthday-details",children:Ue.details}),jsxRuntimeExports.jsxs("div",{className:"birthday-contact",children:[jsxRuntimeExports.jsx("span",{className:"birthday-rfc",children:Ue.rfc}),Ue.email&&jsxRuntimeExports.jsxs("span",{className:"birthday-email",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"email-icon",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"})}),Ue.email]})]}),jsxRuntimeExports.jsxs("div",{className:"birthday-metadata",children:[jsxRuntimeExports.jsx("span",{className:"birthday-source",children:Ue.source}),jsxRuntimeExports.jsx("span",{className:"birthday-source-type",title:"Fuente de la fecha de nacimiento",children:Ue.birthdaySource})]})]})},Ue.id))})]}),jsxRuntimeExports.jsxs("div",{className:"all-birthdays-section",children:[jsxRuntimeExports.jsx("h3",{className:"section-title",children:"Todos los Cumpleaños por Mes"}),Object.entries(We).map(([Ue,je])=>jsxRuntimeExports.jsxs("div",{className:"month-section",children:[jsxRuntimeExports.jsx("h4",{className:"month-title",children:Ue}),jsxRuntimeExports.jsx("div",{className:"birthdays-grid",children:je.map(ke=>jsxRuntimeExports.jsx("div",{className:"birthday-card",children:jsxRuntimeExports.jsxs("div",{className:"birthday-info",children:[jsxRuntimeExports.jsxs("span",{className:"birthday-date",children:[ze(ke.date)," (",ke.age," años)"]}),jsxRuntimeExports.jsx("h3",{className:"birthday-name",children:ke.name}),jsxRuntimeExports.jsx("p",{className:"birthday-details",children:ke.details}),jsxRuntimeExports.jsxs("div",{className:"birthday-contact",children:[jsxRuntimeExports.jsx("span",{className:"birthday-rfc",children:ke.rfc}),ke.email&&jsxRuntimeExports.jsxs("span",{className:"birthday-email",children:[jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"email-icon",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75"})}),ke.email]})]}),jsxRuntimeExports.jsxs("div",{className:"birthday-metadata",children:[jsxRuntimeExports.jsx("span",{className:"birthday-source",children:ke.source}),jsxRuntimeExports.jsx("span",{className:"birthday-source-type",title:"Fuente de la fecha de nacimiento",children:ke.birthdaySource})]})]})},ke.id))})]},Ue))]})]}):jsxRuntimeExports.jsx("div",{className:"birthdays-table-view",children:jsxRuntimeExports.jsxs("table",{children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{children:"Fecha"}),jsxRuntimeExports.jsx("th",{children:"Nombre"}),jsxRuntimeExports.jsx("th",{children:"Email"}),jsxRuntimeExports.jsx("th",{children:"RFC"}),jsxRuntimeExports.jsx("th",{children:"Detalles"}),jsxRuntimeExports.jsx("th",{children:"Edad"}),jsxRuntimeExports.jsx("th",{children:"Fuente"}),jsxRuntimeExports.jsx("th",{children:"Origen Fecha"})]})}),jsxRuntimeExports.jsx("tbody",{children:Re.map(Ue=>jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{children:ze(Ue.date)}),jsxRuntimeExports.jsx("td",{children:Ue.name}),jsxRuntimeExports.jsx("td",{children:Ue.email||"-"}),jsxRuntimeExports.jsx("td",{children:Ue.rfc||"-"}),jsxRuntimeExports.jsx("td",{children:Ue.details}),jsxRuntimeExports.jsxs("td",{children:[Ue.age," años"]}),jsxRuntimeExports.jsx("td",{children:Ue.source}),jsxRuntimeExports.jsx("td",{title:"Fuente de la fecha de nacimiento",children:Ue.birthdaySource})]},Ue.id))})]})})]})},API_BASE_URL$3=API_URL;class PolicyStatusService{async getStatuses(){try{return(await axios.get(API_BASE_URL$3)).data}catch(r){throw console.error("Error fetching policy statuses:",r),r}}async updateStatus(r,v){try{return(await axios.post(API_BASE_URL$3,{policyKey:r,status:v})).data}catch(T){throw console.error("Error updating policy status:",T),T}}}const policyStatusService=new PolicyStatusService,API_BASE_URL$2=API_URL,sendReportEmail=async(E,r)=>{try{const v=await fetch(`${API_BASE_URL$2}/api/email/report`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({policies:E,reportType:r})});if(!v.ok)throw new Error("Failed to send report email");return await v.json()}catch(v){throw console.error("Error sending report email:",v),v}},VencimientosGraphics=({policies:E,timeView:r,onTimeViewChange:v})=>{const T=reactExports.useMemo(()=>{if(!E||E.length===0)return[];const H=new Date,te=H.getFullYear(),ae=H.getMonth(),ie=E.filter(Pe=>{if(!Pe.fecha_fin)return!1;const Ce=new Date(Pe.fecha_fin);return!isNaN(Ce.getTime())});let ce=[],me=ae,_e=te;switch(r){case"4months":ce=Array.from({length:4},(Pe,Ce)=>{const Fe=(me+Ce)%12,Me=_e+Math.floor((me+Ce)/12);return{month:Fe,year:Me}});break;case"6months":ce=Array.from({length:6},(Pe,Ce)=>{const Fe=(me+Ce)%12,Me=_e+Math.floor((me+Ce)/12);return{month:Fe,year:Me}});break;case"year":ce=Array.from({length:12},(Pe,Ce)=>{const Fe=(me+Ce)%12,Me=_e+Math.floor((me+Ce)/12);return{month:Fe,year:Me}});break;default:ce=Array.from({length:4},(Pe,Ce)=>{const Fe=(me+Ce)%12,Me=_e+Math.floor((me+Ce)/12);return{month:Fe,year:Me}})}return ce.map(({month:Pe,year:Ce})=>{const Fe=ie.filter(Ve=>{const We=new Date(Ve.fecha_fin);return We.getMonth()===Pe&&We.getFullYear()===Ce}),Me={};return Fe.forEach(Ve=>{const We=Ve.ramo||"Otros";Me[We]||(Me[We]=[]),Me[We].push(Ve)}),{month:Pe,year:Ce,monthName:new Date(Ce,Pe).toLocaleDateString("es-ES",{month:"long"}),totalPolicies:Fe.length,ramoGroups:Me,policies:Fe}})},[E,r]),w=reactExports.useMemo(()=>{const H=T.reduce((ae,ie)=>ae+ie.totalPolicies,0),te={};return T.forEach(ae=>{Object.entries(ae.ramoGroups).forEach(([ie,ce])=>{te[ie]=(te[ie]||0)+ce.length})}),{totalPolicies:H,ramoTotals:te}},[T]);Object.keys(w.ramoTotals);const S={GMM:"#4F46E5",Autos:"#10B981",Vida:"#F59E0B",Mascotas:"#EF4444",Diversos:"#8B5CF6",Otros:"#6B7280"},I=H=>S[H]||"#6B7280";return jsxRuntimeExports.jsxs("div",{className:"vencimientos-graphics",children:[jsxRuntimeExports.jsxs("div",{className:"graphics-header",children:[jsxRuntimeExports.jsx("h3",{children:"Vencimientos por Período"}),jsxRuntimeExports.jsxs("div",{className:"time-view-controls",children:[jsxRuntimeExports.jsx("button",{className:`time-btn ${r==="4months"?"active":""}`,onClick:()=>v("4months"),children:"4 Meses"}),jsxRuntimeExports.jsx("button",{className:`time-btn ${r==="6months"?"active":""}`,onClick:()=>v("6months"),children:"6 Meses"}),jsxRuntimeExports.jsx("button",{className:`time-btn ${r==="year"?"active":""}`,onClick:()=>v("year"),children:"Año"})]})]}),jsxRuntimeExports.jsxs("div",{className:"graphics-summary",children:[jsxRuntimeExports.jsxs("div",{className:"summary-card",children:[jsxRuntimeExports.jsx("h4",{children:"Total Vencimientos"}),jsxRuntimeExports.jsx("span",{className:"summary-number",children:w.totalPolicies})]}),jsxRuntimeExports.jsx("div",{className:"summary-ramos",children:Object.entries(w.ramoTotals).map(([H,te])=>jsxRuntimeExports.jsxs("div",{className:"ramo-summary",children:[jsxRuntimeExports.jsx("div",{className:"ramo-color",style:{backgroundColor:I(H)}}),jsxRuntimeExports.jsx("span",{className:"ramo-name",children:H}),jsxRuntimeExports.jsx("span",{className:"ramo-count",children:te})]},H))})]}),jsxRuntimeExports.jsx("div",{className:"graphics-chart",children:jsxRuntimeExports.jsx("div",{className:"chart-container",children:T.map((H,te)=>{const ae=Math.max(...T.map(ce=>ce.totalPolicies)),ie=ae>0?H.totalPolicies/ae*200:0;return jsxRuntimeExports.jsxs("div",{className:"chart-bar",children:[jsxRuntimeExports.jsxs("div",{className:"bar-container",children:[jsxRuntimeExports.jsx("div",{className:"bar-total",style:{height:`${ie}px`},title:`${H.monthName} ${H.year}: ${H.totalPolicies} vencimientos`,children:Object.entries(H.ramoGroups).map(([ce,me],_e)=>{const Re=me.length/H.totalPolicies*ie;return jsxRuntimeExports.jsx("div",{className:"bar-segment",style:{height:`${Re}px`,backgroundColor:I(ce)},title:`${ce}: ${me.length} pólizas`},ce)})}),jsxRuntimeExports.jsx("div",{className:"bar-value",children:H.totalPolicies})]}),jsxRuntimeExports.jsxs("div",{className:"bar-label",children:[jsxRuntimeExports.jsx("div",{className:"month-name",children:H.monthName}),jsxRuntimeExports.jsx("div",{className:"year-name",children:H.year})]})]},`${H.year}-${H.month}`)})})}),jsxRuntimeExports.jsxs("div",{className:"graphics-details",children:[jsxRuntimeExports.jsx("h4",{children:"Detalle por Mes"}),jsxRuntimeExports.jsx("div",{className:"monthly-details",children:T.map(H=>jsxRuntimeExports.jsxs("div",{className:"month-detail",children:[jsxRuntimeExports.jsxs("div",{className:"month-header",children:[jsxRuntimeExports.jsxs("h5",{children:[H.monthName," ",H.year]}),jsxRuntimeExports.jsxs("span",{className:"month-total",children:[H.totalPolicies," vencimientos"]})]}),Object.entries(H.ramoGroups).map(([te,ae])=>jsxRuntimeExports.jsxs("div",{className:"ramo-detail",children:[jsxRuntimeExports.jsx("div",{className:"ramo-indicator",style:{backgroundColor:I(te)}}),jsxRuntimeExports.jsx("span",{className:"ramo-name",children:te}),jsxRuntimeExports.jsx("span",{className:"ramo-count",children:ae.length})]},te))]},`${H.year}-${H.month}`))})]})]})},MatrixGraphics=({policies:E,uniqueRamos:r,uniqueCompanies:v})=>{const T=reactExports.useMemo(()=>{if(!E||E.length===0)return{ramoData:[],companyData:[],crossData:[]};const te=r.map(ce=>{const me=E.filter(Re=>Re.ramo===ce),_e=[...new Set(me.map(Re=>Re.aseguradora))];return{ramo:ce,count:me.length,companies:_e.length,policies:me}}).sort((ce,me)=>me.count-ce.count),ae=v.map(ce=>{const me=E.filter(Re=>Re.aseguradora===ce),_e=[...new Set(me.map(Re=>Re.ramo))];return{company:ce,count:me.length,ramos:_e.length,policies:me}}).sort((ce,me)=>me.count-ce.count),ie=r.map(ce=>{const me=v.map(_e=>{const Re=E.filter(Pe=>Pe.ramo===ce&&Pe.aseguradora===_e).length;return{company:_e,count:Re}}).filter(_e=>_e.count>0);return{ramo:ce,companies:me,total:me.reduce((_e,Re)=>_e+Re.count,0)}}).filter(ce=>ce.total>0);return{ramoData:te,companyData:ae,crossData:ie}},[E,r,v]),w={GMM:"#4F46E5",Autos:"#10B981",Vida:"#F59E0B",Mascotas:"#EF4444",Diversos:"#8B5CF6",Otros:"#6B7280"},S={"Plan Seguro":"#3B82F6",GNP:"#EF4444",AXA:"#10B981","Seguros Monterrey":"#F59E0B"},I=te=>w[te]||"#6B7280",H=te=>S[te]||"#8B5CF6";return jsxRuntimeExports.jsxs("div",{className:"matrix-graphics",children:[jsxRuntimeExports.jsx("div",{className:"graphics-header",children:jsxRuntimeExports.jsx("h3",{children:"Análisis de Distribución"})}),jsxRuntimeExports.jsx("div",{className:"matrix-summary",children:jsxRuntimeExports.jsxs("div",{className:"summary-grid",children:[jsxRuntimeExports.jsxs("div",{className:"summary-card",children:[jsxRuntimeExports.jsx("h4",{children:"Total Pólizas"}),jsxRuntimeExports.jsx("span",{className:"summary-number",children:E.length})]}),jsxRuntimeExports.jsxs("div",{className:"summary-card",children:[jsxRuntimeExports.jsx("h4",{children:"Ramos Activos"}),jsxRuntimeExports.jsx("span",{className:"summary-number",children:r.length})]}),jsxRuntimeExports.jsxs("div",{className:"summary-card",children:[jsxRuntimeExports.jsx("h4",{children:"Aseguradoras"}),jsxRuntimeExports.jsx("span",{className:"summary-number",children:v.length})]})]})}),jsxRuntimeExports.jsxs("div",{className:"matrix-chart-section",children:[jsxRuntimeExports.jsx("h4",{children:"Distribución por Ramo"}),jsxRuntimeExports.jsx("div",{className:"chart-container",children:T.ramoData.map((te,ae)=>{const ie=Math.max(...T.ramoData.map(me=>me.count)),ce=ie>0?te.count/ie*150:0;return jsxRuntimeExports.jsxs("div",{className:"chart-bar",children:[jsxRuntimeExports.jsxs("div",{className:"bar-container",children:[jsxRuntimeExports.jsx("div",{className:"bar-total",style:{height:`${ce}px`,backgroundColor:I(te.ramo)},title:`${te.ramo}: ${te.count} pólizas en ${te.companies} aseguradoras`}),jsxRuntimeExports.jsx("div",{className:"bar-value",children:te.count})]}),jsxRuntimeExports.jsxs("div",{className:"bar-label",children:[jsxRuntimeExports.jsx("div",{className:"ramo-name",children:te.ramo}),jsxRuntimeExports.jsxs("div",{className:"companies-count",children:[te.companies," aseg."]})]})]},te.ramo)})})]}),jsxRuntimeExports.jsxs("div",{className:"matrix-chart-section",children:[jsxRuntimeExports.jsx("h4",{children:"Distribución por Aseguradora"}),jsxRuntimeExports.jsx("div",{className:"chart-container",children:T.companyData.map((te,ae)=>{const ie=Math.max(...T.companyData.map(me=>me.count)),ce=ie>0?te.count/ie*150:0;return jsxRuntimeExports.jsxs("div",{className:"chart-bar",children:[jsxRuntimeExports.jsxs("div",{className:"bar-container",children:[jsxRuntimeExports.jsx("div",{className:"bar-total",style:{height:`${ce}px`,backgroundColor:H(te.company)},title:`${te.company}: ${te.count} pólizas en ${te.ramos} ramos`}),jsxRuntimeExports.jsx("div",{className:"bar-value",children:te.count})]}),jsxRuntimeExports.jsxs("div",{className:"bar-label",children:[jsxRuntimeExports.jsx("div",{className:"company-name",children:te.company}),jsxRuntimeExports.jsxs("div",{className:"ramos-count",children:[te.ramos," ramos"]})]})]},te.company)})})]}),jsxRuntimeExports.jsxs("div",{className:"matrix-details",children:[jsxRuntimeExports.jsx("h4",{children:"Análisis Cruzado: Ramo vs Aseguradora"}),jsxRuntimeExports.jsx("div",{className:"cross-analysis",children:T.crossData.map(te=>jsxRuntimeExports.jsxs("div",{className:"cross-item",children:[jsxRuntimeExports.jsxs("div",{className:"cross-header",children:[jsxRuntimeExports.jsx("div",{className:"ramo-indicator",style:{backgroundColor:I(te.ramo)}}),jsxRuntimeExports.jsx("span",{className:"cross-ramo",children:te.ramo}),jsxRuntimeExports.jsxs("span",{className:"cross-total",children:[te.total," pólizas"]})]}),jsxRuntimeExports.jsx("div",{className:"cross-companies",children:te.companies.map(ae=>jsxRuntimeExports.jsxs("div",{className:"cross-company",children:[jsxRuntimeExports.jsx("div",{className:"company-indicator",style:{backgroundColor:H(ae.company)}}),jsxRuntimeExports.jsx("span",{className:"company-name",children:ae.company}),jsxRuntimeExports.jsx("span",{className:"company-count",children:ae.count})]},ae.company))})]},te.ramo))})]})]})},MONTHS=["January","February","March","April","May","June","July","August","September","October","November","December"],REPORT_TYPES=["Vencimientos","Pagos Parciales","Matriz de Productos"];function Reports(){const[E,r]=reactExports.useState("table"),[v,T]=reactExports.useState(new Date().getMonth()),[w,S]=reactExports.useState("Vencimientos"),[I,H]=reactExports.useState([]),[te,ae]=reactExports.useState([]),[ie,ce]=reactExports.useState(!0),[me,_e]=reactExports.useState(null),[Re,Pe]=reactExports.useState(""),[Ce,Fe]=reactExports.useState("long-es"),[Me,Ve]=reactExports.useState(!1),[We,ze]=reactExports.useState(null),[Ue,je]=reactExports.useState({}),[ke,Ne]=reactExports.useState({}),[Ge,Ie]=reactExports.useState(!0),[Le,He]=reactExports.useState([]),[Ct,Ze]=reactExports.useState([]),[Rt,nt]=reactExports.useState([]),[nr,Je]=reactExports.useState({}),[Wt,Lt]=reactExports.useState(""),[qe,$e]=reactExports.useState(""),[Be,Xe]=reactExports.useState(""),[rt,Qe]=reactExports.useState(!1),[vt,Dt]=reactExports.useState("4months"),[Ut,hr]=reactExports.useState(!0),[pt,yr]=reactExports.useState(!1),vr=(Et,dr)=>{if(!Et)return null;const br=new Date(Et),Br=new Date,or={MENSUAL:1,BIMESTRAL:2,TRIMESTRAL:3,CUATRIMESTRAL:4,SEMESTRAL:6,ANUAL:12}[dr.toUpperCase()]||12;let ur=new Date(br);for(;ur<=Br;)ur.setMonth(ur.getMonth()+or);return ur},wr=Et=>`${Et.ramo.toLowerCase()}_${Et.id}`,ir=async()=>{try{Ie(!0);const Et=await policyStatusService.getStatuses();Ne(Et)}catch(Et){console.error("Error loading policy statuses:",Et),c.error("Error al cargar los estados de las pólizas")}finally{Ie(!1)}};reactExports.useEffect(()=>{ir()},[]);const sr=(Et,dr)=>{console.log("Normalizing policy:",{source:dr,raw:Et,identifiers:{numero_poliza:Et.numero_poliza||Et.n__mero_de_p__liza||Et.numero_de_poliza,contratante:Et.contratante||Et.nombre_contratante,asegurado:Et.nombre_del_asegurado||Et.asegurado||Et.contratante,aseguradora:Et.aseguradora||Et.compania||Et.compañia||"No especificada"}});const br={id:Et.id,numero_poliza:Et.numero_poliza||Et.n__mero_de_p__liza||Et.numero_de_poliza,contratante:Et.contratante||Et.nombre_contratante,asegurado:Et.nombre_del_asegurado||Et.asegurado||Et.contratante||Et.nombre_contratante,rfc:Et.rfc,email:Et.e_mail||Et.email,fecha_inicio:Et.fecha_inicio||Et.vigencia__inicio_||Et.vigencia_inicio||Et.desde_vigencia||Et.vigencia_inicio,fecha_fin:Et.fecha_fin||Et.vigencia__fin_||Et.vigencia_fin||Et.hasta_vigencia||Et.vigencia_de_la_poliza_hasta||Et.vigencia_fin,aseguradora:Et.aseguradora||"No especificada",forma_pago:Et.forma_de_pago||Et.forma_pago||"No especificado",sourceTable:dr},Br=$r=>$r&&parseFloat($r.toString().replace(/,/g,""))||0,Lr=Br(Et.prima_total||Et.pago_total||Et.importe_total_a_pagar||Et.pago_total_o_prima_total),or={prima_neta:Br(Et.prima_neta)||Lr,prima_total:Lr,derecho_poliza:Br(Et.derecho_de_p__liza||Et.derecho_de_poliza||Et.derecho_poliza),recargo_pago_fraccionado:Br(Et.recargo_por_pago_fraccionado),iva:Br(Et.i_v_a__16_||Et.i_v_a||Et.iva_16),pago_total:Lr,pagos_fraccionados:Et.pagos_fraccionados,pago_parcial:Et.monto_parcial,fecha_proximo_pago:vr(br.fecha_inicio,br.forma_pago)},ur={...br,...or};let gr=Et.ramo;if(!gr)switch(dr){case"gmm":case"gruposgmm":gr="GMM";break;case"autos":gr="Autos";break;case"mascotas":gr="Mascotas";break;case"vida":gr="Vida";break;case"negocio":gr="Negocio";break;case"diversos":gr="Diversos";break;case"rc":gr="Responsabilidad Civil";break;case"transporte":gr="Transporte";break;case"hogar":gr="Hogar";break;case"empresarial":gr="Empresarial";break;case"responsabilidad":gr="Responsabilidad Civil";break;case"accidentes":gr="Accidentes Personales";break;default:gr="Otros"}return{...ur,ramo:gr}},kt=(Et,dr)=>{if(!dr.trim())return!0;if(Et==null)return!1;const br=or=>or.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g,"").trim(),Br=br(dr).split(/\s+/).filter(Boolean);let Lr;if(Et instanceof Date)Lr=br(formatDate(Et));else if(typeof Et=="object"&&Et!==null)try{Lr=br(JSON.stringify(Et))}catch{return!1}else Lr=br(Et.toString());return Br.some(or=>Lr.includes(or))},rr=async()=>{ce(!0),_e(null);try{const Et=await tableService.getTables();console.log("All available tables:",Et);const dr={GruposAutos:"AutosListado",GruposVida:"VidaListado"},Br=(await Promise.all(Et.map(async ur=>{var gr,$r,Xr;try{console.log(`Fetching data from table: ${ur.name}`);const Rr=await tableService.getData(ur.name);if(console.log(`Table ${ur.name} returned ${((gr=Rr.data)==null?void 0:gr.length)||0} records`),dr[ur.name]){const pr=await tableService.getData(dr[ur.name]);return console.log(`Processing paired tables ${ur.name} and ${dr[ur.name]}:`,{mainTable:($r=Rr.data)==null?void 0:$r.length,listadoTable:(Xr=pr.data)==null?void 0:Xr.length}),{tableName:ur.name,data:Rr.data||[],listadoData:pr.data||[]}}return{tableName:ur.name,data:Rr.data||[],listadoData:[]}}catch(Rr){return console.error(`Error fetching from ${ur.name}:`,Rr),{tableName:ur.name,data:[],listadoData:[]}}}))).flatMap(({tableName:ur,data:gr,listadoData:$r})=>{if(console.log(`Processing table: ${ur} with ${gr.length} records`),ur.toLowerCase().includes("listado"))return console.log(`Skipping listado table: ${ur}`),[];let Xr="other";const Rr=ur.toLowerCase();return Rr==="gmm"||Rr==="gruposgmm"?Xr="gmm":Rr==="autos"?Xr="autos":Rr==="mascotas"?Xr="mascotas":Rr==="vida"?Xr="vida":Rr==="negocio"?Xr="negocio":Rr==="diversos"?Xr="diversos":Rr==="rc"?Xr="rc":Rr==="transporte"?Xr="transporte":Rr.includes("hogar")?Xr="hogar":Rr.includes("empresarial")?Xr="empresarial":Rr.includes("responsabilidad")?Xr="responsabilidad":Rr.includes("accidentes")&&(Xr="accidentes"),gr.map(pr=>{try{return dr[ur]&&$r.length>0&&console.log(`Matching policy ${pr.numero_de_poliza} with listado entries:`,{policyId:pr.id,listadoEntries:$r.filter(xr=>xr.numero_de_certificado===pr.numero_de_poliza).length}),sr(pr,Xr)}catch(xr){return console.error(`Error normalizing policy from ${ur}:`,pr,xr),null}}).filter(Boolean)}),Lr=Br.reduce((ur,gr)=>{const $r=`${gr.numero_poliza}_${gr.ramo}_${gr.contratante}`;return console.log("Processing policy for deduplication:",{key:$r,policy:{numero_poliza:gr.numero_poliza,ramo:gr.ramo,contratante:gr.contratante,fecha_inicio:gr.fecha_inicio}}),(!ur[$r]||new Date(gr.fecha_inicio)>new Date(ur[$r].fecha_inicio))&&(ur[$r]&&console.log("Updating existing policy:",{old:{numero_poliza:ur[$r].numero_poliza,fecha_inicio:ur[$r].fecha_inicio},new:{numero_poliza:gr.numero_poliza,fecha_inicio:gr.fecha_inicio}}),ur[$r]=gr),ur},{}),or=Object.values(Lr);console.log("Policy matching results:",{total:Br.length,unique:or.length,pairs:or.reduce((ur,gr)=>{const $r=`${gr.contratante}_${gr.ramo}`;return ur[$r]||(ur[$r]=[]),ur[$r].push({numero_poliza:gr.numero_poliza,fecha_inicio:gr.fecha_inicio,fecha_fin:gr.fecha_fin}),ur},{})}),ae(or)}catch(Et){console.error("Error fetching policies:",Et),_e("Failed to load policies data"),c.error("Error al cargar los datos de pólizas")}finally{ce(!1)}},lr=Et=>{if(!Et)return"";const dr=Et.toString().trim().toLowerCase();return dr.includes("plan seguro")?"Plan Seguro":dr.includes("gnp")?"GNP":dr.includes("axa")?"AXA":dr.includes("seguros monterrey")?"Seguros Monterrey":Et.toString().trim()};reactExports.useEffect(()=>{console.log("Initial data fetch starting..."),rr()},[]),reactExports.useEffect(()=>{const Et=()=>{console.log("Policy update detected, refreshing data..."),rr()};return window.addEventListener("policyDataUpdated",Et),()=>window.removeEventListener("policyDataUpdated",Et)},[]),reactExports.useEffect(()=>{if(!te.length)return;console.log("Filtering policies..."),console.log("Search term:",Re),console.log("Selected month:",v),console.log("Selected type:",w),console.log("Total policies:",te.length);let Et=te;Re.trim()?Et=te.filter(dr=>dr?Object.entries(dr).some(([br,Br])=>{if(typeof Br=="function"||typeof Br=="object"&&Br!==null&&!(Br instanceof Date))return!1;const Lr=kt(Br,Re);return Lr&&console.log("Match found in field:",br,"value:",Br),Lr}):!1):w==="Vencimientos"?Et=Et.filter(dr=>{const br=parseDate$1(dr.fecha_fin);return br?br.getMonth()===v:!1}):w==="Pagos Parciales"&&(Et=Et.filter(dr=>{const br=dr.fecha_proximo_pago;return br?br.getMonth()===v:!1})),console.log("Filtered policies count:",Et.length),console.log("Filtered policies:",Et.map(dr=>({numero_poliza:dr.numero_poliza,fecha_fin:dr.fecha_fin,fecha_proximo_pago:dr.fecha_proximo_pago,type:w,searchApplied:!!Re.trim()}))),H(Et)},[v,w,te,Re]),reactExports.useEffect(()=>{if(!te.length)return;console.log("Building matrix with policies:",te.length,"total policies"),console.log("Policy sources and ramos:",te.map(Lr=>({id:Lr.id,numero_poliza:Lr.numero_poliza,contratante:Lr.contratante,aseguradora:Lr.aseguradora,ramo:Lr.ramo,sourceTable:Lr.sourceTable})));const Et=[...new Set(te.map(Lr=>Lr.contratante).filter(Boolean))].sort(),dr=[...new Set(te.map(Lr=>lr(Lr.aseguradora)).filter(Boolean))].sort(),br=[...new Set(te.map(Lr=>Lr.ramo).filter(Boolean))].sort();console.log("Unique values found:",{clients:Et.length+" clients",companies:dr.length+" companies: "+dr.join(", "),ramos:br.length+" ramos: "+br.join(", ")});const Br={};Et.forEach(Lr=>{Br[Lr]={companies:{},ramos:{}},dr.forEach(or=>{Br[Lr].companies[or]=!1}),br.forEach(or=>{Br[Lr].ramos[or]=!1}),te.forEach(or=>{or.contratante===Lr&&(Br[Lr].companies[or.aseguradora]=!0,Br[Lr].ramos[or.ramo]=!0)})}),console.log("Final matrix structure:",Br),He(Et),Ze(dr),nt(br),Je(Br)},[te]);const mr=async()=>{const Et=new Date,dr=new Date(Et);dr.setDate(Et.getDate()+30);const br=new Date(Et);br.setDate(Et.getDate()+14),console.log("Checking policies with dates:",{today:Et.toISOString(),thirtyDaysFromNow:dr.toISOString(),fourteenDaysFromNow:br.toISOString()});const Br=I.filter(Lr=>{try{if(w==="Vencimientos"){if(!Lr.fecha_fin)return console.log("Missing fecha_fin for policy:",Lr.numero_poliza),!1;const or=parseDate$1(Lr.fecha_fin);return!or||isNaN(or.getTime())?(console.log("Invalid fecha_fin for policy:",Lr.numero_poliza,Lr.fecha_fin),!1):or>=Et&&or<=dr}else{if(!Lr.fecha_proximo_pago)return console.log("Missing fecha_proximo_pago for policy:",Lr.numero_poliza),!1;const or=Lr.fecha_proximo_pago;return!or||isNaN(or.getTime())?(console.log("Invalid fecha_proximo_pago for policy:",Lr.numero_poliza,Lr.fecha_proximo_pago),!1):or>=Et&&or<=br}}catch(or){return console.error("Error processing policy date:",Lr.numero_poliza,or),!1}});if(console.log("Due policies:",Br.map(Lr=>({numero_poliza:Lr.numero_poliza,fecha_fin:Lr.fecha_fin,fecha_proximo_pago:Lr.fecha_proximo_pago,type:w}))),Br.length===0){ze({type:"error",message:w==="Vencimientos"?"No hay pólizas que venzan en los próximos 30 días":"No hay pólizas con pagos programados en las próximas 2 semanas"});return}Ve(!0),ze(null);try{await sendReportEmail(Br,w),ze({type:"success",message:`Recordatorios enviados exitosamente a ${Br.length} titular(es)`})}catch(Lr){console.error("Error sending emails:",Lr),ze({type:"error",message:"Error al enviar los recordatorios por email: "+Lr.message})}finally{Ve(!1)}},Ir=Et=>{je(dr=>({...dr,[Et]:!dr[Et]}))},Or=async Et=>{const dr=wr(Et),Br=(ke[dr]||"No Pagado")==="Pagado"?"No Pagado":"Pagado";try{await policyStatusService.updateStatus(dr,Br),Ne(Lr=>({...Lr,[dr]:Br})),c.success(`Estado actualizado: ${Br}`)}catch(Lr){console.error("Error updating status:",Lr),c.error("Error al actualizar el estado")}},Fr=Et=>{const dr=wr(Et);return ke[dr]||"No Pagado"};return jsxRuntimeExports.jsxs("div",{className:"reports-container",children:[jsxRuntimeExports.jsxs("div",{className:"reports-header",children:[jsxRuntimeExports.jsx("h2",{children:"Reportes"}),jsxRuntimeExports.jsxs("div",{className:"reports-controls",children:[jsxRuntimeExports.jsx("div",{className:"search-bar",children:jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Buscar en todas las pólizas...",value:Re,onChange:Et=>Pe(Et.target.value),className:"search-input"})}),jsxRuntimeExports.jsx("div",{className:"view-toggle",children:jsxRuntimeExports.jsx("button",{className:`toggle-btn ${E==="table"?"active":""}`,onClick:()=>r(E==="table"?"cards":"table"),title:E==="table"?"Ver como tarjetas":"Ver como tabla",children:E==="table"?jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:jsxRuntimeExports.jsx("path",{d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}):jsxRuntimeExports.jsxs("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:[jsxRuntimeExports.jsx("rect",{x:"4",y:"4",width:"7",height:"7"}),jsxRuntimeExports.jsx("rect",{x:"13",y:"4",width:"7",height:"7"}),jsxRuntimeExports.jsx("rect",{x:"4",y:"13",width:"7",height:"7"}),jsxRuntimeExports.jsx("rect",{x:"13",y:"13",width:"7",height:"7"})]})})}),!Re.trim()&&jsxRuntimeExports.jsxs("div",{className:"filters",children:[jsxRuntimeExports.jsx("select",{className:"filter-select",value:w,onChange:Et=>S(Et.target.value),children:REPORT_TYPES.map(Et=>jsxRuntimeExports.jsx("option",{value:Et,children:Et},Et))}),w!=="Matriz de Productos"&&jsxRuntimeExports.jsx("select",{className:"filter-select",value:v,onChange:Et=>T(Number(Et.target.value)),children:MONTHS.map((Et,dr)=>jsxRuntimeExports.jsx("option",{value:dr,children:Et},Et))})]}),w!=="Matriz de Productos"&&jsxRuntimeExports.jsx("button",{className:"send-email-btn",onClick:mr,disabled:Me||I.length===0,children:Me?"Enviando...":"Enviar por Email"})]})]}),me&&jsxRuntimeExports.jsx("div",{className:"error-message",children:me}),We&&jsxRuntimeExports.jsx("div",{className:`email-status ${We.type}`,children:We.message}),ie?jsxRuntimeExports.jsx("div",{className:"loading-message",children:"Cargando datos..."}):Ge?jsxRuntimeExports.jsx("div",{className:"loading-message",children:"Cargando estados de pólizas..."}):jsxRuntimeExports.jsxs("div",{className:`reports-layout ${w==="Vencimientos"&&Ut||w==="Matriz de Productos"&&pt?"with-graphics":"no-graphics"}`,children:[jsxRuntimeExports.jsx("div",{className:`reports-left-panel ${w==="Vencimientos"&&Ut||w==="Matriz de Productos"&&pt?"with-right-panel":"full-width"}`,children:jsxRuntimeExports.jsx("div",{className:E==="table"?"table-container":"cards-grid",children:w==="Matriz de Productos"?jsxRuntimeExports.jsx("div",{className:"matrix-container",children:jsxRuntimeExports.jsxs("div",{className:"matrix-section",children:[jsxRuntimeExports.jsx("h3",{className:"matrix-title",children:"Matriz Comparativa de Clientes por Ramo y Aseguradora"}),jsxRuntimeExports.jsxs("div",{className:"matrix-filters",children:[jsxRuntimeExports.jsx("div",{className:"matrix-search-bar",children:jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Buscar cliente...",value:Wt,onChange:Et=>Lt(Et.target.value),className:"matrix-search-input"})}),jsxRuntimeExports.jsxs("div",{className:"matrix-filter-selects",children:[jsxRuntimeExports.jsxs("select",{className:"matrix-filter-select",value:qe,onChange:Et=>$e(Et.target.value),children:[jsxRuntimeExports.jsx("option",{value:"",children:"Todos los Ramos"}),Rt.map(Et=>jsxRuntimeExports.jsx("option",{value:Et,children:Et},Et))]}),jsxRuntimeExports.jsxs("select",{className:"matrix-filter-select",value:Be,onChange:Et=>Xe(Et.target.value),children:[jsxRuntimeExports.jsx("option",{value:"",children:"Todas las Aseguradoras"}),Ct.map(Et=>jsxRuntimeExports.jsx("option",{value:Et,children:Et},Et))]})]})]}),Le.length===0||Rt.length===0||Ct.length===0?jsxRuntimeExports.jsx("div",{className:"matrix-no-data",children:jsxRuntimeExports.jsxs("div",{className:"no-data-message",children:[jsxRuntimeExports.jsx("h4",{children:"No hay datos disponibles para mostrar la matriz"}),jsxRuntimeExports.jsxs("p",{children:[Le.length===0&&"No se encontraron clientes. ",Rt.length===0&&"No se encontraron ramos de seguros. ",Ct.length===0&&"No se encontraron aseguradoras. "]}),jsxRuntimeExports.jsx("p",{children:"Verifique que las pólizas tengan datos completos de contratante, ramo y aseguradora."})]})}):(()=>{const Et=Le.filter(dr=>Wt.trim()?dr.toLowerCase().includes(Wt.toLowerCase()):!0).filter(dr=>{if(qe){const br=te.filter(Lr=>Lr.contratante===dr);return[...new Set(br.map(Lr=>Lr.ramo))].includes(qe)}return!0}).filter(dr=>{if(Be){const br=te.filter(Lr=>Lr.contratante===dr);return[...new Set(br.map(Lr=>lr(Lr.aseguradora)))].includes(Be)}return!0});return Et.length===0?jsxRuntimeExports.jsx("div",{className:"matrix-no-results",children:jsxRuntimeExports.jsxs("div",{className:"no-data-message",children:[jsxRuntimeExports.jsx("h4",{children:"No se encontraron resultados"}),jsxRuntimeExports.jsx("p",{children:"No hay clientes que coincidan con los filtros aplicados."}),jsxRuntimeExports.jsx("p",{children:"Intente ajustar los criterios de búsqueda o filtros."})]})}):jsxRuntimeExports.jsxs("table",{className:"matrix-table",children:[jsxRuntimeExports.jsxs("thead",{children:[jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{rowSpan:"2",children:"Cliente"}),jsxRuntimeExports.jsx("th",{colSpan:Rt.length,children:"Ramos de Seguros"}),jsxRuntimeExports.jsx("th",{colSpan:Ct.length,children:"Aseguradoras"}),jsxRuntimeExports.jsx("th",{rowSpan:"2",children:"Total Pólizas"})]}),jsxRuntimeExports.jsxs("tr",{children:[Rt.map(dr=>jsxRuntimeExports.jsx("th",{className:"ramo-header",children:dr},dr)),Ct.map(dr=>jsxRuntimeExports.jsx("th",{className:"company-header",children:dr},dr))]})]}),jsxRuntimeExports.jsx("tbody",{children:Et.map(dr=>{const br=te.filter(or=>or.contratante===dr),Br=[...new Set(br.map(or=>or.ramo))],Lr=[...new Set(br.map(or=>lr(or.aseguradora)))];return jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"client-name",children:dr}),Rt.map(or=>{const ur=Br.includes(or),gr=br.filter($r=>$r.ramo===or).map($r=>$r.aseguradora);return jsxRuntimeExports.jsx("td",{className:ur?"has-policy":"no-policy",title:ur?`${dr} tiene ${or} con: ${[...new Set(gr)].join(", ")}`:`${dr} no tiene póliza de ${or}`,children:ur?"✓":"×"},`${dr}-ramo-${or}`)}),Ct.map(or=>{const ur=Lr.includes(or),gr=br.filter($r=>lr($r.aseguradora)===or).map($r=>$r.ramo);return jsxRuntimeExports.jsx("td",{className:ur?"has-policy":"no-policy",title:ur?`${dr} tiene con ${or}: ${[...new Set(gr)].join(", ")}`:`${dr} no tiene póliza con ${or}`,children:ur?"✓":"×"},`${dr}-company-${or}`)}),jsxRuntimeExports.jsx("td",{className:"policy-count",children:br.length})]},dr)})}),jsxRuntimeExports.jsx("tfoot",{children:jsxRuntimeExports.jsxs("tr",{className:"summary-row",children:[jsxRuntimeExports.jsx("td",{children:jsxRuntimeExports.jsx("strong",{children:"Total por Categoría"})}),Rt.map(dr=>{const br=te.filter(Br=>Br.ramo===dr).length;return jsxRuntimeExports.jsx("td",{className:"ramo-total",children:jsxRuntimeExports.jsx("strong",{children:br})},dr)}),Ct.map(dr=>{const br=te.filter(Br=>lr(Br.aseguradora)===dr).length;return jsxRuntimeExports.jsx("td",{className:"company-total",children:jsxRuntimeExports.jsx("strong",{children:br})},dr)}),jsxRuntimeExports.jsx("td",{className:"grand-total",children:jsxRuntimeExports.jsx("strong",{children:te.length})})]})})]})})()]})}):I.length===0?jsxRuntimeExports.jsx("div",{className:"no-data",children:"No se encontraron pólizas"}):E==="table"?jsxRuntimeExports.jsxs("table",{className:"reports-table",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{children:"Ramo"}),jsxRuntimeExports.jsx("th",{children:"Póliza"}),jsxRuntimeExports.jsx("th",{children:"Contratante"}),jsxRuntimeExports.jsx("th",{children:"Email"}),jsxRuntimeExports.jsx("th",{children:"Aseguradora"}),jsxRuntimeExports.jsx("th",{children:"Fecha Inicio"}),jsxRuntimeExports.jsx("th",{children:"Fecha Fin"}),jsxRuntimeExports.jsx("th",{children:"Prima Total"}),jsxRuntimeExports.jsx("th",{children:"Forma de Pago"}),jsxRuntimeExports.jsx("th",{children:"Próximo Pago"}),jsxRuntimeExports.jsx("th",{children:"Status"})]})}),jsxRuntimeExports.jsx("tbody",{children:I.map(Et=>{var dr;return jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{children:Et.ramo}),jsxRuntimeExports.jsx("td",{children:Et.numero_poliza}),jsxRuntimeExports.jsx("td",{children:Et.contratante}),jsxRuntimeExports.jsx("td",{children:Et.email||"No disponible"}),jsxRuntimeExports.jsx("td",{children:Et.aseguradora}),jsxRuntimeExports.jsx("td",{children:formatDate(Et.fecha_inicio,Ce)}),jsxRuntimeExports.jsx("td",{children:formatDate(Et.fecha_fin,Ce)}),jsxRuntimeExports.jsxs("td",{children:["$",((dr=Et.prima_total)==null?void 0:dr.toLocaleString())||"0"]}),jsxRuntimeExports.jsx("td",{children:Et.forma_pago}),jsxRuntimeExports.jsx("td",{children:Et.fecha_proximo_pago?formatDate(Et.fecha_proximo_pago,Ce):"N/A"}),jsxRuntimeExports.jsx("td",{children:jsxRuntimeExports.jsx("button",{onClick:()=>Or(Et),className:`status-toggle ${Fr(Et).toLowerCase().replace(" ","-")}`,children:Fr(Et)})})]},`${Et.id}-${Et.numero_poliza}`)})})]}):I.map(Et=>{var dr,br,Br,Lr,or,ur,gr;return jsxRuntimeExports.jsxs("div",{className:`report-card ${Ue[`${Et.id}-${Et.numero_poliza}`]?"expanded":""}`,onClick:()=>Ir(`${Et.id}-${Et.numero_poliza}`),children:[jsxRuntimeExports.jsxs("div",{className:"card-header",children:[jsxRuntimeExports.jsxs("div",{className:"card-header-content",children:[jsxRuntimeExports.jsxs("div",{className:"card-header-details",children:[jsxRuntimeExports.jsx("span",{className:"policy-ramo",children:Et.ramo}),jsxRuntimeExports.jsx("span",{className:"report-type",children:Et.aseguradora})]}),jsxRuntimeExports.jsx("h3",{children:Et.numero_poliza})]}),jsxRuntimeExports.jsx("button",{onClick:$r=>{$r.stopPropagation(),Or(Et)},className:`status-toggle ${Fr(Et).toLowerCase().replace(" ","-")}`,children:Fr(Et)})]}),jsxRuntimeExports.jsxs("div",{className:"card-content",children:[jsxRuntimeExports.jsx("div",{className:"card-info",children:jsxRuntimeExports.jsxs("strong",{children:["Contratante: ",Et.contratante]})}),jsxRuntimeExports.jsx("div",{className:"card-details",children:Ue[`${Et.id}-${Et.numero_poliza}`]?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Email:"})," ",Et.email||"No disponible"]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"RFC:"})," ",Et.rfc||"No disponible"]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Asegurado:"})," ",Et.asegurado||"No disponible"]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Inicio:"})," ",formatDate(Et.fecha_inicio)]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Vencimiento:"})," ",formatDate(Et.fecha_fin)]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Forma de Pago:"})," ",Et.forma_pago]}),jsxRuntimeExports.jsxs("div",{className:"card-section",children:[jsxRuntimeExports.jsx("h4",{children:"Información de Pagos"}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Prima Neta:"})," $",((br=Et.prima_neta)==null?void 0:br.toLocaleString())||"0"]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Derecho de Póliza:"})," $",((Br=Et.derecho_poliza)==null?void 0:Br.toLocaleString())||"0"]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Recargo por Pago Fraccionado:"})," $",((Lr=Et.recargo_pago_fraccionado)==null?void 0:Lr.toLocaleString())||"0"]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"IVA:"})," $",((or=Et.iva)==null?void 0:or.toLocaleString())||"0"]}),jsxRuntimeExports.jsxs("p",{className:"card-amount",children:[jsxRuntimeExports.jsx("span",{children:"Prima Total:"})," $",((ur=Et.pago_total)==null?void 0:ur.toLocaleString())||"0"]}),Et.pagos_fraccionados&&jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Pagos Fraccionados:"})," ",Et.pagos_fraccionados]}),Et.pago_parcial&&jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Pago Parcial:"})," $",(gr=Et.pago_parcial)==null?void 0:gr.toLocaleString()]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Próximo Pago:"})," ",Et.fecha_proximo_pago?formatDate(Et.fecha_proximo_pago):"N/A"]})]})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Vencimiento:"})," ",formatDate(Et.fecha_fin)]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Prima Total:"})," $",((dr=Et.prima_total)==null?void 0:dr.toLocaleString())||"0"]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("span",{children:"Forma de Pago:"})," ",Et.forma_pago]})]})})]}),jsxRuntimeExports.jsx("div",{className:"card-footer",children:jsxRuntimeExports.jsx("button",{className:"expand-btn",children:Ue[`${Et.id}-${Et.numero_poliza}`]?"−":"+"})})]},`${Et.id}-${Et.numero_poliza}`)})})}),(w==="Vencimientos"||w==="Matriz de Productos")&&jsxRuntimeExports.jsx("div",{className:"graphics-control-container",children:jsxRuntimeExports.jsx("button",{className:`unified-graphics-btn ${w==="Vencimientos"&&Ut||w==="Matriz de Productos"&&pt?"active":""}`,onClick:()=>{w==="Vencimientos"?hr(!Ut):w==="Matriz de Productos"&&yr(!pt),Qe(!1)},title:w==="Vencimientos"?Ut?"Ocultar gráficos":"Mostrar gráficos":pt?"Ocultar gráficos":"Mostrar gráficos",children:w==="Vencimientos"&&Ut||w==="Matriz de Productos"&&pt?jsxRuntimeExports.jsx("span",{children:"×"}):jsxRuntimeExports.jsx("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",width:"20",height:"20",children:jsxRuntimeExports.jsx("path",{d:"M3 3v18h18M8 17l4-4 4 4 6-6"})})})}),w==="Vencimientos"&&Ut&&jsxRuntimeExports.jsx("div",{className:"reports-right-panel",children:jsxRuntimeExports.jsx(VencimientosGraphics,{policies:te,timeView:vt,onTimeViewChange:Dt})}),w==="Matriz de Productos"&&pt&&jsxRuntimeExports.jsx("div",{className:"reports-right-panel",children:jsxRuntimeExports.jsx(MatrixGraphics,{policies:te,uniqueRamos:Rt,uniqueCompanies:Ct})})]})]})}const Tasks=()=>{const{theme:E}=useTheme(),r=E==="dark";return jsxRuntimeExports.jsxs("div",{className:r?"bg-gray-900 text-white":"bg-gray-50 text-gray-900",children:[jsxRuntimeExports.jsxs("div",{className:"p-4 pb-0",children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-bold",children:"Tareas"}),jsxRuntimeExports.jsx("p",{className:`text-sm mt-1 ${r?"text-gray-400":"text-gray-600"}`})]}),jsxRuntimeExports.jsx("div",{className:`m-4 rounded overflow-hidden shadow ${r?"bg-gray-800":"bg-white"}`,children:jsxRuntimeExports.jsx(NotionComponent,{})})]})};var propTypes={exports:{}},ReactPropTypesSecret$1="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",ReactPropTypesSecret_1=ReactPropTypesSecret$1,ReactPropTypesSecret=ReactPropTypesSecret_1;function emptyFunction(){}function emptyFunctionWithReset(){}emptyFunctionWithReset.resetWarningCache=emptyFunction;var factoryWithThrowingShims=function(){function E(T,w,S,I,H,te){if(te!==ReactPropTypesSecret){var ae=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw ae.name="Invariant Violation",ae}}E.isRequired=E;function r(){return E}var v={array:E,bigint:E,bool:E,func:E,number:E,object:E,string:E,symbol:E,any:E,arrayOf:r,element:E,elementType:E,instanceOf:r,node:E,objectOf:r,oneOf:r,oneOfType:r,shape:r,exact:r,checkPropTypes:emptyFunctionWithReset,resetWarningCache:emptyFunction};return v.PropTypes=v,v};propTypes.exports=factoryWithThrowingShims();var propTypesExports=propTypes.exports;const PropTypes=getDefaultExportFromCjs(propTypesExports),API_BASE_URL$1=API_URL.replace("/api","/api/sharepoint"),sharepointService={async getTasks(E,r={}){return(await axios.get(`${API_BASE_URL$1}/tasks`,{params:{userId:E,...r}})).data},async createTask(E){return(await axios.post(`${API_BASE_URL$1}/tasks`,E)).data},async updateTask(E,r){return(await axios.put(`${API_BASE_URL$1}/tasks/${E}`,r)).data},async deleteTask(E){return(await axios.delete(`${API_BASE_URL$1}/tasks/${E}`)).data},async getTags(){return(await axios.get(`${API_BASE_URL$1}/tags`)).data},async getNotifications(E){return(await axios.get(`${API_BASE_URL$1}/notifications/${E}`)).data},async markNotificationAsRead(E){return(await axios.put(`${API_BASE_URL$1}/notifications/${E}/read`)).data},async getCollaborators(){return(await axios.get(`${API_BASE_URL$1}/collaborators`)).data},async addCollaborator(E){return(await axios.post(`${API_BASE_URL$1}/collaborators`,E)).data}},customScrollbarStyles=`
  .custom-scrollbar::-webkit-scrollbar {
    width: 8px;
  }
  .custom-scrollbar::-webkit-scrollbar-track {
    background: rgba(31, 41, 55, 0.5);
    border-radius: 4px;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: rgba(79, 70, 229, 0.3);
    border-radius: 4px;
    min-height: 40px;
  }
  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: rgba(79, 70, 229, 0.5);
  }
  .custom-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: rgba(79, 70, 229, 0.3) rgba(31, 41, 55, 0.5);
  }
`,styleSheet=document.createElement("style");styleSheet.type="text/css";styleSheet.innerText=customScrollbarStyles;document.head.appendChild(styleSheet);const Sharepoint=({currentUser:E="default_user"})=>{const[r,v]=reactExports.useState(!0),[T,w]=reactExports.useState(null),[S,I]=reactExports.useState(!1),[H,te]=reactExports.useState(!1),[ae,ie]=reactExports.useState(null),[ce,me]=reactExports.useState("cards"),[_e,Re]=reactExports.useState(""),[Pe,Ce]=reactExports.useState({title:"",priority:"Media",status:"Pendiente",assigned_to:"",due_date:"",description:"",created_by:E}),[Fe,Me]=reactExports.useState([]),[Ve,We]=reactExports.useState([]),[ze,Ue]=reactExports.useState([]),[je,ke]=reactExports.useState(""),[Ne,Ge]=reactExports.useState([]),[Ie,Le]=reactExports.useState(!1),[He,Ct]=reactExports.useState([]),[Ze,Rt]=reactExports.useState(!0),[nt,nr]=reactExports.useState(null);reactExports.useEffect(()=>{(async()=>{Rt(!0),nr(null);try{const vt=await sharepointService.getTasks(E);Me(vt);const Dt=await sharepointService.getTags();We(Dt);const Ut=await sharepointService.getNotifications(E);Ge(Ut);const hr=await sharepointService.getCollaborators();Ct(hr)}catch(vt){console.error("Error loading data:",vt),nr("Error loading data. Please try again.")}finally{Rt(!1)}})()},[E]);const Je=Qe=>{w({...Qe}),ie({...Qe}),te(!0)},Wt=async()=>{try{if(Rt(!0),nr(null),!Pe.title)throw new Error("Title is required");const Qe={...Pe,tags:ze},vt=await sharepointService.createTask(Qe);Me(Dt=>[...Dt,vt]),I(!1),Ce({title:"",priority:"Media",status:"Pendiente",assigned_to:"",due_date:"",description:"",created_by:E}),Ue([])}catch(Qe){console.error("Error creating task:",Qe),nr(Qe.message||"Error creating task. Please try again.")}finally{Rt(!1)}},Lt=async Qe=>{try{window.confirm(`¿Estás seguro de que quieres eliminar esta tarea?
Esta acción no se puede deshacer.`)&&(Rt(!0),await sharepointService.deleteTask(Qe.id),Me(Dt=>Dt.filter(Ut=>Ut.id!==Qe.id)),w(null),te(!1))}catch(vt){console.error("Error deleting task:",vt),nr("Error deleting task. Please try again.")}finally{Rt(!1)}},qe=async()=>{try{await sharepointService.updateTask(ae.id,ae),Me(Qe=>Qe.map(vt=>vt.id===ae.id?ae:vt)),te(!1),ie(null),w(null)}catch(Qe){console.error("Error updating task:",Qe)}},$e=async(Qe,vt)=>{try{const Dt={...Qe,status:vt};await sharepointService.updateTask(Qe.id,Dt),Me(Ut=>Ut.map(hr=>hr.id===Qe.id?Dt:hr))}catch(Dt){console.error("Error updating task status:",Dt)}},Be=(Fe==null?void 0:Fe.filter(Qe=>{var vt,Dt,Ut;return((vt=Qe.title)==null?void 0:vt.toLowerCase().includes(_e.toLowerCase()))||((Dt=Qe.description)==null?void 0:Dt.toLowerCase().includes(_e.toLowerCase()))||((Ut=Qe.assigned_to)==null?void 0:Ut.toLowerCase().includes(_e.toLowerCase()))}))||[],Xe=()=>{if(je.trim()){const Qe={id:Ve.length+1,name:je.trim().toLowerCase(),color:"accent"};We([...Ve,Qe]),ke("")}},rt=Qe=>{w(Qe),ie({...Qe}),te(!0)};return jsxRuntimeExports.jsx("div",{className:`sharepoint-container ${r?"expanded":""}`,children:Ze?jsxRuntimeExports.jsx("div",{className:"loading-spinner",children:"Loading..."}):nt?jsxRuntimeExports.jsx("div",{className:"error-message",children:nt}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"sharepoint-header",children:[jsxRuntimeExports.jsxs("div",{className:"header-main",children:[jsxRuntimeExports.jsxs("div",{className:"header-left",children:[jsxRuntimeExports.jsx("h2",{children:"Sharepoint"}),jsxRuntimeExports.jsx("button",{onClick:()=>v(!r),className:"expand-button",children:jsxRuntimeExports.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:jsxRuntimeExports.jsx("polyline",{points:"6 9 12 15 18 9"})})})]}),r&&jsxRuntimeExports.jsxs("div",{className:"header-actions",children:[jsxRuntimeExports.jsxs("div",{className:"view-toggles",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>me("cards"),className:`view-toggle ${ce==="cards"?"active":""}`,title:"Card View",children:[jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("rect",{x:"3",y:"3",width:"7",height:"7"}),jsxRuntimeExports.jsx("rect",{x:"14",y:"3",width:"7",height:"7"}),jsxRuntimeExports.jsx("rect",{x:"14",y:"14",width:"7",height:"7"}),jsxRuntimeExports.jsx("rect",{x:"3",y:"14",width:"7",height:"7"})]}),jsxRuntimeExports.jsx("span",{className:"tooltip",children:"Card View"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>me("table"),className:`view-toggle ${ce==="table"?"active":""}`,title:"Table View",children:[jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),jsxRuntimeExports.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),jsxRuntimeExports.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]}),jsxRuntimeExports.jsx("span",{className:"tooltip",children:"Table View"})]})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>I(!0),className:"create-task-button",title:"Create New Task",children:[jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),jsxRuntimeExports.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),jsxRuntimeExports.jsx("span",{children:"Nueva Tarea"}),jsxRuntimeExports.jsx("span",{className:"tooltip",children:"Create New Task"})]}),jsxRuntimeExports.jsx("div",{className:"notifications-container",children:jsxRuntimeExports.jsxs("button",{onClick:()=>Le(!Ie),className:"notifications-button",title:"Notifications",children:[jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),jsxRuntimeExports.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),Ne.some(Qe=>!Qe.read)&&jsxRuntimeExports.jsx("span",{className:"notification-badge"}),jsxRuntimeExports.jsx("span",{className:"tooltip",children:"Notifications"})]})})]})]}),r&&jsxRuntimeExports.jsxs("div",{className:"search-section",children:[jsxRuntimeExports.jsxs("div",{className:"search-container",children:[jsxRuntimeExports.jsx("input",{type:"text",value:_e,onChange:Qe=>Re(Qe.target.value),placeholder:"Buscar tareas...",className:"search-input"}),jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"search-icon",children:[jsxRuntimeExports.jsx("circle",{cx:"11",cy:"11",r:"8"}),jsxRuntimeExports.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]})]}),jsxRuntimeExports.jsxs("div",{className:"tags-container",children:[Ve.map(Qe=>jsxRuntimeExports.jsxs("button",{onClick:()=>{Ue(vt=>vt.includes(Qe.name)?vt.filter(Dt=>Dt!==Qe.name):[...vt,Qe.name])},className:`tag ${ze.includes(Qe.name)?"selected":""}`,children:["#",Qe.name]},Qe.id)),jsxRuntimeExports.jsx("button",{onClick:Xe,className:"add-tag-button",children:"+ Nueva etiqueta"})]})]})]}),r&&jsxRuntimeExports.jsx("div",{className:"tasks-container custom-scrollbar",children:ce==="cards"?jsxRuntimeExports.jsx("div",{className:"tasks-grid",children:Be.map((Qe,vt)=>jsxRuntimeExports.jsxs("div",{className:"task-card",onClick:()=>Je(Qe),children:[jsxRuntimeExports.jsxs("div",{className:"task-card-header",children:[jsxRuntimeExports.jsx("h3",{children:Qe.title}),jsxRuntimeExports.jsxs("div",{className:"task-card-actions",children:[jsxRuntimeExports.jsx("button",{onClick:Dt=>{Dt.stopPropagation(),rt(Qe)},className:"edit-button",children:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),jsxRuntimeExports.jsx("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})]})}),jsxRuntimeExports.jsx("button",{onClick:Dt=>{Dt.stopPropagation(),Lt(Qe)},className:"delete-button",children:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),jsxRuntimeExports.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})]}),jsxRuntimeExports.jsxs("div",{className:"task-card-content",children:[jsxRuntimeExports.jsxs("div",{className:"task-labels",children:[jsxRuntimeExports.jsx("span",{className:"priority-label",children:Qe.priority}),jsxRuntimeExports.jsxs("select",{value:Qe.status,onChange:Dt=>{Dt.stopPropagation(),$e(Qe,Dt.target.value)},className:"status-select",onClick:Dt=>Dt.stopPropagation(),children:[jsxRuntimeExports.jsx("option",{value:"Pendiente",children:"Pendiente"}),jsxRuntimeExports.jsx("option",{value:"En Progreso",children:"En Progreso"}),jsxRuntimeExports.jsx("option",{value:"Completado",children:"Completado"})]})]}),jsxRuntimeExports.jsxs("div",{className:"task-details",children:[Qe.description&&jsxRuntimeExports.jsxs("div",{className:"task-description",children:[jsxRuntimeExports.jsx("span",{className:"detail-label",children:"Description:"}),jsxRuntimeExports.jsx("span",{className:"detail-value",children:Qe.description})]}),Qe.assigned_to&&jsxRuntimeExports.jsxs("div",{className:"task-assignee",children:[jsxRuntimeExports.jsx("span",{className:"detail-label",children:"Assigned to:"}),jsxRuntimeExports.jsx("span",{className:"detail-value",children:Qe.assigned_to})]}),Qe.due_date&&jsxRuntimeExports.jsxs("div",{className:"task-due-date",children:[jsxRuntimeExports.jsx("span",{className:"detail-label",children:"Due date:"}),jsxRuntimeExports.jsx("span",{className:"detail-value",children:Qe.due_date})]})]})]})]},vt))}):jsxRuntimeExports.jsx("div",{className:"tasks-table-container",children:jsxRuntimeExports.jsxs("table",{className:"tasks-table",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{children:"Título"}),jsxRuntimeExports.jsx("th",{children:"Prioridad"}),jsxRuntimeExports.jsx("th",{children:"Estado"}),jsxRuntimeExports.jsx("th",{children:"Asignado a"}),jsxRuntimeExports.jsx("th",{children:"Fecha límite"}),jsxRuntimeExports.jsx("th",{children:"Acciones"})]})}),jsxRuntimeExports.jsx("tbody",{children:Be.map((Qe,vt)=>jsxRuntimeExports.jsxs("tr",{onClick:()=>Je(Qe),children:[jsxRuntimeExports.jsx("td",{children:Qe.title}),jsxRuntimeExports.jsx("td",{children:jsxRuntimeExports.jsx("span",{className:"priority-label",children:Qe.priority})}),jsxRuntimeExports.jsx("td",{children:jsxRuntimeExports.jsxs("select",{value:Qe.status,onChange:Dt=>{Dt.stopPropagation(),$e(Qe,Dt.target.value)},className:"status-select",onClick:Dt=>Dt.stopPropagation(),children:[jsxRuntimeExports.jsx("option",{value:"Pendiente",children:"Pendiente"}),jsxRuntimeExports.jsx("option",{value:"En Progreso",children:"En Progreso"}),jsxRuntimeExports.jsx("option",{value:"Completado",children:"Completado"})]})}),jsxRuntimeExports.jsx("td",{children:Qe.assigned_to}),jsxRuntimeExports.jsx("td",{children:Qe.due_date}),jsxRuntimeExports.jsx("td",{children:jsxRuntimeExports.jsx("div",{className:"table-actions",children:jsxRuntimeExports.jsx("button",{onClick:Dt=>{Dt.stopPropagation(),Lt(Qe)},className:"delete-button",children:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),jsxRuntimeExports.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})})})]},vt))})]})})}),S&&jsxRuntimeExports.jsx("div",{className:"modal-overlay",children:jsxRuntimeExports.jsxs("div",{className:"modal",children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsx("h3",{children:"Nueva Tarea"}),jsxRuntimeExports.jsx("button",{onClick:()=>I(!1),className:"close-button",children:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),jsxRuntimeExports.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),jsxRuntimeExports.jsxs("div",{className:"modal-content",children:[jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsxs("label",{children:["Título ",jsxRuntimeExports.jsx("span",{className:"required",children:"*"})]}),jsxRuntimeExports.jsx("input",{type:"text",value:Pe.title,onChange:Qe=>Ce({...Pe,title:Qe.target.value}),className:"form-input",placeholder:"Enter task title"})]}),jsxRuntimeExports.jsxs("div",{className:"form-row",children:[jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Prioridad"}),jsxRuntimeExports.jsxs("select",{value:Pe.priority,onChange:Qe=>Ce({...Pe,priority:Qe.target.value}),className:"form-select",children:[jsxRuntimeExports.jsx("option",{value:"Baja",children:"Baja"}),jsxRuntimeExports.jsx("option",{value:"Media",children:"Media"}),jsxRuntimeExports.jsx("option",{value:"Alta",children:"Alta"})]})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Estado"}),jsxRuntimeExports.jsxs("select",{value:Pe.status,onChange:Qe=>Ce({...Pe,status:Qe.target.value}),className:"form-select",children:[jsxRuntimeExports.jsx("option",{value:"Pendiente",children:"Pendiente"}),jsxRuntimeExports.jsx("option",{value:"En Progreso",children:"En Progreso"}),jsxRuntimeExports.jsx("option",{value:"Completado",children:"Completado"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Asignado a"}),jsxRuntimeExports.jsx("input",{type:"text",value:Pe.assigned_to,onChange:Qe=>Ce({...Pe,assigned_to:Qe.target.value}),className:"form-input",placeholder:"Enter assignee name"})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Fecha límite"}),jsxRuntimeExports.jsx("input",{type:"date",value:Pe.due_date,onChange:Qe=>Ce({...Pe,due_date:Qe.target.value}),className:"form-input"})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Descripción"}),jsxRuntimeExports.jsx("textarea",{value:Pe.description,onChange:Qe=>Ce({...Pe,description:Qe.target.value}),className:"form-textarea",placeholder:"Enter task description",rows:4})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Tags"}),jsxRuntimeExports.jsx("div",{className:"tags-input",children:Ve.map(Qe=>jsxRuntimeExports.jsxs("label",{className:"tag-checkbox",children:[jsxRuntimeExports.jsx("input",{type:"checkbox",checked:ze.includes(Qe.name),onChange:()=>{Ue(vt=>vt.includes(Qe.name)?vt.filter(Dt=>Dt!==Qe.name):[...vt,Qe.name])}}),jsxRuntimeExports.jsx("span",{className:"tag-label",children:Qe.name})]},Qe.id))})]})]}),jsxRuntimeExports.jsxs("div",{className:"modal-footer",children:[jsxRuntimeExports.jsx("button",{onClick:()=>I(!1),className:"cancel-button",disabled:Ze,children:"Cancelar"}),jsxRuntimeExports.jsx("button",{onClick:Wt,className:"create-button",disabled:Ze||!Pe.title,children:Ze?"Creating...":"Crear Tarea"})]})]})}),H&&jsxRuntimeExports.jsx("div",{className:"modal-overlay",children:jsxRuntimeExports.jsxs("div",{className:"modal",children:[jsxRuntimeExports.jsxs("div",{className:"modal-header",children:[jsxRuntimeExports.jsx("input",{type:"text",value:ae.title,onChange:Qe=>ie({...ae,title:Qe.target.value}),className:"edit-title-input"}),jsxRuntimeExports.jsx("button",{onClick:()=>{te(!1),ie(null),w(null)},className:"close-button",children:jsxRuntimeExports.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[jsxRuntimeExports.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),jsxRuntimeExports.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),jsxRuntimeExports.jsxs("div",{className:"modal-content",children:[jsxRuntimeExports.jsxs("div",{className:"form-row",children:[jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Prioridad"}),jsxRuntimeExports.jsxs("select",{value:ae.priority,onChange:Qe=>ie({...ae,priority:Qe.target.value}),className:"form-select",children:[jsxRuntimeExports.jsx("option",{value:"Baja",children:"Baja"}),jsxRuntimeExports.jsx("option",{value:"Media",children:"Media"}),jsxRuntimeExports.jsx("option",{value:"Alta",children:"Alta"})]})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Estado"}),jsxRuntimeExports.jsxs("select",{value:ae.status,onChange:Qe=>ie({...ae,status:Qe.target.value}),className:"form-select",children:[jsxRuntimeExports.jsx("option",{value:"Pendiente",children:"Pendiente"}),jsxRuntimeExports.jsx("option",{value:"En Progreso",children:"En Progreso"}),jsxRuntimeExports.jsx("option",{value:"Completado",children:"Completado"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Asignado a"}),jsxRuntimeExports.jsx("input",{type:"text",value:ae.assigned_to||"",onChange:Qe=>ie({...ae,assigned_to:Qe.target.value}),className:"form-input"})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Fecha límite"}),jsxRuntimeExports.jsx("input",{type:"date",value:ae.due_date||"",onChange:Qe=>ie({...ae,due_date:Qe.target.value}),className:"form-input"})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{children:"Descripción"}),jsxRuntimeExports.jsx("textarea",{value:ae.description||"",onChange:Qe=>ie({...ae,description:Qe.target.value}),className:"form-textarea",rows:4})]})]}),jsxRuntimeExports.jsxs("div",{className:"modal-footer",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{te(!1),ie(null),w(null)},className:"cancel-button",children:"Cancelar"}),jsxRuntimeExports.jsx("button",{onClick:qe,className:"save-button",children:"Guardar Cambios"})]})]})})]})})};Sharepoint.propTypes={currentUser:PropTypes.string};const getDefaultsFromPostinstall=()=>{};var define_process_env_default$1={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const stringToByteArray$1=function(E){const r=[];let v=0;for(let T=0;T<E.length;T++){let w=E.charCodeAt(T);w<128?r[v++]=w:w<2048?(r[v++]=w>>6|192,r[v++]=w&63|128):(w&64512)===55296&&T+1<E.length&&(E.charCodeAt(T+1)&64512)===56320?(w=65536+((w&1023)<<10)+(E.charCodeAt(++T)&1023),r[v++]=w>>18|240,r[v++]=w>>12&63|128,r[v++]=w>>6&63|128,r[v++]=w&63|128):(r[v++]=w>>12|224,r[v++]=w>>6&63|128,r[v++]=w&63|128)}return r},byteArrayToString=function(E){const r=[];let v=0,T=0;for(;v<E.length;){const w=E[v++];if(w<128)r[T++]=String.fromCharCode(w);else if(w>191&&w<224){const S=E[v++];r[T++]=String.fromCharCode((w&31)<<6|S&63)}else if(w>239&&w<365){const S=E[v++],I=E[v++],H=E[v++],te=((w&7)<<18|(S&63)<<12|(I&63)<<6|H&63)-65536;r[T++]=String.fromCharCode(55296+(te>>10)),r[T++]=String.fromCharCode(56320+(te&1023))}else{const S=E[v++],I=E[v++];r[T++]=String.fromCharCode((w&15)<<12|(S&63)<<6|I&63)}}return r.join("")},base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(E,r){if(!Array.isArray(E))throw Error("encodeByteArray takes an array as a parameter");this.init_();const v=r?this.byteToCharMapWebSafe_:this.byteToCharMap_,T=[];for(let w=0;w<E.length;w+=3){const S=E[w],I=w+1<E.length,H=I?E[w+1]:0,te=w+2<E.length,ae=te?E[w+2]:0,ie=S>>2,ce=(S&3)<<4|H>>4;let me=(H&15)<<2|ae>>6,_e=ae&63;te||(_e=64,I||(me=64)),T.push(v[ie],v[ce],v[me],v[_e])}return T.join("")},encodeString(E,r){return this.HAS_NATIVE_SUPPORT&&!r?btoa(E):this.encodeByteArray(stringToByteArray$1(E),r)},decodeString(E,r){return this.HAS_NATIVE_SUPPORT&&!r?atob(E):byteArrayToString(this.decodeStringToByteArray(E,r))},decodeStringToByteArray(E,r){this.init_();const v=r?this.charToByteMapWebSafe_:this.charToByteMap_,T=[];for(let w=0;w<E.length;){const S=v[E.charAt(w++)],H=w<E.length?v[E.charAt(w)]:0;++w;const ae=w<E.length?v[E.charAt(w)]:64;++w;const ce=w<E.length?v[E.charAt(w)]:64;if(++w,S==null||H==null||ae==null||ce==null)throw new DecodeBase64StringError;const me=S<<2|H>>4;if(T.push(me),ae!==64){const _e=H<<4&240|ae>>2;if(T.push(_e),ce!==64){const Re=ae<<6&192|ce;T.push(Re)}}}return T},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let E=0;E<this.ENCODED_VALS.length;E++)this.byteToCharMap_[E]=this.ENCODED_VALS.charAt(E),this.charToByteMap_[this.byteToCharMap_[E]]=E,this.byteToCharMapWebSafe_[E]=this.ENCODED_VALS_WEBSAFE.charAt(E),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[E]]=E,E>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(E)]=E,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(E)]=E)}}};class DecodeBase64StringError extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const base64Encode=function(E){const r=stringToByteArray$1(E);return base64.encodeByteArray(r,!0)},base64urlEncodeWithoutPadding=function(E){return base64Encode(E).replace(/\./g,"")},base64Decode=function(E){try{return base64.decodeString(E,!0)}catch(r){console.error("base64Decode failed: ",r)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getGlobal(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof globalThis<"u")return globalThis;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const getDefaultsFromGlobal=()=>getGlobal().__FIREBASE_DEFAULTS__,getDefaultsFromEnvVariable=()=>{if(typeof process>"u"||typeof define_process_env_default$1>"u")return;const E=define_process_env_default$1.__FIREBASE_DEFAULTS__;if(E)return JSON.parse(E)},getDefaultsFromCookie=()=>{if(typeof document>"u")return;let E;try{E=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const r=E&&base64Decode(E[1]);return r&&JSON.parse(r)},getDefaults=()=>{try{return getDefaultsFromPostinstall()||getDefaultsFromGlobal()||getDefaultsFromEnvVariable()||getDefaultsFromCookie()}catch(E){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${E}`);return}},getDefaultEmulatorHost=E=>{var r,v;return(v=(r=getDefaults())===null||r===void 0?void 0:r.emulatorHosts)===null||v===void 0?void 0:v[E]},getDefaultEmulatorHostnameAndPort=E=>{const r=getDefaultEmulatorHost(E);if(!r)return;const v=r.lastIndexOf(":");if(v<=0||v+1===r.length)throw new Error(`Invalid host ${r} with no separate hostname and port!`);const T=parseInt(r.substring(v+1),10);return r[0]==="["?[r.substring(1,v-1),T]:[r.substring(0,v),T]},getDefaultAppConfig=()=>{var E;return(E=getDefaults())===null||E===void 0?void 0:E.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Deferred{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((r,v)=>{this.resolve=r,this.reject=v})}wrapCallback(r){return(v,T)=>{v?this.reject(v):this.resolve(T),typeof r=="function"&&(this.promise.catch(()=>{}),r.length===1?r(v):r(v,T))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isCloudWorkstation(E){return E.endsWith(".cloudworkstations.dev")}async function pingServer(E){return(await fetch(E,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function createMockUserToken(E,r){if(E.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const v={alg:"none",type:"JWT"},T=r||"demo-project",w=E.iat||0,S=E.sub||E.user_id;if(!S)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const I=Object.assign({iss:`https://securetoken.google.com/${T}`,aud:T,iat:w,exp:w+3600,auth_time:w,sub:S,user_id:S,firebase:{sign_in_provider:"custom",identities:{}}},E);return[base64urlEncodeWithoutPadding(JSON.stringify(v)),base64urlEncodeWithoutPadding(JSON.stringify(I)),""].join(".")}const emulatorStatus={};function getEmulatorSummary(){const E={prod:[],emulator:[]};for(const r of Object.keys(emulatorStatus))emulatorStatus[r]?E.emulator.push(r):E.prod.push(r);return E}function getOrCreateEl(E){let r=document.getElementById(E),v=!1;return r||(r=document.createElement("div"),r.setAttribute("id",E),v=!0),{created:v,element:r}}let previouslyDismissed=!1;function updateEmulatorBanner(E,r){if(typeof window>"u"||typeof document>"u"||!isCloudWorkstation(window.location.host)||emulatorStatus[E]===r||emulatorStatus[E]||previouslyDismissed)return;emulatorStatus[E]=r;function v(me){return`__firebase__banner__${me}`}const T="__firebase__banner",S=getEmulatorSummary().prod.length>0;function I(){const me=document.getElementById(T);me&&me.remove()}function H(me){me.style.display="flex",me.style.background="#7faaf0",me.style.position="fixed",me.style.bottom="5px",me.style.left="5px",me.style.padding=".5em",me.style.borderRadius="5px",me.style.alignItems="center"}function te(me,_e){me.setAttribute("width","24"),me.setAttribute("id",_e),me.setAttribute("height","24"),me.setAttribute("viewBox","0 0 24 24"),me.setAttribute("fill","none"),me.style.marginLeft="-6px"}function ae(){const me=document.createElement("span");return me.style.cursor="pointer",me.style.marginLeft="16px",me.style.fontSize="24px",me.innerHTML=" &times;",me.onclick=()=>{previouslyDismissed=!0,I()},me}function ie(me,_e){me.setAttribute("id",_e),me.innerText="Learn more",me.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",me.setAttribute("target","__blank"),me.style.paddingLeft="5px",me.style.textDecoration="underline"}function ce(){const me=getOrCreateEl(T),_e=v("text"),Re=document.getElementById(_e)||document.createElement("span"),Pe=v("learnmore"),Ce=document.getElementById(Pe)||document.createElement("a"),Fe=v("preprendIcon"),Me=document.getElementById(Fe)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(me.created){const Ve=me.element;H(Ve),ie(Ce,Pe);const We=ae();te(Me,Fe),Ve.append(Me,Re,Ce,We),document.body.appendChild(Ve)}S?(Re.innerText="Preview backend disconnected.",Me.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(Me.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,Re.innerText="Preview backend running in this workspace."),Re.setAttribute("id",_e)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",ce):ce()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getUA(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function isNode(){var E;const r=(E=getDefaults())===null||E===void 0?void 0:E.forceEnvironment;if(r==="node")return!0;if(r==="browser")return!1;try{return Object.prototype.toString.call(globalThis.process)==="[object process]"}catch{return!1}}function isSafari(){return!isNode()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function isIndexedDBAvailable(){try{return typeof indexedDB=="object"}catch{return!1}}function validateIndexedDBOpenable(){return new Promise((E,r)=>{try{let v=!0;const T="validate-browser-context-for-indexeddb-analytics-module",w=self.indexedDB.open(T);w.onsuccess=()=>{w.result.close(),v||self.indexedDB.deleteDatabase(T),E(!0)},w.onupgradeneeded=()=>{v=!1},w.onerror=()=>{var S;r(((S=w.error)===null||S===void 0?void 0:S.message)||"")}}catch(v){r(v)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERROR_NAME="FirebaseError";class FirebaseError extends Error{constructor(r,v,T){super(v),this.code=r,this.customData=T,this.name=ERROR_NAME,Object.setPrototypeOf(this,FirebaseError.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ErrorFactory.prototype.create)}}class ErrorFactory{constructor(r,v,T){this.service=r,this.serviceName=v,this.errors=T}create(r,...v){const T=v[0]||{},w=`${this.service}/${r}`,S=this.errors[r],I=S?replaceTemplate(S,T):"Error",H=`${this.serviceName}: ${I} (${w}).`;return new FirebaseError(w,H,T)}}function replaceTemplate(E,r){return E.replace(PATTERN,(v,T)=>{const w=r[T];return w!=null?String(w):`<${T}?>`})}const PATTERN=/\{\$([^}]+)}/g;function deepEqual(E,r){if(E===r)return!0;const v=Object.keys(E),T=Object.keys(r);for(const w of v){if(!T.includes(w))return!1;const S=E[w],I=r[w];if(isObject(S)&&isObject(I)){if(!deepEqual(S,I))return!1}else if(S!==I)return!1}for(const w of T)if(!v.includes(w))return!1;return!0}function isObject(E){return E!==null&&typeof E=="object"}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function getModularInstance(E){return E&&E._delegate?E._delegate:E}class Component{constructor(r,v,T){this.name=r,this.instanceFactory=v,this.type=T,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(r){return this.instantiationMode=r,this}setMultipleInstances(r){return this.multipleInstances=r,this}setServiceProps(r){return this.serviceProps=r,this}setInstanceCreatedCallback(r){return this.onInstanceCreated=r,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME$1="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Provider{constructor(r,v){this.name=r,this.container=v,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(r){const v=this.normalizeInstanceIdentifier(r);if(!this.instancesDeferred.has(v)){const T=new Deferred;if(this.instancesDeferred.set(v,T),this.isInitialized(v)||this.shouldAutoInitialize())try{const w=this.getOrInitializeService({instanceIdentifier:v});w&&T.resolve(w)}catch{}}return this.instancesDeferred.get(v).promise}getImmediate(r){var v;const T=this.normalizeInstanceIdentifier(r==null?void 0:r.identifier),w=(v=r==null?void 0:r.optional)!==null&&v!==void 0?v:!1;if(this.isInitialized(T)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:T})}catch(S){if(w)return null;throw S}else{if(w)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(r){if(r.name!==this.name)throw Error(`Mismatching Component ${r.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=r,!!this.shouldAutoInitialize()){if(isComponentEager(r))try{this.getOrInitializeService({instanceIdentifier:DEFAULT_ENTRY_NAME$1})}catch{}for(const[v,T]of this.instancesDeferred.entries()){const w=this.normalizeInstanceIdentifier(v);try{const S=this.getOrInitializeService({instanceIdentifier:w});T.resolve(S)}catch{}}}}clearInstance(r=DEFAULT_ENTRY_NAME$1){this.instancesDeferred.delete(r),this.instancesOptions.delete(r),this.instances.delete(r)}async delete(){const r=Array.from(this.instances.values());await Promise.all([...r.filter(v=>"INTERNAL"in v).map(v=>v.INTERNAL.delete()),...r.filter(v=>"_delete"in v).map(v=>v._delete())])}isComponentSet(){return this.component!=null}isInitialized(r=DEFAULT_ENTRY_NAME$1){return this.instances.has(r)}getOptions(r=DEFAULT_ENTRY_NAME$1){return this.instancesOptions.get(r)||{}}initialize(r={}){const{options:v={}}=r,T=this.normalizeInstanceIdentifier(r.instanceIdentifier);if(this.isInitialized(T))throw Error(`${this.name}(${T}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const w=this.getOrInitializeService({instanceIdentifier:T,options:v});for(const[S,I]of this.instancesDeferred.entries()){const H=this.normalizeInstanceIdentifier(S);T===H&&I.resolve(w)}return w}onInit(r,v){var T;const w=this.normalizeInstanceIdentifier(v),S=(T=this.onInitCallbacks.get(w))!==null&&T!==void 0?T:new Set;S.add(r),this.onInitCallbacks.set(w,S);const I=this.instances.get(w);return I&&r(I,w),()=>{S.delete(r)}}invokeOnInitCallbacks(r,v){const T=this.onInitCallbacks.get(v);if(T)for(const w of T)try{w(r,v)}catch{}}getOrInitializeService({instanceIdentifier:r,options:v={}}){let T=this.instances.get(r);if(!T&&this.component&&(T=this.component.instanceFactory(this.container,{instanceIdentifier:normalizeIdentifierForFactory(r),options:v}),this.instances.set(r,T),this.instancesOptions.set(r,v),this.invokeOnInitCallbacks(T,r),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,r,T)}catch{}return T||null}normalizeInstanceIdentifier(r=DEFAULT_ENTRY_NAME$1){return this.component?this.component.multipleInstances?r:DEFAULT_ENTRY_NAME$1:r}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function normalizeIdentifierForFactory(E){return E===DEFAULT_ENTRY_NAME$1?void 0:E}function isComponentEager(E){return E.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ComponentContainer{constructor(r){this.name=r,this.providers=new Map}addComponent(r){const v=this.getProvider(r.name);if(v.isComponentSet())throw new Error(`Component ${r.name} has already been registered with ${this.name}`);v.setComponent(r)}addOrOverwriteComponent(r){this.getProvider(r.name).isComponentSet()&&this.providers.delete(r.name),this.addComponent(r)}getProvider(r){if(this.providers.has(r))return this.providers.get(r);const v=new Provider(r,this);return this.providers.set(r,v),v}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var LogLevel;(function(E){E[E.DEBUG=0]="DEBUG",E[E.VERBOSE=1]="VERBOSE",E[E.INFO=2]="INFO",E[E.WARN=3]="WARN",E[E.ERROR=4]="ERROR",E[E.SILENT=5]="SILENT"})(LogLevel||(LogLevel={}));const levelStringToEnum={debug:LogLevel.DEBUG,verbose:LogLevel.VERBOSE,info:LogLevel.INFO,warn:LogLevel.WARN,error:LogLevel.ERROR,silent:LogLevel.SILENT},defaultLogLevel=LogLevel.INFO,ConsoleMethod={[LogLevel.DEBUG]:"log",[LogLevel.VERBOSE]:"log",[LogLevel.INFO]:"info",[LogLevel.WARN]:"warn",[LogLevel.ERROR]:"error"},defaultLogHandler=(E,r,...v)=>{if(r<E.logLevel)return;const T=new Date().toISOString(),w=ConsoleMethod[r];if(w)console[w](`[${T}]  ${E.name}:`,...v);else throw new Error(`Attempted to log a message with an invalid logType (value: ${r})`)};class Logger{constructor(r){this.name=r,this._logLevel=defaultLogLevel,this._logHandler=defaultLogHandler,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(r){if(!(r in LogLevel))throw new TypeError(`Invalid value "${r}" assigned to \`logLevel\``);this._logLevel=r}setLogLevel(r){this._logLevel=typeof r=="string"?levelStringToEnum[r]:r}get logHandler(){return this._logHandler}set logHandler(r){if(typeof r!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=r}get userLogHandler(){return this._userLogHandler}set userLogHandler(r){this._userLogHandler=r}debug(...r){this._userLogHandler&&this._userLogHandler(this,LogLevel.DEBUG,...r),this._logHandler(this,LogLevel.DEBUG,...r)}log(...r){this._userLogHandler&&this._userLogHandler(this,LogLevel.VERBOSE,...r),this._logHandler(this,LogLevel.VERBOSE,...r)}info(...r){this._userLogHandler&&this._userLogHandler(this,LogLevel.INFO,...r),this._logHandler(this,LogLevel.INFO,...r)}warn(...r){this._userLogHandler&&this._userLogHandler(this,LogLevel.WARN,...r),this._logHandler(this,LogLevel.WARN,...r)}error(...r){this._userLogHandler&&this._userLogHandler(this,LogLevel.ERROR,...r),this._logHandler(this,LogLevel.ERROR,...r)}}const instanceOfAny=(E,r)=>r.some(v=>E instanceof v);let idbProxyableTypes,cursorAdvanceMethods;function getIdbProxyableTypes(){return idbProxyableTypes||(idbProxyableTypes=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return cursorAdvanceMethods||(cursorAdvanceMethods=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const cursorRequestMap=new WeakMap,transactionDoneMap=new WeakMap,transactionStoreNamesMap=new WeakMap,transformCache=new WeakMap,reverseTransformCache=new WeakMap;function promisifyRequest(E){const r=new Promise((v,T)=>{const w=()=>{E.removeEventListener("success",S),E.removeEventListener("error",I)},S=()=>{v(wrap(E.result)),w()},I=()=>{T(E.error),w()};E.addEventListener("success",S),E.addEventListener("error",I)});return r.then(v=>{v instanceof IDBCursor&&cursorRequestMap.set(v,E)}).catch(()=>{}),reverseTransformCache.set(r,E),r}function cacheDonePromiseForTransaction(E){if(transactionDoneMap.has(E))return;const r=new Promise((v,T)=>{const w=()=>{E.removeEventListener("complete",S),E.removeEventListener("error",I),E.removeEventListener("abort",I)},S=()=>{v(),w()},I=()=>{T(E.error||new DOMException("AbortError","AbortError")),w()};E.addEventListener("complete",S),E.addEventListener("error",I),E.addEventListener("abort",I)});transactionDoneMap.set(E,r)}let idbProxyTraps={get(E,r,v){if(E instanceof IDBTransaction){if(r==="done")return transactionDoneMap.get(E);if(r==="objectStoreNames")return E.objectStoreNames||transactionStoreNamesMap.get(E);if(r==="store")return v.objectStoreNames[1]?void 0:v.objectStore(v.objectStoreNames[0])}return wrap(E[r])},set(E,r,v){return E[r]=v,!0},has(E,r){return E instanceof IDBTransaction&&(r==="done"||r==="store")?!0:r in E}};function replaceTraps(E){idbProxyTraps=E(idbProxyTraps)}function wrapFunction(E){return E===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(r,...v){const T=E.call(unwrap(this),r,...v);return transactionStoreNamesMap.set(T,r.sort?r.sort():[r]),wrap(T)}:getCursorAdvanceMethods().includes(E)?function(...r){return E.apply(unwrap(this),r),wrap(cursorRequestMap.get(this))}:function(...r){return wrap(E.apply(unwrap(this),r))}}function transformCachableValue(E){return typeof E=="function"?wrapFunction(E):(E instanceof IDBTransaction&&cacheDonePromiseForTransaction(E),instanceOfAny(E,getIdbProxyableTypes())?new Proxy(E,idbProxyTraps):E)}function wrap(E){if(E instanceof IDBRequest)return promisifyRequest(E);if(transformCache.has(E))return transformCache.get(E);const r=transformCachableValue(E);return r!==E&&(transformCache.set(E,r),reverseTransformCache.set(r,E)),r}const unwrap=E=>reverseTransformCache.get(E);function openDB(E,r,{blocked:v,upgrade:T,blocking:w,terminated:S}={}){const I=indexedDB.open(E,r),H=wrap(I);return T&&I.addEventListener("upgradeneeded",te=>{T(wrap(I.result),te.oldVersion,te.newVersion,wrap(I.transaction),te)}),v&&I.addEventListener("blocked",te=>v(te.oldVersion,te.newVersion,te)),H.then(te=>{S&&te.addEventListener("close",()=>S()),w&&te.addEventListener("versionchange",ae=>w(ae.oldVersion,ae.newVersion,ae))}).catch(()=>{}),H}const readMethods=["get","getKey","getAll","getAllKeys","count"],writeMethods=["put","add","delete","clear"],cachedMethods=new Map;function getMethod(E,r){if(!(E instanceof IDBDatabase&&!(r in E)&&typeof r=="string"))return;if(cachedMethods.get(r))return cachedMethods.get(r);const v=r.replace(/FromIndex$/,""),T=r!==v,w=writeMethods.includes(v);if(!(v in(T?IDBIndex:IDBObjectStore).prototype)||!(w||readMethods.includes(v)))return;const S=async function(I,...H){const te=this.transaction(I,w?"readwrite":"readonly");let ae=te.store;return T&&(ae=ae.index(H.shift())),(await Promise.all([ae[v](...H),w&&te.done]))[0]};return cachedMethods.set(r,S),S}replaceTraps(E=>({...E,get:(r,v,T)=>getMethod(r,v)||E.get(r,v,T),has:(r,v)=>!!getMethod(r,v)||E.has(r,v)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PlatformLoggerServiceImpl{constructor(r){this.container=r}getPlatformInfoString(){return this.container.getProviders().map(v=>{if(isVersionServiceProvider(v)){const T=v.getImmediate();return`${T.library}/${T.version}`}else return null}).filter(v=>v).join(" ")}}function isVersionServiceProvider(E){const r=E.getComponent();return(r==null?void 0:r.type)==="VERSION"}const name$q="@firebase/app",version$1$1="0.13.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const logger=new Logger("@firebase/app"),name$p="@firebase/app-compat",name$o="@firebase/analytics-compat",name$n="@firebase/analytics",name$m="@firebase/app-check-compat",name$l="@firebase/app-check",name$k="@firebase/auth",name$j="@firebase/auth-compat",name$i="@firebase/database",name$h="@firebase/data-connect",name$g="@firebase/database-compat",name$f="@firebase/functions",name$e="@firebase/functions-compat",name$d="@firebase/installations",name$c="@firebase/installations-compat",name$b="@firebase/messaging",name$a="@firebase/messaging-compat",name$9="@firebase/performance",name$8="@firebase/performance-compat",name$7="@firebase/remote-config",name$6="@firebase/remote-config-compat",name$5="@firebase/storage",name$4="@firebase/storage-compat",name$3="@firebase/firestore",name$2="@firebase/ai",name$1$1="@firebase/firestore-compat",name$r="firebase",version$2="11.8.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_ENTRY_NAME="[DEFAULT]",PLATFORM_LOG_STRING={[name$q]:"fire-core",[name$p]:"fire-core-compat",[name$n]:"fire-analytics",[name$o]:"fire-analytics-compat",[name$l]:"fire-app-check",[name$m]:"fire-app-check-compat",[name$k]:"fire-auth",[name$j]:"fire-auth-compat",[name$i]:"fire-rtdb",[name$h]:"fire-data-connect",[name$g]:"fire-rtdb-compat",[name$f]:"fire-fn",[name$e]:"fire-fn-compat",[name$d]:"fire-iid",[name$c]:"fire-iid-compat",[name$b]:"fire-fcm",[name$a]:"fire-fcm-compat",[name$9]:"fire-perf",[name$8]:"fire-perf-compat",[name$7]:"fire-rc",[name$6]:"fire-rc-compat",[name$5]:"fire-gcs",[name$4]:"fire-gcs-compat",[name$3]:"fire-fst",[name$1$1]:"fire-fst-compat",[name$2]:"fire-vertex","fire-js":"fire-js",[name$r]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _apps=new Map,_serverApps=new Map,_components=new Map;function _addComponent(E,r){try{E.container.addComponent(r)}catch(v){logger.debug(`Component ${r.name} failed to register with FirebaseApp ${E.name}`,v)}}function _registerComponent(E){const r=E.name;if(_components.has(r))return logger.debug(`There were multiple attempts to register component ${r}.`),!1;_components.set(r,E);for(const v of _apps.values())_addComponent(v,E);for(const v of _serverApps.values())_addComponent(v,E);return!0}function _getProvider(E,r){const v=E.container.getProvider("heartbeat").getImmediate({optional:!0});return v&&v.triggerHeartbeat(),E.container.getProvider(r)}function _isFirebaseServerApp(E){return E==null?!1:E.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ERRORS={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ERROR_FACTORY=new ErrorFactory("app","Firebase",ERRORS);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FirebaseAppImpl{constructor(r,v,T){this._isDeleted=!1,this._options=Object.assign({},r),this._config=Object.assign({},v),this._name=v.name,this._automaticDataCollectionEnabled=v.automaticDataCollectionEnabled,this._container=T,this.container.addComponent(new Component("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(r){this.checkDestroyed(),this._automaticDataCollectionEnabled=r}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(r){this._isDeleted=r}checkDestroyed(){if(this.isDeleted)throw ERROR_FACTORY.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SDK_VERSION=version$2;function initializeApp(E,r={}){let v=E;typeof r!="object"&&(r={name:r});const T=Object.assign({name:DEFAULT_ENTRY_NAME,automaticDataCollectionEnabled:!0},r),w=T.name;if(typeof w!="string"||!w)throw ERROR_FACTORY.create("bad-app-name",{appName:String(w)});if(v||(v=getDefaultAppConfig()),!v)throw ERROR_FACTORY.create("no-options");const S=_apps.get(w);if(S){if(deepEqual(v,S.options)&&deepEqual(T,S.config))return S;throw ERROR_FACTORY.create("duplicate-app",{appName:w})}const I=new ComponentContainer(w);for(const te of _components.values())I.addComponent(te);const H=new FirebaseAppImpl(v,T,I);return _apps.set(w,H),H}function getApp(E=DEFAULT_ENTRY_NAME){const r=_apps.get(E);if(!r&&E===DEFAULT_ENTRY_NAME&&getDefaultAppConfig())return initializeApp();if(!r)throw ERROR_FACTORY.create("no-app",{appName:E});return r}function registerVersion(E,r,v){var T;let w=(T=PLATFORM_LOG_STRING[E])!==null&&T!==void 0?T:E;v&&(w+=`-${v}`);const S=w.match(/\s|\//),I=r.match(/\s|\//);if(S||I){const H=[`Unable to register library "${w}" with version "${r}":`];S&&H.push(`library name "${w}" contains illegal characters (whitespace or "/")`),S&&I&&H.push("and"),I&&H.push(`version name "${r}" contains illegal characters (whitespace or "/")`),logger.warn(H.join(" "));return}_registerComponent(new Component(`${w}-version`,()=>({library:w,version:r}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DB_NAME="firebase-heartbeat-database",DB_VERSION=1,STORE_NAME="firebase-heartbeat-store";let dbPromise=null;function getDbPromise(){return dbPromise||(dbPromise=openDB(DB_NAME,DB_VERSION,{upgrade:(E,r)=>{switch(r){case 0:try{E.createObjectStore(STORE_NAME)}catch(v){console.warn(v)}}}}).catch(E=>{throw ERROR_FACTORY.create("idb-open",{originalErrorMessage:E.message})})),dbPromise}async function readHeartbeatsFromIndexedDB(E){try{const v=(await getDbPromise()).transaction(STORE_NAME),T=await v.objectStore(STORE_NAME).get(computeKey(E));return await v.done,T}catch(r){if(r instanceof FirebaseError)logger.warn(r.message);else{const v=ERROR_FACTORY.create("idb-get",{originalErrorMessage:r==null?void 0:r.message});logger.warn(v.message)}}}async function writeHeartbeatsToIndexedDB(E,r){try{const T=(await getDbPromise()).transaction(STORE_NAME,"readwrite");await T.objectStore(STORE_NAME).put(r,computeKey(E)),await T.done}catch(v){if(v instanceof FirebaseError)logger.warn(v.message);else{const T=ERROR_FACTORY.create("idb-set",{originalErrorMessage:v==null?void 0:v.message});logger.warn(T.message)}}}function computeKey(E){return`${E.name}!${E.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MAX_HEADER_BYTES=1024,MAX_NUM_STORED_HEARTBEATS=30;class HeartbeatServiceImpl{constructor(r){this.container=r,this._heartbeatsCache=null;const v=this.container.getProvider("app").getImmediate();this._storage=new HeartbeatStorageImpl(v),this._heartbeatsCachePromise=this._storage.read().then(T=>(this._heartbeatsCache=T,T))}async triggerHeartbeat(){var r,v;try{const w=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),S=getUTCDateString();if(((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((v=this._heartbeatsCache)===null||v===void 0?void 0:v.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===S||this._heartbeatsCache.heartbeats.some(I=>I.date===S))return;if(this._heartbeatsCache.heartbeats.push({date:S,agent:w}),this._heartbeatsCache.heartbeats.length>MAX_NUM_STORED_HEARTBEATS){const I=getEarliestHeartbeatIdx(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(I,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(T){logger.warn(T)}}async getHeartbeatsHeader(){var r;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((r=this._heartbeatsCache)===null||r===void 0?void 0:r.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const v=getUTCDateString(),{heartbeatsToSend:T,unsentEntries:w}=extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats),S=base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:T}));return this._heartbeatsCache.lastSentHeartbeatDate=v,w.length>0?(this._heartbeatsCache.heartbeats=w,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),S}catch(v){return logger.warn(v),""}}}function getUTCDateString(){return new Date().toISOString().substring(0,10)}function extractHeartbeatsForHeader(E,r=MAX_HEADER_BYTES){const v=[];let T=E.slice();for(const w of E){const S=v.find(I=>I.agent===w.agent);if(S){if(S.dates.push(w.date),countBytes(v)>r){S.dates.pop();break}}else if(v.push({agent:w.agent,dates:[w.date]}),countBytes(v)>r){v.pop();break}T=T.slice(1)}return{heartbeatsToSend:v,unsentEntries:T}}class HeartbeatStorageImpl{constructor(r){this.app=r,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return isIndexedDBAvailable()?validateIndexedDBOpenable().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const v=await readHeartbeatsFromIndexedDB(this.app);return v!=null&&v.heartbeats?v:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(r){var v;if(await this._canUseIndexedDBPromise){const w=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:(v=r.lastSentHeartbeatDate)!==null&&v!==void 0?v:w.lastSentHeartbeatDate,heartbeats:r.heartbeats})}else return}async add(r){var v;if(await this._canUseIndexedDBPromise){const w=await this.read();return writeHeartbeatsToIndexedDB(this.app,{lastSentHeartbeatDate:(v=r.lastSentHeartbeatDate)!==null&&v!==void 0?v:w.lastSentHeartbeatDate,heartbeats:[...w.heartbeats,...r.heartbeats]})}else return}}function countBytes(E){return base64urlEncodeWithoutPadding(JSON.stringify({version:2,heartbeats:E})).length}function getEarliestHeartbeatIdx(E){if(E.length===0)return-1;let r=0,v=E[0].date;for(let T=1;T<E.length;T++)E[T].date<v&&(v=E[T].date,r=T);return r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function registerCoreComponents(E){_registerComponent(new Component("platform-logger",r=>new PlatformLoggerServiceImpl(r),"PRIVATE")),_registerComponent(new Component("heartbeat",r=>new HeartbeatServiceImpl(r),"PRIVATE")),registerVersion(name$q,version$1$1,E),registerVersion(name$q,version$1$1,"esm2017"),registerVersion("fire-js","")}registerCoreComponents("");var name$1="firebase",version$1="11.8.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */registerVersion(name$1,version$1,"app");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DEFAULT_HOST="firebasestorage.googleapis.com",CONFIG_STORAGE_BUCKET_KEY="storageBucket",DEFAULT_MAX_OPERATION_RETRY_TIME=2*60*1e3,DEFAULT_MAX_UPLOAD_RETRY_TIME=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class StorageError extends FirebaseError{constructor(r,v,T=0){super(prependCode(r),`Firebase Storage: ${v} (${prependCode(r)})`),this.status_=T,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,StorageError.prototype)}get status(){return this.status_}set status(r){this.status_=r}_codeEquals(r){return prependCode(r)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(r){this.customData.serverResponse=r,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var StorageErrorCode;(function(E){E.UNKNOWN="unknown",E.OBJECT_NOT_FOUND="object-not-found",E.BUCKET_NOT_FOUND="bucket-not-found",E.PROJECT_NOT_FOUND="project-not-found",E.QUOTA_EXCEEDED="quota-exceeded",E.UNAUTHENTICATED="unauthenticated",E.UNAUTHORIZED="unauthorized",E.UNAUTHORIZED_APP="unauthorized-app",E.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",E.INVALID_CHECKSUM="invalid-checksum",E.CANCELED="canceled",E.INVALID_EVENT_NAME="invalid-event-name",E.INVALID_URL="invalid-url",E.INVALID_DEFAULT_BUCKET="invalid-default-bucket",E.NO_DEFAULT_BUCKET="no-default-bucket",E.CANNOT_SLICE_BLOB="cannot-slice-blob",E.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",E.NO_DOWNLOAD_URL="no-download-url",E.INVALID_ARGUMENT="invalid-argument",E.INVALID_ARGUMENT_COUNT="invalid-argument-count",E.APP_DELETED="app-deleted",E.INVALID_ROOT_OPERATION="invalid-root-operation",E.INVALID_FORMAT="invalid-format",E.INTERNAL_ERROR="internal-error",E.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(StorageErrorCode||(StorageErrorCode={}));function prependCode(E){return"storage/"+E}function unknown(){const E="An unknown error occurred, please check the error payload for server response.";return new StorageError(StorageErrorCode.UNKNOWN,E)}function retryLimitExceeded(){return new StorageError(StorageErrorCode.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function canceled(){return new StorageError(StorageErrorCode.CANCELED,"User canceled the upload/download.")}function invalidUrl(E){return new StorageError(StorageErrorCode.INVALID_URL,"Invalid URL '"+E+"'.")}function invalidDefaultBucket(E){return new StorageError(StorageErrorCode.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+E+"'.")}function invalidArgument(E){return new StorageError(StorageErrorCode.INVALID_ARGUMENT,E)}function appDeleted(){return new StorageError(StorageErrorCode.APP_DELETED,"The Firebase app was deleted.")}function invalidRootOperation(E){return new StorageError(StorageErrorCode.INVALID_ROOT_OPERATION,"The operation '"+E+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Location{constructor(r,v){this.bucket=r,this.path_=v}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const r=encodeURIComponent;return"/b/"+r(this.bucket)+"/o/"+r(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(r,v){let T;try{T=Location.makeFromUrl(r,v)}catch{return new Location(r,"")}if(T.path==="")return T;throw invalidDefaultBucket(r)}static makeFromUrl(r,v){let T=null;const w="([A-Za-z0-9.\\-_]+)";function S(We){We.path.charAt(We.path.length-1)==="/"&&(We.path_=We.path_.slice(0,-1))}const I="(/(.*))?$",H=new RegExp("^gs://"+w+I,"i"),te={bucket:1,path:3};function ae(We){We.path_=decodeURIComponent(We.path)}const ie="v[A-Za-z0-9_]+",ce=v.replace(/[.]/g,"\\."),me="(/([^?#]*).*)?$",_e=new RegExp(`^https?://${ce}/${ie}/b/${w}/o${me}`,"i"),Re={bucket:1,path:3},Pe=v===DEFAULT_HOST?"(?:storage.googleapis.com|storage.cloud.google.com)":v,Ce="([^?#]*)",Fe=new RegExp(`^https?://${Pe}/${w}/${Ce}`,"i"),Ve=[{regex:H,indices:te,postModify:S},{regex:_e,indices:Re,postModify:ae},{regex:Fe,indices:{bucket:1,path:2},postModify:ae}];for(let We=0;We<Ve.length;We++){const ze=Ve[We],Ue=ze.regex.exec(r);if(Ue){const je=Ue[ze.indices.bucket];let ke=Ue[ze.indices.path];ke||(ke=""),T=new Location(je,ke),ze.postModify(T);break}}if(T==null)throw invalidUrl(r);return T}}class FailRequest{constructor(r){this.promise_=Promise.reject(r)}getPromise(){return this.promise_}cancel(r=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function start(E,r,v){let T=1,w=null,S=null,I=!1,H=0;function te(){return H===2}let ae=!1;function ie(...Ce){ae||(ae=!0,r.apply(null,Ce))}function ce(Ce){w=setTimeout(()=>{w=null,E(_e,te())},Ce)}function me(){S&&clearTimeout(S)}function _e(Ce,...Fe){if(ae){me();return}if(Ce){me(),ie.call(null,Ce,...Fe);return}if(te()||I){me(),ie.call(null,Ce,...Fe);return}T<64&&(T*=2);let Ve;H===1?(H=2,Ve=0):Ve=(T+Math.random())*1e3,ce(Ve)}let Re=!1;function Pe(Ce){Re||(Re=!0,me(),!ae&&(w!==null?(Ce||(H=2),clearTimeout(w),ce(0)):Ce||(H=1)))}return ce(0),S=setTimeout(()=>{I=!0,Pe(!0)},v),Pe}function stop(E){E(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isJustDef(E){return E!==void 0}function validateNumber(E,r,v,T){if(T<r)throw invalidArgument(`Invalid value for '${E}'. Expected ${r} or greater.`);if(T>v)throw invalidArgument(`Invalid value for '${E}'. Expected ${v} or less.`)}function makeQueryString(E){const r=encodeURIComponent;let v="?";for(const T in E)if(E.hasOwnProperty(T)){const w=r(T)+"="+r(E[T]);v=v+w+"&"}return v=v.slice(0,-1),v}var ErrorCode$1;(function(E){E[E.NO_ERROR=0]="NO_ERROR",E[E.NETWORK_ERROR=1]="NETWORK_ERROR",E[E.ABORT=2]="ABORT"})(ErrorCode$1||(ErrorCode$1={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function isRetryStatusCode(E,r){const v=E>=500&&E<600,w=[408,429].indexOf(E)!==-1,S=r.indexOf(E)!==-1;return v||w||S}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NetworkRequest{constructor(r,v,T,w,S,I,H,te,ae,ie,ce,me=!0,_e=!1){this.url_=r,this.method_=v,this.headers_=T,this.body_=w,this.successCodes_=S,this.additionalRetryCodes_=I,this.callback_=H,this.errorCallback_=te,this.timeout_=ae,this.progressCallback_=ie,this.connectionFactory_=ce,this.retry=me,this.isUsingEmulator=_e,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((Re,Pe)=>{this.resolve_=Re,this.reject_=Pe,this.start_()})}start_(){const r=(T,w)=>{if(w){T(!1,new RequestEndStatus(!1,null,!0));return}const S=this.connectionFactory_();this.pendingConnection_=S;const I=H=>{const te=H.loaded,ae=H.lengthComputable?H.total:-1;this.progressCallback_!==null&&this.progressCallback_(te,ae)};this.progressCallback_!==null&&S.addUploadProgressListener(I),S.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&S.removeUploadProgressListener(I),this.pendingConnection_=null;const H=S.getErrorCode()===ErrorCode$1.NO_ERROR,te=S.getStatus();if(!H||isRetryStatusCode(te,this.additionalRetryCodes_)&&this.retry){const ie=S.getErrorCode()===ErrorCode$1.ABORT;T(!1,new RequestEndStatus(!1,null,ie));return}const ae=this.successCodes_.indexOf(te)!==-1;T(!0,new RequestEndStatus(ae,S))})},v=(T,w)=>{const S=this.resolve_,I=this.reject_,H=w.connection;if(w.wasSuccessCode)try{const te=this.callback_(H,H.getResponse());isJustDef(te)?S(te):S()}catch(te){I(te)}else if(H!==null){const te=unknown();te.serverResponse=H.getErrorText(),this.errorCallback_?I(this.errorCallback_(H,te)):I(te)}else if(w.canceled){const te=this.appDelete_?appDeleted():canceled();I(te)}else{const te=retryLimitExceeded();I(te)}};this.canceled_?v(!1,new RequestEndStatus(!1,null,!0)):this.backoffId_=start(r,v,this.timeout_)}getPromise(){return this.promise_}cancel(r){this.canceled_=!0,this.appDelete_=r||!1,this.backoffId_!==null&&stop(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class RequestEndStatus{constructor(r,v,T){this.wasSuccessCode=r,this.connection=v,this.canceled=!!T}}function addAuthHeader_(E,r){r!==null&&r.length>0&&(E.Authorization="Firebase "+r)}function addVersionHeader_(E,r){E["X-Firebase-Storage-Version"]="webjs/"+(r??"AppManager")}function addGmpidHeader_(E,r){r&&(E["X-Firebase-GMPID"]=r)}function addAppCheckHeader_(E,r){r!==null&&(E["X-Firebase-AppCheck"]=r)}function makeRequest(E,r,v,T,w,S,I=!0,H=!1){const te=makeQueryString(E.urlParams),ae=E.url+te,ie=Object.assign({},E.headers);return addGmpidHeader_(ie,r),addAuthHeader_(ie,v),addVersionHeader_(ie,S),addAppCheckHeader_(ie,T),new NetworkRequest(ae,E.method,ie,E.body,E.successCodes,E.additionalRetryCodes,E.handler,E.errorHandler,E.timeout,E.progressCallback,w,I,H)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function parent(E){if(E.length===0)return null;const r=E.lastIndexOf("/");return r===-1?"":E.slice(0,r)}function lastComponent(E){const r=E.lastIndexOf("/",E.length-2);return r===-1?E:E.slice(r+1)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Reference{constructor(r,v){this._service=r,v instanceof Location?this._location=v:this._location=Location.makeFromUrl(v,r.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(r,v){return new Reference(r,v)}get root(){const r=new Location(this._location.bucket,"");return this._newRef(this._service,r)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return lastComponent(this._location.path)}get storage(){return this._service}get parent(){const r=parent(this._location.path);if(r===null)return null;const v=new Location(this._location.bucket,r);return new Reference(this._service,v)}_throwIfRoot(r){if(this._location.path==="")throw invalidRootOperation(r)}}function extractBucket(E,r){const v=r==null?void 0:r[CONFIG_STORAGE_BUCKET_KEY];return v==null?null:Location.makeFromBucketSpec(v,E)}function connectStorageEmulator$1(E,r,v,T={}){E.host=`${r}:${v}`;const w=isCloudWorkstation(r);w&&(pingServer(`https://${E.host}`),updateEmulatorBanner("Storage",!0)),E._isUsingEmulator=!0,E._protocol=w?"https":"http";const{mockUserToken:S}=T;S&&(E._overrideAuthToken=typeof S=="string"?S:createMockUserToken(S,E.app.options.projectId))}class FirebaseStorageImpl{constructor(r,v,T,w,S,I=!1){this.app=r,this._authProvider=v,this._appCheckProvider=T,this._url=w,this._firebaseVersion=S,this._isUsingEmulator=I,this._bucket=null,this._host=DEFAULT_HOST,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=DEFAULT_MAX_OPERATION_RETRY_TIME,this._maxUploadRetryTime=DEFAULT_MAX_UPLOAD_RETRY_TIME,this._requests=new Set,w!=null?this._bucket=Location.makeFromBucketSpec(w,this._host):this._bucket=extractBucket(this._host,this.app.options)}get host(){return this._host}set host(r){this._host=r,this._url!=null?this._bucket=Location.makeFromBucketSpec(this._url,r):this._bucket=extractBucket(r,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(r){validateNumber("time",0,Number.POSITIVE_INFINITY,r),this._maxUploadRetryTime=r}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(r){validateNumber("time",0,Number.POSITIVE_INFINITY,r),this._maxOperationRetryTime=r}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const r=this._authProvider.getImmediate({optional:!0});if(r){const v=await r.getToken();if(v!==null)return v.accessToken}return null}async _getAppCheckToken(){if(_isFirebaseServerApp(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const r=this._appCheckProvider.getImmediate({optional:!0});return r?(await r.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(r=>r.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(r){return new Reference(this,r)}_makeRequest(r,v,T,w,S=!0){if(this._deleted)return new FailRequest(appDeleted());{const I=makeRequest(r,this._appId,T,w,v,this._firebaseVersion,S,this._isUsingEmulator);return this._requests.add(I),I.getPromise().then(()=>this._requests.delete(I),()=>this._requests.delete(I)),I}}async makeRequestWithTokens(r,v){const[T,w]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(r,v,T,w).getPromise()}}const name="@firebase/storage",version="0.13.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const STORAGE_TYPE="storage";function getStorage(E=getApp(),r){E=getModularInstance(E);const T=_getProvider(E,STORAGE_TYPE).getImmediate({identifier:r}),w=getDefaultEmulatorHostnameAndPort("storage");return w&&connectStorageEmulator(T,...w),T}function connectStorageEmulator(E,r,v,T={}){connectStorageEmulator$1(E,r,v,T)}function factory(E,{instanceIdentifier:r}){const v=E.getProvider("app").getImmediate(),T=E.getProvider("auth-internal"),w=E.getProvider("app-check-internal");return new FirebaseStorageImpl(v,T,w,r,SDK_VERSION)}function registerStorage(){_registerComponent(new Component(STORAGE_TYPE,factory,"PUBLIC").setMultipleInstances(!0)),registerVersion(name,version,""),registerVersion(name,version,"esm2017")}registerStorage();var commonjsGlobal$1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Integer,Md5;(function(){var E;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function r(je,ke){function Ne(){}Ne.prototype=ke.prototype,je.D=ke.prototype,je.prototype=new Ne,je.prototype.constructor=je,je.C=function(Ge,Ie,Le){for(var He=Array(arguments.length-2),Ct=2;Ct<arguments.length;Ct++)He[Ct-2]=arguments[Ct];return ke.prototype[Ie].apply(Ge,He)}}function v(){this.blockSize=-1}function T(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}r(T,v),T.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function w(je,ke,Ne){Ne||(Ne=0);var Ge=Array(16);if(typeof ke=="string")for(var Ie=0;16>Ie;++Ie)Ge[Ie]=ke.charCodeAt(Ne++)|ke.charCodeAt(Ne++)<<8|ke.charCodeAt(Ne++)<<16|ke.charCodeAt(Ne++)<<24;else for(Ie=0;16>Ie;++Ie)Ge[Ie]=ke[Ne++]|ke[Ne++]<<8|ke[Ne++]<<16|ke[Ne++]<<24;ke=je.g[0],Ne=je.g[1],Ie=je.g[2];var Le=je.g[3],He=ke+(Le^Ne&(Ie^Le))+Ge[0]+3614090360&4294967295;ke=Ne+(He<<7&4294967295|He>>>25),He=Le+(Ie^ke&(Ne^Ie))+Ge[1]+3905402710&4294967295,Le=ke+(He<<12&4294967295|He>>>20),He=Ie+(Ne^Le&(ke^Ne))+Ge[2]+606105819&4294967295,Ie=Le+(He<<17&4294967295|He>>>15),He=Ne+(ke^Ie&(Le^ke))+Ge[3]+3250441966&4294967295,Ne=Ie+(He<<22&4294967295|He>>>10),He=ke+(Le^Ne&(Ie^Le))+Ge[4]+4118548399&4294967295,ke=Ne+(He<<7&4294967295|He>>>25),He=Le+(Ie^ke&(Ne^Ie))+Ge[5]+1200080426&4294967295,Le=ke+(He<<12&4294967295|He>>>20),He=Ie+(Ne^Le&(ke^Ne))+Ge[6]+2821735955&4294967295,Ie=Le+(He<<17&4294967295|He>>>15),He=Ne+(ke^Ie&(Le^ke))+Ge[7]+4249261313&4294967295,Ne=Ie+(He<<22&4294967295|He>>>10),He=ke+(Le^Ne&(Ie^Le))+Ge[8]+1770035416&4294967295,ke=Ne+(He<<7&4294967295|He>>>25),He=Le+(Ie^ke&(Ne^Ie))+Ge[9]+2336552879&4294967295,Le=ke+(He<<12&4294967295|He>>>20),He=Ie+(Ne^Le&(ke^Ne))+Ge[10]+4294925233&4294967295,Ie=Le+(He<<17&4294967295|He>>>15),He=Ne+(ke^Ie&(Le^ke))+Ge[11]+2304563134&4294967295,Ne=Ie+(He<<22&4294967295|He>>>10),He=ke+(Le^Ne&(Ie^Le))+Ge[12]+1804603682&4294967295,ke=Ne+(He<<7&4294967295|He>>>25),He=Le+(Ie^ke&(Ne^Ie))+Ge[13]+4254626195&4294967295,Le=ke+(He<<12&4294967295|He>>>20),He=Ie+(Ne^Le&(ke^Ne))+Ge[14]+2792965006&4294967295,Ie=Le+(He<<17&4294967295|He>>>15),He=Ne+(ke^Ie&(Le^ke))+Ge[15]+1236535329&4294967295,Ne=Ie+(He<<22&4294967295|He>>>10),He=ke+(Ie^Le&(Ne^Ie))+Ge[1]+4129170786&4294967295,ke=Ne+(He<<5&4294967295|He>>>27),He=Le+(Ne^Ie&(ke^Ne))+Ge[6]+3225465664&4294967295,Le=ke+(He<<9&4294967295|He>>>23),He=Ie+(ke^Ne&(Le^ke))+Ge[11]+643717713&4294967295,Ie=Le+(He<<14&4294967295|He>>>18),He=Ne+(Le^ke&(Ie^Le))+Ge[0]+3921069994&4294967295,Ne=Ie+(He<<20&4294967295|He>>>12),He=ke+(Ie^Le&(Ne^Ie))+Ge[5]+3593408605&4294967295,ke=Ne+(He<<5&4294967295|He>>>27),He=Le+(Ne^Ie&(ke^Ne))+Ge[10]+38016083&4294967295,Le=ke+(He<<9&4294967295|He>>>23),He=Ie+(ke^Ne&(Le^ke))+Ge[15]+3634488961&4294967295,Ie=Le+(He<<14&4294967295|He>>>18),He=Ne+(Le^ke&(Ie^Le))+Ge[4]+3889429448&4294967295,Ne=Ie+(He<<20&4294967295|He>>>12),He=ke+(Ie^Le&(Ne^Ie))+Ge[9]+568446438&4294967295,ke=Ne+(He<<5&4294967295|He>>>27),He=Le+(Ne^Ie&(ke^Ne))+Ge[14]+3275163606&4294967295,Le=ke+(He<<9&4294967295|He>>>23),He=Ie+(ke^Ne&(Le^ke))+Ge[3]+4107603335&4294967295,Ie=Le+(He<<14&4294967295|He>>>18),He=Ne+(Le^ke&(Ie^Le))+Ge[8]+1163531501&4294967295,Ne=Ie+(He<<20&4294967295|He>>>12),He=ke+(Ie^Le&(Ne^Ie))+Ge[13]+2850285829&4294967295,ke=Ne+(He<<5&4294967295|He>>>27),He=Le+(Ne^Ie&(ke^Ne))+Ge[2]+4243563512&4294967295,Le=ke+(He<<9&4294967295|He>>>23),He=Ie+(ke^Ne&(Le^ke))+Ge[7]+1735328473&4294967295,Ie=Le+(He<<14&4294967295|He>>>18),He=Ne+(Le^ke&(Ie^Le))+Ge[12]+2368359562&4294967295,Ne=Ie+(He<<20&4294967295|He>>>12),He=ke+(Ne^Ie^Le)+Ge[5]+4294588738&4294967295,ke=Ne+(He<<4&4294967295|He>>>28),He=Le+(ke^Ne^Ie)+Ge[8]+2272392833&4294967295,Le=ke+(He<<11&4294967295|He>>>21),He=Ie+(Le^ke^Ne)+Ge[11]+1839030562&4294967295,Ie=Le+(He<<16&4294967295|He>>>16),He=Ne+(Ie^Le^ke)+Ge[14]+4259657740&4294967295,Ne=Ie+(He<<23&4294967295|He>>>9),He=ke+(Ne^Ie^Le)+Ge[1]+2763975236&4294967295,ke=Ne+(He<<4&4294967295|He>>>28),He=Le+(ke^Ne^Ie)+Ge[4]+1272893353&4294967295,Le=ke+(He<<11&4294967295|He>>>21),He=Ie+(Le^ke^Ne)+Ge[7]+4139469664&4294967295,Ie=Le+(He<<16&4294967295|He>>>16),He=Ne+(Ie^Le^ke)+Ge[10]+3200236656&4294967295,Ne=Ie+(He<<23&4294967295|He>>>9),He=ke+(Ne^Ie^Le)+Ge[13]+681279174&4294967295,ke=Ne+(He<<4&4294967295|He>>>28),He=Le+(ke^Ne^Ie)+Ge[0]+3936430074&4294967295,Le=ke+(He<<11&4294967295|He>>>21),He=Ie+(Le^ke^Ne)+Ge[3]+3572445317&4294967295,Ie=Le+(He<<16&4294967295|He>>>16),He=Ne+(Ie^Le^ke)+Ge[6]+76029189&4294967295,Ne=Ie+(He<<23&4294967295|He>>>9),He=ke+(Ne^Ie^Le)+Ge[9]+3654602809&4294967295,ke=Ne+(He<<4&4294967295|He>>>28),He=Le+(ke^Ne^Ie)+Ge[12]+3873151461&4294967295,Le=ke+(He<<11&4294967295|He>>>21),He=Ie+(Le^ke^Ne)+Ge[15]+530742520&4294967295,Ie=Le+(He<<16&4294967295|He>>>16),He=Ne+(Ie^Le^ke)+Ge[2]+3299628645&4294967295,Ne=Ie+(He<<23&4294967295|He>>>9),He=ke+(Ie^(Ne|~Le))+Ge[0]+4096336452&4294967295,ke=Ne+(He<<6&4294967295|He>>>26),He=Le+(Ne^(ke|~Ie))+Ge[7]+1126891415&4294967295,Le=ke+(He<<10&4294967295|He>>>22),He=Ie+(ke^(Le|~Ne))+Ge[14]+2878612391&4294967295,Ie=Le+(He<<15&4294967295|He>>>17),He=Ne+(Le^(Ie|~ke))+Ge[5]+4237533241&4294967295,Ne=Ie+(He<<21&4294967295|He>>>11),He=ke+(Ie^(Ne|~Le))+Ge[12]+1700485571&4294967295,ke=Ne+(He<<6&4294967295|He>>>26),He=Le+(Ne^(ke|~Ie))+Ge[3]+2399980690&4294967295,Le=ke+(He<<10&4294967295|He>>>22),He=Ie+(ke^(Le|~Ne))+Ge[10]+4293915773&4294967295,Ie=Le+(He<<15&4294967295|He>>>17),He=Ne+(Le^(Ie|~ke))+Ge[1]+2240044497&4294967295,Ne=Ie+(He<<21&4294967295|He>>>11),He=ke+(Ie^(Ne|~Le))+Ge[8]+1873313359&4294967295,ke=Ne+(He<<6&4294967295|He>>>26),He=Le+(Ne^(ke|~Ie))+Ge[15]+4264355552&4294967295,Le=ke+(He<<10&4294967295|He>>>22),He=Ie+(ke^(Le|~Ne))+Ge[6]+2734768916&4294967295,Ie=Le+(He<<15&4294967295|He>>>17),He=Ne+(Le^(Ie|~ke))+Ge[13]+1309151649&4294967295,Ne=Ie+(He<<21&4294967295|He>>>11),He=ke+(Ie^(Ne|~Le))+Ge[4]+4149444226&4294967295,ke=Ne+(He<<6&4294967295|He>>>26),He=Le+(Ne^(ke|~Ie))+Ge[11]+3174756917&4294967295,Le=ke+(He<<10&4294967295|He>>>22),He=Ie+(ke^(Le|~Ne))+Ge[2]+718787259&4294967295,Ie=Le+(He<<15&4294967295|He>>>17),He=Ne+(Le^(Ie|~ke))+Ge[9]+3951481745&4294967295,je.g[0]=je.g[0]+ke&4294967295,je.g[1]=je.g[1]+(Ie+(He<<21&4294967295|He>>>11))&4294967295,je.g[2]=je.g[2]+Ie&4294967295,je.g[3]=je.g[3]+Le&4294967295}T.prototype.u=function(je,ke){ke===void 0&&(ke=je.length);for(var Ne=ke-this.blockSize,Ge=this.B,Ie=this.h,Le=0;Le<ke;){if(Ie==0)for(;Le<=Ne;)w(this,je,Le),Le+=this.blockSize;if(typeof je=="string"){for(;Le<ke;)if(Ge[Ie++]=je.charCodeAt(Le++),Ie==this.blockSize){w(this,Ge),Ie=0;break}}else for(;Le<ke;)if(Ge[Ie++]=je[Le++],Ie==this.blockSize){w(this,Ge),Ie=0;break}}this.h=Ie,this.o+=ke},T.prototype.v=function(){var je=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);je[0]=128;for(var ke=1;ke<je.length-8;++ke)je[ke]=0;var Ne=8*this.o;for(ke=je.length-8;ke<je.length;++ke)je[ke]=Ne&255,Ne/=256;for(this.u(je),je=Array(16),ke=Ne=0;4>ke;++ke)for(var Ge=0;32>Ge;Ge+=8)je[Ne++]=this.g[ke]>>>Ge&255;return je};function S(je,ke){var Ne=H;return Object.prototype.hasOwnProperty.call(Ne,je)?Ne[je]:Ne[je]=ke(je)}function I(je,ke){this.h=ke;for(var Ne=[],Ge=!0,Ie=je.length-1;0<=Ie;Ie--){var Le=je[Ie]|0;Ge&&Le==ke||(Ne[Ie]=Le,Ge=!1)}this.g=Ne}var H={};function te(je){return-128<=je&&128>je?S(je,function(ke){return new I([ke|0],0>ke?-1:0)}):new I([je|0],0>je?-1:0)}function ae(je){if(isNaN(je)||!isFinite(je))return ce;if(0>je)return Ce(ae(-je));for(var ke=[],Ne=1,Ge=0;je>=Ne;Ge++)ke[Ge]=je/Ne|0,Ne*=4294967296;return new I(ke,0)}function ie(je,ke){if(je.length==0)throw Error("number format error: empty string");if(ke=ke||10,2>ke||36<ke)throw Error("radix out of range: "+ke);if(je.charAt(0)=="-")return Ce(ie(je.substring(1),ke));if(0<=je.indexOf("-"))throw Error('number format error: interior "-" character');for(var Ne=ae(Math.pow(ke,8)),Ge=ce,Ie=0;Ie<je.length;Ie+=8){var Le=Math.min(8,je.length-Ie),He=parseInt(je.substring(Ie,Ie+Le),ke);8>Le?(Le=ae(Math.pow(ke,Le)),Ge=Ge.j(Le).add(ae(He))):(Ge=Ge.j(Ne),Ge=Ge.add(ae(He)))}return Ge}var ce=te(0),me=te(1),_e=te(16777216);E=I.prototype,E.m=function(){if(Pe(this))return-Ce(this).m();for(var je=0,ke=1,Ne=0;Ne<this.g.length;Ne++){var Ge=this.i(Ne);je+=(0<=Ge?Ge:4294967296+Ge)*ke,ke*=4294967296}return je},E.toString=function(je){if(je=je||10,2>je||36<je)throw Error("radix out of range: "+je);if(Re(this))return"0";if(Pe(this))return"-"+Ce(this).toString(je);for(var ke=ae(Math.pow(je,6)),Ne=this,Ge="";;){var Ie=We(Ne,ke).g;Ne=Fe(Ne,Ie.j(ke));var Le=((0<Ne.g.length?Ne.g[0]:Ne.h)>>>0).toString(je);if(Ne=Ie,Re(Ne))return Le+Ge;for(;6>Le.length;)Le="0"+Le;Ge=Le+Ge}},E.i=function(je){return 0>je?0:je<this.g.length?this.g[je]:this.h};function Re(je){if(je.h!=0)return!1;for(var ke=0;ke<je.g.length;ke++)if(je.g[ke]!=0)return!1;return!0}function Pe(je){return je.h==-1}E.l=function(je){return je=Fe(this,je),Pe(je)?-1:Re(je)?0:1};function Ce(je){for(var ke=je.g.length,Ne=[],Ge=0;Ge<ke;Ge++)Ne[Ge]=~je.g[Ge];return new I(Ne,~je.h).add(me)}E.abs=function(){return Pe(this)?Ce(this):this},E.add=function(je){for(var ke=Math.max(this.g.length,je.g.length),Ne=[],Ge=0,Ie=0;Ie<=ke;Ie++){var Le=Ge+(this.i(Ie)&65535)+(je.i(Ie)&65535),He=(Le>>>16)+(this.i(Ie)>>>16)+(je.i(Ie)>>>16);Ge=He>>>16,Le&=65535,He&=65535,Ne[Ie]=He<<16|Le}return new I(Ne,Ne[Ne.length-1]&-2147483648?-1:0)};function Fe(je,ke){return je.add(Ce(ke))}E.j=function(je){if(Re(this)||Re(je))return ce;if(Pe(this))return Pe(je)?Ce(this).j(Ce(je)):Ce(Ce(this).j(je));if(Pe(je))return Ce(this.j(Ce(je)));if(0>this.l(_e)&&0>je.l(_e))return ae(this.m()*je.m());for(var ke=this.g.length+je.g.length,Ne=[],Ge=0;Ge<2*ke;Ge++)Ne[Ge]=0;for(Ge=0;Ge<this.g.length;Ge++)for(var Ie=0;Ie<je.g.length;Ie++){var Le=this.i(Ge)>>>16,He=this.i(Ge)&65535,Ct=je.i(Ie)>>>16,Ze=je.i(Ie)&65535;Ne[2*Ge+2*Ie]+=He*Ze,Me(Ne,2*Ge+2*Ie),Ne[2*Ge+2*Ie+1]+=Le*Ze,Me(Ne,2*Ge+2*Ie+1),Ne[2*Ge+2*Ie+1]+=He*Ct,Me(Ne,2*Ge+2*Ie+1),Ne[2*Ge+2*Ie+2]+=Le*Ct,Me(Ne,2*Ge+2*Ie+2)}for(Ge=0;Ge<ke;Ge++)Ne[Ge]=Ne[2*Ge+1]<<16|Ne[2*Ge];for(Ge=ke;Ge<2*ke;Ge++)Ne[Ge]=0;return new I(Ne,0)};function Me(je,ke){for(;(je[ke]&65535)!=je[ke];)je[ke+1]+=je[ke]>>>16,je[ke]&=65535,ke++}function Ve(je,ke){this.g=je,this.h=ke}function We(je,ke){if(Re(ke))throw Error("division by zero");if(Re(je))return new Ve(ce,ce);if(Pe(je))return ke=We(Ce(je),ke),new Ve(Ce(ke.g),Ce(ke.h));if(Pe(ke))return ke=We(je,Ce(ke)),new Ve(Ce(ke.g),ke.h);if(30<je.g.length){if(Pe(je)||Pe(ke))throw Error("slowDivide_ only works with positive integers.");for(var Ne=me,Ge=ke;0>=Ge.l(je);)Ne=ze(Ne),Ge=ze(Ge);var Ie=Ue(Ne,1),Le=Ue(Ge,1);for(Ge=Ue(Ge,2),Ne=Ue(Ne,2);!Re(Ge);){var He=Le.add(Ge);0>=He.l(je)&&(Ie=Ie.add(Ne),Le=He),Ge=Ue(Ge,1),Ne=Ue(Ne,1)}return ke=Fe(je,Ie.j(ke)),new Ve(Ie,ke)}for(Ie=ce;0<=je.l(ke);){for(Ne=Math.max(1,Math.floor(je.m()/ke.m())),Ge=Math.ceil(Math.log(Ne)/Math.LN2),Ge=48>=Ge?1:Math.pow(2,Ge-48),Le=ae(Ne),He=Le.j(ke);Pe(He)||0<He.l(je);)Ne-=Ge,Le=ae(Ne),He=Le.j(ke);Re(Le)&&(Le=me),Ie=Ie.add(Le),je=Fe(je,He)}return new Ve(Ie,je)}E.A=function(je){return We(this,je).h},E.and=function(je){for(var ke=Math.max(this.g.length,je.g.length),Ne=[],Ge=0;Ge<ke;Ge++)Ne[Ge]=this.i(Ge)&je.i(Ge);return new I(Ne,this.h&je.h)},E.or=function(je){for(var ke=Math.max(this.g.length,je.g.length),Ne=[],Ge=0;Ge<ke;Ge++)Ne[Ge]=this.i(Ge)|je.i(Ge);return new I(Ne,this.h|je.h)},E.xor=function(je){for(var ke=Math.max(this.g.length,je.g.length),Ne=[],Ge=0;Ge<ke;Ge++)Ne[Ge]=this.i(Ge)^je.i(Ge);return new I(Ne,this.h^je.h)};function ze(je){for(var ke=je.g.length+1,Ne=[],Ge=0;Ge<ke;Ge++)Ne[Ge]=je.i(Ge)<<1|je.i(Ge-1)>>>31;return new I(Ne,je.h)}function Ue(je,ke){var Ne=ke>>5;ke%=32;for(var Ge=je.g.length-Ne,Ie=[],Le=0;Le<Ge;Le++)Ie[Le]=0<ke?je.i(Le+Ne)>>>ke|je.i(Le+Ne+1)<<32-ke:je.i(Le+Ne);return new I(Ie,je.h)}T.prototype.digest=T.prototype.v,T.prototype.reset=T.prototype.s,T.prototype.update=T.prototype.u,Md5=T,I.prototype.add=I.prototype.add,I.prototype.multiply=I.prototype.j,I.prototype.modulo=I.prototype.A,I.prototype.compare=I.prototype.l,I.prototype.toNumber=I.prototype.m,I.prototype.toString=I.prototype.toString,I.prototype.getBits=I.prototype.i,I.fromNumber=ae,I.fromString=ie,Integer=I}).apply(typeof commonjsGlobal$1<"u"?commonjsGlobal$1:typeof self<"u"?self:typeof window<"u"?window:{});var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var XhrIo,WebChannel,EventType,ErrorCode,Stat,Event$1,getStatEventTarget,createWebChannelTransport;(function(){var E,r=typeof Object.defineProperties=="function"?Object.defineProperty:function(we,Ke,tt){return we==Array.prototype||we==Object.prototype||(we[Ke]=tt.value),we};function v(we){we=[typeof globalThis=="object"&&globalThis,we,typeof window=="object"&&window,typeof self=="object"&&self,typeof commonjsGlobal=="object"&&commonjsGlobal];for(var Ke=0;Ke<we.length;++Ke){var tt=we[Ke];if(tt&&tt.Math==Math)return tt}throw Error("Cannot find global object")}var T=v(this);function w(we,Ke){if(Ke)e:{var tt=T;we=we.split(".");for(var Kt=0;Kt<we.length-1;Kt++){var kr=we[Kt];if(!(kr in tt))break e;tt=tt[kr]}we=we[we.length-1],Kt=tt[we],Ke=Ke(Kt),Ke!=Kt&&Ke!=null&&r(tt,we,{configurable:!0,writable:!0,value:Ke})}}function S(we,Ke){we instanceof String&&(we+="");var tt=0,Kt=!1,kr={next:function(){if(!Kt&&tt<we.length){var Ur=tt++;return{value:Ke(Ur,we[Ur]),done:!1}}return Kt=!0,{done:!0,value:void 0}}};return kr[Symbol.iterator]=function(){return kr},kr}w("Array.prototype.values",function(we){return we||function(){return S(this,function(Ke,tt){return tt})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var I=I||{},H=this||self;function te(we){var Ke=typeof we;return Ke=Ke!="object"?Ke:we?Array.isArray(we)?"array":Ke:"null",Ke=="array"||Ke=="object"&&typeof we.length=="number"}function ae(we){var Ke=typeof we;return Ke=="object"&&we!=null||Ke=="function"}function ie(we,Ke,tt){return we.call.apply(we.bind,arguments)}function ce(we,Ke,tt){if(!we)throw Error();if(2<arguments.length){var Kt=Array.prototype.slice.call(arguments,2);return function(){var kr=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(kr,Kt),we.apply(Ke,kr)}}return function(){return we.apply(Ke,arguments)}}function me(we,Ke,tt){return me=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?ie:ce,me.apply(null,arguments)}function _e(we,Ke){var tt=Array.prototype.slice.call(arguments,1);return function(){var Kt=tt.slice();return Kt.push.apply(Kt,arguments),we.apply(this,Kt)}}function Re(we,Ke){function tt(){}tt.prototype=Ke.prototype,we.aa=Ke.prototype,we.prototype=new tt,we.prototype.constructor=we,we.Qb=function(Kt,kr,Ur){for(var es=Array(arguments.length-2),us=2;us<arguments.length;us++)es[us-2]=arguments[us];return Ke.prototype[kr].apply(Kt,es)}}function Pe(we){const Ke=we.length;if(0<Ke){const tt=Array(Ke);for(let Kt=0;Kt<Ke;Kt++)tt[Kt]=we[Kt];return tt}return[]}function Ce(we,Ke){for(let tt=1;tt<arguments.length;tt++){const Kt=arguments[tt];if(te(Kt)){const kr=we.length||0,Ur=Kt.length||0;we.length=kr+Ur;for(let es=0;es<Ur;es++)we[kr+es]=Kt[es]}else we.push(Kt)}}class Fe{constructor(Ke,tt){this.i=Ke,this.j=tt,this.h=0,this.g=null}get(){let Ke;return 0<this.h?(this.h--,Ke=this.g,this.g=Ke.next,Ke.next=null):Ke=this.i(),Ke}}function Me(we){return/^[\s\xa0]*$/.test(we)}function Ve(){var we=H.navigator;return we&&(we=we.userAgent)?we:""}function We(we){return We[" "](we),we}We[" "]=function(){};var ze=Ve().indexOf("Gecko")!=-1&&!(Ve().toLowerCase().indexOf("webkit")!=-1&&Ve().indexOf("Edge")==-1)&&!(Ve().indexOf("Trident")!=-1||Ve().indexOf("MSIE")!=-1)&&Ve().indexOf("Edge")==-1;function Ue(we,Ke,tt){for(const Kt in we)Ke.call(tt,we[Kt],Kt,we)}function je(we,Ke){for(const tt in we)Ke.call(void 0,we[tt],tt,we)}function ke(we){const Ke={};for(const tt in we)Ke[tt]=we[tt];return Ke}const Ne="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ge(we,Ke){let tt,Kt;for(let kr=1;kr<arguments.length;kr++){Kt=arguments[kr];for(tt in Kt)we[tt]=Kt[tt];for(let Ur=0;Ur<Ne.length;Ur++)tt=Ne[Ur],Object.prototype.hasOwnProperty.call(Kt,tt)&&(we[tt]=Kt[tt])}}function Ie(we){var Ke=1;we=we.split(":");const tt=[];for(;0<Ke&&we.length;)tt.push(we.shift()),Ke--;return we.length&&tt.push(we.join(":")),tt}function Le(we){H.setTimeout(()=>{throw we},0)}function He(){var we=Je;let Ke=null;return we.g&&(Ke=we.g,we.g=we.g.next,we.g||(we.h=null),Ke.next=null),Ke}class Ct{constructor(){this.h=this.g=null}add(Ke,tt){const Kt=Ze.get();Kt.set(Ke,tt),this.h?this.h.next=Kt:this.g=Kt,this.h=Kt}}var Ze=new Fe(()=>new Rt,we=>we.reset());class Rt{constructor(){this.next=this.g=this.h=null}set(Ke,tt){this.h=Ke,this.g=tt,this.next=null}reset(){this.next=this.g=this.h=null}}let nt,nr=!1,Je=new Ct,Wt=()=>{const we=H.Promise.resolve(void 0);nt=()=>{we.then(Lt)}};var Lt=()=>{for(var we;we=He();){try{we.h.call(we.g)}catch(tt){Le(tt)}var Ke=Ze;Ke.j(we),100>Ke.h&&(Ke.h++,we.next=Ke.g,Ke.g=we)}nr=!1};function qe(){this.s=this.s,this.C=this.C}qe.prototype.s=!1,qe.prototype.ma=function(){this.s||(this.s=!0,this.N())},qe.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function $e(we,Ke){this.type=we,this.g=this.target=Ke,this.defaultPrevented=!1}$e.prototype.h=function(){this.defaultPrevented=!0};var Be=function(){if(!H.addEventListener||!Object.defineProperty)return!1;var we=!1,Ke=Object.defineProperty({},"passive",{get:function(){we=!0}});try{const tt=()=>{};H.addEventListener("test",tt,Ke),H.removeEventListener("test",tt,Ke)}catch{}return we}();function Xe(we,Ke){if($e.call(this,we?we.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,we){var tt=this.type=we.type,Kt=we.changedTouches&&we.changedTouches.length?we.changedTouches[0]:null;if(this.target=we.target||we.srcElement,this.g=Ke,Ke=we.relatedTarget){if(ze){e:{try{We(Ke.nodeName);var kr=!0;break e}catch{}kr=!1}kr||(Ke=null)}}else tt=="mouseover"?Ke=we.fromElement:tt=="mouseout"&&(Ke=we.toElement);this.relatedTarget=Ke,Kt?(this.clientX=Kt.clientX!==void 0?Kt.clientX:Kt.pageX,this.clientY=Kt.clientY!==void 0?Kt.clientY:Kt.pageY,this.screenX=Kt.screenX||0,this.screenY=Kt.screenY||0):(this.clientX=we.clientX!==void 0?we.clientX:we.pageX,this.clientY=we.clientY!==void 0?we.clientY:we.pageY,this.screenX=we.screenX||0,this.screenY=we.screenY||0),this.button=we.button,this.key=we.key||"",this.ctrlKey=we.ctrlKey,this.altKey=we.altKey,this.shiftKey=we.shiftKey,this.metaKey=we.metaKey,this.pointerId=we.pointerId||0,this.pointerType=typeof we.pointerType=="string"?we.pointerType:rt[we.pointerType]||"",this.state=we.state,this.i=we,we.defaultPrevented&&Xe.aa.h.call(this)}}Re(Xe,$e);var rt={2:"touch",3:"pen",4:"mouse"};Xe.prototype.h=function(){Xe.aa.h.call(this);var we=this.i;we.preventDefault?we.preventDefault():we.returnValue=!1};var Qe="closure_listenable_"+(1e6*Math.random()|0),vt=0;function Dt(we,Ke,tt,Kt,kr){this.listener=we,this.proxy=null,this.src=Ke,this.type=tt,this.capture=!!Kt,this.ha=kr,this.key=++vt,this.da=this.fa=!1}function Ut(we){we.da=!0,we.listener=null,we.proxy=null,we.src=null,we.ha=null}function hr(we){this.src=we,this.g={},this.h=0}hr.prototype.add=function(we,Ke,tt,Kt,kr){var Ur=we.toString();we=this.g[Ur],we||(we=this.g[Ur]=[],this.h++);var es=yr(we,Ke,Kt,kr);return-1<es?(Ke=we[es],tt||(Ke.fa=!1)):(Ke=new Dt(Ke,this.src,Ur,!!Kt,kr),Ke.fa=tt,we.push(Ke)),Ke};function pt(we,Ke){var tt=Ke.type;if(tt in we.g){var Kt=we.g[tt],kr=Array.prototype.indexOf.call(Kt,Ke,void 0),Ur;(Ur=0<=kr)&&Array.prototype.splice.call(Kt,kr,1),Ur&&(Ut(Ke),we.g[tt].length==0&&(delete we.g[tt],we.h--))}}function yr(we,Ke,tt,Kt){for(var kr=0;kr<we.length;++kr){var Ur=we[kr];if(!Ur.da&&Ur.listener==Ke&&Ur.capture==!!tt&&Ur.ha==Kt)return kr}return-1}var vr="closure_lm_"+(1e6*Math.random()|0),wr={};function ir(we,Ke,tt,Kt,kr){if(Array.isArray(Ke)){for(var Ur=0;Ur<Ke.length;Ur++)ir(we,Ke[Ur],tt,Kt,kr);return null}return tt=Et(tt),we&&we[Qe]?we.K(Ke,tt,ae(Kt)?!!Kt.capture:!1,kr):sr(we,Ke,tt,!1,Kt,kr)}function sr(we,Ke,tt,Kt,kr,Ur){if(!Ke)throw Error("Invalid event type");var es=ae(kr)?!!kr.capture:!!kr,us=Or(we);if(us||(we[vr]=us=new hr(we)),tt=us.add(Ke,tt,Kt,es,Ur),tt.proxy)return tt;if(Kt=kt(),tt.proxy=Kt,Kt.src=we,Kt.listener=tt,we.addEventListener)Be||(kr=es),kr===void 0&&(kr=!1),we.addEventListener(Ke.toString(),Kt,kr);else if(we.attachEvent)we.attachEvent(mr(Ke.toString()),Kt);else if(we.addListener&&we.removeListener)we.addListener(Kt);else throw Error("addEventListener and attachEvent are unavailable.");return tt}function kt(){function we(tt){return Ke.call(we.src,we.listener,tt)}const Ke=Ir;return we}function rr(we,Ke,tt,Kt,kr){if(Array.isArray(Ke))for(var Ur=0;Ur<Ke.length;Ur++)rr(we,Ke[Ur],tt,Kt,kr);else Kt=ae(Kt)?!!Kt.capture:!!Kt,tt=Et(tt),we&&we[Qe]?(we=we.i,Ke=String(Ke).toString(),Ke in we.g&&(Ur=we.g[Ke],tt=yr(Ur,tt,Kt,kr),-1<tt&&(Ut(Ur[tt]),Array.prototype.splice.call(Ur,tt,1),Ur.length==0&&(delete we.g[Ke],we.h--)))):we&&(we=Or(we))&&(Ke=we.g[Ke.toString()],we=-1,Ke&&(we=yr(Ke,tt,Kt,kr)),(tt=-1<we?Ke[we]:null)&&lr(tt))}function lr(we){if(typeof we!="number"&&we&&!we.da){var Ke=we.src;if(Ke&&Ke[Qe])pt(Ke.i,we);else{var tt=we.type,Kt=we.proxy;Ke.removeEventListener?Ke.removeEventListener(tt,Kt,we.capture):Ke.detachEvent?Ke.detachEvent(mr(tt),Kt):Ke.addListener&&Ke.removeListener&&Ke.removeListener(Kt),(tt=Or(Ke))?(pt(tt,we),tt.h==0&&(tt.src=null,Ke[vr]=null)):Ut(we)}}}function mr(we){return we in wr?wr[we]:wr[we]="on"+we}function Ir(we,Ke){if(we.da)we=!0;else{Ke=new Xe(Ke,this);var tt=we.listener,Kt=we.ha||we.src;we.fa&&lr(we),we=tt.call(Kt,Ke)}return we}function Or(we){return we=we[vr],we instanceof hr?we:null}var Fr="__closure_events_fn_"+(1e9*Math.random()>>>0);function Et(we){return typeof we=="function"?we:(we[Fr]||(we[Fr]=function(Ke){return we.handleEvent(Ke)}),we[Fr])}function dr(){qe.call(this),this.i=new hr(this),this.M=this,this.F=null}Re(dr,qe),dr.prototype[Qe]=!0,dr.prototype.removeEventListener=function(we,Ke,tt,Kt){rr(this,we,Ke,tt,Kt)};function br(we,Ke){var tt,Kt=we.F;if(Kt)for(tt=[];Kt;Kt=Kt.F)tt.push(Kt);if(we=we.M,Kt=Ke.type||Ke,typeof Ke=="string")Ke=new $e(Ke,we);else if(Ke instanceof $e)Ke.target=Ke.target||we;else{var kr=Ke;Ke=new $e(Kt,we),Ge(Ke,kr)}if(kr=!0,tt)for(var Ur=tt.length-1;0<=Ur;Ur--){var es=Ke.g=tt[Ur];kr=Br(es,Kt,!0,Ke)&&kr}if(es=Ke.g=we,kr=Br(es,Kt,!0,Ke)&&kr,kr=Br(es,Kt,!1,Ke)&&kr,tt)for(Ur=0;Ur<tt.length;Ur++)es=Ke.g=tt[Ur],kr=Br(es,Kt,!1,Ke)&&kr}dr.prototype.N=function(){if(dr.aa.N.call(this),this.i){var we=this.i,Ke;for(Ke in we.g){for(var tt=we.g[Ke],Kt=0;Kt<tt.length;Kt++)Ut(tt[Kt]);delete we.g[Ke],we.h--}}this.F=null},dr.prototype.K=function(we,Ke,tt,Kt){return this.i.add(String(we),Ke,!1,tt,Kt)},dr.prototype.L=function(we,Ke,tt,Kt){return this.i.add(String(we),Ke,!0,tt,Kt)};function Br(we,Ke,tt,Kt){if(Ke=we.i.g[String(Ke)],!Ke)return!0;Ke=Ke.concat();for(var kr=!0,Ur=0;Ur<Ke.length;++Ur){var es=Ke[Ur];if(es&&!es.da&&es.capture==tt){var us=es.listener,ps=es.ha||es.src;es.fa&&pt(we.i,es),kr=us.call(ps,Kt)!==!1&&kr}}return kr&&!Kt.defaultPrevented}function Lr(we,Ke,tt){if(typeof we=="function")tt&&(we=me(we,tt));else if(we&&typeof we.handleEvent=="function")we=me(we.handleEvent,we);else throw Error("Invalid listener argument");return 2147483647<Number(Ke)?-1:H.setTimeout(we,Ke||0)}function or(we){we.g=Lr(()=>{we.g=null,we.i&&(we.i=!1,or(we))},we.l);const Ke=we.h;we.h=null,we.m.apply(null,Ke)}class ur extends qe{constructor(Ke,tt){super(),this.m=Ke,this.l=tt,this.h=null,this.i=!1,this.g=null}j(Ke){this.h=arguments,this.g?this.i=!0:or(this)}N(){super.N(),this.g&&(H.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function gr(we){qe.call(this),this.h=we,this.g={}}Re(gr,qe);var $r=[];function Xr(we){Ue(we.g,function(Ke,tt){this.g.hasOwnProperty(tt)&&lr(Ke)},we),we.g={}}gr.prototype.N=function(){gr.aa.N.call(this),Xr(this)},gr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Rr=H.JSON.stringify,pr=H.JSON.parse,xr=class{stringify(we){return H.JSON.stringify(we,void 0)}parse(we){return H.JSON.parse(we,void 0)}};function qr(){}qr.prototype.h=null;function ns(we){return we.h||(we.h=we.i())}function ss(){}var ar={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Sr(){$e.call(this,"d")}Re(Sr,$e);function zr(){$e.call(this,"c")}Re(zr,$e);var Gr={},Qr=null;function Wr(){return Qr=Qr||new dr}Gr.La="serverreachability";function er(we){$e.call(this,Gr.La,we)}Re(er,$e);function Bt(we){const Ke=Wr();br(Ke,new er(Ke))}Gr.STAT_EVENT="statevent";function cr(we,Ke){$e.call(this,Gr.STAT_EVENT,we),this.stat=Ke}Re(cr,$e);function _r(we){const Ke=Wr();br(Ke,new cr(Ke,we))}Gr.Ma="timingevent";function jr(we,Ke){$e.call(this,Gr.Ma,we),this.size=Ke}Re(jr,$e);function Mr(we,Ke){if(typeof we!="function")throw Error("Fn must not be null and must be a function");return H.setTimeout(function(){we()},Ke)}function Vr(){this.g=!0}Vr.prototype.xa=function(){this.g=!1};function Zr(we,Ke,tt,Kt,kr,Ur){we.info(function(){if(we.g)if(Ur)for(var es="",us=Ur.split("&"),ps=0;ps<us.length;ps++){var is=us[ps].split("=");if(1<is.length){var ms=is[0];is=is[1];var gs=ms.split("_");es=2<=gs.length&&gs[1]=="type"?es+(ms+"="+is+"&"):es+(ms+"=redacted&")}}else es=null;else es=Ur;return"XMLHTTP REQ ("+Kt+") [attempt "+kr+"]: "+Ke+`
`+tt+`
`+es})}function Jr(we,Ke,tt,Kt,kr,Ur,es){we.info(function(){return"XMLHTTP RESP ("+Kt+") [ attempt "+kr+"]: "+Ke+`
`+tt+`
`+Ur+" "+es})}function et(we,Ke,tt,Kt){we.info(function(){return"XMLHTTP TEXT ("+Ke+"): "+It(we,tt)+(Kt?" "+Kt:"")})}function Gt(we,Ke){we.info(function(){return"TIMEOUT: "+Ke})}Vr.prototype.info=function(){};function It(we,Ke){if(!we.g)return Ke;if(!Ke)return null;try{var tt=JSON.parse(Ke);if(tt){for(we=0;we<tt.length;we++)if(Array.isArray(tt[we])){var Kt=tt[we];if(!(2>Kt.length)){var kr=Kt[1];if(Array.isArray(kr)&&!(1>kr.length)){var Ur=kr[0];if(Ur!="noop"&&Ur!="stop"&&Ur!="close")for(var es=1;es<kr.length;es++)kr[es]=""}}}}return Rr(tt)}catch{return Ke}}var Nt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},qt={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},tr;function Er(){}Re(Er,qr),Er.prototype.g=function(){return new XMLHttpRequest},Er.prototype.i=function(){return{}},tr=new Er;function Nr(we,Ke,tt,Kt){this.j=we,this.i=Ke,this.l=tt,this.R=Kt||1,this.U=new gr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Pr}function Pr(){this.i=null,this.g="",this.h=!1}var Cr={},Dr={};function Hr(we,Ke,tt){we.L=1,we.v=mn(Ts(Ke)),we.m=tt,we.P=!0,Kr(we,null)}function Kr(we,Ke){we.F=Date.now(),ts(we),we.A=Ts(we.v);var tt=we.A,Kt=we.R;Array.isArray(Kt)||(Kt=[String(Kt)]),La(tt.i,"t",Kt),we.C=0,tt=we.j.J,we.h=new Pr,we.g=ei(we.j,tt?Ke:null,!we.m),0<we.O&&(we.M=new ur(me(we.Y,we,we.g),we.O)),Ke=we.U,tt=we.g,Kt=we.ca;var kr="readystatechange";Array.isArray(kr)||(kr&&($r[0]=kr.toString()),kr=$r);for(var Ur=0;Ur<kr.length;Ur++){var es=ir(tt,kr[Ur],Kt||Ke.handleEvent,!1,Ke.h||Ke);if(!es)break;Ke.g[es.key]=es}Ke=we.H?ke(we.H):{},we.m?(we.u||(we.u="POST"),Ke["Content-Type"]="application/x-www-form-urlencoded",we.g.ea(we.A,we.u,we.m,Ke)):(we.u="GET",we.g.ea(we.A,we.u,null,Ke)),Bt(),Zr(we.i,we.u,we.A,we.l,we.R,we.m)}Nr.prototype.ca=function(we){we=we.target;const Ke=this.M;Ke&&bs(we)==3?Ke.j():this.Y(we)},Nr.prototype.Y=function(we){try{if(we==this.g)e:{const gs=bs(this.g);var Ke=this.g.Ba();const Ls=this.g.Z();if(!(3>gs)&&(gs!=3||this.g&&(this.h.h||this.g.oa()||za(this.g)))){this.J||gs!=4||Ke==7||(Ke==8||0>=Ls?Bt(3):Bt(2)),ls(this);var tt=this.g.Z();this.X=tt;t:if(rs(this)){var Kt=za(this.g);we="";var kr=Kt.length,Ur=bs(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){ds(this),os(this);var es="";break t}this.h.i=new H.TextDecoder}for(Ke=0;Ke<kr;Ke++)this.h.h=!0,we+=this.h.i.decode(Kt[Ke],{stream:!(Ur&&Ke==kr-1)});Kt.length=0,this.h.g+=we,this.C=0,es=this.h.g}else es=this.g.oa();if(this.o=tt==200,Jr(this.i,this.u,this.A,this.l,this.R,gs,tt),this.o){if(this.T&&!this.K){t:{if(this.g){var us,ps=this.g;if((us=ps.g?ps.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Me(us)){var is=us;break t}}is=null}if(tt=is)et(this.i,this.l,tt,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Rs(this,tt);else{this.o=!1,this.s=3,_r(12),ds(this),os(this);break e}}if(this.P){tt=!0;let vs;for(;!this.J&&this.C<es.length;)if(vs=Yr(this,es),vs==Dr){gs==4&&(this.s=4,_r(14),tt=!1),et(this.i,this.l,null,"[Incomplete Response]");break}else if(vs==Cr){this.s=4,_r(15),et(this.i,this.l,es,"[Invalid Chunk]"),tt=!1;break}else et(this.i,this.l,vs,null),Rs(this,vs);if(rs(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),gs!=4||es.length!=0||this.h.h||(this.s=1,_r(16),tt=!1),this.o=this.o&&tt,!tt)et(this.i,this.l,es,"[Invalid Chunked Response]"),ds(this),os(this);else if(0<es.length&&!this.W){this.W=!0;var ms=this.j;ms.g==this&&ms.ba&&!ms.M&&(ms.j.info("Great, no buffering proxy detected. Bytes received: "+es.length),zn(ms),ms.M=!0,_r(11))}}else et(this.i,this.l,es,null),Rs(this,es);gs==4&&ds(this),this.o&&!this.J&&(gs==4?Ya(this.j,this):(this.o=!1,ts(this)))}else to(this.g),tt==400&&0<es.indexOf("Unknown SID")?(this.s=3,_r(12)):(this.s=0,_r(13)),ds(this),os(this)}}}catch{}finally{}};function rs(we){return we.g?we.u=="GET"&&we.L!=2&&we.j.Ca:!1}function Yr(we,Ke){var tt=we.C,Kt=Ke.indexOf(`
`,tt);return Kt==-1?Dr:(tt=Number(Ke.substring(tt,Kt)),isNaN(tt)?Cr:(Kt+=1,Kt+tt>Ke.length?Dr:(Ke=Ke.slice(Kt,Kt+tt),we.C=Kt+tt,Ke)))}Nr.prototype.cancel=function(){this.J=!0,ds(this)};function ts(we){we.S=Date.now()+we.I,as(we,we.I)}function as(we,Ke){if(we.B!=null)throw Error("WatchDog timer not null");we.B=Mr(me(we.ba,we),Ke)}function ls(we){we.B&&(H.clearTimeout(we.B),we.B=null)}Nr.prototype.ba=function(){this.B=null;const we=Date.now();0<=we-this.S?(Gt(this.i,this.A),this.L!=2&&(Bt(),_r(17)),ds(this),this.s=2,os(this)):as(this,this.S-we)};function os(we){we.j.G==0||we.J||Ya(we.j,we)}function ds(we){ls(we);var Ke=we.M;Ke&&typeof Ke.ma=="function"&&Ke.ma(),we.M=null,Xr(we.U),we.g&&(Ke=we.g,we.g=null,Ke.abort(),Ke.ma())}function Rs(we,Ke){try{var tt=we.j;if(tt.G!=0&&(tt.g==we||_s(tt.h,we))){if(!we.K&&_s(tt.h,we)&&tt.G==3){try{var Kt=tt.Da.g.parse(Ke)}catch{Kt=null}if(Array.isArray(Kt)&&Kt.length==3){var kr=Kt;if(kr[0]==0){e:if(!tt.u){if(tt.g)if(tt.g.F+3e3<we.F)Rn(tt),vn(tt);else break e;$n(tt),_r(18)}}else tt.za=kr[1],0<tt.za-tt.T&&37500>kr[2]&&tt.F&&tt.v==0&&!tt.C&&(tt.C=Mr(me(tt.Za,tt),6e3));if(1>=Ns(tt.h)&&tt.ca){try{tt.ca()}catch{}tt.ca=void 0}}else Is(tt,11)}else if((we.K||tt.g==we)&&Rn(tt),!Me(Ke))for(kr=tt.Da.g.parse(Ke),Ke=0;Ke<kr.length;Ke++){let is=kr[Ke];if(tt.T=is[0],is=is[1],tt.G==2)if(is[0]=="c"){tt.K=is[1],tt.ia=is[2];const ms=is[3];ms!=null&&(tt.la=ms,tt.j.info("VER="+tt.la));const gs=is[4];gs!=null&&(tt.Aa=gs,tt.j.info("SVER="+tt.Aa));const Ls=is[5];Ls!=null&&typeof Ls=="number"&&0<Ls&&(Kt=1.5*Ls,tt.L=Kt,tt.j.info("backChannelRequestTimeoutMs_="+Kt)),Kt=tt;const vs=we.g;if(vs){const bn=vs.g?vs.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(bn){var Ur=Kt.h;Ur.g||bn.indexOf("spdy")==-1&&bn.indexOf("quic")==-1&&bn.indexOf("h2")==-1||(Ur.j=Ur.l,Ur.g=new Set,Ur.h&&(Vn(Ur,Ur.h),Ur.h=null))}if(Kt.D){const Hn=vs.g?vs.g.getResponseHeader("X-HTTP-Session-Id"):null;Hn&&(Kt.ya=Hn,hs(Kt.I,Kt.D,Hn))}}tt.G=3,tt.l&&tt.l.ua(),tt.ba&&(tt.R=Date.now()-we.F,tt.j.info("Handshake RTT: "+tt.R+"ms")),Kt=tt;var es=we;if(Kt.qa=Za(Kt,Kt.J?Kt.ia:null,Kt.W),es.K){Ca(Kt.h,es);var us=es,ps=Kt.L;ps&&(us.I=ps),us.B&&(ls(us),ts(us)),Kt.g=es}else Xa(Kt);0<tt.i.length&&yn(tt)}else is[0]!="stop"&&is[0]!="close"||Is(tt,7);else tt.G==3&&(is[0]=="stop"||is[0]=="close"?is[0]=="stop"?Is(tt,7):Un(tt):is[0]!="noop"&&tt.l&&tt.l.ta(is),tt.v=0)}}Bt(4)}catch{}}var Ps=class{constructor(we,Ke){this.g=we,this.map=Ke}};function ws(we){this.l=we||10,H.PerformanceNavigationTiming?(we=H.performance.getEntriesByType("navigation"),we=0<we.length&&(we[0].nextHopProtocol=="hq"||we[0].nextHopProtocol=="h2")):we=!!(H.chrome&&H.chrome.loadTimes&&H.chrome.loadTimes()&&H.chrome.loadTimes().wasFetchedViaSpdy),this.j=we?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ys(we){return we.h?!0:we.g?we.g.size>=we.j:!1}function Ns(we){return we.h?1:we.g?we.g.size:0}function _s(we,Ke){return we.h?we.h==Ke:we.g?we.g.has(Ke):!1}function Vn(we,Ke){we.g?we.g.add(Ke):we.h=Ke}function Ca(we,Ke){we.h&&we.h==Ke?we.h=null:we.g&&we.g.has(Ke)&&we.g.delete(Ke)}ws.prototype.cancel=function(){if(this.i=Pa(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const we of this.g.values())we.cancel();this.g.clear()}};function Pa(we){if(we.h!=null)return we.i.concat(we.h.D);if(we.g!=null&&we.g.size!==0){let Ke=we.i;for(const tt of we.g.values())Ke=Ke.concat(tt.D);return Ke}return Pe(we.i)}function Bi(we){if(we.V&&typeof we.V=="function")return we.V();if(typeof Map<"u"&&we instanceof Map||typeof Set<"u"&&we instanceof Set)return Array.from(we.values());if(typeof we=="string")return we.split("");if(te(we)){for(var Ke=[],tt=we.length,Kt=0;Kt<tt;Kt++)Ke.push(we[Kt]);return Ke}Ke=[],tt=0;for(Kt in we)Ke[tt++]=we[Kt];return Ke}function Ui(we){if(we.na&&typeof we.na=="function")return we.na();if(!we.V||typeof we.V!="function"){if(typeof Map<"u"&&we instanceof Map)return Array.from(we.keys());if(!(typeof Set<"u"&&we instanceof Set)){if(te(we)||typeof we=="string"){var Ke=[];we=we.length;for(var tt=0;tt<we;tt++)Ke.push(tt);return Ke}Ke=[],tt=0;for(const Kt in we)Ke[tt++]=Kt;return Ke}}}function ja(we,Ke){if(we.forEach&&typeof we.forEach=="function")we.forEach(Ke,void 0);else if(te(we)||typeof we=="string")Array.prototype.forEach.call(we,Ke,void 0);else for(var tt=Ui(we),Kt=Bi(we),kr=Kt.length,Ur=0;Ur<kr;Ur++)Ke.call(void 0,Kt[Ur],tt&&tt[Ur],we)}var Ia=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $i(we,Ke){if(we){we=we.split("&");for(var tt=0;tt<we.length;tt++){var Kt=we[tt].indexOf("="),kr=null;if(0<=Kt){var Ur=we[tt].substring(0,Kt);kr=we[tt].substring(Kt+1)}else Ur=we[tt];Ke(Ur,kr?decodeURIComponent(kr.replace(/\+/g," ")):"")}}}function js(we){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,we instanceof js){this.h=we.h,fn(this,we.j),this.o=we.o,this.g=we.g,pn(this,we.s),this.l=we.l;var Ke=we.i,tt=new Hs;tt.i=Ke.i,Ke.g&&(tt.g=new Map(Ke.g),tt.h=Ke.h),ka(this,tt),this.m=we.m}else we&&(Ke=String(we).match(Ia))?(this.h=!1,fn(this,Ke[1]||"",!0),this.o=$s(Ke[2]||""),this.g=$s(Ke[3]||"",!0),pn(this,Ke[4]),this.l=$s(Ke[5]||"",!0),ka(this,Ke[6]||"",!0),this.m=$s(Ke[7]||"")):(this.h=!1,this.i=new Hs(null,this.h))}js.prototype.toString=function(){var we=[],Ke=this.j;Ke&&we.push(zs(Ke,Na,!0),":");var tt=this.g;return(tt||Ke=="file")&&(we.push("//"),(Ke=this.o)&&we.push(zs(Ke,Na,!0),"@"),we.push(encodeURIComponent(String(tt)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),tt=this.s,tt!=null&&we.push(":",String(tt))),(tt=this.l)&&(this.g&&tt.charAt(0)!="/"&&we.push("/"),we.push(zs(tt,tt.charAt(0)=="/"?Wi:Hi,!0))),(tt=this.i.toString())&&we.push("?",tt),(tt=this.m)&&we.push("#",zs(tt,qi)),we.join("")};function Ts(we){return new js(we)}function fn(we,Ke,tt){we.j=tt?$s(Ke,!0):Ke,we.j&&(we.j=we.j.replace(/:$/,""))}function pn(we,Ke){if(Ke){if(Ke=Number(Ke),isNaN(Ke)||0>Ke)throw Error("Bad port number "+Ke);we.s=Ke}else we.s=null}function ka(we,Ke,tt){Ke instanceof Hs?(we.i=Ke,Xi(we.i,we.h)):(tt||(Ke=zs(Ke,Gi)),we.i=new Hs(Ke,we.h))}function hs(we,Ke,tt){we.i.set(Ke,tt)}function mn(we){return hs(we,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),we}function $s(we,Ke){return we?Ke?decodeURI(we.replace(/%25/g,"%2525")):decodeURIComponent(we):""}function zs(we,Ke,tt){return typeof we=="string"?(we=encodeURI(we).replace(Ke,zi),tt&&(we=we.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),we):null}function zi(we){return we=we.charCodeAt(0),"%"+(we>>4&15).toString(16)+(we&15).toString(16)}var Na=/[#\/\?@]/g,Hi=/[#\?:]/g,Wi=/[#\?]/g,Gi=/[#\?@]/g,qi=/#/g;function Hs(we,Ke){this.h=this.g=null,this.i=we||null,this.j=!!Ke}function Ss(we){we.g||(we.g=new Map,we.h=0,we.i&&$i(we.i,function(Ke,tt){we.add(decodeURIComponent(Ke.replace(/\+/g," ")),tt)}))}E=Hs.prototype,E.add=function(we,Ke){Ss(this),this.i=null,we=Ds(this,we);var tt=this.g.get(we);return tt||this.g.set(we,tt=[]),tt.push(Ke),this.h+=1,this};function Da(we,Ke){Ss(we),Ke=Ds(we,Ke),we.g.has(Ke)&&(we.i=null,we.h-=we.g.get(Ke).length,we.g.delete(Ke))}function Fa(we,Ke){return Ss(we),Ke=Ds(we,Ke),we.g.has(Ke)}E.forEach=function(we,Ke){Ss(this),this.g.forEach(function(tt,Kt){tt.forEach(function(kr){we.call(Ke,kr,Kt,this)},this)},this)},E.na=function(){Ss(this);const we=Array.from(this.g.values()),Ke=Array.from(this.g.keys()),tt=[];for(let Kt=0;Kt<Ke.length;Kt++){const kr=we[Kt];for(let Ur=0;Ur<kr.length;Ur++)tt.push(Ke[Kt])}return tt},E.V=function(we){Ss(this);let Ke=[];if(typeof we=="string")Fa(this,we)&&(Ke=Ke.concat(this.g.get(Ds(this,we))));else{we=Array.from(this.g.values());for(let tt=0;tt<we.length;tt++)Ke=Ke.concat(we[tt])}return Ke},E.set=function(we,Ke){return Ss(this),this.i=null,we=Ds(this,we),Fa(this,we)&&(this.h-=this.g.get(we).length),this.g.set(we,[Ke]),this.h+=1,this},E.get=function(we,Ke){return we?(we=this.V(we),0<we.length?String(we[0]):Ke):Ke};function La(we,Ke,tt){Da(we,Ke),0<tt.length&&(we.i=null,we.g.set(Ds(we,Ke),Pe(tt)),we.h+=tt.length)}E.toString=function(){if(this.i)return this.i;if(!this.g)return"";const we=[],Ke=Array.from(this.g.keys());for(var tt=0;tt<Ke.length;tt++){var Kt=Ke[tt];const Ur=encodeURIComponent(String(Kt)),es=this.V(Kt);for(Kt=0;Kt<es.length;Kt++){var kr=Ur;es[Kt]!==""&&(kr+="="+encodeURIComponent(String(es[Kt]))),we.push(kr)}}return this.i=we.join("&")};function Ds(we,Ke){return Ke=String(Ke),we.j&&(Ke=Ke.toLowerCase()),Ke}function Xi(we,Ke){Ke&&!we.j&&(Ss(we),we.i=null,we.g.forEach(function(tt,Kt){var kr=Kt.toLowerCase();Kt!=kr&&(Da(this,Kt),La(this,kr,tt))},we)),we.j=Ke}function Ki(we,Ke){const tt=new Vr;if(H.Image){const Kt=new Image;Kt.onload=_e(Cs,tt,"TestLoadImage: loaded",!0,Ke,Kt),Kt.onerror=_e(Cs,tt,"TestLoadImage: error",!1,Ke,Kt),Kt.onabort=_e(Cs,tt,"TestLoadImage: abort",!1,Ke,Kt),Kt.ontimeout=_e(Cs,tt,"TestLoadImage: timeout",!1,Ke,Kt),H.setTimeout(function(){Kt.ontimeout&&Kt.ontimeout()},1e4),Kt.src=we}else Ke(!1)}function Yi(we,Ke){const tt=new Vr,Kt=new AbortController,kr=setTimeout(()=>{Kt.abort(),Cs(tt,"TestPingServer: timeout",!1,Ke)},1e4);fetch(we,{signal:Kt.signal}).then(Ur=>{clearTimeout(kr),Ur.ok?Cs(tt,"TestPingServer: ok",!0,Ke):Cs(tt,"TestPingServer: server error",!1,Ke)}).catch(()=>{clearTimeout(kr),Cs(tt,"TestPingServer: error",!1,Ke)})}function Cs(we,Ke,tt,Kt,kr){try{kr&&(kr.onload=null,kr.onerror=null,kr.onabort=null,kr.ontimeout=null),Kt(tt)}catch{}}function Ji(){this.g=new xr}function Qi(we,Ke,tt){const Kt=tt||"";try{ja(we,function(kr,Ur){let es=kr;ae(kr)&&(es=Rr(kr)),Ke.push(Kt+Ur+"="+encodeURIComponent(es))})}catch(kr){throw Ke.push(Kt+"type="+encodeURIComponent("_badmap")),kr}}function gn(we){this.l=we.Ub||null,this.j=we.eb||!1}Re(gn,qr),gn.prototype.g=function(){return new xn(this.l,this.j)},gn.prototype.i=function(we){return function(){return we}}({});function xn(we,Ke){dr.call(this),this.D=we,this.o=Ke,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}Re(xn,dr),E=xn.prototype,E.open=function(we,Ke){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=we,this.A=Ke,this.readyState=1,Gs(this)},E.send=function(we){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const Ke={headers:this.u,method:this.B,credentials:this.m,cache:void 0};we&&(Ke.body=we),(this.D||H).fetch(new Request(this.A,Ke)).then(this.Sa.bind(this),this.ga.bind(this))},E.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ws(this)),this.readyState=0},E.Sa=function(we){if(this.g&&(this.l=we,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=we.headers,this.readyState=2,Gs(this)),this.g&&(this.readyState=3,Gs(this),this.g)))if(this.responseType==="arraybuffer")we.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof H.ReadableStream<"u"&&"body"in we){if(this.j=we.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Ma(this)}else we.text().then(this.Ra.bind(this),this.ga.bind(this))};function Ma(we){we.j.read().then(we.Pa.bind(we)).catch(we.ga.bind(we))}E.Pa=function(we){if(this.g){if(this.o&&we.value)this.response.push(we.value);else if(!this.o){var Ke=we.value?we.value:new Uint8Array(0);(Ke=this.v.decode(Ke,{stream:!we.done}))&&(this.response=this.responseText+=Ke)}we.done?Ws(this):Gs(this),this.readyState==3&&Ma(this)}},E.Ra=function(we){this.g&&(this.response=this.responseText=we,Ws(this))},E.Qa=function(we){this.g&&(this.response=we,Ws(this))},E.ga=function(){this.g&&Ws(this)};function Ws(we){we.readyState=4,we.l=null,we.j=null,we.v=null,Gs(we)}E.setRequestHeader=function(we,Ke){this.u.append(we,Ke)},E.getResponseHeader=function(we){return this.h&&this.h.get(we.toLowerCase())||""},E.getAllResponseHeaders=function(){if(!this.h)return"";const we=[],Ke=this.h.entries();for(var tt=Ke.next();!tt.done;)tt=tt.value,we.push(tt[0]+": "+tt[1]),tt=Ke.next();return we.join(`\r
`)};function Gs(we){we.onreadystatechange&&we.onreadystatechange.call(we)}Object.defineProperty(xn.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(we){this.m=we?"include":"same-origin"}});function Oa(we){let Ke="";return Ue(we,function(tt,Kt){Ke+=Kt,Ke+=":",Ke+=tt,Ke+=`\r
`}),Ke}function Bn(we,Ke,tt){e:{for(Kt in tt){var Kt=!1;break e}Kt=!0}Kt||(tt=Oa(tt),typeof we=="string"?tt!=null&&encodeURIComponent(String(tt)):hs(we,Ke,tt))}function fs(we){dr.call(this),this.headers=new Map,this.o=we||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}Re(fs,dr);var Zi=/^https?$/i,eo=["POST","PUT"];E=fs.prototype,E.Ha=function(we){this.J=we},E.ea=function(we,Ke,tt,Kt){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+we);Ke=Ke?Ke.toUpperCase():"GET",this.D=we,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():tr.g(),this.v=this.o?ns(this.o):ns(tr),this.g.onreadystatechange=me(this.Ea,this);try{this.B=!0,this.g.open(Ke,String(we),!0),this.B=!1}catch(Ur){Va(this,Ur);return}if(we=tt||"",tt=new Map(this.headers),Kt)if(Object.getPrototypeOf(Kt)===Object.prototype)for(var kr in Kt)tt.set(kr,Kt[kr]);else if(typeof Kt.keys=="function"&&typeof Kt.get=="function")for(const Ur of Kt.keys())tt.set(Ur,Kt.get(Ur));else throw Error("Unknown input type for opt_headers: "+String(Kt));Kt=Array.from(tt.keys()).find(Ur=>Ur.toLowerCase()=="content-type"),kr=H.FormData&&we instanceof H.FormData,!(0<=Array.prototype.indexOf.call(eo,Ke,void 0))||Kt||kr||tt.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Ur,es]of tt)this.g.setRequestHeader(Ur,es);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{$a(this),this.u=!0,this.g.send(we),this.u=!1}catch(Ur){Va(this,Ur)}};function Va(we,Ke){we.h=!1,we.g&&(we.j=!0,we.g.abort(),we.j=!1),we.l=Ke,we.m=5,Ba(we),En(we)}function Ba(we){we.A||(we.A=!0,br(we,"complete"),br(we,"error"))}E.abort=function(we){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=we||7,br(this,"complete"),br(this,"abort"),En(this))},E.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),En(this,!0)),fs.aa.N.call(this)},E.Ea=function(){this.s||(this.B||this.u||this.j?Ua(this):this.bb())},E.bb=function(){Ua(this)};function Ua(we){if(we.h&&typeof I<"u"&&(!we.v[1]||bs(we)!=4||we.Z()!=2)){if(we.u&&bs(we)==4)Lr(we.Ea,0,we);else if(br(we,"readystatechange"),bs(we)==4){we.h=!1;try{const es=we.Z();e:switch(es){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var Ke=!0;break e;default:Ke=!1}var tt;if(!(tt=Ke)){var Kt;if(Kt=es===0){var kr=String(we.D).match(Ia)[1]||null;!kr&&H.self&&H.self.location&&(kr=H.self.location.protocol.slice(0,-1)),Kt=!Zi.test(kr?kr.toLowerCase():"")}tt=Kt}if(tt)br(we,"complete"),br(we,"success");else{we.m=6;try{var Ur=2<bs(we)?we.g.statusText:""}catch{Ur=""}we.l=Ur+" ["+we.Z()+"]",Ba(we)}}finally{En(we)}}}}function En(we,Ke){if(we.g){$a(we);const tt=we.g,Kt=we.v[0]?()=>{}:null;we.g=null,we.v=null,Ke||br(we,"ready");try{tt.onreadystatechange=Kt}catch{}}}function $a(we){we.I&&(H.clearTimeout(we.I),we.I=null)}E.isActive=function(){return!!this.g};function bs(we){return we.g?we.g.readyState:0}E.Z=function(){try{return 2<bs(this)?this.g.status:-1}catch{return-1}},E.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},E.Oa=function(we){if(this.g){var Ke=this.g.responseText;return we&&Ke.indexOf(we)==0&&(Ke=Ke.substring(we.length)),pr(Ke)}};function za(we){try{if(!we.g)return null;if("response"in we.g)return we.g.response;switch(we.H){case"":case"text":return we.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in we.g)return we.g.mozResponseArrayBuffer}return null}catch{return null}}function to(we){const Ke={};we=(we.g&&2<=bs(we)&&we.g.getAllResponseHeaders()||"").split(`\r
`);for(let Kt=0;Kt<we.length;Kt++){if(Me(we[Kt]))continue;var tt=Ie(we[Kt]);const kr=tt[0];if(tt=tt[1],typeof tt!="string")continue;tt=tt.trim();const Ur=Ke[kr]||[];Ke[kr]=Ur,Ur.push(tt)}je(Ke,function(Kt){return Kt.join(", ")})}E.Ba=function(){return this.m},E.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function qs(we,Ke,tt){return tt&&tt.internalChannelParams&&tt.internalChannelParams[we]||Ke}function Ha(we){this.Aa=0,this.i=[],this.j=new Vr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=qs("failFast",!1,we),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=qs("baseRetryDelayMs",5e3,we),this.cb=qs("retryDelaySeedMs",1e4,we),this.Wa=qs("forwardChannelMaxRetries",2,we),this.wa=qs("forwardChannelRequestTimeoutMs",2e4,we),this.pa=we&&we.xmlHttpFactory||void 0,this.Xa=we&&we.Tb||void 0,this.Ca=we&&we.useFetchStreams||!1,this.L=void 0,this.J=we&&we.supportsCrossDomainXhr||!1,this.K="",this.h=new ws(we&&we.concurrentRequestLimit),this.Da=new Ji,this.P=we&&we.fastHandshake||!1,this.O=we&&we.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=we&&we.Rb||!1,we&&we.xa&&this.j.xa(),we&&we.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&we&&we.detectBufferingProxy||!1,this.ja=void 0,we&&we.longPollingTimeout&&0<we.longPollingTimeout&&(this.ja=we.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}E=Ha.prototype,E.la=8,E.G=1,E.connect=function(we,Ke,tt,Kt){_r(0),this.W=we,this.H=Ke||{},tt&&Kt!==void 0&&(this.H.OSID=tt,this.H.OAID=Kt),this.F=this.X,this.I=Za(this,null,this.W),yn(this)};function Un(we){if(Wa(we),we.G==3){var Ke=we.U++,tt=Ts(we.I);if(hs(tt,"SID",we.K),hs(tt,"RID",Ke),hs(tt,"TYPE","terminate"),Xs(we,tt),Ke=new Nr(we,we.j,Ke),Ke.L=2,Ke.v=mn(Ts(tt)),tt=!1,H.navigator&&H.navigator.sendBeacon)try{tt=H.navigator.sendBeacon(Ke.v.toString(),"")}catch{}!tt&&H.Image&&(new Image().src=Ke.v,tt=!0),tt||(Ke.g=ei(Ke.j,null),Ke.g.ea(Ke.v)),Ke.F=Date.now(),ts(Ke)}Qa(we)}function vn(we){we.g&&(zn(we),we.g.cancel(),we.g=null)}function Wa(we){vn(we),we.u&&(H.clearTimeout(we.u),we.u=null),Rn(we),we.h.cancel(),we.s&&(typeof we.s=="number"&&H.clearTimeout(we.s),we.s=null)}function yn(we){if(!ys(we.h)&&!we.s){we.s=!0;var Ke=we.Ga;nt||Wt(),nr||(nt(),nr=!0),Je.add(Ke,we),we.B=0}}function ro(we,Ke){return Ns(we.h)>=we.h.j-(we.s?1:0)?!1:we.s?(we.i=Ke.D.concat(we.i),!0):we.G==1||we.G==2||we.B>=(we.Va?0:we.Wa)?!1:(we.s=Mr(me(we.Ga,we,Ke),Ja(we,we.B)),we.B++,!0)}E.Ga=function(we){if(this.s)if(this.s=null,this.G==1){if(!we){this.U=Math.floor(1e5*Math.random()),we=this.U++;const kr=new Nr(this,this.j,we);let Ur=this.o;if(this.S&&(Ur?(Ur=ke(Ur),Ge(Ur,this.S)):Ur=this.S),this.m!==null||this.O||(kr.H=Ur,Ur=null),this.P)e:{for(var Ke=0,tt=0;tt<this.i.length;tt++){t:{var Kt=this.i[tt];if("__data__"in Kt.map&&(Kt=Kt.map.__data__,typeof Kt=="string")){Kt=Kt.length;break t}Kt=void 0}if(Kt===void 0)break;if(Ke+=Kt,4096<Ke){Ke=tt;break e}if(Ke===4096||tt===this.i.length-1){Ke=tt+1;break e}}Ke=1e3}else Ke=1e3;Ke=qa(this,kr,Ke),tt=Ts(this.I),hs(tt,"RID",we),hs(tt,"CVER",22),this.D&&hs(tt,"X-HTTP-Session-Id",this.D),Xs(this,tt),Ur&&(this.O?Ke="headers="+encodeURIComponent(String(Oa(Ur)))+"&"+Ke:this.m&&Bn(tt,this.m,Ur)),Vn(this.h,kr),this.Ua&&hs(tt,"TYPE","init"),this.P?(hs(tt,"$req",Ke),hs(tt,"SID","null"),kr.T=!0,Hr(kr,tt,null)):Hr(kr,tt,Ke),this.G=2}}else this.G==3&&(we?Ga(this,we):this.i.length==0||ys(this.h)||Ga(this))};function Ga(we,Ke){var tt;Ke?tt=Ke.l:tt=we.U++;const Kt=Ts(we.I);hs(Kt,"SID",we.K),hs(Kt,"RID",tt),hs(Kt,"AID",we.T),Xs(we,Kt),we.m&&we.o&&Bn(Kt,we.m,we.o),tt=new Nr(we,we.j,tt,we.B+1),we.m===null&&(tt.H=we.o),Ke&&(we.i=Ke.D.concat(we.i)),Ke=qa(we,tt,1e3),tt.I=Math.round(.5*we.wa)+Math.round(.5*we.wa*Math.random()),Vn(we.h,tt),Hr(tt,Kt,Ke)}function Xs(we,Ke){we.H&&Ue(we.H,function(tt,Kt){hs(Ke,Kt,tt)}),we.l&&ja({},function(tt,Kt){hs(Ke,Kt,tt)})}function qa(we,Ke,tt){tt=Math.min(we.i.length,tt);var Kt=we.l?me(we.l.Na,we.l,we):null;e:{var kr=we.i;let Ur=-1;for(;;){const es=["count="+tt];Ur==-1?0<tt?(Ur=kr[0].g,es.push("ofs="+Ur)):Ur=0:es.push("ofs="+Ur);let us=!0;for(let ps=0;ps<tt;ps++){let is=kr[ps].g;const ms=kr[ps].map;if(is-=Ur,0>is)Ur=Math.max(0,kr[ps].g-100),us=!1;else try{Qi(ms,es,"req"+is+"_")}catch{Kt&&Kt(ms)}}if(us){Kt=es.join("&");break e}}}return we=we.i.splice(0,tt),Ke.D=we,Kt}function Xa(we){if(!we.g&&!we.u){we.Y=1;var Ke=we.Fa;nt||Wt(),nr||(nt(),nr=!0),Je.add(Ke,we),we.v=0}}function $n(we){return we.g||we.u||3<=we.v?!1:(we.Y++,we.u=Mr(me(we.Fa,we),Ja(we,we.v)),we.v++,!0)}E.Fa=function(){if(this.u=null,Ka(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var we=2*this.R;this.j.info("BP detection timer enabled: "+we),this.A=Mr(me(this.ab,this),we)}},E.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,_r(10),vn(this),Ka(this))};function zn(we){we.A!=null&&(H.clearTimeout(we.A),we.A=null)}function Ka(we){we.g=new Nr(we,we.j,"rpc",we.Y),we.m===null&&(we.g.H=we.o),we.g.O=0;var Ke=Ts(we.qa);hs(Ke,"RID","rpc"),hs(Ke,"SID",we.K),hs(Ke,"AID",we.T),hs(Ke,"CI",we.F?"0":"1"),!we.F&&we.ja&&hs(Ke,"TO",we.ja),hs(Ke,"TYPE","xmlhttp"),Xs(we,Ke),we.m&&we.o&&Bn(Ke,we.m,we.o),we.L&&(we.g.I=we.L);var tt=we.g;we=we.ia,tt.L=1,tt.v=mn(Ts(Ke)),tt.m=null,tt.P=!0,Kr(tt,we)}E.Za=function(){this.C!=null&&(this.C=null,vn(this),$n(this),_r(19))};function Rn(we){we.C!=null&&(H.clearTimeout(we.C),we.C=null)}function Ya(we,Ke){var tt=null;if(we.g==Ke){Rn(we),zn(we),we.g=null;var Kt=2}else if(_s(we.h,Ke))tt=Ke.D,Ca(we.h,Ke),Kt=1;else return;if(we.G!=0){if(Ke.o)if(Kt==1){tt=Ke.m?Ke.m.length:0,Ke=Date.now()-Ke.F;var kr=we.B;Kt=Wr(),br(Kt,new jr(Kt,tt)),yn(we)}else Xa(we);else if(kr=Ke.s,kr==3||kr==0&&0<Ke.X||!(Kt==1&&ro(we,Ke)||Kt==2&&$n(we)))switch(tt&&0<tt.length&&(Ke=we.h,Ke.i=Ke.i.concat(tt)),kr){case 1:Is(we,5);break;case 4:Is(we,10);break;case 3:Is(we,6);break;default:Is(we,2)}}}function Ja(we,Ke){let tt=we.Ta+Math.floor(Math.random()*we.cb);return we.isActive()||(tt*=2),tt*Ke}function Is(we,Ke){if(we.j.info("Error code "+Ke),Ke==2){var tt=me(we.fb,we),Kt=we.Xa;const kr=!Kt;Kt=new js(Kt||"//www.google.com/images/cleardot.gif"),H.location&&H.location.protocol=="http"||fn(Kt,"https"),mn(Kt),kr?Ki(Kt.toString(),tt):Yi(Kt.toString(),tt)}else _r(2);we.G=0,we.l&&we.l.sa(Ke),Qa(we),Wa(we)}E.fb=function(we){we?(this.j.info("Successfully pinged google.com"),_r(2)):(this.j.info("Failed to ping google.com"),_r(1))};function Qa(we){if(we.G=0,we.ka=[],we.l){const Ke=Pa(we.h);(Ke.length!=0||we.i.length!=0)&&(Ce(we.ka,Ke),Ce(we.ka,we.i),we.h.i.length=0,Pe(we.i),we.i.length=0),we.l.ra()}}function Za(we,Ke,tt){var Kt=tt instanceof js?Ts(tt):new js(tt);if(Kt.g!="")Ke&&(Kt.g=Ke+"."+Kt.g),pn(Kt,Kt.s);else{var kr=H.location;Kt=kr.protocol,Ke=Ke?Ke+"."+kr.hostname:kr.hostname,kr=+kr.port;var Ur=new js(null);Kt&&fn(Ur,Kt),Ke&&(Ur.g=Ke),kr&&pn(Ur,kr),tt&&(Ur.l=tt),Kt=Ur}return tt=we.D,Ke=we.ya,tt&&Ke&&hs(Kt,tt,Ke),hs(Kt,"VER",we.la),Xs(we,Kt),Kt}function ei(we,Ke,tt){if(Ke&&!we.J)throw Error("Can't create secondary domain capable XhrIo object.");return Ke=we.Ca&&!we.pa?new fs(new gn({eb:tt})):new fs(we.pa),Ke.Ha(we.J),Ke}E.isActive=function(){return!!this.l&&this.l.isActive(this)};function ti(){}E=ti.prototype,E.ua=function(){},E.ta=function(){},E.sa=function(){},E.ra=function(){},E.isActive=function(){return!0},E.Na=function(){};function Tn(){}Tn.prototype.g=function(we,Ke){return new xs(we,Ke)};function xs(we,Ke){dr.call(this),this.g=new Ha(Ke),this.l=we,this.h=Ke&&Ke.messageUrlParams||null,we=Ke&&Ke.messageHeaders||null,Ke&&Ke.clientProtocolHeaderRequired&&(we?we["X-Client-Protocol"]="webchannel":we={"X-Client-Protocol":"webchannel"}),this.g.o=we,we=Ke&&Ke.initMessageHeaders||null,Ke&&Ke.messageContentType&&(we?we["X-WebChannel-Content-Type"]=Ke.messageContentType:we={"X-WebChannel-Content-Type":Ke.messageContentType}),Ke&&Ke.va&&(we?we["X-WebChannel-Client-Profile"]=Ke.va:we={"X-WebChannel-Client-Profile":Ke.va}),this.g.S=we,(we=Ke&&Ke.Sb)&&!Me(we)&&(this.g.m=we),this.v=Ke&&Ke.supportsCrossDomainXhr||!1,this.u=Ke&&Ke.sendRawJson||!1,(Ke=Ke&&Ke.httpSessionIdParam)&&!Me(Ke)&&(this.g.D=Ke,we=this.h,we!==null&&Ke in we&&(we=this.h,Ke in we&&delete we[Ke])),this.j=new Fs(this)}Re(xs,dr),xs.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},xs.prototype.close=function(){Un(this.g)},xs.prototype.o=function(we){var Ke=this.g;if(typeof we=="string"){var tt={};tt.__data__=we,we=tt}else this.u&&(tt={},tt.__data__=Rr(we),we=tt);Ke.i.push(new Ps(Ke.Ya++,we)),Ke.G==3&&yn(Ke)},xs.prototype.N=function(){this.g.l=null,delete this.j,Un(this.g),delete this.g,xs.aa.N.call(this)};function ri(we){Sr.call(this),we.__headers__&&(this.headers=we.__headers__,this.statusCode=we.__status__,delete we.__headers__,delete we.__status__);var Ke=we.__sm__;if(Ke){e:{for(const tt in Ke){we=tt;break e}we=void 0}(this.i=we)&&(we=this.i,Ke=Ke!==null&&we in Ke?Ke[we]:void 0),this.data=Ke}else this.data=we}Re(ri,Sr);function si(){zr.call(this),this.status=1}Re(si,zr);function Fs(we){this.g=we}Re(Fs,ti),Fs.prototype.ua=function(){br(this.g,"a")},Fs.prototype.ta=function(we){br(this.g,new ri(we))},Fs.prototype.sa=function(we){br(this.g,new si)},Fs.prototype.ra=function(){br(this.g,"b")},Tn.prototype.createWebChannel=Tn.prototype.g,xs.prototype.send=xs.prototype.o,xs.prototype.open=xs.prototype.m,xs.prototype.close=xs.prototype.close,createWebChannelTransport=function(){return new Tn},getStatEventTarget=function(){return Wr()},Event$1=Gr,Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Nt.NO_ERROR=0,Nt.TIMEOUT=8,Nt.HTTP_ERROR=6,ErrorCode=Nt,qt.COMPLETE="complete",EventType=qt,ss.EventType=ar,ar.OPEN="a",ar.CLOSE="b",ar.ERROR="c",ar.MESSAGE="d",dr.prototype.listen=dr.prototype.K,WebChannel=ss,fs.prototype.listenOnce=fs.prototype.L,fs.prototype.getLastError=fs.prototype.Ka,fs.prototype.getLastErrorCode=fs.prototype.Ba,fs.prototype.getStatus=fs.prototype.Z,fs.prototype.getResponseJson=fs.prototype.Oa,fs.prototype.getResponseText=fs.prototype.oa,fs.prototype.send=fs.prototype.ea,fs.prototype.setWithCredentials=fs.prototype.Ha,XhrIo=fs}).apply(typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{});const F="@firebase/firestore",M="4.7.16";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class User{constructor(r){this.uid=r}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(r){return r.uid===this.uid}}User.UNAUTHENTICATED=new User(null),User.GOOGLE_CREDENTIALS=new User("google-credentials-uid"),User.FIRST_PARTY=new User("first-party-uid"),User.MOCK_USER=new User("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let x="11.8.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const O=new Logger("@firebase/firestore");function __PRIVATE_getLogLevel(){return O.logLevel}function __PRIVATE_logDebug(E,...r){if(O.logLevel<=LogLevel.DEBUG){const v=r.map(__PRIVATE_argToString);O.debug(`Firestore (${x}): ${E}`,...v)}}function __PRIVATE_logError(E,...r){if(O.logLevel<=LogLevel.ERROR){const v=r.map(__PRIVATE_argToString);O.error(`Firestore (${x}): ${E}`,...v)}}function __PRIVATE_logWarn(E,...r){if(O.logLevel<=LogLevel.WARN){const v=r.map(__PRIVATE_argToString);O.warn(`Firestore (${x}): ${E}`,...v)}}function __PRIVATE_argToString(E){if(typeof E=="string")return E;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(v){return JSON.stringify(v)}(E)}catch{return E}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fail(E,r,v){let T="Unexpected state";typeof r=="string"?T=r:v=r,__PRIVATE__fail(E,T,v)}function __PRIVATE__fail(E,r,v){let T=`FIRESTORE (${x}) INTERNAL ASSERTION FAILED: ${r} (ID: ${E.toString(16)})`;if(v!==void 0)try{T+=" CONTEXT: "+JSON.stringify(v)}catch{T+=" CONTEXT: "+v}throw __PRIVATE_logError(T),new Error(T)}function __PRIVATE_hardAssert(E,r,v,T){let w="Unexpected state";typeof v=="string"?w=v:T=v,E||__PRIVATE__fail(r,w,T)}function __PRIVATE_debugCast(E,r){return E}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class FirestoreError extends FirebaseError{constructor(r,v){super(r,v),this.code=r,this.message=v,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_Deferred{constructor(){this.promise=new Promise((r,v)=>{this.resolve=r,this.reject=v})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_OAuthToken{constructor(r,v){this.user=v,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${r}`)}}class __PRIVATE_EmptyAuthCredentialsProvider{getToken(){return Promise.resolve(null)}invalidateToken(){}start(r,v){r.enqueueRetryable(()=>v(User.UNAUTHENTICATED))}shutdown(){}}class __PRIVATE_EmulatorAuthCredentialsProvider{constructor(r){this.token=r,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(r,v){this.changeListener=v,r.enqueueRetryable(()=>v(this.token.user))}shutdown(){this.changeListener=null}}class __PRIVATE_FirebaseAuthCredentialsProvider{constructor(r){this.t=r,this.currentUser=User.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(r,v){__PRIVATE_hardAssert(this.o===void 0,42304);let T=this.i;const w=te=>this.i!==T?(T=this.i,v(te)):Promise.resolve();let S=new __PRIVATE_Deferred;this.o=()=>{this.i++,this.currentUser=this.u(),S.resolve(),S=new __PRIVATE_Deferred,r.enqueueRetryable(()=>w(this.currentUser))};const I=()=>{const te=S;r.enqueueRetryable(async()=>{await te.promise,await w(this.currentUser)})},H=te=>{__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=te,this.o&&(this.auth.addAuthTokenListener(this.o),I())};this.t.onInit(te=>H(te)),setTimeout(()=>{if(!this.auth){const te=this.t.getImmediate({optional:!0});te?H(te):(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","Auth not yet detected"),S.resolve(),S=new __PRIVATE_Deferred)}},0),I()}getToken(){const r=this.i,v=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(v).then(T=>this.i!==r?(__PRIVATE_logDebug("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):T?(__PRIVATE_hardAssert(typeof T.accessToken=="string",31837,{l:T}),new __PRIVATE_OAuthToken(T.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const r=this.auth&&this.auth.getUid();return __PRIVATE_hardAssert(r===null||typeof r=="string",2055,{h:r}),new User(r)}}class __PRIVATE_FirstPartyToken{constructor(r,v,T){this.P=r,this.T=v,this.I=T,this.type="FirstParty",this.user=User.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const r=this.R();return r&&this.A.set("Authorization",r),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class __PRIVATE_FirstPartyAuthCredentialsProvider{constructor(r,v,T){this.P=r,this.T=v,this.I=T}getToken(){return Promise.resolve(new __PRIVATE_FirstPartyToken(this.P,this.T,this.I))}start(r,v){r.enqueueRetryable(()=>v(User.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class AppCheckToken{constructor(r){this.value=r,this.type="AppCheck",this.headers=new Map,r&&r.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class __PRIVATE_FirebaseAppCheckTokenProvider{constructor(r,v){this.V=v,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,_isFirebaseServerApp(r)&&r.settings.appCheckToken&&(this.p=r.settings.appCheckToken)}start(r,v){__PRIVATE_hardAssert(this.o===void 0,3512);const T=S=>{S.error!=null&&__PRIVATE_logDebug("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${S.error.message}`);const I=S.token!==this.m;return this.m=S.token,__PRIVATE_logDebug("FirebaseAppCheckTokenProvider",`Received ${I?"new":"existing"} token.`),I?v(S.token):Promise.resolve()};this.o=S=>{r.enqueueRetryable(()=>T(S))};const w=S=>{__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=S,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(S=>w(S)),setTimeout(()=>{if(!this.appCheck){const S=this.V.getImmediate({optional:!0});S?w(S):__PRIVATE_logDebug("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new AppCheckToken(this.p));const r=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(r).then(v=>v?(__PRIVATE_hardAssert(typeof v.token=="string",44558,{tokenResult:v}),this.m=v.token,new AppCheckToken(v.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_randomBytes(E){const r=typeof self<"u"&&(self.crypto||self.msCrypto),v=new Uint8Array(E);if(r&&typeof r.getRandomValues=="function")r.getRandomValues(v);else for(let T=0;T<E;T++)v[T]=Math.floor(256*Math.random());return v}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_newTextEncoder(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_AutoId{static newId(){const r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",v=62*Math.floor(4.129032258064516);let T="";for(;T.length<20;){const w=__PRIVATE_randomBytes(40);for(let S=0;S<w.length;++S)T.length<20&&w[S]<v&&(T+=r.charAt(w[S]%62))}return T}}function __PRIVATE_primitiveComparator(E,r){return E<r?-1:E>r?1:0}function __PRIVATE_compareUtf8Strings(E,r){let v=0;for(;v<E.length&&v<r.length;){const T=E.codePointAt(v),w=r.codePointAt(v);if(T!==w){if(T<128&&w<128)return __PRIVATE_primitiveComparator(T,w);{const S=__PRIVATE_newTextEncoder(),I=__PRIVATE_compareByteArrays$1(S.encode(__PRIVATE_getUtf8SafeSubstring(E,v)),S.encode(__PRIVATE_getUtf8SafeSubstring(r,v)));return I!==0?I:__PRIVATE_primitiveComparator(T,w)}}v+=T>65535?2:1}return __PRIVATE_primitiveComparator(E.length,r.length)}function __PRIVATE_getUtf8SafeSubstring(E,r){return E.codePointAt(r)>65535?E.substring(r,r+2):E.substring(r,r+1)}function __PRIVATE_compareByteArrays$1(E,r){for(let v=0;v<E.length&&v<r.length;++v)if(E[v]!==r[v])return __PRIVATE_primitiveComparator(E[v],r[v]);return __PRIVATE_primitiveComparator(E.length,r.length)}function __PRIVATE_arrayEquals(E,r,v){return E.length===r.length&&E.every((T,w)=>v(T,r[w]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B=-62135596800,L=1e6;class Timestamp{static now(){return Timestamp.fromMillis(Date.now())}static fromDate(r){return Timestamp.fromMillis(r.getTime())}static fromMillis(r){const v=Math.floor(r/1e3),T=Math.floor((r-1e3*v)*L);return new Timestamp(v,T)}constructor(r,v){if(this.seconds=r,this.nanoseconds=v,v<0)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+v);if(v>=1e9)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+v);if(r<B)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+r);if(r>=253402300800)throw new FirestoreError(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/L}_compareTo(r){return this.seconds===r.seconds?__PRIVATE_primitiveComparator(this.nanoseconds,r.nanoseconds):__PRIVATE_primitiveComparator(this.seconds,r.seconds)}isEqual(r){return r.seconds===this.seconds&&r.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const r=this.seconds-B;return String(r).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SnapshotVersion{static fromTimestamp(r){return new SnapshotVersion(r)}static min(){return new SnapshotVersion(new Timestamp(0,0))}static max(){return new SnapshotVersion(new Timestamp(253402300799,999999999))}constructor(r){this.timestamp=r}compareTo(r){return this.timestamp._compareTo(r.timestamp)}isEqual(r){return this.timestamp.isEqual(r.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k="__name__";class BasePath{constructor(r,v,T){v===void 0?v=0:v>r.length&&fail(637,{offset:v,range:r.length}),T===void 0?T=r.length-v:T>r.length-v&&fail(1746,{length:T,range:r.length-v}),this.segments=r,this.offset=v,this.len=T}get length(){return this.len}isEqual(r){return BasePath.comparator(this,r)===0}child(r){const v=this.segments.slice(this.offset,this.limit());return r instanceof BasePath?r.forEach(T=>{v.push(T)}):v.push(r),this.construct(v)}limit(){return this.offset+this.length}popFirst(r){return r=r===void 0?1:r,this.construct(this.segments,this.offset+r,this.length-r)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(r){return this.segments[this.offset+r]}isEmpty(){return this.length===0}isPrefixOf(r){if(r.length<this.length)return!1;for(let v=0;v<this.length;v++)if(this.get(v)!==r.get(v))return!1;return!0}isImmediateParentOf(r){if(this.length+1!==r.length)return!1;for(let v=0;v<this.length;v++)if(this.get(v)!==r.get(v))return!1;return!0}forEach(r){for(let v=this.offset,T=this.limit();v<T;v++)r(this.segments[v])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(r,v){const T=Math.min(r.length,v.length);for(let w=0;w<T;w++){const S=BasePath.compareSegments(r.get(w),v.get(w));if(S!==0)return S}return __PRIVATE_primitiveComparator(r.length,v.length)}static compareSegments(r,v){const T=BasePath.isNumericId(r),w=BasePath.isNumericId(v);return T&&!w?-1:!T&&w?1:T&&w?BasePath.extractNumericId(r).compare(BasePath.extractNumericId(v)):__PRIVATE_compareUtf8Strings(r,v)}static isNumericId(r){return r.startsWith("__id")&&r.endsWith("__")}static extractNumericId(r){return Integer.fromString(r.substring(4,r.length-2))}}class ResourcePath extends BasePath{construct(r,v,T){return new ResourcePath(r,v,T)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...r){const v=[];for(const T of r){if(T.indexOf("//")>=0)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid segment (${T}). Paths must not contain // in them.`);v.push(...T.split("/").filter(w=>w.length>0))}return new ResourcePath(v)}static emptyPath(){return new ResourcePath([])}}const q=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class FieldPath$1 extends BasePath{construct(r,v,T){return new FieldPath$1(r,v,T)}static isValidIdentifier(r){return q.test(r)}canonicalString(){return this.toArray().map(r=>(r=r.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),FieldPath$1.isValidIdentifier(r)||(r="`"+r+"`"),r)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===k}static keyField(){return new FieldPath$1([k])}static fromServerFormat(r){const v=[];let T="",w=0;const S=()=>{if(T.length===0)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid field path (${r}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);v.push(T),T=""};let I=!1;for(;w<r.length;){const H=r[w];if(H==="\\"){if(w+1===r.length)throw new FirestoreError(N.INVALID_ARGUMENT,"Path has trailing escape character: "+r);const te=r[w+1];if(te!=="\\"&&te!=="."&&te!=="`")throw new FirestoreError(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+r);T+=te,w+=2}else H==="`"?(I=!I,w++):H!=="."||I?(T+=H,w++):(S(),w++)}if(S(),I)throw new FirestoreError(N.INVALID_ARGUMENT,"Unterminated ` in path: "+r);return new FieldPath$1(v)}static emptyPath(){return new FieldPath$1([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DocumentKey{constructor(r){this.path=r}static fromPath(r){return new DocumentKey(ResourcePath.fromString(r))}static fromName(r){return new DocumentKey(ResourcePath.fromString(r).popFirst(5))}static empty(){return new DocumentKey(ResourcePath.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(r){return this.path.length>=2&&this.path.get(this.path.length-2)===r}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(r){return r!==null&&ResourcePath.comparator(this.path,r.path)===0}toString(){return this.path.toString()}static comparator(r,v){return ResourcePath.comparator(r.path,v.path)}static isDocumentKey(r){return r.length%2==0}static fromSegments(r){return new DocumentKey(new ResourcePath(r.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Q=-1;function __PRIVATE_newIndexOffsetSuccessorFromReadTime(E,r){const v=E.toTimestamp().seconds,T=E.toTimestamp().nanoseconds+1,w=SnapshotVersion.fromTimestamp(T===1e9?new Timestamp(v+1,0):new Timestamp(v,T));return new IndexOffset(w,DocumentKey.empty(),r)}function __PRIVATE_newIndexOffsetFromDocument(E){return new IndexOffset(E.readTime,E.key,Q)}class IndexOffset{constructor(r,v,T){this.readTime=r,this.documentKey=v,this.largestBatchId=T}static min(){return new IndexOffset(SnapshotVersion.min(),DocumentKey.empty(),Q)}static max(){return new IndexOffset(SnapshotVersion.max(),DocumentKey.empty(),Q)}}function __PRIVATE_indexOffsetComparator(E,r){let v=E.readTime.compareTo(r.readTime);return v!==0?v:(v=DocumentKey.comparator(E.documentKey,r.documentKey),v!==0?v:__PRIVATE_primitiveComparator(E.largestBatchId,r.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $$1="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class PersistenceTransaction{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(r){this.onCommittedListeners.push(r)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(r=>r())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function __PRIVATE_ignoreIfPrimaryLeaseLoss(E){if(E.code!==N.FAILED_PRECONDITION||E.message!==$$1)throw E;__PRIVATE_logDebug("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PersistencePromise{constructor(r){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,r(v=>{this.isDone=!0,this.result=v,this.nextCallback&&this.nextCallback(v)},v=>{this.isDone=!0,this.error=v,this.catchCallback&&this.catchCallback(v)})}catch(r){return this.next(void 0,r)}next(r,v){return this.callbackAttached&&fail(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(v,this.error):this.wrapSuccess(r,this.result):new PersistencePromise((T,w)=>{this.nextCallback=S=>{this.wrapSuccess(r,S).next(T,w)},this.catchCallback=S=>{this.wrapFailure(v,S).next(T,w)}})}toPromise(){return new Promise((r,v)=>{this.next(r,v)})}wrapUserFunction(r){try{const v=r();return v instanceof PersistencePromise?v:PersistencePromise.resolve(v)}catch(v){return PersistencePromise.reject(v)}}wrapSuccess(r,v){return r?this.wrapUserFunction(()=>r(v)):PersistencePromise.resolve(v)}wrapFailure(r,v){return r?this.wrapUserFunction(()=>r(v)):PersistencePromise.reject(v)}static resolve(r){return new PersistencePromise((v,T)=>{v(r)})}static reject(r){return new PersistencePromise((v,T)=>{T(r)})}static waitFor(r){return new PersistencePromise((v,T)=>{let w=0,S=0,I=!1;r.forEach(H=>{++w,H.next(()=>{++S,I&&S===w&&v()},te=>T(te))}),I=!0,S===w&&v()})}static or(r){let v=PersistencePromise.resolve(!1);for(const T of r)v=v.next(w=>w?PersistencePromise.resolve(w):T());return v}static forEach(r,v){const T=[];return r.forEach((w,S)=>{T.push(v.call(this,w,S))}),this.waitFor(T)}static mapArray(r,v){return new PersistencePromise((T,w)=>{const S=r.length,I=new Array(S);let H=0;for(let te=0;te<S;te++){const ae=te;v(r[ae]).next(ie=>{I[ae]=ie,++H,H===S&&T(I)},ie=>w(ie))}})}static doWhile(r,v){return new PersistencePromise((T,w)=>{const S=()=>{r()===!0?v().next(()=>{S()},w):T()};S()})}}function __PRIVATE_getAndroidVersion(E){const r=E.match(/Android ([\d.]+)/i),v=r?r[1].split(".").slice(0,2).join("."):"-1";return Number(v)}function __PRIVATE_isIndexedDbTransactionError(E){return E.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_ListenSequence{constructor(r,v){this.previousValue=r,v&&(v.sequenceNumberHandler=T=>this.ue(T),this.ce=T=>v.writeSequenceNumber(T))}ue(r){return this.previousValue=Math.max(r,this.previousValue),this.previousValue}next(){const r=++this.previousValue;return this.ce&&this.ce(r),r}}__PRIVATE_ListenSequence.le=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G=-1;function __PRIVATE_isNullOrUndefined(E){return E==null}function __PRIVATE_isNegativeZero(E){return E===0&&1/E==-1/0}function isSafeInteger(E){return typeof E=="number"&&Number.isInteger(E)&&!__PRIVATE_isNegativeZero(E)&&E<=Number.MAX_SAFE_INTEGER&&E>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z="";function __PRIVATE_encodeResourcePath(E){let r="";for(let v=0;v<E.length;v++)r.length>0&&(r=__PRIVATE_encodeSeparator(r)),r=__PRIVATE_encodeSegment(E.get(v),r);return __PRIVATE_encodeSeparator(r)}function __PRIVATE_encodeSegment(E,r){let v=r;const T=E.length;for(let w=0;w<T;w++){const S=E.charAt(w);switch(S){case"\0":v+="";break;case z:v+="";break;default:v+=S}}return v}function __PRIVATE_encodeSeparator(E){return E+z+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_objectSize(E){let r=0;for(const v in E)Object.prototype.hasOwnProperty.call(E,v)&&r++;return r}function forEach(E,r){for(const v in E)Object.prototype.hasOwnProperty.call(E,v)&&r(v,E[v])}function isEmpty(E){for(const r in E)if(Object.prototype.hasOwnProperty.call(E,r))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SortedMap{constructor(r,v){this.comparator=r,this.root=v||LLRBNode.EMPTY}insert(r,v){return new SortedMap(this.comparator,this.root.insert(r,v,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}remove(r){return new SortedMap(this.comparator,this.root.remove(r,this.comparator).copy(null,null,LLRBNode.BLACK,null,null))}get(r){let v=this.root;for(;!v.isEmpty();){const T=this.comparator(r,v.key);if(T===0)return v.value;T<0?v=v.left:T>0&&(v=v.right)}return null}indexOf(r){let v=0,T=this.root;for(;!T.isEmpty();){const w=this.comparator(r,T.key);if(w===0)return v+T.left.size;w<0?T=T.left:(v+=T.left.size+1,T=T.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(r){return this.root.inorderTraversal(r)}forEach(r){this.inorderTraversal((v,T)=>(r(v,T),!1))}toString(){const r=[];return this.inorderTraversal((v,T)=>(r.push(`${v}:${T}`),!1)),`{${r.join(", ")}}`}reverseTraversal(r){return this.root.reverseTraversal(r)}getIterator(){return new SortedMapIterator(this.root,null,this.comparator,!1)}getIteratorFrom(r){return new SortedMapIterator(this.root,r,this.comparator,!1)}getReverseIterator(){return new SortedMapIterator(this.root,null,this.comparator,!0)}getReverseIteratorFrom(r){return new SortedMapIterator(this.root,r,this.comparator,!0)}}class SortedMapIterator{constructor(r,v,T,w){this.isReverse=w,this.nodeStack=[];let S=1;for(;!r.isEmpty();)if(S=v?T(r.key,v):1,v&&w&&(S*=-1),S<0)r=this.isReverse?r.left:r.right;else{if(S===0){this.nodeStack.push(r);break}this.nodeStack.push(r),r=this.isReverse?r.right:r.left}}getNext(){let r=this.nodeStack.pop();const v={key:r.key,value:r.value};if(this.isReverse)for(r=r.left;!r.isEmpty();)this.nodeStack.push(r),r=r.right;else for(r=r.right;!r.isEmpty();)this.nodeStack.push(r),r=r.left;return v}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const r=this.nodeStack[this.nodeStack.length-1];return{key:r.key,value:r.value}}}class LLRBNode{constructor(r,v,T,w,S){this.key=r,this.value=v,this.color=T??LLRBNode.RED,this.left=w??LLRBNode.EMPTY,this.right=S??LLRBNode.EMPTY,this.size=this.left.size+1+this.right.size}copy(r,v,T,w,S){return new LLRBNode(r??this.key,v??this.value,T??this.color,w??this.left,S??this.right)}isEmpty(){return!1}inorderTraversal(r){return this.left.inorderTraversal(r)||r(this.key,this.value)||this.right.inorderTraversal(r)}reverseTraversal(r){return this.right.reverseTraversal(r)||r(this.key,this.value)||this.left.reverseTraversal(r)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(r,v,T){let w=this;const S=T(r,w.key);return w=S<0?w.copy(null,null,null,w.left.insert(r,v,T),null):S===0?w.copy(null,v,null,null,null):w.copy(null,null,null,null,w.right.insert(r,v,T)),w.fixUp()}removeMin(){if(this.left.isEmpty())return LLRBNode.EMPTY;let r=this;return r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.removeMin(),null),r.fixUp()}remove(r,v){let T,w=this;if(v(r,w.key)<0)w.left.isEmpty()||w.left.isRed()||w.left.left.isRed()||(w=w.moveRedLeft()),w=w.copy(null,null,null,w.left.remove(r,v),null);else{if(w.left.isRed()&&(w=w.rotateRight()),w.right.isEmpty()||w.right.isRed()||w.right.left.isRed()||(w=w.moveRedRight()),v(r,w.key)===0){if(w.right.isEmpty())return LLRBNode.EMPTY;T=w.right.min(),w=w.copy(T.key,T.value,null,null,w.right.removeMin())}w=w.copy(null,null,null,null,w.right.remove(r,v))}return w.fixUp()}isRed(){return this.color}fixUp(){let r=this;return r.right.isRed()&&!r.left.isRed()&&(r=r.rotateLeft()),r.left.isRed()&&r.left.left.isRed()&&(r=r.rotateRight()),r.left.isRed()&&r.right.isRed()&&(r=r.colorFlip()),r}moveRedLeft(){let r=this.colorFlip();return r.right.left.isRed()&&(r=r.copy(null,null,null,null,r.right.rotateRight()),r=r.rotateLeft(),r=r.colorFlip()),r}moveRedRight(){let r=this.colorFlip();return r.left.left.isRed()&&(r=r.rotateRight(),r=r.colorFlip()),r}rotateLeft(){const r=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,r,null)}rotateRight(){const r=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,r)}colorFlip(){const r=this.left.copy(null,null,!this.left.color,null,null),v=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,r,v)}checkMaxDepth(){const r=this.check();return Math.pow(2,r)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw fail(43730,{key:this.key,value:this.value});if(this.right.isRed())throw fail(14113,{key:this.key,value:this.value});const r=this.left.check();if(r!==this.right.check())throw fail(27949);return r+(this.isRed()?0:1)}}LLRBNode.EMPTY=null,LLRBNode.RED=!0,LLRBNode.BLACK=!1;LLRBNode.EMPTY=new class{constructor(){this.size=0}get key(){throw fail(57766)}get value(){throw fail(16141)}get color(){throw fail(16727)}get left(){throw fail(29726)}get right(){throw fail(36894)}copy(r,v,T,w,S){return this}insert(r,v,T){return new LLRBNode(r,v)}remove(r,v){return this}isEmpty(){return!0}inorderTraversal(r){return!1}reverseTraversal(r){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SortedSet{constructor(r){this.comparator=r,this.data=new SortedMap(this.comparator)}has(r){return this.data.get(r)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(r){return this.data.indexOf(r)}forEach(r){this.data.inorderTraversal((v,T)=>(r(v),!1))}forEachInRange(r,v){const T=this.data.getIteratorFrom(r[0]);for(;T.hasNext();){const w=T.getNext();if(this.comparator(w.key,r[1])>=0)return;v(w.key)}}forEachWhile(r,v){let T;for(T=v!==void 0?this.data.getIteratorFrom(v):this.data.getIterator();T.hasNext();)if(!r(T.getNext().key))return}firstAfterOrEqual(r){const v=this.data.getIteratorFrom(r);return v.hasNext()?v.getNext().key:null}getIterator(){return new SortedSetIterator(this.data.getIterator())}getIteratorFrom(r){return new SortedSetIterator(this.data.getIteratorFrom(r))}add(r){return this.copy(this.data.remove(r).insert(r,!0))}delete(r){return this.has(r)?this.copy(this.data.remove(r)):this}isEmpty(){return this.data.isEmpty()}unionWith(r){let v=this;return v.size<r.size&&(v=r,r=this),r.forEach(T=>{v=v.add(T)}),v}isEqual(r){if(!(r instanceof SortedSet)||this.size!==r.size)return!1;const v=this.data.getIterator(),T=r.data.getIterator();for(;v.hasNext();){const w=v.getNext().key,S=T.getNext().key;if(this.comparator(w,S)!==0)return!1}return!0}toArray(){const r=[];return this.forEach(v=>{r.push(v)}),r}toString(){const r=[];return this.forEach(v=>r.push(v)),"SortedSet("+r.toString()+")"}copy(r){const v=new SortedSet(this.comparator);return v.data=r,v}}class SortedSetIterator{constructor(r){this.iter=r}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FieldMask{constructor(r){this.fields=r,r.sort(FieldPath$1.comparator)}static empty(){return new FieldMask([])}unionWith(r){let v=new SortedSet(FieldPath$1.comparator);for(const T of this.fields)v=v.add(T);for(const T of r)v=v.add(T);return new FieldMask(v.toArray())}covers(r){for(const v of this.fields)if(v.isPrefixOf(r))return!0;return!1}isEqual(r){return __PRIVATE_arrayEquals(this.fields,r.fields,(v,T)=>v.isEqual(T))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_Base64DecodeError extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ByteString{constructor(r){this.binaryString=r}static fromBase64String(r){const v=function(w){try{return atob(w)}catch(S){throw typeof DOMException<"u"&&S instanceof DOMException?new __PRIVATE_Base64DecodeError("Invalid base64 string: "+S):S}}(r);return new ByteString(v)}static fromUint8Array(r){const v=function(w){let S="";for(let I=0;I<w.length;++I)S+=String.fromCharCode(w[I]);return S}(r);return new ByteString(v)}[Symbol.iterator](){let r=0;return{next:()=>r<this.binaryString.length?{value:this.binaryString.charCodeAt(r++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(v){return btoa(v)}(this.binaryString)}toUint8Array(){return function(v){const T=new Uint8Array(v.length);for(let w=0;w<v.length;w++)T[w]=v.charCodeAt(w);return T}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(r){return __PRIVATE_primitiveComparator(this.binaryString,r.binaryString)}isEqual(r){return this.binaryString===r.binaryString}}ByteString.EMPTY_BYTE_STRING=new ByteString("");const it=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function __PRIVATE_normalizeTimestamp(E){if(__PRIVATE_hardAssert(!!E,39018),typeof E=="string"){let r=0;const v=it.exec(E);if(__PRIVATE_hardAssert(!!v,46558,{timestamp:E}),v[1]){let w=v[1];w=(w+"000000000").substr(0,9),r=Number(w)}const T=new Date(E);return{seconds:Math.floor(T.getTime()/1e3),nanos:r}}return{seconds:__PRIVATE_normalizeNumber(E.seconds),nanos:__PRIVATE_normalizeNumber(E.nanos)}}function __PRIVATE_normalizeNumber(E){return typeof E=="number"?E:typeof E=="string"?Number(E):0}function __PRIVATE_normalizeByteString(E){return typeof E=="string"?ByteString.fromBase64String(E):ByteString.fromUint8Array(E)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const st="server_timestamp",ot="__type__",_t="__previous_value__",at="__local_write_time__";function __PRIVATE_isServerTimestamp(E){var r,v;return((v=(((r=E==null?void 0:E.mapValue)===null||r===void 0?void 0:r.fields)||{})[ot])===null||v===void 0?void 0:v.stringValue)===st}function __PRIVATE_getPreviousValue(E){const r=E.mapValue.fields[_t];return __PRIVATE_isServerTimestamp(r)?__PRIVATE_getPreviousValue(r):r}function __PRIVATE_getLocalWriteTime(E){const r=__PRIVATE_normalizeTimestamp(E.mapValue.fields[at].timestampValue);return new Timestamp(r.seconds,r.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DatabaseInfo{constructor(r,v,T,w,S,I,H,te,ae,ie){this.databaseId=r,this.appId=v,this.persistenceKey=T,this.host=w,this.ssl=S,this.forceLongPolling=I,this.autoDetectLongPolling=H,this.longPollingOptions=te,this.useFetchStreams=ae,this.isUsingEmulator=ie}}const ut="(default)";class DatabaseId{constructor(r,v){this.projectId=r,this.database=v||ut}static empty(){return new DatabaseId("","")}get isDefaultDatabase(){return this.database===ut}isEqual(r){return r instanceof DatabaseId&&r.projectId===this.projectId&&r.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ct="__type__",lt="__max__",ht={mapValue:{}},Pt="__vector__",Tt="value";function __PRIVATE_typeOrder(E){return"nullValue"in E?0:"booleanValue"in E?1:"integerValue"in E||"doubleValue"in E?2:"timestampValue"in E?3:"stringValue"in E?5:"bytesValue"in E?6:"referenceValue"in E?7:"geoPointValue"in E?8:"arrayValue"in E?9:"mapValue"in E?__PRIVATE_isServerTimestamp(E)?4:__PRIVATE_isMaxValue(E)?9007199254740991:__PRIVATE_isVectorValue(E)?10:11:fail(28295,{value:E})}function __PRIVATE_valueEquals(E,r){if(E===r)return!0;const v=__PRIVATE_typeOrder(E);if(v!==__PRIVATE_typeOrder(r))return!1;switch(v){case 0:case 9007199254740991:return!0;case 1:return E.booleanValue===r.booleanValue;case 4:return __PRIVATE_getLocalWriteTime(E).isEqual(__PRIVATE_getLocalWriteTime(r));case 3:return function(w,S){if(typeof w.timestampValue=="string"&&typeof S.timestampValue=="string"&&w.timestampValue.length===S.timestampValue.length)return w.timestampValue===S.timestampValue;const I=__PRIVATE_normalizeTimestamp(w.timestampValue),H=__PRIVATE_normalizeTimestamp(S.timestampValue);return I.seconds===H.seconds&&I.nanos===H.nanos}(E,r);case 5:return E.stringValue===r.stringValue;case 6:return function(w,S){return __PRIVATE_normalizeByteString(w.bytesValue).isEqual(__PRIVATE_normalizeByteString(S.bytesValue))}(E,r);case 7:return E.referenceValue===r.referenceValue;case 8:return function(w,S){return __PRIVATE_normalizeNumber(w.geoPointValue.latitude)===__PRIVATE_normalizeNumber(S.geoPointValue.latitude)&&__PRIVATE_normalizeNumber(w.geoPointValue.longitude)===__PRIVATE_normalizeNumber(S.geoPointValue.longitude)}(E,r);case 2:return function(w,S){if("integerValue"in w&&"integerValue"in S)return __PRIVATE_normalizeNumber(w.integerValue)===__PRIVATE_normalizeNumber(S.integerValue);if("doubleValue"in w&&"doubleValue"in S){const I=__PRIVATE_normalizeNumber(w.doubleValue),H=__PRIVATE_normalizeNumber(S.doubleValue);return I===H?__PRIVATE_isNegativeZero(I)===__PRIVATE_isNegativeZero(H):isNaN(I)&&isNaN(H)}return!1}(E,r);case 9:return __PRIVATE_arrayEquals(E.arrayValue.values||[],r.arrayValue.values||[],__PRIVATE_valueEquals);case 10:case 11:return function(w,S){const I=w.mapValue.fields||{},H=S.mapValue.fields||{};if(__PRIVATE_objectSize(I)!==__PRIVATE_objectSize(H))return!1;for(const te in I)if(I.hasOwnProperty(te)&&(H[te]===void 0||!__PRIVATE_valueEquals(I[te],H[te])))return!1;return!0}(E,r);default:return fail(52216,{left:E})}}function __PRIVATE_arrayValueContains(E,r){return(E.values||[]).find(v=>__PRIVATE_valueEquals(v,r))!==void 0}function __PRIVATE_valueCompare(E,r){if(E===r)return 0;const v=__PRIVATE_typeOrder(E),T=__PRIVATE_typeOrder(r);if(v!==T)return __PRIVATE_primitiveComparator(v,T);switch(v){case 0:case 9007199254740991:return 0;case 1:return __PRIVATE_primitiveComparator(E.booleanValue,r.booleanValue);case 2:return function(S,I){const H=__PRIVATE_normalizeNumber(S.integerValue||S.doubleValue),te=__PRIVATE_normalizeNumber(I.integerValue||I.doubleValue);return H<te?-1:H>te?1:H===te?0:isNaN(H)?isNaN(te)?0:-1:1}(E,r);case 3:return __PRIVATE_compareTimestamps(E.timestampValue,r.timestampValue);case 4:return __PRIVATE_compareTimestamps(__PRIVATE_getLocalWriteTime(E),__PRIVATE_getLocalWriteTime(r));case 5:return __PRIVATE_compareUtf8Strings(E.stringValue,r.stringValue);case 6:return function(S,I){const H=__PRIVATE_normalizeByteString(S),te=__PRIVATE_normalizeByteString(I);return H.compareTo(te)}(E.bytesValue,r.bytesValue);case 7:return function(S,I){const H=S.split("/"),te=I.split("/");for(let ae=0;ae<H.length&&ae<te.length;ae++){const ie=__PRIVATE_primitiveComparator(H[ae],te[ae]);if(ie!==0)return ie}return __PRIVATE_primitiveComparator(H.length,te.length)}(E.referenceValue,r.referenceValue);case 8:return function(S,I){const H=__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(S.latitude),__PRIVATE_normalizeNumber(I.latitude));return H!==0?H:__PRIVATE_primitiveComparator(__PRIVATE_normalizeNumber(S.longitude),__PRIVATE_normalizeNumber(I.longitude))}(E.geoPointValue,r.geoPointValue);case 9:return __PRIVATE_compareArrays(E.arrayValue,r.arrayValue);case 10:return function(S,I){var H,te,ae,ie;const ce=S.fields||{},me=I.fields||{},_e=(H=ce[Tt])===null||H===void 0?void 0:H.arrayValue,Re=(te=me[Tt])===null||te===void 0?void 0:te.arrayValue,Pe=__PRIVATE_primitiveComparator(((ae=_e==null?void 0:_e.values)===null||ae===void 0?void 0:ae.length)||0,((ie=Re==null?void 0:Re.values)===null||ie===void 0?void 0:ie.length)||0);return Pe!==0?Pe:__PRIVATE_compareArrays(_e,Re)}(E.mapValue,r.mapValue);case 11:return function(S,I){if(S===ht.mapValue&&I===ht.mapValue)return 0;if(S===ht.mapValue)return 1;if(I===ht.mapValue)return-1;const H=S.fields||{},te=Object.keys(H),ae=I.fields||{},ie=Object.keys(ae);te.sort(),ie.sort();for(let ce=0;ce<te.length&&ce<ie.length;++ce){const me=__PRIVATE_compareUtf8Strings(te[ce],ie[ce]);if(me!==0)return me;const _e=__PRIVATE_valueCompare(H[te[ce]],ae[ie[ce]]);if(_e!==0)return _e}return __PRIVATE_primitiveComparator(te.length,ie.length)}(E.mapValue,r.mapValue);default:throw fail(23264,{Pe:v})}}function __PRIVATE_compareTimestamps(E,r){if(typeof E=="string"&&typeof r=="string"&&E.length===r.length)return __PRIVATE_primitiveComparator(E,r);const v=__PRIVATE_normalizeTimestamp(E),T=__PRIVATE_normalizeTimestamp(r),w=__PRIVATE_primitiveComparator(v.seconds,T.seconds);return w!==0?w:__PRIVATE_primitiveComparator(v.nanos,T.nanos)}function __PRIVATE_compareArrays(E,r){const v=E.values||[],T=r.values||[];for(let w=0;w<v.length&&w<T.length;++w){const S=__PRIVATE_valueCompare(v[w],T[w]);if(S)return S}return __PRIVATE_primitiveComparator(v.length,T.length)}function canonicalId(E){return __PRIVATE_canonifyValue(E)}function __PRIVATE_canonifyValue(E){return"nullValue"in E?"null":"booleanValue"in E?""+E.booleanValue:"integerValue"in E?""+E.integerValue:"doubleValue"in E?""+E.doubleValue:"timestampValue"in E?function(v){const T=__PRIVATE_normalizeTimestamp(v);return`time(${T.seconds},${T.nanos})`}(E.timestampValue):"stringValue"in E?E.stringValue:"bytesValue"in E?function(v){return __PRIVATE_normalizeByteString(v).toBase64()}(E.bytesValue):"referenceValue"in E?function(v){return DocumentKey.fromName(v).toString()}(E.referenceValue):"geoPointValue"in E?function(v){return`geo(${v.latitude},${v.longitude})`}(E.geoPointValue):"arrayValue"in E?function(v){let T="[",w=!0;for(const S of v.values||[])w?w=!1:T+=",",T+=__PRIVATE_canonifyValue(S);return T+"]"}(E.arrayValue):"mapValue"in E?function(v){const T=Object.keys(v.fields||{}).sort();let w="{",S=!0;for(const I of T)S?S=!1:w+=",",w+=`${I}:${__PRIVATE_canonifyValue(v.fields[I])}`;return w+"}"}(E.mapValue):fail(61005,{value:E})}function __PRIVATE_estimateByteSize(E){switch(__PRIVATE_typeOrder(E)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const r=__PRIVATE_getPreviousValue(E);return r?16+__PRIVATE_estimateByteSize(r):16;case 5:return 2*E.stringValue.length;case 6:return __PRIVATE_normalizeByteString(E.bytesValue).approximateByteSize();case 7:return E.referenceValue.length;case 9:return function(T){return(T.values||[]).reduce((w,S)=>w+__PRIVATE_estimateByteSize(S),0)}(E.arrayValue);case 10:case 11:return function(T){let w=0;return forEach(T.fields,(S,I)=>{w+=S.length+__PRIVATE_estimateByteSize(I)}),w}(E.mapValue);default:throw fail(13486,{value:E})}}function __PRIVATE_refValue(E,r){return{referenceValue:`projects/${E.projectId}/databases/${E.database}/documents/${r.path.canonicalString()}`}}function isInteger(E){return!!E&&"integerValue"in E}function isArray(E){return!!E&&"arrayValue"in E}function __PRIVATE_isNullValue(E){return!!E&&"nullValue"in E}function __PRIVATE_isNanValue(E){return!!E&&"doubleValue"in E&&isNaN(Number(E.doubleValue))}function __PRIVATE_isMapValue(E){return!!E&&"mapValue"in E}function __PRIVATE_isVectorValue(E){var r,v;return((v=(((r=E==null?void 0:E.mapValue)===null||r===void 0?void 0:r.fields)||{})[ct])===null||v===void 0?void 0:v.stringValue)===Pt}function __PRIVATE_deepClone(E){if(E.geoPointValue)return{geoPointValue:Object.assign({},E.geoPointValue)};if(E.timestampValue&&typeof E.timestampValue=="object")return{timestampValue:Object.assign({},E.timestampValue)};if(E.mapValue){const r={mapValue:{fields:{}}};return forEach(E.mapValue.fields,(v,T)=>r.mapValue.fields[v]=__PRIVATE_deepClone(T)),r}if(E.arrayValue){const r={arrayValue:{values:[]}};for(let v=0;v<(E.arrayValue.values||[]).length;++v)r.arrayValue.values[v]=__PRIVATE_deepClone(E.arrayValue.values[v]);return r}return Object.assign({},E)}function __PRIVATE_isMaxValue(E){return(((E.mapValue||{}).fields||{}).__type__||{}).stringValue===lt}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ObjectValue{constructor(r){this.value=r}static empty(){return new ObjectValue({mapValue:{}})}field(r){if(r.isEmpty())return this.value;{let v=this.value;for(let T=0;T<r.length-1;++T)if(v=(v.mapValue.fields||{})[r.get(T)],!__PRIVATE_isMapValue(v))return null;return v=(v.mapValue.fields||{})[r.lastSegment()],v||null}}set(r,v){this.getFieldsMap(r.popLast())[r.lastSegment()]=__PRIVATE_deepClone(v)}setAll(r){let v=FieldPath$1.emptyPath(),T={},w=[];r.forEach((I,H)=>{if(!v.isImmediateParentOf(H)){const te=this.getFieldsMap(v);this.applyChanges(te,T,w),T={},w=[],v=H.popLast()}I?T[H.lastSegment()]=__PRIVATE_deepClone(I):w.push(H.lastSegment())});const S=this.getFieldsMap(v);this.applyChanges(S,T,w)}delete(r){const v=this.field(r.popLast());__PRIVATE_isMapValue(v)&&v.mapValue.fields&&delete v.mapValue.fields[r.lastSegment()]}isEqual(r){return __PRIVATE_valueEquals(this.value,r.value)}getFieldsMap(r){let v=this.value;v.mapValue.fields||(v.mapValue={fields:{}});for(let T=0;T<r.length;++T){let w=v.mapValue.fields[r.get(T)];__PRIVATE_isMapValue(w)&&w.mapValue.fields||(w={mapValue:{fields:{}}},v.mapValue.fields[r.get(T)]=w),v=w}return v.mapValue.fields}applyChanges(r,v,T){forEach(v,(w,S)=>r[w]=S);for(const w of T)delete r[w]}clone(){return new ObjectValue(__PRIVATE_deepClone(this.value))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MutableDocument{constructor(r,v,T,w,S,I,H){this.key=r,this.documentType=v,this.version=T,this.readTime=w,this.createTime=S,this.data=I,this.documentState=H}static newInvalidDocument(r){return new MutableDocument(r,0,SnapshotVersion.min(),SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newFoundDocument(r,v,T,w){return new MutableDocument(r,1,v,SnapshotVersion.min(),T,w,0)}static newNoDocument(r,v){return new MutableDocument(r,2,v,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),0)}static newUnknownDocument(r,v){return new MutableDocument(r,3,v,SnapshotVersion.min(),SnapshotVersion.min(),ObjectValue.empty(),2)}convertToFoundDocument(r,v){return!this.createTime.isEqual(SnapshotVersion.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=r),this.version=r,this.documentType=1,this.data=v,this.documentState=0,this}convertToNoDocument(r){return this.version=r,this.documentType=2,this.data=ObjectValue.empty(),this.documentState=0,this}convertToUnknownDocument(r){return this.version=r,this.documentType=3,this.data=ObjectValue.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=SnapshotVersion.min(),this}setReadTime(r){return this.readTime=r,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(r){return r instanceof MutableDocument&&this.key.isEqual(r.key)&&this.version.isEqual(r.version)&&this.documentType===r.documentType&&this.documentState===r.documentState&&this.data.isEqual(r.data)}mutableCopy(){return new MutableDocument(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bound{constructor(r,v){this.position=r,this.inclusive=v}}function __PRIVATE_boundCompareToDocument(E,r,v){let T=0;for(let w=0;w<E.position.length;w++){const S=r[w],I=E.position[w];if(S.field.isKeyField()?T=DocumentKey.comparator(DocumentKey.fromName(I.referenceValue),v.key):T=__PRIVATE_valueCompare(I,v.data.field(S.field)),S.dir==="desc"&&(T*=-1),T!==0)break}return T}function __PRIVATE_boundEquals(E,r){if(E===null)return r===null;if(r===null||E.inclusive!==r.inclusive||E.position.length!==r.position.length)return!1;for(let v=0;v<E.position.length;v++)if(!__PRIVATE_valueEquals(E.position[v],r.position[v]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OrderBy{constructor(r,v="asc"){this.field=r,this.dir=v}}function __PRIVATE_orderByEquals(E,r){return E.dir===r.dir&&E.field.isEqual(r.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Filter{}class FieldFilter extends Filter{constructor(r,v,T){super(),this.field=r,this.op=v,this.value=T}static create(r,v,T){return r.isKeyField()?v==="in"||v==="not-in"?this.createKeyFieldInFilter(r,v,T):new __PRIVATE_KeyFieldFilter(r,v,T):v==="array-contains"?new __PRIVATE_ArrayContainsFilter(r,T):v==="in"?new __PRIVATE_InFilter(r,T):v==="not-in"?new __PRIVATE_NotInFilter(r,T):v==="array-contains-any"?new __PRIVATE_ArrayContainsAnyFilter(r,T):new FieldFilter(r,v,T)}static createKeyFieldInFilter(r,v,T){return v==="in"?new __PRIVATE_KeyFieldInFilter(r,T):new __PRIVATE_KeyFieldNotInFilter(r,T)}matches(r){const v=r.data.field(this.field);return this.op==="!="?v!==null&&v.nullValue===void 0&&this.matchesComparison(__PRIVATE_valueCompare(v,this.value)):v!==null&&__PRIVATE_typeOrder(this.value)===__PRIVATE_typeOrder(v)&&this.matchesComparison(__PRIVATE_valueCompare(v,this.value))}matchesComparison(r){switch(this.op){case"<":return r<0;case"<=":return r<=0;case"==":return r===0;case"!=":return r!==0;case">":return r>0;case">=":return r>=0;default:return fail(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class CompositeFilter extends Filter{constructor(r,v){super(),this.filters=r,this.op=v,this.Te=null}static create(r,v){return new CompositeFilter(r,v)}matches(r){return __PRIVATE_compositeFilterIsConjunction(this)?this.filters.find(v=>!v.matches(r))===void 0:this.filters.find(v=>v.matches(r))!==void 0}getFlattenedFilters(){return this.Te!==null||(this.Te=this.filters.reduce((r,v)=>r.concat(v.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function __PRIVATE_compositeFilterIsConjunction(E){return E.op==="and"}function __PRIVATE_compositeFilterIsFlatConjunction(E){return __PRIVATE_compositeFilterIsFlat(E)&&__PRIVATE_compositeFilterIsConjunction(E)}function __PRIVATE_compositeFilterIsFlat(E){for(const r of E.filters)if(r instanceof CompositeFilter)return!1;return!0}function __PRIVATE_canonifyFilter(E){if(E instanceof FieldFilter)return E.field.canonicalString()+E.op.toString()+canonicalId(E.value);if(__PRIVATE_compositeFilterIsFlatConjunction(E))return E.filters.map(r=>__PRIVATE_canonifyFilter(r)).join(",");{const r=E.filters.map(v=>__PRIVATE_canonifyFilter(v)).join(",");return`${E.op}(${r})`}}function __PRIVATE_filterEquals(E,r){return E instanceof FieldFilter?function(T,w){return w instanceof FieldFilter&&T.op===w.op&&T.field.isEqual(w.field)&&__PRIVATE_valueEquals(T.value,w.value)}(E,r):E instanceof CompositeFilter?function(T,w){return w instanceof CompositeFilter&&T.op===w.op&&T.filters.length===w.filters.length?T.filters.reduce((S,I,H)=>S&&__PRIVATE_filterEquals(I,w.filters[H]),!0):!1}(E,r):void fail(19439)}function __PRIVATE_stringifyFilter(E){return E instanceof FieldFilter?function(v){return`${v.field.canonicalString()} ${v.op} ${canonicalId(v.value)}`}(E):E instanceof CompositeFilter?function(v){return v.op.toString()+" {"+v.getFilters().map(__PRIVATE_stringifyFilter).join(" ,")+"}"}(E):"Filter"}class __PRIVATE_KeyFieldFilter extends FieldFilter{constructor(r,v,T){super(r,v,T),this.key=DocumentKey.fromName(T.referenceValue)}matches(r){const v=DocumentKey.comparator(r.key,this.key);return this.matchesComparison(v)}}class __PRIVATE_KeyFieldInFilter extends FieldFilter{constructor(r,v){super(r,"in",v),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("in",v)}matches(r){return this.keys.some(v=>v.isEqual(r.key))}}class __PRIVATE_KeyFieldNotInFilter extends FieldFilter{constructor(r,v){super(r,"not-in",v),this.keys=__PRIVATE_extractDocumentKeysFromArrayValue("not-in",v)}matches(r){return!this.keys.some(v=>v.isEqual(r.key))}}function __PRIVATE_extractDocumentKeysFromArrayValue(E,r){var v;return(((v=r.arrayValue)===null||v===void 0?void 0:v.values)||[]).map(T=>DocumentKey.fromName(T.referenceValue))}class __PRIVATE_ArrayContainsFilter extends FieldFilter{constructor(r,v){super(r,"array-contains",v)}matches(r){const v=r.data.field(this.field);return isArray(v)&&__PRIVATE_arrayValueContains(v.arrayValue,this.value)}}class __PRIVATE_InFilter extends FieldFilter{constructor(r,v){super(r,"in",v)}matches(r){const v=r.data.field(this.field);return v!==null&&__PRIVATE_arrayValueContains(this.value.arrayValue,v)}}class __PRIVATE_NotInFilter extends FieldFilter{constructor(r,v){super(r,"not-in",v)}matches(r){if(__PRIVATE_arrayValueContains(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const v=r.data.field(this.field);return v!==null&&v.nullValue===void 0&&!__PRIVATE_arrayValueContains(this.value.arrayValue,v)}}class __PRIVATE_ArrayContainsAnyFilter extends FieldFilter{constructor(r,v){super(r,"array-contains-any",v)}matches(r){const v=r.data.field(this.field);return!(!isArray(v)||!v.arrayValue.values)&&v.arrayValue.values.some(T=>__PRIVATE_arrayValueContains(this.value.arrayValue,T))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_TargetImpl{constructor(r,v=null,T=[],w=[],S=null,I=null,H=null){this.path=r,this.collectionGroup=v,this.orderBy=T,this.filters=w,this.limit=S,this.startAt=I,this.endAt=H,this.Ie=null}}function __PRIVATE_newTarget(E,r=null,v=[],T=[],w=null,S=null,I=null){return new __PRIVATE_TargetImpl(E,r,v,T,w,S,I)}function __PRIVATE_canonifyTarget(E){const r=__PRIVATE_debugCast(E);if(r.Ie===null){let v=r.path.canonicalString();r.collectionGroup!==null&&(v+="|cg:"+r.collectionGroup),v+="|f:",v+=r.filters.map(T=>__PRIVATE_canonifyFilter(T)).join(","),v+="|ob:",v+=r.orderBy.map(T=>function(S){return S.field.canonicalString()+S.dir}(T)).join(","),__PRIVATE_isNullOrUndefined(r.limit)||(v+="|l:",v+=r.limit),r.startAt&&(v+="|lb:",v+=r.startAt.inclusive?"b:":"a:",v+=r.startAt.position.map(T=>canonicalId(T)).join(",")),r.endAt&&(v+="|ub:",v+=r.endAt.inclusive?"a:":"b:",v+=r.endAt.position.map(T=>canonicalId(T)).join(",")),r.Ie=v}return r.Ie}function __PRIVATE_targetEquals(E,r){if(E.limit!==r.limit||E.orderBy.length!==r.orderBy.length)return!1;for(let v=0;v<E.orderBy.length;v++)if(!__PRIVATE_orderByEquals(E.orderBy[v],r.orderBy[v]))return!1;if(E.filters.length!==r.filters.length)return!1;for(let v=0;v<E.filters.length;v++)if(!__PRIVATE_filterEquals(E.filters[v],r.filters[v]))return!1;return E.collectionGroup===r.collectionGroup&&!!E.path.isEqual(r.path)&&!!__PRIVATE_boundEquals(E.startAt,r.startAt)&&__PRIVATE_boundEquals(E.endAt,r.endAt)}function __PRIVATE_targetIsDocumentTarget(E){return DocumentKey.isDocumentKey(E.path)&&E.collectionGroup===null&&E.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_QueryImpl{constructor(r,v=null,T=[],w=[],S=null,I="F",H=null,te=null){this.path=r,this.collectionGroup=v,this.explicitOrderBy=T,this.filters=w,this.limit=S,this.limitType=I,this.startAt=H,this.endAt=te,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function __PRIVATE_newQuery(E,r,v,T,w,S,I,H){return new __PRIVATE_QueryImpl(E,r,v,T,w,S,I,H)}function __PRIVATE_newQueryForPath(E){return new __PRIVATE_QueryImpl(E)}function __PRIVATE_queryMatchesAllDocuments(E){return E.filters.length===0&&E.limit===null&&E.startAt==null&&E.endAt==null&&(E.explicitOrderBy.length===0||E.explicitOrderBy.length===1&&E.explicitOrderBy[0].field.isKeyField())}function __PRIVATE_isCollectionGroupQuery(E){return E.collectionGroup!==null}function __PRIVATE_queryNormalizedOrderBy(E){const r=__PRIVATE_debugCast(E);if(r.Ee===null){r.Ee=[];const v=new Set;for(const S of r.explicitOrderBy)r.Ee.push(S),v.add(S.field.canonicalString());const T=r.explicitOrderBy.length>0?r.explicitOrderBy[r.explicitOrderBy.length-1].dir:"asc";(function(I){let H=new SortedSet(FieldPath$1.comparator);return I.filters.forEach(te=>{te.getFlattenedFilters().forEach(ae=>{ae.isInequality()&&(H=H.add(ae.field))})}),H})(r).forEach(S=>{v.has(S.canonicalString())||S.isKeyField()||r.Ee.push(new OrderBy(S,T))}),v.has(FieldPath$1.keyField().canonicalString())||r.Ee.push(new OrderBy(FieldPath$1.keyField(),T))}return r.Ee}function __PRIVATE_queryToTarget(E){const r=__PRIVATE_debugCast(E);return r.de||(r.de=__PRIVATE__queryToTarget(r,__PRIVATE_queryNormalizedOrderBy(E))),r.de}function __PRIVATE__queryToTarget(E,r){if(E.limitType==="F")return __PRIVATE_newTarget(E.path,E.collectionGroup,r,E.filters,E.limit,E.startAt,E.endAt);{r=r.map(w=>{const S=w.dir==="desc"?"asc":"desc";return new OrderBy(w.field,S)});const v=E.endAt?new Bound(E.endAt.position,E.endAt.inclusive):null,T=E.startAt?new Bound(E.startAt.position,E.startAt.inclusive):null;return __PRIVATE_newTarget(E.path,E.collectionGroup,r,E.filters,E.limit,v,T)}}function __PRIVATE_queryWithAddedFilter(E,r){const v=E.filters.concat([r]);return new __PRIVATE_QueryImpl(E.path,E.collectionGroup,E.explicitOrderBy.slice(),v,E.limit,E.limitType,E.startAt,E.endAt)}function __PRIVATE_queryWithLimit(E,r,v){return new __PRIVATE_QueryImpl(E.path,E.collectionGroup,E.explicitOrderBy.slice(),E.filters.slice(),r,v,E.startAt,E.endAt)}function __PRIVATE_queryEquals(E,r){return __PRIVATE_targetEquals(__PRIVATE_queryToTarget(E),__PRIVATE_queryToTarget(r))&&E.limitType===r.limitType}function __PRIVATE_canonifyQuery(E){return`${__PRIVATE_canonifyTarget(__PRIVATE_queryToTarget(E))}|lt:${E.limitType}`}function __PRIVATE_stringifyQuery(E){return`Query(target=${function(v){let T=v.path.canonicalString();return v.collectionGroup!==null&&(T+=" collectionGroup="+v.collectionGroup),v.filters.length>0&&(T+=`, filters: [${v.filters.map(w=>__PRIVATE_stringifyFilter(w)).join(", ")}]`),__PRIVATE_isNullOrUndefined(v.limit)||(T+=", limit: "+v.limit),v.orderBy.length>0&&(T+=`, orderBy: [${v.orderBy.map(w=>function(I){return`${I.field.canonicalString()} (${I.dir})`}(w)).join(", ")}]`),v.startAt&&(T+=", startAt: ",T+=v.startAt.inclusive?"b:":"a:",T+=v.startAt.position.map(w=>canonicalId(w)).join(",")),v.endAt&&(T+=", endAt: ",T+=v.endAt.inclusive?"a:":"b:",T+=v.endAt.position.map(w=>canonicalId(w)).join(",")),`Target(${T})`}(__PRIVATE_queryToTarget(E))}; limitType=${E.limitType})`}function __PRIVATE_queryMatches(E,r){return r.isFoundDocument()&&function(T,w){const S=w.key.path;return T.collectionGroup!==null?w.key.hasCollectionId(T.collectionGroup)&&T.path.isPrefixOf(S):DocumentKey.isDocumentKey(T.path)?T.path.isEqual(S):T.path.isImmediateParentOf(S)}(E,r)&&function(T,w){for(const S of __PRIVATE_queryNormalizedOrderBy(T))if(!S.field.isKeyField()&&w.data.field(S.field)===null)return!1;return!0}(E,r)&&function(T,w){for(const S of T.filters)if(!S.matches(w))return!1;return!0}(E,r)&&function(T,w){return!(T.startAt&&!function(I,H,te){const ae=__PRIVATE_boundCompareToDocument(I,H,te);return I.inclusive?ae<=0:ae<0}(T.startAt,__PRIVATE_queryNormalizedOrderBy(T),w)||T.endAt&&!function(I,H,te){const ae=__PRIVATE_boundCompareToDocument(I,H,te);return I.inclusive?ae>=0:ae>0}(T.endAt,__PRIVATE_queryNormalizedOrderBy(T),w))}(E,r)}function __PRIVATE_queryCollectionGroup(E){return E.collectionGroup||(E.path.length%2==1?E.path.lastSegment():E.path.get(E.path.length-2))}function __PRIVATE_newQueryComparator(E){return(r,v)=>{let T=!1;for(const w of __PRIVATE_queryNormalizedOrderBy(E)){const S=__PRIVATE_compareDocs(w,r,v);if(S!==0)return S;T=T||w.field.isKeyField()}return 0}}function __PRIVATE_compareDocs(E,r,v){const T=E.field.isKeyField()?DocumentKey.comparator(r.key,v.key):function(S,I,H){const te=I.data.field(S),ae=H.data.field(S);return te!==null&&ae!==null?__PRIVATE_valueCompare(te,ae):fail(42886)}(E.field,r,v);switch(E.dir){case"asc":return T;case"desc":return-1*T;default:return fail(19790,{direction:E.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ObjectMap{constructor(r,v){this.mapKeyFn=r,this.equalsFn=v,this.inner={},this.innerSize=0}get(r){const v=this.mapKeyFn(r),T=this.inner[v];if(T!==void 0){for(const[w,S]of T)if(this.equalsFn(w,r))return S}}has(r){return this.get(r)!==void 0}set(r,v){const T=this.mapKeyFn(r),w=this.inner[T];if(w===void 0)return this.inner[T]=[[r,v]],void this.innerSize++;for(let S=0;S<w.length;S++)if(this.equalsFn(w[S][0],r))return void(w[S]=[r,v]);w.push([r,v]),this.innerSize++}delete(r){const v=this.mapKeyFn(r),T=this.inner[v];if(T===void 0)return!1;for(let w=0;w<T.length;w++)if(this.equalsFn(T[w][0],r))return T.length===1?delete this.inner[v]:T.splice(w,1),this.innerSize--,!0;return!1}forEach(r){forEach(this.inner,(v,T)=>{for(const[w,S]of T)r(w,S)})}isEmpty(){return isEmpty(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dt=new SortedMap(DocumentKey.comparator);function __PRIVATE_mutableDocumentMap(){return dt}const At=new SortedMap(DocumentKey.comparator);function documentMap(...E){let r=At;for(const v of E)r=r.insert(v.key,v);return r}function __PRIVATE_convertOverlayedDocumentMapToDocumentMap(E){let r=At;return E.forEach((v,T)=>r=r.insert(v,T.overlayedDocument)),r}function __PRIVATE_newOverlayMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newMutationMap(){return __PRIVATE_newDocumentKeyMap()}function __PRIVATE_newDocumentKeyMap(){return new ObjectMap(E=>E.toString(),(E,r)=>E.isEqual(r))}const Vt=new SortedSet(DocumentKey.comparator);function __PRIVATE_documentKeySet(...E){let r=Vt;for(const v of E)r=r.add(v);return r}const mt=new SortedSet(__PRIVATE_primitiveComparator);function __PRIVATE_targetIdSet(){return mt}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_toDouble(E,r){if(E.useProto3Json){if(isNaN(r))return{doubleValue:"NaN"};if(r===1/0)return{doubleValue:"Infinity"};if(r===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:__PRIVATE_isNegativeZero(r)?"-0":r}}function __PRIVATE_toInteger(E){return{integerValue:""+E}}function toNumber(E,r){return isSafeInteger(r)?__PRIVATE_toInteger(r):__PRIVATE_toDouble(E,r)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TransformOperation{constructor(){this._=void 0}}function __PRIVATE_applyTransformOperationToLocalView(E,r,v){return E instanceof __PRIVATE_ServerTimestampTransform?function(w,S){const I={fields:{[ot]:{stringValue:st},[at]:{timestampValue:{seconds:w.seconds,nanos:w.nanoseconds}}}};return S&&__PRIVATE_isServerTimestamp(S)&&(S=__PRIVATE_getPreviousValue(S)),S&&(I.fields[_t]=S),{mapValue:I}}(v,r):E instanceof __PRIVATE_ArrayUnionTransformOperation?__PRIVATE_applyArrayUnionTransformOperation(E,r):E instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_applyArrayRemoveTransformOperation(E,r):function(w,S){const I=__PRIVATE_computeTransformOperationBaseValue(w,S),H=asNumber(I)+asNumber(w.Re);return isInteger(I)&&isInteger(w.Re)?__PRIVATE_toInteger(H):__PRIVATE_toDouble(w.serializer,H)}(E,r)}function __PRIVATE_applyTransformOperationToRemoteDocument(E,r,v){return E instanceof __PRIVATE_ArrayUnionTransformOperation?__PRIVATE_applyArrayUnionTransformOperation(E,r):E instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_applyArrayRemoveTransformOperation(E,r):v}function __PRIVATE_computeTransformOperationBaseValue(E,r){return E instanceof __PRIVATE_NumericIncrementTransformOperation?function(T){return isInteger(T)||function(S){return!!S&&"doubleValue"in S}(T)}(r)?r:{integerValue:0}:null}class __PRIVATE_ServerTimestampTransform extends TransformOperation{}class __PRIVATE_ArrayUnionTransformOperation extends TransformOperation{constructor(r){super(),this.elements=r}}function __PRIVATE_applyArrayUnionTransformOperation(E,r){const v=__PRIVATE_coercedFieldValuesArray(r);for(const T of E.elements)v.some(w=>__PRIVATE_valueEquals(w,T))||v.push(T);return{arrayValue:{values:v}}}class __PRIVATE_ArrayRemoveTransformOperation extends TransformOperation{constructor(r){super(),this.elements=r}}function __PRIVATE_applyArrayRemoveTransformOperation(E,r){let v=__PRIVATE_coercedFieldValuesArray(r);for(const T of E.elements)v=v.filter(w=>!__PRIVATE_valueEquals(w,T));return{arrayValue:{values:v}}}class __PRIVATE_NumericIncrementTransformOperation extends TransformOperation{constructor(r,v){super(),this.serializer=r,this.Re=v}}function asNumber(E){return __PRIVATE_normalizeNumber(E.integerValue||E.doubleValue)}function __PRIVATE_coercedFieldValuesArray(E){return isArray(E)&&E.arrayValue.values?E.arrayValue.values.slice():[]}function __PRIVATE_fieldTransformEquals(E,r){return E.field.isEqual(r.field)&&function(T,w){return T instanceof __PRIVATE_ArrayUnionTransformOperation&&w instanceof __PRIVATE_ArrayUnionTransformOperation||T instanceof __PRIVATE_ArrayRemoveTransformOperation&&w instanceof __PRIVATE_ArrayRemoveTransformOperation?__PRIVATE_arrayEquals(T.elements,w.elements,__PRIVATE_valueEquals):T instanceof __PRIVATE_NumericIncrementTransformOperation&&w instanceof __PRIVATE_NumericIncrementTransformOperation?__PRIVATE_valueEquals(T.Re,w.Re):T instanceof __PRIVATE_ServerTimestampTransform&&w instanceof __PRIVATE_ServerTimestampTransform}(E.transform,r.transform)}class Precondition{constructor(r,v){this.updateTime=r,this.exists=v}static none(){return new Precondition}static exists(r){return new Precondition(void 0,r)}static updateTime(r){return new Precondition(r)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(r){return this.exists===r.exists&&(this.updateTime?!!r.updateTime&&this.updateTime.isEqual(r.updateTime):!r.updateTime)}}function __PRIVATE_preconditionIsValidForDocument(E,r){return E.updateTime!==void 0?r.isFoundDocument()&&r.version.isEqual(E.updateTime):E.exists===void 0||E.exists===r.isFoundDocument()}class Mutation{}function __PRIVATE_calculateOverlayMutation(E,r){if(!E.hasLocalMutations||r&&r.fields.length===0)return null;if(r===null)return E.isNoDocument()?new __PRIVATE_DeleteMutation(E.key,Precondition.none()):new __PRIVATE_SetMutation(E.key,E.data,Precondition.none());{const v=E.data,T=ObjectValue.empty();let w=new SortedSet(FieldPath$1.comparator);for(let S of r.fields)if(!w.has(S)){let I=v.field(S);I===null&&S.length>1&&(S=S.popLast(),I=v.field(S)),I===null?T.delete(S):T.set(S,I),w=w.add(S)}return new __PRIVATE_PatchMutation(E.key,T,new FieldMask(w.toArray()),Precondition.none())}}function __PRIVATE_mutationApplyToRemoteDocument(E,r,v){E instanceof __PRIVATE_SetMutation?function(w,S,I){const H=w.value.clone(),te=__PRIVATE_serverTransformResults(w.fieldTransforms,S,I.transformResults);H.setAll(te),S.convertToFoundDocument(I.version,H).setHasCommittedMutations()}(E,r,v):E instanceof __PRIVATE_PatchMutation?function(w,S,I){if(!__PRIVATE_preconditionIsValidForDocument(w.precondition,S))return void S.convertToUnknownDocument(I.version);const H=__PRIVATE_serverTransformResults(w.fieldTransforms,S,I.transformResults),te=S.data;te.setAll(__PRIVATE_getPatch(w)),te.setAll(H),S.convertToFoundDocument(I.version,te).setHasCommittedMutations()}(E,r,v):function(w,S,I){S.convertToNoDocument(I.version).setHasCommittedMutations()}(0,r,v)}function __PRIVATE_mutationApplyToLocalView(E,r,v,T){return E instanceof __PRIVATE_SetMutation?function(S,I,H,te){if(!__PRIVATE_preconditionIsValidForDocument(S.precondition,I))return H;const ae=S.value.clone(),ie=__PRIVATE_localTransformResults(S.fieldTransforms,te,I);return ae.setAll(ie),I.convertToFoundDocument(I.version,ae).setHasLocalMutations(),null}(E,r,v,T):E instanceof __PRIVATE_PatchMutation?function(S,I,H,te){if(!__PRIVATE_preconditionIsValidForDocument(S.precondition,I))return H;const ae=__PRIVATE_localTransformResults(S.fieldTransforms,te,I),ie=I.data;return ie.setAll(__PRIVATE_getPatch(S)),ie.setAll(ae),I.convertToFoundDocument(I.version,ie).setHasLocalMutations(),H===null?null:H.unionWith(S.fieldMask.fields).unionWith(S.fieldTransforms.map(ce=>ce.field))}(E,r,v,T):function(S,I,H){return __PRIVATE_preconditionIsValidForDocument(S.precondition,I)?(I.convertToNoDocument(I.version).setHasLocalMutations(),null):H}(E,r,v)}function __PRIVATE_mutationEquals(E,r){return E.type===r.type&&!!E.key.isEqual(r.key)&&!!E.precondition.isEqual(r.precondition)&&!!function(T,w){return T===void 0&&w===void 0||!(!T||!w)&&__PRIVATE_arrayEquals(T,w,(S,I)=>__PRIVATE_fieldTransformEquals(S,I))}(E.fieldTransforms,r.fieldTransforms)&&(E.type===0?E.value.isEqual(r.value):E.type!==1||E.data.isEqual(r.data)&&E.fieldMask.isEqual(r.fieldMask))}class __PRIVATE_SetMutation extends Mutation{constructor(r,v,T,w=[]){super(),this.key=r,this.value=v,this.precondition=T,this.fieldTransforms=w,this.type=0}getFieldMask(){return null}}class __PRIVATE_PatchMutation extends Mutation{constructor(r,v,T,w,S=[]){super(),this.key=r,this.data=v,this.fieldMask=T,this.precondition=w,this.fieldTransforms=S,this.type=1}getFieldMask(){return this.fieldMask}}function __PRIVATE_getPatch(E){const r=new Map;return E.fieldMask.fields.forEach(v=>{if(!v.isEmpty()){const T=E.data.field(v);r.set(v,T)}}),r}function __PRIVATE_serverTransformResults(E,r,v){const T=new Map;__PRIVATE_hardAssert(E.length===v.length,32656,{Ve:v.length,me:E.length});for(let w=0;w<v.length;w++){const S=E[w],I=S.transform,H=r.data.field(S.field);T.set(S.field,__PRIVATE_applyTransformOperationToRemoteDocument(I,H,v[w]))}return T}function __PRIVATE_localTransformResults(E,r,v){const T=new Map;for(const w of E){const S=w.transform,I=v.data.field(w.field);T.set(w.field,__PRIVATE_applyTransformOperationToLocalView(S,I,r))}return T}class __PRIVATE_DeleteMutation extends Mutation{constructor(r,v){super(),this.key=r,this.precondition=v,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MutationBatch{constructor(r,v,T,w){this.batchId=r,this.localWriteTime=v,this.baseMutations=T,this.mutations=w}applyToRemoteDocument(r,v){const T=v.mutationResults;for(let w=0;w<this.mutations.length;w++){const S=this.mutations[w];S.key.isEqual(r.key)&&__PRIVATE_mutationApplyToRemoteDocument(S,r,T[w])}}applyToLocalView(r,v){for(const T of this.baseMutations)T.key.isEqual(r.key)&&(v=__PRIVATE_mutationApplyToLocalView(T,r,v,this.localWriteTime));for(const T of this.mutations)T.key.isEqual(r.key)&&(v=__PRIVATE_mutationApplyToLocalView(T,r,v,this.localWriteTime));return v}applyToLocalDocumentSet(r,v){const T=__PRIVATE_newMutationMap();return this.mutations.forEach(w=>{const S=r.get(w.key),I=S.overlayedDocument;let H=this.applyToLocalView(I,S.mutatedFields);H=v.has(w.key)?null:H;const te=__PRIVATE_calculateOverlayMutation(I,H);te!==null&&T.set(w.key,te),I.isValidDocument()||I.convertToNoDocument(SnapshotVersion.min())}),T}keys(){return this.mutations.reduce((r,v)=>r.add(v.key),__PRIVATE_documentKeySet())}isEqual(r){return this.batchId===r.batchId&&__PRIVATE_arrayEquals(this.mutations,r.mutations,(v,T)=>__PRIVATE_mutationEquals(v,T))&&__PRIVATE_arrayEquals(this.baseMutations,r.baseMutations,(v,T)=>__PRIVATE_mutationEquals(v,T))}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Overlay{constructor(r,v){this.largestBatchId=r,this.mutation=v}getKey(){return this.mutation.key}isEqual(r){return r!==null&&this.mutation===r.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ExistenceFilter{constructor(r,v){this.count=r,this.unchangedNames=v}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ft,gt;function __PRIVATE_mapCodeFromRpcCode(E){if(E===void 0)return __PRIVATE_logError("GRPC error has no .code"),N.UNKNOWN;switch(E){case ft.OK:return N.OK;case ft.CANCELLED:return N.CANCELLED;case ft.UNKNOWN:return N.UNKNOWN;case ft.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case ft.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case ft.INTERNAL:return N.INTERNAL;case ft.UNAVAILABLE:return N.UNAVAILABLE;case ft.UNAUTHENTICATED:return N.UNAUTHENTICATED;case ft.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case ft.NOT_FOUND:return N.NOT_FOUND;case ft.ALREADY_EXISTS:return N.ALREADY_EXISTS;case ft.PERMISSION_DENIED:return N.PERMISSION_DENIED;case ft.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case ft.ABORTED:return N.ABORTED;case ft.OUT_OF_RANGE:return N.OUT_OF_RANGE;case ft.UNIMPLEMENTED:return N.UNIMPLEMENTED;case ft.DATA_LOSS:return N.DATA_LOSS;default:return fail(39323,{code:E})}}(gt=ft||(ft={}))[gt.OK=0]="OK",gt[gt.CANCELLED=1]="CANCELLED",gt[gt.UNKNOWN=2]="UNKNOWN",gt[gt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",gt[gt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",gt[gt.NOT_FOUND=5]="NOT_FOUND",gt[gt.ALREADY_EXISTS=6]="ALREADY_EXISTS",gt[gt.PERMISSION_DENIED=7]="PERMISSION_DENIED",gt[gt.UNAUTHENTICATED=16]="UNAUTHENTICATED",gt[gt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",gt[gt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",gt[gt.ABORTED=10]="ABORTED",gt[gt.OUT_OF_RANGE=11]="OUT_OF_RANGE",gt[gt.UNIMPLEMENTED=12]="UNIMPLEMENTED",gt[gt.INTERNAL=13]="INTERNAL",gt[gt.UNAVAILABLE=14]="UNAVAILABLE",gt[gt.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yt=new Integer([4294967295,4294967295],0);function __PRIVATE_getMd5HashValue(E){const r=__PRIVATE_newTextEncoder().encode(E),v=new Md5;return v.update(r),new Uint8Array(v.digest())}function __PRIVATE_get64BitUints(E){const r=new DataView(E.buffer),v=r.getUint32(0,!0),T=r.getUint32(4,!0),w=r.getUint32(8,!0),S=r.getUint32(12,!0);return[new Integer([v,T],0),new Integer([w,S],0)]}class BloomFilter{constructor(r,v,T){if(this.bitmap=r,this.padding=v,this.hashCount=T,v<0||v>=8)throw new __PRIVATE_BloomFilterError(`Invalid padding: ${v}`);if(T<0)throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${T}`);if(r.length>0&&this.hashCount===0)throw new __PRIVATE_BloomFilterError(`Invalid hash count: ${T}`);if(r.length===0&&v!==0)throw new __PRIVATE_BloomFilterError(`Invalid padding when bitmap length is 0: ${v}`);this.pe=8*r.length-v,this.ye=Integer.fromNumber(this.pe)}we(r,v,T){let w=r.add(v.multiply(Integer.fromNumber(T)));return w.compare(yt)===1&&(w=new Integer([w.getBits(0),w.getBits(1)],0)),w.modulo(this.ye).toNumber()}Se(r){return!!(this.bitmap[Math.floor(r/8)]&1<<r%8)}mightContain(r){if(this.pe===0)return!1;const v=__PRIVATE_getMd5HashValue(r),[T,w]=__PRIVATE_get64BitUints(v);for(let S=0;S<this.hashCount;S++){const I=this.we(T,w,S);if(!this.Se(I))return!1}return!0}static create(r,v,T){const w=r%8==0?0:8-r%8,S=new Uint8Array(Math.ceil(r/8)),I=new BloomFilter(S,w,v);return T.forEach(H=>I.insert(H)),I}insert(r){if(this.pe===0)return;const v=__PRIVATE_getMd5HashValue(r),[T,w]=__PRIVATE_get64BitUints(v);for(let S=0;S<this.hashCount;S++){const I=this.we(T,w,S);this.be(I)}}be(r){const v=Math.floor(r/8),T=r%8;this.bitmap[v]|=1<<T}}class __PRIVATE_BloomFilterError extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RemoteEvent{constructor(r,v,T,w,S){this.snapshotVersion=r,this.targetChanges=v,this.targetMismatches=T,this.documentUpdates=w,this.resolvedLimboDocuments=S}static createSynthesizedRemoteEventForCurrentChange(r,v,T){const w=new Map;return w.set(r,TargetChange.createSynthesizedTargetChangeForCurrentChange(r,v,T)),new RemoteEvent(SnapshotVersion.min(),w,new SortedMap(__PRIVATE_primitiveComparator),__PRIVATE_mutableDocumentMap(),__PRIVATE_documentKeySet())}}class TargetChange{constructor(r,v,T,w,S){this.resumeToken=r,this.current=v,this.addedDocuments=T,this.modifiedDocuments=w,this.removedDocuments=S}static createSynthesizedTargetChangeForCurrentChange(r,v,T){return new TargetChange(T,v,__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet(),__PRIVATE_documentKeySet())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_DocumentWatchChange{constructor(r,v,T,w){this.De=r,this.removedTargetIds=v,this.key=T,this.ve=w}}class __PRIVATE_ExistenceFilterChange{constructor(r,v){this.targetId=r,this.Ce=v}}class __PRIVATE_WatchTargetChange{constructor(r,v,T=ByteString.EMPTY_BYTE_STRING,w=null){this.state=r,this.targetIds=v,this.resumeToken=T,this.cause=w}}class __PRIVATE_TargetState{constructor(){this.Fe=0,this.Me=__PRIVATE_snapshotChangesMap(),this.xe=ByteString.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return this.Fe!==0}get Le(){return this.Ne}ke(r){r.approximateByteSize()>0&&(this.Ne=!0,this.xe=r)}qe(){let r=__PRIVATE_documentKeySet(),v=__PRIVATE_documentKeySet(),T=__PRIVATE_documentKeySet();return this.Me.forEach((w,S)=>{switch(S){case 0:r=r.add(w);break;case 2:v=v.add(w);break;case 1:T=T.add(w);break;default:fail(38017,{changeType:S})}}),new TargetChange(this.xe,this.Oe,r,v,T)}Qe(){this.Ne=!1,this.Me=__PRIVATE_snapshotChangesMap()}$e(r,v){this.Ne=!0,this.Me=this.Me.insert(r,v)}Ue(r){this.Ne=!0,this.Me=this.Me.remove(r)}Ke(){this.Fe+=1}We(){this.Fe-=1,__PRIVATE_hardAssert(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class __PRIVATE_WatchChangeAggregator{constructor(r){this.ze=r,this.je=new Map,this.He=__PRIVATE_mutableDocumentMap(),this.Je=__PRIVATE_documentTargetMap(),this.Ye=__PRIVATE_documentTargetMap(),this.Ze=new SortedMap(__PRIVATE_primitiveComparator)}Xe(r){for(const v of r.De)r.ve&&r.ve.isFoundDocument()?this.et(v,r.ve):this.tt(v,r.key,r.ve);for(const v of r.removedTargetIds)this.tt(v,r.key,r.ve)}nt(r){this.forEachTarget(r,v=>{const T=this.rt(v);switch(r.state){case 0:this.it(v)&&T.ke(r.resumeToken);break;case 1:T.We(),T.Be||T.Qe(),T.ke(r.resumeToken);break;case 2:T.We(),T.Be||this.removeTarget(v);break;case 3:this.it(v)&&(T.Ge(),T.ke(r.resumeToken));break;case 4:this.it(v)&&(this.st(v),T.ke(r.resumeToken));break;default:fail(56790,{state:r.state})}})}forEachTarget(r,v){r.targetIds.length>0?r.targetIds.forEach(v):this.je.forEach((T,w)=>{this.it(w)&&v(w)})}ot(r){const v=r.targetId,T=r.Ce.count,w=this._t(v);if(w){const S=w.target;if(__PRIVATE_targetIsDocumentTarget(S))if(T===0){const I=new DocumentKey(S.path);this.tt(v,I,MutableDocument.newNoDocument(I,SnapshotVersion.min()))}else __PRIVATE_hardAssert(T===1,20013,{expectedCount:T});else{const I=this.ut(v);if(I!==T){const H=this.ct(r),te=H?this.lt(H,r,I):1;if(te!==0){this.st(v);const ae=te===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(v,ae)}}}}}ct(r){const v=r.Ce.unchangedNames;if(!v||!v.bits)return null;const{bits:{bitmap:T="",padding:w=0},hashCount:S=0}=v;let I,H;try{I=__PRIVATE_normalizeByteString(T).toUint8Array()}catch(te){if(te instanceof __PRIVATE_Base64DecodeError)return __PRIVATE_logWarn("Decoding the base64 bloom filter in existence filter failed ("+te.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw te}try{H=new BloomFilter(I,w,S)}catch(te){return __PRIVATE_logWarn(te instanceof __PRIVATE_BloomFilterError?"BloomFilter error: ":"Applying bloom filter failed: ",te),null}return H.pe===0?null:H}lt(r,v,T){return v.Ce.count===T-this.Tt(r,v.targetId)?0:2}Tt(r,v){const T=this.ze.getRemoteKeysForTarget(v);let w=0;return T.forEach(S=>{const I=this.ze.Pt(),H=`projects/${I.projectId}/databases/${I.database}/documents/${S.path.canonicalString()}`;r.mightContain(H)||(this.tt(v,S,null),w++)}),w}It(r){const v=new Map;this.je.forEach((S,I)=>{const H=this._t(I);if(H){if(S.current&&__PRIVATE_targetIsDocumentTarget(H.target)){const te=new DocumentKey(H.target.path);this.Et(te).has(I)||this.dt(I,te)||this.tt(I,te,MutableDocument.newNoDocument(te,r))}S.Le&&(v.set(I,S.qe()),S.Qe())}});let T=__PRIVATE_documentKeySet();this.Ye.forEach((S,I)=>{let H=!0;I.forEachWhile(te=>{const ae=this._t(te);return!ae||ae.purpose==="TargetPurposeLimboResolution"||(H=!1,!1)}),H&&(T=T.add(S))}),this.He.forEach((S,I)=>I.setReadTime(r));const w=new RemoteEvent(r,v,this.Ze,this.He,T);return this.He=__PRIVATE_mutableDocumentMap(),this.Je=__PRIVATE_documentTargetMap(),this.Ye=__PRIVATE_documentTargetMap(),this.Ze=new SortedMap(__PRIVATE_primitiveComparator),w}et(r,v){if(!this.it(r))return;const T=this.dt(r,v.key)?2:0;this.rt(r).$e(v.key,T),this.He=this.He.insert(v.key,v),this.Je=this.Je.insert(v.key,this.Et(v.key).add(r)),this.Ye=this.Ye.insert(v.key,this.At(v.key).add(r))}tt(r,v,T){if(!this.it(r))return;const w=this.rt(r);this.dt(r,v)?w.$e(v,1):w.Ue(v),this.Ye=this.Ye.insert(v,this.At(v).delete(r)),this.Ye=this.Ye.insert(v,this.At(v).add(r)),T&&(this.He=this.He.insert(v,T))}removeTarget(r){this.je.delete(r)}ut(r){const v=this.rt(r).qe();return this.ze.getRemoteKeysForTarget(r).size+v.addedDocuments.size-v.removedDocuments.size}Ke(r){this.rt(r).Ke()}rt(r){let v=this.je.get(r);return v||(v=new __PRIVATE_TargetState,this.je.set(r,v)),v}At(r){let v=this.Ye.get(r);return v||(v=new SortedSet(__PRIVATE_primitiveComparator),this.Ye=this.Ye.insert(r,v)),v}Et(r){let v=this.Je.get(r);return v||(v=new SortedSet(__PRIVATE_primitiveComparator),this.Je=this.Je.insert(r,v)),v}it(r){const v=this._t(r)!==null;return v||__PRIVATE_logDebug("WatchChangeAggregator","Detected inactive target",r),v}_t(r){const v=this.je.get(r);return v&&v.Be?null:this.ze.Rt(r)}st(r){this.je.set(r,new __PRIVATE_TargetState),this.ze.getRemoteKeysForTarget(r).forEach(v=>{this.tt(r,v,null)})}dt(r,v){return this.ze.getRemoteKeysForTarget(r).has(v)}}function __PRIVATE_documentTargetMap(){return new SortedMap(DocumentKey.comparator)}function __PRIVATE_snapshotChangesMap(){return new SortedMap(DocumentKey.comparator)}const wt={asc:"ASCENDING",desc:"DESCENDING"},St={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},bt={and:"AND",or:"OR"};class JsonProtoSerializer{constructor(r,v){this.databaseId=r,this.useProto3Json=v}}function __PRIVATE_toInt32Proto(E,r){return E.useProto3Json||__PRIVATE_isNullOrUndefined(r)?r:{value:r}}function toTimestamp(E,r){return E.useProto3Json?`${new Date(1e3*r.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+r.nanoseconds).slice(-9)}Z`:{seconds:""+r.seconds,nanos:r.nanoseconds}}function __PRIVATE_toBytes(E,r){return E.useProto3Json?r.toBase64():r.toUint8Array()}function __PRIVATE_fromVersion(E){return __PRIVATE_hardAssert(!!E,49232),SnapshotVersion.fromTimestamp(function(v){const T=__PRIVATE_normalizeTimestamp(v);return new Timestamp(T.seconds,T.nanos)}(E))}function __PRIVATE_toResourceName(E,r){return __PRIVATE_toResourcePath(E,r).canonicalString()}function __PRIVATE_toResourcePath(E,r){const v=function(w){return new ResourcePath(["projects",w.projectId,"databases",w.database])}(E).child("documents");return r===void 0?v:v.child(r)}function __PRIVATE_fromResourceName(E){const r=ResourcePath.fromString(E);return __PRIVATE_hardAssert(__PRIVATE_isValidResourceName(r),10190,{key:r.toString()}),r}function fromName(E,r){const v=__PRIVATE_fromResourceName(r);if(v.get(1)!==E.databaseId.projectId)throw new FirestoreError(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+v.get(1)+" vs "+E.databaseId.projectId);if(v.get(3)!==E.databaseId.database)throw new FirestoreError(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+v.get(3)+" vs "+E.databaseId.database);return new DocumentKey(__PRIVATE_extractLocalPathFromResourceName(v))}function __PRIVATE_toQueryPath(E,r){return __PRIVATE_toResourceName(E.databaseId,r)}function __PRIVATE_fromQueryPath(E){const r=__PRIVATE_fromResourceName(E);return r.length===4?ResourcePath.emptyPath():__PRIVATE_extractLocalPathFromResourceName(r)}function __PRIVATE_getEncodedDatabaseId(E){return new ResourcePath(["projects",E.databaseId.projectId,"databases",E.databaseId.database]).canonicalString()}function __PRIVATE_extractLocalPathFromResourceName(E){return __PRIVATE_hardAssert(E.length>4&&E.get(4)==="documents",29091,{key:E.toString()}),E.popFirst(5)}function __PRIVATE_fromWatchChange(E,r){let v;if("targetChange"in r){r.targetChange;const T=function(ae){return ae==="NO_CHANGE"?0:ae==="ADD"?1:ae==="REMOVE"?2:ae==="CURRENT"?3:ae==="RESET"?4:fail(39313,{state:ae})}(r.targetChange.targetChangeType||"NO_CHANGE"),w=r.targetChange.targetIds||[],S=function(ae,ie){return ae.useProto3Json?(__PRIVATE_hardAssert(ie===void 0||typeof ie=="string",58123),ByteString.fromBase64String(ie||"")):(__PRIVATE_hardAssert(ie===void 0||ie instanceof Buffer||ie instanceof Uint8Array,16193),ByteString.fromUint8Array(ie||new Uint8Array))}(E,r.targetChange.resumeToken),I=r.targetChange.cause,H=I&&function(ae){const ie=ae.code===void 0?N.UNKNOWN:__PRIVATE_mapCodeFromRpcCode(ae.code);return new FirestoreError(ie,ae.message||"")}(I);v=new __PRIVATE_WatchTargetChange(T,w,S,H||null)}else if("documentChange"in r){r.documentChange;const T=r.documentChange;T.document,T.document.name,T.document.updateTime;const w=fromName(E,T.document.name),S=__PRIVATE_fromVersion(T.document.updateTime),I=T.document.createTime?__PRIVATE_fromVersion(T.document.createTime):SnapshotVersion.min(),H=new ObjectValue({mapValue:{fields:T.document.fields}}),te=MutableDocument.newFoundDocument(w,S,I,H),ae=T.targetIds||[],ie=T.removedTargetIds||[];v=new __PRIVATE_DocumentWatchChange(ae,ie,te.key,te)}else if("documentDelete"in r){r.documentDelete;const T=r.documentDelete;T.document;const w=fromName(E,T.document),S=T.readTime?__PRIVATE_fromVersion(T.readTime):SnapshotVersion.min(),I=MutableDocument.newNoDocument(w,S),H=T.removedTargetIds||[];v=new __PRIVATE_DocumentWatchChange([],H,I.key,I)}else if("documentRemove"in r){r.documentRemove;const T=r.documentRemove;T.document;const w=fromName(E,T.document),S=T.removedTargetIds||[];v=new __PRIVATE_DocumentWatchChange([],S,w,null)}else{if(!("filter"in r))return fail(11601,{Vt:r});{r.filter;const T=r.filter;T.targetId;const{count:w=0,unchangedNames:S}=T,I=new ExistenceFilter(w,S),H=T.targetId;v=new __PRIVATE_ExistenceFilterChange(H,I)}}return v}function __PRIVATE_toDocumentsTarget(E,r){return{documents:[__PRIVATE_toQueryPath(E,r.path)]}}function __PRIVATE_toQueryTarget(E,r){const v={structuredQuery:{}},T=r.path;let w;r.collectionGroup!==null?(w=T,v.structuredQuery.from=[{collectionId:r.collectionGroup,allDescendants:!0}]):(w=T.popLast(),v.structuredQuery.from=[{collectionId:T.lastSegment()}]),v.parent=__PRIVATE_toQueryPath(E,w);const S=function(ae){if(ae.length!==0)return __PRIVATE_toFilter(CompositeFilter.create(ae,"and"))}(r.filters);S&&(v.structuredQuery.where=S);const I=function(ae){if(ae.length!==0)return ae.map(ie=>function(me){return{field:__PRIVATE_toFieldPathReference(me.field),direction:__PRIVATE_toDirection(me.dir)}}(ie))}(r.orderBy);I&&(v.structuredQuery.orderBy=I);const H=__PRIVATE_toInt32Proto(E,r.limit);return H!==null&&(v.structuredQuery.limit=H),r.startAt&&(v.structuredQuery.startAt=function(ae){return{before:ae.inclusive,values:ae.position}}(r.startAt)),r.endAt&&(v.structuredQuery.endAt=function(ae){return{before:!ae.inclusive,values:ae.position}}(r.endAt)),{gt:v,parent:w}}function __PRIVATE_convertQueryTargetToQuery(E){let r=__PRIVATE_fromQueryPath(E.parent);const v=E.structuredQuery,T=v.from?v.from.length:0;let w=null;if(T>0){__PRIVATE_hardAssert(T===1,65062);const ie=v.from[0];ie.allDescendants?w=ie.collectionId:r=r.child(ie.collectionId)}let S=[];v.where&&(S=function(ce){const me=__PRIVATE_fromFilter(ce);return me instanceof CompositeFilter&&__PRIVATE_compositeFilterIsFlatConjunction(me)?me.getFilters():[me]}(v.where));let I=[];v.orderBy&&(I=function(ce){return ce.map(me=>function(Re){return new OrderBy(__PRIVATE_fromFieldPathReference(Re.field),function(Ce){switch(Ce){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(Re.direction))}(me))}(v.orderBy));let H=null;v.limit&&(H=function(ce){let me;return me=typeof ce=="object"?ce.value:ce,__PRIVATE_isNullOrUndefined(me)?null:me}(v.limit));let te=null;v.startAt&&(te=function(ce){const me=!!ce.before,_e=ce.values||[];return new Bound(_e,me)}(v.startAt));let ae=null;return v.endAt&&(ae=function(ce){const me=!ce.before,_e=ce.values||[];return new Bound(_e,me)}(v.endAt)),__PRIVATE_newQuery(r,w,I,S,H,"F",te,ae)}function __PRIVATE_toListenRequestLabels(E,r){const v=function(w){switch(w){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return fail(28987,{purpose:w})}}(r.purpose);return v==null?null:{"goog-listen-tags":v}}function __PRIVATE_fromFilter(E){return E.unaryFilter!==void 0?function(v){switch(v.unaryFilter.op){case"IS_NAN":const T=__PRIVATE_fromFieldPathReference(v.unaryFilter.field);return FieldFilter.create(T,"==",{doubleValue:NaN});case"IS_NULL":const w=__PRIVATE_fromFieldPathReference(v.unaryFilter.field);return FieldFilter.create(w,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const S=__PRIVATE_fromFieldPathReference(v.unaryFilter.field);return FieldFilter.create(S,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const I=__PRIVATE_fromFieldPathReference(v.unaryFilter.field);return FieldFilter.create(I,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return fail(61313);default:return fail(60726)}}(E):E.fieldFilter!==void 0?function(v){return FieldFilter.create(__PRIVATE_fromFieldPathReference(v.fieldFilter.field),function(w){switch(w){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return fail(58110);default:return fail(50506)}}(v.fieldFilter.op),v.fieldFilter.value)}(E):E.compositeFilter!==void 0?function(v){return CompositeFilter.create(v.compositeFilter.filters.map(T=>__PRIVATE_fromFilter(T)),function(w){switch(w){case"AND":return"and";case"OR":return"or";default:return fail(1026)}}(v.compositeFilter.op))}(E):fail(30097,{filter:E})}function __PRIVATE_toDirection(E){return wt[E]}function __PRIVATE_toOperatorName(E){return St[E]}function __PRIVATE_toCompositeOperatorName(E){return bt[E]}function __PRIVATE_toFieldPathReference(E){return{fieldPath:E.canonicalString()}}function __PRIVATE_fromFieldPathReference(E){return FieldPath$1.fromServerFormat(E.fieldPath)}function __PRIVATE_toFilter(E){return E instanceof FieldFilter?function(v){if(v.op==="=="){if(__PRIVATE_isNanValue(v.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(v.field),op:"IS_NAN"}};if(__PRIVATE_isNullValue(v.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(v.field),op:"IS_NULL"}}}else if(v.op==="!="){if(__PRIVATE_isNanValue(v.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(v.field),op:"IS_NOT_NAN"}};if(__PRIVATE_isNullValue(v.value))return{unaryFilter:{field:__PRIVATE_toFieldPathReference(v.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:__PRIVATE_toFieldPathReference(v.field),op:__PRIVATE_toOperatorName(v.op),value:v.value}}}(E):E instanceof CompositeFilter?function(v){const T=v.getFilters().map(w=>__PRIVATE_toFilter(w));return T.length===1?T[0]:{compositeFilter:{op:__PRIVATE_toCompositeOperatorName(v.op),filters:T}}}(E):fail(54877,{filter:E})}function __PRIVATE_isValidResourceName(E){return E.length>=4&&E.get(0)==="projects"&&E.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TargetData{constructor(r,v,T,w,S=SnapshotVersion.min(),I=SnapshotVersion.min(),H=ByteString.EMPTY_BYTE_STRING,te=null){this.target=r,this.targetId=v,this.purpose=T,this.sequenceNumber=w,this.snapshotVersion=S,this.lastLimboFreeSnapshotVersion=I,this.resumeToken=H,this.expectedCount=te}withSequenceNumber(r){return new TargetData(this.target,this.targetId,this.purpose,r,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(r,v){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,v,this.lastLimboFreeSnapshotVersion,r,null)}withExpectedCount(r){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,r)}withLastLimboFreeSnapshotVersion(r){return new TargetData(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,r,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_LocalSerializer{constructor(r){this.wt=r}}function __PRIVATE_fromBundledQuery(E){const r=__PRIVATE_convertQueryTargetToQuery({parent:E.parent,structuredQuery:E.structuredQuery});return E.limitType==="LAST"?__PRIVATE_queryWithLimit(r,r.limit,"L"):r}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryIndexManager{constructor(){this.Cn=new __PRIVATE_MemoryCollectionParentIndex}addToCollectionParentIndex(r,v){return this.Cn.add(v),PersistencePromise.resolve()}getCollectionParents(r,v){return PersistencePromise.resolve(this.Cn.getEntries(v))}addFieldIndex(r,v){return PersistencePromise.resolve()}deleteFieldIndex(r,v){return PersistencePromise.resolve()}deleteAllFieldIndexes(r){return PersistencePromise.resolve()}createTargetIndexes(r,v){return PersistencePromise.resolve()}getDocumentsMatchingTarget(r,v){return PersistencePromise.resolve(null)}getIndexType(r,v){return PersistencePromise.resolve(0)}getFieldIndexes(r,v){return PersistencePromise.resolve([])}getNextCollectionGroupToUpdate(r){return PersistencePromise.resolve(null)}getMinOffset(r,v){return PersistencePromise.resolve(IndexOffset.min())}getMinOffsetFromCollectionGroup(r,v){return PersistencePromise.resolve(IndexOffset.min())}updateCollectionGroup(r,v,T){return PersistencePromise.resolve()}updateIndexEntries(r,v){return PersistencePromise.resolve()}}class __PRIVATE_MemoryCollectionParentIndex{constructor(){this.index={}}add(r){const v=r.lastSegment(),T=r.popLast(),w=this.index[v]||new SortedSet(ResourcePath.comparator),S=!w.has(T);return this.index[v]=w.add(T),S}has(r){const v=r.lastSegment(),T=r.popLast(),w=this.index[v];return w&&w.has(T)}getEntries(r){return(this.index[r]||new SortedSet(ResourcePath.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ft={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Mt=41943040;class LruParams{static withCacheSize(r){return new LruParams(r,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(r,v,T){this.cacheSizeCollectionThreshold=r,this.percentileToCollect=v,this.maximumSequenceNumbersToCollect=T}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */LruParams.DEFAULT_COLLECTION_PERCENTILE=10,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,LruParams.DEFAULT=new LruParams(Mt,LruParams.DEFAULT_COLLECTION_PERCENTILE,LruParams.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),LruParams.DISABLED=new LruParams(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_TargetIdGenerator{constructor(r){this.ur=r}next(){return this.ur+=2,this.ur}static cr(){return new __PRIVATE_TargetIdGenerator(0)}static lr(){return new __PRIVATE_TargetIdGenerator(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xt="LruGarbageCollector",Ot=1048576;function __PRIVATE_bufferEntryComparator([E,r],[v,T]){const w=__PRIVATE_primitiveComparator(E,v);return w===0?__PRIVATE_primitiveComparator(r,T):w}class __PRIVATE_RollingSequenceNumberBuffer{constructor(r){this.Er=r,this.buffer=new SortedSet(__PRIVATE_bufferEntryComparator),this.dr=0}Ar(){return++this.dr}Rr(r){const v=[r,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(v);else{const T=this.buffer.last();__PRIVATE_bufferEntryComparator(v,T)<0&&(this.buffer=this.buffer.delete(T).add(v))}}get maxValue(){return this.buffer.last()[0]}}class __PRIVATE_LruScheduler{constructor(r,v,T){this.garbageCollector=r,this.asyncQueue=v,this.localStore=T,this.Vr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return this.Vr!==null}mr(r){__PRIVATE_logDebug(xt,`Garbage collection scheduled in ${r}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(v){__PRIVATE_isIndexedDbTransactionError(v)?__PRIVATE_logDebug(xt,"Ignoring IndexedDB error during garbage collection: ",v):await __PRIVATE_ignoreIfPrimaryLeaseLoss(v)}await this.mr(3e5)})}}class __PRIVATE_LruGarbageCollectorImpl{constructor(r,v){this.gr=r,this.params=v}calculateTargetCount(r,v){return this.gr.pr(r).next(T=>Math.floor(v/100*T))}nthSequenceNumber(r,v){if(v===0)return PersistencePromise.resolve(__PRIVATE_ListenSequence.le);const T=new __PRIVATE_RollingSequenceNumberBuffer(v);return this.gr.forEachTarget(r,w=>T.Rr(w.sequenceNumber)).next(()=>this.gr.yr(r,w=>T.Rr(w))).next(()=>T.maxValue)}removeTargets(r,v,T){return this.gr.removeTargets(r,v,T)}removeOrphanedDocuments(r,v){return this.gr.removeOrphanedDocuments(r,v)}collect(r,v){return this.params.cacheSizeCollectionThreshold===-1?(__PRIVATE_logDebug("LruGarbageCollector","Garbage collection skipped; disabled"),PersistencePromise.resolve(Ft)):this.getCacheSize(r).next(T=>T<this.params.cacheSizeCollectionThreshold?(__PRIVATE_logDebug("LruGarbageCollector",`Garbage collection skipped; Cache size ${T} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ft):this.wr(r,v))}getCacheSize(r){return this.gr.getCacheSize(r)}wr(r,v){let T,w,S,I,H,te,ae;const ie=Date.now();return this.calculateTargetCount(r,this.params.percentileToCollect).next(ce=>(ce>this.params.maximumSequenceNumbersToCollect?(__PRIVATE_logDebug("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${ce}`),w=this.params.maximumSequenceNumbersToCollect):w=ce,I=Date.now(),this.nthSequenceNumber(r,w))).next(ce=>(T=ce,H=Date.now(),this.removeTargets(r,T,v))).next(ce=>(S=ce,te=Date.now(),this.removeOrphanedDocuments(r,T))).next(ce=>(ae=Date.now(),__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${I-ie}ms
	Determined least recently used ${w} in `+(H-I)+`ms
	Removed ${S} targets in `+(te-H)+`ms
	Removed ${ce} documents in `+(ae-te)+`ms
Total Duration: ${ae-ie}ms`),PersistencePromise.resolve({didRun:!0,sequenceNumbersCollected:w,targetsRemoved:S,documentsRemoved:ce})))}}function __PRIVATE_newLruGarbageCollector(E,r){return new __PRIVATE_LruGarbageCollectorImpl(E,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RemoteDocumentChangeBuffer{constructor(){this.changes=new ObjectMap(r=>r.toString(),(r,v)=>r.isEqual(v)),this.changesApplied=!1}addEntry(r){this.assertNotApplied(),this.changes.set(r.key,r)}removeEntry(r,v){this.assertNotApplied(),this.changes.set(r,MutableDocument.newInvalidDocument(r).setReadTime(v))}getEntry(r,v){this.assertNotApplied();const T=this.changes.get(v);return T!==void 0?PersistencePromise.resolve(T):this.getFromCache(r,v)}getEntries(r,v){return this.getAllFromCache(r,v)}apply(r){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(r)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OverlayedDocument{constructor(r,v){this.overlayedDocument=r,this.mutatedFields=v}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LocalDocumentsView{constructor(r,v,T,w){this.remoteDocumentCache=r,this.mutationQueue=v,this.documentOverlayCache=T,this.indexManager=w}getDocument(r,v){let T=null;return this.documentOverlayCache.getOverlay(r,v).next(w=>(T=w,this.remoteDocumentCache.getEntry(r,v))).next(w=>(T!==null&&__PRIVATE_mutationApplyToLocalView(T.mutation,w,FieldMask.empty(),Timestamp.now()),w))}getDocuments(r,v){return this.remoteDocumentCache.getEntries(r,v).next(T=>this.getLocalViewOfDocuments(r,T,__PRIVATE_documentKeySet()).next(()=>T))}getLocalViewOfDocuments(r,v,T=__PRIVATE_documentKeySet()){const w=__PRIVATE_newOverlayMap();return this.populateOverlays(r,w,v).next(()=>this.computeViews(r,v,w,T).next(S=>{let I=documentMap();return S.forEach((H,te)=>{I=I.insert(H,te.overlayedDocument)}),I}))}getOverlayedDocuments(r,v){const T=__PRIVATE_newOverlayMap();return this.populateOverlays(r,T,v).next(()=>this.computeViews(r,v,T,__PRIVATE_documentKeySet()))}populateOverlays(r,v,T){const w=[];return T.forEach(S=>{v.has(S)||w.push(S)}),this.documentOverlayCache.getOverlays(r,w).next(S=>{S.forEach((I,H)=>{v.set(I,H)})})}computeViews(r,v,T,w){let S=__PRIVATE_mutableDocumentMap();const I=__PRIVATE_newDocumentKeyMap(),H=function(){return __PRIVATE_newDocumentKeyMap()}();return v.forEach((te,ae)=>{const ie=T.get(ae.key);w.has(ae.key)&&(ie===void 0||ie.mutation instanceof __PRIVATE_PatchMutation)?S=S.insert(ae.key,ae):ie!==void 0?(I.set(ae.key,ie.mutation.getFieldMask()),__PRIVATE_mutationApplyToLocalView(ie.mutation,ae,ie.mutation.getFieldMask(),Timestamp.now())):I.set(ae.key,FieldMask.empty())}),this.recalculateAndSaveOverlays(r,S).next(te=>(te.forEach((ae,ie)=>I.set(ae,ie)),v.forEach((ae,ie)=>{var ce;return H.set(ae,new OverlayedDocument(ie,(ce=I.get(ae))!==null&&ce!==void 0?ce:null))}),H))}recalculateAndSaveOverlays(r,v){const T=__PRIVATE_newDocumentKeyMap();let w=new SortedMap((I,H)=>I-H),S=__PRIVATE_documentKeySet();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(r,v).next(I=>{for(const H of I)H.keys().forEach(te=>{const ae=v.get(te);if(ae===null)return;let ie=T.get(te)||FieldMask.empty();ie=H.applyToLocalView(ae,ie),T.set(te,ie);const ce=(w.get(H.batchId)||__PRIVATE_documentKeySet()).add(te);w=w.insert(H.batchId,ce)})}).next(()=>{const I=[],H=w.getReverseIterator();for(;H.hasNext();){const te=H.getNext(),ae=te.key,ie=te.value,ce=__PRIVATE_newMutationMap();ie.forEach(me=>{if(!S.has(me)){const _e=__PRIVATE_calculateOverlayMutation(v.get(me),T.get(me));_e!==null&&ce.set(me,_e),S=S.add(me)}}),I.push(this.documentOverlayCache.saveOverlays(r,ae,ce))}return PersistencePromise.waitFor(I)}).next(()=>T)}recalculateAndSaveOverlaysForDocumentKeys(r,v){return this.remoteDocumentCache.getEntries(r,v).next(T=>this.recalculateAndSaveOverlays(r,T))}getDocumentsMatchingQuery(r,v,T,w){return function(I){return DocumentKey.isDocumentKey(I.path)&&I.collectionGroup===null&&I.filters.length===0}(v)?this.getDocumentsMatchingDocumentQuery(r,v.path):__PRIVATE_isCollectionGroupQuery(v)?this.getDocumentsMatchingCollectionGroupQuery(r,v,T,w):this.getDocumentsMatchingCollectionQuery(r,v,T,w)}getNextDocuments(r,v,T,w){return this.remoteDocumentCache.getAllFromCollectionGroup(r,v,T,w).next(S=>{const I=w-S.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(r,v,T.largestBatchId,w-S.size):PersistencePromise.resolve(__PRIVATE_newOverlayMap());let H=Q,te=S;return I.next(ae=>PersistencePromise.forEach(ae,(ie,ce)=>(H<ce.largestBatchId&&(H=ce.largestBatchId),S.get(ie)?PersistencePromise.resolve():this.remoteDocumentCache.getEntry(r,ie).next(me=>{te=te.insert(ie,me)}))).next(()=>this.populateOverlays(r,ae,S)).next(()=>this.computeViews(r,te,ae,__PRIVATE_documentKeySet())).next(ie=>({batchId:H,changes:__PRIVATE_convertOverlayedDocumentMapToDocumentMap(ie)})))})}getDocumentsMatchingDocumentQuery(r,v){return this.getDocument(r,new DocumentKey(v)).next(T=>{let w=documentMap();return T.isFoundDocument()&&(w=w.insert(T.key,T)),w})}getDocumentsMatchingCollectionGroupQuery(r,v,T,w){const S=v.collectionGroup;let I=documentMap();return this.indexManager.getCollectionParents(r,S).next(H=>PersistencePromise.forEach(H,te=>{const ae=function(ce,me){return new __PRIVATE_QueryImpl(me,null,ce.explicitOrderBy.slice(),ce.filters.slice(),ce.limit,ce.limitType,ce.startAt,ce.endAt)}(v,te.child(S));return this.getDocumentsMatchingCollectionQuery(r,ae,T,w).next(ie=>{ie.forEach((ce,me)=>{I=I.insert(ce,me)})})}).next(()=>I))}getDocumentsMatchingCollectionQuery(r,v,T,w){let S;return this.documentOverlayCache.getOverlaysForCollection(r,v.path,T.largestBatchId).next(I=>(S=I,this.remoteDocumentCache.getDocumentsMatchingQuery(r,v,T,S,w))).next(I=>{S.forEach((te,ae)=>{const ie=ae.getKey();I.get(ie)===null&&(I=I.insert(ie,MutableDocument.newInvalidDocument(ie)))});let H=documentMap();return I.forEach((te,ae)=>{const ie=S.get(te);ie!==void 0&&__PRIVATE_mutationApplyToLocalView(ie.mutation,ae,FieldMask.empty(),Timestamp.now()),__PRIVATE_queryMatches(v,ae)&&(H=H.insert(te,ae))}),H})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryBundleCache{constructor(r){this.serializer=r,this.kr=new Map,this.qr=new Map}getBundleMetadata(r,v){return PersistencePromise.resolve(this.kr.get(v))}saveBundleMetadata(r,v){return this.kr.set(v.id,function(w){return{id:w.id,version:w.version,createTime:__PRIVATE_fromVersion(w.createTime)}}(v)),PersistencePromise.resolve()}getNamedQuery(r,v){return PersistencePromise.resolve(this.qr.get(v))}saveNamedQuery(r,v){return this.qr.set(v.name,function(w){return{name:w.name,query:__PRIVATE_fromBundledQuery(w.bundledQuery),readTime:__PRIVATE_fromVersion(w.readTime)}}(v)),PersistencePromise.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryDocumentOverlayCache{constructor(){this.overlays=new SortedMap(DocumentKey.comparator),this.Qr=new Map}getOverlay(r,v){return PersistencePromise.resolve(this.overlays.get(v))}getOverlays(r,v){const T=__PRIVATE_newOverlayMap();return PersistencePromise.forEach(v,w=>this.getOverlay(r,w).next(S=>{S!==null&&T.set(w,S)})).next(()=>T)}saveOverlays(r,v,T){return T.forEach((w,S)=>{this.bt(r,v,S)}),PersistencePromise.resolve()}removeOverlaysForBatchId(r,v,T){const w=this.Qr.get(T);return w!==void 0&&(w.forEach(S=>this.overlays=this.overlays.remove(S)),this.Qr.delete(T)),PersistencePromise.resolve()}getOverlaysForCollection(r,v,T){const w=__PRIVATE_newOverlayMap(),S=v.length+1,I=new DocumentKey(v.child("")),H=this.overlays.getIteratorFrom(I);for(;H.hasNext();){const te=H.getNext().value,ae=te.getKey();if(!v.isPrefixOf(ae.path))break;ae.path.length===S&&te.largestBatchId>T&&w.set(te.getKey(),te)}return PersistencePromise.resolve(w)}getOverlaysForCollectionGroup(r,v,T,w){let S=new SortedMap((ae,ie)=>ae-ie);const I=this.overlays.getIterator();for(;I.hasNext();){const ae=I.getNext().value;if(ae.getKey().getCollectionGroup()===v&&ae.largestBatchId>T){let ie=S.get(ae.largestBatchId);ie===null&&(ie=__PRIVATE_newOverlayMap(),S=S.insert(ae.largestBatchId,ie)),ie.set(ae.getKey(),ae)}}const H=__PRIVATE_newOverlayMap(),te=S.getIterator();for(;te.hasNext()&&(te.getNext().value.forEach((ae,ie)=>H.set(ae,ie)),!(H.size()>=w)););return PersistencePromise.resolve(H)}bt(r,v,T){const w=this.overlays.get(T.key);if(w!==null){const I=this.Qr.get(w.largestBatchId).delete(T.key);this.Qr.set(w.largestBatchId,I)}this.overlays=this.overlays.insert(T.key,new Overlay(v,T));let S=this.Qr.get(v);S===void 0&&(S=__PRIVATE_documentKeySet(),this.Qr.set(v,S)),this.Qr.set(v,S.add(T.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryGlobalsCache{constructor(){this.sessionToken=ByteString.EMPTY_BYTE_STRING}getSessionToken(r){return PersistencePromise.resolve(this.sessionToken)}setSessionToken(r,v){return this.sessionToken=v,PersistencePromise.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_ReferenceSet{constructor(){this.$r=new SortedSet(__PRIVATE_DocReference.Ur),this.Kr=new SortedSet(__PRIVATE_DocReference.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(r,v){const T=new __PRIVATE_DocReference(r,v);this.$r=this.$r.add(T),this.Kr=this.Kr.add(T)}Gr(r,v){r.forEach(T=>this.addReference(T,v))}removeReference(r,v){this.zr(new __PRIVATE_DocReference(r,v))}jr(r,v){r.forEach(T=>this.removeReference(T,v))}Hr(r){const v=new DocumentKey(new ResourcePath([])),T=new __PRIVATE_DocReference(v,r),w=new __PRIVATE_DocReference(v,r+1),S=[];return this.Kr.forEachInRange([T,w],I=>{this.zr(I),S.push(I.key)}),S}Jr(){this.$r.forEach(r=>this.zr(r))}zr(r){this.$r=this.$r.delete(r),this.Kr=this.Kr.delete(r)}Yr(r){const v=new DocumentKey(new ResourcePath([])),T=new __PRIVATE_DocReference(v,r),w=new __PRIVATE_DocReference(v,r+1);let S=__PRIVATE_documentKeySet();return this.Kr.forEachInRange([T,w],I=>{S=S.add(I.key)}),S}containsKey(r){const v=new __PRIVATE_DocReference(r,0),T=this.$r.firstAfterOrEqual(v);return T!==null&&r.isEqual(T.key)}}class __PRIVATE_DocReference{constructor(r,v){this.key=r,this.Zr=v}static Ur(r,v){return DocumentKey.comparator(r.key,v.key)||__PRIVATE_primitiveComparator(r.Zr,v.Zr)}static Wr(r,v){return __PRIVATE_primitiveComparator(r.Zr,v.Zr)||DocumentKey.comparator(r.key,v.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryMutationQueue{constructor(r,v){this.indexManager=r,this.referenceDelegate=v,this.mutationQueue=[],this.nr=1,this.Xr=new SortedSet(__PRIVATE_DocReference.Ur)}checkEmpty(r){return PersistencePromise.resolve(this.mutationQueue.length===0)}addMutationBatch(r,v,T,w){const S=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const I=new MutationBatch(S,v,T,w);this.mutationQueue.push(I);for(const H of w)this.Xr=this.Xr.add(new __PRIVATE_DocReference(H.key,S)),this.indexManager.addToCollectionParentIndex(r,H.key.path.popLast());return PersistencePromise.resolve(I)}lookupMutationBatch(r,v){return PersistencePromise.resolve(this.ei(v))}getNextMutationBatchAfterBatchId(r,v){const T=v+1,w=this.ti(T),S=w<0?0:w;return PersistencePromise.resolve(this.mutationQueue.length>S?this.mutationQueue[S]:null)}getHighestUnacknowledgedBatchId(){return PersistencePromise.resolve(this.mutationQueue.length===0?G:this.nr-1)}getAllMutationBatches(r){return PersistencePromise.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(r,v){const T=new __PRIVATE_DocReference(v,0),w=new __PRIVATE_DocReference(v,Number.POSITIVE_INFINITY),S=[];return this.Xr.forEachInRange([T,w],I=>{const H=this.ei(I.Zr);S.push(H)}),PersistencePromise.resolve(S)}getAllMutationBatchesAffectingDocumentKeys(r,v){let T=new SortedSet(__PRIVATE_primitiveComparator);return v.forEach(w=>{const S=new __PRIVATE_DocReference(w,0),I=new __PRIVATE_DocReference(w,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([S,I],H=>{T=T.add(H.Zr)})}),PersistencePromise.resolve(this.ni(T))}getAllMutationBatchesAffectingQuery(r,v){const T=v.path,w=T.length+1;let S=T;DocumentKey.isDocumentKey(S)||(S=S.child(""));const I=new __PRIVATE_DocReference(new DocumentKey(S),0);let H=new SortedSet(__PRIVATE_primitiveComparator);return this.Xr.forEachWhile(te=>{const ae=te.key.path;return!!T.isPrefixOf(ae)&&(ae.length===w&&(H=H.add(te.Zr)),!0)},I),PersistencePromise.resolve(this.ni(H))}ni(r){const v=[];return r.forEach(T=>{const w=this.ei(T);w!==null&&v.push(w)}),v}removeMutationBatch(r,v){__PRIVATE_hardAssert(this.ri(v.batchId,"removed")===0,55003),this.mutationQueue.shift();let T=this.Xr;return PersistencePromise.forEach(v.mutations,w=>{const S=new __PRIVATE_DocReference(w.key,v.batchId);return T=T.delete(S),this.referenceDelegate.markPotentiallyOrphaned(r,w.key)}).next(()=>{this.Xr=T})}sr(r){}containsKey(r,v){const T=new __PRIVATE_DocReference(v,0),w=this.Xr.firstAfterOrEqual(T);return PersistencePromise.resolve(v.isEqual(w&&w.key))}performConsistencyCheck(r){return this.mutationQueue.length,PersistencePromise.resolve()}ri(r,v){return this.ti(r)}ti(r){return this.mutationQueue.length===0?0:r-this.mutationQueue[0].batchId}ei(r){const v=this.ti(r);return v<0||v>=this.mutationQueue.length?null:this.mutationQueue[v]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryRemoteDocumentCacheImpl{constructor(r){this.ii=r,this.docs=function(){return new SortedMap(DocumentKey.comparator)}(),this.size=0}setIndexManager(r){this.indexManager=r}addEntry(r,v){const T=v.key,w=this.docs.get(T),S=w?w.size:0,I=this.ii(v);return this.docs=this.docs.insert(T,{document:v.mutableCopy(),size:I}),this.size+=I-S,this.indexManager.addToCollectionParentIndex(r,T.path.popLast())}removeEntry(r){const v=this.docs.get(r);v&&(this.docs=this.docs.remove(r),this.size-=v.size)}getEntry(r,v){const T=this.docs.get(v);return PersistencePromise.resolve(T?T.document.mutableCopy():MutableDocument.newInvalidDocument(v))}getEntries(r,v){let T=__PRIVATE_mutableDocumentMap();return v.forEach(w=>{const S=this.docs.get(w);T=T.insert(w,S?S.document.mutableCopy():MutableDocument.newInvalidDocument(w))}),PersistencePromise.resolve(T)}getDocumentsMatchingQuery(r,v,T,w){let S=__PRIVATE_mutableDocumentMap();const I=v.path,H=new DocumentKey(I.child("__id-9223372036854775808__")),te=this.docs.getIteratorFrom(H);for(;te.hasNext();){const{key:ae,value:{document:ie}}=te.getNext();if(!I.isPrefixOf(ae.path))break;ae.path.length>I.length+1||__PRIVATE_indexOffsetComparator(__PRIVATE_newIndexOffsetFromDocument(ie),T)<=0||(w.has(ie.key)||__PRIVATE_queryMatches(v,ie))&&(S=S.insert(ie.key,ie.mutableCopy()))}return PersistencePromise.resolve(S)}getAllFromCollectionGroup(r,v,T,w){fail(9500)}si(r,v){return PersistencePromise.forEach(this.docs,T=>v(T))}newChangeBuffer(r){return new __PRIVATE_MemoryRemoteDocumentChangeBuffer(this)}getSize(r){return PersistencePromise.resolve(this.size)}}class __PRIVATE_MemoryRemoteDocumentChangeBuffer extends RemoteDocumentChangeBuffer{constructor(r){super(),this.Br=r}applyChanges(r){const v=[];return this.changes.forEach((T,w)=>{w.isValidDocument()?v.push(this.Br.addEntry(r,w)):this.Br.removeEntry(T)}),PersistencePromise.waitFor(v)}getFromCache(r,v){return this.Br.getEntry(r,v)}getAllFromCache(r,v){return this.Br.getEntries(r,v)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryTargetCache{constructor(r){this.persistence=r,this.oi=new ObjectMap(v=>__PRIVATE_canonifyTarget(v),__PRIVATE_targetEquals),this.lastRemoteSnapshotVersion=SnapshotVersion.min(),this.highestTargetId=0,this._i=0,this.ai=new __PRIVATE_ReferenceSet,this.targetCount=0,this.ui=__PRIVATE_TargetIdGenerator.cr()}forEachTarget(r,v){return this.oi.forEach((T,w)=>v(w)),PersistencePromise.resolve()}getLastRemoteSnapshotVersion(r){return PersistencePromise.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(r){return PersistencePromise.resolve(this._i)}allocateTargetId(r){return this.highestTargetId=this.ui.next(),PersistencePromise.resolve(this.highestTargetId)}setTargetsMetadata(r,v,T){return T&&(this.lastRemoteSnapshotVersion=T),v>this._i&&(this._i=v),PersistencePromise.resolve()}Tr(r){this.oi.set(r.target,r);const v=r.targetId;v>this.highestTargetId&&(this.ui=new __PRIVATE_TargetIdGenerator(v),this.highestTargetId=v),r.sequenceNumber>this._i&&(this._i=r.sequenceNumber)}addTargetData(r,v){return this.Tr(v),this.targetCount+=1,PersistencePromise.resolve()}updateTargetData(r,v){return this.Tr(v),PersistencePromise.resolve()}removeTargetData(r,v){return this.oi.delete(v.target),this.ai.Hr(v.targetId),this.targetCount-=1,PersistencePromise.resolve()}removeTargets(r,v,T){let w=0;const S=[];return this.oi.forEach((I,H)=>{H.sequenceNumber<=v&&T.get(H.targetId)===null&&(this.oi.delete(I),S.push(this.removeMatchingKeysForTargetId(r,H.targetId)),w++)}),PersistencePromise.waitFor(S).next(()=>w)}getTargetCount(r){return PersistencePromise.resolve(this.targetCount)}getTargetData(r,v){const T=this.oi.get(v)||null;return PersistencePromise.resolve(T)}addMatchingKeys(r,v,T){return this.ai.Gr(v,T),PersistencePromise.resolve()}removeMatchingKeys(r,v,T){this.ai.jr(v,T);const w=this.persistence.referenceDelegate,S=[];return w&&v.forEach(I=>{S.push(w.markPotentiallyOrphaned(r,I))}),PersistencePromise.waitFor(S)}removeMatchingKeysForTargetId(r,v){return this.ai.Hr(v),PersistencePromise.resolve()}getMatchingKeysForTargetId(r,v){const T=this.ai.Yr(v);return PersistencePromise.resolve(T)}containsKey(r,v){return PersistencePromise.resolve(this.ai.containsKey(v))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_MemoryPersistence{constructor(r,v){this.ci={},this.overlays={},this.li=new __PRIVATE_ListenSequence(0),this.hi=!1,this.hi=!0,this.Pi=new __PRIVATE_MemoryGlobalsCache,this.referenceDelegate=r(this),this.Ti=new __PRIVATE_MemoryTargetCache(this),this.indexManager=new __PRIVATE_MemoryIndexManager,this.remoteDocumentCache=function(w){return new __PRIVATE_MemoryRemoteDocumentCacheImpl(w)}(T=>this.referenceDelegate.Ii(T)),this.serializer=new __PRIVATE_LocalSerializer(v),this.Ei=new __PRIVATE_MemoryBundleCache(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(r){return this.indexManager}getDocumentOverlayCache(r){let v=this.overlays[r.toKey()];return v||(v=new __PRIVATE_MemoryDocumentOverlayCache,this.overlays[r.toKey()]=v),v}getMutationQueue(r,v){let T=this.ci[r.toKey()];return T||(T=new __PRIVATE_MemoryMutationQueue(v,this.referenceDelegate),this.ci[r.toKey()]=T),T}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(r,v,T){__PRIVATE_logDebug("MemoryPersistence","Starting transaction:",r);const w=new __PRIVATE_MemoryTransaction(this.li.next());return this.referenceDelegate.di(),T(w).next(S=>this.referenceDelegate.Ai(w).next(()=>S)).toPromise().then(S=>(w.raiseOnCommittedEvent(),S))}Ri(r,v){return PersistencePromise.or(Object.values(this.ci).map(T=>()=>T.containsKey(r,v)))}}class __PRIVATE_MemoryTransaction extends PersistenceTransaction{constructor(r){super(),this.currentSequenceNumber=r}}class __PRIVATE_MemoryEagerDelegate{constructor(r){this.persistence=r,this.Vi=new __PRIVATE_ReferenceSet,this.mi=null}static fi(r){return new __PRIVATE_MemoryEagerDelegate(r)}get gi(){if(this.mi)return this.mi;throw fail(60996)}addReference(r,v,T){return this.Vi.addReference(T,v),this.gi.delete(T.toString()),PersistencePromise.resolve()}removeReference(r,v,T){return this.Vi.removeReference(T,v),this.gi.add(T.toString()),PersistencePromise.resolve()}markPotentiallyOrphaned(r,v){return this.gi.add(v.toString()),PersistencePromise.resolve()}removeTarget(r,v){this.Vi.Hr(v.targetId).forEach(w=>this.gi.add(w.toString()));const T=this.persistence.getTargetCache();return T.getMatchingKeysForTargetId(r,v.targetId).next(w=>{w.forEach(S=>this.gi.add(S.toString()))}).next(()=>T.removeTargetData(r,v))}di(){this.mi=new Set}Ai(r){const v=this.persistence.getRemoteDocumentCache().newChangeBuffer();return PersistencePromise.forEach(this.gi,T=>{const w=DocumentKey.fromPath(T);return this.pi(r,w).next(S=>{S||v.removeEntry(w,SnapshotVersion.min())})}).next(()=>(this.mi=null,v.apply(r)))}updateLimboDocument(r,v){return this.pi(r,v).next(T=>{T?this.gi.delete(v.toString()):this.gi.add(v.toString())})}Ii(r){return 0}pi(r,v){return PersistencePromise.or([()=>PersistencePromise.resolve(this.Vi.containsKey(v)),()=>this.persistence.getTargetCache().containsKey(r,v),()=>this.persistence.Ri(r,v)])}}class __PRIVATE_MemoryLruDelegate{constructor(r,v){this.persistence=r,this.yi=new ObjectMap(T=>__PRIVATE_encodeResourcePath(T.path),(T,w)=>T.isEqual(w)),this.garbageCollector=__PRIVATE_newLruGarbageCollector(this,v)}static fi(r,v){return new __PRIVATE_MemoryLruDelegate(r,v)}di(){}Ai(r){return PersistencePromise.resolve()}forEachTarget(r,v){return this.persistence.getTargetCache().forEachTarget(r,v)}pr(r){const v=this.Sr(r);return this.persistence.getTargetCache().getTargetCount(r).next(T=>v.next(w=>T+w))}Sr(r){let v=0;return this.yr(r,T=>{v++}).next(()=>v)}yr(r,v){return PersistencePromise.forEach(this.yi,(T,w)=>this.Dr(r,T,w).next(S=>S?PersistencePromise.resolve():v(w)))}removeTargets(r,v,T){return this.persistence.getTargetCache().removeTargets(r,v,T)}removeOrphanedDocuments(r,v){let T=0;const w=this.persistence.getRemoteDocumentCache(),S=w.newChangeBuffer();return w.si(r,I=>this.Dr(r,I,v).next(H=>{H||(T++,S.removeEntry(I,SnapshotVersion.min()))})).next(()=>S.apply(r)).next(()=>T)}markPotentiallyOrphaned(r,v){return this.yi.set(v,r.currentSequenceNumber),PersistencePromise.resolve()}removeTarget(r,v){const T=v.withSequenceNumber(r.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(r,T)}addReference(r,v,T){return this.yi.set(T,r.currentSequenceNumber),PersistencePromise.resolve()}removeReference(r,v,T){return this.yi.set(T,r.currentSequenceNumber),PersistencePromise.resolve()}updateLimboDocument(r,v){return this.yi.set(v,r.currentSequenceNumber),PersistencePromise.resolve()}Ii(r){let v=r.key.toString().length;return r.isFoundDocument()&&(v+=__PRIVATE_estimateByteSize(r.data.value)),v}Dr(r,v,T){return PersistencePromise.or([()=>this.persistence.Ri(r,v),()=>this.persistence.getTargetCache().containsKey(r,v),()=>{const w=this.yi.get(v);return PersistencePromise.resolve(w!==void 0&&w>T)}])}getCacheSize(r){return this.persistence.getRemoteDocumentCache().getSize(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_LocalViewChanges{constructor(r,v,T,w){this.targetId=r,this.fromCache=v,this.ds=T,this.As=w}static Rs(r,v){let T=__PRIVATE_documentKeySet(),w=__PRIVATE_documentKeySet();for(const S of v.docChanges)switch(S.type){case 0:T=T.add(S.doc.key);break;case 1:w=w.add(S.doc.key)}return new __PRIVATE_LocalViewChanges(r,v.fromCache,T,w)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QueryContext{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(r){this._documentReadCount+=r}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_QueryEngine{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=function(){return isSafari()?8:__PRIVATE_getAndroidVersion(getUA())>0?6:4}()}initialize(r,v){this.ys=r,this.indexManager=v,this.Vs=!0}getDocumentsMatchingQuery(r,v,T,w){const S={result:null};return this.ws(r,v).next(I=>{S.result=I}).next(()=>{if(!S.result)return this.Ss(r,v,w,T).next(I=>{S.result=I})}).next(()=>{if(S.result)return;const I=new QueryContext;return this.bs(r,v,I).next(H=>{if(S.result=H,this.fs)return this.Ds(r,v,I,H.size)})}).next(()=>S.result)}Ds(r,v,T,w){return T.documentReadCount<this.gs?(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","SDK will not create cache indexes for query:",__PRIVATE_stringifyQuery(v),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),PersistencePromise.resolve()):(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Query:",__PRIVATE_stringifyQuery(v),"scans",T.documentReadCount,"local documents and returns",w,"documents as results."),T.documentReadCount>this.ps*w?(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","The SDK decides to create cache indexes for query:",__PRIVATE_stringifyQuery(v),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(r,__PRIVATE_queryToTarget(v))):PersistencePromise.resolve())}ws(r,v){if(__PRIVATE_queryMatchesAllDocuments(v))return PersistencePromise.resolve(null);let T=__PRIVATE_queryToTarget(v);return this.indexManager.getIndexType(r,T).next(w=>w===0?null:(v.limit!==null&&w===1&&(v=__PRIVATE_queryWithLimit(v,null,"F"),T=__PRIVATE_queryToTarget(v)),this.indexManager.getDocumentsMatchingTarget(r,T).next(S=>{const I=__PRIVATE_documentKeySet(...S);return this.ys.getDocuments(r,I).next(H=>this.indexManager.getMinOffset(r,T).next(te=>{const ae=this.vs(v,H);return this.Cs(v,ae,I,te.readTime)?this.ws(r,__PRIVATE_queryWithLimit(v,null,"F")):this.Fs(r,ae,v,te)}))})))}Ss(r,v,T,w){return __PRIVATE_queryMatchesAllDocuments(v)||w.isEqual(SnapshotVersion.min())?PersistencePromise.resolve(null):this.ys.getDocuments(r,T).next(S=>{const I=this.vs(v,S);return this.Cs(v,I,T,w)?PersistencePromise.resolve(null):(__PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Re-using previous result from %s to execute query: %s",w.toString(),__PRIVATE_stringifyQuery(v)),this.Fs(r,I,v,__PRIVATE_newIndexOffsetSuccessorFromReadTime(w,Q)).next(H=>H))})}vs(r,v){let T=new SortedSet(__PRIVATE_newQueryComparator(r));return v.forEach((w,S)=>{__PRIVATE_queryMatches(r,S)&&(T=T.add(S))}),T}Cs(r,v,T,w){if(r.limit===null)return!1;if(T.size!==v.size)return!0;const S=r.limitType==="F"?v.last():v.first();return!!S&&(S.hasPendingWrites||S.version.compareTo(w)>0)}bs(r,v,T){return __PRIVATE_getLogLevel()<=LogLevel.DEBUG&&__PRIVATE_logDebug("QueryEngine","Using full collection scan to execute query:",__PRIVATE_stringifyQuery(v)),this.ys.getDocumentsMatchingQuery(r,v,IndexOffset.min(),T)}Fs(r,v,T,w){return this.ys.getDocumentsMatchingQuery(r,T,w).next(S=>(v.forEach(I=>{S=S.insert(I.key,I)}),S))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qt="LocalStore",$t=3e8;class __PRIVATE_LocalStoreImpl{constructor(r,v,T,w){this.persistence=r,this.Ms=v,this.serializer=w,this.xs=new SortedMap(__PRIVATE_primitiveComparator),this.Os=new ObjectMap(S=>__PRIVATE_canonifyTarget(S),__PRIVATE_targetEquals),this.Ns=new Map,this.Bs=r.getRemoteDocumentCache(),this.Ti=r.getTargetCache(),this.Ei=r.getBundleCache(),this.Ls(T)}Ls(r){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(r),this.indexManager=this.persistence.getIndexManager(r),this.mutationQueue=this.persistence.getMutationQueue(r,this.indexManager),this.localDocuments=new LocalDocumentsView(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(r){return this.persistence.runTransaction("Collect garbage","readwrite-primary",v=>r.collect(v,this.xs))}}function __PRIVATE_newLocalStore(E,r,v,T){return new __PRIVATE_LocalStoreImpl(E,r,v,T)}async function __PRIVATE_localStoreHandleUserChange(E,r){const v=__PRIVATE_debugCast(E);return await v.persistence.runTransaction("Handle user change","readonly",T=>{let w;return v.mutationQueue.getAllMutationBatches(T).next(S=>(w=S,v.Ls(r),v.mutationQueue.getAllMutationBatches(T))).next(S=>{const I=[],H=[];let te=__PRIVATE_documentKeySet();for(const ae of w){I.push(ae.batchId);for(const ie of ae.mutations)te=te.add(ie.key)}for(const ae of S){H.push(ae.batchId);for(const ie of ae.mutations)te=te.add(ie.key)}return v.localDocuments.getDocuments(T,te).next(ae=>({ks:ae,removedBatchIds:I,addedBatchIds:H}))})})}function __PRIVATE_localStoreGetLastRemoteSnapshotVersion(E){const r=__PRIVATE_debugCast(E);return r.persistence.runTransaction("Get last remote snapshot version","readonly",v=>r.Ti.getLastRemoteSnapshotVersion(v))}function __PRIVATE_localStoreApplyRemoteEventToLocalCache(E,r){const v=__PRIVATE_debugCast(E),T=r.snapshotVersion;let w=v.xs;return v.persistence.runTransaction("Apply remote event","readwrite-primary",S=>{const I=v.Bs.newChangeBuffer({trackRemovals:!0});w=v.xs;const H=[];r.targetChanges.forEach((ie,ce)=>{const me=w.get(ce);if(!me)return;H.push(v.Ti.removeMatchingKeys(S,ie.removedDocuments,ce).next(()=>v.Ti.addMatchingKeys(S,ie.addedDocuments,ce)));let _e=me.withSequenceNumber(S.currentSequenceNumber);r.targetMismatches.get(ce)!==null?_e=_e.withResumeToken(ByteString.EMPTY_BYTE_STRING,SnapshotVersion.min()).withLastLimboFreeSnapshotVersion(SnapshotVersion.min()):ie.resumeToken.approximateByteSize()>0&&(_e=_e.withResumeToken(ie.resumeToken,T)),w=w.insert(ce,_e),function(Pe,Ce,Fe){return Pe.resumeToken.approximateByteSize()===0||Ce.snapshotVersion.toMicroseconds()-Pe.snapshotVersion.toMicroseconds()>=$t?!0:Fe.addedDocuments.size+Fe.modifiedDocuments.size+Fe.removedDocuments.size>0}(me,_e,ie)&&H.push(v.Ti.updateTargetData(S,_e))});let te=__PRIVATE_mutableDocumentMap(),ae=__PRIVATE_documentKeySet();if(r.documentUpdates.forEach(ie=>{r.resolvedLimboDocuments.has(ie)&&H.push(v.persistence.referenceDelegate.updateLimboDocument(S,ie))}),H.push(__PRIVATE_populateDocumentChangeBuffer(S,I,r.documentUpdates).next(ie=>{te=ie.qs,ae=ie.Qs})),!T.isEqual(SnapshotVersion.min())){const ie=v.Ti.getLastRemoteSnapshotVersion(S).next(ce=>v.Ti.setTargetsMetadata(S,S.currentSequenceNumber,T));H.push(ie)}return PersistencePromise.waitFor(H).next(()=>I.apply(S)).next(()=>v.localDocuments.getLocalViewOfDocuments(S,te,ae)).next(()=>te)}).then(S=>(v.xs=w,S))}function __PRIVATE_populateDocumentChangeBuffer(E,r,v){let T=__PRIVATE_documentKeySet(),w=__PRIVATE_documentKeySet();return v.forEach(S=>T=T.add(S)),r.getEntries(E,T).next(S=>{let I=__PRIVATE_mutableDocumentMap();return v.forEach((H,te)=>{const ae=S.get(H);te.isFoundDocument()!==ae.isFoundDocument()&&(w=w.add(H)),te.isNoDocument()&&te.version.isEqual(SnapshotVersion.min())?(r.removeEntry(H,te.readTime),I=I.insert(H,te)):!ae.isValidDocument()||te.version.compareTo(ae.version)>0||te.version.compareTo(ae.version)===0&&ae.hasPendingWrites?(r.addEntry(te),I=I.insert(H,te)):__PRIVATE_logDebug(Qt,"Ignoring outdated watch update for ",H,". Current version:",ae.version," Watch version:",te.version)}),{qs:I,Qs:w}})}function __PRIVATE_localStoreAllocateTarget(E,r){const v=__PRIVATE_debugCast(E);return v.persistence.runTransaction("Allocate target","readwrite",T=>{let w;return v.Ti.getTargetData(T,r).next(S=>S?(w=S,PersistencePromise.resolve(w)):v.Ti.allocateTargetId(T).next(I=>(w=new TargetData(r,I,"TargetPurposeListen",T.currentSequenceNumber),v.Ti.addTargetData(T,w).next(()=>w))))}).then(T=>{const w=v.xs.get(T.targetId);return(w===null||T.snapshotVersion.compareTo(w.snapshotVersion)>0)&&(v.xs=v.xs.insert(T.targetId,T),v.Os.set(r,T.targetId)),T})}async function __PRIVATE_localStoreReleaseTarget(E,r,v){const T=__PRIVATE_debugCast(E),w=T.xs.get(r),S=v?"readwrite":"readwrite-primary";try{v||await T.persistence.runTransaction("Release target",S,I=>T.persistence.referenceDelegate.removeTarget(I,w))}catch(I){if(!__PRIVATE_isIndexedDbTransactionError(I))throw I;__PRIVATE_logDebug(Qt,`Failed to update sequence numbers for target ${r}: ${I}`)}T.xs=T.xs.remove(r),T.Os.delete(w.target)}function __PRIVATE_localStoreExecuteQuery(E,r,v){const T=__PRIVATE_debugCast(E);let w=SnapshotVersion.min(),S=__PRIVATE_documentKeySet();return T.persistence.runTransaction("Execute query","readwrite",I=>function(te,ae,ie){const ce=__PRIVATE_debugCast(te),me=ce.Os.get(ie);return me!==void 0?PersistencePromise.resolve(ce.xs.get(me)):ce.Ti.getTargetData(ae,ie)}(T,I,__PRIVATE_queryToTarget(r)).next(H=>{if(H)return w=H.lastLimboFreeSnapshotVersion,T.Ti.getMatchingKeysForTargetId(I,H.targetId).next(te=>{S=te})}).next(()=>T.Ms.getDocumentsMatchingQuery(I,r,v?w:SnapshotVersion.min(),v?S:__PRIVATE_documentKeySet())).next(H=>(__PRIVATE_setMaxReadTime(T,__PRIVATE_queryCollectionGroup(r),H),{documents:H,$s:S})))}function __PRIVATE_setMaxReadTime(E,r,v){let T=E.Ns.get(r)||SnapshotVersion.min();v.forEach((w,S)=>{S.readTime.compareTo(T)>0&&(T=S.readTime)}),E.Ns.set(r,T)}class __PRIVATE_LocalClientState{constructor(){this.activeTargetIds=__PRIVATE_targetIdSet()}js(r){this.activeTargetIds=this.activeTargetIds.add(r)}Hs(r){this.activeTargetIds=this.activeTargetIds.delete(r)}zs(){const r={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(r)}}class __PRIVATE_MemorySharedClientState{constructor(){this.xo=new __PRIVATE_LocalClientState,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(r){}updateMutationState(r,v,T){}addLocalQueryTarget(r,v=!0){return v&&this.xo.js(r),this.Oo[r]||"not-current"}updateQueryState(r,v,T){this.Oo[r]=v}removeLocalQueryTarget(r){this.xo.Hs(r)}isLocalQueryTarget(r){return this.xo.activeTargetIds.has(r)}clearQueryState(r){delete this.Oo[r]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(r){return this.xo.activeTargetIds.has(r)}start(){return this.xo=new __PRIVATE_LocalClientState,Promise.resolve()}handleUserChange(r,v,T){}setOnlineState(r){}shutdown(){}writeSequenceNumber(r){}notifyBundleLoaded(r){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_NoopConnectivityMonitor{No(r){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zt="ConnectivityMonitor";class __PRIVATE_BrowserConnectivityMonitor{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(r){this.Qo.push(r)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){__PRIVATE_logDebug(zt,"Network connectivity changed: AVAILABLE");for(const r of this.Qo)r(0)}qo(){__PRIVATE_logDebug(zt,"Network connectivity changed: UNAVAILABLE");for(const r of this.Qo)r(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jt=null;function __PRIVATE_generateUniqueDebugId(){return jt===null?jt=function(){return 268435456+Math.round(2147483648*Math.random())}():jt++,"0x"+jt.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ht="RestConnection",Jt={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class __PRIVATE_RestConnection{get Uo(){return!1}constructor(r){this.databaseInfo=r,this.databaseId=r.databaseId;const v=r.ssl?"https":"http",T=encodeURIComponent(this.databaseId.projectId),w=encodeURIComponent(this.databaseId.database);this.Ko=v+"://"+r.host,this.Wo=`projects/${T}/databases/${w}`,this.Go=this.databaseId.database===ut?`project_id=${T}`:`project_id=${T}&database_id=${w}`}zo(r,v,T,w,S){const I=__PRIVATE_generateUniqueDebugId(),H=this.jo(r,v.toUriEncodedString());__PRIVATE_logDebug(Ht,`Sending RPC '${r}' ${I}:`,H,T);const te={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(te,w,S);const{host:ae}=new URL(H),ie=isCloudWorkstation(ae);return this.Jo(r,H,te,T,ie).then(ce=>(__PRIVATE_logDebug(Ht,`Received RPC '${r}' ${I}: `,ce),ce),ce=>{throw __PRIVATE_logWarn(Ht,`RPC '${r}' ${I} failed with error: `,ce,"url: ",H,"request:",T),ce})}Yo(r,v,T,w,S,I){return this.zo(r,v,T,w,S)}Ho(r,v,T){r["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+x}(),r["Content-Type"]="text/plain",this.databaseInfo.appId&&(r["X-Firebase-GMPID"]=this.databaseInfo.appId),v&&v.headers.forEach((w,S)=>r[S]=w),T&&T.headers.forEach((w,S)=>r[S]=w)}jo(r,v){const T=Jt[r];return`${this.Ko}/v1/${v}:${T}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_StreamBridge{constructor(r){this.Zo=r.Zo,this.Xo=r.Xo}e_(r){this.t_=r}n_(r){this.r_=r}i_(r){this.s_=r}onMessage(r){this.o_=r}close(){this.Xo()}send(r){this.Zo(r)}__(){this.t_()}a_(){this.r_()}u_(r){this.s_(r)}c_(r){this.o_(r)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yt="WebChannelConnection";class __PRIVATE_WebChannelConnection extends __PRIVATE_RestConnection{constructor(r){super(r),this.forceLongPolling=r.forceLongPolling,this.autoDetectLongPolling=r.autoDetectLongPolling,this.useFetchStreams=r.useFetchStreams,this.longPollingOptions=r.longPollingOptions}Jo(r,v,T,w,S){const I=__PRIVATE_generateUniqueDebugId();return new Promise((H,te)=>{const ae=new XhrIo;ae.setWithCredentials(!0),ae.listenOnce(EventType.COMPLETE,()=>{try{switch(ae.getLastErrorCode()){case ErrorCode.NO_ERROR:const ce=ae.getResponseJson();__PRIVATE_logDebug(Yt,`XHR for RPC '${r}' ${I} received:`,JSON.stringify(ce)),H(ce);break;case ErrorCode.TIMEOUT:__PRIVATE_logDebug(Yt,`RPC '${r}' ${I} timed out`),te(new FirestoreError(N.DEADLINE_EXCEEDED,"Request time out"));break;case ErrorCode.HTTP_ERROR:const me=ae.getStatus();if(__PRIVATE_logDebug(Yt,`RPC '${r}' ${I} failed with status:`,me,"response text:",ae.getResponseText()),me>0){let _e=ae.getResponseJson();Array.isArray(_e)&&(_e=_e[0]);const Re=_e==null?void 0:_e.error;if(Re&&Re.status&&Re.message){const Pe=function(Fe){const Me=Fe.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(Me)>=0?Me:N.UNKNOWN}(Re.status);te(new FirestoreError(Pe,Re.message))}else te(new FirestoreError(N.UNKNOWN,"Server responded with status "+ae.getStatus()))}else te(new FirestoreError(N.UNAVAILABLE,"Connection failed."));break;default:fail(9055,{l_:r,streamId:I,h_:ae.getLastErrorCode(),P_:ae.getLastError()})}}finally{__PRIVATE_logDebug(Yt,`RPC '${r}' ${I} completed.`)}});const ie=JSON.stringify(w);__PRIVATE_logDebug(Yt,`RPC '${r}' ${I} sending request:`,w),ae.send(v,"POST",ie,T,15)})}T_(r,v,T){const w=__PRIVATE_generateUniqueDebugId(),S=[this.Ko,"/","google.firestore.v1.Firestore","/",r,"/channel"],I=createWebChannelTransport(),H=getStatEventTarget(),te={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},ae=this.longPollingOptions.timeoutSeconds;ae!==void 0&&(te.longPollingTimeout=Math.round(1e3*ae)),this.useFetchStreams&&(te.useFetchStreams=!0),this.Ho(te.initMessageHeaders,v,T),te.encodeInitMessageHeaders=!0;const ie=S.join("");__PRIVATE_logDebug(Yt,`Creating RPC '${r}' stream ${w}: ${ie}`,te);const ce=I.createWebChannel(ie,te);let me=!1,_e=!1;const Re=new __PRIVATE_StreamBridge({Zo:Ce=>{_e?__PRIVATE_logDebug(Yt,`Not sending because RPC '${r}' stream ${w} is closed:`,Ce):(me||(__PRIVATE_logDebug(Yt,`Opening RPC '${r}' stream ${w} transport.`),ce.open(),me=!0),__PRIVATE_logDebug(Yt,`RPC '${r}' stream ${w} sending:`,Ce),ce.send(Ce))},Xo:()=>ce.close()}),Pe=(Ce,Fe,Me)=>{Ce.listen(Fe,Ve=>{try{Me(Ve)}catch(We){setTimeout(()=>{throw We},0)}})};return Pe(ce,WebChannel.EventType.OPEN,()=>{_e||(__PRIVATE_logDebug(Yt,`RPC '${r}' stream ${w} transport opened.`),Re.__())}),Pe(ce,WebChannel.EventType.CLOSE,()=>{_e||(_e=!0,__PRIVATE_logDebug(Yt,`RPC '${r}' stream ${w} transport closed`),Re.u_())}),Pe(ce,WebChannel.EventType.ERROR,Ce=>{_e||(_e=!0,__PRIVATE_logWarn(Yt,`RPC '${r}' stream ${w} transport errored. Name:`,Ce.name,"Message:",Ce.message),Re.u_(new FirestoreError(N.UNAVAILABLE,"The operation could not be completed")))}),Pe(ce,WebChannel.EventType.MESSAGE,Ce=>{var Fe;if(!_e){const Me=Ce.data[0];__PRIVATE_hardAssert(!!Me,16349);const Ve=Me,We=(Ve==null?void 0:Ve.error)||((Fe=Ve[0])===null||Fe===void 0?void 0:Fe.error);if(We){__PRIVATE_logDebug(Yt,`RPC '${r}' stream ${w} received error:`,We);const ze=We.status;let Ue=function(Ne){const Ge=ft[Ne];if(Ge!==void 0)return __PRIVATE_mapCodeFromRpcCode(Ge)}(ze),je=We.message;Ue===void 0&&(Ue=N.INTERNAL,je="Unknown error status: "+ze+" with message "+We.message),_e=!0,Re.u_(new FirestoreError(Ue,je)),ce.close()}else __PRIVATE_logDebug(Yt,`RPC '${r}' stream ${w} received:`,Me),Re.c_(Me)}}),Pe(H,Event$1.STAT_EVENT,Ce=>{Ce.stat===Stat.PROXY?__PRIVATE_logDebug(Yt,`RPC '${r}' stream ${w} detected buffering proxy`):Ce.stat===Stat.NOPROXY&&__PRIVATE_logDebug(Yt,`RPC '${r}' stream ${w} detected no buffering proxy`)}),setTimeout(()=>{Re.a_()},0),Re}}function getDocument(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_newSerializer(E){return new JsonProtoSerializer(E,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_ExponentialBackoff{constructor(r,v,T=1e3,w=1.5,S=6e4){this.xi=r,this.timerId=v,this.I_=T,this.E_=w,this.d_=S,this.A_=0,this.R_=null,this.V_=Date.now(),this.reset()}reset(){this.A_=0}m_(){this.A_=this.d_}f_(r){this.cancel();const v=Math.floor(this.A_+this.g_()),T=Math.max(0,Date.now()-this.V_),w=Math.max(0,v-T);w>0&&__PRIVATE_logDebug("ExponentialBackoff",`Backing off for ${w} ms (base delay: ${this.A_} ms, delay with jitter: ${v} ms, last attempt: ${T} ms ago)`),this.R_=this.xi.enqueueAfterDelay(this.timerId,w,()=>(this.V_=Date.now(),r())),this.A_*=this.E_,this.A_<this.I_&&(this.A_=this.I_),this.A_>this.d_&&(this.A_=this.d_)}p_(){this.R_!==null&&(this.R_.skipDelay(),this.R_=null)}cancel(){this.R_!==null&&(this.R_.cancel(),this.R_=null)}g_(){return(Math.random()-.5)*this.A_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zt="PersistentStream";class __PRIVATE_PersistentStream{constructor(r,v,T,w,S,I,H,te){this.xi=r,this.y_=T,this.w_=w,this.connection=S,this.authCredentialsProvider=I,this.appCheckCredentialsProvider=H,this.listener=te,this.state=0,this.S_=0,this.b_=null,this.D_=null,this.stream=null,this.v_=0,this.C_=new __PRIVATE_ExponentialBackoff(r,v)}F_(){return this.state===1||this.state===5||this.M_()}M_(){return this.state===2||this.state===3}start(){this.v_=0,this.state!==4?this.auth():this.x_()}async stop(){this.F_()&&await this.close(0)}O_(){this.state=0,this.C_.reset()}N_(){this.M_()&&this.b_===null&&(this.b_=this.xi.enqueueAfterDelay(this.y_,6e4,()=>this.B_()))}L_(r){this.k_(),this.stream.send(r)}async B_(){if(this.M_())return this.close(0)}k_(){this.b_&&(this.b_.cancel(),this.b_=null)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}async close(r,v){this.k_(),this.q_(),this.C_.cancel(),this.S_++,r!==4?this.C_.reset():v&&v.code===N.RESOURCE_EXHAUSTED?(__PRIVATE_logError(v.toString()),__PRIVATE_logError("Using maximum backoff delay to prevent overloading the backend."),this.C_.m_()):v&&v.code===N.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Q_(),this.stream.close(),this.stream=null),this.state=r,await this.listener.i_(v)}Q_(){}auth(){this.state=1;const r=this.U_(this.S_),v=this.S_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([T,w])=>{this.S_===v&&this.K_(T,w)},T=>{r(()=>{const w=new FirestoreError(N.UNKNOWN,"Fetching auth token failed: "+T.message);return this.W_(w)})})}K_(r,v){const T=this.U_(this.S_);this.stream=this.G_(r,v),this.stream.e_(()=>{T(()=>this.listener.e_())}),this.stream.n_(()=>{T(()=>(this.state=2,this.D_=this.xi.enqueueAfterDelay(this.w_,1e4,()=>(this.M_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(w=>{T(()=>this.W_(w))}),this.stream.onMessage(w=>{T(()=>++this.v_==1?this.z_(w):this.onNext(w))})}x_(){this.state=5,this.C_.f_(async()=>{this.state=0,this.start()})}W_(r){return __PRIVATE_logDebug(Zt,`close with error: ${r}`),this.stream=null,this.close(4,r)}U_(r){return v=>{this.xi.enqueueAndForget(()=>this.S_===r?v():(__PRIVATE_logDebug(Zt,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class __PRIVATE_PersistentListenStream extends __PRIVATE_PersistentStream{constructor(r,v,T,w,S,I){super(r,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",v,T,w,I),this.serializer=S}G_(r,v){return this.connection.T_("Listen",r,v)}z_(r){return this.onNext(r)}onNext(r){this.C_.reset();const v=__PRIVATE_fromWatchChange(this.serializer,r),T=function(S){if(!("targetChange"in S))return SnapshotVersion.min();const I=S.targetChange;return I.targetIds&&I.targetIds.length?SnapshotVersion.min():I.readTime?__PRIVATE_fromVersion(I.readTime):SnapshotVersion.min()}(r);return this.listener.j_(v,T)}H_(r){const v={};v.database=__PRIVATE_getEncodedDatabaseId(this.serializer),v.addTarget=function(S,I){let H;const te=I.target;if(H=__PRIVATE_targetIsDocumentTarget(te)?{documents:__PRIVATE_toDocumentsTarget(S,te)}:{query:__PRIVATE_toQueryTarget(S,te).gt},H.targetId=I.targetId,I.resumeToken.approximateByteSize()>0){H.resumeToken=__PRIVATE_toBytes(S,I.resumeToken);const ae=__PRIVATE_toInt32Proto(S,I.expectedCount);ae!==null&&(H.expectedCount=ae)}else if(I.snapshotVersion.compareTo(SnapshotVersion.min())>0){H.readTime=toTimestamp(S,I.snapshotVersion.toTimestamp());const ae=__PRIVATE_toInt32Proto(S,I.expectedCount);ae!==null&&(H.expectedCount=ae)}return H}(this.serializer,r);const T=__PRIVATE_toListenRequestLabels(this.serializer,r);T&&(v.labels=T),this.L_(v)}J_(r){const v={};v.database=__PRIVATE_getEncodedDatabaseId(this.serializer),v.removeTarget=r,this.L_(v)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Datastore{}class __PRIVATE_DatastoreImpl extends Datastore{constructor(r,v,T,w){super(),this.authCredentials=r,this.appCheckCredentials=v,this.connection=T,this.serializer=w,this.na=!1}ra(){if(this.na)throw new FirestoreError(N.FAILED_PRECONDITION,"The client has already been terminated.")}zo(r,v,T,w){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([S,I])=>this.connection.zo(r,__PRIVATE_toResourcePath(v,T),w,S,I)).catch(S=>{throw S.name==="FirebaseError"?(S.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),S):new FirestoreError(N.UNKNOWN,S.toString())})}Yo(r,v,T,w,S){return this.ra(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([I,H])=>this.connection.Yo(r,__PRIVATE_toResourcePath(v,T),w,I,H,S)).catch(I=>{throw I.name==="FirebaseError"?(I.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),I):new FirestoreError(N.UNKNOWN,I.toString())})}terminate(){this.na=!0,this.connection.terminate()}}class __PRIVATE_OnlineStateTracker{constructor(r,v){this.asyncQueue=r,this.onlineStateHandler=v,this.state="Unknown",this.ia=0,this.sa=null,this.oa=!0}_a(){this.ia===0&&(this.aa("Unknown"),this.sa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.sa=null,this.ua("Backend didn't respond within 10 seconds."),this.aa("Offline"),Promise.resolve())))}ca(r){this.state==="Online"?this.aa("Unknown"):(this.ia++,this.ia>=1&&(this.la(),this.ua(`Connection failed 1 times. Most recent error: ${r.toString()}`),this.aa("Offline")))}set(r){this.la(),this.ia=0,r==="Online"&&(this.oa=!1),this.aa(r)}aa(r){r!==this.state&&(this.state=r,this.onlineStateHandler(r))}ua(r){const v=`Could not reach Cloud Firestore backend. ${r}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.oa?(__PRIVATE_logError(v),this.oa=!1):__PRIVATE_logDebug("OnlineStateTracker",v)}la(){this.sa!==null&&(this.sa.cancel(),this.sa=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xt="RemoteStore";class __PRIVATE_RemoteStoreImpl{constructor(r,v,T,w,S){this.localStore=r,this.datastore=v,this.asyncQueue=T,this.remoteSyncer={},this.ha=[],this.Pa=new Map,this.Ta=new Set,this.Ia=[],this.Ea=S,this.Ea.No(I=>{T.enqueueAndForget(async()=>{__PRIVATE_canUseNetwork(this)&&(__PRIVATE_logDebug(Xt,"Restarting streams for network reachability change."),await async function(te){const ae=__PRIVATE_debugCast(te);ae.Ta.add(4),await __PRIVATE_disableNetworkInternal(ae),ae.da.set("Unknown"),ae.Ta.delete(4),await __PRIVATE_enableNetworkInternal(ae)}(this))})}),this.da=new __PRIVATE_OnlineStateTracker(T,w)}}async function __PRIVATE_enableNetworkInternal(E){if(__PRIVATE_canUseNetwork(E))for(const r of E.Ia)await r(!0)}async function __PRIVATE_disableNetworkInternal(E){for(const r of E.Ia)await r(!1)}function __PRIVATE_remoteStoreListen(E,r){const v=__PRIVATE_debugCast(E);v.Pa.has(r.targetId)||(v.Pa.set(r.targetId,r),__PRIVATE_shouldStartWatchStream(v)?__PRIVATE_startWatchStream(v):__PRIVATE_ensureWatchStream(v).M_()&&__PRIVATE_sendWatchRequest(v,r))}function __PRIVATE_remoteStoreUnlisten(E,r){const v=__PRIVATE_debugCast(E),T=__PRIVATE_ensureWatchStream(v);v.Pa.delete(r),T.M_()&&__PRIVATE_sendUnwatchRequest(v,r),v.Pa.size===0&&(T.M_()?T.N_():__PRIVATE_canUseNetwork(v)&&v.da.set("Unknown"))}function __PRIVATE_sendWatchRequest(E,r){if(E.Aa.Ke(r.targetId),r.resumeToken.approximateByteSize()>0||r.snapshotVersion.compareTo(SnapshotVersion.min())>0){const v=E.remoteSyncer.getRemoteKeysForTarget(r.targetId).size;r=r.withExpectedCount(v)}__PRIVATE_ensureWatchStream(E).H_(r)}function __PRIVATE_sendUnwatchRequest(E,r){E.Aa.Ke(r),__PRIVATE_ensureWatchStream(E).J_(r)}function __PRIVATE_startWatchStream(E){E.Aa=new __PRIVATE_WatchChangeAggregator({getRemoteKeysForTarget:r=>E.remoteSyncer.getRemoteKeysForTarget(r),Rt:r=>E.Pa.get(r)||null,Pt:()=>E.datastore.serializer.databaseId}),__PRIVATE_ensureWatchStream(E).start(),E.da._a()}function __PRIVATE_shouldStartWatchStream(E){return __PRIVATE_canUseNetwork(E)&&!__PRIVATE_ensureWatchStream(E).F_()&&E.Pa.size>0}function __PRIVATE_canUseNetwork(E){return __PRIVATE_debugCast(E).Ta.size===0}function __PRIVATE_cleanUpWatchStreamState(E){E.Aa=void 0}async function __PRIVATE_onWatchStreamConnected(E){E.da.set("Online")}async function __PRIVATE_onWatchStreamOpen(E){E.Pa.forEach((r,v)=>{__PRIVATE_sendWatchRequest(E,r)})}async function __PRIVATE_onWatchStreamClose(E,r){__PRIVATE_cleanUpWatchStreamState(E),__PRIVATE_shouldStartWatchStream(E)?(E.da.ca(r),__PRIVATE_startWatchStream(E)):E.da.set("Unknown")}async function __PRIVATE_onWatchStreamChange(E,r,v){if(E.da.set("Online"),r instanceof __PRIVATE_WatchTargetChange&&r.state===2&&r.cause)try{await async function(w,S){const I=S.cause;for(const H of S.targetIds)w.Pa.has(H)&&(await w.remoteSyncer.rejectListen(H,I),w.Pa.delete(H),w.Aa.removeTarget(H))}(E,r)}catch(T){__PRIVATE_logDebug(Xt,"Failed to remove targets %s: %s ",r.targetIds.join(","),T),await __PRIVATE_disableNetworkUntilRecovery(E,T)}else if(r instanceof __PRIVATE_DocumentWatchChange?E.Aa.Xe(r):r instanceof __PRIVATE_ExistenceFilterChange?E.Aa.ot(r):E.Aa.nt(r),!v.isEqual(SnapshotVersion.min()))try{const T=await __PRIVATE_localStoreGetLastRemoteSnapshotVersion(E.localStore);v.compareTo(T)>=0&&await function(S,I){const H=S.Aa.It(I);return H.targetChanges.forEach((te,ae)=>{if(te.resumeToken.approximateByteSize()>0){const ie=S.Pa.get(ae);ie&&S.Pa.set(ae,ie.withResumeToken(te.resumeToken,I))}}),H.targetMismatches.forEach((te,ae)=>{const ie=S.Pa.get(te);if(!ie)return;S.Pa.set(te,ie.withResumeToken(ByteString.EMPTY_BYTE_STRING,ie.snapshotVersion)),__PRIVATE_sendUnwatchRequest(S,te);const ce=new TargetData(ie.target,te,ae,ie.sequenceNumber);__PRIVATE_sendWatchRequest(S,ce)}),S.remoteSyncer.applyRemoteEvent(H)}(E,v)}catch(T){__PRIVATE_logDebug(Xt,"Failed to raise snapshot:",T),await __PRIVATE_disableNetworkUntilRecovery(E,T)}}async function __PRIVATE_disableNetworkUntilRecovery(E,r,v){if(!__PRIVATE_isIndexedDbTransactionError(r))throw r;E.Ta.add(1),await __PRIVATE_disableNetworkInternal(E),E.da.set("Offline"),v||(v=()=>__PRIVATE_localStoreGetLastRemoteSnapshotVersion(E.localStore)),E.asyncQueue.enqueueRetryable(async()=>{__PRIVATE_logDebug(Xt,"Retrying IndexedDB access"),await v(),E.Ta.delete(1),await __PRIVATE_enableNetworkInternal(E)})}async function __PRIVATE_remoteStoreHandleCredentialChange(E,r){const v=__PRIVATE_debugCast(E);v.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug(Xt,"RemoteStore received new credentials");const T=__PRIVATE_canUseNetwork(v);v.Ta.add(3),await __PRIVATE_disableNetworkInternal(v),T&&v.da.set("Unknown"),await v.remoteSyncer.handleCredentialChange(r),v.Ta.delete(3),await __PRIVATE_enableNetworkInternal(v)}async function __PRIVATE_remoteStoreApplyPrimaryState(E,r){const v=__PRIVATE_debugCast(E);r?(v.Ta.delete(2),await __PRIVATE_enableNetworkInternal(v)):r||(v.Ta.add(2),await __PRIVATE_disableNetworkInternal(v),v.da.set("Unknown"))}function __PRIVATE_ensureWatchStream(E){return E.Ra||(E.Ra=function(v,T,w){const S=__PRIVATE_debugCast(v);return S.ra(),new __PRIVATE_PersistentListenStream(T,S.connection,S.authCredentials,S.appCheckCredentials,S.serializer,w)}(E.datastore,E.asyncQueue,{e_:__PRIVATE_onWatchStreamConnected.bind(null,E),n_:__PRIVATE_onWatchStreamOpen.bind(null,E),i_:__PRIVATE_onWatchStreamClose.bind(null,E),j_:__PRIVATE_onWatchStreamChange.bind(null,E)}),E.Ia.push(async r=>{r?(E.Ra.O_(),__PRIVATE_shouldStartWatchStream(E)?__PRIVATE_startWatchStream(E):E.da.set("Unknown")):(await E.Ra.stop(),__PRIVATE_cleanUpWatchStreamState(E))})),E.Ra}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DelayedOperation{constructor(r,v,T,w,S){this.asyncQueue=r,this.timerId=v,this.targetTimeMs=T,this.op=w,this.removalCallback=S,this.deferred=new __PRIVATE_Deferred,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(I=>{})}get promise(){return this.deferred.promise}static createAndSchedule(r,v,T,w,S){const I=Date.now()+T,H=new DelayedOperation(r,v,I,w,S);return H.start(T),H}start(r){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),r)}skipDelay(){return this.handleDelayElapsed()}cancel(r){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new FirestoreError(N.CANCELLED,"Operation cancelled"+(r?": "+r:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(r=>this.deferred.resolve(r))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function __PRIVATE_wrapInUserErrorIfRecoverable(E,r){if(__PRIVATE_logError("AsyncQueue",`${r}: ${E}`),__PRIVATE_isIndexedDbTransactionError(E))return new FirestoreError(N.UNAVAILABLE,`${r}: ${E}`);throw E}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DocumentSet{static emptySet(r){return new DocumentSet(r.comparator)}constructor(r){this.comparator=r?(v,T)=>r(v,T)||DocumentKey.comparator(v.key,T.key):(v,T)=>DocumentKey.comparator(v.key,T.key),this.keyedMap=documentMap(),this.sortedSet=new SortedMap(this.comparator)}has(r){return this.keyedMap.get(r)!=null}get(r){return this.keyedMap.get(r)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(r){const v=this.keyedMap.get(r);return v?this.sortedSet.indexOf(v):-1}get size(){return this.sortedSet.size}forEach(r){this.sortedSet.inorderTraversal((v,T)=>(r(v),!1))}add(r){const v=this.delete(r.key);return v.copy(v.keyedMap.insert(r.key,r),v.sortedSet.insert(r,null))}delete(r){const v=this.get(r);return v?this.copy(this.keyedMap.remove(r),this.sortedSet.remove(v)):this}isEqual(r){if(!(r instanceof DocumentSet)||this.size!==r.size)return!1;const v=this.sortedSet.getIterator(),T=r.sortedSet.getIterator();for(;v.hasNext();){const w=v.getNext().key,S=T.getNext().key;if(!w.isEqual(S))return!1}return!0}toString(){const r=[];return this.forEach(v=>{r.push(v.toString())}),r.length===0?"DocumentSet ()":`DocumentSet (
  `+r.join(`  
`)+`
)`}copy(r,v){const T=new DocumentSet;return T.comparator=this.comparator,T.keyedMap=r,T.sortedSet=v,T}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_DocumentChangeSet{constructor(){this.ma=new SortedMap(DocumentKey.comparator)}track(r){const v=r.doc.key,T=this.ma.get(v);T?r.type!==0&&T.type===3?this.ma=this.ma.insert(v,r):r.type===3&&T.type!==1?this.ma=this.ma.insert(v,{type:T.type,doc:r.doc}):r.type===2&&T.type===2?this.ma=this.ma.insert(v,{type:2,doc:r.doc}):r.type===2&&T.type===0?this.ma=this.ma.insert(v,{type:0,doc:r.doc}):r.type===1&&T.type===0?this.ma=this.ma.remove(v):r.type===1&&T.type===2?this.ma=this.ma.insert(v,{type:1,doc:T.doc}):r.type===0&&T.type===1?this.ma=this.ma.insert(v,{type:2,doc:r.doc}):fail(63341,{Vt:r,fa:T}):this.ma=this.ma.insert(v,r)}ga(){const r=[];return this.ma.inorderTraversal((v,T)=>{r.push(T)}),r}}class ViewSnapshot{constructor(r,v,T,w,S,I,H,te,ae){this.query=r,this.docs=v,this.oldDocs=T,this.docChanges=w,this.mutatedKeys=S,this.fromCache=I,this.syncStateChanged=H,this.excludesMetadataChanges=te,this.hasCachedResults=ae}static fromInitialDocuments(r,v,T,w,S){const I=[];return v.forEach(H=>{I.push({type:0,doc:H})}),new ViewSnapshot(r,v,DocumentSet.emptySet(v),I,T,w,!0,!1,S)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(r){if(!(this.fromCache===r.fromCache&&this.hasCachedResults===r.hasCachedResults&&this.syncStateChanged===r.syncStateChanged&&this.mutatedKeys.isEqual(r.mutatedKeys)&&__PRIVATE_queryEquals(this.query,r.query)&&this.docs.isEqual(r.docs)&&this.oldDocs.isEqual(r.oldDocs)))return!1;const v=this.docChanges,T=r.docChanges;if(v.length!==T.length)return!1;for(let w=0;w<v.length;w++)if(v[w].type!==T[w].type||!v[w].doc.isEqual(T[w].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_QueryListenersInfo{constructor(){this.pa=void 0,this.ya=[]}wa(){return this.ya.some(r=>r.Sa())}}class __PRIVATE_EventManagerImpl{constructor(){this.queries=__PRIVATE_newQueriesObjectMap(),this.onlineState="Unknown",this.ba=new Set}terminate(){(function(v,T){const w=__PRIVATE_debugCast(v),S=w.queries;w.queries=__PRIVATE_newQueriesObjectMap(),S.forEach((I,H)=>{for(const te of H.ya)te.onError(T)})})(this,new FirestoreError(N.ABORTED,"Firestore shutting down"))}}function __PRIVATE_newQueriesObjectMap(){return new ObjectMap(E=>__PRIVATE_canonifyQuery(E),__PRIVATE_queryEquals)}async function __PRIVATE_eventManagerListen(E,r){const v=__PRIVATE_debugCast(E);let T=3;const w=r.query;let S=v.queries.get(w);S?!S.wa()&&r.Sa()&&(T=2):(S=new __PRIVATE_QueryListenersInfo,T=r.Sa()?0:1);try{switch(T){case 0:S.pa=await v.onListen(w,!0);break;case 1:S.pa=await v.onListen(w,!1);break;case 2:await v.onFirstRemoteStoreListen(w)}}catch(I){const H=__PRIVATE_wrapInUserErrorIfRecoverable(I,`Initialization of query '${__PRIVATE_stringifyQuery(r.query)}' failed`);return void r.onError(H)}v.queries.set(w,S),S.ya.push(r),r.Da(v.onlineState),S.pa&&r.va(S.pa)&&__PRIVATE_raiseSnapshotsInSyncEvent(v)}async function __PRIVATE_eventManagerUnlisten(E,r){const v=__PRIVATE_debugCast(E),T=r.query;let w=3;const S=v.queries.get(T);if(S){const I=S.ya.indexOf(r);I>=0&&(S.ya.splice(I,1),S.ya.length===0?w=r.Sa()?0:1:!S.wa()&&r.Sa()&&(w=2))}switch(w){case 0:return v.queries.delete(T),v.onUnlisten(T,!0);case 1:return v.queries.delete(T),v.onUnlisten(T,!1);case 2:return v.onLastRemoteStoreUnlisten(T);default:return}}function __PRIVATE_eventManagerOnWatchChange(E,r){const v=__PRIVATE_debugCast(E);let T=!1;for(const w of r){const S=w.query,I=v.queries.get(S);if(I){for(const H of I.ya)H.va(w)&&(T=!0);I.pa=w}}T&&__PRIVATE_raiseSnapshotsInSyncEvent(v)}function __PRIVATE_eventManagerOnWatchError(E,r,v){const T=__PRIVATE_debugCast(E),w=T.queries.get(r);if(w)for(const S of w.ya)S.onError(v);T.queries.delete(r)}function __PRIVATE_raiseSnapshotsInSyncEvent(E){E.ba.forEach(r=>{r.next()})}var en,tn;(tn=en||(en={})).Ca="default",tn.Cache="cache";class __PRIVATE_QueryListener{constructor(r,v,T){this.query=r,this.Fa=v,this.Ma=!1,this.xa=null,this.onlineState="Unknown",this.options=T||{}}va(r){if(!this.options.includeMetadataChanges){const T=[];for(const w of r.docChanges)w.type!==3&&T.push(w);r=new ViewSnapshot(r.query,r.docs,r.oldDocs,T,r.mutatedKeys,r.fromCache,r.syncStateChanged,!0,r.hasCachedResults)}let v=!1;return this.Ma?this.Oa(r)&&(this.Fa.next(r),v=!0):this.Na(r,this.onlineState)&&(this.Ba(r),v=!0),this.xa=r,v}onError(r){this.Fa.error(r)}Da(r){this.onlineState=r;let v=!1;return this.xa&&!this.Ma&&this.Na(this.xa,r)&&(this.Ba(this.xa),v=!0),v}Na(r,v){if(!r.fromCache||!this.Sa())return!0;const T=v!=="Offline";return(!this.options.La||!T)&&(!r.docs.isEmpty()||r.hasCachedResults||v==="Offline")}Oa(r){if(r.docChanges.length>0)return!0;const v=this.xa&&this.xa.hasPendingWrites!==r.hasPendingWrites;return!(!r.syncStateChanged&&!v)&&this.options.includeMetadataChanges===!0}Ba(r){r=ViewSnapshot.fromInitialDocuments(r.query,r.docs,r.mutatedKeys,r.fromCache,r.hasCachedResults),this.Ma=!0,this.Fa.next(r)}Sa(){return this.options.source!==en.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_AddedLimboDocument{constructor(r){this.key=r}}class __PRIVATE_RemovedLimboDocument{constructor(r){this.key=r}}class __PRIVATE_View{constructor(r,v){this.query=r,this.Ga=v,this.za=null,this.hasCachedResults=!1,this.current=!1,this.ja=__PRIVATE_documentKeySet(),this.mutatedKeys=__PRIVATE_documentKeySet(),this.Ha=__PRIVATE_newQueryComparator(r),this.Ja=new DocumentSet(this.Ha)}get Ya(){return this.Ga}Za(r,v){const T=v?v.Xa:new __PRIVATE_DocumentChangeSet,w=v?v.Ja:this.Ja;let S=v?v.mutatedKeys:this.mutatedKeys,I=w,H=!1;const te=this.query.limitType==="F"&&w.size===this.query.limit?w.last():null,ae=this.query.limitType==="L"&&w.size===this.query.limit?w.first():null;if(r.inorderTraversal((ie,ce)=>{const me=w.get(ie),_e=__PRIVATE_queryMatches(this.query,ce)?ce:null,Re=!!me&&this.mutatedKeys.has(me.key),Pe=!!_e&&(_e.hasLocalMutations||this.mutatedKeys.has(_e.key)&&_e.hasCommittedMutations);let Ce=!1;me&&_e?me.data.isEqual(_e.data)?Re!==Pe&&(T.track({type:3,doc:_e}),Ce=!0):this.eu(me,_e)||(T.track({type:2,doc:_e}),Ce=!0,(te&&this.Ha(_e,te)>0||ae&&this.Ha(_e,ae)<0)&&(H=!0)):!me&&_e?(T.track({type:0,doc:_e}),Ce=!0):me&&!_e&&(T.track({type:1,doc:me}),Ce=!0,(te||ae)&&(H=!0)),Ce&&(_e?(I=I.add(_e),S=Pe?S.add(ie):S.delete(ie)):(I=I.delete(ie),S=S.delete(ie)))}),this.query.limit!==null)for(;I.size>this.query.limit;){const ie=this.query.limitType==="F"?I.last():I.first();I=I.delete(ie.key),S=S.delete(ie.key),T.track({type:1,doc:ie})}return{Ja:I,Xa:T,Cs:H,mutatedKeys:S}}eu(r,v){return r.hasLocalMutations&&v.hasCommittedMutations&&!v.hasLocalMutations}applyChanges(r,v,T,w){const S=this.Ja;this.Ja=r.Ja,this.mutatedKeys=r.mutatedKeys;const I=r.Xa.ga();I.sort((ie,ce)=>function(_e,Re){const Pe=Ce=>{switch(Ce){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return fail(20277,{Vt:Ce})}};return Pe(_e)-Pe(Re)}(ie.type,ce.type)||this.Ha(ie.doc,ce.doc)),this.tu(T),w=w!=null&&w;const H=v&&!w?this.nu():[],te=this.ja.size===0&&this.current&&!w?1:0,ae=te!==this.za;return this.za=te,I.length!==0||ae?{snapshot:new ViewSnapshot(this.query,r.Ja,S,I,r.mutatedKeys,te===0,ae,!1,!!T&&T.resumeToken.approximateByteSize()>0),ru:H}:{ru:H}}Da(r){return this.current&&r==="Offline"?(this.current=!1,this.applyChanges({Ja:this.Ja,Xa:new __PRIVATE_DocumentChangeSet,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ru:[]}}iu(r){return!this.Ga.has(r)&&!!this.Ja.has(r)&&!this.Ja.get(r).hasLocalMutations}tu(r){r&&(r.addedDocuments.forEach(v=>this.Ga=this.Ga.add(v)),r.modifiedDocuments.forEach(v=>{}),r.removedDocuments.forEach(v=>this.Ga=this.Ga.delete(v)),this.current=r.current)}nu(){if(!this.current)return[];const r=this.ja;this.ja=__PRIVATE_documentKeySet(),this.Ja.forEach(T=>{this.iu(T.key)&&(this.ja=this.ja.add(T.key))});const v=[];return r.forEach(T=>{this.ja.has(T)||v.push(new __PRIVATE_RemovedLimboDocument(T))}),this.ja.forEach(T=>{r.has(T)||v.push(new __PRIVATE_AddedLimboDocument(T))}),v}su(r){this.Ga=r.$s,this.ja=__PRIVATE_documentKeySet();const v=this.Za(r.documents);return this.applyChanges(v,!0)}ou(){return ViewSnapshot.fromInitialDocuments(this.query,this.Ja,this.mutatedKeys,this.za===0,this.hasCachedResults)}}const nn="SyncEngine";class __PRIVATE_QueryView{constructor(r,v,T){this.query=r,this.targetId=v,this.view=T}}class LimboResolution{constructor(r){this.key=r,this._u=!1}}class __PRIVATE_SyncEngineImpl{constructor(r,v,T,w,S,I){this.localStore=r,this.remoteStore=v,this.eventManager=T,this.sharedClientState=w,this.currentUser=S,this.maxConcurrentLimboResolutions=I,this.au={},this.uu=new ObjectMap(H=>__PRIVATE_canonifyQuery(H),__PRIVATE_queryEquals),this.cu=new Map,this.lu=new Set,this.hu=new SortedMap(DocumentKey.comparator),this.Pu=new Map,this.Tu=new __PRIVATE_ReferenceSet,this.Iu={},this.Eu=new Map,this.du=__PRIVATE_TargetIdGenerator.lr(),this.onlineState="Unknown",this.Au=void 0}get isPrimaryClient(){return this.Au===!0}}async function __PRIVATE_syncEngineListen(E,r,v=!0){const T=__PRIVATE_ensureWatchCallbacks(E);let w;const S=T.uu.get(r);return S?(T.sharedClientState.addLocalQueryTarget(S.targetId),w=S.view.ou()):w=await __PRIVATE_allocateTargetAndMaybeListen(T,r,v,!0),w}async function __PRIVATE_triggerRemoteStoreListen(E,r){const v=__PRIVATE_ensureWatchCallbacks(E);await __PRIVATE_allocateTargetAndMaybeListen(v,r,!0,!1)}async function __PRIVATE_allocateTargetAndMaybeListen(E,r,v,T){const w=await __PRIVATE_localStoreAllocateTarget(E.localStore,__PRIVATE_queryToTarget(r)),S=w.targetId,I=E.sharedClientState.addLocalQueryTarget(S,v);let H;return T&&(H=await __PRIVATE_initializeViewAndComputeSnapshot(E,r,S,I==="current",w.resumeToken)),E.isPrimaryClient&&v&&__PRIVATE_remoteStoreListen(E.remoteStore,w),H}async function __PRIVATE_initializeViewAndComputeSnapshot(E,r,v,T,w){E.Ru=(ce,me,_e)=>async function(Pe,Ce,Fe,Me){let Ve=Ce.view.Za(Fe);Ve.Cs&&(Ve=await __PRIVATE_localStoreExecuteQuery(Pe.localStore,Ce.query,!1).then(({documents:je})=>Ce.view.Za(je,Ve)));const We=Me&&Me.targetChanges.get(Ce.targetId),ze=Me&&Me.targetMismatches.get(Ce.targetId)!=null,Ue=Ce.view.applyChanges(Ve,Pe.isPrimaryClient,We,ze);return __PRIVATE_updateTrackedLimbos(Pe,Ce.targetId,Ue.ru),Ue.snapshot}(E,ce,me,_e);const S=await __PRIVATE_localStoreExecuteQuery(E.localStore,r,!0),I=new __PRIVATE_View(r,S.$s),H=I.Za(S.documents),te=TargetChange.createSynthesizedTargetChangeForCurrentChange(v,T&&E.onlineState!=="Offline",w),ae=I.applyChanges(H,E.isPrimaryClient,te);__PRIVATE_updateTrackedLimbos(E,v,ae.ru);const ie=new __PRIVATE_QueryView(r,v,I);return E.uu.set(r,ie),E.cu.has(v)?E.cu.get(v).push(r):E.cu.set(v,[r]),ae.snapshot}async function __PRIVATE_syncEngineUnlisten(E,r,v){const T=__PRIVATE_debugCast(E),w=T.uu.get(r),S=T.cu.get(w.targetId);if(S.length>1)return T.cu.set(w.targetId,S.filter(I=>!__PRIVATE_queryEquals(I,r))),void T.uu.delete(r);T.isPrimaryClient?(T.sharedClientState.removeLocalQueryTarget(w.targetId),T.sharedClientState.isActiveQueryTarget(w.targetId)||await __PRIVATE_localStoreReleaseTarget(T.localStore,w.targetId,!1).then(()=>{T.sharedClientState.clearQueryState(w.targetId),v&&__PRIVATE_remoteStoreUnlisten(T.remoteStore,w.targetId),__PRIVATE_removeAndCleanupTarget(T,w.targetId)}).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)):(__PRIVATE_removeAndCleanupTarget(T,w.targetId),await __PRIVATE_localStoreReleaseTarget(T.localStore,w.targetId,!0))}async function __PRIVATE_triggerRemoteStoreUnlisten(E,r){const v=__PRIVATE_debugCast(E),T=v.uu.get(r),w=v.cu.get(T.targetId);v.isPrimaryClient&&w.length===1&&(v.sharedClientState.removeLocalQueryTarget(T.targetId),__PRIVATE_remoteStoreUnlisten(v.remoteStore,T.targetId))}async function __PRIVATE_syncEngineApplyRemoteEvent(E,r){const v=__PRIVATE_debugCast(E);try{const T=await __PRIVATE_localStoreApplyRemoteEventToLocalCache(v.localStore,r);r.targetChanges.forEach((w,S)=>{const I=v.Pu.get(S);I&&(__PRIVATE_hardAssert(w.addedDocuments.size+w.modifiedDocuments.size+w.removedDocuments.size<=1,22616),w.addedDocuments.size>0?I._u=!0:w.modifiedDocuments.size>0?__PRIVATE_hardAssert(I._u,14607):w.removedDocuments.size>0&&(__PRIVATE_hardAssert(I._u,42227),I._u=!1))}),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(v,T,r)}catch(T){await __PRIVATE_ignoreIfPrimaryLeaseLoss(T)}}function __PRIVATE_syncEngineApplyOnlineStateChange(E,r,v){const T=__PRIVATE_debugCast(E);if(T.isPrimaryClient&&v===0||!T.isPrimaryClient&&v===1){const w=[];T.uu.forEach((S,I)=>{const H=I.view.Da(r);H.snapshot&&w.push(H.snapshot)}),function(I,H){const te=__PRIVATE_debugCast(I);te.onlineState=H;let ae=!1;te.queries.forEach((ie,ce)=>{for(const me of ce.ya)me.Da(H)&&(ae=!0)}),ae&&__PRIVATE_raiseSnapshotsInSyncEvent(te)}(T.eventManager,r),w.length&&T.au.j_(w),T.onlineState=r,T.isPrimaryClient&&T.sharedClientState.setOnlineState(r)}}async function __PRIVATE_syncEngineRejectListen(E,r,v){const T=__PRIVATE_debugCast(E);T.sharedClientState.updateQueryState(r,"rejected",v);const w=T.Pu.get(r),S=w&&w.key;if(S){let I=new SortedMap(DocumentKey.comparator);I=I.insert(S,MutableDocument.newNoDocument(S,SnapshotVersion.min()));const H=__PRIVATE_documentKeySet().add(S),te=new RemoteEvent(SnapshotVersion.min(),new Map,new SortedMap(__PRIVATE_primitiveComparator),I,H);await __PRIVATE_syncEngineApplyRemoteEvent(T,te),T.hu=T.hu.remove(S),T.Pu.delete(r),__PRIVATE_pumpEnqueuedLimboResolutions(T)}else await __PRIVATE_localStoreReleaseTarget(T.localStore,r,!1).then(()=>__PRIVATE_removeAndCleanupTarget(T,r,v)).catch(__PRIVATE_ignoreIfPrimaryLeaseLoss)}function __PRIVATE_removeAndCleanupTarget(E,r,v=null){E.sharedClientState.removeLocalQueryTarget(r);for(const T of E.cu.get(r))E.uu.delete(T),v&&E.au.Vu(T,v);E.cu.delete(r),E.isPrimaryClient&&E.Tu.Hr(r).forEach(T=>{E.Tu.containsKey(T)||__PRIVATE_removeLimboTarget(E,T)})}function __PRIVATE_removeLimboTarget(E,r){E.lu.delete(r.path.canonicalString());const v=E.hu.get(r);v!==null&&(__PRIVATE_remoteStoreUnlisten(E.remoteStore,v),E.hu=E.hu.remove(r),E.Pu.delete(v),__PRIVATE_pumpEnqueuedLimboResolutions(E))}function __PRIVATE_updateTrackedLimbos(E,r,v){for(const T of v)T instanceof __PRIVATE_AddedLimboDocument?(E.Tu.addReference(T.key,r),__PRIVATE_trackLimboChange(E,T)):T instanceof __PRIVATE_RemovedLimboDocument?(__PRIVATE_logDebug(nn,"Document no longer in limbo: "+T.key),E.Tu.removeReference(T.key,r),E.Tu.containsKey(T.key)||__PRIVATE_removeLimboTarget(E,T.key)):fail(19791,{mu:T})}function __PRIVATE_trackLimboChange(E,r){const v=r.key,T=v.path.canonicalString();E.hu.get(v)||E.lu.has(T)||(__PRIVATE_logDebug(nn,"New document in limbo: "+v),E.lu.add(T),__PRIVATE_pumpEnqueuedLimboResolutions(E))}function __PRIVATE_pumpEnqueuedLimboResolutions(E){for(;E.lu.size>0&&E.hu.size<E.maxConcurrentLimboResolutions;){const r=E.lu.values().next().value;E.lu.delete(r);const v=new DocumentKey(ResourcePath.fromString(r)),T=E.du.next();E.Pu.set(T,new LimboResolution(v)),E.hu=E.hu.insert(v,T),__PRIVATE_remoteStoreListen(E.remoteStore,new TargetData(__PRIVATE_queryToTarget(__PRIVATE_newQueryForPath(v.path)),T,"TargetPurposeLimboResolution",__PRIVATE_ListenSequence.le))}}async function __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(E,r,v){const T=__PRIVATE_debugCast(E),w=[],S=[],I=[];T.uu.isEmpty()||(T.uu.forEach((H,te)=>{I.push(T.Ru(te,r,v).then(ae=>{var ie;if((ae||v)&&T.isPrimaryClient){const ce=ae?!ae.fromCache:(ie=v==null?void 0:v.targetChanges.get(te.targetId))===null||ie===void 0?void 0:ie.current;T.sharedClientState.updateQueryState(te.targetId,ce?"current":"not-current")}if(ae){w.push(ae);const ce=__PRIVATE_LocalViewChanges.Rs(te.targetId,ae);S.push(ce)}}))}),await Promise.all(I),T.au.j_(w),await async function(te,ae){const ie=__PRIVATE_debugCast(te);try{await ie.persistence.runTransaction("notifyLocalViewChanges","readwrite",ce=>PersistencePromise.forEach(ae,me=>PersistencePromise.forEach(me.ds,_e=>ie.persistence.referenceDelegate.addReference(ce,me.targetId,_e)).next(()=>PersistencePromise.forEach(me.As,_e=>ie.persistence.referenceDelegate.removeReference(ce,me.targetId,_e)))))}catch(ce){if(!__PRIVATE_isIndexedDbTransactionError(ce))throw ce;__PRIVATE_logDebug(Qt,"Failed to update sequence numbers: "+ce)}for(const ce of ae){const me=ce.targetId;if(!ce.fromCache){const _e=ie.xs.get(me),Re=_e.snapshotVersion,Pe=_e.withLastLimboFreeSnapshotVersion(Re);ie.xs=ie.xs.insert(me,Pe)}}}(T.localStore,S))}async function __PRIVATE_syncEngineHandleCredentialChange(E,r){const v=__PRIVATE_debugCast(E);if(!v.currentUser.isEqual(r)){__PRIVATE_logDebug(nn,"User change. New user:",r.toKey());const T=await __PRIVATE_localStoreHandleUserChange(v.localStore,r);v.currentUser=r,function(S,I){S.Eu.forEach(H=>{H.forEach(te=>{te.reject(new FirestoreError(N.CANCELLED,I))})}),S.Eu.clear()}(v,"'waitForPendingWrites' promise is rejected due to a user change."),v.sharedClientState.handleUserChange(r,T.removedBatchIds,T.addedBatchIds),await __PRIVATE_syncEngineEmitNewSnapsAndNotifyLocalStore(v,T.ks)}}function __PRIVATE_syncEngineGetRemoteKeysForTarget(E,r){const v=__PRIVATE_debugCast(E),T=v.Pu.get(r);if(T&&T._u)return __PRIVATE_documentKeySet().add(T.key);{let w=__PRIVATE_documentKeySet();const S=v.cu.get(r);if(!S)return w;for(const I of S){const H=v.uu.get(I);w=w.unionWith(H.view.Ya)}return w}}function __PRIVATE_ensureWatchCallbacks(E){const r=__PRIVATE_debugCast(E);return r.remoteStore.remoteSyncer.applyRemoteEvent=__PRIVATE_syncEngineApplyRemoteEvent.bind(null,r),r.remoteStore.remoteSyncer.getRemoteKeysForTarget=__PRIVATE_syncEngineGetRemoteKeysForTarget.bind(null,r),r.remoteStore.remoteSyncer.rejectListen=__PRIVATE_syncEngineRejectListen.bind(null,r),r.au.j_=__PRIVATE_eventManagerOnWatchChange.bind(null,r.eventManager),r.au.Vu=__PRIVATE_eventManagerOnWatchError.bind(null,r.eventManager),r}class __PRIVATE_MemoryOfflineComponentProvider{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(r){this.serializer=__PRIVATE_newSerializer(r.databaseInfo.databaseId),this.sharedClientState=this.pu(r),this.persistence=this.yu(r),await this.persistence.start(),this.localStore=this.wu(r),this.gcScheduler=this.Su(r,this.localStore),this.indexBackfillerScheduler=this.bu(r,this.localStore)}Su(r,v){return null}bu(r,v){return null}wu(r){return __PRIVATE_newLocalStore(this.persistence,new __PRIVATE_QueryEngine,r.initialUser,this.serializer)}yu(r){return new __PRIVATE_MemoryPersistence(__PRIVATE_MemoryEagerDelegate.fi,this.serializer)}pu(r){return new __PRIVATE_MemorySharedClientState}async terminate(){var r,v;(r=this.gcScheduler)===null||r===void 0||r.stop(),(v=this.indexBackfillerScheduler)===null||v===void 0||v.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}__PRIVATE_MemoryOfflineComponentProvider.provider={build:()=>new __PRIVATE_MemoryOfflineComponentProvider};class __PRIVATE_LruGcMemoryOfflineComponentProvider extends __PRIVATE_MemoryOfflineComponentProvider{constructor(r){super(),this.cacheSizeBytes=r}Su(r,v){__PRIVATE_hardAssert(this.persistence.referenceDelegate instanceof __PRIVATE_MemoryLruDelegate,46915);const T=this.persistence.referenceDelegate.garbageCollector;return new __PRIVATE_LruScheduler(T,r.asyncQueue,v)}yu(r){const v=this.cacheSizeBytes!==void 0?LruParams.withCacheSize(this.cacheSizeBytes):LruParams.DEFAULT;return new __PRIVATE_MemoryPersistence(T=>__PRIVATE_MemoryLruDelegate.fi(T,v),this.serializer)}}class OnlineComponentProvider{async initialize(r,v){this.localStore||(this.localStore=r.localStore,this.sharedClientState=r.sharedClientState,this.datastore=this.createDatastore(v),this.remoteStore=this.createRemoteStore(v),this.eventManager=this.createEventManager(v),this.syncEngine=this.createSyncEngine(v,!r.synchronizeTabs),this.sharedClientState.onlineStateHandler=T=>__PRIVATE_syncEngineApplyOnlineStateChange(this.syncEngine,T,1),this.remoteStore.remoteSyncer.handleCredentialChange=__PRIVATE_syncEngineHandleCredentialChange.bind(null,this.syncEngine),await __PRIVATE_remoteStoreApplyPrimaryState(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(r){return function(){return new __PRIVATE_EventManagerImpl}()}createDatastore(r){const v=__PRIVATE_newSerializer(r.databaseInfo.databaseId),T=function(S){return new __PRIVATE_WebChannelConnection(S)}(r.databaseInfo);return function(S,I,H,te){return new __PRIVATE_DatastoreImpl(S,I,H,te)}(r.authCredentials,r.appCheckCredentials,T,v)}createRemoteStore(r){return function(T,w,S,I,H){return new __PRIVATE_RemoteStoreImpl(T,w,S,I,H)}(this.localStore,this.datastore,r.asyncQueue,v=>__PRIVATE_syncEngineApplyOnlineStateChange(this.syncEngine,v,0),function(){return __PRIVATE_BrowserConnectivityMonitor.C()?new __PRIVATE_BrowserConnectivityMonitor:new __PRIVATE_NoopConnectivityMonitor}())}createSyncEngine(r,v){return function(w,S,I,H,te,ae,ie){const ce=new __PRIVATE_SyncEngineImpl(w,S,I,H,te,ae);return ie&&(ce.Au=!0),ce}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,r.initialUser,r.maxConcurrentLimboResolutions,v)}async terminate(){var r,v;await async function(w){const S=__PRIVATE_debugCast(w);__PRIVATE_logDebug(Xt,"RemoteStore shutting down."),S.Ta.add(5),await __PRIVATE_disableNetworkInternal(S),S.Ea.shutdown(),S.da.set("Unknown")}(this.remoteStore),(r=this.datastore)===null||r===void 0||r.terminate(),(v=this.eventManager)===null||v===void 0||v.terminate()}}OnlineComponentProvider.provider={build:()=>new OnlineComponentProvider};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class __PRIVATE_AsyncObserver{constructor(r){this.observer=r,this.muted=!1}next(r){this.muted||this.observer.next&&this.vu(this.observer.next,r)}error(r){this.muted||(this.observer.error?this.vu(this.observer.error,r):__PRIVATE_logError("Uncaught Error in snapshot listener:",r.toString()))}Cu(){this.muted=!0}vu(r,v){setTimeout(()=>{this.muted||r(v)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rn="FirestoreClient";class FirestoreClient{constructor(r,v,T,w,S){this.authCredentials=r,this.appCheckCredentials=v,this.asyncQueue=T,this.databaseInfo=w,this.user=User.UNAUTHENTICATED,this.clientId=__PRIVATE_AutoId.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=S,this.authCredentials.start(T,async I=>{__PRIVATE_logDebug(rn,"Received user=",I.uid),await this.authCredentialListener(I),this.user=I}),this.appCheckCredentials.start(T,I=>(__PRIVATE_logDebug(rn,"Received new app check token=",I),this.appCheckCredentialListener(I,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(r){this.authCredentialListener=r}setAppCheckTokenChangeListener(r){this.appCheckCredentialListener=r}terminate(){this.asyncQueue.enterRestrictedMode();const r=new __PRIVATE_Deferred;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),r.resolve()}catch(v){const T=__PRIVATE_wrapInUserErrorIfRecoverable(v,"Failed to shutdown persistence");r.reject(T)}}),r.promise}}async function __PRIVATE_setOfflineComponentProvider(E,r){E.asyncQueue.verifyOperationInProgress(),__PRIVATE_logDebug(rn,"Initializing OfflineComponentProvider");const v=E.configuration;await r.initialize(v);let T=v.initialUser;E.setCredentialChangeListener(async w=>{T.isEqual(w)||(await __PRIVATE_localStoreHandleUserChange(r.localStore,w),T=w)}),r.persistence.setDatabaseDeletedListener(()=>E.terminate()),E._offlineComponents=r}async function __PRIVATE_setOnlineComponentProvider(E,r){E.asyncQueue.verifyOperationInProgress();const v=await __PRIVATE_ensureOfflineComponents(E);__PRIVATE_logDebug(rn,"Initializing OnlineComponentProvider"),await r.initialize(v,E.configuration),E.setCredentialChangeListener(T=>__PRIVATE_remoteStoreHandleCredentialChange(r.remoteStore,T)),E.setAppCheckTokenChangeListener((T,w)=>__PRIVATE_remoteStoreHandleCredentialChange(r.remoteStore,w)),E._onlineComponents=r}async function __PRIVATE_ensureOfflineComponents(E){if(!E._offlineComponents)if(E._uninitializedComponentsProvider){__PRIVATE_logDebug(rn,"Using user provided OfflineComponentProvider");try{await __PRIVATE_setOfflineComponentProvider(E,E._uninitializedComponentsProvider._offline)}catch(r){const v=r;if(!function(w){return w.name==="FirebaseError"?w.code===N.FAILED_PRECONDITION||w.code===N.UNIMPLEMENTED:!(typeof DOMException<"u"&&w instanceof DOMException)||w.code===22||w.code===20||w.code===11}(v))throw v;__PRIVATE_logWarn("Error using user provided cache. Falling back to memory cache: "+v),await __PRIVATE_setOfflineComponentProvider(E,new __PRIVATE_MemoryOfflineComponentProvider)}}else __PRIVATE_logDebug(rn,"Using default OfflineComponentProvider"),await __PRIVATE_setOfflineComponentProvider(E,new __PRIVATE_LruGcMemoryOfflineComponentProvider(void 0));return E._offlineComponents}async function __PRIVATE_ensureOnlineComponents(E){return E._onlineComponents||(E._uninitializedComponentsProvider?(__PRIVATE_logDebug(rn,"Using user provided OnlineComponentProvider"),await __PRIVATE_setOnlineComponentProvider(E,E._uninitializedComponentsProvider._online)):(__PRIVATE_logDebug(rn,"Using default OnlineComponentProvider"),await __PRIVATE_setOnlineComponentProvider(E,new OnlineComponentProvider))),E._onlineComponents}async function __PRIVATE_getEventManager(E){const r=await __PRIVATE_ensureOnlineComponents(E),v=r.eventManager;return v.onListen=__PRIVATE_syncEngineListen.bind(null,r.syncEngine),v.onUnlisten=__PRIVATE_syncEngineUnlisten.bind(null,r.syncEngine),v.onFirstRemoteStoreListen=__PRIVATE_triggerRemoteStoreListen.bind(null,r.syncEngine),v.onLastRemoteStoreUnlisten=__PRIVATE_triggerRemoteStoreUnlisten.bind(null,r.syncEngine),v}function __PRIVATE_firestoreClientGetDocumentsViaSnapshotListener(E,r,v={}){const T=new __PRIVATE_Deferred;return E.asyncQueue.enqueueAndForget(async()=>function(S,I,H,te,ae){const ie=new __PRIVATE_AsyncObserver({next:me=>{ie.Cu(),I.enqueueAndForget(()=>__PRIVATE_eventManagerUnlisten(S,ce)),me.fromCache&&te.source==="server"?ae.reject(new FirestoreError(N.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):ae.resolve(me)},error:me=>ae.reject(me)}),ce=new __PRIVATE_QueryListener(H,ie,{includeMetadataChanges:!0,La:!0});return __PRIVATE_eventManagerListen(S,ce)}(await __PRIVATE_getEventManager(E),E.asyncQueue,r,v,T)),T.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_cloneLongPollingOptions(E){const r={};return E.timeoutSeconds!==void 0&&(r.timeoutSeconds=E.timeoutSeconds),r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sn=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_validateNonEmptyArgument(E,r,v){if(!v)throw new FirestoreError(N.INVALID_ARGUMENT,`Function ${E}() cannot be called with an empty ${r}.`)}function __PRIVATE_validateIsNotUsedTogether(E,r,v,T){if(r===!0&&T===!0)throw new FirestoreError(N.INVALID_ARGUMENT,`${E} and ${v} cannot be used together.`)}function __PRIVATE_validateCollectionPath(E){if(DocumentKey.isDocumentKey(E))throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${E} has ${E.length}.`)}function __PRIVATE_valueDescription(E){if(E===void 0)return"undefined";if(E===null)return"null";if(typeof E=="string")return E.length>20&&(E=`${E.substring(0,20)}...`),JSON.stringify(E);if(typeof E=="number"||typeof E=="boolean")return""+E;if(typeof E=="object"){if(E instanceof Array)return"an array";{const r=function(T){return T.constructor?T.constructor.name:null}(E);return r?`a custom ${r} object`:"an object"}}return typeof E=="function"?"a function":fail(12329,{type:typeof E})}function __PRIVATE_cast(E,r){if("_delegate"in E&&(E=E._delegate),!(E instanceof r)){if(r.name===E.constructor.name)throw new FirestoreError(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const v=__PRIVATE_valueDescription(E);throw new FirestoreError(N.INVALID_ARGUMENT,`Expected type '${r.name}', but it was: ${v}`)}}return E}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const on="firestore.googleapis.com",_n=!0;class FirestoreSettingsImpl{constructor(r){var v,T;if(r.host===void 0){if(r.ssl!==void 0)throw new FirestoreError(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=on,this.ssl=_n}else this.host=r.host,this.ssl=(v=r.ssl)!==null&&v!==void 0?v:_n;if(this.isUsingEmulator=r.emulatorOptions!==void 0,this.credentials=r.credentials,this.ignoreUndefinedProperties=!!r.ignoreUndefinedProperties,this.localCache=r.localCache,r.cacheSizeBytes===void 0)this.cacheSizeBytes=Mt;else{if(r.cacheSizeBytes!==-1&&r.cacheSizeBytes<Ot)throw new FirestoreError(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=r.cacheSizeBytes}__PRIVATE_validateIsNotUsedTogether("experimentalForceLongPolling",r.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",r.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!r.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:r.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!r.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=__PRIVATE_cloneLongPollingOptions((T=r.experimentalLongPollingOptions)!==null&&T!==void 0?T:{}),function(S){if(S.timeoutSeconds!==void 0){if(isNaN(S.timeoutSeconds))throw new FirestoreError(N.INVALID_ARGUMENT,`invalid long polling timeout: ${S.timeoutSeconds} (must not be NaN)`);if(S.timeoutSeconds<5)throw new FirestoreError(N.INVALID_ARGUMENT,`invalid long polling timeout: ${S.timeoutSeconds} (minimum allowed value is 5)`);if(S.timeoutSeconds>30)throw new FirestoreError(N.INVALID_ARGUMENT,`invalid long polling timeout: ${S.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!r.useFetchStreams}isEqual(r){return this.host===r.host&&this.ssl===r.ssl&&this.credentials===r.credentials&&this.cacheSizeBytes===r.cacheSizeBytes&&this.experimentalForceLongPolling===r.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===r.experimentalAutoDetectLongPolling&&function(T,w){return T.timeoutSeconds===w.timeoutSeconds}(this.experimentalLongPollingOptions,r.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===r.ignoreUndefinedProperties&&this.useFetchStreams===r.useFetchStreams}}class Firestore$1{constructor(r,v,T,w){this._authCredentials=r,this._appCheckCredentials=v,this._databaseId=T,this._app=w,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new FirestoreSettingsImpl({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new FirestoreError(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(r){if(this._settingsFrozen)throw new FirestoreError(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new FirestoreSettingsImpl(r),this._emulatorOptions=r.emulatorOptions||{},r.credentials!==void 0&&(this._authCredentials=function(T){if(!T)return new __PRIVATE_EmptyAuthCredentialsProvider;switch(T.type){case"firstParty":return new __PRIVATE_FirstPartyAuthCredentialsProvider(T.sessionIndex||"0",T.iamToken||null,T.authTokenFactory||null);case"provider":return T.client;default:throw new FirestoreError(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(r.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(v){const T=sn.get(v);T&&(__PRIVATE_logDebug("ComponentProvider","Removing Datastore"),sn.delete(v),T.terminate())}(this),Promise.resolve()}}function connectFirestoreEmulator(E,r,v,T={}){var w;E=__PRIVATE_cast(E,Firestore$1);const S=isCloudWorkstation(r),I=E._getSettings(),H=Object.assign(Object.assign({},I),{emulatorOptions:E._getEmulatorOptions()}),te=`${r}:${v}`;S&&(pingServer(`https://${te}`),updateEmulatorBanner("Firestore",!0)),I.host!==on&&I.host!==te&&__PRIVATE_logWarn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const ae=Object.assign(Object.assign({},I),{host:te,ssl:S,emulatorOptions:T});if(!deepEqual(ae,H)&&(E._setSettings(ae),T.mockUserToken)){let ie,ce;if(typeof T.mockUserToken=="string")ie=T.mockUserToken,ce=User.MOCK_USER;else{ie=createMockUserToken(T.mockUserToken,(w=E._app)===null||w===void 0?void 0:w.options.projectId);const me=T.mockUserToken.sub||T.mockUserToken.user_id;if(!me)throw new FirestoreError(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");ce=new User(me)}E._authCredentials=new __PRIVATE_EmulatorAuthCredentialsProvider(new __PRIVATE_OAuthToken(ie,ce))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Query{constructor(r,v,T){this.converter=v,this._query=T,this.type="query",this.firestore=r}withConverter(r){return new Query(this.firestore,r,this._query)}}class DocumentReference{constructor(r,v,T){this.converter=v,this._key=T,this.type="document",this.firestore=r}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new CollectionReference(this.firestore,this.converter,this._key.path.popLast())}withConverter(r){return new DocumentReference(this.firestore,r,this._key)}}class CollectionReference extends Query{constructor(r,v,T){super(r,v,__PRIVATE_newQueryForPath(T)),this._path=T,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const r=this._path.popLast();return r.isEmpty()?null:new DocumentReference(this.firestore,null,new DocumentKey(r))}withConverter(r){return new CollectionReference(this.firestore,r,this._path)}}function collection(E,r,...v){if(E=getModularInstance(E),__PRIVATE_validateNonEmptyArgument("collection","path",r),E instanceof Firestore$1){const T=ResourcePath.fromString(r,...v);return __PRIVATE_validateCollectionPath(T),new CollectionReference(E,null,T)}{if(!(E instanceof DocumentReference||E instanceof CollectionReference))throw new FirestoreError(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const T=E._path.child(ResourcePath.fromString(r,...v));return __PRIVATE_validateCollectionPath(T),new CollectionReference(E.firestore,null,T)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const an="AsyncQueue";class __PRIVATE_AsyncQueueImpl{constructor(r=Promise.resolve()){this.zu=[],this.ju=!1,this.Hu=[],this.Ju=null,this.Yu=!1,this.Zu=!1,this.Xu=[],this.C_=new __PRIVATE_ExponentialBackoff(this,"async_queue_retry"),this.ec=()=>{const T=getDocument();T&&__PRIVATE_logDebug(an,"Visibility state changed to "+T.visibilityState),this.C_.p_()},this.tc=r;const v=getDocument();v&&typeof v.addEventListener=="function"&&v.addEventListener("visibilitychange",this.ec)}get isShuttingDown(){return this.ju}enqueueAndForget(r){this.enqueue(r)}enqueueAndForgetEvenWhileRestricted(r){this.nc(),this.rc(r)}enterRestrictedMode(r){if(!this.ju){this.ju=!0,this.Zu=r||!1;const v=getDocument();v&&typeof v.removeEventListener=="function"&&v.removeEventListener("visibilitychange",this.ec)}}enqueue(r){if(this.nc(),this.ju)return new Promise(()=>{});const v=new __PRIVATE_Deferred;return this.rc(()=>this.ju&&this.Zu?Promise.resolve():(r().then(v.resolve,v.reject),v.promise)).then(()=>v.promise)}enqueueRetryable(r){this.enqueueAndForget(()=>(this.zu.push(r),this.sc()))}async sc(){if(this.zu.length!==0){try{await this.zu[0](),this.zu.shift(),this.C_.reset()}catch(r){if(!__PRIVATE_isIndexedDbTransactionError(r))throw r;__PRIVATE_logDebug(an,"Operation failed with retryable error: "+r)}this.zu.length>0&&this.C_.f_(()=>this.sc())}}rc(r){const v=this.tc.then(()=>(this.Yu=!0,r().catch(T=>{throw this.Ju=T,this.Yu=!1,__PRIVATE_logError("INTERNAL UNHANDLED ERROR: ",__PRIVATE_getMessageOrStack(T)),T}).then(T=>(this.Yu=!1,T))));return this.tc=v,v}enqueueAfterDelay(r,v,T){this.nc(),this.Xu.indexOf(r)>-1&&(v=0);const w=DelayedOperation.createAndSchedule(this,r,v,T,S=>this.oc(S));return this.Hu.push(w),w}nc(){this.Ju&&fail(47125,{_c:__PRIVATE_getMessageOrStack(this.Ju)})}verifyOperationInProgress(){}async ac(){let r;do r=this.tc,await r;while(r!==this.tc)}uc(r){for(const v of this.Hu)if(v.timerId===r)return!0;return!1}cc(r){return this.ac().then(()=>{this.Hu.sort((v,T)=>v.targetTimeMs-T.targetTimeMs);for(const v of this.Hu)if(v.skipDelay(),r!=="all"&&v.timerId===r)break;return this.ac()})}lc(r){this.Xu.push(r)}oc(r){const v=this.Hu.indexOf(r);this.Hu.splice(v,1)}}function __PRIVATE_getMessageOrStack(E){let r=E.message||"";return E.stack&&(r=E.stack.includes(E.message)?E.stack:E.message+`
`+E.stack),r}class Firestore extends Firestore$1{constructor(r,v,T,w){super(r,v,T,w),this.type="firestore",this._queue=new __PRIVATE_AsyncQueueImpl,this._persistenceKey=(w==null?void 0:w.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const r=this._firestoreClient.terminate();this._queue=new __PRIVATE_AsyncQueueImpl(r),this._firestoreClient=void 0,await r}}}function getFirestore(E,r){const v=typeof E=="object"?E:getApp(),T=typeof E=="string"?E:ut,w=_getProvider(v,"firestore").getImmediate({identifier:T});if(!w._initialized){const S=getDefaultEmulatorHostnameAndPort("firestore");S&&connectFirestoreEmulator(w,...S)}return w}function ensureFirestoreConfigured(E){if(E._terminated)throw new FirestoreError(N.FAILED_PRECONDITION,"The client has already been terminated.");return E._firestoreClient||__PRIVATE_configureFirestore(E),E._firestoreClient}function __PRIVATE_configureFirestore(E){var r,v,T;const w=E._freezeSettings(),S=function(H,te,ae,ie){return new DatabaseInfo(H,te,ae,ie.host,ie.ssl,ie.experimentalForceLongPolling,ie.experimentalAutoDetectLongPolling,__PRIVATE_cloneLongPollingOptions(ie.experimentalLongPollingOptions),ie.useFetchStreams,ie.isUsingEmulator)}(E._databaseId,((r=E._app)===null||r===void 0?void 0:r.options.appId)||"",E._persistenceKey,w);E._componentsProvider||!((v=w.localCache)===null||v===void 0)&&v._offlineComponentProvider&&(!((T=w.localCache)===null||T===void 0)&&T._onlineComponentProvider)&&(E._componentsProvider={_offline:w.localCache._offlineComponentProvider,_online:w.localCache._onlineComponentProvider}),E._firestoreClient=new FirestoreClient(E._authCredentials,E._appCheckCredentials,E._queue,S,E._componentsProvider&&function(H){const te=H==null?void 0:H._online.build();return{_offline:H==null?void 0:H._offline.build(te),_online:te}}(E._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bytes{constructor(r){this._byteString=r}static fromBase64String(r){try{return new Bytes(ByteString.fromBase64String(r))}catch(v){throw new FirestoreError(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+v)}}static fromUint8Array(r){return new Bytes(ByteString.fromUint8Array(r))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(r){return this._byteString.isEqual(r._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FieldPath{constructor(...r){for(let v=0;v<r.length;++v)if(r[v].length===0)throw new FirestoreError(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new FieldPath$1(r)}isEqual(r){return this._internalPath.isEqual(r._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FieldValue{constructor(r){this._methodName=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GeoPoint{constructor(r,v){if(!isFinite(r)||r<-90||r>90)throw new FirestoreError(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+r);if(!isFinite(v)||v<-180||v>180)throw new FirestoreError(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+v);this._lat=r,this._long=v}get latitude(){return this._lat}get longitude(){return this._long}isEqual(r){return this._lat===r._lat&&this._long===r._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(r){return __PRIVATE_primitiveComparator(this._lat,r._lat)||__PRIVATE_primitiveComparator(this._long,r._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VectorValue{constructor(r){this._values=(r||[]).map(v=>v)}toArray(){return this._values.map(r=>r)}isEqual(r){return function(T,w){if(T.length!==w.length)return!1;for(let S=0;S<T.length;++S)if(T[S]!==w[S])return!1;return!0}(this._values,r._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cn=/^__.*__$/;function __PRIVATE_isWrite(E){switch(E){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw fail(40011,{hc:E})}}class __PRIVATE_ParseContextImpl{constructor(r,v,T,w,S,I){this.settings=r,this.databaseId=v,this.serializer=T,this.ignoreUndefinedProperties=w,S===void 0&&this.Pc(),this.fieldTransforms=S||[],this.fieldMask=I||[]}get path(){return this.settings.path}get hc(){return this.settings.hc}Tc(r){return new __PRIVATE_ParseContextImpl(Object.assign(Object.assign({},this.settings),r),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ic(r){var v;const T=(v=this.path)===null||v===void 0?void 0:v.child(r),w=this.Tc({path:T,Ec:!1});return w.dc(r),w}Ac(r){var v;const T=(v=this.path)===null||v===void 0?void 0:v.child(r),w=this.Tc({path:T,Ec:!1});return w.Pc(),w}Rc(r){return this.Tc({path:void 0,Ec:!0})}Vc(r){return __PRIVATE_createError(r,this.settings.methodName,this.settings.mc||!1,this.path,this.settings.fc)}contains(r){return this.fieldMask.find(v=>r.isPrefixOf(v))!==void 0||this.fieldTransforms.find(v=>r.isPrefixOf(v.field))!==void 0}Pc(){if(this.path)for(let r=0;r<this.path.length;r++)this.dc(this.path.get(r))}dc(r){if(r.length===0)throw this.Vc("Document fields must not be empty");if(__PRIVATE_isWrite(this.hc)&&cn.test(r))throw this.Vc('Document fields cannot begin and end with "__"')}}class __PRIVATE_UserDataReader{constructor(r,v,T){this.databaseId=r,this.ignoreUndefinedProperties=v,this.serializer=T||__PRIVATE_newSerializer(r)}gc(r,v,T,w=!1){return new __PRIVATE_ParseContextImpl({hc:r,methodName:v,fc:T,path:FieldPath$1.emptyPath(),Ec:!1,mc:w},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function __PRIVATE_newUserDataReader(E){const r=E._freezeSettings(),v=__PRIVATE_newSerializer(E._databaseId);return new __PRIVATE_UserDataReader(E._databaseId,!!r.ignoreUndefinedProperties,v)}function __PRIVATE_parseQueryValue(E,r,v,T=!1){return __PRIVATE_parseData(v,E.gc(T?4:3,r))}function __PRIVATE_parseData(E,r){if(__PRIVATE_looksLikeJsonObject(E=getModularInstance(E)))return __PRIVATE_validatePlainObject("Unsupported field value:",r,E),__PRIVATE_parseObject(E,r);if(E instanceof FieldValue)return function(T,w){if(!__PRIVATE_isWrite(w.hc))throw w.Vc(`${T._methodName}() can only be used with update() and set()`);if(!w.path)throw w.Vc(`${T._methodName}() is not currently supported inside arrays`);const S=T._toFieldTransform(w);S&&w.fieldTransforms.push(S)}(E,r),null;if(E===void 0&&r.ignoreUndefinedProperties)return null;if(r.path&&r.fieldMask.push(r.path),E instanceof Array){if(r.settings.Ec&&r.hc!==4)throw r.Vc("Nested arrays are not supported");return function(T,w){const S=[];let I=0;for(const H of T){let te=__PRIVATE_parseData(H,w.Rc(I));te==null&&(te={nullValue:"NULL_VALUE"}),S.push(te),I++}return{arrayValue:{values:S}}}(E,r)}return function(T,w){if((T=getModularInstance(T))===null)return{nullValue:"NULL_VALUE"};if(typeof T=="number")return toNumber(w.serializer,T);if(typeof T=="boolean")return{booleanValue:T};if(typeof T=="string")return{stringValue:T};if(T instanceof Date){const S=Timestamp.fromDate(T);return{timestampValue:toTimestamp(w.serializer,S)}}if(T instanceof Timestamp){const S=new Timestamp(T.seconds,1e3*Math.floor(T.nanoseconds/1e3));return{timestampValue:toTimestamp(w.serializer,S)}}if(T instanceof GeoPoint)return{geoPointValue:{latitude:T.latitude,longitude:T.longitude}};if(T instanceof Bytes)return{bytesValue:__PRIVATE_toBytes(w.serializer,T._byteString)};if(T instanceof DocumentReference){const S=w.databaseId,I=T.firestore._databaseId;if(!I.isEqual(S))throw w.Vc(`Document reference is for database ${I.projectId}/${I.database} but should be for database ${S.projectId}/${S.database}`);return{referenceValue:__PRIVATE_toResourceName(T.firestore._databaseId||w.databaseId,T._key.path)}}if(T instanceof VectorValue)return function(I,H){return{mapValue:{fields:{[ct]:{stringValue:Pt},[Tt]:{arrayValue:{values:I.toArray().map(ae=>{if(typeof ae!="number")throw H.Vc("VectorValues must only contain numeric values.");return __PRIVATE_toDouble(H.serializer,ae)})}}}}}}(T,w);throw w.Vc(`Unsupported field value: ${__PRIVATE_valueDescription(T)}`)}(E,r)}function __PRIVATE_parseObject(E,r){const v={};return isEmpty(E)?r.path&&r.path.length>0&&r.fieldMask.push(r.path):forEach(E,(T,w)=>{const S=__PRIVATE_parseData(w,r.Ic(T));S!=null&&(v[T]=S)}),{mapValue:{fields:v}}}function __PRIVATE_looksLikeJsonObject(E){return!(typeof E!="object"||E===null||E instanceof Array||E instanceof Date||E instanceof Timestamp||E instanceof GeoPoint||E instanceof Bytes||E instanceof DocumentReference||E instanceof FieldValue||E instanceof VectorValue)}function __PRIVATE_validatePlainObject(E,r,v){if(!__PRIVATE_looksLikeJsonObject(v)||!function(w){return typeof w=="object"&&w!==null&&(Object.getPrototypeOf(w)===Object.prototype||Object.getPrototypeOf(w)===null)}(v)){const T=__PRIVATE_valueDescription(v);throw T==="an object"?r.Vc(E+" a custom object"):r.Vc(E+" "+T)}}const ln=new RegExp("[~\\*/\\[\\]]");function __PRIVATE_fieldPathFromDotSeparatedString(E,r,v){if(r.search(ln)>=0)throw __PRIVATE_createError(`Invalid field path (${r}). Paths must not contain '~', '*', '/', '[', or ']'`,E,!1,void 0,v);try{return new FieldPath(...r.split("."))._internalPath}catch{throw __PRIVATE_createError(`Invalid field path (${r}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,E,!1,void 0,v)}}function __PRIVATE_createError(E,r,v,T,w){const S=T&&!T.isEmpty(),I=w!==void 0;let H=`Function ${r}() called with invalid data`;v&&(H+=" (via `toFirestore()`)"),H+=". ";let te="";return(S||I)&&(te+=" (found",S&&(te+=` in field ${T}`),I&&(te+=` in document ${w}`),te+=")"),new FirestoreError(N.INVALID_ARGUMENT,H+E+te)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DocumentSnapshot$1{constructor(r,v,T,w,S){this._firestore=r,this._userDataWriter=v,this._key=T,this._document=w,this._converter=S}get id(){return this._key.path.lastSegment()}get ref(){return new DocumentReference(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const r=new QueryDocumentSnapshot$1(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(r)}return this._userDataWriter.convertValue(this._document.data.value)}}get(r){if(this._document){const v=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",r));if(v!==null)return this._userDataWriter.convertValue(v)}}}class QueryDocumentSnapshot$1 extends DocumentSnapshot$1{data(){return super.data()}}function __PRIVATE_fieldPathFromArgument(E,r){return typeof r=="string"?__PRIVATE_fieldPathFromDotSeparatedString(E,r):r instanceof FieldPath?r._internalPath:r._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function __PRIVATE_validateHasExplicitOrderByForLimitToLast(E){if(E.limitType==="L"&&E.explicitOrderBy.length===0)throw new FirestoreError(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class AppliableConstraint{}class QueryConstraint extends AppliableConstraint{}function query(E,r,...v){let T=[];r instanceof AppliableConstraint&&T.push(r),T=T.concat(v),function(S){const I=S.filter(te=>te instanceof QueryCompositeFilterConstraint).length,H=S.filter(te=>te instanceof QueryFieldFilterConstraint).length;if(I>1||I>0&&H>0)throw new FirestoreError(N.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(T);for(const w of T)E=w._apply(E);return E}class QueryFieldFilterConstraint extends QueryConstraint{constructor(r,v,T){super(),this._field=r,this._op=v,this._value=T,this.type="where"}static _create(r,v,T){return new QueryFieldFilterConstraint(r,v,T)}_apply(r){const v=this._parse(r);return __PRIVATE_validateNewFieldFilter(r._query,v),new Query(r.firestore,r.converter,__PRIVATE_queryWithAddedFilter(r._query,v))}_parse(r){const v=__PRIVATE_newUserDataReader(r.firestore);return function(S,I,H,te,ae,ie,ce){let me;if(ae.isKeyField()){if(ie==="array-contains"||ie==="array-contains-any")throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid Query. You can't perform '${ie}' queries on documentId().`);if(ie==="in"||ie==="not-in"){__PRIVATE_validateDisjunctiveFilterElements(ce,ie);const Re=[];for(const Pe of ce)Re.push(__PRIVATE_parseDocumentIdValue(te,S,Pe));me={arrayValue:{values:Re}}}else me=__PRIVATE_parseDocumentIdValue(te,S,ce)}else ie!=="in"&&ie!=="not-in"&&ie!=="array-contains-any"||__PRIVATE_validateDisjunctiveFilterElements(ce,ie),me=__PRIVATE_parseQueryValue(H,I,ce,ie==="in"||ie==="not-in");return FieldFilter.create(ae,ie,me)}(r._query,"where",v,r.firestore._databaseId,this._field,this._op,this._value)}}class QueryCompositeFilterConstraint extends AppliableConstraint{constructor(r,v){super(),this.type=r,this._queryConstraints=v}static _create(r,v){return new QueryCompositeFilterConstraint(r,v)}_parse(r){const v=this._queryConstraints.map(T=>T._parse(r)).filter(T=>T.getFilters().length>0);return v.length===1?v[0]:CompositeFilter.create(v,this._getOperator())}_apply(r){const v=this._parse(r);return v.getFilters().length===0?r:(function(w,S){let I=w;const H=S.getFlattenedFilters();for(const te of H)__PRIVATE_validateNewFieldFilter(I,te),I=__PRIVATE_queryWithAddedFilter(I,te)}(r._query,v),new Query(r.firestore,r.converter,__PRIVATE_queryWithAddedFilter(r._query,v)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class QueryLimitConstraint extends QueryConstraint{constructor(r,v,T){super(),this.type=r,this._limit=v,this._limitType=T}static _create(r,v,T){return new QueryLimitConstraint(r,v,T)}_apply(r){return new Query(r.firestore,r.converter,__PRIVATE_queryWithLimit(r._query,this._limit,this._limitType))}}function limit(E){return QueryLimitConstraint._create("limit",E,"F")}function __PRIVATE_parseDocumentIdValue(E,r,v){if(typeof(v=getModularInstance(v))=="string"){if(v==="")throw new FirestoreError(N.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!__PRIVATE_isCollectionGroupQuery(r)&&v.indexOf("/")!==-1)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${v}' contains a '/' character.`);const T=r.path.child(ResourcePath.fromString(v));if(!DocumentKey.isDocumentKey(T))throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${T}' is not because it has an odd number of segments (${T.length}).`);return __PRIVATE_refValue(E,new DocumentKey(T))}if(v instanceof DocumentReference)return __PRIVATE_refValue(E,v._key);throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${__PRIVATE_valueDescription(v)}.`)}function __PRIVATE_validateDisjunctiveFilterElements(E,r){if(!Array.isArray(E)||E.length===0)throw new FirestoreError(N.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${r.toString()}' filters.`)}function __PRIVATE_validateNewFieldFilter(E,r){const v=function(w,S){for(const I of w)for(const H of I.getFlattenedFilters())if(S.indexOf(H.op)>=0)return H.op;return null}(E.filters,function(w){switch(w){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(r.op));if(v!==null)throw v===r.op?new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${r.op.toString()}' filter.`):new FirestoreError(N.INVALID_ARGUMENT,`Invalid query. You cannot use '${r.op.toString()}' filters with '${v.toString()}' filters.`)}class AbstractUserDataWriter{convertValue(r,v="none"){switch(__PRIVATE_typeOrder(r)){case 0:return null;case 1:return r.booleanValue;case 2:return __PRIVATE_normalizeNumber(r.integerValue||r.doubleValue);case 3:return this.convertTimestamp(r.timestampValue);case 4:return this.convertServerTimestamp(r,v);case 5:return r.stringValue;case 6:return this.convertBytes(__PRIVATE_normalizeByteString(r.bytesValue));case 7:return this.convertReference(r.referenceValue);case 8:return this.convertGeoPoint(r.geoPointValue);case 9:return this.convertArray(r.arrayValue,v);case 11:return this.convertObject(r.mapValue,v);case 10:return this.convertVectorValue(r.mapValue);default:throw fail(62114,{value:r})}}convertObject(r,v){return this.convertObjectMap(r.fields,v)}convertObjectMap(r,v="none"){const T={};return forEach(r,(w,S)=>{T[w]=this.convertValue(S,v)}),T}convertVectorValue(r){var v,T,w;const S=(w=(T=(v=r.fields)===null||v===void 0?void 0:v[Tt].arrayValue)===null||T===void 0?void 0:T.values)===null||w===void 0?void 0:w.map(I=>__PRIVATE_normalizeNumber(I.doubleValue));return new VectorValue(S)}convertGeoPoint(r){return new GeoPoint(__PRIVATE_normalizeNumber(r.latitude),__PRIVATE_normalizeNumber(r.longitude))}convertArray(r,v){return(r.values||[]).map(T=>this.convertValue(T,v))}convertServerTimestamp(r,v){switch(v){case"previous":const T=__PRIVATE_getPreviousValue(r);return T==null?null:this.convertValue(T,v);case"estimate":return this.convertTimestamp(__PRIVATE_getLocalWriteTime(r));default:return null}}convertTimestamp(r){const v=__PRIVATE_normalizeTimestamp(r);return new Timestamp(v.seconds,v.nanos)}convertDocumentKey(r,v){const T=ResourcePath.fromString(r);__PRIVATE_hardAssert(__PRIVATE_isValidResourceName(T),9688,{name:r});const w=new DatabaseId(T.get(1),T.get(3)),S=new DocumentKey(T.popFirst(5));return w.isEqual(v)||__PRIVATE_logError(`Document ${S} contains a document reference within a different database (${w.projectId}/${w.database}) which is not supported. It will be treated as a reference in the current database (${v.projectId}/${v.database}) instead.`),S}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SnapshotMetadata{constructor(r,v){this.hasPendingWrites=r,this.fromCache=v}isEqual(r){return this.hasPendingWrites===r.hasPendingWrites&&this.fromCache===r.fromCache}}class DocumentSnapshot extends DocumentSnapshot$1{constructor(r,v,T,w,S,I){super(r,v,T,w,I),this._firestore=r,this._firestoreImpl=r,this.metadata=S}exists(){return super.exists()}data(r={}){if(this._document){if(this._converter){const v=new QueryDocumentSnapshot(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(v,r)}return this._userDataWriter.convertValue(this._document.data.value,r.serverTimestamps)}}get(r,v={}){if(this._document){const T=this._document.data.field(__PRIVATE_fieldPathFromArgument("DocumentSnapshot.get",r));if(T!==null)return this._userDataWriter.convertValue(T,v.serverTimestamps)}}}class QueryDocumentSnapshot extends DocumentSnapshot{data(r={}){return super.data(r)}}class QuerySnapshot{constructor(r,v,T,w){this._firestore=r,this._userDataWriter=v,this._snapshot=w,this.metadata=new SnapshotMetadata(w.hasPendingWrites,w.fromCache),this.query=T}get docs(){const r=[];return this.forEach(v=>r.push(v)),r}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(r,v){this._snapshot.docs.forEach(T=>{r.call(v,new QueryDocumentSnapshot(this._firestore,this._userDataWriter,T.key,T,new SnapshotMetadata(this._snapshot.mutatedKeys.has(T.key),this._snapshot.fromCache),this.query.converter))})}docChanges(r={}){const v=!!r.includeMetadataChanges;if(v&&this._snapshot.excludesMetadataChanges)throw new FirestoreError(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===v||(this._cachedChanges=function(w,S){if(w._snapshot.oldDocs.isEmpty()){let I=0;return w._snapshot.docChanges.map(H=>{const te=new QueryDocumentSnapshot(w._firestore,w._userDataWriter,H.doc.key,H.doc,new SnapshotMetadata(w._snapshot.mutatedKeys.has(H.doc.key),w._snapshot.fromCache),w.query.converter);return H.doc,{type:"added",doc:te,oldIndex:-1,newIndex:I++}})}{let I=w._snapshot.oldDocs;return w._snapshot.docChanges.filter(H=>S||H.type!==3).map(H=>{const te=new QueryDocumentSnapshot(w._firestore,w._userDataWriter,H.doc.key,H.doc,new SnapshotMetadata(w._snapshot.mutatedKeys.has(H.doc.key),w._snapshot.fromCache),w.query.converter);let ae=-1,ie=-1;return H.type!==0&&(ae=I.indexOf(H.doc.key),I=I.delete(H.doc.key)),H.type!==1&&(I=I.add(H.doc),ie=I.indexOf(H.doc.key)),{type:__PRIVATE_resultChangeType(H.type),doc:te,oldIndex:ae,newIndex:ie}})}}(this,v),this._cachedChangesIncludeMetadataChanges=v),this._cachedChanges}}function __PRIVATE_resultChangeType(E){switch(E){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return fail(61501,{type:E})}}class __PRIVATE_ExpUserDataWriter extends AbstractUserDataWriter{constructor(r){super(),this.firestore=r}convertBytes(r){return new Bytes(r)}convertReference(r){const v=this.convertDocumentKey(r,this.firestore._databaseId);return new DocumentReference(this.firestore,null,v)}}function getDocs(E){E=__PRIVATE_cast(E,Query);const r=__PRIVATE_cast(E.firestore,Firestore),v=ensureFirestoreConfigured(r),T=new __PRIVATE_ExpUserDataWriter(r);return __PRIVATE_validateHasExplicitOrderByForLimitToLast(E._query),__PRIVATE_firestoreClientGetDocumentsViaSnapshotListener(v,E._query).then(w=>new QuerySnapshot(r,T,E,w))}(function E(r,v=!0){(function(w){x=w})(SDK_VERSION),_registerComponent(new Component("firestore",(T,{instanceIdentifier:w,options:S})=>{const I=T.getProvider("app").getImmediate(),H=new Firestore(new __PRIVATE_FirebaseAuthCredentialsProvider(T.getProvider("auth-internal")),new __PRIVATE_FirebaseAppCheckTokenProvider(I,T.getProvider("app-check-internal")),function(ae,ie){if(!Object.prototype.hasOwnProperty.apply(ae.options,["projectId"]))throw new FirestoreError(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new DatabaseId(ae.options.projectId,ie)}(I,w),I);return S=Object.assign({useFetchStreams:v},S),H._setSettings(S),H},"PUBLIC").setMultipleInstances(!0)),registerVersion(F,M,r),registerVersion(F,M,"esm2017")})();var define_process_env_default={};const firebaseConfig={apiKey:define_process_env_default.VITE_FIREBASE_API_KEY,authDomain:define_process_env_default.VITE_FIREBASE_AUTH_DOMAIN,projectId:define_process_env_default.VITE_FIREBASE_PROJECT_ID,storageBucket:define_process_env_default.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:define_process_env_default.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:define_process_env_default.VITE_FIREBASE_APP_ID},app=initializeApp(firebaseConfig);getStorage(app);const db=getFirestore(app),FirebaseViewer=()=>{const[E,r]=reactExports.useState({backups:[],backupsMetadata:[],gmm:[],autos:[],loading:!0,error:null,debug:[]});reactExports.useEffect(()=>{T()},[]);const v=w=>{r(S=>({...S,debug:[...S.debug,`${new Date().toISOString()}: ${w}`]}))},T=async()=>{try{v("Iniciando carga de datos...");try{v("Intentando obtener datos de GMM...");const w=collection(db,"gmm"),S=query(w,limit(10)),H=(await getDocs(S)).docs.map(te=>({id:te.id,...te.data()}));v(`GMM datos obtenidos: ${H.length} documentos`)}catch(w){v(`Error al obtener GMM: ${w.message}`)}try{v("Intentando obtener datos de Autos...");const w=collection(db,"autos"),S=query(w,limit(10)),H=(await getDocs(S)).docs.map(te=>({id:te.id,...te.data()}));v(`Autos datos obtenidos: ${H.length} documentos`)}catch(w){v(`Error al obtener Autos: ${w.message}`)}try{v("Intentando obtener metadata de backups...");const w=collection(db,"backups_metadata"),I=(await getDocs(w)).docs.map(H=>{var te,ae;return{id:H.id,...H.data(),timestamp:(ae=(te=H.data().timestamp)==null?void 0:te.toDate())==null?void 0:ae.toLocaleString()}});v(`Backups metadata obtenidos: ${I.length} documentos`)}catch(w){v(`Error al obtener backups metadata: ${w.message}`)}try{v("Intentando obtener backups...");const w=collection(db,"backups"),I=(await getDocs(w)).docs.map(H=>{var te,ae;return{id:H.id,...H.data(),timestamp:(ae=(te=H.data().timestamp)==null?void 0:te.toDate())==null?void 0:ae.toLocaleString()}});v(`Backups obtenidos: ${I.length} documentos`)}catch(w){v(`Error al obtener backups: ${w.message}`)}r(w=>({...w,loading:!1,error:null})),v("Carga de datos completada")}catch(w){console.error("Error loading Firebase data:",w),r(S=>({...S,loading:!1,error:w.message})),v(`Error general: ${w.message}`)}};return E.loading?jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{children:"Cargando datos de Firebase..."}),jsxRuntimeExports.jsxs("div",{style:{marginTop:"20px"},children:[jsxRuntimeExports.jsx("h4",{children:"Debug Log:"}),E.debug.map((w,S)=>jsxRuntimeExports.jsx("div",{style:{fontFamily:"monospace",fontSize:"12px"},children:w},S))]})]}):jsxRuntimeExports.jsxs("div",{style:{padding:"20px"},children:[jsxRuntimeExports.jsx("h2",{children:"Datos en Firebase"}),jsxRuntimeExports.jsxs("div",{style:{marginBottom:"20px"},children:[jsxRuntimeExports.jsx("h4",{children:"Debug Log:"}),E.debug.map((w,S)=>jsxRuntimeExports.jsx("div",{style:{fontFamily:"monospace",fontSize:"12px"},children:w},S))]}),E.error&&jsxRuntimeExports.jsxs("div",{style:{color:"red",marginBottom:"20px"},children:["Error: ",E.error]}),jsxRuntimeExports.jsxs("h3",{children:["GMM (",E.gmm.length," registros)"]}),jsxRuntimeExports.jsx("div",{style:{maxHeight:"300px",overflow:"auto",marginBottom:"20px"},children:E.gmm.map(w=>jsxRuntimeExports.jsxs("div",{style:{marginBottom:"10px",padding:"10px",border:"1px solid #ccc"},children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"ID:"})," ",w.id]}),jsxRuntimeExports.jsx("pre",{children:JSON.stringify(w,null,2)})]},w.id))}),jsxRuntimeExports.jsxs("h3",{children:["Autos (",E.autos.length," registros)"]}),jsxRuntimeExports.jsx("div",{style:{maxHeight:"300px",overflow:"auto",marginBottom:"20px"},children:E.autos.map(w=>jsxRuntimeExports.jsxs("div",{style:{marginBottom:"10px",padding:"10px",border:"1px solid #ccc"},children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"ID:"})," ",w.id]}),jsxRuntimeExports.jsx("pre",{children:JSON.stringify(w,null,2)})]},w.id))}),jsxRuntimeExports.jsxs("h3",{children:["Backups Metadata (",E.backupsMetadata.length,")"]}),jsxRuntimeExports.jsx("div",{style:{maxHeight:"300px",overflow:"auto",marginBottom:"20px"},children:E.backupsMetadata.map(w=>jsxRuntimeExports.jsxs("div",{style:{marginBottom:"10px",padding:"10px",border:"1px solid #ccc"},children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"ID:"})," ",w.id]}),jsxRuntimeExports.jsx("pre",{children:JSON.stringify(w,null,2)})]},w.id))}),jsxRuntimeExports.jsxs("h3",{children:["Backups (",E.backups.length,")"]}),jsxRuntimeExports.jsx("div",{style:{maxHeight:"300px",overflow:"auto"},children:E.backups.map(w=>jsxRuntimeExports.jsxs("div",{style:{marginBottom:"10px",padding:"10px",border:"1px solid #ccc"},children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("strong",{children:"ID:"})," ",w.id]}),jsxRuntimeExports.jsx("pre",{children:JSON.stringify(w,null,2)})]},w.id))})]})},API_BASE_URL=API_URL;class DirectorioService{async getContactos(r={}){try{const v=new URLSearchParams;Object.keys(r).forEach(S=>{r[S]!==null&&r[S]!==void 0&&r[S]!==""&&v.append(S,r[S])});const T=`${API_BASE_URL}/directorio${v.toString()?`?${v.toString()}`:""}`,w=await fetch(T);if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);return await w.json()}catch(v){throw console.error("Error fetching contacts:",v),v}}async getContactoById(r){try{const v=await fetch(`${API_BASE_URL}/directorio/${r}`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return await v.json()}catch(v){throw console.error("Error fetching contacto:",v),v}}async createContacto(r){try{const v=await fetch(`${API_BASE_URL}/directorio`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return await v.json()}catch(v){throw console.error("Error creating contacto:",v),v}}async updateContacto(r,v){try{const T=await fetch(`${API_BASE_URL}/directorio/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!T.ok)throw new Error(`HTTP error! status: ${T.status}`);return await T.json()}catch(T){throw console.error("Error updating contacto:",T),T}}async deleteContacto(r){try{const v=await fetch(`${API_BASE_URL}/directorio/${r}`,{method:"DELETE"});if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return await v.json()}catch(v){throw console.error("Error deleting contacto:",v),v}}async searchContactos(r,v={}){try{const T=new URLSearchParams;T.append("search",r),Object.keys(v).forEach(S=>{v[S]!==void 0&&v[S]!==null&&v[S]!==""&&T.append(S,v[S])});const w=await fetch(`${API_BASE_URL}/directorio?${T.toString()}`);if(!w.ok)throw new Error(`HTTP error! status: ${w.status}`);return await w.json()}catch(T){throw console.error("Error searching contactos:",T),T}}async getStats(){try{const r=await fetch(`${API_BASE_URL}/directorio/stats`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error fetching stats:",r),r}}async linkContactoToCliente(r,v){try{const T=await fetch(`${API_BASE_URL}/directorio/${r}/link-cliente`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(v)});if(!T.ok)throw new Error(`HTTP error! status: ${T.status}`);return await T.json()}catch(T){throw console.error("Error linking contacto to cliente:",T),T}}async getRelationships(){try{const r=await fetch(`${API_BASE_URL}/directorio/relationships`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error fetching relationships:",r),r}}async getContactoPolicies(r){try{const v=await fetch(`${API_BASE_URL}/directorio/${r}/policies`);if(!v.ok)throw new Error(`HTTP error! status: ${v.status}`);return await v.json()}catch(v){throw console.error("Error fetching contacto policies:",v),v}}async updateClientStatus(){try{const r=await fetch(`${API_BASE_URL}/directorio/update-client-status`,{method:"POST",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Error updating client status:",r),r}}}const directorioService=new DirectorioService,ContactoCard=({contacto:E,onClick:r,onDelete:v,onViewPolicies:T,policyTables:w})=>{const S=I=>I?I.replace(/(\d{2})(\d{4})(\d{4})/,"$1 $2 $3"):null;return jsxRuntimeExports.jsxs("div",{className:"contacto-card",onClick:r,children:[jsxRuntimeExports.jsx("div",{className:"contacto-header",children:jsxRuntimeExports.jsx("div",{className:"contacto-avatar",children:E.nombre_completo?E.nombre_completo.charAt(0).toUpperCase():"?"})}),jsxRuntimeExports.jsxs("div",{className:"contacto-info",children:[jsxRuntimeExports.jsx("h3",{className:"contacto-name",children:E.nombre_completo||E.display_name||"Sin nombre"}),E.empresa&&jsxRuntimeExports.jsxs("p",{className:"contacto-empresa",children:["🏢 ",E.empresa]}),E.ocupacion&&jsxRuntimeExports.jsxs("p",{className:"contacto-ocupacion",children:["💼 ",E.ocupacion]}),jsxRuntimeExports.jsxs("div",{className:"contacto-contact",children:[E.email&&jsxRuntimeExports.jsxs("div",{className:"contact-item",children:[jsxRuntimeExports.jsx("span",{className:"contact-icon",children:"📧"}),jsxRuntimeExports.jsx("span",{className:"contact-text",children:E.email})]}),E.telefono_movil&&jsxRuntimeExports.jsxs("div",{className:"contact-item",children:[jsxRuntimeExports.jsx("span",{className:"contact-icon",children:"📱"}),jsxRuntimeExports.jsx("span",{className:"contact-text",children:S(E.telefono_movil)})]}),E.telefono_oficina&&jsxRuntimeExports.jsxs("div",{className:"contact-item",children:[jsxRuntimeExports.jsx("span",{className:"contact-icon",children:"☎️"}),jsxRuntimeExports.jsx("span",{className:"contact-text",children:S(E.telefono_oficina)})]})]}),E.origen&&jsxRuntimeExports.jsx("div",{className:"contacto-origen",children:jsxRuntimeExports.jsx("span",{className:"origen-badge",children:E.origen})}),E.status==="cliente"&&jsxRuntimeExports.jsxs("div",{className:"contacto-policies clickable",onClick:I=>{I.stopPropagation(),T&&T()},title:"Click para ver pólizas",children:[jsxRuntimeExports.jsxs("div",{className:"policies-header",children:[jsxRuntimeExports.jsx("span",{className:"policies-icon",children:"📋"}),jsxRuntimeExports.jsx("span",{className:"policies-label",children:"Pólizas:"})]}),jsxRuntimeExports.jsx("div",{className:"policies-content",children:w?jsxRuntimeExports.jsx("span",{className:"policies-tables",children:w}):jsxRuntimeExports.jsx("span",{className:"policies-loading",children:"Cargando..."})})]}),E.comentario&&jsxRuntimeExports.jsx("div",{className:"contacto-comentario",children:jsxRuntimeExports.jsxs("p",{children:["💬 ",E.comentario.substring(0,100),E.comentario.length>100?"...":""]})})]}),jsxRuntimeExports.jsxs("div",{className:"contacto-actions",children:[jsxRuntimeExports.jsx("button",{className:"btn-edit",onClick:I=>{I.stopPropagation(),r()},title:"Editar contacto",children:"✏️"}),jsxRuntimeExports.jsx("button",{className:"btn-delete",onClick:I=>{I.stopPropagation(),v()},title:"Eliminar contacto",children:"🗑️"})]})]})},ContactoModal=({contacto:E,onSave:r,onClose:v})=>{const[T,w]=reactExports.useState({nombre_completo:"",nombre_completo_oficial:"",nickname:"",apellido:"",display_name:"",empresa:"",telefono_oficina:"",telefono_casa:"",telefono_asistente:"",telefono_movil:"",telefonos_corregidos:"",email:"",entidad:"",genero:"",status_social:"",ocupacion:"",pais:"MÉXICO",status:"prospecto",origen:"",comentario:""}),[S,I]=reactExports.useState(!1),[H,te]=reactExports.useState({});reactExports.useEffect(()=>{E&&w({nombre_completo:E.nombre_completo||"",nombre_completo_oficial:E.nombre_completo_oficial||"",nickname:E.nickname||"",apellido:E.apellido||"",display_name:E.display_name||"",empresa:E.empresa||"",telefono_oficina:E.telefono_oficina||"",telefono_casa:E.telefono_casa||"",telefono_asistente:E.telefono_asistente||"",telefono_movil:E.telefono_movil||"",telefonos_corregidos:E.telefonos_corregidos||"",email:E.email||"",entidad:E.entidad||"",genero:E.genero||"",status_social:E.status_social||"",ocupacion:E.ocupacion||"",pais:E.pais||"MÉXICO",status:E.status||"prospecto",origen:E.origen||"",comentario:E.comentario||""})},[E]);const ae=_e=>{const{name:Re,value:Pe}=_e.target;w(Ce=>({...Ce,[Re]:Pe})),H[Re]&&te(Ce=>({...Ce,[Re]:""}))},ie=()=>{const _e={};return T.nombre_completo.trim()||(_e.nombre_completo="El nombre completo es requerido"),T.email&&!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(T.email)&&(_e.email="El email no tiene un formato válido"),te(_e),Object.keys(_e).length===0},ce=async _e=>{if(_e.preventDefault(),!!ie()){I(!0);try{await r(T)}catch(Re){console.error("Error saving contacto:",Re),alert("Error al guardar el contacto")}finally{I(!1)}}},me=_e=>{_e.target===_e.currentTarget&&v()};return console.log("🎯 ContactoModal RENDERING - contacto:",E,"formData:",T),jsxRuntimeExports.jsx("div",{className:"contacto-modal-overlay",onClick:me,children:jsxRuntimeExports.jsxs("div",{className:"contacto-modal-content",children:[jsxRuntimeExports.jsxs("div",{className:"contacto-modal-header",children:[jsxRuntimeExports.jsx("h2",{children:E?"Editar Contacto":"Nuevo Contacto"}),jsxRuntimeExports.jsx("button",{className:"contacto-modal-close",onClick:v,children:"×"})]}),jsxRuntimeExports.jsxs("form",{onSubmit:ce,className:"contacto-form",children:[jsxRuntimeExports.jsxs("div",{className:"form-grid",children:[jsxRuntimeExports.jsxs("div",{className:"form-section",children:[jsxRuntimeExports.jsx("h3",{children:"Información Básica"}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"nombre_completo",children:"Nombre Completo *"}),jsxRuntimeExports.jsx("input",{type:"text",id:"nombre_completo",name:"nombre_completo",value:T.nombre_completo,onChange:ae,className:H.nombre_completo?"error":"",required:!0}),H.nombre_completo&&jsxRuntimeExports.jsx("span",{className:"error-text",children:H.nombre_completo})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"nombre_completo_oficial",children:"Nombre Completo Oficial"}),jsxRuntimeExports.jsx("input",{type:"text",id:"nombre_completo_oficial",name:"nombre_completo_oficial",value:T.nombre_completo_oficial,onChange:ae,placeholder:"Nombre oficial o legal (si es diferente)"})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"nickname",children:"Nickname"}),jsxRuntimeExports.jsx("input",{type:"text",id:"nickname",name:"nickname",value:T.nickname,onChange:ae})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"apellido",children:"Apellido"}),jsxRuntimeExports.jsx("input",{type:"text",id:"apellido",name:"apellido",value:T.apellido,onChange:ae})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"display_name",children:"Nombre de Pantalla"}),jsxRuntimeExports.jsx("input",{type:"text",id:"display_name",name:"display_name",value:T.display_name,onChange:ae,placeholder:"Nombre como se mostrará en el sistema"})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"genero",children:"Género"}),jsxRuntimeExports.jsxs("select",{id:"genero",name:"genero",value:T.genero,onChange:ae,children:[jsxRuntimeExports.jsx("option",{value:"",children:"Seleccionar"}),jsxRuntimeExports.jsx("option",{value:"MASCULINO",children:"Masculino"}),jsxRuntimeExports.jsx("option",{value:"FEMENINO",children:"Femenino"}),jsxRuntimeExports.jsx("option",{value:"OTRO",children:"Otro"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"form-section",children:[jsxRuntimeExports.jsx("h3",{children:"Información de Contacto"}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"email",children:"Email"}),jsxRuntimeExports.jsx("input",{type:"email",id:"email",name:"email",value:T.email,onChange:ae,className:H.email?"error":""}),H.email&&jsxRuntimeExports.jsx("span",{className:"error-text",children:H.email})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"telefono_movil",children:"Teléfono Móvil"}),jsxRuntimeExports.jsx("input",{type:"tel",id:"telefono_movil",name:"telefono_movil",value:T.telefono_movil,onChange:ae})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"telefono_oficina",children:"Teléfono Oficina"}),jsxRuntimeExports.jsx("input",{type:"tel",id:"telefono_oficina",name:"telefono_oficina",value:T.telefono_oficina,onChange:ae})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"telefono_casa",children:"Teléfono Casa"}),jsxRuntimeExports.jsx("input",{type:"tel",id:"telefono_casa",name:"telefono_casa",value:T.telefono_casa,onChange:ae})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"telefono_asistente",children:"Teléfono Asistente"}),jsxRuntimeExports.jsx("input",{type:"tel",id:"telefono_asistente",name:"telefono_asistente",value:T.telefono_asistente,onChange:ae})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"telefonos_corregidos",children:"Teléfonos Corregidos"}),jsxRuntimeExports.jsx("input",{type:"text",id:"telefonos_corregidos",name:"telefonos_corregidos",value:T.telefonos_corregidos,onChange:ae,placeholder:"Números de teléfono corregidos o adicionales"})]})]}),jsxRuntimeExports.jsxs("div",{className:"form-section",children:[jsxRuntimeExports.jsx("h3",{children:"Información Profesional"}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"empresa",children:"Empresa"}),jsxRuntimeExports.jsx("input",{type:"text",id:"empresa",name:"empresa",value:T.empresa,onChange:ae})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"ocupacion",children:"Ocupación"}),jsxRuntimeExports.jsx("input",{type:"text",id:"ocupacion",name:"ocupacion",value:T.ocupacion,onChange:ae})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"entidad",children:"Entidad"}),jsxRuntimeExports.jsx("input",{type:"text",id:"entidad",name:"entidad",value:T.entidad,onChange:ae})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"status_social",children:"Estado Social"}),jsxRuntimeExports.jsx("input",{type:"text",id:"status_social",name:"status_social",value:T.status_social,onChange:ae,placeholder:"Estado civil, situación social"})]})]}),jsxRuntimeExports.jsxs("div",{className:"form-section",children:[jsxRuntimeExports.jsx("h3",{children:"Estado y Clasificación"}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"status",children:"Estado"}),jsxRuntimeExports.jsxs("select",{id:"status",name:"status",value:T.status,onChange:ae,required:!0,children:[jsxRuntimeExports.jsx("option",{value:"prospecto",children:"Prospecto"}),jsxRuntimeExports.jsx("option",{value:"cliente",children:"Cliente"}),jsxRuntimeExports.jsx("option",{value:"inactivo",children:"Inactivo"})]})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"origen",children:"Origen"}),jsxRuntimeExports.jsxs("select",{id:"origen",name:"origen",value:T.origen,onChange:ae,children:[jsxRuntimeExports.jsx("option",{value:"",children:"Seleccionar"}),jsxRuntimeExports.jsx("option",{value:"MZD",children:"MZD"}),jsxRuntimeExports.jsx("option",{value:"LORENA",children:"LORENA"}),jsxRuntimeExports.jsx("option",{value:"MICH",children:"MICH"})]})]}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"pais",children:"País"}),jsxRuntimeExports.jsx("input",{type:"text",id:"pais",name:"pais",value:T.pais,onChange:ae})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"form-section full-width",children:[jsxRuntimeExports.jsx("h3",{children:"Comentarios"}),jsxRuntimeExports.jsxs("div",{className:"form-group",children:[jsxRuntimeExports.jsx("label",{htmlFor:"comentario",children:"Comentarios adicionales"}),jsxRuntimeExports.jsx("textarea",{id:"comentario",name:"comentario",value:T.comentario,onChange:ae,rows:"4",placeholder:"Información adicional sobre el contacto..."})]})]}),jsxRuntimeExports.jsxs("div",{className:"contacto-modal-actions",children:[jsxRuntimeExports.jsx("button",{type:"button",onClick:v,className:"btn-cancel",children:"Cancelar"}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:S,className:"btn-save",children:S?"Guardando...":"Guardar"})]})]})]})})},PolicyModal=({contacto:E,isOpen:r,onClose:v})=>{const[T,w]=reactExports.useState([]),[S,I]=reactExports.useState(!1),[H,te]=reactExports.useState(null),[ae,ie]=reactExports.useState("cards");reactExports.useEffect(()=>{r&&E&&ce()},[r,E]);const ce=async()=>{try{I(!0),te(null),console.log("Loading policies for contact:",E.id);const Ce=await directorioService.getContactoPolicies(E.id);console.log("Policies data received:",Ce),w(Ce.policies||[])}catch(Ce){console.error("Error loading policies:",Ce),te("Error al cargar las pólizas")}finally{I(!1)}},me=Ce=>({autos:"#4CAF50",vida:"#2196F3",gmm:"#FF9800",hogar:"#9C27B0",negocio:"#F44336",diversos:"#607D8B",rc:"#795548",mascotas:"#E91E63",transporte:"#009688"})[Ce==null?void 0:Ce.toLowerCase()]||"#757575",_e=(Ce,Fe)=>{var Ve;const Me=me(Ce.tabla_origen);return jsxRuntimeExports.jsxs("div",{className:"policy-card",style:{borderLeftColor:Me},children:[jsxRuntimeExports.jsxs("div",{className:"policy-header",children:[jsxRuntimeExports.jsx("span",{className:"policy-type-badge",style:{backgroundColor:Me},children:((Ve=Ce.tabla_origen)==null?void 0:Ve.toUpperCase())||"DESCONOCIDO"}),jsxRuntimeExports.jsxs("span",{className:"policy-number",children:["#",Ce.numero_poliza||"Sin número"]})]}),jsxRuntimeExports.jsxs("div",{className:"policy-content",children:[jsxRuntimeExports.jsxs("div",{className:"policy-main-info",children:[jsxRuntimeExports.jsx("h4",{className:"policy-title",children:Ce.ramo||Ce.aseguradora||"Ramo no especificado"}),jsxRuntimeExports.jsx("p",{className:"policy-description",children:Ce.descripcion||Ce.tipo_de_poliza||Ce.contratante||"Sin descripción"})]}),jsxRuntimeExports.jsxs("div",{className:"policy-details",children:[Ce.aseguradora&&jsxRuntimeExports.jsxs("div",{className:"policy-detail-row",children:[jsxRuntimeExports.jsx("span",{className:"detail-label",children:"🏢 Aseguradora:"}),jsxRuntimeExports.jsx("span",{className:"detail-value",children:Ce.aseguradora})]}),Ce.contratante&&jsxRuntimeExports.jsxs("div",{className:"policy-detail-row",children:[jsxRuntimeExports.jsx("span",{className:"detail-label",children:"👤 Contratante:"}),jsxRuntimeExports.jsx("span",{className:"detail-value",children:Ce.contratante})]})]})]})]},`${Ce.numero_poliza}-${Fe}`)},Re=()=>T.length===0?null:jsxRuntimeExports.jsx("div",{className:"policies-table-container",children:jsxRuntimeExports.jsxs("table",{className:"policies-table",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{children:"Ramo"}),jsxRuntimeExports.jsx("th",{children:"Número"}),jsxRuntimeExports.jsx("th",{children:"Descripción"}),jsxRuntimeExports.jsx("th",{children:"Aseguradora"}),jsxRuntimeExports.jsx("th",{children:"Contratante"})]})}),jsxRuntimeExports.jsx("tbody",{children:T.map((Ce,Fe)=>{var Me;return jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{children:jsxRuntimeExports.jsx("span",{className:"table-type-badge",style:{backgroundColor:me(Ce.tabla_origen)},children:((Me=Ce.tabla_origen)==null?void 0:Me.toUpperCase())||"N/A"})}),jsxRuntimeExports.jsx("td",{className:"policy-number-cell",children:Ce.numero_poliza||"Sin número"}),jsxRuntimeExports.jsxs("td",{children:[jsxRuntimeExports.jsx("strong",{children:Ce.ramo||"N/A"}),Ce.descripcion&&jsxRuntimeExports.jsx("div",{className:"policy-desc",children:Ce.descripcion}),!Ce.descripcion&&Ce.tipo_de_poliza&&jsxRuntimeExports.jsx("div",{className:"policy-desc",children:Ce.tipo_de_poliza})]}),jsxRuntimeExports.jsx("td",{children:Ce.aseguradora||"N/A"}),jsxRuntimeExports.jsx("td",{children:Ce.contratante||E.nombre_completo})]},`${Ce.numero_poliza}-${Fe}`)})})]})}),Pe=()=>{if(T.length===0)return null;const Ce=T.reduce((Fe,Me)=>{var We;const Ve=((We=Me.tabla_origen)==null?void 0:We.toUpperCase())||"DESCONOCIDO";return Fe[Ve]=(Fe[Ve]||0)+1,Fe},{});return jsxRuntimeExports.jsxs("div",{className:"policy-cloud",children:[jsxRuntimeExports.jsx("h4",{children:"Resumen de Pólizas"}),jsxRuntimeExports.jsx("div",{className:"cloud-tags",children:Object.entries(Ce).map(([Fe,Me])=>jsxRuntimeExports.jsxs("span",{className:"cloud-tag",style:{backgroundColor:me(Fe),fontSize:`${Math.min(1.2+Me*.2,1.8)}rem`},children:[Fe," (",Me,")"]},Fe))}),jsxRuntimeExports.jsxs("div",{className:"cloud-summary",children:[jsxRuntimeExports.jsxs("span",{className:"summary-item",children:[jsxRuntimeExports.jsx("strong",{children:"Total:"})," ",T.length]}),jsxRuntimeExports.jsxs("span",{className:"summary-item",children:[jsxRuntimeExports.jsx("strong",{children:"Tipos:"})," ",Object.keys(Ce).length]})]})]})};return r?jsxRuntimeExports.jsx("div",{className:"policy-modal-overlay",onClick:v,children:jsxRuntimeExports.jsxs("div",{className:"policy-modal",onClick:Ce=>Ce.stopPropagation(),children:[jsxRuntimeExports.jsxs("div",{className:"policy-modal-header",children:[jsxRuntimeExports.jsxs("h3",{children:["Pólizas de ",E==null?void 0:E.nombre_completo]}),jsxRuntimeExports.jsxs("div",{className:"modal-header-actions",children:[jsxRuntimeExports.jsxs("div",{className:"view-toggle",children:[jsxRuntimeExports.jsx("button",{className:`toggle-btn ${ae==="cards"?"active":""}`,onClick:()=>ie("cards"),title:"Vista de tarjetas",children:"📋"}),jsxRuntimeExports.jsx("button",{className:`toggle-btn ${ae==="table"?"active":""}`,onClick:()=>ie("table"),title:"Vista de tabla",children:"📊"})]}),jsxRuntimeExports.jsx("button",{className:"close-button",onClick:v,children:"✕"})]})]}),jsxRuntimeExports.jsxs("div",{className:"policy-modal-content",children:[S&&jsxRuntimeExports.jsxs("div",{className:"loading-state",children:[jsxRuntimeExports.jsx("div",{className:"spinner"}),jsxRuntimeExports.jsx("p",{children:"Cargando pólizas..."})]}),H&&jsxRuntimeExports.jsxs("div",{className:"error-state",children:[jsxRuntimeExports.jsxs("p",{children:["❌ ",H]}),jsxRuntimeExports.jsx("button",{onClick:ce,className:"retry-button",children:"Reintentar"})]}),!S&&!H&&T.length===0&&jsxRuntimeExports.jsx("div",{className:"empty-state",children:jsxRuntimeExports.jsx("p",{children:"📄 No se encontraron pólizas para este contacto"})}),!S&&!H&&T.length>0&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[Pe(),ae==="cards"?jsxRuntimeExports.jsx("div",{className:"policies-grid",children:T.map((Ce,Fe)=>_e(Ce,Fe))}):Re()]})]})]})}):null},SearchFilters=({searchTerm:E,filters:r,onSearch:v,onFilterChange:T})=>{const[w,S]=reactExports.useState(E),I=reactExports.useCallback(debounce(ie=>{v(ie)},300),[v]);reactExports.useEffect(()=>{I(w)},[w,I]),reactExports.useEffect(()=>{S(E)},[E]);const H=(ie,ce)=>{T({...r,[ie]:ce})},te=()=>{S(""),v(""),T({status:"",origen:"",genero:""})},ae=E||r.status||r.origen||r.genero;return jsxRuntimeExports.jsx("div",{className:"search-filters",children:jsxRuntimeExports.jsxs("div",{className:"search-form",children:[jsxRuntimeExports.jsx("div",{className:"search-section",children:jsxRuntimeExports.jsx("input",{type:"text",placeholder:"🔍 Buscar contactos...",value:w,onChange:ie=>S(ie.target.value),className:"search-input"})}),jsxRuntimeExports.jsxs("div",{className:"filters-section",children:[jsxRuntimeExports.jsxs("select",{value:r.status,onChange:ie=>H("status",ie.target.value),className:"filter-select",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Estado: Todos"}),jsxRuntimeExports.jsx("option",{value:"cliente",children:"Cliente"}),jsxRuntimeExports.jsx("option",{value:"prospecto",children:"Prospecto"})]}),jsxRuntimeExports.jsxs("select",{value:r.origen,onChange:ie=>H("origen",ie.target.value),className:"filter-select",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Origen: Todos"}),jsxRuntimeExports.jsx("option",{value:"MZD",children:"MZD"}),jsxRuntimeExports.jsx("option",{value:"LORENA",children:"LORENA"}),jsxRuntimeExports.jsx("option",{value:"MICH",children:"MICH"})]}),jsxRuntimeExports.jsxs("select",{value:r.genero,onChange:ie=>H("genero",ie.target.value),className:"filter-select",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Género: Todos"}),jsxRuntimeExports.jsx("option",{value:"MASCULINO",children:"Masculino"}),jsxRuntimeExports.jsx("option",{value:"FEMENINO",children:"Femenino"})]}),ae&&jsxRuntimeExports.jsx("button",{type:"button",onClick:te,className:"clear-btn",children:"✕ Limpiar"})]})]})})};function debounce(E,r){let v;return function(...w){const S=()=>{clearTimeout(v),E(...w)};clearTimeout(v),v=setTimeout(S,r)}}const RelationshipsView=()=>{var Ge,Ie;const[E,r]=reactExports.useState([]),[v,T]=reactExports.useState(null),[w,S]=reactExports.useState(!0),[I,H]=reactExports.useState(null),[te,ae]=reactExports.useState(null),[ie,ce]=reactExports.useState(null),[me,_e]=reactExports.useState(!1),[Re,Pe]=reactExports.useState(!1),[Ce,Fe]=reactExports.useState("cards");reactExports.useEffect(()=>{Me()},[]);const Me=async()=>{try{S(!0);const Le=await directorioService.getRelationships();r(Le.relationships||[]),T(Le.summary||{}),H(null)}catch(Le){H("Error al cargar las relaciones"),console.error("Error loading relationships:",Le)}finally{S(!1)}},Ve=async Le=>{try{_e(!0);const He=await directorioService.getContactoPolicies(Le);ce(He)}catch(He){console.error("Error loading contact policies:",He)}finally{_e(!1)}},We=Le=>{ae(Le),Ve(Le.id)},ze=Le=>{switch(Le){case"email_exact":return"Email exacto";case"name_similarity":return"Similitud de nombre";default:return Le}},Ue=Le=>{switch(Le){case"email_exact":return"#28a745";case"name_similarity":return"#ffc107";default:return"#6c757d"}},je=Le=>Le>=.9?"#28a745":Le>=.8?"#ffc107":"#fd7e14",ke=async()=>{try{Pe(!0);const Le=await directorioService.updateClientStatus();Le.success?(alert(`✅ ${Le.message}

Contactos actualizados: ${Le.updated_count}

Nuevas estadísticas:
- Clientes: ${Le.new_stats.cliente||0}
- Prospectos: ${Le.new_stats.prospecto||0}`),await Me()):alert(`❌ Error: ${Le.error}`)}catch(Le){console.error("Error updating client status:",Le),alert(`❌ Error al actualizar el status: ${Le.message}`)}finally{Pe(!1)}},Ne=()=>jsxRuntimeExports.jsx("div",{className:"relationships-table-container",children:jsxRuntimeExports.jsxs("table",{className:"relationships-table",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{children:"Contacto"}),jsxRuntimeExports.jsx("th",{children:"Email"}),jsxRuntimeExports.jsx("th",{children:"Status"}),jsxRuntimeExports.jsx("th",{children:"Pólizas"}),jsxRuntimeExports.jsx("th",{children:"Tablas"}),jsxRuntimeExports.jsx("th",{children:"Tipos de Match"}),jsxRuntimeExports.jsx("th",{children:"Acciones"})]})}),jsxRuntimeExports.jsx("tbody",{children:E.map(Le=>jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("td",{className:"contact-name",children:Le.contacto.nombre}),jsxRuntimeExports.jsx("td",{className:"contact-email",children:Le.contacto.email}),jsxRuntimeExports.jsx("td",{children:jsxRuntimeExports.jsx("span",{className:`status-badge status-${Le.contacto.status}`,children:Le.contacto.status})}),jsxRuntimeExports.jsx("td",{className:"policies-count",children:Le.polizas.length}),jsxRuntimeExports.jsx("td",{className:"tables-list",children:[...new Set(Le.polizas.map(He=>He.tabla))].join(", ").toUpperCase()}),jsxRuntimeExports.jsx("td",{className:"match-types",children:[...new Set(Le.polizas.map(He=>ze(He.match_type)))].join(", ")}),jsxRuntimeExports.jsx("td",{children:jsxRuntimeExports.jsx("button",{onClick:()=>We(Le.contacto),className:"btn-view-details",children:"Ver Detalles"})})]},Le.contacto.id))})]})});return w?jsxRuntimeExports.jsx("div",{className:"relationships-container",children:jsxRuntimeExports.jsxs("div",{className:"loading-spinner",children:[jsxRuntimeExports.jsx("div",{className:"spinner"}),jsxRuntimeExports.jsx("p",{children:"Analizando relaciones..."})]})}):I?jsxRuntimeExports.jsx("div",{className:"relationships-container",children:jsxRuntimeExports.jsxs("div",{className:"error-message",children:[I,jsxRuntimeExports.jsx("button",{onClick:Me,className:"btn-retry",children:"Reintentar"})]})}):jsxRuntimeExports.jsxs("div",{className:"relationships-container",children:[jsxRuntimeExports.jsxs("div",{className:"relationships-header",children:[jsxRuntimeExports.jsx("h1",{children:"🔗 Análisis de Relaciones"}),jsxRuntimeExports.jsxs("div",{className:"header-actions",children:[jsxRuntimeExports.jsxs("div",{className:"view-mode-buttons",children:[jsxRuntimeExports.jsx("button",{onClick:()=>Fe("cards"),className:`view-mode-btn ${Ce==="cards"?"active":""}`,children:"📋 Tarjetas"}),jsxRuntimeExports.jsx("button",{onClick:()=>Fe("table"),className:`view-mode-btn ${Ce==="table"?"active":""}`,children:"📊 Tabla"})]}),jsxRuntimeExports.jsx("button",{onClick:ke,disabled:Re,className:"btn-update-status",children:Re?"⏳ Actualizando...":"🔄 Actualizar Status de Clientes"})]})]}),v&&jsxRuntimeExports.jsxs("div",{className:"summary-section",children:[jsxRuntimeExports.jsx("h2",{children:"Resumen de Relaciones"}),jsxRuntimeExports.jsxs("div",{className:"summary-cards",children:[jsxRuntimeExports.jsxs("div",{className:"summary-card",children:[jsxRuntimeExports.jsx("h3",{children:"Total Relaciones"}),jsxRuntimeExports.jsx("p",{className:"summary-number",children:v.total_relationships})]}),jsxRuntimeExports.jsxs("div",{className:"summary-card",children:[jsxRuntimeExports.jsx("h3",{children:"Contactos con Pólizas"}),jsxRuntimeExports.jsx("p",{className:"summary-number",children:v.contacts_with_policies})]}),jsxRuntimeExports.jsxs("div",{className:"summary-card",children:[jsxRuntimeExports.jsx("h3",{children:"Matches por Email"}),jsxRuntimeExports.jsx("p",{className:"summary-number",children:((Ge=v.by_match_type)==null?void 0:Ge.email_exact)||0})]}),jsxRuntimeExports.jsxs("div",{className:"summary-card",children:[jsxRuntimeExports.jsx("h3",{children:"Matches por Nombre"}),jsxRuntimeExports.jsx("p",{className:"summary-number",children:((Ie=v.by_match_type)==null?void 0:Ie.name_similarity)||0})]})]}),v.by_table&&jsxRuntimeExports.jsxs("div",{className:"table-breakdown",children:[jsxRuntimeExports.jsx("h3",{children:"Relaciones por Tabla"}),jsxRuntimeExports.jsx("div",{className:"table-stats",children:Object.entries(v.by_table).map(([Le,He])=>jsxRuntimeExports.jsxs("div",{className:"table-stat",children:[jsxRuntimeExports.jsx("span",{className:"table-name",children:Le.toUpperCase()}),jsxRuntimeExports.jsx("span",{className:"table-count",children:He})]},Le))})]})]}),jsxRuntimeExports.jsxs("div",{className:"relationships-content",children:[jsxRuntimeExports.jsxs("div",{className:"relationships-list",children:[jsxRuntimeExports.jsxs("h2",{children:["Contactos con Relaciones (",E.length,")"]}),E.length===0?jsxRuntimeExports.jsx("div",{className:"no-relationships",children:jsxRuntimeExports.jsx("p",{children:"No se encontraron relaciones entre el directorio y las pólizas."})}):Ce==="table"?Ne():jsxRuntimeExports.jsx("div",{className:"relationships-grid",children:E.map(Le=>jsxRuntimeExports.jsxs("div",{className:"relationship-card",onClick:()=>We(Le.contacto),children:[jsxRuntimeExports.jsxs("div",{className:"contact-info",children:[jsxRuntimeExports.jsx("h3",{children:Le.contacto.nombre}),jsxRuntimeExports.jsx("p",{className:"contact-email",children:Le.contacto.email}),jsxRuntimeExports.jsx("span",{className:`status-badge status-${Le.contacto.status}`,children:Le.contacto.status})]}),jsxRuntimeExports.jsxs("div",{className:"policies-summary",children:[jsxRuntimeExports.jsxs("p",{className:"policies-count",children:[Le.polizas.length," póliza",Le.polizas.length!==1?"s":""]}),jsxRuntimeExports.jsxs("div",{className:"policies-preview",children:[Le.polizas.slice(0,3).map((He,Ct)=>jsxRuntimeExports.jsxs("div",{className:"policy-preview",children:[jsxRuntimeExports.jsx("span",{className:"policy-table",children:He.tabla.toUpperCase()}),jsxRuntimeExports.jsx("span",{className:"match-type",style:{backgroundColor:Ue(He.match_type)},children:ze(He.match_type)}),jsxRuntimeExports.jsxs("span",{className:"similarity-score",style:{color:je(He.similarity_score)},children:[Math.round(He.similarity_score*100),"%"]})]},Ct)),Le.polizas.length>3&&jsxRuntimeExports.jsxs("div",{className:"more-policies",children:["+",Le.polizas.length-3," más"]})]})]})]},Le.contacto.id))})]}),te&&jsxRuntimeExports.jsxs("div",{className:"contact-details",children:[jsxRuntimeExports.jsxs("div",{className:"contact-details-header",children:[jsxRuntimeExports.jsxs("h2",{children:["Detalles de ",te.nombre]}),jsxRuntimeExports.jsx("button",{onClick:()=>ae(null),className:"btn-close",children:"✕"})]}),me?jsxRuntimeExports.jsxs("div",{className:"loading-policies",children:[jsxRuntimeExports.jsx("div",{className:"spinner-small"}),jsxRuntimeExports.jsx("p",{children:"Cargando pólizas..."})]}):ie?jsxRuntimeExports.jsxs("div",{className:"policies-details",children:[jsxRuntimeExports.jsxs("h3",{children:["Pólizas Encontradas (",ie.total_policies,")"]}),ie.policies.length===0?jsxRuntimeExports.jsx("p",{children:"No se encontraron pólizas para este contacto."}):jsxRuntimeExports.jsx("div",{className:"policies-list",children:ie.policies.map((Le,He)=>jsxRuntimeExports.jsxs("div",{className:"policy-detail-card",children:[jsxRuntimeExports.jsxs("div",{className:"policy-header",children:[jsxRuntimeExports.jsxs("h4",{children:["Póliza #",Le.numero_poliza]}),jsxRuntimeExports.jsx("span",{className:"policy-table-badge",children:Le.tabla_origen.toUpperCase()})]}),jsxRuntimeExports.jsxs("div",{className:"policy-info",children:[jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Contratante:"})," ",Le.contratante]}),Le.email&&jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Email:"})," ",Le.email]}),Le.ramo&&jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Ramo:"})," ",Le.ramo]}),Le.aseguradora&&jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Aseguradora:"})," ",Le.aseguradora]}),Le.fecha_inicio&&jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Fecha Inicio:"})," ",Le.fecha_inicio]}),Le.fecha_fin&&jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"Fecha Fin:"})," ",Le.fecha_fin]})]}),jsxRuntimeExports.jsxs("div",{className:"match-info",children:[jsxRuntimeExports.jsx("span",{className:"match-type-badge",style:{backgroundColor:Ue(Le.match_type)},children:ze(Le.match_type)}),jsxRuntimeExports.jsxs("span",{className:"similarity-badge",style:{backgroundColor:je(Le.similarity_score)},children:[Math.round(Le.similarity_score*100),"% similitud"]})]})]},He))})]}):null]})]})]})},Directorio=()=>{const[E,r]=reactExports.useState("cards"),[v,T]=reactExports.useState([]),[w,S]=reactExports.useState(!0),[I,H]=reactExports.useState(null),[te,ae]=reactExports.useState(""),[ie,ce]=reactExports.useState({status:"",origen:"",genero:""}),[me,_e]=reactExports.useState(null),[Re,Pe]=reactExports.useState(!1),[Ce,Fe]=reactExports.useState(!1),[Me,Ve]=reactExports.useState(null),[We,ze]=reactExports.useState(null),[Ue,je]=reactExports.useState(1),[ke,Ne]=reactExports.useState(50),[Ge,Ie]=reactExports.useState({});reactExports.useEffect(()=>{E!=="relationships"&&Le()},[ie,te,E,Ue,ke]);const Le=async()=>{var Be,Xe,rt;try{S(!0);const Qe={...ie,page:Ue,limit:ke},[vt,Dt]=await Promise.all([te.trim()?directorioService.searchContactos(te,Qe):directorioService.getContactos(Qe),directorioService.getStats()]);console.log("🔍 Raw statsData received:",Dt),console.log("🔍 statsData.stats:",Dt.stats),console.log("🔍 statsData.stats?.total:",(Be=Dt.stats)==null?void 0:Be.total),console.log("🔍 statsData.stats?.clientes:",(Xe=Dt.stats)==null?void 0:Xe.clientes),console.log("🔍 statsData.stats?.prospectos:",(rt=Dt.stats)==null?void 0:rt.prospectos);const Ut=vt.data||vt;T(Ut),ze(Dt.stats||Dt);const hr={},pt=Ut.filter(vr=>vr.status==="cliente"),yr=5;for(let vr=0;vr<pt.length;vr+=yr){const wr=pt.slice(vr,vr+yr);await Promise.allSettled(wr.map(async ir=>{try{const sr=await directorioService.getContactoPolicies(ir.id);if(sr!=null&&sr.policies&&Array.isArray(sr.policies)){const kt=[...new Set(sr.policies.map(rr=>rr.tabla_origen).filter(Boolean))];hr[ir.id]=kt.length>0?kt.map(rr=>rr.toUpperCase()).join(", "):"Sin pólizas"}else hr[ir.id]="Sin pólizas"}catch(sr){console.error(`Error loading policies for contact ${ir.id}:`,sr),hr[ir.id]="Error al cargar"}}))}Ie(hr),H(null)}catch{console.error("Error al cargar los contactos")}finally{S(!1)}},He=Be=>{ae(Be),je(1)},Ct=Be=>{ce(Be),je(1)},Ze=async Be=>{try{me?await directorioService.updateContacto(me.id,Be):await directorioService.createContacto(Be),await Le(),Pe(!1),_e(null)}catch(Xe){throw console.error("Error saving contacto:",Xe),Xe}},Rt=async Be=>{if(window.confirm("¿Estás seguro de que quieres eliminar este contacto?"))try{await directorioService.deleteContacto(Be),await Le()}catch{alert("Error al eliminar el contacto")}},nt=Be=>{const Xe={...ie};Be==="all"?Xe.status="":Xe.status=Xe.status===Be?"":Be,Ct(Xe)},nr=We?Math.ceil(We.total/ke):1,Je=()=>nr<=1?null:jsxRuntimeExports.jsxs("div",{className:"pagination",children:[jsxRuntimeExports.jsx("div",{className:"pagination-info",children:jsxRuntimeExports.jsxs("span",{children:["Mostrando ",(Ue-1)*ke+1," - ",Math.min(Ue*ke,(We==null?void 0:We.total)||0)," de ",(We==null?void 0:We.total)||0," contactos"]})}),jsxRuntimeExports.jsxs("div",{className:"pagination-controls",children:[jsxRuntimeExports.jsxs("div",{className:"items-per-page",children:[jsxRuntimeExports.jsx("label",{children:"Mostrar:"}),jsxRuntimeExports.jsxs("select",{value:ke,onChange:Be=>{Ne(parseInt(Be.target.value)),je(1)},children:[jsxRuntimeExports.jsx("option",{value:25,children:"25"}),jsxRuntimeExports.jsx("option",{value:50,children:"50"}),jsxRuntimeExports.jsx("option",{value:100,children:"100"})]}),jsxRuntimeExports.jsx("span",{children:"por página"})]}),jsxRuntimeExports.jsxs("div",{className:"pagination-buttons",children:[jsxRuntimeExports.jsx("button",{onClick:()=>je(1),disabled:Ue===1,className:"pagination-btn",children:"Primera"}),jsxRuntimeExports.jsx("button",{onClick:()=>je(Ue-1),disabled:Ue===1,className:"pagination-btn",children:"Anterior"}),jsxRuntimeExports.jsxs("span",{className:"page-indicator",children:["Página ",Ue," de ",nr]}),jsxRuntimeExports.jsx("button",{onClick:()=>je(Ue+1),disabled:Ue===nr,className:"pagination-btn",children:"Siguiente"}),jsxRuntimeExports.jsx("button",{onClick:()=>je(nr),disabled:Ue===nr,className:"pagination-btn",children:"Última"})]})]})]}),Wt=()=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[We&&jsxRuntimeExports.jsx("div",{className:"stats-cards",children:[{key:"all",label:"Total",value:We.total,filter:""},{key:"cliente",label:"Clientes",value:We.clientes,filter:"cliente"},{key:"prospecto",label:"Prospectos",value:We.prospectos,filter:"prospecto"}].map(({key:Be,label:Xe,value:rt,filter:Qe})=>jsxRuntimeExports.jsxs("div",{className:`stat-card ${ie.status===Qe?"active":""}`,onClick:()=>nt(Be),title:`Filtrar por ${Xe.toLowerCase()}`,children:[jsxRuntimeExports.jsx("h3",{children:Xe}),jsxRuntimeExports.jsx("p",{className:"stat-number",children:(rt==null?void 0:rt.toLocaleString())||0})]},Be))}),jsxRuntimeExports.jsx(SearchFilters,{searchTerm:te,filters:ie,onSearch:He,onFilterChange:Ct}),I&&jsxRuntimeExports.jsx("div",{className:"error-message",children:I})]}),Lt=()=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[Wt(),jsxRuntimeExports.jsx("div",{className:"table-container",children:jsxRuntimeExports.jsxs("table",{className:"contactos-table",children:[jsxRuntimeExports.jsx("thead",{children:jsxRuntimeExports.jsxs("tr",{children:[jsxRuntimeExports.jsx("th",{children:"Nombre"}),jsxRuntimeExports.jsx("th",{children:"Email"}),jsxRuntimeExports.jsx("th",{children:"Teléfono"}),jsxRuntimeExports.jsx("th",{children:"Status"}),jsxRuntimeExports.jsx("th",{children:"Pólizas"}),jsxRuntimeExports.jsx("th",{children:"Origen"}),jsxRuntimeExports.jsx("th",{children:"Género"}),jsxRuntimeExports.jsx("th",{children:"Fecha Nacimiento"}),jsxRuntimeExports.jsx("th",{children:"Acciones"})]})}),jsxRuntimeExports.jsx("tbody",{children:v.length===0?jsxRuntimeExports.jsx("tr",{children:jsxRuntimeExports.jsx("td",{colSpan:"9",className:"no-results",children:w?"Cargando...":"No se encontraron contactos"})}):v.map(Be=>jsxRuntimeExports.jsxs("tr",{className:"contacto-row",children:[jsxRuntimeExports.jsx("td",{children:jsxRuntimeExports.jsx("strong",{children:Be.nombre_completo})}),jsxRuntimeExports.jsx("td",{children:Be.email||"-"}),jsxRuntimeExports.jsx("td",{children:Be.telefono||"-"}),jsxRuntimeExports.jsx("td",{children:jsxRuntimeExports.jsx("span",{className:`status-badge ${Be.status}`,children:Be.status==="cliente"?"Cliente":"Prospecto"})}),jsxRuntimeExports.jsx("td",{className:"policy-tables-cell",children:Be.status==="cliente"?jsxRuntimeExports.jsx("span",{className:`policy-tables-status ${Ge[Be.id]?Ge[Be.id]==="Error al cargar"?"error":Ge[Be.id]==="Sin pólizas"?"empty":"loaded":"loading"}`,children:Ge[Be.id]||"Cargando..."}):jsxRuntimeExports.jsx("span",{className:"no-policies",children:"-"})}),jsxRuntimeExports.jsx("td",{children:Be.origen||"-"}),jsxRuntimeExports.jsx("td",{children:Be.genero||"-"}),jsxRuntimeExports.jsx("td",{children:Be.fecha_nacimiento?new Date(Be.fecha_nacimiento).toLocaleDateString():"-"}),jsxRuntimeExports.jsxs("td",{className:"actions-cell",children:[Be.status==="cliente"&&jsxRuntimeExports.jsx("button",{className:"btn-policies",onClick:()=>{Ve(Be),Fe(!0)},title:"Ver Pólizas",children:"📋"}),jsxRuntimeExports.jsx("button",{className:"btn-edit",onClick:()=>{_e(Be),Pe(!0)},title:"Editar contacto",children:"✏️"}),jsxRuntimeExports.jsx("button",{className:"btn-delete",onClick:()=>Rt(Be.id),title:"Eliminar contacto",children:"🗑️"})]})]},Be.id))})]})}),Je()]}),qe=()=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[Wt(),jsxRuntimeExports.jsx("div",{className:"contactos-grid",children:v.length===0?jsxRuntimeExports.jsx("div",{className:"no-results",children:w?"Cargando contactos...":"No se encontraron contactos"}):v.map(Be=>jsxRuntimeExports.jsx(ContactoCard,{contacto:Be,onClick:()=>{_e(Be),Pe(!0)},onDelete:()=>Rt(Be.id),onViewPolicies:()=>{Ve(Be),Fe(!0)},policyTables:Ge[Be.id]},Be.id))}),Je()]}),$e=()=>{if(w&&v.length===0)return jsxRuntimeExports.jsxs("div",{className:"loading-spinner",children:[jsxRuntimeExports.jsx("div",{className:"spinner"}),jsxRuntimeExports.jsx("p",{children:"Cargando directorio..."})]});switch(E){case"cards":return qe();case"table":return Lt();case"relationships":return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[Wt(),jsxRuntimeExports.jsx(RelationshipsView,{})]});default:return Lt()}};return jsxRuntimeExports.jsxs("div",{className:"directorio-container",children:[jsxRuntimeExports.jsxs("div",{className:"directorio-header",children:[jsxRuntimeExports.jsx("h1",{children:"Directorio de Contactos"}),jsxRuntimeExports.jsxs("div",{className:"header-actions",children:[jsxRuntimeExports.jsx("div",{className:"view-navigation",children:[{mode:"cards",icon:"📋",label:"Cards"},{mode:"table",icon:"📊",label:"Tabla"},{mode:"relationships",icon:"🔗",label:"Relaciones"}].map(({mode:Be,icon:Xe,label:rt})=>jsxRuntimeExports.jsxs("button",{className:`view-btn ${E===Be?"active":""}`,onClick:()=>r(Be),title:`Vista ${rt}`,children:[Xe," ",rt]},Be))}),E!=="relationships"&&jsxRuntimeExports.jsx("button",{className:"btn-primary",onClick:()=>{_e(null),Pe(!0)},title:"Crear nuevo contacto",children:"+ Nuevo Contacto"})]})]}),$e(),Re&&jsxRuntimeExports.jsx(ContactoModal,{contacto:me,onSave:Ze,onClose:()=>{Pe(!1),_e(null)}}),Ce&&jsxRuntimeExports.jsx(PolicyModal,{contacto:Me,isOpen:Ce,onClose:()=>{Fe(!1),Ve(null)}})]})},DirectorioSimple=()=>{const[E,r]=reactExports.useState([]),[v,T]=reactExports.useState(!0),[w,S]=reactExports.useState(null),[I,H]=reactExports.useState(""),[te,ae]=reactExports.useState(""),[ie,ce]=reactExports.useState(1),[me]=reactExports.useState(25),[_e,Re]=reactExports.useState(0),[Pe,Ce]=reactExports.useState(!1),[Fe,Me]=reactExports.useState(null),Ve="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");reactExports.useEffect(()=>{We()},[ie,I,te]);const We=async()=>{try{T(!0);const Ie={page:ie,limit:me,...I&&{search:I},...te&&{letter:te}},Le=await directorioService.getContactos(Ie);r(Le.data||[]),Re(Le.total||0)}catch(Ie){console.error("Error loading contacts:",Ie),S("Error al cargar los contactos")}finally{T(!1)}},ze=Ie=>{Me(Ie),Ce(!0)},Ue=()=>{Me(null),Ce(!0)},je=async Ie=>{if(window.confirm("¿Estás seguro de que quieres eliminar este contacto?"))try{await directorioService.deleteContacto(Ie),We()}catch(Le){console.error("Error deleting contact:",Le),alert("Error al eliminar el contacto")}},ke=async Ie=>{try{Fe?await directorioService.updateContacto(Fe.id,Ie):await directorioService.createContacto(Ie),Ce(!1),Me(null),We()}catch(Le){console.error("Error saving contact:",Le),alert("Error al guardar el contacto")}},Ne=Ie=>{ae(te===Ie?"":Ie),ce(1)},Ge=Math.ceil(_e/me);return v&&E.length===0?jsxRuntimeExports.jsx("div",{className:"directorio-simple",children:jsxRuntimeExports.jsxs("div",{className:"loading",children:[jsxRuntimeExports.jsx("div",{className:"spinner"}),jsxRuntimeExports.jsx("p",{children:"Cargando contactos..."})]})}):jsxRuntimeExports.jsxs("div",{className:"directorio-simple",children:[jsxRuntimeExports.jsxs("div",{className:"simple-header",children:[jsxRuntimeExports.jsx("h1",{children:"📋 Directorio de Contactos"}),jsxRuntimeExports.jsx("div",{className:"header-actions",children:jsxRuntimeExports.jsx("button",{className:"btn-create",onClick:Ue,children:"+ Nuevo"})})]}),jsxRuntimeExports.jsx("div",{className:"controls",children:jsxRuntimeExports.jsx("div",{className:"search-group",children:jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Buscar por nombre, email o teléfono...",value:I,onChange:Ie=>{H(Ie.target.value),ce(1)},className:"search-input"})})}),jsxRuntimeExports.jsxs("div",{className:"abc-navigation",children:[jsxRuntimeExports.jsxs("div",{className:"abc-header",children:[jsxRuntimeExports.jsx("span",{className:"abc-title",children:"📚 Navegar por letra:"}),te&&jsxRuntimeExports.jsx("button",{className:"clear-letter-btn",onClick:()=>Ne(""),title:"Limpiar filtro de letra",children:"✕ Limpiar"})]}),jsxRuntimeExports.jsx("div",{className:"alphabet-grid",children:Ve.map(Ie=>jsxRuntimeExports.jsx("button",{className:`letter-btn ${te===Ie?"active":""}`,onClick:()=>Ne(Ie),title:`Filtrar por letra ${Ie}`,children:Ie},Ie))})]}),jsxRuntimeExports.jsx("div",{className:"results-info",children:jsxRuntimeExports.jsxs("p",{children:["Mostrando ",E.length," de ",_e," contactos",te&&` - Letra: ${te}`,I&&` - Búsqueda: "${I}"`]})}),jsxRuntimeExports.jsx("div",{className:"contacts-grid",children:E.map(Ie=>jsxRuntimeExports.jsxs("div",{className:"contact-card",children:[jsxRuntimeExports.jsx("div",{className:"contact-header",children:jsxRuntimeExports.jsx("h3",{children:Ie.nombre_completo})}),jsxRuntimeExports.jsxs("div",{className:"contact-info",children:[Ie.empresa&&jsxRuntimeExports.jsxs("p",{className:"contact-empresa",children:["🏢 ",Ie.empresa]}),Ie.ocupacion&&jsxRuntimeExports.jsxs("p",{className:"contact-ocupacion",children:["💼 ",Ie.ocupacion]}),Ie.email&&jsxRuntimeExports.jsxs("p",{className:"contact-email",children:["📧 ",jsxRuntimeExports.jsx("a",{href:`mailto:${Ie.email}`,children:Ie.email})]}),Ie.telefono_movil&&jsxRuntimeExports.jsxs("p",{className:"contact-phone",children:["📱 ",jsxRuntimeExports.jsx("a",{href:`tel:${Ie.telefono_movil}`,children:Ie.telefono_movil})]}),Ie.telefono_oficina&&jsxRuntimeExports.jsxs("p",{className:"contact-phone-office",children:["☎️ ",jsxRuntimeExports.jsx("a",{href:`tel:${Ie.telefono_oficina}`,children:Ie.telefono_oficina})]}),Ie.origen&&jsxRuntimeExports.jsx("div",{className:"contact-origen",children:jsxRuntimeExports.jsxs("span",{className:"origen-badge",children:["👤 ",Ie.origen]})}),Ie.comentario&&jsxRuntimeExports.jsx("div",{className:"contact-comentario",children:jsxRuntimeExports.jsxs("p",{className:"comentario-text",children:["💬 ",Ie.comentario.length>80?`${Ie.comentario.substring(0,80)}...`:Ie.comentario]})})]}),jsxRuntimeExports.jsxs("div",{className:"contact-actions",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ze(Ie),className:"btn-edit",title:"Editar",children:"✏️ Editar"}),jsxRuntimeExports.jsx("button",{onClick:()=>je(Ie.id),className:"btn-delete",title:"Eliminar",children:"🗑️ Eliminar"})]})]},Ie.id))}),Ge>1&&jsxRuntimeExports.jsxs("div",{className:"pagination",children:[jsxRuntimeExports.jsx("button",{onClick:()=>ce(ie-1),disabled:ie===1,className:"pagination-btn",children:"← Anterior"}),jsxRuntimeExports.jsxs("span",{className:"page-info",children:["Página ",ie," de ",Ge]}),jsxRuntimeExports.jsx("button",{onClick:()=>ce(ie+1),disabled:ie===Ge,className:"pagination-btn",children:"Siguiente →"})]}),Pe&&jsxRuntimeExports.jsx(ContactoModal,{contacto:Fe,onSave:ke,onClose:()=>{Ce(!1),Me(null)}}),jsxRuntimeExports.jsx("div",{className:"full-access-link",children:jsxRuntimeExports.jsx("a",{href:"/directorio",target:"_blank",rel:"noopener noreferrer",children:"🔗 Abrir versión completa del directorio"})})]})},ProtectedRoute=({children:E})=>E;function AppRoutes(){const{user:E,login:r}=useAuth();return jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(Dashboard,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/tasks",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(Tasks,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/data",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(DataSection,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/drive",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(Drive,{currentUser:(E==null?void 0:E.email)||"default-user"})})})}),jsxRuntimeExports.jsx(Route,{path:"/reports",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(Reports,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/pdf-parser",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(PDFParser,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/datapool",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(Datapool,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/sharepoint",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(Sharepoint,{currentUser:E==null?void 0:E.email})})})}),jsxRuntimeExports.jsx(Route,{path:"/birthdays",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(Birthdays,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/prospeccion",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(Prospeccion,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/test-gpt",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(TestGPT,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/firebase",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(FirebaseViewer,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/directorio",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(Directorio,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/directorio-simple",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(Layout,{children:jsxRuntimeExports.jsx(DirectorioSimple,{})})})}),jsxRuntimeExports.jsx(Route,{path:"/directorio-standalone",element:jsxRuntimeExports.jsx(ProtectedRoute,{children:jsxRuntimeExports.jsx(DirectorioSimple,{})})}),jsxRuntimeExports.jsx(Route,{path:"*",element:jsxRuntimeExports.jsx(Navigate,{to:"/",replace:!0})})]})}function App(){return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Oe,{position:"top-right",toastOptions:{duration:3e3,style:{background:"#363636",color:"#fff"},success:{duration:3e3,theme:{primary:"#4aed88"}},error:{duration:4e3,theme:{primary:"#ff4b4b"}}}}),jsxRuntimeExports.jsx(AuthProvider,{children:jsxRuntimeExports.jsx(ThemeProvider,{children:jsxRuntimeExports.jsx(BrowserRouter,{children:jsxRuntimeExports.jsx(AppRoutes,{})})})})]})}client.createRoot(document.getElementById("root")).render(jsxRuntimeExports.jsx(React.StrictMode,{children:jsxRuntimeExports.jsx(AuthProvider,{children:jsxRuntimeExports.jsx(App,{})})}));
